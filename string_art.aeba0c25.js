let e,t,i,n;class s{#e={};addEventListener(e,t){let i=this.#e[e]??=[];return i.includes(t)||i.push(t),()=>{let e=i.indexOf(t);-1!==e&&i.splice(e,1)}}removeEventListener(e,t){let i=this.#e[e];if(!i)return;let n=i.indexOf(t);-1!==n&&i.splice(n,1)}emit(e,t){this.#e[e]?.forEach(e=>e(t))}}const r=new class extends s{#t=!1;#i="auto";get instructionsMode(){return this.#i}set instructionsMode(e){e!==this.#i&&(this.#i=e,this.emit("instructionsModeChange",e))}get showInstructions(){return this.#t}set showInstructions(e){e!==this.#t&&(this.#t=e,this.emit("showInstructionsChange",{showInstructions:e}))}};var a=((i_=a||{})[i_.CONTINUOUS=0]="CONTINUOUS",i_[i_.STEPS=1]="STEPS",i_);class o{viewer;elements;stepCount;#n;#s;#r;#a=!1;mode=1;constructor(e,t){this.viewer=t,this.elements={player:e,step:e.querySelector("#step"),playerPosition:e.querySelector("#player_position"),playBtn:e.querySelector("#play_btn"),pauseBtn:e.querySelector("#pause_btn"),text:e.querySelector("#player_text"),prevBtn:e.querySelector("#player_prev_btn"),nextBtn:e.querySelector("#player_next_btn"),startBtn:e.querySelector("#player_start_btn"),stepDirections:e.querySelector("#player_step_directions"),stepDirectionsFrom:e.querySelector("#player_step_directions_from"),stepDirectionsTo:e.querySelector("#player_step_directions_to"),continuousMode:e.querySelector("#player_continuous"),stepsMode:e.querySelector("#player_steps"),instructionsToggleBtn:e.querySelector("#player_instructions_toggle_btn")},this.stepCount=0,this.#n=!1,this.elements.playerPosition.addEventListener("input",({target:e})=>{"value"in e&&this.goto(+e.value)}),this.elements.playBtn.addEventListener("click",()=>{this.play({restartIfAtEnd:!0})}),this.elements.pauseBtn.addEventListener("click",()=>{this.pause()}),this.elements.startBtn.addEventListener("click",()=>{this.gotoStart()}),this.elements.prevBtn.addEventListener("click",()=>{this.prev()}),this.elements.nextBtn.addEventListener("click",()=>{this.next()}),this.elements.instructionsToggleBtn.addEventListener("click",()=>{let e=!r.showInstructions;r.showInstructions=e,e?this.gotoStart():this.gotoEnd()}),t.addEventListener("positionChange",({changeBy:e})=>this.advance(e)),t.addEventListener("click",()=>this.#n?this.pause():this.advance()),t.addEventListener("touchStart",()=>this.play({speed:200})),t.addEventListener("touchEnd",()=>this.pause()),r.addEventListener("showInstructionsChange",({showInstructions:e})=>{e?this.#r?.():(this.elements.player.classList.remove("with_steps"),this.#a=!1)})}updateStatus(e){this.#n!==e&&(this.elements.player.classList.toggle("playing"),this.#n=e)}update(e,{draw:t=!0}={}){this.stepCount=e,this.elements.playerPosition.setAttribute("max",String(this.stepCount)),this.elements.step.innerText=`${this.stepCount}/${this.stepCount}`,r.showInstructions=!1,this.goto(this.stepCount,{updateStringArt:t,showInstructions:!1}),this.#o()}updatePosition(e){this.elements.step.innerText=`${e}/${this.stepCount}`,this.elements.playerPosition.value=String(e)}goto(t,{updateStringArt:i=!0,showInstructions:n=!0}={}){if(!(t>this.stepCount)&&!(t<1)&&(clearTimeout(e),this.#r?.(),this.pause(),this.updatePosition(t),n&&(r.showInstructions=!0,e=setTimeout(()=>{this.#a||(this.elements.player.classList.add("with_steps"),this.#a=!0),this.#o(!1)},200)),i&&this.viewer.goto(t),"auto"===r.instructionsMode&&t===this.stepCount&&r.showInstructions)){let e=setTimeout(()=>{r.showInstructions=!1},1e3);this.#r=()=>clearTimeout(e)}}advance(e=1){this.goto(Math.max(1,Math.min(this.stepCount,Number(this.elements.playerPosition.value)+e)))}play({restartIfAtEnd:e=!1,speed:t}={}){let i=this.viewer.position===this.stepCount;if(i&&!e)return;this.updateStatus(!0),this.#s?.(),r.showInstructions=!1,i&&this.viewer.goto(0);let n=()=>{if(this.viewer.next().done)this.updateStatus(!1);else if(t){let e=setTimeout(n,t);this.#s=()=>clearTimeout(e)}else{let e=requestAnimationFrame(n);this.#s=()=>cancelAnimationFrame(e)}this.updatePosition(this.viewer.position)};n()}pause(){this.#s?.(),this.updateStatus(!1)}toggle(){this.#n?this.pause():this.play()}prev(){r.showInstructions=!0,this.viewer.goto(this.viewer.position-1),this.#o()}next(){this.viewer.position===this.stepCount?(r.showInstructions=!1,this.elements.nextBtn.setAttribute("disabled","disabled")):(r.showInstructions=!0,this.viewer.goto(this.viewer.position+1),this.#o())}gotoStart(){r.showInstructions=!0,this.viewer.goto(0),this.#o()}gotoEnd(){this.viewer.goto(this.stepCount),this.#o()}#o(e=!0){e&&this.updatePosition(this.viewer.position);let t=this.viewer.getLastStringNailNumbers();t&&(this.elements.stepDirectionsFrom.textContent=t[0].toString(),this.elements.stepDirectionsTo.textContent=t[1].toString()),1===this.viewer.position?(this.elements.prevBtn.setAttribute("disabled","disabled"),this.elements.startBtn.setAttribute("disabled","disabled"),this.elements.nextBtn.removeAttribute("disabled")):(this.elements.prevBtn.removeAttribute("disabled"),this.elements.startBtn.removeAttribute("disabled"),this.viewer.position===this.stepCount?this.elements.nextBtn.setAttribute("disabled","disabled"):this.elements.nextBtn.removeAttribute("disabled"))}}var l={};l='fieldset{border:var(--border-light);background:#ffffff08;border-radius:9px;padding-inline:.5em}fieldset>legend{cursor:pointer;opacity:.8}fieldset>legend:hover{opacity:1}div{padding-top:8px}fieldset.minimized{background:0 0;border:none;padding:0}fieldset.minimized>legend{padding:0;transform:translate(-6px)}fieldset.minimized>div{display:none}legend:before{content:"î¤ƒ";opacity:.7;vertical-align:top;margin-inline-end:2px;font-family:string_art_studio;font-size:20px;display:inline-block}fieldset.minimized>legend:before{transform:rotate(-90deg)}';const c=new CSSStyleSheet;c.replaceSync(String(l));class u extends HTMLElement{#l;#c;constructor(){super();let e=this.attachShadow({mode:"open"});e.adoptedStyleSheets=[c],this.shadowRoot.innerHTML=`
      <fieldset>
        <legend></legend>
        <div>
            <slot></slot>
        </div>
      </fieldset>
      `,this.#l=e.querySelector("legend"),this.#c=e.querySelector("fieldset"),this.#l.addEventListener("click",()=>this.toggle())}static get observedAttributes(){return["legend","minimized"]}connectedCallback(){this.syncAttributes()}attributeChangedCallback(){this.syncAttributes()}syncAttributes(){this.hasAttribute("legend")?this.#l.textContent=this.getAttribute("legend"):(this.#c.classList.remove("minimized"),this.#l.textContent=""),this.hasAttribute("minimized")?this.#c.classList.add("minimized"):this.#c.classList.remove("minimized")}toggle(){this.#c.classList.toggle("minimized")}open(){this.#c.classList.remove("minimized")}close(){this.#c.classList.add("minimized")}}customElements.define("expandable-panel",u);var d={};d=':root{--color-accent:#ff218f;--color-accent-hover:#b11b66;--color-buttons-dialog:#212124;--color-canvas-background:#0e0e0e;--color-config:#212124;--color-gray3:#262629;--color-header:#2b2b31;--color-lighter:#ffffff87;--color-link:#68c0ff;--color-link-hover:#85ccff;--color-player:#222226;--color-text:White;--color-text-hover:#85ccff;--color-input:#c51880;--color-input-hover:#961663;--color-input-active:#e20c8c;--color-dialog-background:#212124;--color-error:#c00;--horizontal-padding:16px;--vertical-padding:12px;--logo1:#9892ff;--logo1-active:#c5c2ff;--logo2:#d4c1ff;--border-light:solid 1px #3a3a3a;--border-lighter:dotted 1px #505050;--border-dialog:solid 1px #fff3;--circular_button_width:38px;--controls-height:50px;--header-height:45px;--select-height:49px;--sidebar-form-padding-top:16px;--sidebar-width:270px;--player-mobile-height:100px;--responsive-width:800px}span{white-space:nowrap}input{appearance:none;cursor:pointer;vertical-align:middle;border:2px solid #666;border-radius:2px;width:18px;height:18px;margin:0 2px;position:relative}input:checked{background-color:var(--color-input-active);border-color:var(--color-input)}input:checked:after{content:"";border:2px solid #fff;border-width:0 2px 2px 0;width:4px;height:11px;position:absolute;top:-1px;left:4px;transform:rotate(36deg)}label{margin-top:0;margin-inline-start:2px;font-size:14px;display:inline-block;position:relative;top:1px}';const h=new CSSStyleSheet;h.replaceSync(String(d));class p extends HTMLElement{static formAssociated=!0;internals;#u;disabled=!1;#d;#h;constructor(){super();let e=this.attachShadow({mode:"open",delegatesFocus:!0});e.adoptedStyleSheets=[h],this.shadowRoot.innerHTML=`
          <span>
            <input id="checkbox" type="checkbox">
            <label for="checkbox"></label>
          </span>
        `,this.#h=e.querySelector("input"),this.#d=e.querySelector("label"),this.internals=this.attachInternals()}static get observedAttributes(){return["checked","label","disabled","name"]}attributeChangedCallback(){this.syncAttributes()}get checked(){return this.#u}set checked(e){(this.#u=e)?this.#h.checked=!0:this.#h.checked=!1,this.internals.setFormValue(this.#u?"on":null)}get value(){return this.checked}set value(e){this.checked=e}connectedCallback(){this.syncAttributes(),this.#h.addEventListener("input",()=>{this.#u=this.#h.checked,this.internals.setFormValue(this.#u?"on":null),this.dispatchEvent(new CustomEvent("input",{detail:{checked:this.#u}})),this.dispatchEvent(new CustomEvent("change",{detail:{checked:this.#u},bubbles:!0}))}),this.internals.setFormValue(this.#u?"on":null),this.tabIndex=0}syncAttributes(){this.hasAttribute("label")&&(this.#d.textContent=this.hasAttribute("label")?this.getAttribute("label"):""),this.hasAttribute("checked")&&(this.checked=!0),this.hasAttribute("disabled")&&(this.disabled=!0),this.hasAttribute("name")&&this.internals.setFormValue(this.#u?"on":null)}focus(){this.#h.focus()}blur(){this.#h.blur()}}customElements.define("string-art-checkbox",p);class g extends HTMLElement{static formAssociated=!0;internals;start=1;colorThumb=!1;reverse=!1;type="hue";#h=null;constructor(){super(),this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.innerHTML=`
        <string-art-range-input min="1" max="360" step="1" />
    `,this.#h=this.shadowRoot.querySelector("string-art-range-input"),this.internals=this.attachInternals()}static get observedAttributes(){return["start","colorthumb","value","reverse","type"]}attributeChangedCallback(e,t,i){"value"===e&&(this.value=i),"start"===e&&(this.start=parseInt(i,10),this.#p()),"reverse"===e&&(this.reverse=!!i,this.#p()),"colorthumb"===e&&(this.colorThumb=!!i,this.#g()),"type"===e&&(this.type="range"===i?"range":"hue",this.#p())}get value(){return this.#h.value}set value(e){this.#h.value=e,this.#p(),this.colorThumb&&this.#g()}connectedCallback(){this.hasAttribute("value")&&(this.value=parseInt(this.getAttribute("value"))),this.hasAttribute("colorthumb")&&(this.colorThumb=!0),this.#g(),this.#h.addEventListener("input",e=>this.#f(e))}#f(e){let t=this.value;this.internals.setFormValue(String(t)),this.dispatchEvent(new CustomEvent("input",{detail:{value:t}})),this.#p(),this.#g()}disconnectedCallback(){}focus(){}blur(){}#p(){let e="range"===this.type?`linear-gradient(to ${this.reverse?"left":"right"} in hsl ${this.value>=180?"longer":"shorter"} hue, hsl(${this.start} 100 50), hsl(${this.start+(180===this.value?181:this.value)} 100 50))`:"linear-gradient(to right in hsl longer hue, hsl(1 100 50), hsl(360 100 50))";this.#h.setAttribute("background",e)}#g(){let e=this.colorThumb?`hsl(${this.value}deg 100 50)`:"white";this.#h.setAttribute("thumbcolor",e)}}customElements.define("string-art-hue-input",g);const f="rgba(0,0,0,.2)";class m extends HTMLElement{static formAssociated=!0;internals;min;max;#h=null;#m=null;#v=.05;#y=null;#b=null;#_=null;#w=null;#S=null;#x=null;#C=null;#k;constructor(){super(),this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.innerHTML=`
          <style>
            input[type="range"] {
              width: 100%;
              appearance: none;
              -webkit-appearance: none; /* remove iOS default */
              background: transparent;
              border: none;
              margin: 2px;
              cursor: pointer;
            }

            input[type="range"]::-webkit-slider-thumb {
              appearance: none;
              -webkit-appearance: none;
              width: 16px;
              height: 16px;
              border-radius: 50%;
              background: var(--color-input);
              cursor: pointer;
              border: none;
              margin-top: -4px;
              z-index: 10;
              box-shadow: 0 0 5px rgba(0,0,0,.5)
            }

            input[type="range"]::-webkit-slider-thumb:hover {
              background: var(--color-input-hover);
            }
              
            input[type="range"]:active::-webkit-slider-thumb {
              background: var(--color-input-active);
            }

            input[type="range"]::-webkit-slider-runnable-track {
              height: 8px;
              border-radius: 4px;
              margin: 0;
            }
          </style>
          <style id="background"></style>
          <input type="range">
        `,this.#h=this.shadowRoot.querySelector('input[type="range"]'),this.#m=this.shadowRoot.querySelector("#background"),this.#v=.05,this.#b=null,this.internals=this.attachInternals()}static get observedAttributes(){return["min","max","value","step","snap","background","thumbcolor"]}attributeChangedCallback(e,t,i){let n;if("snap"===e?this.#_=this.getTickValues():this.#h&&(this.#h[e]=i),("min"===e||"max"===e)&&(this[e]=Number(i)),"value"===e&&(n=Number(i)),"background"===e&&(this.#S=i),"thumbcolor"===e&&(this.#x=i),null!=this.min&&null!=this.max&&(this.min>this.max&&(this.max=this.min,this.#h.max=String(this.min)),this.#w=(this.max-this.min)*this.#v||.05,this.#_&&null!=this.value)){let e=this.getClosestTick(n);null!=e&&(this.#b=e)}this.#E()}get value(){return Number(this.#h.value)}set value(e){this.#h.value=String(e),this.#E()}connectedCallback(){["min","max","value","step"].forEach(e=>{this.hasAttribute(e)&&(this.#h[e]=this.getAttribute(e))}),this.#_=this.getTickValues(),this.#k=new ResizeObserver(e=>{for(let t of e)t.contentRect.width,this.#E()}),this.#k.observe(this.#h),this.#h.addEventListener("input",()=>this.handleInput()),this.#h.addEventListener("keydown",e=>this.handleKeydown(e)),this.#h.addEventListener("change",()=>this.#C=null),this.tabIndex=0}disconnectedCallback(){this.#k.unobserve(this)}getTickValues(){let e=this.getAttribute("snap"),t=e?.match(/\d+(\.\d+)?/g);return t?t.map(Number).filter(e=>!isNaN(e)).sort():[]}#N(e,t){if(null==t&&(t=this.getClosestTick(e)),null==t)return!0;let i=Math.abs(e-t);return!!(i>=this.#w/2&&i>Math.abs(this.#y-t))}#P(e,t){return Math.abs(e-t)/(this.max-this.min)>=.2}focus(){this.#h.focus()}blur(){this.#h.blur()}handleInput(){let e=Number(this.#h.value),t=this.getClosestTick(e);this.internals.setFormValue(this.#h.value),null!=t&&this.#C!==t&&this.#N(e,t)&&(this.#C=t),t!==this.#C&&(null!==t?(this.#h.value=String(t),t!==this.#b&&(this.#M(),this.#b=t)):null!=this.#b&&(this.#b=null)),null!=this.#C&&null==t&&this.#P(e,this.#C)&&(this.#C=null),this.#E(),this.#y=e,this.dispatchEvent(new CustomEvent("input",{detail:{value:this.#h.value}}))}handleKeydown(e){let t;e.preventDefault();let i=Number(this.#h.step||1),n=Number(this.#h.value);if("ArrowLeft"===e.key)t=Math.max(this.min,n-i);else if("ArrowRight"===e.key)t=Math.min(this.max,n+i);else if("ArrowUp"===e.key){let e=this.#_.find(e=>e>n);void 0!==e?t=e:n!==this.max&&(t=this.max)}else if("ArrowDown"===e.key){let e=[...this.#_].reverse().find(e=>e<n);void 0!==e?t=e:n!==this.min&&(t=this.min)}return null!=t&&(this.value=t,this.#y=t,this.dispatchEvent(new CustomEvent("input",{detail:{value:t},bubbles:!0,composed:!0}))),!1}getClosestTick(e){if(!this.#_||0===this.#_.length)return null;for(let t of this.#_)if(Math.abs(e-t)<=this.#w)return t;return null}#M(){"vibrate"in navigator&&navigator.vibrate(10)}#E(){let e=this.#h.clientWidth;if(!e)return;let t=this.value-this.min,i=this.max-this.min,n=e-16,s=8+n*t/i,r=this.#_?.filter(e=>e!==this.min&&e!==this.max).map(e=>8+n*(e-this.min)/i-1),a=r?.map(e=>`transparent ${e}px, ${f} ${e}px, ${f} ${e+2}px, transparent ${e+2}px`).join(", "),o=r?.length?`linear-gradient(to right, ${a}), `:null,l=[`input[type="range"]::-webkit-slider-runnable-track {
        background: ${o||""}${this.#S??`linear-gradient(to right, var(--color-input) ${s}px, #ddd ${s}px)`};
      }${this.#S?"":`
       input[type="range"]:hover::-webkit-slider-runnable-track {
        background: ${o||""}linear-gradient(to right, var(--color-input-hover) ${s}px, #ddd ${s}px);
      }
        input[type="range"]:active::-webkit-slider-runnable-track {
        background: ${o||""}linear-gradient(to right, var(--color-input-active) ${s}px, #ddd ${s}px);
      }`}`];null!=this.#x&&l.push(`input[type="range"]::-webkit-slider-thumb { background: ${this.#x} !important}`),this.#m.innerHTML=l.join("\n")}}function v(e){e.removeAttribute("hidden")}function y(e){e.setAttribute("hidden","hidden")}function b(e,t){null!=t?t?y(e):v(e):e.hasAttribute("hidden")?v(e):y(e)}customElements.define("string-art-range-input",m);const _={controls:document.querySelector("#controls"),controlsPanel:document.querySelector("#controls_panel"),design:document.querySelector("#design")},w="controls_state";class S extends s{config;controlsConfig;state;controlElements={};#L=!1;#R;#I;#T;#A;#D;#z;#$;#F;#O=!1;#V;constructor(e,t){super(),this.config=t,this.controlsConfig=e,this.state=this._getState()??{groups:{}},this.#I=this.#q.bind(this),_.controls.addEventListener("input",this.#I),this.#T=this.#B.bind(this),_.controls.addEventListener("touchstart",this.#T,{passive:!0}),_.controls.addEventListener("mousedown",this.#j),this.#V=this.#H.bind(this),_.design.addEventListener("click",this.#V),_.design.addEventListener("keydown",this.#U),this.controlElements={},this.renderControls();let i=document.querySelector("#controls_menu"),n=document.querySelector("#controls_panel");i.addEventListener("click",e=>{if(e.target instanceof HTMLElement){let t=e.target.closest(".controls_menu_item")?.getAttribute("href");if(e.preventDefault(),t)if("#controls_top"===t)n.scrollTo({top:0,behavior:"smooth"});else{let e=document.querySelector(t);e instanceof u&&(e.open(),e.scrollIntoView({behavior:"smooth"}))}}})}destroy(){_.controls.removeEventListener("input",this.#I),_.design.removeEventListener("click",this.#V),_.design.removeEventListener("keydown",this.#U),_.controls.removeEventListener("touchstart",this.#T),_.controls.removeEventListener("mousedown",this.#j),_.controls.innerHTML=""}#H(e){if("LEGEND"===e.target.nodeName){e.target.parentElement.classList.toggle("minimized");let t=e.target.parentElement.dataset.group;this.state={...this.state,groups:{...this.state.groups,[t]:!e.target.parentElement.classList.contains("minimized")}},this._updateState(this.state)}}#U(e){"LEGEND"===e.target.nodeName&&"Enter"===e.key&&this.#H(e)}#j(){let e=window.getSelection();e&&e.removeAllRanges()}#B(e){x(e.target)&&(this.#L=!0,this.#z=e.target,this.#$=e.target.value,this.#F=window.setTimeout(()=>{this.#L=!1},120),this.#A=this.#G.bind(this),document.body.addEventListener("touchend",this.#A,{passive:!0}),this.#D=this.#W.bind(this),_.controlsPanel.addEventListener("scroll",this.#D))}#G(){document.body.removeEventListener("touchend",this.#A),_.controlsPanel.removeEventListener("scroll",this.#D),this.#O&&(this.#O=!1,this.#z&&(this.#z.value=this.#$)),this.#z=this.#$=null}#W(){this.#O=!0}#q(e){return(clearTimeout(t),clearTimeout(this.#R),this.#L&&x(e.target))?(e.preventDefault(),this.#R=window.setTimeout(()=>{this.#q(e)},120),!1):this.#O?(e.preventDefault(),!1):void((e.target instanceof HTMLInputElement||e.target instanceof p||x(e.target)||e.target instanceof HTMLSelectElement)&&this.updateInput({inputElement:e.target,originalEvent:e,deferChange:!0}))}updateControlDisplayValue(e){let{config:t,displayValueElement:i,input:n}=this.controlElements[e];i&&(i.innerText=String(t.displayValue?t.displayValue(this.config):n.value))}updateInput({inputElement:e,originalEvent:i,deferChange:n=!0}){let s=e.id.replace(/^config_/,""),r=function(e){if(x(e))return Number(e.value);if(e instanceof HTMLInputElement)switch(e.type){case"range":case"number":return parseFloat(e.value);case"hue":default:return e.value;case"checkbox":return e.checked}return e instanceof p?e.checked:e instanceof HTMLSelectElement?e.value:void 0}(e);if(this.config[s]===r)return;let a={control:this.controlElements[s].config,value:r,originalEvent:i};this.emit("input",a);let o=()=>{this.emit("change",a),this.updateControlsVisibility(),this.updateControlsLabels()};this.updateControlsAttributes(),this.updateControlDisplayValue(s),n?t=window.setTimeout(o,100):o()}_getState(){let e=localStorage.getItem(w);if(e)try{return JSON.parse(e)}catch(e){}return null}_updateState(e){e?localStorage.setItem(w,JSON.stringify(e)):localStorage.removeItem(w)}updateControlsAttributes(e){e||(e=this.controlsConfig),e.forEach(e=>{if("group"===e.type)this.updateControlsAttributes(e.children);else if(e.attr){let t=Object.entries(e.attr).filter(([e,t])=>t instanceof Function);if(t.length){let i=this.controlElements[e.key].input;i&&t.forEach(([t,n])=>{let s=this.getConfigValue(n,this.config);s!=i.getAttribute(t)&&(i.setAttribute(t,String(s)),"min"===t&&i.value<s||"max"===t&&i.value>s?(i.value=String(s),clearTimeout(i.updateTimeout),i.updateTimeout=window.setTimeout(()=>{this.updateInput({inputElement:i})},100)):this.updateControlDisplayValue(e.key))})}}})}updateControlsLabels(e){(e??this.controlsConfig).forEach(e=>{if(e.label instanceof Function){let{label:t,element:i}=this.controlElements[e.key],n=e.label(this.config);"checkbox"===e.type?i.setAttribute("label",n):"group"===e.type?i.setAttribute("legend",n):t&&(t.innerText=n)}"group"===e.type&&this.updateControlsLabels(e.children)})}updateControlsVisibility(e){(e??this.controlsConfig).forEach(e=>{if(e.show){let t=e.show(this.config),i=this.controlElements[e.key].element;i&&b(i,!t)}if(e.isDisabled){let t=e.isDisabled(this.config),i=this.controlElements[e.key].input;i&&(t?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled"))}e.children&&this.updateControlsVisibility(e.children)})}renderControls(e=_.controls,t,i){let n=t??this.controlsConfig;e.innerHTML="";let s=document.createDocumentFragment();i=i??1,n.forEach((e,t)=>{let i,n,r,a,o=`config_${String(e.key)}`;if("group"===e.type)(i=document.createElement("expandable-panel")).setAttribute("legend",this.getConfigValue(e.label,this.config)),i.setAttribute("data-group",String(e.key)),i.className="control control_group","minimized"===e.defaultValue&&(i.setAttribute("minimized","minimized"),this.state.groups[String(e.key)]=!1),this.renderControls(i,e.children);else{(i=document.createElement("div")).className="control","checkbox"!==e.type&&((a=document.createElement("label")).innerHTML=this.getConfigValue(e.label,this.config),a.setAttribute("for",o)),x(n=document.createElement(function(e){switch(e){case"select":return"select";case"range":return"string-art-range-input";case"hue":return"string-art-hue-input";case"checkbox":return"string-art-checkbox";default:return"input"}}(e.type)))&&n.classList.add("range-input"),n.setAttribute("tabindex",String(t));let s=this.config[e.key]??this.getConfigValue(e.defaultValue,this.config);if("select"===e.type){let t=document.createDocumentFragment();e.options.forEach(e=>{let{value:i,label:n}="string"==typeof e?{value:e,label:e}:e,s=document.createElement("option");s.setAttribute("value",i),s.innerText=n,t.appendChild(s)}),n.appendChild(t),n.value=String(s),i.appendChild(a),i.appendChild(n)}else"range"!==e.type&&n.setAttribute("type",e.type),"checkbox"===e.type?(n.checked=!!s,n.setAttribute("label",this.getConfigValue(e.label,this.config)),i.appendChild(n)):(i.appendChild(a),i.appendChild(n),setTimeout(()=>{n.value=String(s)}),(r=document.createElement("span")).id=`config_${String(e.key)}_value`,r.innerText=String(e.displayValue?e.displayValue(this.config):s),r.className="control_input_value",i.appendChild(r));e.attr&&Object.entries(e.attr).forEach(([e,t])=>{let i=this.getConfigValue(t,this.config);n.setAttribute(e,String(i))}),n.id=o}this.controlElements[e.key]={config:e,displayValueElement:r,input:n,element:i,label:a},i.id=`control_${String(e.key)}`,s.appendChild(i)}),e.appendChild(s),this.updateGroupsState(),requestAnimationFrame(()=>this.updateControlsVisibility())}updateGroupsState(){_.design.querySelectorAll("[data-group]").forEach(e=>{if(e instanceof HTMLFieldSetElement){let t=e.dataset.group,i=this.state.groups[t];"boolean"==typeof i&&(i?e.classList.remove("minimized"):e.classList.add("minimized"))}})}getConfigValue(e,t){return e instanceof Function?e(t):e}}function x(e){return e instanceof m||e instanceof g}const C={updateOnResize:!0};class k extends s{parentElement;color;size;fixedSize;pixelRatio=1;options;#K=!0;currentSize;lastLine;lastStringCoordinates;hasInstructions=!1;currentLayerOptions;#Y;#J;constructor(e,t){super(),this.options=t??C;let{updateOnResize:i=!0}=this.options;this.parentElement=e,i&&this.#X()}#X(){let e=new ResizeObserver(e=>{for(let t of e)this.#K||this.fixedSize||this.setSize([t.contentRect.width,t.contentRect.height]),this.#K=!1});this.#J=()=>e.disconnect(),e.observe(this.parentElement)}destroy(){this.parentElement&&(this.parentElement.innerHTML=""),this.#Y?.(),this.#J?.()}get element(){throw Error("element getter not implemented!")}setColor(e){this.color=e}resetSize(){this.fixedSize=null}getSize(){return[this.parentElement.clientWidth,this.parentElement.clientHeight]}getLogicalSize(){return this.getSize()}setStartingPoint(e){this.lastStringCoordinates=e}startLayer(e){this.currentLayerOptions=e,e.color&&this.setColor(e.color)}endLayer(){this.currentLayerOptions=null}setFixedSize(e){this.fixedSize=null,this.setSize(e),this.fixedSize=e}enablePixelRatio(){let e=window.devicePixelRatio||1;if(this.pixelRatio=e,!1!==this.options.updateOnResize){let t=()=>{this.#Y?.();let i=matchMedia(`(resolution: ${e}dppx)`);i.addEventListener("change",t),this.#Y=()=>{i.removeEventListener("change",t)},this.pixelRatio=window.devicePixelRatio,this.emit("devicePixelRatioChange",{devicePixelRatio:this.pixelRatio})};t()}}disablePixelRatio(){this.pixelRatio=1,this.#Y?.()}renderInstructionsForLastLine(){this.renderInstructions(...this.lastLine)}}const E=2*Math.PI;function N(e){return e<0?[1-Math.abs(e),1]:[1/(1-e),1]}function P(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function M(e,t){let i=Math.pow(10,t);return Math.round(e*i)/i}function L(e,t){return e[0]===t[0]&&e[1]===t[1]}Object.defineProperty(Number.prototype,"toFixedPrecision",{value:function(e){let t=Math.pow(10,e);return Math.round(this*t)/t},writable:!0,configurable:!0,enumerable:!1});const R=new Set(["cm","inch"]);function I(e,t){return e.map(t)}function T(e,t,i,n){if(t===i)return e;if(R.has(t)!==R.has(i)&&!n)throw Error(`Can't convert from ${t} to ${i} without DPI!`);switch(t){case"cm":switch(i){case"inch":return e/2.54;case"px":return e/2.54*n}case"inch":switch(i){case"cm":return 2.54*e;case"px":return e*n}case"px":switch(i){case"cm":return e/n*2.54;case"inch":return e/n}}}function A(e,t,i,n){return I(e,e=>T(e,t,i,n))}function D(...e){return e.reduce((e,t)=>{let i={...e,left:e.left?Math.min(e.left,t.left):t.left,right:e.right?Math.max(e.right,t.right):t.right,top:e.top?Math.min(e.top,t.top):t.top,bottom:t.bottom?Math.max(e.bottom,t.bottom):e.bottom};return Object.assign(i,{width:i.right-i.left,height:i.bottom-i.top}),i},{left:0,right:0,top:0,bottom:0,width:0,height:0})}function z(e){if(0===e.length)throw Error("Can't get bounding rect, no coordinates specified.");if(1===e.length)return{top:e[0][1],bottom:e[0][1],left:e[0][0],right:e[0][0],width:0,height:0};let t=e.reduce((e,t)=>({top:Math.min(e.top,t[1]),bottom:Math.max(e.bottom,t[1]),left:Math.min(e.left,t[0]),right:Math.max(e.right,t[0])}),{top:1/0,left:1/0,bottom:-1/0,right:-1/0});return{...t,width:t.right-t.left,height:t.bottom-t.top}}function $(e){return e.width/e.height}function F(e,t){let i=Math.min(t[0]/e[0],t[1]/e[1]);return I(e,e=>e*i)}function O(e){return I(e,e=>e/2)}const V=.01;let q=0;class B extends k{#S;#Z;#Q;#ee;#et;constructor(e,t){super(e,t);let i=document.createElement("canvas"),n=document.createElement("canvas"),s=document.createElement("canvas");i.setAttribute("data-id",String(q++)),this.#Q={strings:{canvas:i,ctx:i.getContext("2d")},nails:{canvas:n,ctx:n.getContext("2d")},instructions:{canvas:s,ctx:s.getContext("2d")}},i.id="CanvasRenderer__strings",n.id="CanvasRenderer__nails",s.id="CanvasRenderer_instructions",this.instructionsCtx.lineWidth=4,this.instructionsCtx.strokeStyle="Red",this.canvases.forEach(t=>{t.classList.add("CanvasRenderer__canvas"),e.appendChild(t),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%"}),this.enablePixelRatio(),this.ctxs.forEach(e=>e.globalCompositeOperation="source-over"),this.addEventListener("devicePixelRatioChange",()=>{this.setSize([this.stringsCanvas.clientWidth,this.stringsCanvas.clientHeight])}),this.resetSize(!1)}get element(){return this.#Q.strings.canvas}get canvases(){return[this.#Q.strings.canvas,this.#Q.nails.canvas,this.#Q.instructions.canvas]}get ctxs(){return[this.#Q.strings.ctx,this.#Q.nails.ctx,this.#Q.instructions.ctx]}get stringsCtx(){return this.#Q.strings.ctx}get nailsCtx(){return this.#Q.nails.ctx}get stringsCanvas(){return this.#Q.strings.canvas}get instructionsCanvas(){return this.#Q.instructions.canvas}get instructionsCtx(){return this.#Q.instructions.ctx}resetSize(e=!0){super.resetSize(),this.canvases.forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height"),e.style.removeProperty("width"),e.style.removeProperty("height")});let t=this.getSize();return this.canvases.forEach(e=>{e.setAttribute("width",String(t[0])),e.setAttribute("height",String(t[1]))}),this.currentSize&&L(t,this.currentSize)||(this.currentSize=t,e&&this.emit("sizeChange",{size:t})),t}setSize(e){if(!e)return this.resetSize();if(this.fixedSize)return console.warn(`Trying to set size for Renderer to [${e.join(", ")}], but size is fixed to [${this.fixedSize.join(", ")}].`),this.fixedSize;let t=e.map(e=>e*this.pixelRatio);return this.currentSize&&L(t,this.currentSize)||(this.canvases.forEach(i=>{i.setAttribute("width",String(t[0])),i.setAttribute("height",String(t[1])),i.style.setProperty("width",`${e[0]}px`),i.style.setProperty("height",`${e[1]}px`)}),this.currentSize=t,this.emit("sizeChange",{size:t})),t}resetStrings(){this.stringsCtx.clearRect(0,0,...this.getSize())}resetNails(){this.#Q.nails.ctx.clearRect(0,0,...this.getSize())}setColor(e){this.#Z=e,this.stringsCtx.strokeStyle=e}setLineWidth(e){this.stringsCtx.lineWidth=e}setBackground(e){(this.#S=e)?(this.parentElement.style.background=e,this.#ee&&(this.#ee.style.background=e)):(this.parentElement.style.removeProperty("background"),this.#ee&&(this.#ee.style.background="black"))}#ei(e,t){e.globalCompositeOperation="destination-over",e.fillStyle=t,e.fillRect(0,0,...this.getSize()),e.globalCompositeOperation="source-over"}getLogicalSize(){return this.fixedSize??[this.stringsCanvas.clientWidth,this.stringsCanvas.clientHeight]}getSize(){return this.getLogicalSize().map(e=>e*this.pixelRatio)}renderLine(e,t){this.lastStringCoordinates=e,this.lineTo(t)}lineTo(e){if(!this.lastStringCoordinates)throw Error("no last string coordinates, can't lineTo");this.stringsCtx.beginPath(),this.stringsCtx.moveTo(...this.lastStringCoordinates),this.stringsCtx.lineTo(...e),this.stringsCtx.stroke(),this.lastLine=[this.lastStringCoordinates,e],this.lastStringCoordinates=e}renderNails(e,{color:t,fontSize:i,radius:n,renderNumbers:s,margin:r=0,numbersStart:a=1}){let o=this.stringsCanvas.width/2;this.nailsCtx.globalCompositeOperation="source-over",this.nailsCtx.beginPath(),this.nailsCtx.fillStyle=t,this.nailsCtx.textBaseline="middle",this.nailsCtx.font=`${i}px sans-serif`;let l=n+r,c=a;for(let[t,i]of e){if(this.nailsCtx.moveTo(t+n,i),this.nailsCtx.arc(t,i,n,0,E),s&&null!=c){let e=t<o,n=[e?t-l:t+l,i];this.nailsCtx.textAlign=e?"right":"left",this.nailsCtx.fillText(String(c),...n)}c++}this.nailsCtx.fill()}showInstructions(){if(this.#et?.(),this.#ee)v(this.#ee);else{this.#ee=document.createElement("div"),this.#ee.id="CanvasRenderer__instructions";let e=document.createElement("div");e.id="CanvasRenderer__instructions_overlay",e.style=`background: ${this.parentElement.style.background??"black"}; position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.5`,this.#ee.appendChild(e),this.#ee.appendChild(this.instructionsCanvas),this.parentElement.appendChild(this.#ee)}}hideInstructions(){if(this.#ee){let e=1,t=()=>{if(e-=.02,this.#ee.style.opacity=String(e),e>0){let e=requestAnimationFrame(t);this.#et=()=>{cancelAnimationFrame(e),this.#ee.style.removeProperty("opacity")}}else y(this.#ee),this.clearInstructions(),this.#ee.style.removeProperty("opacity")};t()}}renderInstructions(e,t){this.showInstructions();let i="white",n=this.#Z??"red";this.clearInstructions(),this.instructionsCtx.clearRect(0,0,...this.getSize()),this.instructionsCtx.beginPath(),this.instructionsCtx.lineWidth=3;let s=e;this.#en(s,t,{strokeColor:i,fillColor:n}),s=t,this.instructionsCtx.stroke(),this.instructionsCtx.beginPath(),[e,t].forEach(([e,t])=>{this.instructionsCtx.moveTo(e+4,t),this.instructionsCtx.arc(e,t,4,0,E)}),this.instructionsCtx.strokeStyle=i,this.instructionsCtx.stroke(),this.instructionsCtx.fillStyle=n,this.instructionsCtx.fill(),this.hasInstructions=!0}clearInstructions(){this.hasInstructions&&(this.instructionsCtx.clearRect(0,0,...this.getSize()),this.hasInstructions=!1)}#en(e,t,{strokeColor:i="white",fillColor:n="red"}){let s=this.instructionsCtx,r=Math.atan2(t[1]-e[1],t[0]-e[0]);s.save(),s.strokeStyle=i,s.fillStyle=n,s.beginPath(),s.moveTo(e[0],e[1]),s.lineTo(t[0],t[1]),s.stroke();let a=[e[0]+(t[0]-e[0])/2,e[1]+(t[1]-e[1])/2];s.beginPath(),s.moveTo(a[0],a[1]),s.lineTo(a[0]-15*Math.cos(r-Math.PI/6),a[1]-15*Math.sin(r-Math.PI/6)),s.lineTo(a[0]-15*Math.cos(r+Math.PI/6),a[1]-15*Math.sin(r+Math.PI/6)),s.closePath(),s.fill(),s.restore()}clear(){this.ctxs.forEach(e=>e.clearRect(0,0,...this.getSize()))}toDataURL(){return this.getComposite().toDataURL()}async toBlob(e="png",t=1){return new Promise((i,n)=>{this.getComposite().toBlob(e=>e?i(e):n(),`image/${e}`,Math.max(0,Math.min(t,1)))})}getComposite(){let e=document.createElement("canvas");e.width=this.stringsCanvas.width,e.height=this.stringsCanvas.height;let t=e.getContext("2d");return this.#S&&this.#ei(t,this.#S),this.canvases.filter(e=>e!==this.instructionsCanvas).forEach(e=>t.drawImage(e,0,0)),e}}function*j(e,t){let i=0;for(let n of e)yield{control:n,index:i,parent:t},n.children&&(yield*j(n.children,{control:n,parent:t,index:i})),i++}function H(e,t){let i=e.attr;if(!i)return e;let n={...i};return delete n[t],{...e,attr:n}}function U(e){return e.map(e=>{let t={...e};return e.children&&(t.children=U(e.children)),e.attr&&(t.attr={...e.attr}),t})}function G(e,t,i){let n=U(e),s=function(e,t){var i=({key:e})=>e===t;for(let t of j(e))if(i(t.control))return t;return null}(n,t);if(s){let{index:e,parent:t}=s;return(t?.control.children??n).splice(e+1,0,...i),n}return e}var W=[{key:"isMultiColor",label:"Use multiple colors",defaultValue:!1,type:"checkbox",affectsNails:!1,affectsStepCount:!1},{key:"colorCount",label:"Colors count",defaultValue:7,type:"range",attr:{min:1,max:20,step:1},show:({isMultiColor:e})=>e,affectsNails:!1,affectsStepCount:!1},{key:"color",label:"String color",defaultValue:"#ff4d00",type:"color",show:({isMultiColor:e})=>!e,affectsNails:!1,affectsStepCount:!1},{key:"multicolorStart",label:"Multicolor start",defaultValue:1,type:"hue",attr:{colorthumb:!0},show:({isMultiColor:e})=>e,affectsNails:!1,affectsStepCount:!1},{key:"multicolorRange",label:"Multicolor range",defaultValue:360,type:"hue",attr:{start:({multicolorStart:e})=>e,type:"range"},show:({isMultiColor:e})=>e,affectsNails:!1,affectsStepCount:!1},{key:"saturation",label:"Saturation",defaultValue:100,type:"range",attr:{min:0,max:100,step:1},show:({isMultiColor:e})=>e,affectsNails:!1,affectsStepCount:!1},{key:"lightness",label:"Lightness",type:"group",defaultValue:"minimized",show:({isMultiColor:e})=>e,children:[{key:"multicolorByLightness",label:"Multi lightness",defaultValue:!1,type:"checkbox",show:({isMultiColor:e})=>e,affectsNails:!1,affectsStepCount:!1},{key:"minLightness",label:"Minimum lightness",defaultValue:0,type:"range",attr:{min:0,max:100,step:1,snap:"50",thumbcolor:({minLightness:e})=>`hsl(0 0 ${e})`,background:"linear-gradient(to right, black, white)"},show:({multicolorByLightness:e,isMultiColor:t})=>e&&t,affectsNails:!1,affectsStepCount:!1},{key:"maxLightness",label:"Maximum lightness",defaultValue:100,type:"range",attr:{min:0,max:100,step:1,snap:"50",thumbcolor:({maxLightness:e})=>`hsl(0 0 ${e})`,background:"linear-gradient(to right, black, white)"},show:({multicolorByLightness:e,isMultiColor:t})=>e&&t,affectsNails:!1,affectsStepCount:!1}]},{key:"colorOrderGroup",type:"group",label:"Order",defaultValue:"minimized",show:({isMultiColor:e})=>e,children:[{key:"reverseColors",label:"Reverse colors order",defaultValue:!1,type:"checkbox",show:({isMultiColor:e})=>e,affectsNails:!1,affectsStepCount:!1},{key:"repeatColors",label:"Repeat colors",defaultValue:!0,type:"checkbox",show:({isMultiColor:e})=>e,affectsNails:!1,affectsStepCount:!1},{key:"mirrorColors",label:"Mirror Colors",defaultValue:!1,type:"checkbox",show:({isMultiColor:e,repeatColors:t})=>e&&t,affectsNails:!1,affectsStepCount:!1}]}];class K{config;multiColorStep;multiColorLightnessStep;colors;constructor(e){this.config=e;let{multicolorRange:t,colorCount:i,multicolorByLightness:n,minLightness:s=0,maxLightness:r=100,multicolorStart:a,darkMode:o,saturation:l,reverseColors:c,repeatColors:u,mirrorColors:d,isMultiColor:h}=e;if(h){if(this.multiColorStep=t/Math.max(1,i-1),this.multiColorLightnessStep=n?(r-s)/(Math.max(i,2)-1):1,this.colors=Array(i).fill(null).map((e,t)=>{let i=n?s+this.multiColorLightnessStep*t:o?50:40;return`hsl(${a+t*this.multiColorStep}, ${l}%, ${i}%)`}),u&&d){let[e,...t]=this.colors;t.pop(),this.colors=[...this.colors,...t.reverse()]}c&&this.colors.reverse()}}getColor(e){let{isMultiColor:t,colorCount:i,color:n,repeatColors:s}=this.config;return t?(e>=i&&(e=s?e%this.colors.length:this.colors.length-1),this.colors[e]):n}static getOppositeColor(e){let t=e.match(/^hsl\((\d+)(?:deg)?(?:,?\s?)(\d+%?)(?:,?\s?)(\d+%?)\)$/);if(t){let e=(Number(t[1])+180)%360;return`hsl(${e}, ${t[2]}, ${t[3]})`}return null}getColorMap(e){if(!(e=Object.assign({},this.config,e)).colorCount)throw Error("Can't get color map, no colorCount provided!");let t=Math.floor(e.stepCount/e.colorCount),i=new Map;for(let n=0;n<e.colorCount;n++)i.set(n*t,this.getColor(n));return i}static getConfig({include:e,exclude:t,defaults:i={},customControls:n,propMapper:s,groupLabel:r,maxColorCount:a}){return{key:"colorGroup",label:r??"Color",type:"group",children:[...n??[],...function e(t,i){return i?t.map(t=>(t.children&&(t={...t,children:e(t.children,i)}),{...t,...i(t)})):t}(function n(s){return(s??U(W)).filter(({key:i})=>(!t||!t.includes(i))&&(!e||e.includes(i))).map(e=>{let t={...e,defaultValue:i[e.key]??e.defaultValue};return"group"===e.type&&(t.children=n(e.children)),"colorCount"===e.key&&a&&(t.attr.max=a),t})}(),s)]}}}function Y(e,t,i){if(e===t)return!0;if("object"==typeof e&&"object"==typeof t){if(null===e!=(null===t))return!1;if(e instanceof Array&&t instanceof Array){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Y(e[i],t[i]))return!1;return!0}return(!!i||(i=Object.keys(e)).length===Object.keys(t).length)&&!(i&&i.some(i=>!Y(e[i],t[i])))}return e===t}class J extends k{strings=[];nails=[];lineWidth=1;size=[0,0];background;constructor(e){super(null,{updateOnResize:!1}),this.size=e}resetStrings(){this.strings.length=0}resetNails(){this.nails.length=0}setLineWidth(e){this.lineWidth=e}renderLine(e,t){this.strings.push([e,t])}renderInstructions(e,t){}clearInstructions(){}lineTo(e){this.strings.push([[0,0],e])}renderNails(e,t){for(let t of e)this.nails.push(t)}clear(){this.resetStrings(),this.resetNails()}toDataURL(){return""}getSize(){return this.size}setSize(e){return this.size=e}setBackground(e){this.background=e}showInstructions(){}hideInstructions(){}}class X extends J{#es=0;#er=0;#ea;#Z;#eo;#el;#ec;constructor(e){super(e),this.#eo=new Map,this.#el=[],this.#ec=this.#eu(1.5)}get threadsLength(){return{total:Math.round(this.#es),perColor:Array.from(this.#eo.entries()).map(([e,t])=>({color:e,length:t}))}}get nailCount(){return this.#er}resetStrings(){this.#es=0,this.#eo=new Map}renderLine(e,t){let i=P(e,t)+this.#ec;this.#es+=i,this.#eo.set(this.#Z,this.#eo.get(this.#Z)+i),this.#ea=t}resetNails(){this.#er=0,this.#el.length=0}renderNails(e,{radius:t}){for(let t of e)this.#er++,this.#el.push(t);this.#ec=this.#eu(t)}setStartingPoint(e){this.#ea=e}setColor(e){this.#Z=e,this.#eo.has(e)||this.#eo.set(e,0)}lineTo(e){if(!this.#ea)throw Error("no last string coordinates, can't lineTo");this.renderLine(this.#ea,e)}getInfo(){return{nailsCount:this.#er,threadsLength:this.threadsLength,closestDistanceBetweenNails:function(e){if(e.length<2)return 1/0;let t=[...e].sort((e,t)=>e[0]-t[0]),i=[...e].sort((e,t)=>e[1]-t[1]),n=(e,t)=>{let i=e.length;if(i<=3){let t=1/0;for(let n=0;n<i;n++)for(let s=n+1;s<i;s++){let i=P(e[n],e[s]);i>=1e-8&&(t=Math.min(t,i))}return t}let s=Math.floor(i/2),r=e[s][0],a=e.slice(0,s),o=e.slice(s),l=[],c=[];for(let e of t)(e[0]<=r?l:c).push(e);let u=Math.min(n(a,l),n(o,c)),d=t.filter(e=>Math.abs(e[0]-r)<u);for(let e=0;e<d.length;e++)for(let t=e+1;t<d.length&&d[t][1]-d[e][1]<u;t++){let i=P(d[e],d[t]);i>=1e-8&&(u=Math.min(u,i))}return u};return n(t,i)}(this.#el)}}#eu(e){return E*e*2}}class Z{renderer;nails;#ed;#eh;constructor(e,t){this.renderer=e,this.nails=t}startLayer({name:e,color:t}){t&&this.renderer.setColor(t)}goto(e,t){let i=this.nails.getNailCoordinates(e,t);this.renderer.setStartingPoint(i),this.#ed={nailKey:e,groupKey:t}}stringTo(e,t){this.renderer.lineTo(this.nails.getNailCoordinates(e,t));let i={nailKey:e,groupKey:t};this.#eh=[this.#ed,i],this.#ed=i}getLastStringNailNumbers(){return this.#eh?.map(({nailKey:e,groupKey:t})=>this.nails.getNailNumber(e,t))}}const Q="#0e0e0e",ee=[{key:"strings",label:"Strings",type:"group",defaultValue:"minimized",children:[{key:"showStrings",label:"Show strings",defaultValue:!0,type:"checkbox",isDisabled:({showNails:e})=>!e,affectsNails:!1},{key:"stringWidth",label:"String width",defaultValue:1,type:"range",attr:{min:.2,max:4,step:.1,snap:"1"},show:({showStrings:e})=>e,affectsNails:!1}]},{key:"nails",label:"Nails",type:"group",defaultValue:"minimized",children:[{key:"showNails",label:"Show nails",defaultValue:!0,type:"checkbox",isDisabled:({showStrings:e})=>!e,affectsStrings:!1},{key:"showNailNumbers",label:"Show nail numbers",defaultValue:!1,type:"checkbox",show:({showNails:e})=>e,affectsStrings:!1},{key:"nailNumbersFontSize",label:"Nail numbers font size",defaultValue:10,type:"range",attr:{min:6,max:32,step:.5},displayValue:({nailNumbersFontSize:e})=>`${e}px`,show:({showNails:e,showNailNumbers:t})=>e&&t,affectsStrings:!1},{key:"margin",label:"Margin",defaultValue:20,type:"number",attr:{min:0,max:500,step:1},displayValue:({margin:e})=>`${e}px`,isStructural:!0},{key:"nailRadius",label:"Nail size",defaultValue:1.5,type:"range",attr:{min:.5,max:5,step:.25,snap:"1.5"},show:({showNails:e})=>e,affectsStrings:!1},{key:"nailsColor",label:"Nails color",defaultValue:"#ffffff",type:"color",show:({showNails:e})=>e,affectsStrings:!1}]},{key:"background",label:"Background",type:"group",defaultValue:"minimized",children:[{key:"darkMode",label:"Dark mode",defaultValue:!0,type:"checkbox",affectsNails:!1,affectsStrings:!1},{key:"customBackgroundColor",label:"Custom background color",defaultValue:!1,type:"checkbox",affectsNails:!1,affectsStrings:!1},{key:"backgroundColor",label:"Background color",defaultValue:Q,type:"color",show:({customBackgroundColor:e})=>e,affectsNails:!1,affectsStrings:!1}]}];var et=class extends s{link;linkText;defaultValues={};stepCount=null;position=0;calc;color;stringsIterator;nails;controller;#ep;#eg;#ef;#em;constructor(){super()}getNailCount(e,t){let i=new X(e);return this.draw(i,{precision:t}),i.nailCount}getNailsCoordinates(){return this.nails.getAllNailsCoordinates()}getNailNumber(e,t){return this.nails.getNailNumber(e,t)}thumbnailConfig;testStepCountConfig;static type;get configControls(){return(this.controls??[]).concat(ee)}get controlsIndex(){return this.#eg||(this.#eg=function(e){let t={};for(let{control:i}of j(e))t[i.key]=i;return t}(this.configControls)),this.#eg}get type(){return this.constructor.type}get isTemplate(){return this.type===this.id}get defaultConfig(){return this.#ef||(this.#ef=Object.assign(function(e){let t={};for(let{control:{key:i,defaultValue:n}}of j(e))n instanceof Function||(t[i]=n);return t}(this.configControls),this.defaultValues)),this.#ef}get config(){return this.#ep??this.defaultConfig}set config(e){this.#ep=Object.assign({},this.defaultConfig,e)}get isDefaultConfig(){return Y(this.config,this.#ef)}markConfigAsDefault(){this.#ef=this.config}resetDefaultConfig(){this.#ef=null}assignConfig(e){this.#ep=Object.assign({},this.config,e)}setConfig(e){let t=this.config;if(this.config=e,this.onConfigChange){let i=Object.keys(t).filter(i=>e[i]!==t[i]);this.onConfigChange(i.map(t=>({control:this.controlsIndex[t],value:e[t]})))}}resetStructure(){this.calc=null,this.nails=null}getCalc(e){return{}}onConfigChange(e){e.some(({control:e})=>e.isStructural)&&(this.resetStructure(),null!=this.stepCount&&e.some(({control:e})=>!1!==e.affectsStepCount)&&(this.stepCount=null))}onResize(){this.resetStructure()}setConfigValue(e,t){(!this.#ep||this.#ep[e]!==t)&&(this.#ep={...this.#ep??this.defaultConfig,[e]:t},this.onConfigChange&&this.onConfigChange([{control:this.controlsIndex[e],value:t}].filter(({control:e})=>!!e)))}setUpDraw(e){}initColor(){return new K(this.config)}afterDraw(){this.emit("drawdone",null)}initDraw(e,{redrawNails:t=!0,redrawStrings:i=!0,sizeChanged:n,precision:s}={}){n&&this.resetStructure(),i&&e.resetStrings(),t&&(this.nails=null,e.resetNails()),e.clearInstructions(),e.setLineWidth(this.config.stringWidth);let r={size:e.getSize()};this.calc||(this.calc=this.getCalc(r)),this.nails||(this.nails=this.getNails(s)),this.color=this.initColor(),this.setUpDraw(r)}draw(e,t={}){return t.enableScheduler?(this.#em&&!this.#em.signal.aborted&&this.#em.abort("Redraw"),this.#em=new TaskController({priority:"background"}),scheduler.postTask(()=>this.#ev(e,t),{signal:this.#em.signal}).catch(e=>{}),()=>{this.#em?.abort("Cancelled")}):(this.#ev(e,t),()=>{})}#ev(e,{position:t,controller:i,...n}={}){this.initDraw(e,n);let{showNails:s,darkMode:r,backgroundColor:a,customBackgroundColor:o,enableBackground:l}=this.config;if(e.setBackground(!1!==l?o?a:r?Q:"#ffffff":null),s&&!1!==n.redrawNails&&this.nails.draw(e,{color:this.config.nailsColor,fontSize:this.config.nailNumbersFontSize,radius:this.config.nailRadius,renderNumbers:this.config.showNailNumbers}),this.controller=i??new Z(e,this.nails),!1!==n.redrawStrings&&this.config.showStrings)for(this.stringsIterator=this.drawStrings(this.controller),this.position=0;!this.drawNext().done&&(null==t||this.position<t););return()=>{this.#em?.abort("Cancelled")}}getLastStringNailNumbers(){return this.controller.getLastStringNailNumbers()}goto(e,t,{showInstructions:i=!0}={}){if(t!==this.position){if(this.stringsIterator&&t>this.position)for(;!this.drawNext().done&&this.position<t;);else this.draw(e,{position:t,redrawNails:!1});i&&e.renderInstructionsForLastLine()}}drawNext(){let e=this.stringsIterator.next();return e.done?this.afterDraw():this.position++,e}copy(e){let t=new this.constructor;return t.config={...this.config,overrideConfig:e},t}};const ei={linear:e=>e,inOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeOutQuint:e=>1-Math.pow(1-e,5),easeOutCubic:e=>1-Math.pow(1-e,4),fastSlowFast:e=>.5*(1-Math.cos(Math.PI*(e=Math.max(0,Math.min(1,e)))))**1.5,fastInOutSquare:e=>e<=.5?(1-Math.pow(1-2*e,2))/2:.5+Math.pow(2*e-1,2)/2,fastInOutCubic:e=>e<=.5?(1-Math.pow(1-2*e,3))/2:.5+Math.pow(2*e-1,3)/2,fastInOutQuint:e=>e<=.5?(1-Math.pow(1-2*e,5))/2:.5+Math.pow(2*e-1,5)/2,fastInOut:(e,t)=>t<=.5?(1-Math.pow(1-2*t,e))/2:.5+Math.pow(2*t-1,e)/2,fastInOutFixed(e,t,i){if(i>t&&i<1-t){let n=(1-Math.pow(1-2*t,e))/2,s=.5+Math.pow((1-t)*2-1,e)/2;return n+(i-t)*(s-n)/(1-2*t)}return i<=t?(1-Math.pow(1-2*i,e))/2:.5+Math.pow(2*i-1,e)/2},easeOutFixed(e,t,i){let n=1-t;if(i<n||0===t)return 1-Math.pow(1-i,e);let s=1-Math.pow(1-n,e);return s+(1-s)*(i-n)/t}};ei.fastInOut.requirePower=!0,ei.fastInOutFixed.requirePower=!0,ei.fastInOutFixed.requireFastArea=!0,ei.easeOutFixed.requirePower=!0,ei.easeOutFixed.requireFastArea=!0;class en{options;#ey;constructor(e){this.options=e,this.#ey=new Map}get length(){return this.#ey.size}get coordinates(){return this.#ey.values()}addNail(e,t){this.#ey.has(e)&&console.warn(`Attempting to add a nail to NailsGroup, with already existing key, [${e}].`),this.#ey.set(e,t)}addGroup(e){throw Error("Adding sub groups not implemented yet.")}getNailCoordinates(e){return this.#ey.get(e)}getNailNumbers({precision:e=1,startNumber:t=1}={}){let i=new Map,n=new Map,s=t;for(let[t,r]of this.#ey.entries()){let a=1e5*Math.round(r[0]*e)+Math.round(r[1]*e);i.has(a)?n.set(t,i.get(a)):(n.set(t,s),i.set(a,s)),s++}return n}getNailsCoordinates(){let e=this.getNailNumbers(),t=Array(e.size);return e.entries().forEach(([e,i])=>{t[i]=this.getNailCoordinates(e)}),t}*getUniqueNails(e=1){let t=new Set;for(let i of this.#ey.values()){let n=1e5*Math.round(i[0]*e)+Math.round(i[1]*e);t.has(n)||(yield i,t.add(n))}}forEach(e){this.#ey.forEach((t,i)=>e(t,i))}}class es{precision;#eb;#e_;#ew;constructor(e){this.precision=e,this.#e_=new en,this.#eb=new Map([[null,this.#e_]])}get isEmpty(){return this.#eb.values().toArray().every(e=>!e.length)}addNail(e,t){this.#e_.addNail(e,t)}addGroup(e,t){if(this.#eb.has(t))throw Error(`Nails already has a group with key [${t}]`);this.#eb.set(t,e)}getGroup(e){if(!this.#eb.has(e))throw Error(`Nails group '${e}' not found.`);return this.#eb.get(e)}#eS(){this.#ew=new Map;let e=1;for(let[t,i]of this.#eb.entries())this.#ew.set(t,i.getNailNumbers({precision:this.precision,startNumber:e})),e+=i.length}getAllNailsCoordinates(){let e=[];for(let t of this.#eb.values())e.push(t.getNailsCoordinates());return e.flat()}getNailNumber(e,t){return this.#ew||this.#eS(),this.#ew.get(t??null).get(e)}getNailCoordinates(e,t=null){let i=this.#eb.get(t)?.getNailCoordinates(e);if(!i)throw Error(`Key [${e}] not found in ${null==t?"default nails group":`nails group [${t}]`}.`);return i}draw(e,t){let i=1;for(let n of this.#eb.values())e.renderNails(this.precision||t.renderNumbers?n.getUniqueNails(this.precision):n.coordinates,{...t,...n.options,numbersStart:i}),i+=n.length}}class er{getUniqueKey;constructor(e){this.getUniqueKey=e.getUniqueKey}getAspectRatio(){let e=this.getBoundingRect();return e.width/e.height}getNails(e){let t=new es(e);return this.addNails(t),t}}function ea(e){return`${Math.round(100*e)}%`}function eo(e,t=0){return`${M((e??0)*360,t)}\xb0`}function el(e){return e[0].toLocaleUpperCase()+e.slice(1)}function ec(e,t){return Array(e).fill(null).map((e,i)=>t(i))}class eu extends er{config;from;to;distance;spaces;constructor(e){if(super(e),e.n<1)throw Error("Can't create a Line with n less than 1.");this.config=e;let{rotation:t,from:i,to:n,n:s}=e;if(t){let e=-E*t,s=this.#ex();this.from=this.#eC(i,s,e),this.to=this.#eC(n,s,e)}else this.from=e.from,this.to=e.to;this.distance=[this.to[0]-this.from[0],this.to[1]-this.from[1]],this.spaces=s-1}#ex(){let{from:e,to:t,rotationCenter:i}=this.config;if(!i||"center"===i)return[e[0]+(t[0]-e[0])/2,e[1]+(t[1]-e[1])/2];switch(i){case"from":return e;case"to":return t;default:return i}}#eC(e,t,i){let n=e[0]-t[0],s=e[1]-t[1],r=Math.hypot(n,s);if(!r)return e;let a=Math.asin(n/r)+(s<0?Math.PI:0);return[t[0]+Math.sin(a+i)*r,t[1]+Math.cos(a+i)*r]}getPoint(e){let{from:t}=this;return I(t,(t,i)=>t+this.distance[i]*e/this.spaces)}getNailIndex(e){let t=e-(this.config.drawStartIndex??0);return this.getUniqueKey?.(t)??t}addNails(e){let{drawStartIndex:t=0,drawEndIndex:i}=this.config,n=i??this.config.n;for(let i=t;i<n;i++){let n=i-t;e.addNail(this.getUniqueKey?.(n)??n,this.getPoint(i))}}getNailCount(){return(this.config.drawEndIndex?this.config.drawEndIndex+1:this.config.n)-(this.config.drawStartIndex??0)}getBoundingRect(){let{from:e,to:t}=this;return{width:Math.abs(this.distance[0]),height:Math.abs(this.distance[1]),top:Math.min(t[1],e[1]),bottom:Math.max(t[1],e[1]),left:Math.min(e[0],t[0]),right:Math.max(e[0],t[0])}}getAspectRatio(){let{width:e,height:t}=this.getBoundingRect();return e/t}}class ed extends er{config;#ek;constructor(e){super(e),this.config=e,this.#ek=this.#eE()}get center(){return this.#ek.center}get radius(){return this.#ek.radius}get interiorAngle(){return(this.config.sides-2)*Math.PI/this.config.sides}get sideSize(){return this.#ek.sideSize}get radiusNailsCount(){return this.#ek.radiusNailsCount}#eN({center:e,size:t,verticesCosSin:i}){let n=[0,0],s=[...i[0]];for(let e=1;e<this.config.sides;e++)i[e][0]>s[0]&&(n[0]=e),i[e][1]>s[1]&&(n[1]=e);let r=z(i),a=Math.min(t[0]/r.width,t[1]/r.height),o=function(e,t){let i=O(e);return{width:e[0],height:e[1],left:t[0]-i[0],right:t[0]+i[0],top:t[1]-i[1],bottom:t[1]+i[1]}}(I([r.width,r.height],e=>e*a),e);return{center:[o.right-r.right*a,o.bottom-r.bottom*a],radius:+a}}#eP(){let{fitSize:e,rotation:t=0,size:i,sides:n,center:s,margin:r=0,radius:a}=this.config,o=E*t,l=s??O(i),c=E/n,u=n%2?-Math.PI/2:n/2%2?0:Math.PI/n,d=ec(n,e=>{let t=c*e+u+o;return[Math.cos(t),Math.sin(t)]}),h=0;if(e){let e=this.#eN({center:l,size:I(i,e=>e-2*r),verticesCosSin:d});l=e.center,h=e.radius}else h=a??Math.min(...I(i,e=>e-2*r))/2;return{center:l,vertices:d.map(e=>e.map((e,t)=>l[t]+e*h)),radius:h}}#eM(e,t){return ec(this.config.sides,i=>{let n=t+i*(this.config.nailsPerSide-1);return new eu({from:e[i],to:e[(i+1)%this.config.sides],n:this.config.nailsPerSide,drawEndIndex:this.config.nailsPerSide-1,getUniqueKey:this.getUniqueKey?e=>this.getUniqueKey(n+e):e=>n+e})})}#eL(e,t,i,n){let{drawSides:s=!0,drawCenterNail:r}=this.config,a=+!!r;return ec(this.config.sides,r=>{let o=a+r*n;return new eu({from:e,to:t[r],n:i,drawStartIndex:1,drawEndIndex:s?i-1:i,getUniqueKey:this.getUniqueKey?e=>this.getUniqueKey(o+e):e=>o+e})})}#eE(){let{nailsPerSide:e,radiusNailsCountSameAsSides:t=!1,drawCenter:i,drawCenterNail:n,sides:s,drawSides:r=!0}=this.config,{center:a,vertices:o,radius:l}=this.#eP(),c=P(o[0],o[1]),u=c/(e-1),d=t?e:Math.max(2,Math.floor(l/u)),h=d-1-!!r;return{center:a,radius:l,sideSize:c,radiusNailsCount:d,vertices:o,sideLines:this.#eM(o,+!!n+(i?h*s:0)),centerLines:i?this.#eL(a,o,d,h):null}}#eR(e){let{nailsPerSide:t}=this.config;return{side:Math.floor(e/t),index:e%t}}getPoint(e){return this.getSidePoint(this.#eR(e))}getSideNailIndex(e,t){if(void 0==t){let t=this.#eR(e);return this.#ek.sideLines[t.side].getNailIndex(t.index)}return this.#ek.sideLines[e].getNailIndex(t)}getSidePoint({side:e,index:t}){return this.#ek.sideLines[e].getPoint(t)}getCenterPoint({side:e,index:t}){if(t<0)throw Error(`Can't get polygon center point for index = (${t}).`);if(e<0)throw Error(`Can't get polygon center point for side = (${t}).`);return this.#ek.centerLines[e].getPoint(t)}getCenterNailIndex(e,t){return 0===t?this.getUniqueKey?.(0)??0:this.#ek.centerLines[e].getNailIndex(t)}getBoundingRect(){return z(this.#ek.vertices)}getAspectRatio(){return $(this.getBoundingRect())}addNails(e){let{sideLines:t,centerLines:i,center:n}=this.#ek,{sides:s,drawCenter:r=!1,drawCenterNail:a=!1,drawSides:o=!0}=this.config;if(a&&e.addNail(this.getUniqueKey?.(0)??0,n),r)for(let t=0;t<s;t++)i[t].addNails(e);if(o)for(let i=0;i<s;i++)t[i].addNails(e)}getNailCount(){let e=0;return this.config.drawCenterNail&&(e+=1),this.config.drawCenter&&(e+=this.config.sides*this.#ek.centerLines[0].getNailCount()),this.config.drawSides&&(e+=this.config.sides*this.#ek.sideLines[0].getNailCount()),e}getNailsCount(){let{drawCenter:e=!1,drawCenterNail:t,drawSides:i=!0}=this.config,n=(i?this.config.nailsPerSide-1:0)+(e?this.#ek.radiusNailsCount-1-!!i:0);return this.config.sides*n+(t||e&&!1!==t?1:0)}getApothem(){return this.radius*Math.cos(Math.PI/this.config.sides)}static rotationConfig={key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1,step:.0025},displayValue:({rotation:e,sides:t})=>eo(e/(2*t),1),isStructural:!0,affectsStepCount:!1}}class eh extends er{easingFunction;config;center;xyRadius;rotationAngle=0;indexAngle;isReverse=!1;radius;arc=E;isPartialArc=!1;excludedNailIndexes;constructor(e){super(e),this.setConfig(e)}getPoint(e){let t=this.#eI(e),i=this.easingFunction(t/(this.config.n-!!this.isPartialArc))*this.arc+this.rotationAngle+(this.config.angleStart??0);return[this.center[0]+Math.sin(i)*this.xyRadius[0],this.center[1]+Math.cos(i)*this.xyRadius[1]]}#eI(e=0){let t=this.isReverse?this.config.n-1-e:e;return(t<0?this.config.n+t:t)%this.config.n}getNailKey(e){let t=this.#eI(e);return this.getUniqueKey?.(t)??t}getAspectRatio(){if(!this.config.distortion)return 1;let e=N(this.config.distortion);return e[0]/e[1]}getBoundingRect(){let{n:e,rotation:t}=this.config;return e<16?new ed({sides:e,rotation:t,size:[2*this.radius,2*this.radius],nailsPerSide:1,center:this.center}).getBoundingRect():{top:this.center[1]-this.xyRadius[1],left:this.center[0]-this.xyRadius[0],right:this.center[0]+this.xyRadius[0],bottom:this.center[1]+this.xyRadius[1],width:2*this.xyRadius[0],height:2*this.xyRadius[1]}}setConfig(e){if(!Y(e,this.config)){let{n:t,size:i,margin:n=0,rotation:s=0,center:r,radius:a,reverse:o=!1,angleStart:l,angleEnd:c}=e,u=r??O(i),d=Math.max(1,(a??Math.min(...O(i)))-n),h=[d,d];e.distortion&&(h=F(N(e.distortion).map(e=>d*e),i.map(e=>Math.max(0,e/2-n)))),this.isPartialArc=l&&c&&c>l;let p=this.isPartialArc?c-l:E,g={center:u,radius:d,xyRadius:h,indexAngle:p/(this.isPartialArc?t-1:t),rotationAngle:-E*s,isReverse:o,arc:p},f=e.displacementFunc?ei[e.displacementFunc]:ei.linear,m=[];f.requirePower&&m.push(e.displacementMag),f.requireFastArea&&m.push(e.displacementFastArea);let v=m.length?f.bind(null,...m):f;this.easingFunction=v,this.config=e,Object.assign(this,g)}}addNails(e,{filter:t}={}){for(let i=0;i<this.config.n;i++)(!t||t(i))&&e.addNail(this.getUniqueKey?.(i)??i,this.getPoint(i))}*drawRingLayer(e,{ringSize:t,nailGroup:i}){let{n:n}=this.config,s=Math.floor(t*n),r=0,a=!1;e.goto(this.getNailKey(0),i);for(let t=0;t<n;t++)r=a?t:r+s,yield e.stringTo(this.getNailKey(r),i),t<n-1&&(r++,yield e.stringTo(this.getNailKey(r),i)),a=!a}getRingStepCount(){return 2*this.config.n-1}getNailCount(){return this.config.n}static rotationConfig={key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1+1/360,step:1/360,snap:"0.25, 0.5, 0.75"},displayValue:({rotation:e})=>eo(e),isStructural:!0,affectsStepCount:!1};static nailsConfig={key:"n",label:"Number of nails",defaultValue:144,type:"range",attr:{min:3,max:300,step:1},isStructural:!0};static displacementConfig={key:"displacement",label:"Displacement",type:"group",children:[{key:"displacementFunc",label:"Displacement function",defaultValue:"linear",type:"select",options:Object.keys(ei),isStructural:!0,affectsStepCount:!1},{key:"displacementMag",label:"Displacement magnitude",defaultValue:3,type:"range",attr:{min:0,max:10,step:.1},show:({displacementFunc:e})=>ei[e].requirePower,isStructural:!0,affectsStepCount:!1},{key:"displacementFastArea",label:"Displacement fast area",defaultValue:.4,type:"range",attr:{min:0,max:.5,step:.01},show:({displacementFunc:e})=>ei[e].requireFastArea,isStructural:!0,affectsStepCount:!1}]};static distortionConfig={key:"distortion",label:"Distortion",defaultValue:0,type:"range",attr:{min:-.99,max:.99,step:.01,snap:"0"},isStructural:!0,affectsStepCount:!1}}const ep=K.getConfig({defaults:{isMultiColor:!0,colorCount:7,color:"#ffbb29",multicolorRange:21,multicolorStart:32,multicolorByLightness:!0,minLightness:36,maxLightness:98}});class eg extends et{static type="spiral";id="spiral";name="Spiral";controls=[{...eh.nailsConfig,defaultValue:200},{key:"repetition",label:"Repetition",defaultValue:5,type:"range",attr:{min:1,max:20,step:1},affectsNails:!1,isStructural:!0},{key:"innerLength",label:"Spiral thickness",defaultValue:.5,type:"range",attr:{min:({n:e})=>1/e,max:1,step:({n:e})=>1/e},displayValue:({n:e,innerLength:t})=>Math.round(e*t),affectsNails:!1},{...H(eh.rotationConfig,"snap"),defaultValue:.75},eh.distortionConfig,ep];colorMap;getCalc({size:e}){let{n:t,rotation:i,margin:n,repetition:s,distortion:r}=this.config;return{circle:new eh({size:e,n:t,margin:n,rotation:i,distortion:r}),realRepetition:2*s-1}}setUpDraw(){this.color.config.colorCount&&(this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:this.color.config.colorCount}))}getAspectRatio(e){let{circle:t}=this.getCalc(e);return t.getAspectRatio()}*drawSpiral(e,{shift:t=0,color:i="#ffffff"}={}){let{innerLength:n,n:s}=this.config,r=Math.round(n*s),a=0;e.startLayer({color:i}),e.goto(t);let o=t,l=!1;for(let t=0;r>0;t++)this.colorMap&&this.colorMap.has(t)&&e.startLayer({color:this.colorMap.get(t)}),o=l?o-r+1:o+r,a===this.calc.realRepetition?(r--,a=0,o++):a++,e.stringTo(o%s),yield,l=!l}*drawStrings(e){yield*this.drawSpiral(e,{color:this.color.getColor(0)})}getStepCount(){let{innerLength:e,repetition:t,n:i}=this.config;return Math.round(2*e*i*t)}getNails(e){return this.calc.circle.getNails(e)}thumbnailConfig=({n:e})=>({n:Math.min(e,60)})}class ef extends et{static type="spirals";name="Spirals";id="spirals";link="https://www.etsy.com/il-en/listing/974865185/3d-string-art-spiral-mandala-wall?ref=shop_home_active_10&frs=1";controls=[{key:"nSpirals",label:"Number of spirals",defaultValue:3,type:"range",attr:{min:2,max:20,step:1},isStructural:!0},{key:"nailsPerSpiral",label:"Nails per spiral",type:"range",defaultValue:80,attr:{min:3,max:300,step:1},isStructural:!0},{key:"angle",label:"Angle",type:"range",defaultValue:.52,attr:{min:0,max:2,step:.026},displayValue:({angle:e})=>eo(e),isStructural:!0,affectsStepCount:!1},{key:"radiusEasing",label:"Radius easing",defaultValue:1.8,type:"range",attr:{min:1,max:10,step:.1},isStructural:!0,affectsStepCount:!1},{key:"angleEasing",label:"Angle easing",defaultValue:1.3,type:"range",attr:{min:1,max:10,step:.1},isStructural:!0,affectsStepCount:!1},{...eh.rotationConfig,defaultValue:65/360},K.getConfig({defaults:{isMultiColor:!0,colorCount:4,color:"#00d5ff",multicolorRange:1,multicolorStart:190,multicolorByLightness:!0,minLightness:50,maxLightness:88,reverseColors:!0}})];colorMap;getCalc({size:e}){let{nSpirals:t,rotation:i,margin:n,angle:s}=this.config,r=Math.min(...e)/2-n;return{spiralRotations:ec(t,e=>e*E/t),rotationAngle:-E*i,angle:s*E,center:O(e),radius:r}}setUpDraw(){this.colorMap=this.color.getColorMap({stepCount:this.getStepCount()})}getAspectRatio(){return 1}*generatePoints(){let{nSpirals:e,nailsPerSpiral:t}=this.config;for(let i=1;i<t;i++)for(let t=0;t<e;t++)yield[t,i]}getPoint(e,t){let{center:i,radius:n,angle:s}=this.calc,{nailsPerSpiral:r,radiusEasing:a,angleEasing:o}=this.config,l=t/(r-1),c=this.calc.rotationAngle+ei.easeOutFixed(o,0,l)*s+this.calc.spiralRotations[e],u=ei.easeOutFixed(a,0,l)*n;return[i[0]+u*Math.sin(c),i[1]+u*Math.cos(c)]}*drawStrings(e){let t=this.generatePoints(),i=0;for(let n of(e.startLayer({color:this.color.getColor(0)}),e.goto(0),t)){if(this.colorMap){let t=this.colorMap.get(i);t&&e.startLayer({color:t})}e.stringTo(i),yield,i++}}getStepCount(){let{nSpirals:e,nailsPerSpiral:t}=this.config;return(t-1)*e}getNails(e){let t=this.generatePoints(),i=new es(e),n=0;for(let[e,s]of t)i.addNail(n,this.getPoint(e,s)),n++;return i}getNailCount(){let{nSpirals:e,nailsPerSpiral:t}=this.config;return e*(t-1)}thumbnailConfig=({nailsPerSpiral:e})=>({nailsPerSpiral:Math.min(30,e)})}class em extends et{static type="mandala";name="Mandala";id="mandala";link="https://www.youtube.com/watch?v=qhbuKbxJsk8";linkText="Learn";controls=[{key:"n",label:"Number of nails",defaultValue:180,type:"range",attr:{min:3,max:400,step:1},isStructural:!0},{key:"base",label:"Multiplication",defaultValue:2,type:"range",attr:{min:2,max:99,step:1},affectsNails:!1},{key:"layers",label:"Layers",defaultValue:7,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},eh.rotationConfig,eh.distortionConfig,K.getConfig({defaults:{isMultiColor:!0,multicolorRange:165,multicolorStart:256,color:"#ff4d00"},exclude:["colorCount"]})];get n(){return this.calc.n}getCalc({size:e}){let{n:t,layers:i,layerFill:n,rotation:s,distortion:r,margin:a,reverse:o,base:l}=this.config,c=t-t%i;return{n:c,stringsPerLayer:n?Math.floor(c*n):c,layerShift:Math.floor(c/i/(l%2?2:1)),circle:new eh({size:e,n:c,margin:a,rotation:s,distortion:r,reverse:o})}}initColor(){let{layers:e}=this.config;return new K({...this.config,colorCount:e})}getAspectRatio(e){return this.getCalc(e).circle.getAspectRatio()}*drawMultiplicationLayer(e,t){let{reverse:i,base:n}=this.config,{n:s,layerShift:r,stringsPerLayer:a,circle:o}=this.calc,l=r*t*(i?1:-1),c=this.color.getColor(t);e.startLayer({color:c,name:String(t)}),e.goto(o.getNailKey(l));for(let t=1;t<a;t+=2){let i=t*n%s+l;for(let s of[t+l,i,i+n,t+l+1])e.stringTo(o.getNailKey(s)),yield}}*drawStrings(e){let{layers:t}=this.config;for(let i=0;i<t;i++)yield*this.drawMultiplicationLayer(e,i)}getNails(e){return this.calc.circle.getNails(e)}getStepCount(e){let{layers:t,layerFill:i}=this.config,{n:n}=this.getCalc(e);return 2*((i?Math.floor(n*i):n)-1)*(t??1)}getNailCount(){let{n:e,layers:t}=this.config;return e-e%t}thumbnailConfig=({n:e})=>({n:Math.min(e,70)})}class ev extends em{static type="wave";id="wave";name="Wave";link="https://www.etsy.com/il-en/listing/943140543/personalized-gift-string-art-mandala?ref=sim_rv-5&pro=1";controls=[{...eh.nailsConfig,defaultValue:200},{key:"layerFill",label:"Layer fill",defaultValue:.5,type:"range",attr:{min:({n:e})=>1/e,max:1,step:({n:e})=>1/e},displayValue:({layerFill:e})=>ea(e),affectsNails:!1,isStructural:!0},H(eh.rotationConfig,"snap"),eh.distortionConfig,{key:"layers",label:"Layers",defaultValue:11,type:"range",attr:{min:1,max:20,step:1}},{key:"layerSpread",label:"Layer spread",defaultValue:.075,type:"range",attr:{min:0,max:1,step:({n:e})=>1/e},displayValue:({layerSpread:e,n:t})=>Math.round(e*t),affectsNails:!1,isStructural:!0},{key:"reverse",label:"Reverse",defaultValue:!0,type:"checkbox",isStructural:!0},K.getConfig({defaults:{isMultiColor:!0,multicolorRange:196,multicolorStart:273,color:"#ffffff",multicolorByLightness:!0,minLightness:10,maxLightness:90},exclude:["colorCount"]})];defaultValues={base:2,rotation:176/360};getCalc(e){let{n:t,layerSpread:i}=this.config;return{...super.getCalc(e),layerShift:Math.round(t*i)}}*drawStrings(e){let{layers:t}=this.config;for(let i=0;i<t;i++)yield*this.drawMultiplicationLayer(e,i)}}class ey extends et{static type="eye";name="Vortex";id="eye";link="https://www.etsy.com/listing/489853161/rose-of-space-string-art-sacred-geometry?ga_order=most_relevant&ga_search_type=all&ga_view_type=gallery&ga_search_query=string+art&ref=sr_gallery_1&epik=dj0yJnU9WXNpM1BDTnNkLVBtcWdCa3AxN1J5QUZRY1FlbkJ5Z18mcD0wJm49ZXdJb2JXZmVpNVVwN1NKQ3lXMy10ZyZ0PUFBQUFBR0ZuUzZv";controls=[{key:"n",label:"Number of nails per side",defaultValue:82,type:"range",attr:{min:3,max:200,step:1},isStructural:!0},{key:"sides",label:"Sides",defaultValue:4,type:"range",attr:{min:3,max:10,step:1},isStructural:!0},{key:"layers",label:"Layers",defaultValue:13,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},{key:"angle",label:"Layer angle",defaultValue:.65,displayValue:({angle:e,sides:t})=>`${Math.round(180*e/t)}\xb0`,type:"range",attr:{min:.01,max:1,step:.01},isStructural:!0,show:({layers:e})=>e>1},K.getConfig({defaults:{isMultiColor:!0,color:"#ffffff",multicolorRange:107,multicolorStart:226,multicolorByLightness:!1,minLightness:40,maxLightness:50,colorCount:2,repeatColors:!0},customControls:[{key:"colorPerLayer",label:"Color per layer",defaultValue:!1,type:"checkbox",show:({isMultiColor:e})=>e,affectsNails:!1}]})];defaultValues={nailsColor:"#000000"};getCalc({size:e}){let{n:t,angle:i,layers:n,margin:s=0,sides:r}=this.config,a=O(e),o=t%2?t:t+1,l=new ed({size:e,sides:r,nailsPerSide:o,center:a,fitSize:!0,margin:s}),c=l.sideSize/(o-1),u=Math.max(1,Math.floor(i*o/2)),d=Math.PI/r,h=[{polygon:l,layerAngle:0,layerSize:l.sideSize,layerSideNailCount:o,layerSpaceCount:o-1,layerIndexStart:0,nailSpacing:c}],p=l.getNailsCount();for(let e=1;e<n;e++){let t=h[e-1],n=t?Math.max(1,Math.floor(i*t.layerSideNailCount/2)):u;if(!t||t.layerSpaceCount<=3||t.layerSpaceCount<=n)break;let s=Math.PI/r-Math.atan(t.nailSpacing*(t.layerSpaceCount/2-n)/t.polygon.getApothem());if(s<=0)break;let a=t.polygon.radius*Math.cos(d)/Math.cos(s-d),o=2*a*Math.sin(Math.PI/r),l=Math.ceil(o/c);if(1===i&&!(l%2)&&l--,l<3)break;let g=p,f=new ed({sides:r,nailsPerSide:l,rotation:s/E+(t?.polygon.config.rotation??0),center:h[0].polygon.center,radius:a,getUniqueKey:g?e=>g+e:void 0});p+=f.getNailsCount();let m=l-1;h.push({layerAngle:s*e,layerSize:o,layerSideNailCount:l,layerSpaceCount:m,polygon:f,nailSpacing:o/m,layerIndexStart:g})}let g=h.length;return{nailSpacing:c,layers:h,center:a,totalNailsCount:p,layersCount:g}}getAspectRatio(){return 1}*drawSide(e,{side:t,color:i="#ffffff",layer:n}){let s=(t+1)%this.config.sides;e.startLayer({color:i});for(let i=0;i<n.layerSpaceCount;i++)e.goto(n.polygon.getSideNailIndex(t,i)),e.stringTo(n.polygon.getSideNailIndex(s,i)),yield}*#eT(e,t){let{colorPerLayer:i,sides:n}=this.config;for(let s=0;s<n;s++)yield*this.drawSide(e,{color:this.color.getColor(i?t:s),side:s,layer:this.calc.layers[t]})}*drawStrings(e){for(let t=this.calc.layers.length-1;t>=0;t--)yield*this.#eT(e,t)}getStepCount(e){return(this.calc??this.getCalc(e)).totalNailsCount}getNails(e){let t=new es(e);for(let e=0;e<this.calc.layersCount;e++){let{polygon:i}=this.calc.layers[e];i.addNails(t)}return t}thumbnailConfig=({n:e,layers:t})=>({n:Math.min(e,25),layers:Math.min(t,7)})}class eb extends er{config;center;calc;constructor(e){super(e),this.setConfig(e)}static getCalc({radius:e,sides:t,sideNails:i,rotation:n,centerRadius:s=0,maxCurveSize:r=1,sidesCenterRadiusShift:a}){let o=e*s,l=2*Math.PI/t,c=n?-(2*Math.PI)*n/t:0;return{sideAngle:l,nailSpacing:(e-o)/(i-1),centerRadius:o,linesPerRound:t%2?2*t:t,sidesConnectionCount:Math.floor(Math.min(1,r)*i),sideSize:e-o,sides:Array(t).fill(null).map((e,t)=>{let i=t*l+c;return{sinSideAngle:Math.sin(i),cosSideAngle:Math.cos(i)}}),sidesCenterRadius:a?a.map(e=>o*e):null,hasCenterNail:!o,sidesNailCount:o?i:i-1}}getPoint(e){let t=Math.floor(e/this.config.sideNails),i=e%this.config.sideNails;return this.getSidePoint(t,i)}getSidePoint(e=0,t=0){let i=this.calc.centerRadius+t*this.calc.nailSpacing-(this.calc.sidesCenterRadius?.[e]??0),{sinSideAngle:n,cosSideAngle:s}=this.calc.sides[e];return[this.center[0]+n*i,this.center[1]+s*i]}getSideNailKey(e,t){if(0===t&&this.calc.hasCenterNail)return this.config.getUniqueKey?.(0)??0;let i=e*this.calc.sidesNailCount+t;return this.config.getUniqueKey?.(i)??i}setConfig(e){if(Y(e,this.config,["radius","sides","sideNails","rotation","center","size","centerRadius","maxCurveSize"]))return;if(!e.center&&!e.size)throw Error("StarShape requires a config value for either center or size.");let t=e.center??O(e.size);this.config=e,this.center=t,this.calc=eb.getCalc(e)}addNails(e,{reverseOrder:t}={}){let{sides:i,sideNails:n}=this.config,s=0;this.calc.hasCenterNail&&(e.addNail(this.getUniqueKey?.(s)??s,this.getSidePoint(0,0)),s++);for(let r=0;r<i;r++)for(let i=+!!this.calc.hasCenterNail;i<n;i++){let a=t?n-i:i;e.addNail(this.getUniqueKey?.(s)??s,this.getSidePoint(r,a)),s++}}getNailCount(){let{sides:e,sideNails:t,centerRadius:i}=this.config;return e*t-(null==i||0===i?e-1:0)}*drawStar(e,{size:t}={}){let{sideNails:i,sides:n}=this.config,{sidesConnectionCount:s,linesPerRound:r}=this.calc,a=t?Math.max(1,Math.min(Math.floor(t),i)):i,o=Math.max(0,a-s),l=!1,c=n%2?Math.ceil(Math.min(a,s)/2):a-o,u=o;e.goto(this.getSideNailKey(0,o));for(let t=0;t<c;t++){let i=t===c-1,s=0;for(let c=0;c<r&&(s=(s+1)%n,u=(l=!l)?a-t-1:t+o,yield e.stringTo(this.getSideNailKey(s,u)),!i||c!==n-1||!(n%2)||!(a%2));c++);i||(u=l?u-1:u+1,yield e.stringTo(this.getSideNailKey(0,u)))}}getStepCount(e){return eb.getStepCount(this.config,{size:e})}static getStepCount({sides:e,sideNails:t,maxCurveSize:i=1},{size:n}={}){let s=Math.floor(Math.min(1,i)*t),r=n?Math.min(Math.floor(n),t):t,a=Math.max(0,r-s);return(e%2?Math.ceil(Math.min(r,s)/2):r-a)*((e%2?2*e:e)+1)-(e%2&&r%2?e:0)-1}getBoundingRect(){let{radius:e,sides:t,rotation:i,sideNails:n}=this.config;return new ed({size:[2*e,2*e],sides:t,nailsPerSide:n,margin:0,rotation:i}).getBoundingRect()}getAspectRatio(){return $(this.getBoundingRect())}static nailsConfig={key:"sideNails",label:"Nails per side",defaultValue:40,type:"range",attr:{min:1,max:200,step:1},isStructural:!0};static sidesConfig={key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:40,step:1},isStructural:!0};static maxCurveSize={key:"maxCurveSize",label:"Max curve size",description:"The maximum number of connections used to create a curve between two sides.",defaultValue:1,type:"range",displayValue:({maxCurveSize:e,sideNails:t})=>Math.floor(e*t),attr:{min:0,max:1,step:({sideNails:e})=>1/e},isStructural:!0};static centerRadiusConfig={key:"centerRadius",label:"Center radius",defaultValue:0,type:"range",attr:{min:0,max:({sideNails:e})=>(e-1)/e,step:.01},displayValue:({centerRadius:e})=>ea(e),isStructural:!0};static rotationConfig={key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01,snap:"0.5"},displayValue:({rotation:e,sides:t})=>eo(e/t),isStructural:!0,affectsStepCount:!1};static StarConfig=[eb.nailsConfig,eb.sidesConfig,eb.centerRadiusConfig,eb.maxCurveSize,eb.rotationConfig]}class e_ extends et{static type="star";name="Star";id="star";link="https://www.etsy.com/listing/557818258/string-art-meditation-geometric-yoga?epik=dj0yJnU9Mm1hYmZKdks1eTc3bVY2TkVhS2p2Qlg0N2dyVWJxaTEmcD0wJm49MGlWSXE1SVJ2Vm0xZ0xtaGhITDBWQSZ0PUFBQUFBR0Zwd2lj";controls=[{key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:20,step:1},isStructural:!0},{key:"sideNails",label:"Nails per side",defaultValue:40,type:"range",attr:{min:2,max:200,step:1},isStructural:!0},eb.centerRadiusConfig,{key:"ringSize",label:"Outer ring size",defaultValue:.1,type:"range",attr:{min:0,max:.5,step:({sideNails:e,sides:t})=>1/(e*t)},displayValue:({sideNails:e,sides:t,ringSize:i})=>Math.floor(i*e*t),affectsNails:!1},H(eh.rotationConfig,"snap"),eh.distortionConfig,{key:"renderStar",label:"Show star",type:"checkbox",defaultValue:!0,affectsNails:!1,isStructural:!0},{key:"colorGroup",label:"Color",type:"group",children:[{key:"isSingleColor",label:"Is single color",type:"checkbox",defaultValue:!1,affectsNails:!1,affectsStepCount:!1},{key:"singleColor",label:"Color",defaultValue:"#2ec0ff",type:"color",affectsNails:!1,affectsStepCount:!1,show:({isSingleColor:e})=>e},{key:"innerColor",label:"Star color",defaultValue:"#2ec0ff",type:"color",affectsNails:!1,affectsStepCount:!1,show:({isSingleColor:e,renderStar:t})=>!e&&t},{key:"outerColor",label:"Outter color",defaultValue:"#2a82c6",type:"color",affectsNails:!1,affectsStepCount:!1,show:({isSingleColor:e})=>!e},{key:"ringColor",label:"Ring color",defaultValue:"#2ec0ff",type:"color",affectsNails:!1,affectsStepCount:!1,show:({isSingleColor:e})=>!e}]}];getCalc({size:e}){let{sides:t,rotation:i,distortion:n,sideNails:s,margin:r=0}=this.config,a={size:e,n:t*(s-1),margin:r,rotation:i?i/t:0,distortion:n},o=new eh(a),l={...this.config,radius:o.radius,size:e,getUniqueKey:e=>a.n+e};return{circle:o,star:new eb(l)}}getAspectRatio(e){let{circle:t,star:i}=this.getCalc(e),n=t.getBoundingRect(),s=i.getBoundingRect();return Math.max(n.width,s.width)/Math.max(n.height,s.height)}getArcPoint({side:e,sideIndex:t}){return this.calc.circle.getPoint(e*(this.config.sideNails-1)+t)}*drawCircleLayer(e){let{sides:t,sideNails:i,isSingleColor:n}=this.config,{star:s}=this.calc;n||e.startLayer({color:this.config.isSingleColor?null:this.config.outerColor,name:"Circle backdrop"});let r=!1,a=!1,o=t%2?Math.ceil(i/2):i-1,l=0,c=t%2?4*t:2*t;e.goto(s.getSideNailKey(0,0));for(let n=0;n<o;n++){let u=n===o-1,d=t%2&&(0===n||u&&i%2)?c-2*t:c;for(let o=0;o<d;o++){let o={side:l,sideIndex:r?i-n-1:n};yield e.stringTo(a?s.getSideNailKey(o.side,o.sideIndex):o.side*(i-1)+o.sideIndex),(a=!a)&&(l=(l+1)%t,r=!r)}u||(yield e.stringTo(s.getSideNailKey(0,n+1)),a=!1,r=!1)}}*drawStrings(e){let{ringSize:t,ringColor:i,isSingleColor:n,singleColor:s,renderStar:r=!0,innerColor:a}=this.config;n&&e.startLayer({color:s}),yield*this.drawCircleLayer(e),0!==t&&(e.startLayer({name:"Ring",color:n?null:i}),yield*this.calc.circle.drawRingLayer(e,{ringSize:t})),r&&(e.startLayer({color:n?null:a,name:"Star"}),yield*this.calc.star.drawStar(e))}getNails(e){let t=new es(e);return this.calc.circle.addNails(t),this.calc.star.addNails(t),t}getStepCount(e){let{ringSize:t,sides:i,sideNails:n,renderStar:s}=this.config,r=this.getCalc(e),a=t?r.circle.getRingStepCount():0;return(i%2?Math.ceil(n/2):n-1)*((i%2?4*i:2*i)+1)-(i%2?2*i+(n%2?2*i:0):0)-1+a+(s?eb.getStepCount(this.config):0)}getNailCount(){let{sides:e,sideNails:t,centerRadius:i}=this.config;return e*(t-1)+e*(t-1)-(i?0:e-1)}thumbnailConfig=({sideNails:e})=>({sideNails:Math.min(e,18)});testStepCountConfig=[{sides:3,sideNails:4,ringSize:0,renderStar:!1},{sides:3,sideNails:11,ringSize:0,renderStar:!1},{sides:4,sideNails:11,ringSize:0,renderStar:!1},{sides:4,sideNails:10,ringSize:0,renderStar:!1}]}const ew=[{start:.25,end:1,color:"#a94fb0"},{start:.125,end:.888,color:"#ec6ad0"},{start:0,end:.826,color:"#f08ad5",reverse:!0}];class eS extends et{static type="assymetry";name="Assymetry";id="assymetry";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[{...eh.nailsConfig,label:"Circle number of nails"},eh.rotationConfig,eh.distortionConfig,{key:"layers",label:"Layers",type:"group",children:ew.map(({start:e,end:t,color:i,reverse:n},s)=>{let r=s+1;return{key:`layer${r}`,label:`Layer ${r}`,type:"group",children:[{key:`show${r}`,label:"Enable",defaultValue:!0,type:"checkbox",isStructural:!0},{key:`start${r}`,label:"Star position",defaultValue:e,type:"range",attr:{min:0,max:.5,step:({n:e})=>1/e},displayValue:e=>Math.round(e.n*e[`start${r}`]),show:e=>e[`show${r}`],isStructural:!0},{key:`end${r}`,label:"End Position",defaultValue:t,type:"range",attr:{min:0,max:1,step:({n:e})=>1/e},displayValue:e=>Math.round(e.n*e[`end${r}`]),show:e=>e[`show${r}`],affectsNails:!1,isStructural:!0},{key:`color${r}`,label:"Color",defaultValue:i,type:"color",show:e=>e[`show${r}`],affectsNails:!1,isStructural:!0},{key:`reverse${r}`,label:"Reverse",defaultValue:!0===n,type:"checkbox",show:e=>e[`show${r}`],affectsNails:!1,isStructural:!0}]}})}];getAspectRatio(){return(this.calc??this.getCalc({size:[100,100]})).circle.getAspectRatio()}getCalc({size:e}){let{rotation:t,n:i,margin:n=0,distortion:s}=this.config,r=Math.round(i/E),a=O(e),o=new eh({size:e,center:a,n:i,margin:n,rotation:t-.25,distortion:s,getUniqueKey:e=>r+e}),l=o.radius/r,c=o.getPoint(0),u=r+i,d=u+r,h=ec(3,e=>g.call(this,e+1)).filter(({enable:e})=>e),p=new eu({from:a,to:o.getPoint(0),n:r+1,drawEndIndex:r});return{circle:o,line:p,lineSpacing:l,lineNailCount:r,firstCirclePoint:c,layers:h,totalNailCount:u,totalIndexCount:d};function g(e){let t=Math.round(i*this.config["start"+e])+r,n=Math.round(this.config["end"+e]*d)-t;return n===d-t-1&&n++,{start:t,endIndex:n,color:this.config["color"+e],enable:this.config["show"+e],isReverse:this.config["reverse"+e]}}}*drawCircle(e,{endIndex:t,color:i,isReverse:n,start:s}){let r,{lineNailCount:a,totalNailCount:o}=this.calc,l=o-1,c=!1;e.startLayer({color:i});let u=this,d=n?-1:1;e.goto(p(h(0)));for(let i=0;i<=t;i++)i&&(e.stringTo(p(r+d)),yield),r=h(c?i:i+s),e.stringTo(p(r)),yield,c=!c;function h(e){return n?u.calc.totalIndexCount-e:e}function p(e){let t=e-l;return t>0?a-t+1:e%o}}*drawStrings(e){for(let t of this.calc.layers)yield*this.drawCircle(e,t)}getNails(e){let t=new es(e);return this.calc.line.addNails(t),this.calc.circle.addNails(t),t}getStepCount(e){let{layers:t}=this.getCalc(e);return t.reduce((e,t)=>e+2*t.endIndex+1,0)}getNailCount(e){let t=this.calc??this.getCalc({size:e});return t.circle.config.n+t.lineNailCount}thumbnailConfig=({n:e})=>({n:Math.min(e,50)})}const ex={label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1+1/360,step:1/360},isStructural:!0,affectsStepCount:!1};class eC extends et{static type="freestyle";name="Freestyle";id="freestyle";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[{key:"color",label:"Color",defaultValue:"#ec6ad0",type:"color",affectsNails:!1,affectsStepCount:!1},{key:"layers",label:"Layers",type:"group",children:ec(3,e=>(function(e){let t=t=>t[`show${e}`];return{key:`layer${e}`,label:`Layer ${e}`,type:"group",children:[{key:`show${e}`,label:"Enable",defaultValue:!0,type:"checkbox",isStructural:!0},{key:`n${e}`,label:"Nails count",type:"range",attr:{min:1,max:300,step:1},show:t,isStructural:!0},{key:`radius${e}`,label:"Radius",type:"range",attr:{min:.01,max:1,step:.01},show:t,isStructural:!0},{key:`x${e}`,label:"Position X",type:"range",attr:{min:0,max:1,step:.01},show:t,isStructural:!0},{key:`y${e}`,label:"Position Y",type:"range",attr:{min:0,max:1,step:.01},show:t,isStructural:!0},{...ex,key:`rotation${e}`,displayValue:({rotation1:e})=>eo(e),show:t},{key:`reverse${e}`,label:"Reverse",type:"checkbox",isStructural:!0,show:t}]}})(e+1))}];defaultValues={n1:80,n2:80,n3:80,radius1:.5,radius2:.5,radius3:.5,x1:.5,x2:0,x3:1,y1:0,y2:1,y3:1,reverse1:!1,reverse2:!1,reverse3:!1};getAspectRatio({size:e}){return e[0]/e[1]}getCalc({size:e}){let{margin:t=0}=this.config,i=Math.min(...e.map(e=>e-2*t))/2,n=0,s=ec(3,s=>{let r=e=>this.config[e+(s+1)];if(!r("show"))return null;let a={isReverse:r("reverse"),position:[r("x"),r("y")],radius:i*r("radius"),rotation:r("rotation")},o=n,l=new eh({radius:a.radius,size:e,center:a.position.map((i,n)=>a.radius+t+(e[n]-(a.radius+t)*2)*i),n:r("n"),rotation:a.rotation,reverse:a.isReverse,getUniqueKey:s?e=>o+e:void 0});return n+=l.config.n,{circle:l,...a}}).filter(Boolean);return{layers:s,roundsCount:Math.max(...s.map(e=>e.circle.config.n))}}getPoint(e,t){return e.circle.getPoint(t)}*drawStrings(e){let{color:t}=this.config,i=this.calc.layers.length;e.startLayer({color:t}),e.goto(0);for(let t=0;t<this.calc.roundsCount;t++)for(let n=0;n<this.calc.layers.length;n++){let s=(n+1)%i;e.stringTo(this.calc.layers[s].circle.getNailKey(t)),yield}}getNails(e){let t=new es(e);return this.calc.layers.forEach(({circle:e},i)=>e.addNails(t)),t}getStepCount(e){let{layers:t,roundsCount:i}=this.getCalc(e);return t.length*i}getNailsCount(){let{n1:e,n2:t,n3:i}=this.config;return e+t+i}thumbnailConfig=({n1:e,n2:t,n3:i})=>({n1:Math.min(e,40),n2:Math.min(t,40),n3:Math.min(i,40)})}const ek=K.getConfig({defaults:{isMultiColor:!0,color:"#ff0000",multicolorRange:1,multicolorStart:0,multicolorByLightness:!0,minLightness:20,maxLightness:50},exclude:["colorCount"]});class eE extends et{static type="polygon";name="Polygon";id="polygon";controls=[{key:"sides",label:"Sides",defaultValue:5,type:"range",attr:{min:3,max:10,step:1},isStructural:!0},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:2,max:100,step:1},isStructural:!0},{key:"bezier",label:"Bezier",defaultValue:2,type:"range",attr:{min:1,max:4,step:1},show:({sides:e})=>e>4,affectsNails:!1,affectsStepCount:!1},ed.rotationConfig,ek];defaultValues={nailsColor:"#5c5c5c",nailRadius:1};colorMap;getCalc({size:e}){let{n:t,rotation:i,sides:n,margin:s}=this.config;return{polygon:new ed({sides:n,rotation:i/(2*n),margin:s,size:e,nailsPerSide:t,fitSize:!0})}}initColor(){let{sides:e,isMultiColor:t}=this.config;return new K({...this.config,isMultiColor:t,colorCount:e})}setUpDraw(e){super.setUpDraw(e),this.config.isMultiColor?this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:this.color.config.colorCount}):this.colorMap=null}getAspectRatio(e){let{polygon:t}=this.getCalc(e);return t.getAspectRatio()}*drawStrings(e){let{sides:t,bezier:i,n:n}=this.config,s=Math.min(i,Math.ceil(t/2)-1),r=this.calc.polygon;e.goto(this.calc.polygon.getSideNailIndex(0,0));for(let i=0;i<t;i++){let a=(i+s)%t;e.startLayer({color:this.color.getColor(i)});for(let s=0;s<n-1;s++)s&&(yield e.stringTo(r.getSideNailIndex(i,s))),yield e.stringTo(r.getSideNailIndex(a,s)),s<n-2&&(s++,yield e.stringTo(r.getSideNailIndex(a,s)),yield e.stringTo(r.getSideNailIndex(i,s))),s===n-2&&(n%2||(yield e.stringTo(r.getSideNailIndex((a+1)%t,0))),yield e.stringTo(r.getSideNailIndex(a,0)))}yield e.stringTo(this.calc.polygon.getSideNailIndex(1,0))}getStepCount(){let{sides:e,n:t}=this.config;return e*(2*t-1-(t%2?1:0))+1}getNails(e){return this.calc.polygon.getNails(e)}testStepCountConfig=[{sides:4,n:10},{sides:4,n:11},{sides:3,n:11},{sides:3,n:10},{sides:5,n:2},{sides:3,n:2}];thumbnailConfig=({n:e})=>({n:Math.min(e,20)})}const eN=K.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:132,multicolorStart:53,multicolorByLightness:!1,minLightness:30,maxLightness:70},exclude:["colorCount"]});class eP extends et{static type="flower";name="Flower";id="flower";link="https://www.sqrt.ch/Buch/fadenmodell4_100.svg";controls=[{key:"sides",label:"Sides",defaultValue:4,type:"range",attr:{min:3,max:20,step:1},isStructural:!0},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:2,max:100,step:1},isStructural:!0},{key:"layers",label:"Layers",defaultValue:2,type:"range",attr:{min:1,max:10,step:1},isStructural:!0},ed.rotationConfig,eN];defaultValues={nailsColor:"#29f1ff",nailRadius:1,stringWidth:.5};getCalc({size:e}){let{n:t,rotation:i,sides:n,layers:s,margin:r}=this.config,a=1/(n*s),o=0;return{polygons:ec(s,s=>{let l=o,c=new ed({sides:n,rotation:i/n+s*a,margin:r,size:e,nailsPerSide:t,radiusNailsCountSameAsSides:!0,drawCenter:!0,drawCenterNail:0===s,getUniqueKey:0===s?void 0:e=>l+e});return o+=c.getNailsCount(),c})}}initColor(){let{layers:e,isMultiColor:t}=this.config;return new K({...this.config,isMultiColor:t,colorCount:e})}getAspectRatio(){return $(D(...(this.calc??this.getCalc({size:[100,100]})).polygons.map(e=>e.getBoundingRect())))}*drawStrings(e){let{sides:t,layers:i,n:n}=this.config;for(let s=0;s<i;s++){e.startLayer({color:this.color.getColor(s),name:String(s)});let i=this.calc.polygons[s],r=!1;e.goto(0);for(let s=0;s<t;s++){let a=0===s?t-1:s-1,o=(s+1)%t;e.stringTo(i.getSideNailIndex(a,0)),yield,e.stringTo(i.getSideNailIndex(s,0)),yield,e.stringTo(i.getSideNailIndex(o,0)),yield;for(let t=1;t<n-1;t++)e.stringTo(i.getSideNailIndex(r?a:s,r?t:n-t-1)),yield,e.stringTo(i.getCenterNailIndex(s,n-t-1)),yield,e.stringTo(i.getSideNailIndex(r?s:a,r?n-t-1:t)),yield,r=!r}}}getNails(e){let t=new es(e);return this.calc.polygons.forEach((e,i)=>{e.addNails(t)}),t}getStepCount(){let{sides:e,n:t,layers:i}=this.config;return i*e*(3+3*(t-2))}getNailCount(e){let{layers:t}=this.config;return t*((this.calc??this.getCalc({size:e})).polygons[0].getNailsCount()-1)+1}thumbnailConfig=({n:e})=>({n:Math.min(e,20)});testStepCountConfig=[{sides:3,n:2,layers:1}]}const eM=K.getConfig({defaults:{isMultiColor:!0,color:"#ffffff",multicolorRange:102,multicolorStart:239,multicolorByLightness:!1,minLightness:30,maxLightness:70,colorCount:4},exclude:["repeatColors","mirrorColors"]});class eL extends et{static type="maurer_rose";name="Maurer Rose";id="maurer_rose";link="https://blog.glitch.land/en/posts/maurer-rose/";linkText="Learn";controls=[{key:"n",label:"N",defaultValue:4,type:"range",attr:{min:2,max:12,step:1},isStructural:!0},{key:"maxSteps",label:"Max steps",defaultValue:512,type:"range",attr:{min:3,max:720,step:1},isStructural:!0},{key:"angle",label:"Angle",defaultValue:341,type:"range",attr:{min:1,max:720,step:1},displayValue:({angle:e})=>`${e}\xb0`,isStructural:!0},H(eh.rotationConfig,"snap"),eM];colorMap;setUpDraw(){let{isMultiColor:e,colorCount:t}=this.config;this.stepCount||(this.stepCount=this.getStepCount()),e?this.colorMap=this.color.getColorMap({stepCount:this.stepCount,colorCount:t}):this.colorMap=null}getAspectRatio({size:e}){let{n:t,rotation:i,margin:n}=this.config;return new ed({size:e,sides:t%2?t:2*t,nailsPerSide:10,margin:n,rotation:i,center:O(e)}).getAspectRatio()}getCalc({size:e}){let{angle:t,rotation:i,maxSteps:n,margin:s}=this.config;return{angleRadians:E*t/n,radius:Math.min(...e)/2-s,currentSize:I(e,e=>e-2*s),rotationAngle:-(2*Math.PI)*i,center:O(e)}}getPoint(e){let{rotationAngle:t,angleRadians:i,radius:n,center:s}=this.calc,r=e*i,a=n*Math.sin(this.config.n*r);return[s[0]-a*Math.cos(r-t),s[1]-a*Math.sin(r-t)]}*generatePoints(e=0){let t=this.getStepCount();for(let i=e;i<t+1;i++)yield i}*drawStrings(e){let t=this.generatePoints(1);for(let i of(e.startLayer({color:this.color.getColor(0)}),e.goto(0),t)){if(this.colorMap){let t=this.colorMap.get(i);t&&e.startLayer({color:t})}e.stringTo(i),yield}}getStepCount(){if(this.stepCount)return this.stepCount;let{maxSteps:e,angle:t,n:i}=this.config,n=function e(t,i){return i?e(i,t%i):t}(e,t),s=e/n;return!(s%2)&&i%2&&(s/=2),Math.round(s)}getNails(e){let t=new es(e);for(let e of this.generatePoints())t.addNail(e,this.getPoint(e));return t}}const eR=K.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:30,multicolorStart:25,multicolorByLightness:!0,minLightness:40,maxLightness:95,colorCount:3,repeatColors:!0,saturation:83,reverseColors:!0},customControls:[{key:"colorPerLevel",label:"Color per level",defaultValue:!0,type:"checkbox",affectsNails:!1}]}),eI=-E/6,eT=Array(6).fill(null).map((e,t)=>Math.PI/2+eI*t),eA={evenly:{f:(e,{ringSize:t,layers:i,n:n})=>Math.floor((i-e)*Math.floor(n*t)/i),name:"Evenly"},distance:{f:(e,{n:t,ringSize:i,layerDistance:n})=>{let s=Math.floor(t*i);return e>0?s-e*n:s},name:"Specific distance"}},eD=K.getConfig({defaults:{isMultiColor:!0,color:"#ff0000",multicolorRange:133,multicolorStart:239,multicolorByLightness:!1,minLightness:30,maxLightness:70,colorCount:4},customControls:[{key:"colorPerLayer",label:"Color per layer",defaultValue:!0,type:"checkbox",affectsNails:!1}]});class ez extends et{static type="comet";name="Comet";id="comet";controls=[eh.nailsConfig,{key:"layers",label:"Layers",defaultValue:5,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},{key:"ringSize",label:"First layer size",description:"Nail count from the top center nail to the first connected nail in the first layer",defaultValue:.3,type:"range",attr:{min:0,max:1,step:.01},displayValue:({ringSize:e,n:t})=>Math.floor(t*e),isStructural:!0,affectsNails:!1},{key:"layerSpread",label:"Layer Spread",type:"select",defaultValue:"distance",options:Object.entries(eA).map(([e,{name:t}])=>({value:e,label:t})),isStructural:!0,affectsNails:!1},{key:"layerDistance",label:"Layer Distance",type:"range",attr:{min:1,max:({n:e,layers:t})=>Math.floor(e/2/t),step:1},defaultValue:1,isStructural:!0,show:({layerSpread:e})=>"evenly"!==e,affectsNails:!1},eh.rotationConfig,eh.distortionConfig,eh.displacementConfig,eD];defaultValues={n:51,layers:11,colorPerLayer:!0,multicolorRange:203,multicolorStart:137,ringSize:.47,rotation:.25,distortion:.38,displacementFunc:"fastInOut",displacementMag:1.8,displacementFastArea:.43,layerSpread:"distance",layerDistance:1};getCalc(e){return{circle:new eh({size:e.size,n:this.config.n,margin:this.config.margin,rotation:this.config.rotation,distortion:this.config.distortion,displacementFunc:this.config.displacementFunc,displacementMag:this.config.displacementMag,displacementFastArea:this.config.displacementFastArea})}}initColor(){let{isMultiColor:e,colorCount:t,layers:i,colorPerLayer:n}=this.config,s=e?n?i:Math.min(t,i):1;return new K({...this.config,isMultiColor:e,colorCount:s})}getAspectRatio(e){return this.getCalc(e).circle.getAspectRatio()}getLayerRingDistance(e){let t=eA[this.config.layerSpread];if(!t)throw Error(`Invalid spread mode, "${this.config.layerSpread}"!`);return Math.max(1,t.f(e,this.config))}getLayerRingStepCount(e){let t=this.getLayerRingDistance(e);return(this.config.n-t+1)*2-1}*#eT(e,t=0){let{n:i}=this.config,n=this.getLayerRingDistance(t),s=i-n+1,r=0;e.startLayer({color:this.color.getColor(t),name:String(t)}),e.goto(0);for(let t=0;t<=i-n;t++)e.stringTo((t+n)%i),yield,t!==s-1&&(r=t+1,e.stringTo(r),yield)}*drawStrings(e){for(let t=0;t<this.config.layers;t++)yield*this.#eT(e,t)}getStepCount(){if(this.stepCount)return this.stepCount;let{layers:e}=this.config;return Array(e).fill(0).reduce((e,t,i)=>e+this.getLayerRingStepCount(i),0)}getNailCount(){return this.config.n}getNails(e){return this.calc.circle.getNails(e)}thumbnailConfig=({n:e,layers:t})=>({n:Math.min(e,e%2?29:28),layers:Math.min(t,8)});testStepCountConfig=[{n:28,layers:8,ringSize:.46,layerSpread:"distance",layerDistance:2,distortion:-.33}]}class e$ extends et{static type="sun";name="Sun";id="sun";controls=[{key:"starGroup",label:"Star",type:"group",children:[...G([...eb.StarConfig,K.getConfig({defaults:{isMultiColor:!0,multicolorRange:1,multicolorStart:237,color:"#ffffff",saturation:40,multicolorByLightness:!0,minLightness:20,maxLightness:97},exclude:["colorCount"]})],"sides",[{key:"layers",label:"Layers",defaultValue:4,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},{key:"layerSpread",label:"Layer spread",defaultValue:.1625,type:"range",displayValue:({layerSpread:e})=>ea(e),attr:{min:.01,max:1,step:.02},show:({layers:e})=>1!==e,isStructural:!0},{key:"starRadius",label:"Star Radius",defaultValue:1,type:"range",displayValue:({starRadius:e})=>ea(e),attr:{min:.2,max:1,step:.01},isStructural:!0,affectsStepCount:!1}])]},{key:"backdrop",label:"Backdrop",type:"group",children:[{key:"backdropSize",label:"Backdrop size",defaultValue:.5,type:"range",displayValue:({backdropSize:e})=>ea(e),attr:{min:0,max:1,step:({sideNails:e})=>1/e},isStructural:!0},{key:"backdropRadius",label:"Backdrop radius",defaultValue:1,type:"range",displayValue:({backdropRadius:e})=>ea(e),attr:{min:0,max:1,step:.01},isStructural:!0,affectsStepCount:!1},{key:"backdropShift",label:"Backdrop shift",defaultValue:0,type:"range",displayValue:({backdropShift:e})=>ea(e),attr:{min:0,max:1,step:({sideNails:e,backdropSize:t})=>(1/(e*(1-t))).toFixed(3)},isStructural:!0,affectsStepCount:!1,affectsNails:!1},{key:"backdropSkip",label:"Backdrop skip",description:"If yes, connections in the backdrop are from the backdrop's nail to the second-nearest side, not the ones near it",defaultValue:!1,type:"checkbox",isStructural:!0,affectsStepCount:!1,show:({sides:e})=>e>3},K.getConfig({defaults:{isMultiColor:!0,multicolorRange:20,multicolorStart:0,color:"#ffffff",saturation:57,multicolorByLightness:!0,minLightness:20,maxLightness:40},propMapper:({key:e,show:t})=>{e[0].toUpperCase(),e.slice(1);let i={key:"backdrop"+e[0].toUpperCase()+e.slice(1),show:t?({backdropIsMultiColor:t})=>"color"===e?!t:t:null};return"multicolorRange"===e&&(i.attr={start:({backdropMulticolorStart:e})=>e,type:"range"}),i},groupLabel:"Backdrop color",maxColorCount:2})]}];getCommonControls(){return G(ee,"nailsColor",[{key:"backdropNailsColor",label:"Backdrop nails color",type:"color",defaultValue:"#ffffff",show:({showNails:e})=>e,affectsStrings:!1},{key:"backdropNailsRadius",label:"Backdrop nails radius",type:"range",defaultValue:1.5,attr:{min:.5,max:5,step:.25},show:({showNails:e})=>e,affectsStrings:!1}])}#eA;defaultValues={sideNails:50,sides:16,layers:4,layerSpread:.77,backdropSize:.26,backdropRadius:.9,backdropShift:.59,backdropColorCount:2,centerRadius:.2,maxCurveSize:.64,rotation:.5,saturation:73,multicolorStart:206,multicolorRange:1,multicolorByLightness:!0,minLightness:35,maxLightness:100,nailsColor:"#000000",backdropNailsColor:"#ffffff",backdropNailsRadius:2.275};getCalc({size:e}){let{margin:t=0,sideNails:i,backdropRadius:n=1,backdropSize:s,rotation:r,sides:a,starRadius:o=1}=this.config,l=Math.min(...O(e))-t,c={...this.config,radius:s&&o<n?l*o/n:l,size:e};return{backdropNails:Math.floor(i*s),star:new eb(c),circle:new eh({size:e,n:a,rotation:-1/a/2+(r?r/a:0),radius:n<o?l*n/o:l})}}initColor(){let{layers:e}=this.config;return new K({...this.config,colorCount:e})}setUpDraw(){let{backdropColorCount:e}=this.config;this.#eA=new K({...function(e,t){let i={};return Object.entries(e).forEach(([e,n])=>i[t(e,n)]=n),i}(this.config,e=>{let t=e.match(/^backdrop(\w)(.+)/);return t?t[1].toLowerCase()+t[2]:e}),colorCount:e})}getAspectRatio(e){let t=this.getCalc(e);return $(D(t.circle.getBoundingRect(),t.star.getBoundingRect()))}*drawBackdrop(e){let{backdropNails:t,circle:i,star:n}=this.calc,{sides:s,backdropShift:r,sideNails:a,backdropSkip:o,backdropIsMultiColor:l,backdropColorCount:c}=this.config,u=o&&s>3,d=0,h=Math.floor(r*(a-t))+t-1;function*p(r){let a=!1,o=r%2?1:-1;e.goto(n.getSideNailKey(r,h));let l=i.getNailKey(u?(r+1)%s:r);for(let i=0;i<t;i++)yield e.stringTo(l,"backdrop"),d=(a?r:r+(u?3:1))%s,yield e.stringTo(n.getSideNailKey(d,h)),i<t-1&&(a=!a,h+=o,yield e.stringTo(n.getSideNailKey(d,h)))}if(l&&1!==c){let t=new Map(ec(2,e=>[e,{name:`Backdrop #${e+1}`,color:this.#eA.getColor(e)}]));for(let i=0;i<s;i++)e.startLayer(t.get(i%2)),yield*p(i)}else e.startLayer({name:"Backdrop",color:this.#eA.getColor(0)}),yield*function*(){for(let e=0;e<s;e++)yield*p(e)}()}*drawStrings(e){yield*this.drawBackdrop(e);for(let t=0;t<this.config.layers;t++)e.startLayer({name:`Layer ${t+1}`,color:this.color.getColor(t)}),yield*this.calc.star.drawStar(e,{size:this.#eD(t)})}getNails(e){let{backdropSize:t,backdropNailsColor:i,backdropNailsRadius:n}=this.config,s=new es(e);if(this.calc.star.addNails(s),t){let e=new en({color:i,radius:n});this.calc.circle.addNails(e),s.addGroup(e,"backdrop")}return s}#eD(e){let{layers:t,layerSpread:i,sideNails:n}=this.config;return Math.max(1,n-e*Math.max(1,Math.floor(n/t*i)))}getStepCount(e){let{layers:t,sides:i}=this.config,{backdropNails:n}=this.getCalc(e),s=i*(3*n-1);for(let e=0;e<t;e++){let t=this.#eD(e);s+=eb.getStepCount(this.config,{size:t})}return s}thumbnailConfig=({sideNails:e,backdropNailsRadius:t})=>({sideNails:Math.min(e,10),backdropNailsRadius:Math.min(t,.5)})}class eF extends et{static type="lotus";name="Lotus";id="lotus";controls=[{key:"sides",label:"Sides",description:"How many petals there are in the Lotus",type:"range",defaultValue:18,attr:{min:5,max:64,step:1},isStructural:!0},{key:"density",label:"Density",type:"range",defaultValue:15,attr:{min:1,max:30,step:1},isStructural:!0},H(eh.rotationConfig,"snap"),{key:"removeSections",label:"Remove sections",type:"range",attr:{min:0,max:1,step:({sides:e,renderCenter:t})=>1/(eO(e)-3)},defaultValue:4/7,displayValue:({removeSections:e,sides:t,renderCenter:i})=>Math.round(e*(eO(t)-3)),isStructural:!0},{key:"renderCenter",label:"Render center",type:"checkbox",defaultValue:!0,isStructural:!0},{key:"centerRadius",label:"Center radius",type:"range",defaultValue:1,attr:{min:0,max:1,step:.01},displayValue:({centerRadius:e})=>ea(e),show:({renderCenter:e})=>e,isStructural:!0,affectsStepCount:!1},{key:"renderCenterNails",label:"Render center nails",type:"checkbox",defaultValue:!1,isStructural:!0},K.getConfig({defaults:{isMultiColor:!0,multicolorStart:20,multicolorRange:26,multicolorByLightness:!0,minLightness:32,maxLightness:85,saturation:100,colorCount:6,mirrorColors:!0},customControls:[{key:"radialColor",label:"Radial color",defaultValue:!1,type:"checkbox",affectsNails:!1,affectsStepCount:!1}],maxColorCount:32})];defaultValues={nailsColor:"#a08346"};getCalc({size:e}){let{sides:t,density:i,margin:n,rotation:s,removeSections:r,centerRadius:a,renderCenter:o,renderCenterNails:l}=this.config,c=O(e),u=.5*Math.min(...e)/2,d=E/t,h=i*t,p={n:h,center:[0,0],size:[0,0],radius:0,rotation:0},g=0;if(r){var f;let e=eO(t)-3,i=d*(g=Math.min(e,Math.round(r*e))),s=2*u*Math.sin((Math.PI-i)/2),a=(2*u-n)/s;p.n=Math.round(Math.max(t,(f=h*a)-f%t)*(1-2*g/t)+1),u*=a,Object.assign(p,{angleStart:i,angleEnd:E-i})}Object.assign(p,{size:[u-n/2,u-n/2],radius:u-n/2});let m=new eh({n:t,size:e.map(e=>.5*e-n),center:c,radius:u-n/2,rotation:s}),v=o?a?t:1:0,y=ec(t,e=>{let i=v+p.n*e;return new eh({...p,center:m.getPoint(e),rotation:s-e/t,getUniqueKey:e=>i+e})}),b=eO(t),_=Math.floor(p.n/(t-2*g)),w=null;if(!l){let e=(b-1-g-!o)*_+1,t=p.n-e-!!g;w=[e,t]}let S={circles:y,sideAngle:d,sections:eO(t),removedSections:g,nailsPerSection:Math.floor(p.n/(t-2*g)),nailsPerCircle:p.n,center:c,excludedNailRange:w};if(o&&a){let e=S.sections-1-S.removedSections,i=y[0].getPoint(e*S.nailsPerSection),n=a*Math.floor(P(m.center,i));S.centerCircle=new eh({n:t,center:m.center,size:[n,n],radius:n,rotation:s+-Math.ceil((t-4)/2)/2/t})}return S}initColor(){let e=this.config.radialColor?this.calc.sections-this.calc.removedSections-1:this.config.colorCount;return!this.config.renderCenter&&this.config.radialColor&&e--,new K({...this.config,colorCount:e})}getAspectRatio(e){return $(D(...this.getCalc(e).circles.map(e=>e.getBoundingRect())))}#ez(e,t){let{radialColor:i}=this.config,{removedSections:n}=this.calc;return this.color.getColor(i?t-n:e)}*#e$(e,t,i){let{sides:n}=this.config,{sections:s,nailsPerSection:r,nailsPerCircle:a,removedSections:o}=this.calc,l=this.#ez(t,i),c=this.calc.circles[t],u=this.calc.circles[0===t?n-1:t-1];if(e.startLayer({color:l}),0===i){let t=u.getNailKey(2*r);for(let i=a-r;i<a;i++)e.goto(c.getNailKey(i)),e.stringTo(t),yield;for(let i=0;i<=r;i++)e.goto(c.getNailKey(i)),e.stringTo(t),yield}else{let l=i===s-2?this.calc.centerCircle?t:0:u.getNailKey(r*(i+2-o)-(n%2&&i===s-2?r/2:0)),d=this.calc.circles[(t+i)%n],h=a-(i+1-o)*r-!!o;for(let t=0;t<=r;t++)e.goto(d.getNailKey(h+t)),e.stringTo(l),yield;let p=(i-o)*r+1;for(let t=p;t<p+r;t++)e.goto(c.getNailKey(t)),e.stringTo(l),yield}}*drawStrings(e){for(let{side:t,section:i}of this.#eF())yield*this.#e$(e,t,i)}*#eF(){let{radialColor:e,sides:t,renderCenter:i}=this.config,{sections:n,removedSections:s}=this.calc,r=n-(i?1:2);if(e)for(let e=s;e<r;e++)for(let i=0;i<t;i++)yield{side:i,section:e};else for(let e=0;e<t;e++)for(let t=s;t<r;t++)yield{side:e,section:t}}getNails(e){let{renderCenter:t}=this.config,{circles:i,centerCircle:n,excludedNailRange:s,nailsPerSection:r}=this.calc,a=new es(e);return t&&(n?n.addNails(a):a.addNail(0,this.calc.center)),i.forEach((e,i)=>{e.addNails(a,{filter:s?e=>!t&&e===s[0]+r-1||e<s[0]||e>s[1]:void 0})}),a}getStepCount(e){let{nailsPerSection:t,sections:i,removedSections:n}=this.calc??this.getCalc(e),{sides:s}=this.config;return(2*t+1)*(i-n-1)*s}thumbnailConfig=({density:e})=>({density:Math.min(e,5)});testStepCountConfig=[{renderCenter:!0,centerRadius:0}]}function eO(e){return e%2?Math.ceil(e/2):e/2}const eV=K.getConfig({defaults:{isMultiColor:!0,colorCount:7,color:"#ffbb29",multicolorRange:21,multicolorStart:32,multicolorByLightness:!0,minLightness:36,maxLightness:98}});function eq(e,t){return{key:`shape${t}`,label:e,type:"group",children:[{key:`shape${t}Type`,label:"Type",type:"select",defaultValue:"circle",options:[{value:"circle",label:"Circle"},{value:"polygon",label:"Polygon"}],isStructural:!0},2===t?{key:`shape${t}Size`,label:"Size",type:"range",attr:{min:.1,max:1,step:.01},defaultValue:1,displayValue:e=>ea(e[`shape${t}Size`]),isStructural:!0,affectsStepCount:!1}:void 0,{key:`shape${t}Sides`,label:"Sides",type:"range",attr:{min:3,max:24,step:1},defaultValue:7,isStructural:!0,show:e=>"polygon"===e[`shape${t}Type`]},{...eh.distortionConfig,key:`shape${t}Distortion`,show:e=>"circle"===e[`shape${t}Type`]},2===t?{key:"identicalNailCount",label:"Nail count as outer shape",type:"checkbox",defaultValue:!1,isStructural:!0}:null,{key:`shape${t}NailCount`,label:"Nail count",type:"range",attr:{min:3,max:400,step:1},defaultValue:100,isStructural:!0,show:({identicalNailCount:e})=>1===t||!e},{key:`shape${t}Rotation`,label:"Rotation",type:"range",attr:{min:0,max:1,step:.0027},defaultValue:0,displayValue:e=>eo(e[`shape${t}Rotation`]),isStructural:!0}].filter(Boolean)}}class eB extends et{static type="dance_of_planets";name="Dance of Planets";id="dance_of_planets";controls=[eq("Outer shape",1),eq("Inner shape",2),{type:"range",key:"rounds",label:"Rounds",attr:{min:1,max:30,step:1},defaultValue:1,affectsNails:!1},{key:"reverse",type:"checkbox",label:"Reverse order",description:"If on, while the first shape advances in one direction, the second shape advances in the opposite direction",defaultValue:!1,isStructural:!1,affectsNails:!1},eV];defaultValues={shape1Type:"circle",shape1NailCount:150,shape1Rotation:0,shape2Type:"circle",shape2Size:.8,shape2NailCount:117,shape2Distortion:-.12,shape2Rotation:.216,rounds:2,multicolorRange:132,multicolorStart:198,isMultiColor:!0,multicolorByLightness:!1,colorCount:2};colorMap;getCalc({size:e}){let{margin:t}=this.config,i=O(e);function n({type:n,diameter:s=1,nailCount:r,sides:a,rotation:o=0,distortion:l,getUniqueKey:c}){return"circle"===n?new eh({size:I(e,e=>e*s),n:Math.round(r),radius:Math.min(...e)*s/2,center:i,margin:t,reverse:!0,rotation:o,distortion:l,getUniqueKey:c}):(r=Math.max(r,a=a??3),new ed({size:I(e,e=>e*s),sides:a??3,nailsPerSide:Math.round(r/a),center:i,margin:t,rotation:o,getUniqueKey:c}))}function s(e){return e instanceof ed?e.getNailsCount():e instanceof eh?e.config.n:NaN}let r=n({type:this.config.shape1Type,nailCount:this.config.shape1NailCount,sides:this.config.shape1Sides,rotation:this.config.shape1Rotation,distortion:this.config.shape1Distortion}),a=s(r),o=n({type:this.config.shape2Type,diameter:this.config.shape2Size,nailCount:this.config.identicalNailCount?a:this.config.shape2NailCount,sides:this.config.shape2Sides,rotation:this.config.shape2Rotation,distortion:this.config.shape2Distortion,getUniqueKey:e=>e+a});return{shape1:r,shape2:o,shape1NailCount:a,shape2NailCount:s(o)}}setUpDraw(){let{colorCount:e}=this.config;e&&(this.colorMap=this.color.getColorMap({stepCount:this.#eO(),colorCount:e}))}getAspectRatio(){let{shape1:e,shape2:t}=this.calc??this.getCalc({size:[100,100]}),i=e.getBoundingRect(),n=t.getBoundingRect();return Math.max(i.width,n.width)/Math.max(i.height,n.height)}#eO(){let{shape1NailCount:e,shape2NailCount:t}=this.calc;return Math.max(e,t)*this.config.rounds}*drawStrings(e){let{shape1NailCount:t,shape2NailCount:i}=this.calc,{reverse:n}=this.config,s=this.#eO();e.goto(0);let r=!0,a=n?e=>t+i-(e%i||i):e=>t+e%i;for(let i=0;i<s;i++){let n=this.colorMap.get(i);n&&e.startLayer({color:n}),e.stringTo(r?a(i):i%t),yield,i!==s-1&&(e.stringTo(r?a(i+1):(i+1)%t),yield,r=!r)}}getStepCount(e){return this.calc||(this.calc=this.getCalc(e)),2*this.#eO()-1}getNailCount(e){let t=this.getCalc({size:e});return t.shape1NailCount+t.shape2NailCount}getNails(e){let t=new es(e);return this.calc.shape1.addNails(t),this.calc.shape2.addNails(t),t}#eV(e,t,i){return"circle"===e?t:t<=i?i:t-t%i}thumbnailConfig=e=>{let t=this.#eV(e.shape1Type,e.shape1NailCount,e.shape1Sides),i=e.identicalNailCount?t:e.shape2NailCount;if(t<=80&&i<=80)return{};let n=t/i;return n>=1?(t=80,i=80/n):(i=80,t=80*n),{shape1NailCount:t,shape2NailCount:i}}}function ej(e){return"h"===e?"vertical":"horizontal"}function eH(e){return"h"===e?"horizontal":"vertical"}class eU extends et{static type="crosses";name="Crosses";id="crosses";controls=[{type:"range",key:"n",label:"Nails per side",attr:{min:2,max:100,step:1},defaultValue:25,isStructural:!0},{key:"orientation",type:"select",label:"Orientation",defaultValue:"v",options:[{value:"v",label:"â†• Vertical"},{value:"h",label:"â†” Horizontal"}],affectsStepCount:!1,isStructural:!0},{key:"sidesRotation",type:"range",label:"Sides rotation",attr:{min:-.25,max:.25,step:.005,snap:"0"},displayValue:({sidesRotation:e})=>eo(e),defaultValue:0,affectsStepCount:!1,isStructural:!0},{key:"fineControl",type:"checkbox",label:"Fine control",defaultValue:!1,affectsStepCount:!1,isStructural:!0},{key:"lockGap",type:"checkbox",label:"Lock horizontal/vertical gap",defaultValue:!0,isStructural:!0,affectsStepCount:!1,show:({fineControl:e})=>!e},{key:"lengthGap",type:"range",label:({orientation:e,lockGap:t})=>t?"Gap":`${el(eH(e))} gap`,attr:{min:0,max:1,step:.01},displayValue:({lengthGap:e})=>ea(e),defaultValue:.27,affectsStepCount:!1,isStructural:!0,show:({fineControl:e})=>!e},{key:"widthGap",type:"range",label:({orientation:e})=>`${el(ej(e))} gap`,attr:{min:0,max:5,step:.01},displayValue:({widthGap:e})=>ea(e),defaultValue:.43,affectsStepCount:!1,isStructural:!0,show:({lockGap:e,fineControl:t})=>!t&&!e},{key:"center",type:"group",label:"Center â—ˆ",show:({fineControl:e})=>e,children:[{key:"centerLengthSpread",type:"range",label:({orientation:e})=>`Center ${eH(e)} spread`,attr:{min:.2,max:5,step:.01,snap:"1"},displayValue:({centerLengthSpread:e})=>ea(e),defaultValue:1,affectsStepCount:!1,isStructural:!0},{key:"centerLengthGap",type:"range",label:({orientation:e})=>`Center ${eH(e)} gap`,attr:{min:0,max:5,step:.01},displayValue:({centerLengthGap:e})=>ea(e),defaultValue:0,affectsStepCount:!1,isStructural:!0},{key:"symmetricCenter",type:"checkbox",label:({orientation:e})=>`Symmetric ${ej(e)} center`,defaultValue:!0,affectsStepCount:!1,isStructural:!0},{key:"centerSpread",type:"range",label:({orientation:e})=>`Center ${ej(e)} spread`,attr:{min:.2,max:5,step:.01,snap:"1"},displayValue:({centerSpread:e})=>ea(e),defaultValue:1,affectsStepCount:!1,isStructural:!0,show:({symmetricCenter:e})=>e},{key:"centerWidthGap",type:"range",label:({orientation:e})=>`Center ${ej(e)} gap`,attr:{min:0,max:5,step:.01},displayValue:({centerWidthGap:e})=>ea(e),defaultValue:0,affectsStepCount:!1,isStructural:!0,show:({symmetricCenter:e})=>e},{key:"centerStartSpread",type:"range",label:({orientation:e})=>`Center ${"v"===e?"left":"up"} spread`,attr:{min:.2,max:5,step:.01,snap:"1"},displayValue:({centerStartSpread:e})=>ea(e),defaultValue:1,affectsStepCount:!1,isStructural:!0,show:({symmetricCenter:e})=>!e},{key:"centerStartGap",type:"range",label:({orientation:e})=>`Center ${"v"===e?"left":"up"} gap`,attr:{min:0,max:5,step:.01},displayValue:({centerStartGap:e})=>ea(e),defaultValue:0,affectsStepCount:!1,isStructural:!0,show:({symmetricCenter:e})=>!e},{key:"centerEndSpread",type:"range",label:({orientation:e})=>`Center ${"v"===e?"right":"down"} spread`,attr:{min:.2,max:5,step:.01,snap:"1"},displayValue:({centerEndSpread:e})=>ea(e),defaultValue:1,affectsStepCount:!1,isStructural:!0,show:({symmetricCenter:e})=>!e},{key:"centerEndGap",type:"range",label:({orientation:e})=>`Center ${"v"===e?"right":"down"} gap`,attr:{min:0,max:5,step:.01},displayValue:({centerEndGap:e})=>ea(e),defaultValue:0,affectsStepCount:!1,isStructural:!0,show:({symmetricCenter:e})=>!e}]},{key:"edges",label:"Edges â—… â–»",type:"group",show:({fineControl:e})=>e,children:[{key:"edgesSpread",type:"range",label:({orientation:e})=>`Edges ${eH(e)} spread`,attr:{min:.2,max:5,step:.01,snap:"1"},displayValue:({edgesSpread:e})=>ea(e),defaultValue:1,affectsStepCount:!1,isStructural:!0},{key:"edgesGap",type:"range",label:({orientation:e})=>`Edges ${eH(e)} gap`,attr:{min:0,max:1,step:.01,snap:"1"},displayValue:({edgesGap:e})=>ea(e),defaultValue:0,affectsStepCount:!1,isStructural:!0},{key:"edgesWidthSpread",type:"range",label:({orientation:e})=>`Edges ${ej(e)} spread`,attr:{min:.2,max:5,step:.01,snap:"1"},displayValue:({edgesWidthSpread:e})=>ea(e),defaultValue:1,affectsStepCount:!1,isStructural:!0},{key:"edgesWidthGap",type:"range",label:({orientation:e})=>`Edges ${ej(e)} gap`,attr:{min:0,max:1,step:.01,snap:"1"},displayValue:({edgesWidthGap:e})=>ea(e),defaultValue:0,affectsStepCount:!1,isStructural:!0}]},K.getConfig({defaults:{isMultiColor:!0,colorCount:2,color:"#ffffff",multicolorRange:1,multicolorStart:1,multicolorByLightness:!0,minLightness:40,maxLightness:100,reverseColors:!0},customControls:[{key:"setCenterColor",label:"Manually set center color",defaultValue:!1,type:"checkbox",affectsNails:!1,affectsStepCount:!1},{key:"centerColor",type:"color",label:"Center color",defaultValue:"#ffd500",show:({setCenterColor:e})=>e,affectsNails:!1,affectsStepCount:!1}],exclude:["repeatColors"],maxColorCount:2})];getCalc({size:e}){let{n:t,orientation:i,margin:n,lengthGap:s,widthGap:r,lockGap:a,fineControl:o,centerWidthGap:l,centerSpread:c,symmetricCenter:u,centerLengthGap:d,centerLengthSpread:h,centerStartGap:p,centerStartSpread:g,centerEndGap:f,centerEndSpread:m,edgesGap:v,edgesSpread:y,edgesWidthGap:b,edgesWidthSpread:_,sidesRotation:w}=this.config,S=O(e),x="v"===i,C=(x?e[1]:e[0])-2*n,k=.8*C/3,N=(o?d:s)*k,P=o?(.8*C-s*k)*v/2:s*k,M=o?h:1,L=(C-(N+2*P))/(2*(o?M:1)+2*(o?y:1)),R=0,I=o?L*y:L,T=+!x;function A(){let e=(e,t,i)=>[S[T]-(i?.gap1??e)*L-(i?.length1??t)+R,S[T]+(i?.gap2??e)*L+(i?.length2??t)+R],t=o?null:e(a?s:r,L),[i,n]=o?e(l,c*L,u?void 0:{gap1:p,gap2:f,length1:g*L,length2:m*L}):t,[d,h]=o?e(b,_*L):t,[v,y]=e(b,Math.cos(w*E)*(o?_:1)*L),C=2*(I+L*M+P)+N,k=S[+!!x]-C/2,A=N/2+L*M+P/2+Math.sin(w*E)*L*_,[D,z]=[S[+!!x]-A,S[+!!x]+A],$=Math.min(v,i),F=Math.max(y,n),O=Math.min(k,D),V=Math.max(k+C,z);return{lengthStart:k,edgesWidthStart:d,edgesWidthEnd:h,centerStart:i,centerEnd:n,width:F-$,widthStart:$,widthEnd:F,heightStart:O,height:V-O}}let D=A(),z=e.map(e=>e-2*n),$=z[T],F=z[+!!x],V=Math.min($/D.width,F/D.height),q=S[T]-D.width/2,B=!1,j=Math.trunc(q)-Math.trunc(D.widthStart);j!==R&&(R=j,B=!0),V<1&&(C*=V,N*=V,L*=V,R*=V,I*=V,B=!0,P*=V),B&&(D=A());let{lengthStart:H,width:U}=D,G=ec(4,function(e){let t=H;return 0===e?{vertical:t,horizontal:-1,length:I}:(t+=P+I,1===e)?{vertical:t,horizontal:t-P/2,length:L*M}:(t+=L*M+N,2===e)?{vertical:t,horizontal:t-N/2,length:L*M}:{vertical:t+=L*M+P,horizontal:t-P/2,length:I}}),W=(x?S[0]:S[1])+R,K=ec(4,function(e){let{vertical:i,length:n}=G[e],s=[W,i],r=[W,i+n];x||(s.reverse(),r.reverse());let a=e*t;return new eu({from:s,to:r,n:t,getUniqueKey:e=>a+e})}),Y=(e,t)=>{if(!w||1===e)return null;let i=w;return x||(i*=-1),(1===t&&0===e||0===t&&2===e)&&(i*=-1),{rotation:i,rotationCenter:"to"}};function J(e,t){return o?1===e?u?L*c:L*(0===t?g:m):L*_:L}return{verticalLines:K,horizontalLines:ec(3,e=>{let i=1===e?D.centerStart:D.edgesWidthStart,n=1===e?D.centerEnd:D.edgesWidthEnd,s=G[e+1].horizontal,r=J(e,0),a=J(e,1),o=4*t,l=o+t*e*2,c=o+t*(2*e+1);return[new eu({...Y(e,0),...x?{from:[i,s],to:[i+r,s],n:t}:{from:[s,i],to:[s,i+r],n:t},getUniqueKey:e=>l+e}),new eu({...Y(e,1),...x?{from:[n,s],to:[n-a,s],n:t}:{from:[s,n],to:[s,n-a],n:t},getUniqueKey:e=>c+e})]}),width:U,height:C,horizontalLinesIndexStart:4*t}}getAspectRatio(){let{verticalLines:e,horizontalLines:t}=this.calc??this.getCalc({size:[100,100]}),i=function(...e){if(!e.length)return{top:0,bottom:0,left:0,right:0,width:0,height:0};let t=e[0].getBoundingRect();if(1===e.length)return t;let i=e.slice(1).reduce((e,t)=>{let i=t.getBoundingRect();return{top:Math.min(e.top,i.top),bottom:Math.max(e.bottom,i.bottom),left:Math.min(e.left,i.left),right:Math.max(e.right,i.right),width:0,height:0}},t);return Object.assign(i,{width:i.right-i.left,height:i.bottom-i.top}),i}(...e.concat(t.flat()));return i.width/i.height}*connectLines(e,{verticalLineIndex:t,row:i,isReverse:n=!1,color:s}){let r,{n:a}=this.config,{verticalLines:o,horizontalLines:l}=this.calc,c=l[i];e.startLayer({color:s}),e.goto(c[0].getNailIndex(0));let u=!1;for(let i=0;i<a;i++)null!=r&&(e.stringTo(c[r].getNailIndex(i)),yield),e.stringTo(o[t].getNailIndex(n?i:a-1-i)),yield,r=+!u,e.stringTo(c[r].getNailIndex(i)),yield,u=!u}*drawStrings(e){let{setCenterColor:t,centerColor:i}=this.config;for(let[n,s]of[[0,0],[0,1],[1,0],[1,1],[3,2],[3,1],[2,1],[2,2],[1,2],[2,0]]){let r,a=s<n;t&&(1===n||2===n)&&1===s&&(r=i),r||(r=this.color.getColor(+(s>n||n-s>1))),yield*this.connectLines(e,{verticalLineIndex:n,row:s,isReverse:a,color:r})}}getStepCount(){let{n:e}=this.config;return 10*(3*e-1)}getNailCount(){return 10*this.config.n}getNails(e){let t=new es(e);return this.calc.verticalLines.forEach((e,i)=>e.addNails(t)),this.calc.horizontalLines.forEach(e=>{for(let i of e)i.addNails(t)}),t}thumbnailConfig=e=>({n:Math.min(10,e.n)})}const eG=[{key:"angle",label:"Layer angle",defaultValue:.088,displayValue:({angle:e})=>`${M(180*e/3,2)}\xb0`,type:"range",attr:{min:.02,max:.15,step:.001},isStructural:!0},{key:"maxDensity",label:"Max density",defaultValue:5,type:"range",attr:{min:1,max:20,step:.01},isStructural:!0},{key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1,step:.0025},displayValue:({rotation:e})=>eo(e),isStructural:!0,affectsStepCount:!1}];function*eW(e,t=[0,1]){let i=!1;for(let n=0;n<e;n++)yield{side:t[+!!i],index:n},yield{side:t[+!i],index:n},i=!i}class eK extends et{getInnerRotationParams({sides:e,baseSideSize:t}){let{angle:i,maxDensity:n}=this.config,s=[e,n,t,i].join("_"),r=this.getInnerRotationParams[s];if(r)return r;let a=Math.PI/e,o=Math.atan((1-2*i)/Math.tan((e-2)*Math.PI/e/2)),l=Math.cos(a)/Math.cos(-o),c=Math.max(1,Math.ceil(Math.log(n/(t*i))/Math.log(l))),u={layerAngle:a-o,sizeRatio:l,depth:c};return this.getInnerRotationParams[s]=u,u}getNailIndex(e,t,i){return(e.nailIndexStart??0)+t+i*e.polygon.config.sides}*drawSpiralsOnly(e){let{tiles:t}=this.calc;e.startLayer({color:this.color.getColor(0),name:"1"}),e.goto(0);for(let i=0;i<t.length;i++)yield*this.drawMonochromeTile(e,t[i])}*connectSides(e,t,i,n){let s=!0,r=this.calc.tiles[t];for(let{side:t,index:a}of eW(r.depth,[i,n]))s?(e.goto(this.getNailIndex(r,t,a)),s=!1):yield e.stringTo(this.getNailIndex(r,t,a))}getColor(e,t){return this.color.getColor(e%2?1===t?2:2===t?1:t:t)}*drawTile(e,t,i){let n=this.calc.tiles[t];for(let s=0;s<n.polygon.config.sides;s++)i?.has(s)||(e.startLayer({name:s.toString(),color:this.getColor(t,s)}),yield*this.connectSides(e,t,s,(s+1)%n.polygon.config.sides))}*drawMonochromeTile(e,t){let i=t.nailIndexStart??0;e.goto(i);let n=t.polygon.config.sides*t.depth;for(let s=1;s<n;s++)s%t.polygon.config.sides||(yield e.stringTo(i+s-t.polygon.config.sides)),yield e.stringTo(i+s)}*drawTiles(e,t){for(let i=0;i<this.calc.tiles.length;i++)yield*this.drawTile(e,i,t)}*drawLeavesTile(e,t){let i=t.polygon.getSideNailIndex(0);e.goto(i);let n=t.polygon.config.sides*t.depth;for(let s=1;s<n;s++)s%t.polygon.config.sides||(yield e.stringTo(i+s-t.polygon.config.sides)),yield e.stringTo(i+s)}*connectTileSides(e,t,i,n){let s=!0;for(let{side:r,index:a}of eW(t.depth,[i,n]))s?(e.goto(this.getNailIndex(t,r,a)),s=!1):yield e.stringTo(this.getNailIndex(t,r,a))}*drawStrings(e){this.config.isMultiColor&&this.config.colorCount>1?yield*this.drawTiles(e):yield*this.drawSpiralsOnly(e)}getStepCount(e){let{tiles:t}=this.calc??this.getCalc(e);return t.reduce((e,t)=>e+(this.config.isMultiColor&&this.config.colorCount>1?t.polygon.config.sides*(2*t.depth-1):t.depth*(t.polygon.config.sides+1)-2),0)}getPolygonsForTile(e){let t=e.polygon.config.sides,{layerAngle:i,sizeRatio:n,depth:s}=this.getInnerRotationParams({sides:t,baseSideSize:e.polygon.sideSize});return[e.polygon].concat(ec(s-1,s=>{let r=s+1;return new ed({sides:t,nailsPerSide:2,rotation:(e.polygon.config.rotation??0)+(e.direction??1)*i*r/E,center:e.polygon.center,radius:e.polygon.radius*Math.pow(n,r),getUniqueKey:i=>(e.nailIndexStart??0)+t*r+i})}))}getNails(e){let{tiles:t}=this.calc,i=new es(e);return t.forEach(e=>{this.getPolygonsForTile(e).forEach(e=>e.addNails(i))}),i}thumbnailConfig={maxDensity:1}}class eY extends eK{static type="hexagon_spades";id="hexagon_spades";name="Hexagon Spades";controls=[...eG,{key:"mirrorTiling",label:"Mirror tiling",defaultValue:!0,type:"checkbox",isStructural:!0,affectsStepCount:!1},{key:"crossWeave",label:"Cross weave",defaultValue:!1,type:"checkbox",isStructural:!1},{key:"withSides",label:"With sides",defaultValue:!0,type:"checkbox",isStructural:!1},K.getConfig({defaults:{isMultiColor:!0,colorCount:3,color:"#ffffff",multicolorRange:88,multicolorStart:180,multicolorByLightness:!0,minLightness:60,maxLightness:64,reverseColors:!0},maxColorCount:10})];getCalc({size:e}){let{margin:t,rotation:i,maxDensity:n,angle:s,mirrorTiling:r}=this.config,a=new ed({sides:6,size:e,fitSize:!0,margin:t,nailsPerSide:2,rotation:i}),o=Math.PI/3,l=new ed({sides:6,radius:a.radius/(2*Math.cos(o/2)),nailsPerSide:2,rotation:i+1/12,center:a.center}),{depth:c}=this.getInnerRotationParams({sides:3,baseSideSize:a.sideSize}),u=3*c;return{tiles:ec(6,e=>{let t=u*e;return{polygon:new ed({radius:l.sideSize,sides:3,nailsPerSide:2,center:l.getSidePoint({side:e,index:0}),rotation:i+1/l.config.sides*(e+1),getUniqueKey:e?t=>t+u*e:void 0}),depth:c,direction:r&&e%2?-1:1,nailIndexStart:t}})}}#eq(e,t){return this.color.getColor(e%2?1===t?2:2===t?1:t:t)}*#eB(e){let{withSides:t}=this.config,{tiles:i}=this.calc;for(let n=0;n<i.length;n++){e.startLayer({name:"1",color:this.#eq(n,1)});let s=i[(n+1)%i.length],r=i[n];e.goto(this.getNailIndex(r,2,0)),yield e.stringTo(this.getNailIndex(r,1,0));for(let t=1;t<r.depth;t++)yield e.stringTo(this.getNailIndex(r,1,t)),yield e.stringTo(this.getNailIndex(r,2,t)),yield e.stringTo(this.getNailIndex(s,2,t)),yield e.stringTo(this.getNailIndex(s,0,t)),yield e.stringTo(this.getNailIndex(r,1,t));if(t)e.startLayer({name:"Sides",color:this.color.getColor(0)}),yield*this.connectSides(e,n,1,0);else for(let t=r.depth-1;t>=0;t--)yield e.stringTo(this.getNailIndex(s,0,t))}}*drawStrings(e){this.config.crossWeave?yield*this.#eB(e):this.config.isMultiColor&&this.config.colorCount>1||!this.config.withSides?yield*this.drawTiles(e,this.config.withSides?null:new Set([0])):yield*this.drawSpiralsOnly(e)}getStepCount(e){let{crossWeave:t,withSides:i}=this.config,{tiles:n}=this.calc??this.getCalc(e),s=n[0].depth;return t?n.length*((s-1)*5+(i?2*s-1:s)+1):this.config.isMultiColor&&this.config.colorCount>1||!this.config.withSides?n.length*(3-!i)*(2*s-1):n.length*Math.floor((3*s-1)*(1+1/3))}getAspectRatio({size:e}){let{margin:t,rotation:i}=this.config;return new ed({sides:6,size:e,fitSize:!0,margin:t,nailsPerSide:2,rotation:i}).getAspectRatio()}}class eJ extends eK{static type="star_of_david";id="star_of_david";name="Star of David";controls=[...eG,{key:"mirrorTiling",label:"Mirror tiling",defaultValue:!1,type:"checkbox",isStructural:!0,affectsStepCount:!1},K.getConfig({defaults:{isMultiColor:!0,colorCount:6,color:"#ffffff",multicolorStart:45,multicolorRange:1,multicolorByLightness:!0,minLightness:60,maxLightness:100,reverseColors:!1},maxColorCount:6})];defaultValues={maxDensity:2.66,angle:.063};getCalc({size:e}){let{margin:t,rotation:i,mirrorTiling:n}=this.config,s=new ed({sides:6,size:e,fitSize:!0,margin:t,nailsPerSide:2,rotation:1/12+i}),r=new ed({sides:6,radius:s.radius/(2*Math.cos(Math.PI/6)),center:s.center,nailsPerSide:2,rotation:i}),a=r.sideSize/(2*Math.cos(Math.PI/6)),o=new ed({sides:6,radius:r.getApothem()+a/2,center:s.center,nailsPerSide:2,rotation:1/12+i}),{depth:l}=this.getInnerRotationParams({sides:6,baseSideSize:r.sideSize}),{depth:c}=this.getInnerRotationParams({sides:3,baseSideSize:r.sideSize}),u=6*l,d=3*c;return{tiles:[{polygon:r,depth:l},...ec(6,e=>new ed({sides:3,center:o.getSidePoint({side:e,index:0}),radius:a,nailsPerSide:2,rotation:i+e/6,getUniqueKey:t=>u+d*e+t})).map((e,t)=>({polygon:e,depth:c,direction:n?1:-1,nailIndexStart:u+d*t}))]}}getColor(e,t){return e?2===t?this.color.getColor(e-1):this.color.getColor(2===this.config.colorCount?e:e+t):this.color.getColor(e%2?1===t?2:2===t?1:t:t)}getAspectRatio({size:e}){let{margin:t,rotation:i}=this.config;return new ed({sides:6,size:e,fitSize:!0,margin:t,nailsPerSide:2,rotation:i}).getAspectRatio()}testStepCountConfig=[{isMultiColor:!1,colorCount:1}]}const eX=[e_,eS,em,eg,ef,ev,ey,eC,eE,eP,eL,class extends et{static type="flower_of_life";name="Flower of Life";id="flower_of_life";link="https://www.reddit.com/r/psychedelicartwork/comments/mk97gi/rainbow_flower_of_life_uv_reactive_string_art/";controls=[{key:"levels",label:"Levels",defaultValue:3,type:"range",attr:{min:1,max:10,step:1},isStructural:!0},{key:"density",label:"Density",defaultValue:10,type:"range",attr:{min:1,max:50,step:1},isStructural:!0},{key:"globalRotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:30,step:1},displayValue:({globalRotation:e})=>`${e}\xb0`,isStructural:!0,affectsStepCount:!1},{key:"fillGroup",label:"Fill",type:"group",children:[{key:"fill",label:"Show fill",defaultValue:!0,type:"checkbox",isStructural:!0,affectsNails:!1},{key:"fillColor",label:"Fill color",defaultValue:"#292e29",type:"color",show:({fill:e})=>e,affectsNails:!1}]},{key:"ringGroup",label:"Ring",type:"group",children:[{key:"renderRing",label:"Show outer ring",type:"checkbox",defaultValue:!0,isStructural:!0},{key:"ringNailCount",label:"Ring nail count",defaultValue:144,type:"range",attr:{min:3,max:360,step:1},show:({renderRing:e})=>e,isStructural:!0},{key:"ringSize",label:"Outer ring size",defaultValue:.23,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:e})=>e,displayValue:({ringSize:e})=>ea(e),isStructural:!0},{key:"ringPadding",label:"Ring padding",defaultValue:.06,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:e})=>e,isStructural:!0,displayValue:({ringPadding:e})=>ea(e)},{key:"ringColor",label:"Ring color",defaultValue:"#e8b564",type:"color",show:({renderRing:e})=>e,affectsNails:!1}]},{key:"renderTriangles",label:"Show triangles",defaultValue:!0,type:"checkbox",isStructural:!0,affectsNails:!1},{key:"renderCaps",label:"Show caps",defaultValue:!0,type:"checkbox",show:({renderTriangles:e})=>e,isStructural:!0},eR];defaultValues={nailsColor:"#474747"};colorMap;getCalc(e){let t,{size:i}=e,{levels:n,density:s,margin:r,globalRotation:a,renderCaps:o,renderRing:l,ringNailCount:c,ringSize:u,ringPadding:d}=this.config,h=a*Math.PI/180+Math.PI/6,p=l?Math.min(...i.map(e=>e/2-r)):null,g=l?Math.floor(u*c/2):0,f=new ed({sides:6,size:i,margin:r+(l?p*(1-Math.cos(g/c*E/2)):0)+(l&&u?d*p:0),rotation:h,fitSize:!1,nailsPerSide:2}).sideSize/n,m=f/(2*Math.cos(Math.PI/6));l&&u&&(t=new eh({size:i,n:c,margin:r,rotation:a}));let v=Array(n+ +!!o).fill(null).map((e,t)=>2*t+1);return{edgeSize:f,triangleHeight:f*Math.sqrt(3)/2,nailsLength:m,triangleCenterDistance:f/2,nailDistance:m/s,triangleCount:6*n**2,countPerLevelSide:v,globalRotationRadians:h,radius:p,ringCircle:t,center:O(i)}}initColor(){let{isMultiColor:e,levels:t,colorPerLevel:i,colorCount:n,...s}=this.config,r=e?i?t:Math.min(n,t):1;return new K({...s,isMultiColor:e,colorCount:r})}setUpDraw(e){this.stepCount||(this.stepCount=this.getStepCount(e)),this.config.isMultiColor?this.colorMap=this.color.getColorMap({stepCount:this.color.config.colorCount,colorCount:this.color.config.colorCount}):this.colorMap=null}getAspectRatio(){return 1}#ej(e,{center:t,rotation:i,isCapLevel:n,triangleIndexInSide:s,withPoint:r}){let a;n&&(a=this.#eH((s+2)%3));let o=[,,,].fill(null).map((e,i)=>i===a?[]:[t]);r(0,0,t);for(let s=0;s<3;s++){if(n&&s===a)continue;let l=i+E/3*s,c=o[s],u=Math.cos(l),d=Math.sin(l);for(let i=1;i<=this.config.density;i++){let n=i*e.nailDistance,a=[t[0]+n*u,t[1]+n*d];c.push(a),r(s,i,a)}}return o}getNails(e){let{levels:t,renderCaps:i}=this.config,n=this.calc.nailsLength,s=this.calc.triangleHeight-n,r=i?t+1:t,a=new es(e);for(let e=0;e<r;e++){let r=i&&e===t,o=this.calc.countPerLevelSide[e],l=ec(o,t=>{let i=t%2==0,r=[this.calc.triangleCenterDistance*(t-e),e*this.calc.triangleHeight+(i?n:s)];return{rotation:Math.atan(r[0]/r[1]),distanceFromCenter:Math.hypot(r[0],r[1])}}),c=0;for(let t=0;t<6;t++){let i=eT[t];for(let n=0;n<o;n++){if(r&&n%2==0){c++;continue}let{distanceFromCenter:s,rotation:o}=l[n],u=i-o-this.calc.globalRotationRadians,d=[this.calc.center[0]+s*Math.cos(u),this.calc.center[1]-s*Math.sin(u)];this.#ej(this.calc,{center:d,rotation:i+t*E/3-n*eI+this.calc.globalRotationRadians,isCapLevel:r,triangleIndexInSide:n,withPoint:(t,i,n)=>{a.addNail(this.#eU(e,c,t,i),n)}}),c++}}}if(this.config.renderRing){let e=new en;this.calc.ringCircle.addNails(e),a.addGroup(e,"ring")}return a}*generateTriangleStrings(e,{level:t,indexInSide:i,triangleIndex:n,isCapLevel:s}){e.startLayer({color:this.color.getColor(t),name:"triangles"});let{density:r}=this.config,a=s?this.#eH(i%3):0,o=s?a:2,l=s?r:r-1;for(let i=a;i<=o;i++){let s=this.#eH(i,1);e.goto(this.#eU(t,n,0,0));for(let a=0;a<=l;a++){let o=a%2==0,l=o?r-a:a,c=o?s:i;e.stringTo(this.#eU(t,n,c,l)),yield,a<r&&(e.stringTo(this.#eU(t,n,c,o?l-1:l+1)),yield)}}}*generateFill(e,{triangle1Index:t,triangle2Index:i,triangle1Level:n,triangle2Level:s,triangleIndexInSide:r,isNextLevel:a}){let{density:o,fillColor:l}=this.config,c=this.calc.countPerLevelSide[n],u=t%c%3;e.startLayer({color:l,name:"fill"});let d=r===c-1,h=a?[this.#eH(u),this.#eH(u,-1)]:[u,this.#eH(u,r%2?1:-1)];for(let r=0;r<2;r++)for(let{pointIndex:a,triangle1Side:o,triangle2Side:l}of p.call(this,r))e.goto(this.#eU(n,t,o,a)),e.stringTo(this.#eU(s,i,l,a)),yield;function*p(e){let t=h[e],i=(function(){return a?this.#eH(t):0===e&&d?1:1===e&&d?0:this.#eH(t,1)}).call(this),n=e?o:o-1;if(0===e)for(let e=0;e<=n;e++)yield{pointIndex:o-e,triangle1Side:t,triangle2Side:i};else for(let e=n;e>=1;e--)yield{pointIndex:o-e,triangle1Side:t,triangle2Side:i}}}#eH(e,t=1){let i=e+t;return i<0?2:i>2?0:i}*drawStrings(e){let{fill:t,renderTriangles:i,renderCaps:n,levels:s,renderRing:r,ringSize:a,ringColor:o}=this.config,l=n?s+1:s;for(let r=0;r<l;r++){let a=r===s,o=6*(2*r+1),l=o-1;for(let c=0;c<o;c++){let o=this.calc.countPerLevelSide[r],u=c%o;if(t&&!a&&(0===c&&(yield*this.generateFill(e,{triangle1Index:l,triangle2Index:c,triangle1Level:r,triangle2Level:r,triangleIndexInSide:l%o})),c!==l&&(yield*this.generateFill(e,{triangle1Index:c,triangle2Index:c+1,triangle1Level:r,triangle2Level:r,triangleIndexInSide:u})),u%2==0&&(n&&i||r<s-1))){let t=Math.floor(c/o)*this.calc.countPerLevelSide[r+1]+u+1;yield*this.generateFill(e,{triangle1Index:c,triangle2Index:t,triangle1Level:r,triangle2Level:r+1,triangleIndexInSide:u,isNextLevel:!0})}i&&(!a||u%2)&&(yield*this.generateTriangleStrings(e,{level:r,indexInSide:u,triangleIndex:c,isCapLevel:a}))}}r&&a&&(e.startLayer({name:"Ring",color:o}),yield*this.calc.ringCircle.drawRingLayer(e,{ringSize:a/2,nailGroup:"ring"}))}getStepCount(e){if(this.stepCount)return this.stepCount;let t=this.calc??this.getCalc(e),{density:i,renderTriangles:n,renderCaps:s,levels:r,fill:a}=this.config,{triangleCount:o,ringCircle:l}=t,c=n&&s?6*r:0,u=0;if(a){let e=e=>6*(2*e+1);for(let t=0;t<r;t++)u+=e(t)+6*t;u+=c}let d=u*i*2;return(n?o*i*6:0)+c*(2*i+1)+d+(l?l.getRingStepCount():0)}getNailCount(){return this.#eG()+(this.config.renderRing?this.config.ringNailCount:0)}#eG(){let{levels:e,renderCaps:t,density:i}=this.config;return 6*e**2*((i-1)*3+1)+(e*(e+1)/2*6+1)+(t?6*e:0)*((i-1)*2+1)}#eU(e,t,i,n){return n?1e6*e+1e3*t+100*i+n:1e6*e+1e3*t}thumbnailConfig=({density:e})=>({density:Math.min(e,3)})},ez,e$,eF,eB,eU,eY,eJ];function eZ(e){let t=eX.find(({type:t})=>t===e);return t?new t:tr.getPatternByID(e)}function eQ(e){let{defaultConfig:t,config:i}=e,n=Object.entries(i).map(([e,i])=>i===t[e]?null:"boolean"==typeof i?`!${+!!i}`:"number"==typeof i?parseFloat(i.toFixed(6)):i);for(;null===n[n.length-1];)n.pop();return n.length?n.join("_").replace(/\_{2,}/g,e=>"~"+e.length+"_"):""}const e0=/^\-?\d+(\.\d+)?$/,e1=/^(?:!)([01])$/;function e2(e,{renderer:t,patternAsTemplate:i=!1}={}){let n=e.isDefaultConfig?void 0:eQ(e);return`/?pattern=${!i?e.id:e.type}${n?`&config=${encodeURIComponent(n)}`:""}${"svg"===t?"&renderer=svg":""}`}function e3(){let e=new URLSearchParams(document.location.search);return{pattern:e.get("pattern"),config:e.get("config"),name:e.get("name"),renderer:"svg"===e.get("renderer")?"svg":null,dialog:e.get("dialog")}}const e5=new class extends s{#eW;#eK="canvas";#eY=null;#eJ=null;constructor(){super();let e=this.#eW=({state:e})=>{this.#eX(e??{})};"undefined"!=typeof window&&window.addEventListener("popstate",e)}#eX(e){let{pattern:t,name:i,config:n,renderer:s="canvas",dialog:r,folder:a}=e,o="svg"===s?"svg":"canvas";if(o!==this.#eK&&(this.#eK=o,this.emit("renderer",o)),t){let e=eZ(t);if(e)i&&(e.name=i),n&&e.setConfig(function(e,t){let i=t.replace(/(?:~)(\d+)(?:_)/g,(e,t)=>Array(+t).fill("_").join("")).split("_").map(e=>{if(""===e)return null;if(e0.test(e))return parseFloat(e);let t=e.match(e1);return t?"1"===t[1]:e}),n=Object.keys(e.defaultConfig);return i.reduce((e,t,i)=>{if(null!==t){let s=n[i];return{...e,[s]:t}}return e},{})}(e,n)),this.emit("pattern",{pattern:e,renderer:o});else throw Error(`Unknown pattern with ID "${t}".`)}else this.emit("main",null);r&&r!==this.#eY?this.navigateToDialog(r,!1):this.#eY&&!r&&this.closeDialog(!1),a!=this.#eJ&&(this.emit("folder",this.#eJ=a??"design"),this.#eJ=a)}init(){if(history.state?.patternId)this.#eX(history.state);else{let e=e3();this.#eX(e)}}destroy(){window.removeEventListener("popstate",this.#eW)}navigateToMain(){history.pushState({patternId:null},"String Art Studio","./"),this.emit("main",null)}navigateToPattern(e,{renderer:t="canvas",replaceState:i=!1}={}){let n=e.isDefaultConfig?void 0:eQ(e);(i?history.replaceState:history.pushState).bind(history)({pattern:e.id,config:n,renderer:t,name:e.name},e.name,e2(e,{renderer:t,patternAsTemplate:!1})),i||this.emit("pattern",{pattern:e,renderer:t}),this.#eY&&this.closeDialog(!1),this.emit("folder","design")}navigateToFolder(e){this.#eJ=e,history.pushState({...history.state,folder:e},null,`/${"design"===e?"":e}${document.location.search}`)}navigateToDialog(e,t=!0){let i=e3();if(this.#eY)if(this.#eY==e)return;else this.emit("dialogClosed",i.dialog),this.#eY=null;if(t){if(e)i.dialog=e;else{if(!i.dialog)return;delete i.dialog}history.pushState({...i,folder:history.state.folder},null,`/${"design"===history.state.folder||!history.state.folder?"":history.state.folder}?${function(e){let t=new URLSearchParams;for(let i in e){let n=e[i];n&&t.append(i,n)}return t.toString()}(i)}`)}e&&(this.#eY=e,this.emit("dialog",e))}closeDialog(e=!0){this.#eY&&(this.emit("dialogClosed",this.#eY),this.#eY=null,e&&history.back())}},e4="prompt_dialog";function e6({value:e,dialogId:t,...n}){let s=document.querySelector(`#${e4}`);return s||((s=document.createElement("input-dialog")).id=e4,document.body.appendChild(s)),["title","description","submit","cancel","type","submitIcon"].forEach(e=>{null!=n[e]&&""!==n[e]?s.setAttribute(function(e){switch(e){case"title":return"dialog-title";case"submitIcon":return"submit-icon";default:return e}}(e),n[e]):s.removeAttribute(e)}),e5.navigateToDialog(t),i=()=>{s.close(),i=null},s.show(e).finally(()=>{e5.closeDialog()})}const e8="confirm_dialog";function e7(e){let t=document.querySelector(`#${e8}`);return t||((t=document.createElement("confirm-dialog")).id=e8,document.body.appendChild(t)),["title","description","submit","cancel","type"].forEach(i=>{null!=e[i]&&""!==e[i]?t.setAttribute("title"===i?"dialog-title":i,e[i]):t.removeAttribute(i)}),e5.navigateToDialog(e.dialogId),i=()=>{t.close(),i=null},t.show().finally(()=>{e5.closeDialog()})}e5.addEventListener("dialogClosed",()=>{i?.()});const e9="http://www.w3.org/2000/svg";class te extends k{svg;backgroundGroup;background=null;linesGroup;nailsGroup;nailsCirclesGroup;nailsTextGroup;currentColor=null;lineWidth=1;currentLineGroup=null;constructor(e){super(e),this.svg=document.createElementNS(e9,"svg"),this.svg.style.setProperty("display","block"),this.backgroundGroup=document.createElementNS(e9,"g"),this.backgroundGroup.setAttribute("data-id","background"),this.linesGroup=document.createElementNS(e9,"g"),this.linesGroup.setAttribute("data-id","lines"),this.nailsGroup=document.createElementNS(e9,"g"),this.nailsGroup.setAttribute("data-id","nails"),this.nailsCirclesGroup=document.createElementNS(e9,"g"),this.nailsCirclesGroup.setAttribute("data-id","nailsCircles"),this.nailsTextGroup=document.createElementNS(e9,"g"),this.nailsTextGroup.setAttribute("data-id","nailsText"),this.nailsGroup.appendChild(this.nailsCirclesGroup),this.nailsGroup.appendChild(this.nailsTextGroup),this.svg.appendChild(this.backgroundGroup),this.svg.appendChild(this.linesGroup),this.svg.appendChild(this.nailsGroup),this.svg.setAttribute("xmlns",e9),e.appendChild(this.svg)}get element(){return this.svg}resetSize(){super.resetSize(),this.svg.style.removeProperty("width"),this.svg.style.removeProperty("height");let e=this.getSize().map(Math.trunc),[t,i]=e;return this.svg.setAttributeNS(e9,"viewBox",`0 0 ${t} ${i}`),this.svg.setAttributeNS(e9,"width",String(t)),this.svg.setAttributeNS(e9,"height",String(i)),this.svg.style.width=t+"px",this.svg.style.height=i+"px",this.currentSize&&L(e,this.currentSize)||(this.currentSize=e,this.emit("sizeChange",{size:e})),e}resetNails(){this.nailsCirclesGroup.innerHTML="",this.nailsTextGroup.innerHTML=""}resetStrings(){this.linesGroup.innerHTML="",this.currentColor=null,this.lineWidth=null}setColor(e){e!==this.currentColor&&(this.currentLineGroup=document.createElementNS(e9,"g"),this.currentLineGroup.setAttribute("stroke",e),this.currentLineGroup.setAttribute("stroke-width",String(this.lineWidth)),this.linesGroup.appendChild(this.currentLineGroup),this.currentColor=e)}setLineWidth(e){this.lineWidth=e??"1",this.linesGroup.setAttributeNS(e9,"stroke-width",String(e??1)),this.linesGroup.childNodes.forEach(t=>{t instanceof SVGGElement&&t.setAttributeNS(e9,"stroke-width",String(e??1))})}setBackground(e){e?(this.background||(this.background=document.createElementNS(e9,"rect"),this.background.setAttribute("width","100%"),this.background.setAttribute("height","100%"),this.backgroundGroup.appendChild(this.background)),this.background.setAttribute("fill",e)):(this.background=null,this.backgroundGroup.innerHTML="")}getSize(){return[this.svg.clientWidth,this.svg.clientHeight]}setSize(e){if(!e)return this.resetSize();if(this.fixedSize)return console.warn(`Trying to set size for Renderer to [${e.join(", ")}], but size is fixed to [${this.fixedSize.join(", ")}].`),this.fixedSize;this.svg.removeAttributeNS(e9,"width"),this.svg.removeAttributeNS(e9,"height"),this.svg.style.width=`${e[0]}px`,this.svg.style.height=`${e[1]}px`;let t=e.map(Math.trunc),[i,n]=t;return this.svg.setAttributeNS(e9,"viewBox",`0 0 ${i} ${n}`),this.svg.setAttributeNS(e9,"width",String(i)),this.svg.setAttributeNS(e9,"height",String(n)),this.currentSize&&L(t,this.currentSize)||(this.currentSize=t,this.emit("sizeChange",{size:t})),t}renderLine(e,t){this.lastStringCoordinates=e,this.lineTo(t)}lineTo(e){if(!this.lastStringCoordinates)throw Error("no last string coordinates, can't lineTo");let t=document.createElementNS(e9,"line");t.setAttribute("x1",String(Math.trunc(this.lastStringCoordinates[0]))),t.setAttribute("y1",String(Math.trunc(this.lastStringCoordinates[1]))),t.setAttribute("x2",String(Math.trunc(e[0]))),t.setAttribute("y2",String(Math.trunc(e[1]))),this.currentLineGroup.appendChild(t),this.lastStringCoordinates=e}clearInstructions(){}renderInstructions(e,t){}renderInstructionsForLastLine(){}hideInstructions(){}showInstructions(){}renderNails(e,{color:t,fontSize:i,radius:n,renderNumbers:s,margin:r=0,numbersStart:a=1}){let o=this.getSize()[0]/2,l=document.createDocumentFragment(),c=document.createDocumentFragment(),u=n+r;this.nailsTextGroup.style.fontSize=String(i);let d=a;for(let[t,i]of e){let e=document.createElementNS(e9,"circle");if(e.setAttribute("cx",String(t)),e.setAttribute("cy",String(i)),e.setAttribute("r",String(n)),l.appendChild(e),s&&null!=d){let e=t<o,n=[e?t-u:t+u,i],s=document.createElementNS(e9,"text");s.innerHTML=String(d),s.setAttribute("x",String(n[0])),s.setAttribute("y",String(n[1])),e&&s.setAttribute("text-anchor","end"),c.appendChild(s)}d++}this.nailsCirclesGroup.appendChild(l),this.nailsTextGroup.appendChild(c),null!=t&&(this.nailsCirclesGroup.setAttribute("fill",t),this.nailsTextGroup.setAttribute("fill",t))}clear(){this.linesGroup.innerHTML="",this.nailsGroup.innerHTML=""}toDataURL(){return""}}function tt({data:e,filename:t}){let i=URL.createObjectURL(e),n=document.createElement("a");n.href=i,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}async function ti(e,{type:t,...i}){let n=function(e){let t={};return e.margin&&(t.margin=T(e.margin,e.units??"px","px",e.dpi)),e.isNailsMap&&Object.assign(t,{darkMode:!1,showNails:!0,showNailNumbers:e.includeNailNumbers,showStrings:!1,nailsColor:"#000000",backgroundColor:"#ffffff"}),null!=e.enableBackground&&Object.assign(t,{enableBackground:e.enableBackground}),0===Object.keys(t).length?null:t}(i);n&&(e=e.copy()).assignConfig(n),i.units&&(i={...i,size:A(i.size,i.units,"px",i.dpi)}),tt("svg"===t?function(e,{size:t,filename:i}){let n=document.createElement("article");n.style.width=t[0]+"px",n.style.height=t[1]+"px",document.body.appendChild(n);let s=new te(n);return s.setFixedSize(t),e.draw(s),{data:new Blob([s.svg.outerHTML],{type:"image/svg+xml;charset=utf-8"}),filename:i??e.name+".svg"}}(e,i):await tn(e,i))}async function tn(e,{size:t,filename:i,imageType:n}){let s=new B(document.createElement("article"),{updateOnResize:!1});return s.disablePixelRatio(),s.setFixedSize(t),e.draw(s),{data:await s.toBlob(n),filename:`${i??e.name}.${n??"png"}`}}const ts="string_art_app_data";class tr extends s{elements;currentPattern;constructor(){super(),this.elements={saveDialog:document.querySelector("#save_dialog")},document.querySelector("#save_btn").addEventListener("click",()=>{this.currentPattern.isTemplate?this.showSaveAsDialog():this.saveCurrentPattern()})}showSaveAsDialog(){let e=this.#eZ(),t=e3().name??`Pattern #${e}`;e6({title:"Save pattern",description:"Name this pattern:",submit:"Save",value:t,dialogId:"save_as"}).then(e=>{this.saveNewPattern({type:this.currentPattern.type,config:this.currentPattern.config,name:null==e||""===e?t:e})},()=>{})}setPattern(e){this.currentPattern=e}static patternDataToStringArt({type:e,...t}){let i=function(e){let t=eX.find(({type:t})=>t===e);if(!t)throw Error(`Unknown pattern type, "${e}"!`);return new t}(e);return Object.assign(i,t),i.markConfigAsDefault(),i}static getSavedPatterns(){let{patterns:e}=this.loadAppData();return e.map(this.patternDataToStringArt)}static getPatternByID(e){let t=this.loadPatternDataById(e);return t?this.patternDataToStringArt(t):null}static loadPatternDataById(e){let{patterns:t}=this.loadAppData();return t.find(({id:t})=>t===e)}#eZ(){let e=tr.loadAppData(),t=e?.patterns?.length?Number(e.patterns[e.patterns.length-1].id):0;return String(isNaN(t)?1:t+1)}saveNewPattern(e){let t=tr.loadAppData(),i=this.#eZ(),n={...e,id:i};return t.patterns.push(n),tr.saveAppData(t),this.emit("newPattern",{pattern:tr.patternDataToStringArt(n)}),n}savePattern(e){let t=tr.loadAppData(),i=t.patterns.findIndex(({id:e})=>e===this.currentPattern.id);-1!==i&&(t.patterns[i]=e,tr.saveAppData(t),this.emit("save",{pattern:tr.patternDataToStringArt(e)}))}saveCurrentPattern(){let e={id:this.currentPattern.id,name:this.currentPattern.name,type:this.currentPattern.type,config:this.currentPattern.config};return this.savePattern(e),e}renameCurrentPattern(){e6({title:"Rename",description:"Name this pattern:",submit:"Save",value:this.currentPattern.name,dialogId:"rename"}).then(e=>{if(e!==this.currentPattern.name){let t=tr.loadPatternDataById(this.currentPattern.id);t.name=e,this.savePattern(t)}this.currentPattern.name=e})}deletePattern(){e7({title:"Delete pattern",description:"Are you sure you wish to delete this pattern?",submit:"Delete",type:"error",dialogId:"delete"}).then(()=>{let e=tr.loadAppData(),t=e.patterns.findIndex(({id:e})=>e===this.currentPattern.id);if(-1===t)throw Error(`Can't delete pattern with ID "${this.currentPattern.id}", it's not found!`);let i=e.patterns.splice(t,1)[0];tr.saveAppData(e);let n=tr.patternDataToStringArt(i);n.resetDefaultConfig(),this.emit("deletePattern",{pattern:n})},()=>{})}exportAllPatterns(){tt({data:new Blob([JSON.stringify(tr.loadAppData(),null,2)],{type:"application/json"}),filename:"String Art Studio patterns.json"})}importPatterns({patterns:e}){if(!e)throw Error("Data does not include patterns.");e.forEach(({id:e,...t})=>this.saveNewPattern(t))}static savePatternDownloadData(e,t){let i=tr.loadAppData();i.downloadData||(i.downloadData={}),i.downloadData[e]=t,this.saveAppData(i)}static savePatternDownloadInstructionsData(e,t){let i=tr.loadAppData();i.downloadInstructionsData||(i.downloadInstructionsData={}),i.downloadInstructionsData[e]=t,this.saveAppData(i)}static getPatternDownloadData(e){let t=tr.loadAppData();return t.downloadData?.[e]}static getPatternDownloadInstructionsData(e){let t=tr.loadAppData();return t.downloadInstructionsData?.[e]}static loadAppData(){let e=localStorage.getItem(ts);try{return e?JSON.parse(e):{patterns:[],downloadData:{},downloadInstructionsData:{}}}catch(e){throw Error("App data is corrupted, failed to load it. "+e.message)}}static saveAppData(e){localStorage.setItem(ts,JSON.stringify(e))}}const ta="minimized";class to extends s{elements={root:document.querySelector("#pattern_select_panel"),thumbnails:document.querySelector("#thumbnails"),toggleBtn:document.querySelector("#pattern_select_btn"),dropdown:document.querySelector("#pattern_select_dropdown"),patternName:document.querySelector("#pattern_name")};pattern;thumbnailsRendered=!1;_onClickOutside;constructor(e){super(),this.elements.toggleBtn.addEventListener("click",()=>this.toggle()),e.addEventListener("newPattern",({pattern:e})=>{this.isOpen?this.createThumbnails():this.thumbnailsRendered=!1,this.setCurrentPattern(e),this.emit("select",{patternId:e.id})}),e.addEventListener("save",({pattern:e})=>{this.isOpen?this.createThumbnails():this.thumbnailsRendered=!1,this.setCurrentPattern(e)}),e.addEventListener("deletePattern",({pattern:e})=>{this.isOpen?this.elements.thumbnails.querySelector(`[data-pattern="${e.id}"]`).remove():this.thumbnailsRendered=!1}),this.elements.thumbnails.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();let t=e.target instanceof HTMLElement&&e.target.closest("[data-pattern]");if(!t)return!1;this.emit("select",{patternId:t.dataset.pattern})}),e5.addEventListener("dialog",e=>{"thumbnails"===e?this.isOpen||this.open():this.close()}),e5.addEventListener("dialogClosed",e=>{"thumbnails"===e&&this.close()})}get isOpen(){return!this.elements.root.classList.contains(ta)}toggle(){this.isOpen?this.pattern&&(this.close(),e5.closeDialog()):(this.open(),e5.navigateToDialog("thumbnails"))}open(){this.isOpen||(this.elements.root.classList.remove(ta),this.thumbnailsRendered||(this.createThumbnails(),this.thumbnailsRendered=!0),this._onClickOutside=e=>{e.target instanceof HTMLElement&&!e.target.closest("#pattern_select_panel")&&this.toggle()},document.body.addEventListener("mousedown",this._onClickOutside))}close(){this.isOpen&&(this.elements.root.classList.add(ta),document.body.removeEventListener("mousedown",this._onClickOutside),this._onClickOutside=null)}setCurrentPattern(e){this.pattern=e,this.elements.patternName.innerText=e?.name??"Choose a pattern"}#eQ(e,t){let i=document.createElement("section"),n=document.createElement("h3");n.className="pattern_select_thumbnails_title",n.innerText=e,i.appendChild(n);let s=document.createElement("ul");s.className="pattern_select_thumbnails",i.appendChild(s);let r=document.createDocumentFragment(),a={};t.forEach(e=>{let t=document.createElement("a");t.style.width=t.style.height="100px",a[e.id]=t;let i=e.thumbnailConfig;e.assignConfig({margin:1,enableBackground:!e.config.darkMode||e.config.customBackgroundColor,nailRadius:.5,...i instanceof Function?i(e.config):i});let n=document.createElement("li");r.appendChild(n),t.href=`?pattern=${e.id}`,t.setAttribute("data-pattern",e.id),t.title=e.name,n.appendChild(t)}),s.appendChild(r),this.elements.thumbnails.appendChild(i),t.forEach(e=>{let t=new B(a[e.id],{updateOnResize:!1});t.setSize([100,100]);try{e.draw(t)}catch(t){console.error(`Failed to render thumbnail for pattern [id=${e.id}]`,t)}})}createThumbnails(){this.elements.thumbnails.innerHTML="",tr.getSavedPatterns().length&&this.#eQ("My Patterns",tr.getSavedPatterns());let e=eX.map(e=>new e);this.#eQ("Built-in patterns",e)}}async function tl(e){try{navigator.share(await td(e))}catch(e){alert("Error: "+e.message)}}async function tc(){if(!navigator.share)return!1;let e=document.createElement("canvas");e.width=1,e.height=1;let t=e.getContext("2d");t.fillStyle="black",t.fillRect(0,0,1,1);let i=e.toDataURL(),n=await tu(i,"test","test.jpg");return navigator.canShare(n)}async function tu(e,t,i,n){let s=await (await fetch(e)).blob(),r=[new File([s],i,{type:s.type,lastModified:new Date().getTime()})];return{url:n??window.location.href,files:r,title:document.title,text:t}}async function td({renderer:e,pattern:t}){return tu(e.toDataURL(),"String Art Studio - "+t.name,t.name+".jpg",e2(t,{renderer:e instanceof te?"svg":"canvas",patternAsTemplate:!0}))}async function th(){if(navigator.serviceWorker&&"127.0.0.1"!==document.location.hostname)try{let e=await navigator.serviceWorker.register("service-worker.js");e.onupdatefound=()=>{let t=e.installing;null!=t&&(t.onstatechange=()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."):console.log("Content is cached for offline use."))})}}catch(e){console.error("Error during service worker registration:",e)}}var tp={};tp=".hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}#inputs,#readonly{white-space:nowrap}#readonly{font-size:14px}input{width:70px}#connector.linked{display:inline-block;transform:rotate(45deg)}";const tg=new CSSStyleSheet;tg.replaceSync(String(tp));const tf=["width","height"];class tm extends HTMLElement{static formAssociated=!0;internals;#e0;#e1;#e2;#e3;#e5=!1;floatingPoints;#e4;constructor(){super();let e=this.attachShadow({mode:"open",delegatesFocus:!0});e.adoptedStyleSheets=[tg],this.shadowRoot.innerHTML=`
      <span id="inputs">
        <input
          type="number"
          id="width"
          maxlength="3"
          min="1"
          class="dialog-input size-input"
          name="width"
        />
        <span id="connector">&times;</span>
        <input
          type="number"
          id="height"
          maxlength="3"
          min="1"
          class="dialog-input size-input"
          name="height"
        />
      </span>
      <span id="readonly" hidden></span>
    `,this.#e0={width:{element:e.querySelector("#width"),value:0,max:null,defaultValue:null},height:{element:e.querySelector("#height"),value:0,max:null,defaultValue:null}},this.#e4=e.querySelector("#connector"),this.#e1=e.querySelector("#inputs"),this.#e2=e.querySelector("#readonly"),this.internals=this.attachInternals()}static get observedAttributes(){return["width","height","aspect-ratio","max-width","max-height","readonly","default-width","default-height","floating-points"]}get inputs(){return[this.#e0.width.element,this.#e0.height.element]}get width(){return this.#e0.width.value}set width(e){this.setDimensionValue("width",e,{updateOtherDimensionOnce:!0})}get height(){return this.#e0.height.value}set height(e){this.setDimensionValue("height",e,{updateOtherDimensionOnce:!0})}get value(){return[this.width,this.height]}set value(e){if("string"==typeof e){let t=e.match(/^(\d+(?:\.\d+)?),\s?(\d+(?:\.\d+)?)$/);t&&(this.width=Number(t[1]),this.height=Number(t[2]))}else this.width=e[0],this.height=e[1]}get maxWidth(){return this.#e0.width.max}get maxHeight(){return this.#e0.height.max}set maxWidth(e){this.setMaxDimensionValue("width",e)}set maxHeight(e){this.setMaxDimensionValue("height",e)}get isReadonly(){return this.#e5}set isReadonly(e){(this.#e5=e&&"false"!==e)?(y(this.#e1),v(this.#e2)):(v(this.#e1),y(this.#e2))}#e6(){this.#e2.innerHTML=`${this.width} &times; ${this.height}`}applyAspectRatio(e,t){return this.#e3?"width"===e?t*this.#e3:t/this.#e3:t}getOtherDimension(e){return"width"===e?"height":"width"}get aspectRatio(){return this.#e3}set aspectRatio(e){this.#e3=e?Number(e):null,isNaN(this.#e3)&&(this.#e3=null),this.#e3?(this.#e4.classList.contains("linked")||this.#e4.classList.add("linked"),this.#e4.innerHTML="\uD83D\uDD17"):(this.#e4.classList.remove("linked"),this.#e4.innerHTML="&times;")}setMaxDimensionValue(e,t,i=!0){let n=this.#e0[e],s=t=Number(t);if(null!=this.floatingPoints&&(s=t.toFixedPrecision(this.floatingPoints)),s!==n.max&&(n.max=isNaN(s)?null:s,n.max?(n.value&&n.value>s&&(this[e]=s),n.element.setAttribute("max",String(n.max))):n.element.removeAttribute("max"),i&&this.#e3)){let i=this.getOtherDimension(e),n=this.applyAspectRatio(i,t);(!this.#e0[i].max||n<this.#e0[i].max)&&this.setMaxDimensionValue(i,n,!1)}}setMaxDimensions(e){this.setMaxDimensionValue("width",e[0],!1),this.setMaxDimensionValue("height",e[1],!1)}setDimensionValue(e,t,{updateOtherDimension:i=!0,updateOtherDimensionOnce:n=!1}={}){let s=this.#e0[e],r=t;if(null!=this.floatingPoints&&(r=t.toFixedPrecision(this.floatingPoints)),r!==this[e]){if(isNaN(r))console.warn("Attempting to set a NaN value to DimensionsInput width.");else{if(s.max&&(r=Math.min(r,s.max)),s.value=r,s.element.value=String(null!=this.floatingPoints?r.toFixedPrecision(this.floatingPoints):r),i&&this.#e3){let t=this.getOtherDimension(e);this.setDimensionValue(t,this.applyAspectRatio(t,r),{updateOtherDimension:n})}this.#e6()}this.#e8()}}attributeChangedCallback(e,t,i){"aspect-ratio"===e?this.aspectRatio=i:"max-width"===e?this.maxWidth=i:"max-height"===e?this.maxHeight=i:"floating-points"===e?this.setFloatingPoints(Number(i)):"readonly"===e&&(this.isReadonly=i)}connectedCallback(){this.shadowRoot.addEventListener("input",e=>this.#f(e)),this.shadowRoot.addEventListener("focusin",e=>{e.target instanceof HTMLInputElement&&e.target.select()}),this.#e7()}#f(e){if(e.target instanceof HTMLInputElement){let t=Number(e.target.value);for(let i of tf)if(e.target===this.#e0[i].element){this[i]=t,this.dispatchEvent(new CustomEvent("dimensionchange",{detail:{value:this.value,dimension:i,width:this.width,height:this.height}}));break}this.#e8()}}#e8(){this.internals.setFormValue(String(this.value.join(",")))}#e7(){for(let e of tf){let t=this.#e0[e];if(this.hasAttribute("default-"+e)){let i=Number(this.getAttribute("default-"+e));t.defaultValue=isNaN(i)?0:i,t.element.placeholder=String(i)}if(this.setMaxDimensionValue(e,this.getAttribute("max-"+e)),this.hasAttribute(e)){let i=Number(this.getAttribute(e));this[e]=isNaN(i)?t.defaultValue:i}}if(this.aspectRatio=this.getAttribute("aspect-ratio"),this.isReadonly=this.getAttribute("readonly"),this.hasAttribute("floating-points")){let e=Number(this.getAttribute("floating-points"));this.setFloatingPoints(isNaN(e)?null:e)}}setFloatingPoints(e){null==e||isNaN(e)?(this.floatingPoints=null,this.inputs.forEach(e=>e.removeAttribute("step"))):(this.floatingPoints=e,this.inputs.forEach(e=>e.setAttribute("step",String(1/10**this.floatingPoints))),tf.forEach(t=>{this[t]&&(this[t]=this[t].toFixedPrecision(e))}))}}customElements.define("dimensions-input",tm);class tv extends HTMLElement{button;#e9;constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
      <style>
        :host {
          display: inline-block;
          position: relative;
        }

        button {
          display: block;
          padding: 10px 15px;
          background: transparent;
          color: white;
          border: none;
          cursor: pointer;
          font: inherit;
        }

        button:hover {
          background: #444;
        }

        button:focus {
          background: rgba(255,255,255,.2)
        }
        ul {
          display: none;
          position: absolute;
          top: 100%;
          right: 0;
          min-width: 120px;
          background: var(--color-dialog-background);
          border: var(--border-dialog);
          margin: 0;
          padding: 0;
          list-style: none;
          z-index: 1000;
          box-shadow: 1px 1px 10px rgba(0,0,0,.7)
        }

        :host(.open) ul {
          display: block;
        }
      </style>

      <button aria-haspopup="true" aria-expanded="false">
        <slot name="label">Menu</slot>
      </button>
      <ul role="menu">
        <slot></slot>
      </ul>
    `}connectedCallback(){this.button=this.shadowRoot.querySelector("button"),this.button.addEventListener("click",()=>this.toggle()),this.#e9&&(this.button.style=this.#e9),document.addEventListener("click",e=>{this.contains(e.target)||this.shadowRoot.contains(e.target)||this.close()}),this.button.addEventListener("keydown",e=>{"Escape"===e.key&&(this.close(),this.button.focus())}),this.addEventListener("item-selected",e=>{this.dispatchEvent(new CustomEvent("select",{detail:{value:e.detail.value},bubbles:!0,composed:!0})),this.close()})}static get observedAttributes(){return["button-style"]}attributeChangedCallback(e,t,i){"button-style"===e&&(this.button?this.button.style=i:this.#e9=i)}toggle(){let e=this.classList.toggle("open");this.button.setAttribute("aria-expanded",String(e))}close(){this.classList.remove("open"),this.button.setAttribute("aria-expanded","false")}}customElements.define("dropdown-menu",tv);class ty extends HTMLElement{static get observedAttributes(){return["value","selected"]}value="";#te;constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
      <style>
        li {
          list-style: none;
          padding: 12px 40px 12px 20px;
          color: White;
          text-decoration: none;
          white-space: nowrap;
          background: transparent;
          cursor: pointer;
        }
        li:hover {
          background: rgba(255,255,255,.1);
        }

        li.selected {
          color: var( --color-accent);
          pointer-events: none;
        }

        span:not(:empty) {
          float: left; 
          margin-right: .5em;
          position: relative;
          left: -4px;
          top: 1px;
        }
      </style>
      <li role="menuitem" ${this.hasAttribute("selected")?'class="selected"':""}>
        <span id="icon"><slot name="icon"></span>
        <slot></slot>
      </li>
    `,this.#te=this.shadowRoot.querySelector("li")}connectedCallback(){this.shadowRoot.querySelector("li").addEventListener("click",e=>{e.preventDefault(),this.dispatchEvent(new CustomEvent("item-selected",{detail:{value:this.value},bubbles:!0,composed:!0}))})}attributeChangedCallback(e,t,i){"value"===e?this.value=i:"selected"===e&&(i?this.#te.classList.add("selected"):this.#te.classList.remove("selected"))}}customElements.define("dropdown-menu-item",ty);class tb extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
      <style>
        hr {
            margin: 8px 0;
            border: solid 1px rgba(255,255,255,.1);
        }
      </style>
      <hr />
    `}}customElements.define("dropdown-menu-separator",tb);var t_={};t_='.hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}@font-face{font-family:string_art_studio;src:url(string_art_studio.9cced145.ttf)format("truetype"),url(string_art_studio.44d13d52.woff)format("woff"),url(string_art_studio.ae7f2e94.svg#string_art_studio)format("svg");font-weight:400;font-style:normal;font-display:block}i{speak:never;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;line-height:1;font-family:string_art_studio!important}.icon-text:before{content:"î¤—"}.icon-step_back:before{content:"î¤•"}.icon-step_forward:before{content:"î¤–"}.icon-thread:before{content:"î¤”"}.icon-rotate:before{content:"î¤“"}.icon-pencil:before{content:"î¤’"}.icon-plus:before{content:"î¤"}.icon-trash:before{content:"î¤‘"}.icon-diskette_b:before{content:"î¤"}.icon-diskette:before{content:"î¤Ž"}.icon-menu:before{content:"î¤€"}.icon-arrow_left:before{content:"î¤"}.icon-arrow_right:before{content:"î¤‚"}.icon-caret_down:before{content:"î¤ƒ"}.icon-download:before{content:"î¤„"}.icon-fullscreen:before{content:"î¤…"}.icon-hamburger:before{content:"î¤†"}.icon-options:before{content:"î¤‡"}.icon-pause:before{content:"î¤ˆ"}.icon-play:before{content:"î¤‰"}.icon-refresh:before{content:"î¤Š"}.icon-share:before{content:"î¤‹"}.icon-thumbnails:before{content:"î¤Œ"}.icon-x:before{content:"î¤"}[hidden]{display:none!important}dialog{background:var(--color-dialog-background);color:#fff;border:var(--border-dialog);box-sizing:border-box;width:400px;max-width:calc(100vw - 20px);margin:0;padding:0;position:fixed;top:100px;left:50%;transform:translate(-50%);box-shadow:0 0 10px #000c}dialog[open]{flex-direction:column;display:flex}#dialog_wrapper{box-sizing:border-box;width:100%;max-height:calc(100vh - 20px);padding:1em;overflow:auto}dialog.centered{top:50%;transform:translate(-50%)translateY(-50%)}dialog::backdrop{background:#000000b3}.dialog-title{color:var(--color-accent);text-shadow:1px 1px 1px #000;margin-top:0;font-size:1.4em;font-weight:400}dialog.error .dialog-title{color:var(--color-error)}.dialog-menu{text-align:end;flex-direction:row;justify-content:end;align-items:center;margin-bottom:0;display:flex}.dialog-menu button{color:#fff;cursor:pointer;background:0 0;border:none;border-radius:4px;margin-inline-start:.5em;padding:8px 16px;font-size:1em}.dialog-menu button.btn-submit{background:var(--color-input)}dialog.error .dialog-menu button.btn-submit{background:var(--color-error)}.dialog-menu button.btn-submit:hover{background:var(--color-input-active)}.dialog-menu .btn-cancel{opacity:.5}.dialog-menu .btn-cancel:hover,.dialog-menu .btn-cancel:focus{opacity:1}.dialog-menu button>i{vertical-align:middle;margin-inline-end:4px;display:inline-block;transform:translateY(-2px)}#dialog_contents{display:flex}#dialog_context_menu{z-index:2;position:absolute;top:0;right:0}';const tw=new CSSStyleSheet;tw.replaceSync(String(t_));class tS extends HTMLElement{dialog;input;static get observedAttributes(){return["dialog-title","description","value","submit","cancel","type","submit-icon"]}constructor(){super();let e=this.attachShadow({mode:"open"});e.adoptedStyleSheets=[tw],this.shadowRoot.innerHTML=`
      <confirm-dialog>
        <input
            type="text"
            class="dialog-input dialog-input-tall"
            name="patternName"
            required
          />
      </confirm-dialog>
    `,this.dialog=e.querySelector("confirm-dialog"),this.input=e.querySelector("input"),this.input.addEventListener("keypress",e=>{"Enter"===e.code&&this.dialog.submit()})}connectedCallback(){this.syncAttributes()}attributeChangedCallback(){this.syncAttributes()}syncAttributes(){tS.observedAttributes.filter(e=>"value"!==e).forEach(e=>{this.hasAttribute(e)?this.dialog.setAttribute(e,this.getAttribute(e)):this.dialog.removeAttribute(e)}),this.hasAttribute("value")&&(this.input.value=this.getAttribute("value")||"")}show(e){return void 0!==e?this.input.value=e:this.hasAttribute("value")&&(this.input.value=this.getAttribute("value")||""),this.input.select(),this.dialog.show().then(()=>this.input.value)}close(){this.dialog.close()}getValue(){return this.input.value}}customElements.define("input-dialog",tS);var tx={};tx='.hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}@font-face{font-family:string_art_studio;src:url(string_art_studio.9cced145.ttf)format("truetype"),url(string_art_studio.44d13d52.woff)format("woff"),url(string_art_studio.ae7f2e94.svg#string_art_studio)format("svg");font-weight:400;font-style:normal;font-display:block}i{speak:never;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;line-height:1;font-family:string_art_studio!important}.icon-text:before{content:"î¤—"}.icon-step_back:before{content:"î¤•"}.icon-step_forward:before{content:"î¤–"}.icon-thread:before{content:"î¤”"}.icon-rotate:before{content:"î¤“"}.icon-pencil:before{content:"î¤’"}.icon-plus:before{content:"î¤"}.icon-trash:before{content:"î¤‘"}.icon-diskette_b:before{content:"î¤"}.icon-diskette:before{content:"î¤Ž"}.icon-menu:before{content:"î¤€"}.icon-arrow_left:before{content:"î¤"}.icon-arrow_right:before{content:"î¤‚"}.icon-caret_down:before{content:"î¤ƒ"}.icon-download:before{content:"î¤„"}.icon-fullscreen:before{content:"î¤…"}.icon-hamburger:before{content:"î¤†"}.icon-options:before{content:"î¤‡"}.icon-pause:before{content:"î¤ˆ"}.icon-play:before{content:"î¤‰"}.icon-refresh:before{content:"î¤Š"}.icon-share:before{content:"î¤‹"}.icon-thumbnails:before{content:"î¤Œ"}.icon-x:before{content:"î¤"}[hidden]{display:none!important}dialog{background:var(--color-dialog-background);color:#fff;border:var(--border-dialog);box-sizing:border-box;width:400px;max-width:calc(100vw - 20px);margin:0;padding:0;position:fixed;top:100px;left:50%;transform:translate(-50%);box-shadow:0 0 10px #000c}dialog[open]{flex-direction:column;display:flex}#dialog_wrapper{box-sizing:border-box;width:100%;max-height:calc(100vh - 20px);padding:1em;overflow:auto}dialog.centered{top:50%;transform:translate(-50%)translateY(-50%)}dialog::backdrop{background:#000000b3}.dialog-title{color:var(--color-accent);text-shadow:1px 1px 1px #000;margin-top:0;font-size:1.4em;font-weight:400}dialog.error .dialog-title{color:var(--color-error)}.dialog-menu{text-align:end;flex-direction:row;justify-content:end;align-items:center;margin-bottom:0;display:flex}.dialog-menu button{color:#fff;cursor:pointer;background:0 0;border:none;border-radius:4px;margin-inline-start:.5em;padding:8px 16px;font-size:1em}.dialog-menu button.btn-submit{background:var(--color-input)}dialog.error .dialog-menu button.btn-submit{background:var(--color-error)}.dialog-menu button.btn-submit:hover{background:var(--color-input-active)}.dialog-menu .btn-cancel{opacity:.5}.dialog-menu .btn-cancel:hover,.dialog-menu .btn-cancel:focus{opacity:1}.dialog-menu button>i{vertical-align:middle;margin-inline-end:4px;display:inline-block;transform:translateY(-2px)}#dialog_contents{display:flex}#dialog_context_menu{z-index:2;position:absolute;top:0;right:0}';var tC={};tC="<dialog>\n  <div id=dialog_wrapper>\n    <div id=dialog_context_menu>\n      <slot name=context-menu></slot>\n    </div>\n    <form method=dialog>\n      <h2 class=dialog-title></h2>\n      <p class=dialog-desc></p>\n      <div id=dialog_contents>\n        <slot></slot>\n      </div>\n      <menu class=dialog-menu>\n        <button type=button class=btn-cancel>Cancel</button>\n        <button value=confirm class=btn-submit>\n          <i id=submit_icon class=icon hidden></i>\n          <span id=submit_text></span>\n        </button>\n      </menu>\n    </form>\n  </div>\n</dialog>\n";const tk=new CSSStyleSheet;tk.replaceSync(String(tx));class tE extends HTMLElement{dialog;cancelBtn;submitBtn;titleEl;descEl;submitText;submitIcon;static get observedAttributes(){return["dialog-title","description","submit","cancel","type","centered","submit-icon","width"]}constructor(){super();let e=this.attachShadow({mode:"open"});e.adoptedStyleSheets=[tk],this.shadowRoot.innerHTML=String(tC),this.dialog=e.querySelector("dialog"),this.cancelBtn=e.querySelector(".btn-cancel"),this.submitBtn=e.querySelector(".btn-submit"),this.titleEl=e.querySelector(".dialog-title"),this.descEl=e.querySelector(".dialog-desc"),this.submitText=e.querySelector("#submit_text"),this.submitIcon=e.querySelector("#submit_icon")}connectedCallback(){this.cancelBtn.addEventListener("click",()=>{this.dialog.returnValue="",this.dialog.close()}),this.syncAttributes()}attributeChangedCallback(){this.syncAttributes()}syncAttributes(){if(this.hasAttribute("dialog-title")&&(this.titleEl.textContent=this.getAttribute("dialog-title")),this.hasAttribute("description")&&(this.descEl.textContent=this.getAttribute("description")),this.submitText.textContent=this.getAttribute("submit")||"Submit",this.cancelBtn.textContent=this.getAttribute("cancel")||"Cancel",this.hasAttribute("type")&&"error"===this.getAttribute("type")?this.dialog.classList.add("error"):this.dialog.classList.remove("error"),this.hasAttribute("centered")&&"false"!==this.getAttribute("centered")?this.dialog.classList.add("centered"):this.dialog.classList.remove("centered"),this.hasAttribute("submit-icon")?(this.submitIcon.className="icon-"+this.getAttribute("submit-icon"),v(this.submitIcon)):y(this.submitIcon),this.hasAttribute("width")){let e=this.getAttribute("width"),t=/^\d+$/.test(e);this.dialog.style.setProperty("width",t?`${e}px`:e)}else this.dialog.style.removeProperty("width")}show(e){return this.dialog.showModal(),e?.(),new Promise((e,t)=>{let i=()=>{this.dialog.removeEventListener("close",i),"confirm"===this.dialog.returnValue?e():t()};this.dialog.addEventListener("close",i)})}close(){this.dialog.close()}submit(){this.submitBtn.click()}}customElements.define("confirm-dialog",tE);var tN={};tN='.hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}@font-face{font-family:string_art_studio;src:url(string_art_studio.9cced145.ttf)format("truetype"),url(string_art_studio.44d13d52.woff)format("woff"),url(string_art_studio.ae7f2e94.svg#string_art_studio)format("svg");font-weight:400;font-style:normal;font-display:block}i{speak:never;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;line-height:1;font-family:string_art_studio!important}.icon-text:before{content:"î¤—"}.icon-step_back:before{content:"î¤•"}.icon-step_forward:before{content:"î¤–"}.icon-thread:before{content:"î¤”"}.icon-rotate:before{content:"î¤“"}.icon-pencil:before{content:"î¤’"}.icon-plus:before{content:"î¤"}.icon-trash:before{content:"î¤‘"}.icon-diskette_b:before{content:"î¤"}.icon-diskette:before{content:"î¤Ž"}.icon-menu:before{content:"î¤€"}.icon-arrow_left:before{content:"î¤"}.icon-arrow_right:before{content:"î¤‚"}.icon-caret_down:before{content:"î¤ƒ"}.icon-download:before{content:"î¤„"}.icon-fullscreen:before{content:"î¤…"}.icon-hamburger:before{content:"î¤†"}.icon-options:before{content:"î¤‡"}.icon-pause:before{content:"î¤ˆ"}.icon-play:before{content:"î¤‰"}.icon-refresh:before{content:"î¤Š"}.icon-share:before{content:"î¤‹"}.icon-thumbnails:before{content:"î¤Œ"}.icon-x:before{content:"î¤"}#buttons{grid-area:"controls";border-right:var(--border-light);background:var(--color-header);z-index:3;padding:0 var(--horizontal-padding);justify-content:space-evenly;align-items:center;display:flex;position:relative;box-shadow:0 -2px 6px #0000004d}#buttons .btn{margin:0}.btn{color:#fff;cursor:pointer;background:#0375fb;border:none;border-radius:15px;width:100%;height:30px;margin-bottom:8px}.btn:hover{background:#3592ff}.btn_subdued{color:#000;background:#c5c5c5}.btn_subdued:hover{color:#000;background:#efefef}.circular_btn{width:var(--controls-height);height:var(--controls-height);cursor:pointer;color:var(--color-text);background:0 0;border:none;justify-content:center;align-items:center;font-size:28px;display:flex}.circular_btn:hover{color:var(--color-text);background:#0000004d}.circular_btn img{width:18px;height:18px}.circular_btn.active{background:radial-gradient(circle at 50% 100%,#5205e7,#220c1b);padding:0;box-shadow:inset 0 4px 6px #0009}.circular_btn.active i{transform:scale(.95)}#buttons_dialogs{z-index:2;height:calc(100vh - var(--controls-height) - var(--select-height));width:100%;position:absolute;bottom:100%;overflow:hidden}.buttons_dialog{--buttons-dialog-border-radius:10px;bottom:var(--controls-height);z-index:1;background:var(--color-buttons-dialog);width:var(--sidebar-width);padding:var(--vertical-padding)var(--horizontal-padding);padding-top:calc(2*var(--buttons-dialog-border-radius));border-top:var(--border-light);transition:transform .2s ease-out;position:fixed;transform:translateY(100%);box-shadow:0 -2px 7px #000000b3}.buttons_dialog.open{transform:translateY(0)}.btn-icon{color:#fff;cursor:pointer;background:0 0;border:none;align-items:center;font-size:22px;display:flex}.menu_btn{background:var(--color-accent);height:48px;color:var(--color-text);border-radius:24px;align-items:center;padding:0 32px 0 24px;font-weight:500;text-decoration:none;display:inline-flex;font-size:1.1em!important}@media only screen and (width<=800px){.menu_btn{justify-content:center;width:auto;display:flex}}.menu_btn:hover{background:var(--color-accent-hover);color:var(--color-text);text-decoration:none}.menu_btn img{margin-inline-end:8px}.icon_btn{color:#fffc;cursor:pointer;background:0 0;border:none;border-radius:4px;padding:4px 6px;font-size:14px}.icon_btn:hover{color:#fff}.icon_btn>i{position:relative;top:1px}#wrapper{width:100%;display:block}form{grid-area:form;overflow:auto}#preview{margin-top:1em}#canvas{--checkers1:#fff;--checkers2:#bbb;box-sizing:border-box;background:conic-gradient(var(--checkers2)25%,var(--checkers1)0 50%,var(--checkers2)0 75%,var(--checkers1)0);background-size:40px 40px;outline:1px solid #666;width:100%;height:300px;margin-top:4px;position:relative;box-shadow:inset 0 1px 5px #0000}canvas{width:100%;height:100%;position:absolute;top:0;left:0}@media only screen and (width<=800px){#canvas{max-height:250px}}@media only screen and (width>=801px){#wrapper{grid-template:"preview form"1fr/200px 1fr;gap:1em;display:grid}#preview{grid-area:preview;margin-top:0}}section{margin-bottom:1px}label:not(.icon_btn){margin-bottom:4px;display:block}input[type=checkbox]:checked+.icon_btn{color:#fff;background:#ffffff1a}';var tP={};tP='<confirm-dialog dialog-title="Download image" submit=Download submit-icon=download centered width=640>\n  <div id=wrapper>\n    <form>\n      <fieldset>\n        <label for=type>Type</label>\n        <div class=radio-list>\n          <input type=radio name=type id=type_all value=all checked>\n          <label for=type_all>Image</label>\n          <input type=radio name=type id=type_nails_map value=nails_map>\n          <label for=type_nails_map>Nails map ðŸ”¨</label>\n        </div>\n      </fieldset>\n      <label for=size>Image size</label>\n      <section>\n        <div style=flex:0>\n          <select id=size class=dialog-input style=width:auto name=size></select>\n        </div>\n        <div style=white-space:nowrap;flex:1;margin-top:.5em>\n          <div id=width_and_height>\n            <dimensions-input id=image_dimensions name=image_dimensions></dimensions-input>\n            <select class="dialog-lesser-select unit-select" name=unit>\n              <option value=cm>cm</option>\n              <option value=inch>inch</option>\n              <option value=px>px</option>\n            </select>\n            <input type=checkbox id=rotate_image name=rotate_image hidden>\n            <label id=rotate_btn class=icon_btn title=Rotate type=button for=rotate_image>\n              <i class=icon-rotate></i>\n            </label>\n          </div>\n        </div>\n      </section>\n      <section>\n        <label for=pattern_size>Pattern size</label>\n        <dimensions-input id=pattern_size name=pattern_dimensions></dimensions-input>\n        <select class="dialog-lesser-select unit-select" name=unit>\n          <option value=cm>cm</option>\n          <option value=inch>inch</option>\n          <option value=px>px</option>\n        </select>\n      </section>\n      <section>\n        <label for=margin>Margin</label>\n        <input type=number id=margin value=0 style=width:70px min=0 step=1 class="dialog-input size-input" name=margin>\n        <select class="dialog-lesser-select unit-select" name=unit>\n          <option value=cm>cm</option>\n          <option value=inch>inch</option>\n          <option value=px>px</option>\n        </select>\n      </section>\n      <div style=margin-top:1.5em>\n        <expandable-panel legend="More options" minimized>\n          <fieldset class=dialog-checkbox hidden id=render_numbers_block>\n            <string-art-checkbox id=render_numbers label="Show nail numbers" name=render_numbers data-updates-preview>\n          </string-art-checkbox></fieldset>\n\n          <fieldset id=dpi_block>\n            <label for=dpi>Print resolution</label>\n            <select id=dpi value=300 class=dialog-input style=width:80px name=dpi>\n              <option value=72>72</option>\n              <option value=150>150</option>\n              <option value=200>200</option>\n              <option value=300 selected>300</option>\n              <option value=360>360</option>\n              <option value=600>600</option>\n              <option value=720>720</option>\n              <option value=1200>1200</option>\n              <option value=2400>2400</option>\n              <option value=2880>2880</option>\n            </select>\n            <label for=dpi style=display:inline>DPI</label>\n          </fieldset>\n          <fieldset>\n            <section>\n              <label for=format>Image type</label>\n              <select id=format class=dialog-input name=format data-updates-preview>\n                <option value=png>PNG</option>\n                <option value=jpeg>JPEG</option>\n                <option value=webp>WEBP</option>\n                <option value=svg>SVG</option>\n              </select>\n            </section>\n            <section id=transparent_background_block>\n              <string-art-checkbox id=transparent_background label="Transparent background" name=transparent_background data-updates-preview>\n            </string-art-checkbox></section>\n          </fieldset>\n        </expandable-panel>\n      </div>\n    </form>\n    <div id=preview>\n      Preview\n      <article id=canvas></article>\n    </div>\n  </div>\n</confirm-dialog>\n';const tM="units",tL=new class extends s{#tt;getUserPreferredUnits(){return this.#tt||(this.#tt="inch"===localStorage.getItem(tM)?"inch":"cm"),this.#tt}setUserPreferredUnits(e){this.#tt!==e&&(this.#tt=e,localStorage.setItem(tM,e),this.emit("unitsChange",e))}},tR=[10,10],tI=[{id:"fit",name:"Fit pattern",dimensions:({customDimensions:e,patternAspectRatio:t})=>{let i=e;if(!i){let e=Math.min(screen.width,screen.height),t=window.devicePixelRatio??1;i=I([e,e],e=>e*t)}return F([i[0],i[0]/t],i)},units:["px","cm","inch"],defaultUnits:"px",defaultMargin:20,allowSizeEdit:!0,aspectRatio:({patternAspectRatio:e})=>e},{id:"screen",name:"Screen size",dimensions:()=>{let e=window.devicePixelRatio??1;return[window.screen.width,window.screen.height].map(t=>Math.floor(t*e))},units:["px"],defaultMargin:10,allowRotate:!0},...[{id:"A4",dimensions:[21,29.7]},{id:"A3",dimensions:[29.7,42]},{id:"A2",dimensions:[42,59.4]},{id:"A1",dimensions:[59.4,84.1]}].map(e=>({...e,units:["cm","inch"],inUnits:"cm",defaultMargin:1,allowRotate:!0})),{id:"custom",name:"Custom sizeâ€¦",units:["px","cm","inch"],dimensions:({customDimensions:e,currentDimensions:t})=>t??e??tR,allowSizeEdit:!0,allowRotate:!0}];function tT(e){return tI.find(({id:t})=>t===e)}var tA="undefined"!=typeof window?window:void 0,tD="undefined"!=typeof globalThis?globalThis:tA,tz=Array.prototype,t$=tz.forEach,tF=tz.indexOf,tO=null==tD?void 0:tD.navigator,tV=null==tD?void 0:tD.document,tq=null==tD?void 0:tD.location,tB=null==tD?void 0:tD.fetch,tj=null!=tD&&tD.XMLHttpRequest&&"withCredentials"in new tD.XMLHttpRequest?tD.XMLHttpRequest:void 0,tH=null==tD?void 0:tD.AbortController,tU=null==tO?void 0:tO.userAgent,tG=null!=tA?tA:{},tW={DEBUG:!1,LIB_VERSION:"1.284.0"};function tK(e,t,i,n,s,r,a){try{var o=e[r](a),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(n,s)}function tY(e){return function(){var t=this,i=arguments;return new Promise(function(n,s){var r=e.apply(t,i);function a(e){tK(r,n,s,a,o,"next",e)}function o(e){tK(r,n,s,a,o,"throw",e)}a(void 0)})}}function tJ(){return(tJ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(null,arguments)}function tX(e,t){if(null==e)return{};var i={};for(var n in e)if(({}).hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;i[n]=e[n]}return i}var tZ=["amazonbot","amazonproductbot","app.hypefactors.com","applebot","archive.org_bot","awariobot","backlinksextendedbot","baiduspider","bingbot","bingpreview","chrome-lighthouse","dataforseobot","deepscan","duckduckbot","facebookexternal","facebookcatalog","http://yandex.com/bots","hubspot","ia_archiver","leikibot","linkedinbot","meta-externalagent","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","sebot-wa","sitebulb","slackbot","slurp","trendictionbot","turnitin","twitterbot","vercel-screenshot","vercelbot","yahoo! slurp","yandexbot","zoombot","bot.htm","bot.php","(bot;","bot/","crawler","ahrefsbot","ahrefssiteaudit","semrushbot","siteauditbot","splitsignalbot","gptbot","oai-searchbot","chatgpt-user","perplexitybot","better uptime bot","sentryuptimebot","uptimerobot","headlesschrome","cypress","google-hoteladsverifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleother","google-cloudvertexbot","googleweblight","mediapartners-google","storebot-google","google-inspectiontool","bytespider"],tQ=function(e,t){if(void 0===t&&(t=[]),!e)return!1;var i=e.toLowerCase();return tZ.concat(t).some(e=>{var t=e.toLowerCase();return -1!==i.indexOf(t)})},t0=["$snapshot","$pageview","$pageleave","$set","survey dismissed","survey sent","survey shown","$identify","$groupidentify","$create_alias","$$client_ingestion_warning","$web_experiment_applied","$feature_enrollment_update","$feature_flag_called"];function t1(e,t){return -1!==e.indexOf(t)}var t2=function(e){return e.trim()},t3=function(e){return e.replace(/^\$/,"")},t5=Array.isArray,t4=Object.prototype,t6=t4.hasOwnProperty,t8=t4.toString,t7=t5||function(e){return"[object Array]"===t8.call(e)},t9=e=>"function"==typeof e,ie=e=>e===Object(e)&&!t7(e),it=e=>{if(ie(e)){for(var t in e)if(t6.call(e,t))return!1;return!0}return!1},ii=e=>void 0===e,is=e=>"[object String]"==t8.call(e),ir=e=>is(e)&&0===e.trim().length,ia=e=>null===e,io=e=>ii(e)||ia(e),il=e=>"[object Number]"==t8.call(e),ic=e=>"[object Boolean]"===t8.call(e),iu=e=>t1(t0,e);function id(e){return null===e||"object"!=typeof e}function ih(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"}function ip(e){return!ii(Event)&&function(e,t){try{return e instanceof t}catch(e){return!1}}(e,Event)}var ig=[!0,"true",1,"1","yes"],im=e=>t1(ig,e),iv=[!1,"false",0,"0","no"];function iy(e,t,i,n,s){return t>i&&(n.warn("min cannot be greater than max."),t=i),il(e)?e>i?(n.warn(" cannot be  greater than max: "+i+". Using max value instead."),i):e<t?(n.warn(" cannot be less than min: "+t+". Using min value instead."),t):e:(n.warn(" must be a number. using max or fallback. max: "+i+", fallback: "+s),iy(s||i,t,i,n))}class ib{constructor(e){this.t={},this.i=e.i,this.o=iy(e.bucketSize,0,100,e.h),this.m=iy(e.refillRate,0,this.o,e.h),this.S=iy(e.refillInterval,0,864e5,e.h)}$(e,t){var i=Math.floor((t-e.lastAccess)/this.S);if(i>0){var n=i*this.m;e.tokens=Math.min(e.tokens+n,this.o),e.lastAccess=e.lastAccess+i*this.S}}consumeRateLimit(e){var t,i=Date.now(),n=String(e),s=this.t[n];return s?this.$(s,i):(s={tokens:this.o,lastAccess:i},this.t[n]=s),0===s.tokens||(s.tokens--,0===s.tokens&&(null==(t=this.i)||t.call(this,e)),0===s.tokens)}stop(){this.t={}}}var i_,iw,iS,ix,iC=e=>e instanceof Error;function ik(e,t,i,n){var s={platform:"web:javascript",filename:e,function:"<anonymous>"===t?"?":t,in_app:!0};return ii(i)||(s.lineno=i),ii(n)||(s.colno=n),s}var iE=(e,t)=>{var i=-1!==e.indexOf("safari-extension"),n=-1!==e.indexOf("safari-web-extension");return i||n?[-1!==e.indexOf("@")?e.split("@")[0]:"?",i?"safari-extension:"+t:"safari-web-extension:"+t]:[e,t]},iN=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,iP=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,iM=/\((\S*)(?::(\d+))(?::(\d+))\)/,iL=e=>{var t=iN.exec(e);if(t){var[,i,n,s]=t;return ik(i,"?",+n,+s)}var r=iP.exec(e);if(r){if(r[2]&&0===r[2].indexOf("eval")){var a=iM.exec(r[2]);a&&(r[2]=a[1],r[3]=a[2],r[4]=a[3])}var[o,l]=iE(r[1]||"?",r[2]);return ik(l,o,r[3]?+r[3]:void 0,r[4]?+r[4]:void 0)}},iR=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,iI=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,iT=e=>{var t=iR.exec(e);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){var i=iI.exec(t[3]);i&&(t[1]=t[1]||"eval",t[3]=i[1],t[4]=i[2],t[5]="")}var n=t[3],s=t[1]||"?";return[s,n]=iE(s,n),ik(n,s,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}},iA=/\(error: (.*)\)/;class iD{constructor(e,t,i){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===i&&(i=[]),this.coercers=e,this.modifiers=i,this.stackParser=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e,i){void 0===i&&(i=0);for(var n=[],s=e.split("\n"),r=i;r<s.length;r++){var a=s[r];if(!(a.length>1024)){var o=iA.test(a)?a.replace(iA,"$1"):a;if(!o.match(/\S*Error: /)){for(var l of t){var c=l(o);if(c){n.push(c);break}}if(n.length>=50)break}}}if(!n.length)return[];var u=Array.from(n);return u.reverse(),u.slice(0,50).map(e=>tJ({},e,{filename:e.filename||(u[u.length-1]||{}).filename,function:e.function||"?"}))}}(...t)}buildFromUnknown(e,t){void 0===t&&(t={});var i=t&&t.mechanism||{handled:!0,type:"generic"},n=this.buildCoercingContext(i,t,0).apply(e),s=this.buildParsingContext(),r=this.parseStacktrace(n,s);return{$exception_list:this.convertToExceptionList(r,i),$exception_level:"error"}}modifyFrames(e){var t=this;return tY(function*(){for(var i of e)i.stacktrace&&i.stacktrace.frames&&t7(i.stacktrace.frames)&&(i.stacktrace.frames=yield t.applyModifiers(i.stacktrace.frames));return e})()}coerceFallback(e){var t;return{type:"Error",value:"Unknown error",stack:null==(t=e.syntheticException)?void 0:t.stack,synthetic:!0}}parseStacktrace(e,t){var i,n;return null!=e.cause&&(i=this.parseStacktrace(e.cause,t)),""!=e.stack&&null!=e.stack&&(n=this.applyChunkIds(this.stackParser(e.stack,+!!e.synthetic),t.chunkIdMap)),tJ({},e,{cause:i,stack:n})}applyChunkIds(e,t){return e.map(e=>(e.filename&&t&&(e.chunk_id=t[e.filename]),e))}applyCoercers(e,t){for(var i of this.coercers)if(i.match(e))return i.coerce(e,t);return this.coerceFallback(t)}applyModifiers(e){var t=this;return tY(function*(){var i=e;for(var n of t.modifiers)i=yield n(i);return i})()}convertToExceptionList(e,t){var i,n,s,r={type:e.type,value:e.value,mechanism:{type:null!=(i=t.type)?i:"generic",handled:null==(n=t.handled)||n,synthetic:null!=(s=e.synthetic)&&s}};e.stack&&(r.stacktrace={type:"raw",frames:e.stack});var a=[r];return null!=e.cause&&a.push(...this.convertToExceptionList(e.cause,tJ({},t,{handled:!0}))),a}buildParsingContext(){return{chunkIdMap:function(e){var t=globalThis._posthogChunkIds;if(t){var i=Object.keys(t);return ix&&i.length===iS||(iS=i.length,ix=i.reduce((i,n)=>{iw||(iw={});var s=iw[n];if(s)i[s[0]]=s[1];else for(var r=e(n),a=r.length-1;a>=0;a--){var o=r[a],l=null==o?void 0:o.filename,c=t[n];if(l&&c){i[l]=c,iw[n]=[l,c];break}}return i},{})),ix}}(this.stackParser)}}buildCoercingContext(e,t,i){void 0===i&&(i=0);var n=(i,n)=>{if(n<=4){var s=this.buildCoercingContext(e,t,n);return this.applyCoercers(i,s)}};return tJ({},t,{syntheticException:0==i?t.syntheticException:void 0,mechanism:e,apply:e=>n(e,i),next:e=>n(e,i+1)})}}class iz{match(e){return this.isDOMException(e)||this.isDOMError(e)}coerce(e,t){var i=is(e.stack);return{type:this.getType(e),value:this.getValue(e),stack:i?e.stack:void 0,cause:e.cause?t.next(e.cause):void 0,synthetic:!1}}getType(e){return this.isDOMError(e)?"DOMError":"DOMException"}getValue(e){var t=e.name||(this.isDOMError(e)?"DOMError":"DOMException");return e.message?t+": "+e.message:t}isDOMException(e){return ih(e,"DOMException")}isDOMError(e){return ih(e,"DOMError")}}class i${match(e){return e instanceof Error}coerce(e,t){return{type:this.getType(e),value:this.getMessage(e,t),stack:this.getStack(e),cause:e.cause?t.next(e.cause):void 0,synthetic:!1}}getType(e){return e.name||e.constructor.name}getMessage(e,t){var i=e.message;return i.error&&"string"==typeof i.error.message?String(i.error.message):String(i)}getStack(e){return e.stacktrace||e.stack||void 0}}class iF{constructor(){}match(e){return ih(e,"ErrorEvent")&&null!=e.error}coerce(e,t){var i;return t.apply(e.error)||{type:"ErrorEvent",value:e.message,stack:null==(i=t.syntheticException)?void 0:i.stack,synthetic:!0}}}var iO=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;class iV{match(e){return"string"==typeof e}coerce(e,t){var i,[n,s]=this.getInfos(e);return{type:null!=n?n:"Error",value:null!=s?s:e,stack:null==(i=t.syntheticException)?void 0:i.stack,synthetic:!0}}getInfos(e){var t="Error",i=e,n=e.match(iO);return n&&(t=n[1],i=n[2]),[t,i]}}var iq=["fatal","error","warning","log","info","debug"];function iB(e,t){void 0===t&&(t=40);var i=Object.keys(e);if(i.sort(),!i.length)return"[object has no keys]";for(var n=i.length;n>0;n--){var s=i.slice(0,n).join(", ");if(!(s.length>t))return n===i.length||s.length<=t?s:s.slice(0,t)+"..."}return""}class ij{match(e){return"object"==typeof e&&null!==e}coerce(e,t){var i,n=this.getErrorPropertyFromObject(e);return n?t.apply(n):{type:this.getType(e),value:this.getValue(e),stack:null==(i=t.syntheticException)?void 0:i.stack,level:this.isSeverityLevel(e.level)?e.level:"error",synthetic:!0}}getType(e){return ip(e)?e.constructor.name:"Error"}getValue(e){if("name"in e&&"string"==typeof e.name){var t="'"+e.name+"' captured as exception";return"message"in e&&"string"==typeof e.message&&(t+=" with message: '"+e.message+"'"),t}if("message"in e&&"string"==typeof e.message)return e.message;var i=this.getObjectClassName(e);return(i&&"Object"!==i?"'"+i+"'":"Object")+" captured as exception with keys: "+iB(e)}isSeverityLevel(e){return is(e)&&!ir(e)&&iq.indexOf(e)>=0}getErrorPropertyFromObject(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var i=e[t];if(iC(i))return i}}getObjectClassName(e){try{var t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch(e){return}}}class iH{match(e){return ip(e)}coerce(e,t){var i,n=e.constructor.name;return{type:n,value:n+" captured as exception with keys: "+iB(e),stack:null==(i=t.syntheticException)?void 0:i.stack,synthetic:!0}}}class iU{match(e){return id(e)}coerce(e,t){var i;return{type:"Error",value:"Primitive value captured as exception: "+String(e),stack:null==(i=t.syntheticException)?void 0:i.stack,synthetic:!0}}}class iG{match(e){return ih(e,"PromiseRejectionEvent")}coerce(e,t){var i,n=this.getUnhandledRejectionReason(e);return id(n)?{type:"UnhandledRejection",value:"Non-Error promise rejection captured with value: "+String(n),stack:null==(i=t.syntheticException)?void 0:i.stack,synthetic:!0}:t.apply(n)}getUnhandledRejectionReason(e){if(id(e))return e;try{if("reason"in e)return e.reason;if("detail"in e&&"reason"in e.detail)return e.detail.reason}catch(e){}return e}}var iW=e=>{var t={k:function(t){if(tA&&(tW.DEBUG||tG.POSTHOG_DEBUG)&&!ii(tA.console)&&tA.console){for(var i=("__rrweb_original__"in tA.console[t])?tA.console[t].__rrweb_original__:tA.console[t],n=arguments.length,s=Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];i(e,...s)}},info:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];t.k("log",...i)},warn:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];t.k("warn",...i)},error:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];t.k("error",...i)},critical:function(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];console.error(e,...i)},uninitializedWarning:e=>{t.error("You must initialize PostHog before calling "+e)},createLogger:t=>iW(e+" "+t)};return t},iK=iW("[PostHog.js]"),iY=iK.createLogger,iJ=iY("[ExternalScriptsLoader]"),iX=(e,t,i)=>{if(e.config.disable_external_dependency_loading)return iJ.warn(t+" was requested but loading of external scripts is disabled."),i("Loading of external scripts is disabled");var n=null==tV?void 0:tV.querySelectorAll("script");if(n){for(var s,r=0;r<n.length;r++)if(s=function(){if(n[r].src===t){var e=n[r];return e.__posthog_loading_callback_fired?{v:i()}:(e.addEventListener("load",t=>{e.__posthog_loading_callback_fired=!0,i(void 0,t)}),e.onerror=e=>i(e),{v:void 0})}}())return s.v}var a=()=>{if(!tV)return i("document not found");var n=tV.createElement("script");if(n.type="text/javascript",n.crossOrigin="anonymous",n.src=t,n.onload=e=>{n.__posthog_loading_callback_fired=!0,i(void 0,e)},n.onerror=e=>i(e),e.config.prepare_external_dependency_script&&(n=e.config.prepare_external_dependency_script(n)),!n)return i("prepare_external_dependency_script returned null");var s,r=tV.querySelectorAll("body > script");r.length>0?null==(s=r[0].parentNode)||s.insertBefore(n,r[0]):tV.body.appendChild(n)};null!=tV&&tV.body?a():null==tV||tV.addEventListener("DOMContentLoaded",a)};tG.__PosthogExtensions__=tG.__PosthogExtensions__||{},tG.__PosthogExtensions__.loadExternalDependency=(e,t,i)=>{var n="/static/"+t+".js?v="+e.version;"remote-config"===t&&(n="/array/"+e.config.token+"/config.js"),"toolbar"===t&&(n=n+"&t="+3e5*Math.floor(Date.now()/3e5));var s=e.requestRouter.endpointFor("assets",n);iX(e,s,i)},tG.__PosthogExtensions__.loadSiteApp=(e,t,i)=>{var n=e.requestRouter.endpointFor("api",t);iX(e,n,i)};var iZ={};function iQ(e,t,i){if(t7(e)){if(t$&&e.forEach===t$)e.forEach(t,i);else if("length"in e&&e.length===+e.length){for(var n=0,s=e.length;n<s;n++)if(n in e&&t.call(i,e[n],n)===iZ)return}}}function i0(e,t,i){if(!io(e)){if(t7(e))return iQ(e,t,i);if(e instanceof FormData){for(var n of e.entries())if(t.call(i,n[1],n[0])===iZ)return}else for(var s in e)if(t6.call(e,s)&&t.call(i,e[s],s)===iZ)return}}var i1=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return iQ(i,function(t){for(var i in t)void 0!==t[i]&&(e[i]=t[i])}),e},i2=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return iQ(i,function(t){iQ(t,function(t){e.push(t)})}),e};function i3(e){for(var t=Object.keys(e),i=t.length,n=Array(i);i--;)n[i]=[t[i],e[t[i]]];return n}var i5=function(e){try{return e()}catch(e){return}},i4=function(e){return function(){try{for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];return e.apply(this,i)}catch(e){iK.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),iK.critical(e)}}},i6=function(e){var t={};return i0(e,function(e,i){(is(e)&&e.length>0||il(e))&&(t[i]=e)}),t},i8=["herokuapp.com","vercel.app","netlify.app"];function i7(e,t){for(var i=0;i<e.length;i++)if(t(e[i]))return e[i]}function i9(e,t,i,n){var{capture:s=!1,passive:r=!0}=null!=n?n:{};null==e||e.addEventListener(t,i,{capture:s,passive:r})}var ne="$people_distinct_id",nt="__alias",ni="__timers",nn="$autocapture_disabled_server_side",ns="$heatmaps_enabled_server_side",nr="$exception_capture_enabled_server_side",na="$error_tracking_suppression_rules",no="$error_tracking_capture_extension_exceptions",nl="$web_vitals_enabled_server_side",nc="$dead_clicks_enabled_server_side",nu="$web_vitals_allowed_metrics",nd="$session_recording_remote_config",nh="$sesid",np="$session_is_sampled",ng="$enabled_feature_flags",nf="$early_access_features",nm="$feature_flag_details",nv="$stored_person_properties",ny="$stored_group_properties",nb="$surveys",n_="$surveys_activated",nw="$flag_call_reported",nS="$user_state",nx="$client_session_props",nC="$capture_rate_limit",nk="$initial_campaign_params",nE="$initial_referrer_info",nN="$initial_person_info",nP="$epp",nM="__POSTHOG_TOOLBAR__",nL="$posthog_cookieless",nR=[ne,nt,"__cmpns",ni,"$session_recording_enabled_server_side",ns,nh,ng,na,nS,nf,nm,ny,nv,nb,nw,nx,nC,nk,nE,nP,nN];function nI(e){return e instanceof Element&&(e.id===nM||!(null==e.closest||!e.closest(".toolbar-global-fade-container")))}function nT(e){return!!e&&1===e.nodeType}function nA(e,t){return!!e&&!!e.tagName&&e.tagName.toLowerCase()===t.toLowerCase()}function nD(e){return!!e&&3===e.nodeType}function nz(e){return!!e&&11===e.nodeType}function n$(e){return e?t2(e).split(/\s+/):[]}function nF(e){var t=null==tA?void 0:tA.location.href;return!!(t&&e&&e.some(e=>t.match(e)))}function nO(e){var t="";switch(typeof e.className){case"string":t=e.className;break;case"object":t=(e.className&&"baseVal"in e.className?e.className.baseVal:null)||e.getAttribute("class")||"";break;default:t=""}return n$(t)}function nV(e){return io(e)?null:t2(e).split(/(\s+)/).filter(e=>n3(e)).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function nq(e){var t="";return nY(e)&&!nJ(e)&&e.childNodes&&e.childNodes.length&&i0(e.childNodes,function(e){var i;nD(e)&&e.textContent&&(t+=null!=(i=nV(e.textContent))?i:"")}),t2(t)}function nB(e){var t;return ii(e.target)?e.srcElement||null:null!=(t=e.target)&&t.shadowRoot?e.composedPath()[0]||null:e.target||null}var nj=["a","button","form","input","select","textarea","label"];function nH(e,t){if(ii(t))return!0;var i,n=function(e){if(t.some(t=>e.matches(t)))return{v:!0}};for(var s of e)if(i=n(s))return i.v;return!1}function nU(e){var t=e.parentNode;return!(!t||!nT(t))&&t}var nG=[".ph-no-rageclick",".ph-no-capture"],nW=e=>!e||nA(e,"html")||!nT(e),nK=(e,t)=>{if(!tA||nW(e))return{parentIsUsefulElement:!1,targetElementList:[]};for(var i=!1,n=[e],s=e;s.parentNode&&!nA(s,"body");)if(nz(s.parentNode))n.push(s.parentNode.host),s=s.parentNode.host;else{var r=nU(s);if(!r)break;if(t||nj.indexOf(r.tagName.toLowerCase())>-1)i=!0;else{var a=tA.getComputedStyle(r);a&&"pointer"===a.getPropertyValue("cursor")&&(i=!0)}n.push(r),s=r}return{parentIsUsefulElement:i,targetElementList:n}};function nY(e){for(var t=e;t.parentNode&&!nA(t,"body");t=t.parentNode){var i=nO(t);if(t1(i,"ph-sensitive")||t1(i,"ph-no-capture"))return!1}if(t1(nO(e),"ph-include"))return!0;var n=e.type||"";if(is(n))switch(n.toLowerCase()){case"hidden":case"password":return!1}var s=e.name||e.id||"";return!(is(s)&&/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(s.replace(/[^a-zA-Z0-9]/g,"")))}function nJ(e){return!!(nA(e,"input")&&!["button","checkbox","submit","reset"].includes(e.type)||nA(e,"select")||nA(e,"textarea")||"true"===e.getAttribute("contenteditable"))}var nX="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",nZ=RegExp("^(?:"+nX+")$"),nQ=new RegExp(nX),n0="\\d{3}-?\\d{2}-?\\d{4}",n1=RegExp("^("+n0+")$"),n2=RegExp("("+n0+")");function n3(e,t){return void 0===t&&(t=!0),!(io(e)||is(e)&&(e=t2(e),(t?nZ:nQ).test((e||"").replace(/[- ]/g,""))||(t?n1:n2).test(e)))&&!0}function n5(e){var t=nq(e);return n3(t=(t+" "+function e(t){var i="";return t&&t.childNodes&&t.childNodes.length&&i0(t.childNodes,function(t){var n;if(t&&"span"===(null==(n=t.tagName)?void 0:n.toLowerCase()))try{var s=nq(t);i=(i+" "+s).trim(),t.childNodes&&t.childNodes.length&&(i=(i+" "+e(t)).trim())}catch(e){iK.error("[AutoCapture]",e)}}),i}(e)).trim())?t:""}function n4(e){return e.replace(/"|\\"/g,'\\"')}class n6{constructor(){this.clicks=[]}isRageClick(e,t,i){var n=this.clicks[this.clicks.length-1];if(n&&Math.abs(e-n.x)+Math.abs(t-n.y)<30&&i-n.timestamp<1e3){if(this.clicks.push({x:e,y:t,timestamp:i}),3===this.clicks.length)return!0}else this.clicks=[{x:e,y:t,timestamp:i}];return!1}}var n8="$copy_autocapture",n7=((su={}).GZipJS="gzip-js",su.Base64="base64",su),n9=e=>{var t=null==tV?void 0:tV.createElement("a");return ii(t)?null:(t.href=e,t)},se=function(e,t){void 0===t&&(t="&");var i,n,s=[];return i0(e,function(e,t){ii(e)||ii(t)||"undefined"===t||(i=encodeURIComponent(e instanceof File?e.name:e.toString()),n=encodeURIComponent(t),s[s.length]=n+"="+i)}),s.join(t)},st=function(e,t){for(var i,n=((e.split("#")[0]||"").split(/\?(.*)/)[1]||"").replace(/^\?+/g,"").split("&"),s=0;s<n.length;s++){var r=n[s].split("=");if(r[0]===t){i=r;break}}if(!t7(i)||i.length<2)return"";var a=i[1];try{a=decodeURIComponent(a)}catch(e){iK.error("Skipping decoding for malformed query param: "+a)}return a.replace(/\+/g," ")},si=function(e,t,i){if(!e||!t||!t.length)return e;for(var n=e.split("#"),s=n[0]||"",r=n[1],a=s.split("?"),o=a[1],l=a[0],c=(o||"").split("&"),u=[],d=0;d<c.length;d++){var h=c[d].split("=");t7(h)&&(t.includes(h[0])?u.push(h[0]+"="+i):u.push(c[d]))}var p=l;return null!=o&&(p+="?"+u.join("&")),null!=r&&(p+="#"+r),p},sn=function(e,t){var i=e.match(RegExp(t+"=([^&]*)"));return i?i[1]:null},ss=iY("[AutoCapture]");function sr(e,t){return t.length>e?t.slice(0,e)+"...":t}class sa{constructor(e){this.P=!1,this.T=null,this.rageclicks=new n6,this.R=!1,this.instance=e,this.I=null}get C(){var e,t,i=ie(this.instance.config.autocapture)?this.instance.config.autocapture:{};return i.url_allowlist=null==(e=i.url_allowlist)?void 0:e.map(e=>new RegExp(e)),i.url_ignorelist=null==(t=i.url_ignorelist)?void 0:t.map(e=>new RegExp(e)),i}O(){if(this.isBrowserSupported()){if(tA&&tV){var e=e=>{e=e||(null==tA?void 0:tA.event);try{this.F(e)}catch(e){ss.error("Failed to capture event",e)}};if(i9(tV,"submit",e,{capture:!0}),i9(tV,"change",e,{capture:!0}),i9(tV,"click",e,{capture:!0}),this.C.capture_copied_text){var t=e=>{e=e||(null==tA?void 0:tA.event),this.F(e,n8)};i9(tV,"copy",t,{capture:!0}),i9(tV,"cut",t,{capture:!0})}}}else ss.info("Disabling Automatic Event Collection because this browser is not supported")}startIfEnabled(){this.isEnabled&&!this.P&&(this.O(),this.P=!0)}onRemoteConfig(e){e.elementsChainAsString&&(this.R=e.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register({[nn]:!!e.autocapture_opt_out}),this.T=!!e.autocapture_opt_out,this.startIfEnabled()}setElementSelectors(e){this.I=e}getElementSelectors(e){var t,i=[];return null==(t=this.I)||t.forEach(t=>{var n=null==tV?void 0:tV.querySelectorAll(t);null==n||n.forEach(n=>{e===n&&i.push(t)})}),i}get isEnabled(){var e,t,i=null==(e=this.instance.persistence)?void 0:e.props[nn];if(ia(this.T)&&!ic(i)&&!this.instance.M())return!1;var n=null!=(t=this.T)?t:!!i;return!!this.instance.config.autocapture&&!n}F(e,t){if(void 0===t&&(t="$autocapture"),this.isEnabled){var i,n=nB(e);nD(n)&&(n=n.parentNode||null),"$autocapture"===t&&"click"===e.type&&e instanceof MouseEvent&&this.instance.config.rageclick&&null!=(i=this.rageclicks)&&i.isRageClick(e.clientX,e.clientY,(new Date).getTime())&&function(e,t){if(!tA||nW(e)||!1===(i=ic(t)?!!t&&nG:null!=(n=null==t?void 0:t.css_selector_ignorelist)?n:nG))return!1;var i,n,{targetElementList:s}=nK(e,!1);return!nH(s,i)}(n,this.instance.config.rageclick)&&this.F(e,"$rageclick");var s=t===n8;if(n&&function(e,t,i,n,s){if(void 0===i&&(i=void 0),!tA||nW(e)||null!=(r=i)&&r.url_allowlist&&!nF(i.url_allowlist)||null!=(a=i)&&a.url_ignorelist&&nF(i.url_ignorelist))return!1;if(null!=(o=i)&&o.dom_event_allowlist){var r,a,o,l,c=i.dom_event_allowlist;if(c&&!c.some(e=>t.type===e))return!1}var{parentIsUsefulElement:u,targetElementList:d}=nK(e,n);if(!function(e,t){var i=null==t?void 0:t.element_allowlist;if(ii(i))return!0;var n,s=function(e){if(i.some(t=>e.tagName.toLowerCase()===t))return{v:!0}};for(var r of e)if(n=s(r))return n.v;return!1}(d,i)||!nH(d,null==(l=i)?void 0:l.css_selector_allowlist))return!1;var h=tA.getComputedStyle(e);if(h&&"pointer"===h.getPropertyValue("cursor")&&"click"===t.type)return!0;var p=e.tagName.toLowerCase();switch(p){case"html":return!1;case"form":return(s||["submit"]).indexOf(t.type)>=0;case"input":case"select":case"textarea":return(s||["change","click"]).indexOf(t.type)>=0;default:return u?(s||["click"]).indexOf(t.type)>=0:(s||["click"]).indexOf(t.type)>=0&&(nj.indexOf(p)>-1||"true"===e.getAttribute("contenteditable"))}}(n,e,this.C,s,s?["copy","cut"]:void 0)){var{props:r,explicitNoCapture:a}=function(e,t){for(var i,n,{e:s,maskAllElementAttributes:r,maskAllText:a,elementAttributeIgnoreList:o,elementsChainAsString:l}=t,c=[e],u=e;u.parentNode&&!nA(u,"body");)nz(u.parentNode)?(c.push(u.parentNode.host),u=u.parentNode.host):(c.push(u.parentNode),u=u.parentNode);var d,h=[],p={},g=!1,f=!1;if(i0(c,e=>{var t=nY(e);"a"===e.tagName.toLowerCase()&&(g=e.getAttribute("href"),g=t&&g&&n3(g)&&g),t1(nO(e),"ph-no-capture")&&(f=!0),h.push(function(e,t,i,n){var s=e.tagName.toLowerCase(),r={tag_name:s};nj.indexOf(s)>-1&&!i&&("a"===s.toLowerCase()||"button"===s.toLowerCase()?r.$el_text=sr(1024,n5(e)):r.$el_text=sr(1024,nq(e)));var a=nO(e);a.length>0&&(r.classes=a.filter(function(e){return""!==e})),i0(e.attributes,function(i){var s;if((!nJ(e)||-1!==["name","id","class","aria-label"].indexOf(i.name))&&(null==n||!n.includes(i.name))&&!t&&n3(i.value)&&(!is(s=i.name)||"_ngcontent"!==s.substring(0,10)&&"_nghost"!==s.substring(0,7))){var a=i.value;"class"===i.name&&(a=n$(a).join(" ")),r["attr__"+i.name]=sr(1024,a)}});for(var o=1,l=1,c=e;c=function(e){if(e.previousElementSibling)return e.previousElementSibling;var t=e;do t=t.previousSibling;while(t&&!nT(t))return t}(c);)o++,c.tagName===e.tagName&&l++;return r.nth_child=o,r.nth_of_type=l,r}(e,r,a,o)),i1(p,function(e){if(!nY(e))return{};var t={};return i0(e.attributes,function(e){if(e.name&&0===e.name.indexOf("data-ph-capture-attribute")){var i=e.name.replace("data-ph-capture-attribute-",""),n=e.value;i&&n&&n3(n)&&(t[i]=n)}}),t}(e))}),f)return{props:{},explicitNoCapture:f};if(a||("a"===e.tagName.toLowerCase()||"button"===e.tagName.toLowerCase()?h[0].$el_text=n5(e):h[0].$el_text=nq(e)),g){h[0].attr__href=g;var m,v,y=null==(m=n9(g))?void 0:m.host,b=null==tA||null==(v=tA.location)?void 0:v.host;y&&b&&y!==b&&(d=g)}return{props:i1({$event_type:s.type,$ce_version:1},l?{}:{$elements:h},{$elements_chain:h.map(e=>{var t,i,n,s={text:null==(i=e.$el_text)?void 0:i.slice(0,400),tag_name:e.tag_name,href:null==(n=e.attr__href)?void 0:n.slice(0,2048),attr_class:(t=e.attr__class)?t7(t)?t:n$(t):void 0,attr_id:e.attr__id,nth_child:e.nth_child,nth_of_type:e.nth_of_type,attributes:{}};return i3(e).filter(e=>{var[t]=e;return 0===t.indexOf("attr__")}).forEach(e=>{var[t,i]=e;return s.attributes[t]=i}),s}).map(e=>{var t,i,n="";if(e.tag_name&&(n+=e.tag_name),e.attr_class)for(var s of(e.attr_class.sort(),e.attr_class))n+="."+s.replace(/"/g,"");var r=tJ({},e.text?{text:e.text}:{},{"nth-child":null!=(t=e.nth_child)?t:0,"nth-of-type":null!=(i=e.nth_of_type)?i:0},e.href?{href:e.href}:{},e.attr_id?{attr_id:e.attr_id}:{},e.attributes),a={};return i3(r).sort((e,t)=>{var[i]=e,[n]=t;return i.localeCompare(n)}).forEach(e=>{var[t,i]=e;return a[n4(t.toString())]=n4(i.toString())}),n+=":",n+=i3(a).map(e=>{var[t,i]=e;return t+'="'+i+'"'}).join("")}).join(";")},null!=(i=h[0])&&i.$el_text?{$el_text:null==(n=h[0])?void 0:n.$el_text}:{},d&&"click"===s.type?{$external_click_url:d}:{},p)}}(n,{e:e,maskAllElementAttributes:this.instance.config.mask_all_element_attributes,maskAllText:this.instance.config.mask_all_text,elementAttributeIgnoreList:this.C.element_attribute_ignorelist,elementsChainAsString:this.R});if(a)return!1;var o=this.getElementSelectors(n);if(o&&o.length>0&&(r.$element_selectors=o),t===n8){var l,c=nV(null==tA||null==(l=tA.getSelection())?void 0:l.toString()),u=e.type||"clipboard";if(!c)return!1;r.$selected_content=c,r.$copy_type=u}return this.instance.capture(t,r),!0}}}isBrowserSupported(){return t9(null==tV?void 0:tV.querySelectorAll)}}Math.trunc||(Math.trunc=function(e){return e<0?Math.ceil(e):Math.floor(e)}),Number.isInteger||(Number.isInteger=function(e){return il(e)&&isFinite(e)&&Math.floor(e)===e});var so="0123456789abcdef";class sl{constructor(e){if(this.bytes=e,16!==e.length)throw TypeError("not 128-bit length")}static fromFieldsV7(e,t,i,n){if(!Number.isInteger(e)||!Number.isInteger(t)||!Number.isInteger(i)||!Number.isInteger(n)||e<0||t<0||i<0||n<0||e>0xffffffffffff||t>4095||i>0x3fffffff||n>0xffffffff)throw RangeError("invalid field value");var s=new Uint8Array(16);return s[0]=e/0x10000000000,s[1]=e/0x100000000,s[2]=e/0x1000000,s[3]=e/65536,s[4]=e/256,s[5]=e,s[6]=112|t>>>8,s[7]=t,s[8]=128|i>>>24,s[9]=i>>>16,s[10]=i>>>8,s[11]=i,s[12]=n>>>24,s[13]=n>>>16,s[14]=n>>>8,s[15]=n,new sl(s)}toString(){for(var e="",t=0;t<this.bytes.length;t++)e=e+so.charAt(this.bytes[t]>>>4)+so.charAt(15&this.bytes[t]),3!==t&&5!==t&&7!==t&&9!==t||(e+="-");if(36!==e.length)throw Error("Invalid UUIDv7 was generated");return e}clone(){return new sl(this.bytes.slice(0))}equals(e){return 0===this.compareTo(e)}compareTo(e){for(var t=0;t<16;t++){var i=this.bytes[t]-e.bytes[t];if(0!==i)return Math.sign(i)}return 0}}class sc{constructor(){this.A=0,this.D=0,this.j=new sp}generate(){var e=this.generateOrAbort();if(ii(e)){this.A=0;var t=this.generateOrAbort();if(ii(t))throw Error("Could not generate UUID after timestamp reset");return t}return e}generateOrAbort(){var e=Date.now();if(e>this.A)this.A=e,this.L();else{if(!(e+1e4>this.A))return;this.D++,this.D>0x3ffffffffff&&(this.A++,this.L())}return sl.fromFieldsV7(this.A,Math.trunc(this.D/0x40000000),0x3fffffff&this.D,this.j.nextUint32())}L(){this.D=1024*this.j.nextUint32()+(1023&this.j.nextUint32())}}var su,sd,sh=e=>{if("undefined"!=typeof UUIDV7_DENY_WEAK_RNG&&UUIDV7_DENY_WEAK_RNG)throw Error("no cryptographically strong RNG available");for(var t=0;t<e.length;t++)e[t]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return e};tA&&!ii(tA.crypto)&&crypto.getRandomValues&&(sh=e=>crypto.getRandomValues(e));class sp{constructor(){this.N=new Uint32Array(8),this.U=1/0}nextUint32(){return this.U>=this.N.length&&(sh(this.N),this.U=0),this.N[this.U++]}}var sg=()=>sf().toString(),sf=()=>(sd||(sd=new sc)).generate(),sm="",sv=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i,sy={H:()=>!!tV,B:function(e){iK.error("cookieStore error: "+e)},q:function(e){if(tV){try{for(var t=e+"=",i=tV.cookie.split(";").filter(e=>e.length),n=0;n<i.length;n++){for(var s=i[n];" "==s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(t))return decodeURIComponent(s.substring(t.length,s.length))}}catch(e){}return null}},W:function(e){var t;try{t=JSON.parse(sy.q(e))||{}}catch(e){}return t},G:function(e,t,i,n,s){if(tV)try{var r="",a="",o=function(e,t){if(t){var i=function(e,t){if(void 0===t&&(t=tV),sm)return sm;if(!t||["localhost","127.0.0.1"].includes(e))return"";for(var i=e.split("."),n=Math.min(i.length,8),s="dmn_chk_"+sg();!sm&&n--;){var r=i.slice(n).join("."),a=s+"=1;domain=."+r+";path=/";t.cookie=a+";max-age=3",t.cookie.includes(s)&&(t.cookie=a+";max-age=0",sm=r)}return sm}(e);if(!i){var n,s=(n=e.match(sv))?n[0]:"";s!==i&&iK.info("Warning: cookie subdomain discovery mismatch",s,i),i=s}return i?"; domain=."+i:""}return""}(tV.location.hostname,n);if(i){var l=new Date;l.setTime(l.getTime()+24*i*36e5),r="; expires="+l.toUTCString()}s&&(a="; secure");var c=e+"="+encodeURIComponent(JSON.stringify(t))+r+"; SameSite=Lax; path=/"+o+a;return c.length>3686.4&&iK.warn("cookieStore warning: large cookie, len="+c.length),tV.cookie=c,c}catch(e){return}},V:function(e,t){if(null!=tV&&tV.cookie)try{sy.G(e,"",-1,t)}catch(e){return}}},sb=null,s_={H:function(){if(!ia(sb))return sb;var e=!0;if(ii(tA))e=!1;else try{var t="__mplssupport__";s_.G(t,"xyz"),'"xyz"'!==s_.q(t)&&(e=!1),s_.V(t)}catch(t){e=!1}return e||iK.error("localStorage unsupported; falling back to cookie store"),sb=e,e},B:function(e){iK.error("localStorage error: "+e)},q:function(e){try{return null==tA?void 0:tA.localStorage.getItem(e)}catch(e){s_.B(e)}return null},W:function(e){try{return JSON.parse(s_.q(e))||{}}catch(e){}return null},G:function(e,t){try{null==tA||tA.localStorage.setItem(e,JSON.stringify(t))}catch(e){s_.B(e)}},V:function(e){try{null==tA||tA.localStorage.removeItem(e)}catch(e){s_.B(e)}}},sw=["distinct_id",nh,np,nP,nN],sS=tJ({},s_,{W:function(e){try{var t={};try{t=sy.W(e)||{}}catch(e){}var i=i1(t,JSON.parse(s_.q(e)||"{}"));return s_.G(e,i),i}catch(e){}return null},G:function(e,t,i,n,s,r){try{s_.G(e,t,void 0,void 0,r);var a={};sw.forEach(e=>{t[e]&&(a[e]=t[e])}),Object.keys(a).length&&sy.G(e,a,i,n,s,r)}catch(e){s_.B(e)}},V:function(e,t){try{null==tA||tA.localStorage.removeItem(e),sy.V(e,t)}catch(e){s_.B(e)}}}),sx={},sC={H:function(){return!0},B:function(e){iK.error("memoryStorage error: "+e)},q:function(e){return sx[e]||null},W:function(e){return sx[e]||null},G:function(e,t){sx[e]=t},V:function(e){delete sx[e]}},sk=null,sE={H:function(){if(!ia(sk))return sk;if(sk=!0,ii(tA))sk=!1;else try{var e="__support__";sE.G(e,"xyz"),'"xyz"'!==sE.q(e)&&(sk=!1),sE.V(e)}catch(e){sk=!1}return sk},B:function(e){iK.error("sessionStorage error: ",e)},q:function(e){try{return null==tA?void 0:tA.sessionStorage.getItem(e)}catch(e){sE.B(e)}return null},W:function(e){try{return JSON.parse(sE.q(e))||null}catch(e){}return null},G:function(e,t){try{null==tA||tA.sessionStorage.setItem(e,JSON.stringify(t))}catch(e){sE.B(e)}},V:function(e){try{null==tA||tA.sessionStorage.removeItem(e)}catch(e){sE.B(e)}}},sN=((oM={})[oM.PENDING=-1]="PENDING",oM[oM.DENIED=0]="DENIED",oM[oM.GRANTED=1]="GRANTED",oM);class sP{constructor(e){this._instance=e}get C(){return this._instance.config}get consent(){return this.J()?sN.DENIED:this.K}isOptedOut(){return"always"===this.C.cookieless_mode||this.consent===sN.DENIED||this.consent===sN.PENDING&&(this.C.opt_out_capturing_by_default||"on_reject"===this.C.cookieless_mode)}isOptedIn(){return!this.isOptedOut()}isExplicitlyOptedOut(){return this.consent===sN.DENIED}optInOut(e){this.Y.G(this.X,+!!e,this.C.cookie_expiration,this.C.cross_subdomain_cookie,this.C.secure_cookie)}reset(){this.Y.V(this.X,this.C.cross_subdomain_cookie)}get X(){var{token:e,opt_out_capturing_cookie_prefix:t,consent_persistence_name:i}=this._instance.config;return i||(t?t+e:"__ph_opt_in_out_"+e)}get K(){var e=this.Y.q(this.X);return im(e)?sN.GRANTED:t1(iv,e)?sN.DENIED:sN.PENDING}get Y(){if(!this.Z){var e=this.C.opt_out_capturing_persistence_type;this.Z="localStorage"===e?s_:sy;var t="localStorage"===e?sy:s_;t.q(this.X)&&(this.Z.q(this.X)||this.optInOut(im(t.q(this.X))),t.V(this.X,this.C.cross_subdomain_cookie))}return this.Z}J(){return!!this.C.respect_dnt&&!!i7([null==tO?void 0:tO.doNotTrack,null==tO?void 0:tO.msDoNotTrack,tG.doNotTrack],e=>im(e))}}var sM=iY("[Dead Clicks]"),sL=()=>!0,sR=e=>{var t,i=!(null==(t=e.instance.persistence)||!t.get_property(nc)),n=e.instance.config.capture_dead_clicks;return ic(n)?n:i};class sI{get lazyLoadedDeadClicksAutocapture(){return this.tt}constructor(e,t,i){this.instance=e,this.isEnabled=t,this.onCapture=i,this.startIfEnabled()}onRemoteConfig(e){this.instance.persistence&&this.instance.persistence.register({[nc]:null==e?void 0:e.captureDeadClicks}),this.startIfEnabled()}startIfEnabled(){this.isEnabled(this)&&this.it(()=>{this.et()})}it(e){var t,i;null!=(t=tG.__PosthogExtensions__)&&t.initDeadClicksAutocapture&&e(),null==(i=tG.__PosthogExtensions__)||null==i.loadExternalDependency||i.loadExternalDependency(this.instance,"dead-clicks-autocapture",t=>{t?sM.error("failed to load script",t):e()})}et(){var e;if(tV){if(!this.tt&&null!=(e=tG.__PosthogExtensions__)&&e.initDeadClicksAutocapture){var t=ie(this.instance.config.capture_dead_clicks)?this.instance.config.capture_dead_clicks:{};t.__onCapture=this.onCapture,this.tt=tG.__PosthogExtensions__.initDeadClicksAutocapture(this.instance,t),this.tt.start(tV),sM.info("starting...")}}else sM.error("`document` not found. Cannot start.")}stop(){this.tt&&(this.tt.stop(),this.tt=void 0,sM.info("stopping..."))}}var sT=iY("[ExceptionAutocapture]");class sA{constructor(e){var t,i,n;this.rt=()=>{var e;if(tA&&this.isEnabled&&null!=(e=tG.__PosthogExtensions__)&&e.errorWrappingFunctions){var t=tG.__PosthogExtensions__.errorWrappingFunctions.wrapOnError,i=tG.__PosthogExtensions__.errorWrappingFunctions.wrapUnhandledRejection,n=tG.__PosthogExtensions__.errorWrappingFunctions.wrapConsoleError;try{!this.st&&this.C.capture_unhandled_errors&&(this.st=t(this.captureException.bind(this))),!this.nt&&this.C.capture_unhandled_rejections&&(this.nt=i(this.captureException.bind(this))),!this.ot&&this.C.capture_console_errors&&(this.ot=n(this.captureException.bind(this)))}catch(e){sT.error("failed to start",e),this.lt()}}},this._instance=e,this.ut=!(null==(t=this._instance.persistence)||!t.props[nr]),this.C=this.ht(),this.dt=new ib({refillRate:null!=(i=this._instance.config.error_tracking.__exceptionRateLimiterRefillRate)?i:1,bucketSize:null!=(n=this._instance.config.error_tracking.__exceptionRateLimiterBucketSize)?n:10,refillInterval:1e4,h:sT}),this.startIfEnabled()}ht(){var e=this._instance.config.capture_exceptions,t={capture_unhandled_errors:!1,capture_unhandled_rejections:!1,capture_console_errors:!1};return ie(e)?t=tJ({},t,e):(ii(e)?this.ut:e)&&(t=tJ({},t,{capture_unhandled_errors:!0,capture_unhandled_rejections:!0})),t}get isEnabled(){return this.C.capture_console_errors||this.C.capture_unhandled_errors||this.C.capture_unhandled_rejections}startIfEnabled(){this.isEnabled&&(sT.info("enabled"),this.it(this.rt))}it(e){var t,i;null!=(t=tG.__PosthogExtensions__)&&t.errorWrappingFunctions&&e(),null==(i=tG.__PosthogExtensions__)||null==i.loadExternalDependency||i.loadExternalDependency(this._instance,"exception-autocapture",t=>{if(t)return sT.error("failed to load script",t);e()})}lt(){var e,t,i;null==(e=this.st)||e.call(this),this.st=void 0,null==(t=this.nt)||t.call(this),this.nt=void 0,null==(i=this.ot)||i.call(this),this.ot=void 0}onRemoteConfig(e){var t=e.autocaptureExceptions;this.ut=!!t,this.C=this.ht(),this._instance.persistence&&this._instance.persistence.register({[nr]:this.ut}),this.startIfEnabled()}captureException(e){var t,i,n=null!=(t=null==e||null==(i=e.$exception_list)||null==(i=i[0])?void 0:i.type)?t:"Exception";this.dt.consumeRateLimit(n)?sT.info("Skipping exception capture because of client rate limiting.",{exception:n}):this._instance.exceptions.sendExceptionEvent(e)}}function sD(e,t,i){try{if(!(t in e))return()=>{};var n=e[t],s=i(n);return t9(s)&&(s.prototype=s.prototype||{},Object.defineProperties(s,{__posthog_wrapped__:{enumerable:!1,value:!0}})),e[t]=s,()=>{e[t]=n}}catch(e){return()=>{}}}class sz{constructor(e){var t;this._instance=e,this.vt=(null==tA||null==(t=tA.location)?void 0:t.pathname)||""}get isEnabled(){return"history_change"===this._instance.config.capture_pageview}startIfEnabled(){this.isEnabled&&(iK.info("History API monitoring enabled, starting..."),this.monitorHistoryChanges())}stop(){this.ct&&this.ct(),this.ct=void 0,iK.info("History API monitoring stopped")}monitorHistoryChanges(){var e,t;if(tA&&tA.history){var i=this;null!=(e=tA.history.pushState)&&e.__posthog_wrapped__||sD(tA.history,"pushState",e=>function(t,n,s){e.call(this,t,n,s),i.ft("pushState")}),null!=(t=tA.history.replaceState)&&t.__posthog_wrapped__||sD(tA.history,"replaceState",e=>function(t,n,s){e.call(this,t,n,s),i.ft("replaceState")}),this.gt()}}ft(e){try{var t,i=null==tA||null==(t=tA.location)?void 0:t.pathname;if(!i)return;i!==this.vt&&this.isEnabled&&this._instance.capture("$pageview",{navigation_type:e}),this.vt=i}catch(t){iK.error("Error capturing "+e+" pageview",t)}}gt(){if(!this.ct){var e=()=>{this.ft("popstate")};i9(tA,"popstate",e),this.ct=()=>{tA&&tA.removeEventListener("popstate",e)}}}}var s$=iY("[SegmentIntegration]"),sF="posthog-js";function sO(e,t){var{organization:i,projectId:n,prefix:s,severityAllowList:r=["error"],sendExceptionsToPostHog:a=!0}=void 0===t?{}:t;return t=>{if(!("*"===r||r.includes(t.level))||!e.__loaded)return t;t.tags||(t.tags={});var o,l,c,u,d,h=e.requestRouter.endpointFor("ui","/project/"+e.config.token+"/person/"+e.get_distinct_id());t.tags["PostHog Person URL"]=h,e.sessionRecordingStarted()&&(t.tags["PostHog Recording URL"]=e.get_session_replay_url({withTimestamp:!0}));var p=(null==(o=t.exception)?void 0:o.values)||[],g=p.map(e=>tJ({},e,{stacktrace:e.stacktrace?tJ({},e.stacktrace,{type:"raw",frames:(e.stacktrace.frames||[]).map(e=>tJ({},e,{platform:"web:javascript"}))}):void 0})),f={$exception_message:(null==(l=p[0])?void 0:l.value)||t.message,$exception_type:null==(c=p[0])?void 0:c.type,$exception_level:t.level,$exception_list:g,$sentry_event_id:t.event_id,$sentry_exception:t.exception,$sentry_exception_message:(null==(u=p[0])?void 0:u.value)||t.message,$sentry_exception_type:null==(d=p[0])?void 0:d.type,$sentry_tags:t.tags};return i&&n&&(f.$sentry_url=(s||"https://sentry.io/organizations/")+i+"/issues/?project="+n+"&query="+t.event_id),a&&e.exceptions.sendExceptionEvent(f),t}}class sV{constructor(e,t,i,n,s,r){this.name=sF,this.setupOnce=function(a){a(sO(e,{organization:t,projectId:i,prefix:n,severityAllowList:s,sendExceptionsToPostHog:null==r||r}))}}}var sq=null!=tA&&tA.location?sn(tA.location.hash,"__posthog")||sn(location.hash,"state"):null,sB="_postHogToolbarParams",sj=iY("[Toolbar]"),sH=((oL=sH||{})[oL.UNINITIALIZED=0]="UNINITIALIZED",oL[oL.LOADING=1]="LOADING",oL[oL.LOADED=2]="LOADED",oL);class sU{constructor(e){this.instance=e}_t(e){tG.ph_toolbar_state=e}yt(){var e;return null!=(e=tG.ph_toolbar_state)?e:sH.UNINITIALIZED}maybeLoadToolbar(e,t,i){if(void 0===e&&(e=void 0),void 0===t&&(t=void 0),void 0===i&&(i=void 0),!tA||!tV)return!1;e=null!=e?e:tA.location,i=null!=i?i:tA.history;try{if(!t){try{tA.localStorage.setItem("test","test"),tA.localStorage.removeItem("test")}catch(e){return!1}t=null==tA?void 0:tA.localStorage}var n,s=sq||sn(e.hash,"__posthog")||sn(e.hash,"state"),r=s?i5(()=>JSON.parse(atob(decodeURIComponent(s))))||i5(()=>JSON.parse(decodeURIComponent(s))):null;return r&&"ph_authorize"===r.action?((n=r).source="url",n&&Object.keys(n).length>0&&(r.desiredHash?e.hash=r.desiredHash:i?i.replaceState(i.state,"",e.pathname+e.search):e.hash="")):((n=JSON.parse(t.getItem(sB)||"{}")).source="localstorage",delete n.userIntent),!(!n.token||this.instance.config.token!==n.token)&&(this.loadToolbar(n),!0)}catch(e){return!1}}bt(e){var t=tG.ph_load_toolbar||tG.ph_load_editor;!io(t)&&t9(t)?t(e,this.instance):sj.warn("No toolbar load function found")}loadToolbar(e){var t,i=!(null==tV||!tV.getElementById(nM));if(!tA||i)return!1;var n="custom"===this.instance.requestRouter.region&&this.instance.config.advanced_disable_toolbar_metrics,s=tJ({token:this.instance.config.token},e,{apiURL:this.instance.requestRouter.endpointFor("ui")},n?{instrument:!1}:{});return(tA.localStorage.setItem(sB,JSON.stringify(tJ({},s,{source:void 0}))),this.yt()===sH.LOADED)?this.bt(s):this.yt()===sH.UNINITIALIZED&&(this._t(sH.LOADING),null==(t=tG.__PosthogExtensions__)||null==t.loadExternalDependency||t.loadExternalDependency(this.instance,"toolbar",e=>{if(e)return sj.error("[Toolbar] Failed to load",e),void this._t(sH.UNINITIALIZED);this._t(sH.LOADED),this.bt(s)}),i9(tA,"turbolinks:load",()=>{this._t(sH.UNINITIALIZED),this.loadToolbar(s)})),!0}wt(e){return this.loadToolbar(e)}maybeLoadEditor(e,t,i){return void 0===e&&(e=void 0),void 0===t&&(t=void 0),void 0===i&&(i=void 0),this.maybeLoadToolbar(e,t,i)}}var sG=iY("[TracingHeaders]");class sW{constructor(e){this.xt=void 0,this.St=void 0,this.rt=()=>{var e,t;ii(this.xt)&&(null==(e=tG.__PosthogExtensions__)||null==(e=e.tracingHeadersPatchFns)||e._patchXHR(this._instance.config.__add_tracing_headers||[],this._instance.get_distinct_id(),this._instance.sessionManager)),ii(this.St)&&(null==(t=tG.__PosthogExtensions__)||null==(t=t.tracingHeadersPatchFns)||t._patchFetch(this._instance.config.__add_tracing_headers||[],this._instance.get_distinct_id(),this._instance.sessionManager))},this._instance=e}it(e){var t,i;null!=(t=tG.__PosthogExtensions__)&&t.tracingHeadersPatchFns&&e(),null==(i=tG.__PosthogExtensions__)||null==i.loadExternalDependency||i.loadExternalDependency(this._instance,"tracing-headers",t=>{if(t)return sG.error("failed to load script",t);e()})}startIfEnabledOrStop(){var e,t;this._instance.config.__add_tracing_headers?this.it(this.rt):(null==(e=this.xt)||e.call(this),null==(t=this.St)||t.call(this),this.xt=void 0,this.St=void 0)}}var sK="Mobile",sY="Android",sJ="Tablet",sX=sY+" "+sJ,sZ="iPad",sQ="Apple",s0=sQ+" Watch",s1="Safari",s2="BlackBerry",s3="Samsung",s5=s3+"Browser",s4=s3+" Internet",s6="Chrome",s8=s6+" OS",s7=s6+" iOS",s9="Internet Explorer",re=s9+" "+sK,rt="Opera",ri=rt+" Mini",rn="Edge",rs="Microsoft "+rn,rr="Firefox",ra=rr+" iOS",ro="Nintendo",rl="PlayStation",rc="Xbox",ru=sY+" "+sK,rd=sK+" "+s1,rh="Windows",rp=rh+" Phone",rg="Nokia",rf="Ouya",rm="Generic",rv=rm+" "+sK.toLowerCase(),ry=rm+" "+sJ.toLowerCase(),rb="Konqueror",r_="(\\d+(\\.\\d+)?)",rw=RegExp("Version/"+r_),rS=RegExp(rc,"i"),rx=RegExp(rl+" \\w+","i"),rC=RegExp(ro+" \\w+","i"),rk=RegExp(s2+"|PlayBook|BB10","i"),rE={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},rN=function(e,t){var i;return t=t||"",t1(e," OPR/")&&t1(e,"Mini")?ri:t1(e," OPR/")?rt:rk.test(e)?s2:t1(e,"IE"+sK)||t1(e,"WPDesktop")?re:t1(e,s5)?s4:t1(e,rn)||t1(e,"Edg/")?rs:t1(e,"FBIOS")?"Facebook "+sK:t1(e,"UCWEB")||t1(e,"UCBrowser")?"UC Browser":t1(e,"CriOS")?s7:t1(e,"CrMo")||t1(e,s6)?s6:t1(e,sY)&&t1(e,s1)?ru:t1(e,"FxiOS")?ra:t1(e.toLowerCase(),rb.toLowerCase())?rb:(i=t)&&t1(i,sQ)||t1(e,s1)&&!t1(e,s6)&&!t1(e,sY)?t1(e,sK)?rd:s1:t1(e,rr)?rr:t1(e,"MSIE")||t1(e,"Trident/")?s9:t1(e,"Gecko")?rr:""},rP={[re]:[RegExp("rv:"+r_)],[rs]:[RegExp(rn+"?\\/"+r_)],[s6]:[RegExp("("+s6+"|CrMo)\\/"+r_)],[s7]:[RegExp("CriOS\\/"+r_)],"UC Browser":[RegExp("(UCBrowser|UCWEB)\\/"+r_)],[s1]:[rw],[rd]:[rw],[rt]:[RegExp("(Opera|OPR)\\/"+r_)],[rr]:[RegExp(rr+"\\/"+r_)],[ra]:[RegExp("FxiOS\\/"+r_)],[rb]:[RegExp("Konqueror[:/]?"+r_,"i")],[s2]:[RegExp(s2+" "+r_),rw],[ru]:[RegExp("android\\s"+r_,"i")],[s4]:[RegExp(s5+"\\/"+r_)],[s9]:[RegExp("(rv:|MSIE )"+r_)],Mozilla:[RegExp("rv:"+r_)]},rM=function(e,t){var i=rP[rN(e,t)];if(ii(i))return null;for(var n=0;n<i.length;n++){var s=i[n],r=e.match(s);if(r)return parseFloat(r[r.length-2])}return null},rL=[[RegExp(rc+"; "+rc+" (.*?)[);]","i"),e=>[rc,e&&e[1]||""]],[RegExp(ro,"i"),[ro,""]],[RegExp(rl,"i"),[rl,""]],[rk,[s2,""]],[RegExp(rh,"i"),(e,t)=>{if(/Phone/.test(t)||/WPDesktop/.test(t))return[rp,""];if(new RegExp(sK).test(t)&&!/IEMobile\b/.test(t))return[rh+" "+sK,""];var i=/Windows NT ([0-9.]+)/i.exec(t);if(i&&i[1]){var n=rE[i[1]]||"";return/arm/i.test(t)&&(n="RT"),[rh,n]}return[rh,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,e=>e&&e[3]?["iOS",[e[3],e[4],e[5]||"0"].join(".")]:["iOS",""]],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,e=>{var t="";return e&&e.length>=3&&(t=ii(e[2])?e[3]:e[2]),["watchOS",t]}],[RegExp("("+sY+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+sY+")","i"),e=>e&&e[2]?[sY,[e[2],e[3],e[4]||"0"].join(".")]:[sY,""]],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,e=>{var t=["Mac OS X",""];if(e&&e[1]){var i=[e[1],e[2],e[3]||"0"];t[1]=i.join(".")}return t}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[s8,""]],[/Linux|debian/i,["Linux",""]]],rR=function(e){return rC.test(e)?ro:rx.test(e)?rl:rS.test(e)?rc:RegExp(rf,"i").test(e)?rf:RegExp("("+rp+"|WPDesktop)","i").test(e)?rp:/iPad/.test(e)?sZ:/iPod/.test(e)?"iPod Touch":/iPhone/.test(e)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(e)?s0:rk.test(e)?s2:/(kobo)\s(ereader|touch)/i.test(e)?"Kobo":RegExp(rg,"i").test(e)?rg:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(e)||/(kf[a-z]+)( bui|\)).+silk\//i.test(e)?"Kindle Fire":/(Android|ZTE)/i.test(e)?!new RegExp(sK).test(e)||/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(e)?/pixel[\daxl ]{1,6}/i.test(e)&&!/pixel c/i.test(e)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(e)||/lmy47v/i.test(e)&&!/QTAQZ3/i.test(e)?sY:sX:sY:RegExp("(pda|"+sK+")","i").test(e)?rv:RegExp(sJ,"i").test(e)&&!RegExp(sJ+" pc","i").test(e)?ry:""},rI="https?://(.*)",rT=["gclid","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","igshid","ttclid","rdt_cid","epik","qclid","sccid","irclid","_kx"],rA=i2(["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gad_source","mc_cid"],rT),rD="<masked>",rz=["li_fat_id"];function r$(e,t,i){if(!tV)return{};var n,s=t?i2([],rT,i||[]):[],r=rF(si(tV.URL,s,rD),e);return i1((n={},i0(rz,function(e){var t=sy.q(e);n[e]=t||null}),n),r)}function rF(e,t){var i=rA.concat(t||[]),n={};return i0(i,function(t){var i=st(e,t);n[t]=i||null}),n}function rO(e){var t=e?0===e.search(rI+"google.([^/?]*)")?"google":0===e.search(rI+"bing.com")?"bing":0===e.search(rI+"yahoo.com")?"yahoo":0===e.search(rI+"duckduckgo.com")?"duckduckgo":null:null,i={};if(!ia(t)){i.$search_engine=t;var n=tV?st(tV.referrer,"yahoo"!=t?"q":"p"):"";n.length&&(i.ph_keyword=n)}return i}function rV(){return navigator.language||navigator.userLanguage}function rq(){return(null==tV?void 0:tV.referrer)||"$direct"}function rB(e,t){var i=e?i2([],rT,t||[]):[],n=null==tq?void 0:tq.href.substring(0,1e3);return{r:rq().substring(0,1e3),u:n?si(n,i,rD):void 0}}function rj(e){var t,{r:i,u:n}=e,s={$referrer:i,$referring_domain:null==i?void 0:"$direct"==i?"$direct":null==(t=n9(i))?void 0:t.host};if(n){s.$current_url=n;var r=n9(n);s.$host=null==r?void 0:r.host,s.$pathname=null==r?void 0:r.pathname,i1(s,rF(n))}return i&&i1(s,rO(i)),s}function rH(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return}}var rU=iY("[Web Vitals]");class rG{constructor(e){var t;this.Et=!1,this.P=!1,this.N={url:void 0,metrics:[],firstMetricTimestamp:void 0},this.$t=()=>{clearTimeout(this.kt),0!==this.N.metrics.length&&(this._instance.capture("$web_vitals",this.N.metrics.reduce((e,t)=>tJ({},e,{["$web_vitals_"+t.name+"_event"]:tJ({},t),["$web_vitals_"+t.name+"_value"]:t.value}),{})),this.N={url:void 0,metrics:[],firstMetricTimestamp:void 0})},this.Pt=e=>{var t,i=null==(t=this._instance.sessionManager)?void 0:t.checkAndGetSessionAndWindowId(!0);if(ii(i))rU.error("Could not read session ID. Dropping metrics!");else{this.N=this.N||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var n=this.Tt();ii(n)||(io(null==e?void 0:e.name)||io(null==e?void 0:e.value)?rU.error("Invalid metric received",e):this.Rt&&e.value>=this.Rt?rU.error("Ignoring metric with value >= "+this.Rt,e):(this.N.url!==n&&(this.$t(),this.kt=setTimeout(this.$t,this.flushToCaptureTimeoutMs)),ii(this.N.url)&&(this.N.url=n),this.N.firstMetricTimestamp=ii(this.N.firstMetricTimestamp)?Date.now():this.N.firstMetricTimestamp,e.attribution&&e.attribution.interactionTargetElement&&(e.attribution.interactionTargetElement=void 0),this.N.metrics.push(tJ({},e,{$current_url:n,$session_id:i.sessionId,$window_id:i.windowId,timestamp:Date.now()})),this.N.metrics.length===this.allowedMetrics.length&&this.$t()))}},this.rt=()=>{var e,t,i,n,s=tG.__PosthogExtensions__;ii(s)||ii(s.postHogWebVitalsCallbacks)||({onLCP:e,onCLS:t,onFCP:i,onINP:n}=s.postHogWebVitalsCallbacks),e&&t&&i&&n?(this.allowedMetrics.indexOf("LCP")>-1&&e(this.Pt.bind(this)),this.allowedMetrics.indexOf("CLS")>-1&&t(this.Pt.bind(this)),this.allowedMetrics.indexOf("FCP")>-1&&i(this.Pt.bind(this)),this.allowedMetrics.indexOf("INP")>-1&&n(this.Pt.bind(this)),this.P=!0):rU.error("web vitals callbacks not loaded - not starting")},this._instance=e,this.Et=!(null==(t=this._instance.persistence)||!t.props[nl]),this.startIfEnabled()}get allowedMetrics(){var e,t,i=ie(this._instance.config.capture_performance)?null==(e=this._instance.config.capture_performance)?void 0:e.web_vitals_allowed_metrics:void 0;return ii(i)?(null==(t=this._instance.persistence)?void 0:t.props[nu])||["CLS","FCP","INP","LCP"]:i}get flushToCaptureTimeoutMs(){return(ie(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals_delayed_flush_ms:void 0)||5e3}get Rt(){var e=ie(this._instance.config.capture_performance)&&il(this._instance.config.capture_performance.__web_vitals_max_value)?this._instance.config.capture_performance.__web_vitals_max_value:9e5;return 0<e&&e<=6e4?9e5:e}get isEnabled(){var e=null==tq?void 0:tq.protocol;if("http:"!==e&&"https:"!==e)return rU.info("Web Vitals are disabled on non-http/https protocols"),!1;var t=ie(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals:ic(this._instance.config.capture_performance)?this._instance.config.capture_performance:void 0;return ic(t)?t:this.Et}startIfEnabled(){this.isEnabled&&!this.P&&(rU.info("enabled, starting..."),this.it(this.rt))}onRemoteConfig(e){var t=ie(e.capturePerformance)&&!!e.capturePerformance.web_vitals,i=ie(e.capturePerformance)?e.capturePerformance.web_vitals_allowed_metrics:void 0;this._instance.persistence&&(this._instance.persistence.register({[nl]:t}),this._instance.persistence.register({[nu]:i})),this.Et=t,this.startIfEnabled()}it(e){var t,i;null!=(t=tG.__PosthogExtensions__)&&t.postHogWebVitalsCallbacks&&e(),null==(i=tG.__PosthogExtensions__)||null==i.loadExternalDependency||i.loadExternalDependency(this._instance,"web-vitals",t=>{t?rU.error("failed to load script",t):e()})}Tt(){var e=tA?tA.location.href:void 0;if(e){var t=this._instance.config.mask_personal_data_properties,i=this._instance.config.custom_personal_data_properties;return si(e,t?i2([],rT,i||[]):[],rD)}rU.error("Could not determine current URL")}}var rW=iY("[Heatmaps]");function rK(e){return ie(e)&&"clientX"in e&&"clientY"in e&&il(e.clientX)&&il(e.clientY)}class rY{constructor(e){var t;this.rageclicks=new n6,this.Et=!1,this.P=!1,this.It=null,this.instance=e,this.Et=!(null==(t=this.instance.persistence)||!t.props[ns])}get flushIntervalMilliseconds(){var e=5e3;return ie(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(e=this.instance.config.capture_heatmaps.flush_interval_milliseconds),e}get isEnabled(){return ii(this.instance.config.capture_heatmaps)?ii(this.instance.config.enable_heatmaps)?this.Et:this.instance.config.enable_heatmaps:!1!==this.instance.config.capture_heatmaps}startIfEnabled(){if(this.isEnabled)this.P||(rW.info("starting..."),this.Ct(),this.Ot());else{var e;clearInterval(null!=(e=this.It)?e:void 0),this.Ft(),this.getAndClearBuffer()}}onRemoteConfig(e){var t=!!e.heatmaps;this.instance.persistence&&this.instance.persistence.register({[ns]:t}),this.Et=t,this.startIfEnabled()}getAndClearBuffer(){var e=this.N;return this.N=void 0,e}Mt(e){this.At(e.originalEvent,"deadclick")}Ot(){this.It&&clearInterval(this.It),this.It="visible"===(null==tV?void 0:tV.visibilityState)?setInterval(this.Dt.bind(this),this.flushIntervalMilliseconds):null}Ct(){tA&&tV&&(this.jt=this.Dt.bind(this),i9(tA,"beforeunload",this.jt),this.Lt=e=>this.At(e||(null==tA?void 0:tA.event)),i9(tV,"click",this.Lt,{capture:!0}),this.Nt=e=>this.Ut(e||(null==tA?void 0:tA.event)),i9(tV,"mousemove",this.Nt,{capture:!0}),this.zt=new sI(this.instance,sL,this.Mt.bind(this)),this.zt.startIfEnabled(),this.Ht=this.Ot.bind(this),i9(tV,"visibilitychange",this.Ht),this.P=!0)}Ft(){var e;tA&&tV&&(this.jt&&tA.removeEventListener("beforeunload",this.jt),this.Lt&&tV.removeEventListener("click",this.Lt,{capture:!0}),this.Nt&&tV.removeEventListener("mousemove",this.Nt,{capture:!0}),this.Ht&&tV.removeEventListener("visibilitychange",this.Ht),clearTimeout(this.Bt),null==(e=this.zt)||e.stop(),this.P=!1)}qt(e,t){var i=this.instance.scrollManager.scrollY(),n=this.instance.scrollManager.scrollX(),s=this.instance.scrollManager.scrollElement(),r=function(e,t,i){for(var n=e;n&&nT(n)&&!nA(n,"body")&&n!==i;){if(t1(t,null==tA?void 0:tA.getComputedStyle(n).position))return!0;n=nU(n)}return!1}(nB(e),["fixed","sticky"],s);return{x:e.clientX+(r?0:n),y:e.clientY+(r?0:i),target_fixed:r,type:t}}At(e,t){var i;if(void 0===t&&(t="click"),!nI(e.target)&&rK(e)){var n=this.qt(e,t);null!=(i=this.rageclicks)&&i.isRageClick(e.clientX,e.clientY,(new Date).getTime())&&this.Wt(tJ({},n,{type:"rageclick"})),this.Wt(n)}}Ut(e){!nI(e.target)&&rK(e)&&(clearTimeout(this.Bt),this.Bt=setTimeout(()=>{this.Wt(this.qt(e,"mousemove"))},500))}Wt(e){if(tA){var t=tA.location.href,i=this.instance.config.mask_personal_data_properties,n=this.instance.config.custom_personal_data_properties,s=si(t,i?i2([],rT,n||[]):[],rD);this.N=this.N||{},this.N[s]||(this.N[s]=[]),this.N[s].push(e)}}Dt(){this.N&&!it(this.N)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}class rJ{constructor(e){this._instance=e}doPageView(e,t){var i,n=this.Gt(e,t);return this.Vt={pathname:null!=(i=null==tA?void 0:tA.location.pathname)?i:"",pageViewId:t,timestamp:e},this._instance.scrollManager.resetContext(),n}doPageLeave(e){var t;return this.Gt(e,null==(t=this.Vt)?void 0:t.pageViewId)}doEvent(){var e;return{$pageview_id:null==(e=this.Vt)?void 0:e.pageViewId}}Gt(e,t){var i=this.Vt;if(!i)return{$pageview_id:t};var n={$pageview_id:t,$prev_pageview_id:i.pageViewId},s=this._instance.scrollManager.getContext();if(s&&!this._instance.config.disable_scroll_properties){var{maxScrollHeight:r,lastScrollY:a,maxScrollY:o,maxContentHeight:l,lastContentY:c,maxContentY:u}=s;if(!(ii(r)||ii(a)||ii(o)||ii(l)||ii(c)||ii(u))){r=Math.ceil(r),a=Math.ceil(a),o=Math.ceil(o),l=Math.ceil(l),c=Math.ceil(c),u=Math.ceil(u);var d=r<=1?1:iy(a/r,0,1,iK),h=r<=1?1:iy(o/r,0,1,iK),p=l<=1?1:iy(c/l,0,1,iK),g=l<=1?1:iy(u/l,0,1,iK);n=i1(n,{$prev_pageview_last_scroll:a,$prev_pageview_last_scroll_percentage:d,$prev_pageview_max_scroll:o,$prev_pageview_max_scroll_percentage:h,$prev_pageview_last_content:c,$prev_pageview_last_content_percentage:p,$prev_pageview_max_content:u,$prev_pageview_max_content_percentage:g})}}return i.pathname&&(n.$prev_pageview_pathname=i.pathname),i.timestamp&&(n.$prev_pageview_duration=(e.getTime()-i.timestamp.getTime())/1e3),n}}var rX=Uint8Array,rZ=Uint16Array,rQ=Uint32Array,r0=new rX([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),r1=new rX([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),r2=new rX([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r3=function(e,t){for(var i=new rZ(31),n=0;n<31;++n)i[n]=t+=1<<e[n-1];var s=new rQ(i[30]);for(n=1;n<30;++n)for(var r=i[n];r<i[n+1];++r)s[r]=r-i[n]<<5|n;return[i,s]},r5=r3(r0,2),r4=r5[0],r6=r5[1];r4[28]=258,r6[258]=28;for(var r8=r3(r1,0)[1],r7=new rZ(32768),r9=0;r9<32768;++r9){var ae=(43690&r9)>>>1|(21845&r9)<<1;ae=(61680&(ae=(52428&ae)>>>2|(13107&ae)<<2))>>>4|(3855&ae)<<4,r7[r9]=((65280&ae)>>>8|(255&ae)<<8)>>>1}var at=function(e,t,i){for(var n=e.length,s=0,r=new rZ(t);s<n;++s)++r[e[s]-1];var a,o=new rZ(t);for(s=0;s<t;++s)o[s]=o[s-1]+r[s-1]<<1;if(i){a=new rZ(1<<t);var l=15-t;for(s=0;s<n;++s)if(e[s])for(var c=s<<4|e[s],u=t-e[s],d=o[e[s]-1]++<<u,h=d|(1<<u)-1;d<=h;++d)a[r7[d]>>>l]=c}else for(a=new rZ(n),s=0;s<n;++s)a[s]=r7[o[e[s]-1]++]>>>15-e[s];return a},ai=new rX(288);for(r9=0;r9<144;++r9)ai[r9]=8;for(r9=144;r9<256;++r9)ai[r9]=9;for(r9=256;r9<280;++r9)ai[r9]=7;for(r9=280;r9<288;++r9)ai[r9]=8;var an=new rX(32);for(r9=0;r9<32;++r9)an[r9]=5;var as=at(ai,9,0),ar=at(an,5,0),aa=function(e){return(e/8|0)+(7&e&&1)},ao=function(e,t,i){(null==i||i>e.length)&&(i=e.length);var n=new(e instanceof rZ?rZ:e instanceof rQ?rQ:rX)(i-t);return n.set(e.subarray(t,i)),n},al=function(e,t,i){i<<=7&t;var n=t/8|0;e[n]|=i,e[n+1]|=i>>>8},ac=function(e,t,i){i<<=7&t;var n=t/8|0;e[n]|=i,e[n+1]|=i>>>8,e[n+2]|=i>>>16},au=function(e,t){for(var i=[],n=0;n<e.length;++n)e[n]&&i.push({s:n,f:e[n]});var s=i.length,r=i.slice();if(!s)return[new rX(0),0];if(1==s){var a=new rX(i[0].s+1);return a[i[0].s]=1,[a,1]}i.sort(function(e,t){return e.f-t.f}),i.push({s:-1,f:25001});var o=i[0],l=i[1],c=0,u=1,d=2;for(i[0]={s:-1,f:o.f+l.f,l:o,r:l};u!=s-1;)o=i[i[c].f<i[d].f?c++:d++],l=i[c!=u&&i[c].f<i[d].f?c++:d++],i[u++]={s:-1,f:o.f+l.f,l:o,r:l};var h=r[0].s;for(n=1;n<s;++n)r[n].s>h&&(h=r[n].s);var p=new rZ(h+1),g=ad(i[u-1],p,0);if(g>t){n=0;var f=0,m=g-t,v=1<<m;for(r.sort(function(e,t){return p[t.s]-p[e.s]||e.f-t.f});n<s;++n){var y=r[n].s;if(!(p[y]>t))break;f+=v-(1<<g-p[y]),p[y]=t}for(f>>>=m;f>0;){var b=r[n].s;p[b]<t?f-=1<<t-p[b]++-1:++n}for(;n>=0&&f;--n){var _=r[n].s;p[_]==t&&(--p[_],++f)}g=t}return[new rX(p),g]},ad=function(e,t,i){return -1==e.s?Math.max(ad(e.l,t,i+1),ad(e.r,t,i+1)):t[e.s]=i},ah=function(e){for(var t=e.length;t&&!e[--t];);for(var i=new rZ(++t),n=0,s=e[0],r=1,a=function(e){i[n++]=e},o=1;o<=t;++o)if(e[o]==s&&o!=t)++r;else{if(!s&&r>2){for(;r>138;r-=138)a(32754);r>2&&(a(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(a(s),--r;r>6;r-=6)a(8304);r>2&&(a(r-3<<5|8208),r=0)}for(;r--;)a(s);r=1,s=e[o]}return[i.subarray(0,n),t]},ap=function(e,t){for(var i=0,n=0;n<t.length;++n)i+=e[n]*t[n];return i},ag=function(e,t,i){var n=i.length,s=aa(t+2);e[s]=255&n,e[s+1]=n>>>8,e[s+2]=255^e[s],e[s+3]=255^e[s+1];for(var r=0;r<n;++r)e[s+r+4]=i[r];return 8*(s+4+n)},af=function(e,t,i,n,s,r,a,o,l,c,u){al(t,u++,i),++s[256];for(var d=au(s,15),h=d[0],p=d[1],g=au(r,15),f=g[0],m=g[1],v=ah(h),y=v[0],b=v[1],_=ah(f),w=_[0],S=_[1],x=new rZ(19),C=0;C<y.length;++C)x[31&y[C]]++;for(C=0;C<w.length;++C)x[31&w[C]]++;for(var k=au(x,7),E=k[0],N=k[1],P=19;P>4&&!E[r2[P-1]];--P);var M,L,R,I,T=c+5<<3,A=ap(s,ai)+ap(r,an)+a,D=ap(s,h)+ap(r,f)+a+14+3*P+ap(x,E)+(2*x[16]+3*x[17]+7*x[18]);if(T<=A&&T<=D)return ag(t,u,e.subarray(l,l+c));if(al(t,u,1+(D<A)),u+=2,D<A){M=at(h,p,0),L=h,R=at(f,m,0),I=f;var z=at(E,N,0);for(al(t,u,b-257),al(t,u+5,S-1),al(t,u+10,P-4),u+=14,C=0;C<P;++C)al(t,u+3*C,E[r2[C]]);u+=3*P;for(var $=[y,w],F=0;F<2;++F){var O=$[F];for(C=0;C<O.length;++C){var V=31&O[C];al(t,u,z[V]),u+=E[V],V>15&&(al(t,u,O[C]>>>5&127),u+=O[C]>>>12)}}}else M=as,L=ai,R=ar,I=an;for(C=0;C<o;++C)if(n[C]>255){ac(t,u,M[(V=n[C]>>>18&31)+257]),u+=L[V+257],V>7&&(al(t,u,n[C]>>>23&31),u+=r0[V]);var q=31&n[C];ac(t,u,R[q]),u+=I[q],q>3&&(ac(t,u,n[C]>>>5&8191),u+=r1[q])}else ac(t,u,M[n[C]]),u+=L[n[C]];return ac(t,u,M[256]),u+L[256]},am=new rQ([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),av=function(){for(var e=new rQ(256),t=0;t<256;++t){for(var i=t,n=9;--n;)i=(1&i&&0xedb88320)^i>>>1;e[t]=i}return e}(),ay=function(e,t,i){for(;i;++t)e[t]=i,i>>>=8},ab=function(e){var t,i,n,s,r="";for(t=i=0,n=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,s=0;s<n;s++){var a=e.charCodeAt(s),o=null;a<128?i++:o=a>127&&a<2048?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),ia(o)||(i>t&&(r+=e.substring(t,i)),r+=o,t=i=s+1)}return i>t&&(r+=e.substring(t,e.length)),r},a_=!!tj||!!tB,aw="text/plain",aS=function(e,t,i){void 0===i&&(i=!0);var n,[s,r]=e.split("?"),a=tJ({},t),o=null!=(n=null==r?void 0:r.split("&").map(e=>{var t,[n,s]=e.split("="),r=i&&null!=(t=a[n])?t:s;return delete a[n],n+"="+r}))?n:[],l=se(a);return l&&o.push(l),s+"?"+o.join("&")},ax=(e,t)=>JSON.stringify(e,(e,t)=>"bigint"==typeof t?t.toString():t,t),aC=e=>{var{data:t,compression:i}=e;if(t){if(i===n7.GZipJS){var n,s,r,a,o,l,c,u,d=new Blob([(n=function(e,t){var i=e.length;if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);for(var n=new rX(e.length+(e.length>>>1)),s=0,r=function(e){n[s++]=e},a=0;a<i;++a){if(s+5>n.length){var o=new rX(s+8+(i-a<<1));o.set(n),n=o}var l=e.charCodeAt(a);l<128?r(l):(l<2048?r(192|l>>>6):(l>55295&&l<57344?(r(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++a))>>>18),r(128|l>>>12&63)):r(224|l>>>12),r(128|l>>>6&63)),r(128|63&l))}return ao(n,0,s)}(ax(t)),s={mtime:0},r=0xffffffff,a={p:function(e){for(var t=r,i=0;i<e.length;++i)t=av[255&t^e[i]]^t>>>8;r=t},d:function(){return 0xffffffff^r}},o=n.length,a.p(n),u=(l=10+(s.filename&&s.filename.length+1||0),c=function(e,t,i,n,s,r){var a=e.length,o=new rX(n+a+5*(1+Math.floor(a/7e3))+8),l=o.subarray(n,o.length-s),c=0;if(!t||a<8)for(var u=0;u<=a;u+=65535){var d=u+65535;d<a?c=ag(l,c,e.subarray(u,d)):(l[u]=r,c=ag(l,c,e.subarray(u,a)))}else{for(var h=am[t-1],p=h>>>13,g=8191&h,f=(1<<i)-1,m=new rZ(32768),v=new rZ(f+1),y=Math.ceil(i/3),b=2*y,_=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<b)&f},w=new rQ(25e3),S=new rZ(288),x=new rZ(32),C=0,k=0,E=(u=0,0),N=0,P=0;u<a;++u){var M=_(u),L=32767&u,R=v[M];if(m[L]=R,v[M]=L,N<=u){var I=a-u;if((C>7e3||E>24576)&&I>423){c=af(e,l,0,w,S,x,k,E,P,u-P,c),E=C=k=0,P=u;for(var T=0;T<286;++T)S[T]=0;for(T=0;T<30;++T)x[T]=0}var A=2,D=0,z=g,$=L-R&32767;if(I>2&&M==_(u-$))for(var F=Math.min(p,I)-1,O=Math.min(32767,u),V=Math.min(258,I);$<=O&&--z&&L!=R;){if(e[u+A]==e[u+A-$]){for(var q=0;q<V&&e[u+q]==e[u+q-$];++q);if(q>A){if(A=q,D=$,q>F)break;var B=Math.min($,q-2),j=0;for(T=0;T<B;++T){var H=u-$+T+32768&32767,U=H-m[H]+32768&32767;U>j&&(j=U,R=H)}}}$+=(L=R)-(R=m[L])+32768&32767}if(D){w[E++]=0x10000000|r6[A]<<18|r8[D];var G=31&r6[A],W=31&r8[D];k+=r0[G]+r1[W],++S[257+G],++x[W],N=u+A,++C}else w[E++]=e[u],++S[e[u]]}}c=af(e,l,r,w,S,x,k,E,P,u-P,c)}return ao(o,0,n+aa(c)+s)}(n,null==s.level?6:s.level,null==s.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(n.length)))):12+s.mem,l,8,!0)).length,function(e,t){var i=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:2*(9==t.level),e[9]=3,0!=t.mtime&&ay(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),i){e[3]=8;for(var n=0;n<=i.length;++n)e[n+10]=i.charCodeAt(n)}}(c,s),ay(c,u-8,a.d()),ay(c,u-4,o),c)],{type:aw});return{contentType:aw,body:d,estimatedSize:d.size}}if(i===n7.Base64){let e;var h="data="+encodeURIComponent("string"==typeof(e=function(e){var t,i,n,s,r,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=0,l=0,c="",u=[];if(!e)return e;e=ab(e);do t=(r=e.charCodeAt(o++)<<16|e.charCodeAt(o++)<<8|e.charCodeAt(o++))>>18&63,i=r>>12&63,n=r>>6&63,s=63&r,u[l++]=a.charAt(t)+a.charAt(i)+a.charAt(n)+a.charAt(s);while(o<e.length)switch(c=u.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c}(ax(t)))?e:ax(e));return{contentType:"application/x-www-form-urlencoded",body:h,estimatedSize:new Blob([h]).size}}var p=ax(t);return{contentType:"application/json",body:p,estimatedSize:new Blob([p]).size}}},ak=[];tB&&ak.push({transport:"fetch",method:e=>{var t,i,{contentType:n,body:s,estimatedSize:r}=null!=(t=aC(e))?t:{},a=new Headers;i0(e.headers,function(e,t){a.append(t,e)}),n&&a.append("Content-Type",n);var o=e.url,l=null;if(tH){var c=new tH;l={signal:c.signal,timeout:setTimeout(()=>c.abort(),e.timeout)}}tB(o,tJ({method:(null==e?void 0:e.method)||"GET",headers:a,keepalive:"POST"===e.method&&52428.8>(r||0),body:s,signal:null==(i=l)?void 0:i.signal},e.fetchOptions)).then(t=>t.text().then(i=>{var n={statusCode:t.status,text:i};if(200===t.status)try{n.json=JSON.parse(i)}catch(e){iK.error(e)}null==e.callback||e.callback(n)})).catch(t=>{iK.error(t),null==e.callback||e.callback({statusCode:0,text:t})}).finally(()=>l?clearTimeout(l.timeout):null)}}),tj&&ak.push({transport:"XHR",method:e=>{var t,i=new tj;i.open(e.method||"GET",e.url,!0);var{contentType:n,body:s}=null!=(t=aC(e))?t:{};i0(e.headers,function(e,t){i.setRequestHeader(t,e)}),n&&i.setRequestHeader("Content-Type",n),e.timeout&&(i.timeout=e.timeout),e.disableXHRCredentials||(i.withCredentials=!0),i.onreadystatechange=()=>{if(4===i.readyState){var t={statusCode:i.status,text:i.responseText};if(200===i.status)try{t.json=JSON.parse(i.responseText)}catch(e){}null==e.callback||e.callback(t)}},i.send(s)}}),null!=tO&&tO.sendBeacon&&ak.push({transport:"sendBeacon",method:e=>{var t=aS(e.url,{beacon:"1"});try{var i,{contentType:n,body:s}=null!=(i=aC(e))?i:{},r="string"==typeof s?new Blob([s],{type:n}):s;tO.sendBeacon(t,r)}catch(e){}}});var aE=function(e,t){if(!function(e){try{new RegExp(e)}catch(e){return!1}return!0}(t))return!1;try{return new RegExp(t).test(e)}catch(e){return!1}};function aN(e,t,i){return ax({distinct_id:e,userPropertiesToSet:t,userPropertiesToSetOnce:i})}var aP={exact:(e,t)=>t.some(t=>e.some(e=>t===e)),is_not:(e,t)=>t.every(t=>e.every(e=>t!==e)),regex:(e,t)=>t.some(t=>e.some(e=>aE(t,e))),not_regex:(e,t)=>t.every(t=>e.every(e=>!aE(t,e))),icontains:(e,t)=>t.map(aM).some(t=>e.map(aM).some(e=>t.includes(e))),not_icontains:(e,t)=>t.map(aM).every(t=>e.map(aM).every(e=>!t.includes(e)))},aM=e=>e.toLowerCase(),aL=iY("[Error tracking]");class aR{constructor(e){var t,i;this.Jt=[],this.Kt=new iD([new iz,new iG,new iF,new i$,new iH,new ij,new iV,new iU],[iL,iT]),this._instance=e,this.Jt=null!=(t=null==(i=this._instance.persistence)?void 0:i.get_property(na))?t:[]}onRemoteConfig(e){var t,i,n,s=null!=(t=null==(i=e.errorTracking)?void 0:i.suppressionRules)?t:[],r=null==(n=e.errorTracking)?void 0:n.captureExtensionExceptions;this.Jt=s,this._instance.persistence&&this._instance.persistence.register({[na]:this.Jt,[no]:r})}get Yt(){var e,t=!!this._instance.get_property(no),i=this._instance.config.error_tracking.captureExtensionExceptions;return null!=(e=null!=i?i:t)&&e}buildProperties(e,t){return this.Kt.buildFromUnknown(e,{syntheticException:null==t?void 0:t.syntheticException,mechanism:{handled:null==t?void 0:t.handled}})}sendExceptionEvent(e){var t=e.$exception_list;if(this.Xt(t)){if(this.Qt(t))return void aL.info("Skipping exception capture because a suppression rule matched");if(!this.Yt&&this.Zt(t))return void aL.info("Skipping exception capture because it was thrown by an extension");if(!this._instance.config.error_tracking.__capturePostHogExceptions&&this.ti(t))return void aL.info("Skipping exception capture because it was thrown by the PostHog SDK")}return this._instance.capture("$exception",e,{_noTruncate:!0,_batchKey:"exceptionEvent"})}Qt(e){if(0===e.length)return!1;var t=e.reduce((e,t)=>{var{type:i,value:n}=t;return is(i)&&i.length>0&&e.$exception_types.push(i),is(n)&&n.length>0&&e.$exception_values.push(n),e},{$exception_types:[],$exception_values:[]});return this.Jt.some(e=>{var i=e.values.map(e=>{var i,n=aP[e.operator],s=t7(e.value)?e.value:[e.value],r=null!=(i=t[e.key])?i:[];return s.length>0&&n(s,r)});return"OR"===e.type?i.some(Boolean):i.every(Boolean)})}Zt(e){return e.flatMap(e=>{var t,i;return null!=(t=null==(i=e.stacktrace)?void 0:i.frames)?t:[]}).some(e=>e.filename&&e.filename.startsWith("chrome-extension://"))}ti(e){if(e.length>0){var t,i,n,s,r=null!=(t=null==(i=e[0].stacktrace)?void 0:i.frames)?t:[],a=r[r.length-1];return null!=(n=null==a||null==(s=a.filename)?void 0:s.includes("posthog.com/static"))&&n}return!1}Xt(e){return!io(e)&&t7(e)}}var aI=iY("[FeatureFlags]"),aT="$active_feature_flags",aA="$override_feature_flags",aD="$feature_flag_payloads",az="$override_feature_flag_payloads",a$="$feature_flag_request_id",aF=e=>{var t={};for(var[i,n]of i3(e||{}))n&&(t[i]=n);return t},aO=((oR={}).FeatureFlags="feature_flags",oR.Recordings="recordings",oR);class aV{constructor(e){this.ii=!1,this.ei=!1,this.ri=!1,this.si=!1,this.ni=!1,this.oi=!1,this.ai=!1,this._instance=e,this.featureFlagEventHandlers=[]}li(){var e=this._instance.config.evaluation_environments;return null!=e&&e.length?e.filter(e=>{var t=e&&"string"==typeof e&&e.trim().length>0;return t||aI.error("Invalid evaluation environment found:",e,"Expected non-empty string"),t}):[]}ui(){return this.li().length>0}flags(){if(this._instance.config.__preview_remote_config)this.oi=!0;else{var e=!this.hi&&(this._instance.config.advanced_disable_feature_flags||this._instance.config.advanced_disable_feature_flags_on_first_load);this.di({disableFlags:e})}}get hasLoadedFlags(){return this.ei}getFlags(){return Object.keys(this.getFlagVariants())}getFlagsWithDetails(){var e=this._instance.get_property(nm),t=this._instance.get_property(aA),i=this._instance.get_property(az);if(!i&&!t)return e||{};var n=i1({},e||{});for(var s of[...new Set([...Object.keys(i||{}),...Object.keys(t||{})])]){var r,a,o=n[s],l=null==t?void 0:t[s],c=ii(l)?null!=(r=null==o?void 0:o.enabled)&&r:!!l,u=ii(l)?o.variant:"string"==typeof l?l:void 0,d=null==i?void 0:i[s],h=tJ({},o,{enabled:c,variant:c?null!=u?u:null==o?void 0:o.variant:void 0});c!==(null==o?void 0:o.enabled)&&(h.original_enabled=null==o?void 0:o.enabled),u!==(null==o?void 0:o.variant)&&(h.original_variant=null==o?void 0:o.variant),d&&(h.metadata=tJ({},null==o?void 0:o.metadata,{payload:d,original_payload:null==o||null==(a=o.metadata)?void 0:a.payload})),n[s]=h}return this.ii||(aI.warn(" Overriding feature flag details!",{flagDetails:e,overriddenPayloads:i,finalDetails:n}),this.ii=!0),n}getFlagVariants(){var e=this._instance.get_property(ng),t=this._instance.get_property(aA);if(!t)return e||{};for(var i=i1({},e),n=Object.keys(t),s=0;s<n.length;s++)i[n[s]]=t[n[s]];return this.ii||(aI.warn(" Overriding feature flags!",{enabledFlags:e,overriddenFlags:t,finalFlags:i}),this.ii=!0),i}getFlagPayloads(){var e=this._instance.get_property(aD),t=this._instance.get_property(az);if(!t)return e||{};for(var i=i1({},e||{}),n=Object.keys(t),s=0;s<n.length;s++)i[n[s]]=t[n[s]];return this.ii||(aI.warn(" Overriding feature flag payloads!",{flagPayloads:e,overriddenPayloads:t,finalPayloads:i}),this.ii=!0),i}reloadFeatureFlags(){this.si||this._instance.config.advanced_disable_feature_flags||this.hi||(this.hi=setTimeout(()=>{this.di()},5))}vi(){clearTimeout(this.hi),this.hi=void 0}ensureFlagsLoaded(){this.ei||this.ri||this.hi||this.reloadFeatureFlags()}setAnonymousDistinctId(e){this.$anon_distinct_id=e}setReloadingPaused(e){this.si=e}di(e){var t;if(this.vi(),!this._instance.M())if(this.ri)this.ni=!0;else{var i={token:this._instance.config.token,distinct_id:this._instance.get_distinct_id(),groups:this._instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:tJ({},(null==(t=this._instance.persistence)?void 0:t.get_initial_props())||{},this._instance.get_property(nv)||{}),group_properties:this._instance.get_property(ny)};(null!=e&&e.disableFlags||this._instance.config.advanced_disable_feature_flags)&&(i.disable_flags=!0),this.ui()&&(i.evaluation_environments=this.li());var n=this._instance.config.__preview_remote_config,s=this._instance.config.advanced_only_evaluate_survey_feature_flags?"&only_evaluate_survey_feature_flags=true":"",r=this._instance.requestRouter.endpointFor("api",(n?"/flags/?v=2":"/flags/?v=2&config=true")+s);n&&(i.timezone=rH()),this.ri=!0,this._instance.ci({method:"POST",url:r,data:i,compression:this._instance.config.disable_compression?void 0:n7.Base64,timeout:this._instance.config.feature_flag_request_timeout_ms,callback:e=>{var t,n,s,r=!0;200===e.statusCode&&(this.ni||(this.$anon_distinct_id=void 0),r=!1),this.ri=!1,this.oi||(this.oi=!0,this._instance.fi(null!=(s=e.json)?s:{})),(!i.disable_flags||this.ni)&&((this.ai=!r,e.json&&null!=(n=e.json.quotaLimited)&&n.includes(aO.FeatureFlags))?aI.warn("You have hit your feature flags quota limit, and will not be able to load feature flags until the quota is reset.  Please visit https://posthog.com/docs/billing/limits-alerts to learn more."):(i.disable_flags||this.receivedFeatureFlags(null!=(t=e.json)?t:{},r),this.ni&&(this.ni=!1,this.di())))}})}}getFeatureFlag(e,t){if(void 0===t&&(t={}),this.ei||this.getFlags()&&this.getFlags().length>0){var i=this.getFlagVariants()[e],n=""+i,s=this._instance.get_property(a$)||void 0,r=this._instance.get_property(nw)||{};if((t.send_event||!("send_event"in t))&&(!(e in r)||!r[e].includes(n))){t7(r[e])?r[e].push(n):r[e]=[n],null==(l=this._instance.persistence)||l.register({[nw]:r});var a=this.getFeatureFlagDetails(e),o={$feature_flag:e,$feature_flag_response:i,$feature_flag_payload:this.getFeatureFlagPayload(e)||null,$feature_flag_request_id:s,$feature_flag_bootstrapped_response:(null==(c=this._instance.config.bootstrap)||null==(c=c.featureFlags)?void 0:c[e])||null,$feature_flag_bootstrapped_payload:(null==(u=this._instance.config.bootstrap)||null==(u=u.featureFlagPayloads)?void 0:u[e])||null,$used_bootstrap_value:!this.ai};ii(null==a||null==(d=a.metadata)?void 0:d.version)||(o.$feature_flag_version=a.metadata.version);var l,c,u,d,h,p,g,f,m,v,y=null!=(h=null==a||null==(p=a.reason)?void 0:p.description)?h:null==a||null==(g=a.reason)?void 0:g.code;y&&(o.$feature_flag_reason=y),null!=a&&null!=(f=a.metadata)&&f.id&&(o.$feature_flag_id=a.metadata.id),ii(null==a?void 0:a.original_variant)&&ii(null==a?void 0:a.original_enabled)||(o.$feature_flag_original_response=ii(a.original_variant)?a.original_enabled:a.original_variant),null!=a&&null!=(m=a.metadata)&&m.original_payload&&(o.$feature_flag_original_payload=null==a||null==(v=a.metadata)?void 0:v.original_payload),this._instance.capture("$feature_flag_called",o)}return i}aI.warn('getFeatureFlag for key "'+e+"\" failed. Feature flags didn't load in time.")}getFeatureFlagDetails(e){return this.getFlagsWithDetails()[e]}getFeatureFlagPayload(e){return this.getFlagPayloads()[e]}getRemoteConfigPayload(e,t){var i=this._instance.config.token,n={distinct_id:this._instance.get_distinct_id(),token:i};this.ui()&&(n.evaluation_environments=this.li()),this._instance.ci({method:"POST",url:this._instance.requestRouter.endpointFor("api","/flags/?v=2&config=true"),data:n,compression:this._instance.config.disable_compression?void 0:n7.Base64,timeout:this._instance.config.feature_flag_request_timeout_ms,callback:i=>{var n,s=null==(n=i.json)?void 0:n.featureFlagPayloads;t((null==s?void 0:s[e])||void 0)}})}isFeatureEnabled(e,t){if(void 0===t&&(t={}),this.ei||this.getFlags()&&this.getFlags().length>0){var i=this.getFeatureFlag(e,t);return ii(i)?void 0:!!i}aI.warn('isFeatureEnabled for key "'+e+"\" failed. Feature flags didn't load in time.")}addFeatureFlagsHandler(e){this.featureFlagEventHandlers.push(e)}removeFeatureFlagsHandler(e){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter(t=>t!==e)}receivedFeatureFlags(e,t){if(this._instance.persistence){this.ei=!0;var i=this.getFlagVariants(),n=this.getFlagPayloads(),s=this.getFlagsWithDetails();!function(e,t,i,n,s){void 0===i&&(i={}),void 0===n&&(n={}),void 0===s&&(s={});var r,a=((r=e.flags)?(e.featureFlags=Object.fromEntries(Object.keys(r).map(e=>{var t;return[e,null!=(t=r[e].variant)?t:r[e].enabled]})),e.featureFlagPayloads=Object.fromEntries(Object.keys(r).filter(e=>r[e].enabled).filter(e=>{var t;return null==(t=r[e].metadata)?void 0:t.payload}).map(e=>{var t;return[e,null==(t=r[e].metadata)?void 0:t.payload]}))):aI.warn("Using an older version of the feature flags endpoint. Please upgrade your PostHog server to the latest version"),e),o=a.flags,l=a.featureFlags,c=a.featureFlagPayloads;if(l){var u=e.requestId;if(t7(l)){aI.warn("v1 of the feature flags endpoint is deprecated. Please use the latest version.");var d={};if(l)for(var h=0;h<l.length;h++)d[l[h]]=!0;t&&t.register({[aT]:l,[ng]:d})}else{var p=l,g=c,f=o;e.errorsWhileComputingFlags&&(p=tJ({},i,p),g=tJ({},n,g),f=tJ({},s,f)),t&&t.register(tJ({[aT]:Object.keys(aF(p)),[ng]:p||{},[aD]:g||{},[nm]:f||{}},u?{[a$]:u}:{}))}}}(e,this._instance.persistence,i,n,s),this.pi(t)}}override(e,t){void 0===t&&(t=!1),aI.warn("override is deprecated. Please use overrideFeatureFlags instead."),this.overrideFeatureFlags({flags:e,suppressWarning:t})}overrideFeatureFlags(e){if(!this._instance.__loaded||!this._instance.persistence)return aI.uninitializedWarning("posthog.featureFlags.overrideFeatureFlags");if(!1===e)return this._instance.persistence.unregister(aA),this._instance.persistence.unregister(az),void this.pi();if(e&&"object"==typeof e&&("flags"in e||"payloads"in e)){var t;if(this.ii=!!(null!=(t=e.suppressWarning)&&t),"flags"in e){if(!1===e.flags)this._instance.persistence.unregister(aA);else if(e.flags)if(t7(e.flags)){for(var i={},n=0;n<e.flags.length;n++)i[e.flags[n]]=!0;this._instance.persistence.register({[aA]:i})}else this._instance.persistence.register({[aA]:e.flags})}return"payloads"in e&&(!1===e.payloads?this._instance.persistence.unregister(az):e.payloads&&this._instance.persistence.register({[az]:e.payloads})),void this.pi()}this.pi()}onFeatureFlags(e){if(this.addFeatureFlagsHandler(e),this.ei){var{flags:t,flagVariants:i}=this.gi();e(t,i)}return()=>this.removeFeatureFlagsHandler(e)}updateEarlyAccessFeatureEnrollment(e,t,i){var n,s=(this._instance.get_property(nf)||[]).find(t=>t.flagKey===e),r={["$feature_enrollment/"+e]:t},a={$feature_flag:e,$feature_enrollment:t,$set:r};s&&(a.$early_access_feature_name=s.name),i&&(a.$feature_enrollment_stage=i),this._instance.capture("$feature_enrollment_update",a),this.setPersonPropertiesForFlags(r,!1);var o=tJ({},this.getFlagVariants(),{[e]:t});null==(n=this._instance.persistence)||n.register({[aT]:Object.keys(aF(o)),[ng]:o}),this.pi()}getEarlyAccessFeatures(e,t,i){void 0===t&&(t=!1);var n=this._instance.get_property(nf),s=i?"&"+i.map(e=>"stage="+e).join("&"):"";if(n&&!t)return e(n);this._instance.ci({url:this._instance.requestRouter.endpointFor("api","/api/early_access_features/?token="+this._instance.config.token+s),method:"GET",callback:t=>{var i,n;if(t.json){var s=t.json.earlyAccessFeatures;return null==(i=this._instance.persistence)||i.unregister(nf),null==(n=this._instance.persistence)||n.register({[nf]:s}),e(s)}}})}gi(){var e=this.getFlags(),t=this.getFlagVariants();return{flags:e.filter(e=>t[e]),flagVariants:Object.keys(t).filter(e=>t[e]).reduce((e,i)=>(e[i]=t[i],e),{})}}pi(e){var{flags:t,flagVariants:i}=this.gi();this.featureFlagEventHandlers.forEach(n=>n(t,i,{errorsLoading:e}))}setPersonPropertiesForFlags(e,t){void 0===t&&(t=!0);var i=this._instance.get_property(nv)||{};this._instance.register({[nv]:tJ({},i,e)}),t&&this._instance.reloadFeatureFlags()}resetPersonPropertiesForFlags(){this._instance.unregister(nv)}setGroupPropertiesForFlags(e,t){void 0===t&&(t=!0);var i=this._instance.get_property(ny)||{};0!==Object.keys(i).length&&Object.keys(i).forEach(t=>{i[t]=tJ({},i[t],e[t]),delete e[t]}),this._instance.register({[ny]:tJ({},i,e)}),t&&this._instance.reloadFeatureFlags()}resetGroupPropertiesForFlags(e){if(e){var t=this._instance.get_property(ny)||{};this._instance.register({[ny]:tJ({},t,{[e]:{}})})}else this._instance.unregister(ny)}reset(){this.ei=!1,this.ri=!1,this.si=!1,this.ni=!1,this.oi=!1,this.ai=!1,this.$anon_distinct_id=void 0,this.vi(),this.ii=!1}}var aq=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"];class aB{constructor(e,t){var i;this.C=e,this.props={},this.mi=!1,this.yi=(i="",e.token&&(i=e.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),e.persistence_name?"ph_"+e.persistence_name:"ph_"+i+"_posthog"),this.Y=this.bi(e),this.load(),e.debug&&iK.info("Persistence loaded",e.persistence,tJ({},this.props)),this.update_config(e,e,t),this.save()}isDisabled(){return!!this.wi}bi(e){-1===aq.indexOf(e.persistence.toLowerCase())&&(iK.critical("Unknown persistence type "+e.persistence+"; falling back to localStorage+cookie"),e.persistence="localStorage+cookie");var t=e.persistence.toLowerCase();return"localstorage"===t&&s_.H()?s_:"localstorage+cookie"===t&&sS.H()?sS:"sessionstorage"===t&&sE.H()?sE:"memory"===t?sC:"cookie"===t?sy:sS.H()?sS:sy}properties(){var e={};return i0(this.props,function(t,i){if(i===ng&&ie(t))for(var n,s=Object.keys(t),r=0;r<s.length;r++)e["$feature/"+s[r]]=t[s[r]];else n=!1,(ia(nR)?n:tF&&nR.indexOf===tF?-1!=nR.indexOf(i):(i0(nR,function(e){if(n||(n=e===i))return iZ}),n))||(e[i]=t)}),e}load(){if(!this.wi){var e=this.Y.W(this.yi);e&&(this.props=i1({},e))}}save(){this.wi||this.Y.G(this.yi,this.props,this.xi,this.Si,this.Ei,this.C.debug)}remove(){this.Y.V(this.yi,!1),this.Y.V(this.yi,!0)}clear(){this.remove(),this.props={}}register_once(e,t,i){if(ie(e)){ii(t)&&(t="None"),this.xi=ii(i)?this.$i:i;var n=!1;if(i0(e,(e,i)=>{this.props.hasOwnProperty(i)&&this.props[i]!==t||(this.props[i]=e,n=!0)}),n)return this.save(),!0}return!1}register(e,t){if(ie(e)){this.xi=ii(t)?this.$i:t;var i=!1;if(i0(e,(t,n)=>{e.hasOwnProperty(n)&&this.props[n]!==t&&(this.props[n]=t,i=!0)}),i)return this.save(),!0}return!1}unregister(e){e in this.props&&(delete this.props[e],this.save())}update_campaign_params(){if(!this.mi){var e=r$(this.C.custom_campaign_params,this.C.mask_personal_data_properties,this.C.custom_personal_data_properties);it(i6(e))||this.register(e),this.mi=!0}}update_search_keyword(){var e;this.register((e=null==tV?void 0:tV.referrer)?rO(e):{})}update_referrer_info(){var e;this.register_once({$referrer:rq(),$referring_domain:null!=tV&&tV.referrer&&(null==(e=n9(tV.referrer))?void 0:e.host)||"$direct"},void 0)}set_initial_person_info(){this.props[nk]||this.props[nE]||this.register_once({[nN]:rB(this.C.mask_personal_data_properties,this.C.custom_personal_data_properties)},void 0)}get_initial_props(){var e={};i0([nE,nk],t=>{var i=this.props[t];i&&i0(i,function(t,i){e["$initial_"+t3(i)]=t})});var t,i,n=this.props[nN];return n&&i1(e,(t=rj(n),i={},i0(t,function(e,t){i["$initial_"+t3(t)]=e}),i)),e}safe_merge(e){return i0(this.props,function(t,i){i in e||(e[i]=t)}),e}update_config(e,t,i){if(this.$i=this.xi=e.cookie_expiration,this.set_disabled(e.disable_persistence||!!i),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie),e.persistence!==t.persistence){var n=this.bi(e),s=this.props;this.clear(),this.Y=n,this.props=s,this.save()}}set_disabled(e){this.wi=e,this.wi?this.remove():this.save()}set_cross_subdomain(e){e!==this.Si&&(this.Si=e,this.remove(),this.save())}set_secure(e){e!==this.Ei&&(this.Ei=e,this.remove(),this.save())}set_event_timer(e,t){var i=this.props[ni]||{};i[e]=t,this.props[ni]=i,this.save()}remove_event_timer(e){var t=(this.props[ni]||{})[e];return ii(t)||(delete this.props[ni][e],this.save()),t}get_property(e){return this.props[e]}set_property(e,t){this.props[e]=t,this.save()}}(oI={}).Button="button",oI.Tab="tab",oI.Selector="selector",(oT={}).TopLeft="top_left",oT.TopRight="top_right",oT.TopCenter="top_center",oT.MiddleLeft="middle_left",oT.MiddleRight="middle_right",oT.MiddleCenter="middle_center",oT.Left="left",oT.Center="center",oT.Right="right",oT.NextToTrigger="next_to_trigger";var aj=((oA={}).Popover="popover",oA.API="api",oA.Widget="widget",oA.ExternalSurvey="external_survey",oA),aH=((oD={}).Open="open",oD.MultipleChoice="multiple_choice",oD.SingleChoice="single_choice",oD.Rating="rating",oD.Link="link",(oz={}).NextQuestion="next_question",oz.End="end",oz.ResponseBased="response_based",oz.SpecificQuestion="specific_question",(o$={}).Once="once",o$.Recurring="recurring",o$.Always="always",(oF={}).SHOWN="survey shown",oF.DISMISSED="survey dismissed",oF.SENT="survey sent",oF),aU=((oO={}).SURVEY_ID="$survey_id",oO.SURVEY_NAME="$survey_name",oO.SURVEY_RESPONSE="$survey_response",oO.SURVEY_ITERATION="$survey_iteration",oO.SURVEY_ITERATION_START_DATE="$survey_iteration_start_date",oO.SURVEY_PARTIALLY_COMPLETED="$survey_partially_completed",oO.SURVEY_SUBMISSION_ID="$survey_submission_id",oO.SURVEY_QUESTIONS="$survey_questions",oO.SURVEY_COMPLETED="$survey_completed",oO),aG=((oV={}).Popover="popover",oV.Inline="inline",oV);class aW{constructor(){this.ki={},this.ki={}}on(e,t){return this.ki[e]||(this.ki[e]=[]),this.ki[e].push(t),()=>{this.ki[e]=this.ki[e].filter(e=>e!==t)}}emit(e,t){for(var i of this.ki[e]||[])i(t);for(var n of this.ki["*"]||[])n(e,t)}}class aK{constructor(e){this.Pi=new aW,this.Ti=(e,t)=>this.Ri(e,t)&&this.Ii(e,t)&&this.Ci(e,t),this.Ri=(e,t)=>null==t||!t.event||(null==e?void 0:e.event)===(null==t?void 0:t.event),this._instance=e,this.Oi=new Set,this.Fi=new Set}init(){var e,t;ii(null==(e=this._instance)?void 0:e.Mi)||null==(t=this._instance)||t.Mi((e,t)=>{this.on(e,t)})}register(e){var t,i;if(!ii(null==(t=this._instance)?void 0:t.Mi)&&(e.forEach(e=>{var t,i;null==(t=this.Fi)||t.add(e),null==(i=e.steps)||i.forEach(e=>{var t;null==(t=this.Oi)||t.add((null==e?void 0:e.event)||"")})}),null!=(i=this._instance)&&i.autocapture)){var n,s=new Set;e.forEach(e=>{var t;null==(t=e.steps)||t.forEach(e=>{null!=e&&e.selector&&s.add(null==e?void 0:e.selector)})}),null==(n=this._instance)||n.autocapture.setElementSelectors(s)}}on(e,t){var i;null!=t&&0!=e.length&&(this.Oi.has(e)||this.Oi.has(null==t?void 0:t.event))&&this.Fi&&(null==(i=this.Fi)?void 0:i.size)>0&&this.Fi.forEach(e=>{this.Ai(t,e)&&this.Pi.emit("actionCaptured",e.name)})}Di(e){this.onAction("actionCaptured",t=>e(t))}Ai(e,t){if(null==(null==t?void 0:t.steps))return!1;for(var i of t.steps)if(this.Ti(e,i))return!0;return!1}onAction(e,t){return this.Pi.on(e,t)}Ii(e,t){if(null!=t&&t.url){var i,n=null==e||null==(i=e.properties)?void 0:i.$current_url;if(!n||"string"!=typeof n||!aK.ji(n,null==t?void 0:t.url,(null==t?void 0:t.url_matching)||"contains"))return!1}return!0}static ji(e,t,i){switch(i){case"regex":return!!tA&&aE(e,t);case"exact":return t===e;case"contains":return aE(e,aK.Li(t).replace(/_/g,".").replace(/%/g,".*"));default:return!1}}static Li(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}Ci(e,t){if((null!=t&&t.href||null!=t&&t.tag_name||null!=t&&t.text)&&!this.Ni(e).some(e=>!(null!=t&&t.href&&!aK.ji(e.href||"",null==t?void 0:t.href,(null==t?void 0:t.href_matching)||"exact"))&&(null==t||!t.tag_name||e.tag_name===(null==t?void 0:t.tag_name))&&!(null!=t&&t.text&&!aK.ji(e.text||"",null==t?void 0:t.text,(null==t?void 0:t.text_matching)||"exact")&&!aK.ji(e.$el_text||"",null==t?void 0:t.text,(null==t?void 0:t.text_matching)||"exact"))))return!1;if(null!=t&&t.selector){var i,n=null==e||null==(i=e.properties)?void 0:i.$element_selectors;if(!n||!n.includes(null==t?void 0:t.selector))return!1}return!0}Ni(e){return null==(null==e?void 0:e.properties.$elements)?[]:null==e?void 0:e.properties.$elements}}var aY=iY("[Surveys]"),aJ="seenSurvey_",aX=e=>{var t=""+aJ+e.id;return e.current_iteration&&e.current_iteration>0&&(t=""+aJ+e.id+"_"+e.current_iteration),t},aZ=[aj.Popover,aj.Widget,aj.API],aQ={ignoreConditions:!1,ignoreDelay:!1,displayType:aG.Popover};class a0{constructor(e){this._instance=e,this.Ui=new Map,this.zi=new Map}register(e){var t;ii(null==(t=this._instance)?void 0:t.Mi)||(this.Hi(e),this.Bi(e))}Bi(e){var t=e.filter(e=>{var t,i;return(null==(t=e.conditions)?void 0:t.actions)&&(null==(i=e.conditions)||null==(i=i.actions)||null==(i=i.values)?void 0:i.length)>0});0!==t.length&&(null==this.qi&&(this.qi=new aK(this._instance),this.qi.init(),this.qi.Di(e=>{this.onAction(e)})),t.forEach(e=>{var t,i,n,s,r;e.conditions&&null!=(t=e.conditions)&&t.actions&&null!=(i=e.conditions)&&null!=(i=i.actions)&&i.values&&(null==(n=e.conditions)||null==(n=n.actions)||null==(n=n.values)?void 0:n.length)>0&&(null==(s=this.qi)||s.register(e.conditions.actions.values),null==(r=e.conditions)||null==(r=r.actions)||null==(r=r.values)||r.forEach(t=>{if(t&&t.name){var i=this.zi.get(t.name);i&&i.push(e.id),this.zi.set(t.name,i||[e.id])}}))}))}Hi(e){var t;0!==e.filter(e=>{var t,i;return(null==(t=e.conditions)?void 0:t.events)&&(null==(i=e.conditions)||null==(i=i.events)||null==(i=i.values)?void 0:i.length)>0}).length&&(null==(t=this._instance)||t.Mi((e,t)=>{this.onEvent(e,t)}),e.forEach(e=>{var t;null==(t=e.conditions)||null==(t=t.events)||null==(t=t.values)||t.forEach(t=>{if(t&&t.name){var i=this.Ui.get(t.name);i&&i.push(e.id),this.Ui.set(t.name,i||[e.id])}})}))}onEvent(e,t){var i,n,s=(null==(i=this._instance)||null==(i=i.persistence)?void 0:i.props[n_])||[];if(aH.SHOWN===e&&t&&s.length>0){aY.info("survey event matched, removing survey from activated surveys",{event:e,eventPayload:t,existingActivatedSurveys:s});var r,a=null==t||null==(r=t.properties)?void 0:r.$survey_id;if(a){var o=s.indexOf(a);o>=0&&(s.splice(o,1),this.Wi(s))}}else if(this.Ui.has(e)){aY.info("survey event name matched",{event:e,eventPayload:t,surveys:this.Ui.get(e)});var l=[];null==(n=this._instance)||n.getSurveys(t=>{l=t.filter(t=>{var i;return null==(i=this.Ui.get(e))?void 0:i.includes(t.id)})});var c=l.filter(i=>{var n,s=null==(n=i.conditions)||null==(n=n.events)||null==(n=n.values)?void 0:n.find(t=>t.name===e);return!!s&&(!s.propertyFilters||Object.entries(s.propertyFilters).every(e=>{var i,[n,s]=e,r=null==t||null==(i=t.properties)?void 0:i[n];if(ii(r)||ia(r))return!1;var a=[String(r)],o=aP[s.operator];return o?o(s.values,a):(aY.warn("Unknown property comparison operator: "+s.operator),!1)}))});this.Wi(s.concat(c.map(e=>e.id)||[]))}}onAction(e){var t,i=(null==(t=this._instance)||null==(t=t.persistence)?void 0:t.props[n_])||[];this.zi.has(e)&&this.Wi(i.concat(this.zi.get(e)||[]))}Wi(e){var t;aY.info("updating activated surveys",{activatedSurveys:e}),null==(t=this._instance)||null==(t=t.persistence)||t.register({[n_]:[...new Set(e)]})}getSurveys(){var e;return(null==(e=this._instance)||null==(e=e.persistence)?void 0:e.props[n_])||[]}getEventToSurveys(){return this.Ui}Gi(){return this.qi}}class a1{constructor(e){this.Vi=void 0,this._surveyManager=null,this.Ji=!1,this.Ki=!1,this.Yi=[],this._instance=e,this._surveyEventReceiver=null}onRemoteConfig(e){if(!this._instance.config.disable_surveys){var t=e.surveys;if(io(t))return aY.warn("Flags not loaded yet. Not loading surveys.");var i=t7(t);this.Vi=i?t.length>0:t,aY.info("flags response received, isSurveysEnabled: "+this.Vi),this.loadIfEnabled()}}reset(){localStorage.removeItem("lastSeenSurveyDate");for(var e=[],t=0;t<localStorage.length;t++){var i=localStorage.key(t);(null!=i&&i.startsWith(aJ)||null!=i&&i.startsWith("inProgressSurvey_"))&&e.push(i)}e.forEach(e=>localStorage.removeItem(e))}loadIfEnabled(){if(!this._surveyManager)if(this.Ki)aY.info("Already initializing surveys, skipping...");else if(this._instance.config.disable_surveys)aY.info("Disabled. Not loading surveys.");else if(this._instance.config.cookieless_mode&&this._instance.consent.isOptedOut())aY.info("Not loading surveys in cookieless mode without consent.");else{var e=null==tG?void 0:tG.__PosthogExtensions__;if(e){if(!ii(this.Vi)||this._instance.config.advanced_enable_surveys){var t=this.Vi||this._instance.config.advanced_enable_surveys;this.Ki=!0;try{var i=e.generateSurveys;if(i)return void this.Xi(i,t);var n=e.loadExternalDependency;if(!n)return void this.Qi("PostHog loadExternalDependency extension not found.");n(this._instance,"surveys",i=>{i||!e.generateSurveys?this.Qi("Could not load surveys script",i):this.Xi(e.generateSurveys,t)})}catch(e){throw this.Qi("Error initializing surveys",e),e}finally{this.Ki=!1}}}else aY.error("PostHog Extensions not found.")}}Xi(e,t){this._surveyManager=e(this._instance,t),this._surveyEventReceiver=new a0(this._instance),aY.info("Surveys loaded successfully"),this.Zi({isLoaded:!0})}Qi(e,t){aY.error(e,t),this.Zi({isLoaded:!1,error:e})}onSurveysLoaded(e){return this.Yi.push(e),this._surveyManager&&this.Zi({isLoaded:!0}),()=>{this.Yi=this.Yi.filter(t=>t!==e)}}getSurveys(e,t){if(void 0===t&&(t=!1),this._instance.config.disable_surveys)return aY.info("Disabled. Not loading surveys."),e([]);var i=this._instance.get_property(nb);if(i&&!t)return e(i,{isLoaded:!0});if(this.Ji)return e([],{isLoaded:!1,error:"Surveys are already being loaded"});try{this.Ji=!0,this._instance.ci({url:this._instance.requestRouter.endpointFor("api","/api/surveys/?token="+this._instance.config.token),method:"GET",timeout:this._instance.config.surveys_request_timeout_ms,callback:t=>{this.Ji=!1;var i=t.statusCode;if(200!==i||!t.json){var n="Surveys API could not be loaded, status: "+i;return aY.error(n),e([],{isLoaded:!1,error:n})}var s,r,a=t.json.surveys||[],o=a.filter(e=>{var t,i;return!(!e.start_date||e.end_date)&&(!(null==(t=e.conditions)||null==(t=t.events)||null==(t=t.values)||!t.length)||!(null==(i=e.conditions)||null==(i=i.actions)||null==(i=i.values)||!i.length))});return o.length>0&&(null==(r=this._surveyEventReceiver)||r.register(o)),null==(s=this._instance.persistence)||s.register({[nb]:a}),e(a,{isLoaded:!0})}})}catch(e){throw this.Ji=!1,e}}Zi(e){for(var t of this.Yi)try{if(!e.isLoaded)return t([],e);this.getSurveys(t)}catch(e){aY.error("Error in survey callback",e)}}getActiveMatchingSurveys(e,t){if(void 0===t&&(t=!1),!io(this._surveyManager))return this._surveyManager.getActiveMatchingSurveys(e,t);aY.warn("init was not called")}te(e){var t=null;return this.getSurveys(i=>{var n;t=null!=(n=i.find(t=>t.id===e))?n:null}),t}ie(e){if(io(this._surveyManager))return{eligible:!1,reason:"SDK is not enabled or survey functionality is not yet loaded"};var t="string"==typeof e?this.te(e):e;return t?this._surveyManager.checkSurveyEligibility(t):{eligible:!1,reason:"Survey not found"}}canRenderSurvey(e){if(io(this._surveyManager))return aY.warn("init was not called"),{visible:!1,disabledReason:"SDK is not enabled or survey functionality is not yet loaded"};var t=this.ie(e);return{visible:t.eligible,disabledReason:t.reason}}canRenderSurveyAsync(e,t){return io(this._surveyManager)?(aY.warn("init was not called"),Promise.resolve({visible:!1,disabledReason:"SDK is not enabled or survey functionality is not yet loaded"})):new Promise(i=>{this.getSurveys(t=>{var n,s=null!=(n=t.find(t=>t.id===e))?n:null;if(s){var r=this.ie(s);i({visible:r.eligible,disabledReason:r.reason})}else i({visible:!1,disabledReason:"Survey not found"})},t)})}renderSurvey(e,t){var i;if(io(this._surveyManager))aY.warn("init was not called");else{var n="string"==typeof e?this.te(e):e;if(null!=n&&n.id)if(aZ.includes(n.type)){var s=null==tV?void 0:tV.querySelector(t);if(s)return null!=(i=n.appearance)&&i.surveyPopupDelaySeconds?(aY.info("Rendering survey "+n.id+" with delay of "+n.appearance.surveyPopupDelaySeconds+" seconds"),void setTimeout(()=>{var e,t;aY.info("Rendering survey "+n.id+" with delay of "+(null==(e=n.appearance)?void 0:e.surveyPopupDelaySeconds)+" seconds"),null==(t=this._surveyManager)||t.renderSurvey(n,s),aY.info("Survey "+n.id+" rendered")},1e3*n.appearance.surveyPopupDelaySeconds)):void this._surveyManager.renderSurvey(n,s);aY.warn("Survey element not found")}else aY.warn("Surveys of type "+n.type+" cannot be rendered in the app");else aY.warn("Survey not found")}}displaySurvey(e,t){var i;if(io(this._surveyManager))aY.warn("init was not called");else{var n=this.te(e);if(n){var s=n;if(null!=(i=n.appearance)&&i.surveyPopupDelaySeconds&&t.ignoreDelay&&(s=tJ({},n,{appearance:tJ({},n.appearance,{surveyPopupDelaySeconds:0})})),!1===t.ignoreConditions){var r=this.canRenderSurvey(n);if(!r.visible)return void aY.warn("Survey is not eligible to be displayed: ",r.disabledReason)}t.displayType!==aG.Inline?this._surveyManager.handlePopoverSurvey(s):this.renderSurvey(s,t.selector)}else aY.warn("Survey not found")}}}var a2=iY("[RateLimiter]");class a3{constructor(e){var t,i;this.serverLimits={},this.lastEventRateLimited=!1,this.checkForLimiting=e=>{var t=e.text;if(t&&t.length)try{(JSON.parse(t).quota_limited||[]).forEach(e=>{a2.info((e||"events")+" is quota limited."),this.serverLimits[e]=(new Date).getTime()+6e4})}catch(e){return void a2.warn('could not rate limit - continuing. Error: "'+(null==e?void 0:e.message)+'"',{text:t})}},this.instance=e,this.captureEventsPerSecond=(null==(t=e.config.rate_limiting)?void 0:t.events_per_second)||10,this.captureEventsBurstLimit=Math.max((null==(i=e.config.rate_limiting)?void 0:i.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond),this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}clientRateLimitContext(e){void 0===e&&(e=!1);var t,i,n,s=(new Date).getTime(),r=null!=(t=null==(i=this.instance.persistence)?void 0:i.get_property(nC))?t:{tokens:this.captureEventsBurstLimit,last:s};r.tokens+=(s-r.last)/1e3*this.captureEventsPerSecond,r.last=s,r.tokens>this.captureEventsBurstLimit&&(r.tokens=this.captureEventsBurstLimit);var a=r.tokens<1;return a||e||(r.tokens=Math.max(0,r.tokens-1)),!a||this.lastEventRateLimited||e||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to "+this.captureEventsPerSecond+" events per second and "+this.captureEventsBurstLimit+" events burst limit."},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=a,null==(n=this.instance.persistence)||n.set_property(nC,r),{isRateLimited:a,remainingTokens:r.tokens}}isServerRateLimited(e){var t=this.serverLimits[e||"events"]||!1;return!1!==t&&(new Date).getTime()<t}}var a5=iY("[RemoteConfig]");class a4{constructor(e){this._instance=e}get remoteConfig(){var e;return null==(e=tG._POSTHOG_REMOTE_CONFIG)||null==(e=e[this._instance.config.token])?void 0:e.config}ee(e){var t,i;null!=(t=tG.__PosthogExtensions__)&&t.loadExternalDependency?null==(i=tG.__PosthogExtensions__)||null==i.loadExternalDependency||i.loadExternalDependency(this._instance,"remote-config",()=>e(this.remoteConfig)):(a5.error("PostHog Extensions not found. Cannot load remote config."),e())}re(e){this._instance.ci({method:"GET",url:this._instance.requestRouter.endpointFor("assets","/array/"+this._instance.config.token+"/config"),callback:t=>{e(t.json)}})}load(){try{if(this.remoteConfig)return a5.info("Using preloaded remote config",this.remoteConfig),void this.fi(this.remoteConfig);if(this._instance.M())return void a5.warn("Remote config is disabled. Falling back to local config.");this.ee(e=>{if(!e)return a5.info("No config found after loading remote JS config. Falling back to JSON."),void this.re(e=>{this.fi(e)});this.fi(e)})}catch(e){a5.error("Error loading remote config",e)}}fi(e){e?this._instance.config.__preview_remote_config?(this._instance.fi(e),!1!==e.hasFeatureFlags&&this._instance.featureFlags.ensureFlagsLoaded()):a5.info("__preview_remote_config is disabled. Logging config instead",e):a5.error("Failed to fetch remote config from PostHog.")}}class a6{constructor(e,t){this.se=!0,this.ne=[],this.oe=iy((null==t?void 0:t.flush_interval_ms)||3e3,250,5e3,iK.createLogger("flush interval"),3e3),this.ae=e}enqueue(e){this.ne.push(e),this.le||this.ue()}unload(){this.he();var e=Object.values(this.ne.length>0?this.de():{});[...e.filter(e=>0===e.url.indexOf("/e")),...e.filter(e=>0!==e.url.indexOf("/e"))].map(e=>{this.ae(tJ({},e,{transport:"sendBeacon"}))})}enable(){this.se=!1,this.ue()}ue(){var e=this;this.se||(this.le=setTimeout(()=>{if(this.he(),this.ne.length>0){var t=this.de();for(var i in t)!function(){var n=t[i],s=(new Date).getTime();n.data&&t7(n.data)&&i0(n.data,e=>{e.offset=Math.abs(e.timestamp-s),delete e.timestamp}),e.ae(n)}()}},this.oe))}he(){clearTimeout(this.le),this.le=void 0}de(){var e={};return i0(this.ne,t=>{var i,n=(t?t.batchKey:null)||t.url;ii(e[n])&&(e[n]=tJ({},t,{data:[]})),null==(i=e[n].data)||i.push(t.data)}),this.ne=[],e}}var a8=["retriesPerformedSoFar"];class a7{constructor(e){this.ve=!1,this.ce=3e3,this.ne=[],this._instance=e,this.ne=[],this.fe=!0,!ii(tA)&&"onLine"in tA.navigator&&(this.fe=tA.navigator.onLine,this.pe=()=>{this.fe=!0,this.Dt()},this.ge=()=>{this.fe=!1},i9(tA,"online",this.pe),i9(tA,"offline",this.ge))}get length(){return this.ne.length}retriableRequest(e){var{retriesPerformedSoFar:t}=e,i=tX(e,a8);il(t)&&t>0&&(i.url=aS(i.url,{retry_count:t})),this._instance.ci(tJ({},i,{callback:e=>{200!==e.statusCode&&(e.statusCode<400||e.statusCode>=500)&&(null!=t?t:0)<10?this._e(tJ({retriesPerformedSoFar:t},i)):null==i.callback||i.callback(e)}}))}_e(e){var t,i,n,s=e.retriesPerformedSoFar||0;e.retriesPerformedSoFar=s+1;var r=(n=(Math.random()-.5)*((i=Math.min(18e5,t=3e3*Math.pow(2,s)))-t/2),Math.ceil(i+n)),a=Date.now()+r;this.ne.push({retryAt:a,requestOptions:e});var o="Enqueued failed request for retry in "+r;navigator.onLine||(o+=" (Browser is offline)"),iK.warn(o),this.ve||(this.ve=!0,this.me())}me(){if(this.ye&&clearTimeout(this.ye),0===this.ne.length)return this.ve=!1,void(this.ye=void 0);this.ye=setTimeout(()=>{this.fe&&this.ne.length>0&&this.Dt(),this.me()},this.ce)}Dt(){var e=Date.now(),t=[],i=this.ne.filter(i=>i.retryAt<e||(t.push(i),!1));if(this.ne=t,i.length>0)for(var{requestOptions:n}of i)this.retriableRequest(n)}unload(){for(var{requestOptions:e}of(this.ye&&(clearTimeout(this.ye),this.ye=void 0),this.ve=!1,ii(tA)||(this.pe&&(tA.removeEventListener("online",this.pe),this.pe=void 0),this.ge&&(tA.removeEventListener("offline",this.ge),this.ge=void 0)),this.ne))try{this._instance.ci(tJ({},e,{transport:"sendBeacon"}))}catch(e){iK.error(e)}this.ne=[]}}class a9{constructor(e){this.be=()=>{this.we||(this.we={});var e,t,i,n,s=this.scrollElement(),r=this.scrollY(),a=s?Math.max(0,s.scrollHeight-s.clientHeight):0,o=r+((null==s?void 0:s.clientHeight)||0),l=(null==s?void 0:s.scrollHeight)||0;this.we.lastScrollY=Math.ceil(r),this.we.maxScrollY=Math.max(r,null!=(e=this.we.maxScrollY)?e:0),this.we.maxScrollHeight=Math.max(a,null!=(t=this.we.maxScrollHeight)?t:0),this.we.lastContentY=o,this.we.maxContentY=Math.max(o,null!=(i=this.we.maxContentY)?i:0),this.we.maxContentHeight=Math.max(l,null!=(n=this.we.maxContentHeight)?n:0)},this._instance=e}getContext(){return this.we}resetContext(){var e=this.we;return setTimeout(this.be,0),e}startMeasuringScrollPosition(){i9(tA,"scroll",this.be,{capture:!0}),i9(tA,"scrollend",this.be,{capture:!0}),i9(tA,"resize",this.be)}scrollElement(){if(!this._instance.config.scroll_root_selector)return null==tA?void 0:tA.document.documentElement;for(var e of t7(this._instance.config.scroll_root_selector)?this._instance.config.scroll_root_selector:[this._instance.config.scroll_root_selector]){var t=null==tA?void 0:tA.document.querySelector(e);if(t)return t}}scrollY(){if(this._instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollTop||0}return tA&&(tA.scrollY||tA.pageYOffset||tA.document.documentElement.scrollTop)||0}scrollX(){if(this._instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollLeft||0}return tA&&(tA.scrollX||tA.pageXOffset||tA.document.documentElement.scrollLeft)||0}}var oe=e=>rB(null==e?void 0:e.config.mask_personal_data_properties,null==e?void 0:e.config.custom_personal_data_properties);class ot{constructor(e,t,i,n){this.xe=e=>{var t=this.Se();if(!t||t.sessionId!==e){var i={sessionId:e,props:this.Ee(this._instance)};this.$e.register({[nx]:i})}},this._instance=e,this.ke=t,this.$e=i,this.Ee=n||oe,this.ke.onSessionId(this.xe)}Se(){return this.$e.props[nx]}getSetOnceProps(){var e,t=null==(e=this.Se())?void 0:e.props;return t?"r"in t?rj(t):{$referring_domain:t.referringDomain,$pathname:t.initialPathName,utm_source:t.utm_source,utm_campaign:t.utm_campaign,utm_medium:t.utm_medium,utm_content:t.utm_content,utm_term:t.utm_term}:{}}getSessionProps(){var e={};return i0(i6(this.getSetOnceProps()),(t,i)=>{"$current_url"===i&&(i="url"),e["$session_entry_"+t3(i)]=t}),e}}var oi=iY("[SessionId]");class on{on(e,t){return this.Pe.on(e,t)}constructor(e,t,i){if(this.Te=[],this.Re=void 0,this.Pe=new aW,this.Ie=(e,t)=>Math.abs(e-t)>this.sessionTimeoutMs,!e.persistence)throw Error("SessionIdManager requires a PostHogPersistence instance");if("always"===e.config.cookieless_mode)throw Error('SessionIdManager cannot be used with cookieless_mode="always"');this.C=e.config,this.$e=e.persistence,this.Ce=void 0,this.Oe=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this.Fe=t||sg,this.Me=i||sg;var n,s=this.C.persistence_name||this.C.token,r=this.C.session_idle_timeout_seconds||1800;if(this._sessionTimeoutMs=1e3*iy(r,60,36e3,oi.createLogger("session_idle_timeout_seconds"),1800),e.register({$configured_session_timeout_ms:this._sessionTimeoutMs}),this.Ae(),this.De="ph_"+s+"_window_id",this.je="ph_"+s+"_primary_window_exists",this.Le()){var a=sE.W(this.De),o=sE.W(this.je);a&&!o?this.Ce=a:sE.V(this.De),sE.G(this.je,!0)}if(null!=(n=this.C.bootstrap)&&n.sessionID)try{var l=(e=>{var t=e.replace(/-/g,"");if(32!==t.length)throw Error("Not a valid UUID");if("7"!==t[12])throw Error("Not a UUIDv7");return parseInt(t.substring(0,12),16)})(this.C.bootstrap.sessionID);this.Ne(this.C.bootstrap.sessionID,(new Date).getTime(),l)}catch(e){oi.error("Invalid sessionID in bootstrap",e)}this.Ue()}get sessionTimeoutMs(){return this._sessionTimeoutMs}onSessionId(e){return ii(this.Te)&&(this.Te=[]),this.Te.push(e),this.Oe&&e(this.Oe,this.Ce),()=>{this.Te=this.Te.filter(t=>t!==e)}}Le(){return"memory"!==this.C.persistence&&!this.$e.wi&&sE.H()}ze(e){e!==this.Ce&&(this.Ce=e,this.Le()&&sE.G(this.De,e))}He(){return this.Ce?this.Ce:this.Le()?sE.W(this.De):null}Ne(e,t,i){e===this.Oe&&t===this._sessionActivityTimestamp&&i===this._sessionStartTimestamp||(this._sessionStartTimestamp=i,this._sessionActivityTimestamp=t,this.Oe=e,this.$e.register({[nh]:[t,e,i]}))}Be(){if(this.Oe&&this._sessionActivityTimestamp&&this._sessionStartTimestamp)return[this._sessionActivityTimestamp,this.Oe,this._sessionStartTimestamp];var e=this.$e.props[nh];return t7(e)&&2===e.length&&e.push(e[0]),e||[0,null,0]}resetSessionId(){this.Ne(null,null,null)}destroy(){clearTimeout(this.qe),this.qe=void 0,this.Re&&tA&&(tA.removeEventListener("beforeunload",this.Re,{capture:!1}),this.Re=void 0),this.Te=[]}Ue(){this.Re=()=>{this.Le()&&sE.V(this.je)},i9(tA,"beforeunload",this.Re,{capture:!1})}checkAndGetSessionAndWindowId(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=null),"always"===this.C.cookieless_mode)throw Error('checkAndGetSessionAndWindowId should not be called with cookieless_mode="always"');var i=t||(new Date).getTime(),[n,s,r]=this.Be(),a=this.He(),o=il(r)&&r>0&&Math.abs(i-r)>864e5,l=!1,c=!s,u=!e&&this.Ie(i,n);c||u||o?(s=this.Fe(),a=this.Me(),oi.info("new session ID generated",{sessionId:s,windowId:a,changeReason:{noSessionId:c,activityTimeout:u,sessionPastMaximumLength:o}}),r=i,l=!0):a||(a=this.Me(),l=!0);var d=0===n||!e||o?i:n,h=0===r?(new Date).getTime():r;return this.ze(a),this.Ne(s,d,h),e||this.Ae(),l&&this.Te.forEach(e=>e(s,a,l?{noSessionId:c,activityTimeout:u,sessionPastMaximumLength:o}:void 0)),{sessionId:s,windowId:a,sessionStartTimestamp:h,changeReason:l?{noSessionId:c,activityTimeout:u,sessionPastMaximumLength:o}:void 0,lastActivityTimestamp:n}}Ae(){clearTimeout(this.qe),this.qe=setTimeout(()=>{var[e]=this.Be();if(this.Ie((new Date).getTime(),e)){var t=this.Oe;this.resetSessionId(),this.Pe.emit("forcedIdleReset",{idleSessionId:t})}},1.1*this.sessionTimeoutMs)}}var os=["$set_once","$set"],or=iY("[SiteApps]");class oa{constructor(e){this._instance=e,this.We=[],this.apps={}}get isEnabled(){return!!this._instance.config.opt_in_site_apps}Ge(e,t){if(t){var i=this.globalsForEvent(t);this.We.push(i),this.We.length>1e3&&(this.We=this.We.slice(10))}}get siteAppLoaders(){var e;return null==(e=tG._POSTHOG_REMOTE_CONFIG)||null==(e=e[this._instance.config.token])?void 0:e.siteApps}init(){if(this.isEnabled){var e=this._instance.Mi(this.Ge.bind(this));this.Ve=()=>{e(),this.We=[],this.Ve=void 0}}}globalsForEvent(e){if(!e)throw Error("Event payload is required");var t,i,n,s,r,a,o,l={},c=this._instance.get_property("$groups")||[];for(var[u,d]of Object.entries(this._instance.get_property("$stored_group_properties")||{}))l[u]={id:c[u],type:u,properties:d};var{$set_once:h,$set:p}=e;return{event:tJ({},tX(e,os),{properties:tJ({},e.properties,p?{$set:tJ({},null!=(t=null==(i=e.properties)?void 0:i.$set)?t:{},p)}:{},h?{$set_once:tJ({},null!=(n=null==(s=e.properties)?void 0:s.$set_once)?n:{},h)}:{}),elements_chain:null!=(r=null==(a=e.properties)?void 0:a.$elements_chain)?r:"",distinct_id:null==(o=e.properties)?void 0:o.distinct_id}),person:{properties:this._instance.get_property("$stored_person_properties")},groups:l}}setupSiteApp(e){var t=this.apps[e.id],i=()=>{var i;!t.errored&&this.We.length&&(or.info("Processing "+this.We.length+" events for site app with id "+e.id),this.We.forEach(e=>null==t.processEvent?void 0:t.processEvent(e)),t.processedBuffer=!0),Object.values(this.apps).every(e=>e.processedBuffer||e.errored)&&(null==(i=this.Ve)||i.call(this))},n=!1,s=s=>{t.errored=!s,t.loaded=!0,or.info("Site app with id "+e.id+" "+(s?"loaded":"errored")),n&&i()};try{var{processEvent:r}=e.init({posthog:this._instance,callback:e=>{s(e)}});r&&(t.processEvent=r),n=!0}catch(t){or.error("Error while initializing PostHog app with config id "+e.id,t),s(!1)}if(n&&t.loaded)try{i()}catch(i){or.error("Error while processing buffered events PostHog app with config id "+e.id,i),t.errored=!0}}Je(){var e=this.siteAppLoaders||[];for(var t of e)this.apps[t.id]={id:t.id,loaded:!1,errored:!1,processedBuffer:!1};for(var i of e)this.setupSiteApp(i)}Ke(e){if(0!==Object.keys(this.apps).length){var t=this.globalsForEvent(e);for(var i of Object.values(this.apps))try{null==i.processEvent||i.processEvent(t)}catch(t){or.error("Error while processing event "+e.event+" for site app "+i.id,t)}}}onRemoteConfig(e){var t,i,n,s=this;if(null!=(t=this.siteAppLoaders)&&t.length)return this.isEnabled?(this.Je(),void this._instance.on("eventCaptured",e=>this.Ke(e))):void or.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.');if(null==(i=this.Ve)||i.call(this),null!=(n=e.siteApps)&&n.length)if(this.isEnabled){var r=function(e){var t;tG["__$$ph_site_app_"+e]=s._instance,null==(t=tG.__PosthogExtensions__)||null==t.loadSiteApp||t.loadSiteApp(s._instance,o,t=>{if(t)return or.error("Error while initializing PostHog app with config id "+e,t)})};for(var{id:a,url:o}of e.siteApps)r(a)}else or.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}var oo=function(e,t){if(!e)return!1;var i=e.userAgent;if(i&&tQ(i,t))return!0;try{var n=null==e?void 0:e.userAgentData;if(null!=n&&n.brands&&n.brands.some(e=>tQ(null==e?void 0:e.brand,t)))return!0}catch(e){}return!!e.webdriver},ol=((oq={}).US="us",oq.EU="eu",oq.CUSTOM="custom",oq),oc="i.posthog.com";class ou{constructor(e){this.Ye={},this.instance=e}get apiHost(){var e=this.instance.config.api_host.trim().replace(/\/$/,"");return"https://app.posthog.com"===e?"https://us.i.posthog.com":e}get uiHost(){var e,t=null==(e=this.instance.config.ui_host)?void 0:e.replace(/\/$/,"");return t||(t=this.apiHost.replace("."+oc,".posthog.com")),"https://app.posthog.com"===t?"https://us.posthog.com":t}get region(){return this.Ye[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this.Ye[this.apiHost]=ol.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this.Ye[this.apiHost]=ol.EU:this.Ye[this.apiHost]=ol.CUSTOM),this.Ye[this.apiHost]}endpointFor(e,t){if(void 0===t&&(t=""),t&&(t="/"===t[0]?t:"/"+t),"ui"===e)return this.uiHost+t;if(this.region===ol.CUSTOM)return this.apiHost+t;var i=oc+t;switch(e){case"assets":return"https://"+this.region+"-assets."+i;case"api":return"https://"+this.region+"."+i}}}var od={icontains:(e,t)=>!!tA&&t.href.toLowerCase().indexOf(e.toLowerCase())>-1,not_icontains:(e,t)=>!!tA&&-1===t.href.toLowerCase().indexOf(e.toLowerCase()),regex:(e,t)=>!!tA&&aE(t.href,e),not_regex:(e,t)=>!!tA&&!aE(t.href,e),exact:(e,t)=>t.href===e,is_not:(e,t)=>t.href!==e};class oh{constructor(e){var t=this;this.getWebExperimentsAndEvaluateDisplayLogic=function(e){void 0===e&&(e=!1),t.getWebExperiments(e=>{oh.Xe("retrieved web experiments from the server"),t.Qe=new Map,e.forEach(e=>{if(e.feature_flag_key){t.Qe&&(oh.Xe("setting flag key ",e.feature_flag_key," to web experiment ",e),null==(i=t.Qe)||i.set(e.feature_flag_key,e));var i,n=t._instance.getFeatureFlag(e.feature_flag_key);is(n)&&e.variants[n]&&t.Ze(e.name,n,e.variants[n].transforms)}else if(e.variants)for(var s in e.variants){var r=e.variants[s];oh.tr(r)&&t.Ze(e.name,s,r.transforms)}})},e)},this._instance=e,this._instance.onFeatureFlags(e=>{this.onFeatureFlags(e)})}onFeatureFlags(e){if(this._is_bot())oh.Xe("Refusing to render web experiment since the viewer is a likely bot");else if(!this._instance.config.disable_web_experiments){if(io(this.Qe))return this.Qe=new Map,this.loadIfEnabled(),void this.previewWebExperiment();oh.Xe("applying feature flags",e),e.forEach(e=>{var t;if(this.Qe&&null!=(t=this.Qe)&&t.has(e)){var i,n=this._instance.getFeatureFlag(e),s=null==(i=this.Qe)?void 0:i.get(e);n&&null!=s&&s.variants[n]&&this.Ze(s.name,n,s.variants[n].transforms)}})}}previewWebExperiment(){var e=oh.getWindowLocation();if(null!=e&&e.search){var t=st(null==e?void 0:e.search,"__experiment_id"),i=st(null==e?void 0:e.search,"__experiment_variant");t&&i&&(oh.Xe("previewing web experiments "+t+" && "+i),this.getWebExperiments(e=>{this.ir(parseInt(t),i,e)},!1,!0))}}loadIfEnabled(){this._instance.config.disable_web_experiments||this.getWebExperimentsAndEvaluateDisplayLogic()}getWebExperiments(e,t,i){if(this._instance.config.disable_web_experiments&&!i)return e([]);var n=this._instance.get_property("$web_experiments");if(n&&!t)return e(n);this._instance.ci({url:this._instance.requestRouter.endpointFor("api","/api/web_experiments/?token="+this._instance.config.token),method:"GET",callback:t=>200===t.statusCode&&t.json?e(t.json.experiments||[]):e([])})}ir(e,t,i){var n=i.filter(t=>t.id===e);n&&n.length>0&&(oh.Xe("Previewing web experiment ["+n[0].name+"] with variant ["+t+"]"),this.Ze(n[0].name,t,n[0].variants[t].transforms))}static tr(e){return!io(e.conditions)&&oh.er(e)&&oh.rr(e)}static er(e){if(io(e.conditions)||io(null==(t=e.conditions)?void 0:t.url))return!0;var t,i,n,s,r=oh.getWindowLocation();return!!r&&(null==(i=e.conditions)||!i.url||od[null!=(n=null==(s=e.conditions)?void 0:s.urlMatchType)?n:"icontains"](e.conditions.url,r))}static getWindowLocation(){return null==tA?void 0:tA.location}static rr(e){if(io(e.conditions)||io(null==(i=e.conditions)?void 0:i.utm))return!0;var t=r$();if(t.utm_source){var i,n,s,r,a,o,l,c,u,d=null==(n=e.conditions)||null==(n=n.utm)||!n.utm_campaign||(null==(s=e.conditions)||null==(s=s.utm)?void 0:s.utm_campaign)==t.utm_campaign,h=null==(r=e.conditions)||null==(r=r.utm)||!r.utm_source||(null==(a=e.conditions)||null==(a=a.utm)?void 0:a.utm_source)==t.utm_source,p=null==(o=e.conditions)||null==(o=o.utm)||!o.utm_medium||(null==(l=e.conditions)||null==(l=l.utm)?void 0:l.utm_medium)==t.utm_medium,g=null==(c=e.conditions)||null==(c=c.utm)||!c.utm_term||(null==(u=e.conditions)||null==(u=u.utm)?void 0:u.utm_term)==t.utm_term;return d&&p&&g&&h}return!1}static Xe(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];iK.info("[WebExperiments] "+e,i)}Ze(e,t,i){this._is_bot()?oh.Xe("Refusing to render web experiment since the viewer is a likely bot"):"control"!==t?i.forEach(i=>{if(i.selector){oh.Xe("applying transform of variant "+t+" for experiment "+e+" ",i);var n,s=null==(n=document)?void 0:n.querySelectorAll(i.selector);null==s||s.forEach(e=>{i.html&&(e.innerHTML=i.html),i.css&&e.setAttribute("style",i.css)})}}):oh.Xe("Control variants leave the page unmodified.")}_is_bot(){return tO&&this._instance?oo(tO,this._instance.config.custom_blocked_useragents):void 0}}var op=iY("[PostHog ExternalIntegrations]"),og={intercom:"intercom-integration",crispChat:"crisp-chat-integration"};class of{constructor(e){this._instance=e}it(e,t){var i;null==(i=tG.__PosthogExtensions__)||null==i.loadExternalDependency||i.loadExternalDependency(this._instance,e,e=>{if(e)return op.error("failed to load script",e);t()})}startIfEnabledOrStop(){var e,t=this,i=function(e){var i,n,r;!s||null!=(i=tG.__PosthogExtensions__)&&null!=(i=i.integrations)&&i[e]||t.it(og[e],()=>{var i;null==(i=tG.__PosthogExtensions__)||null==(i=i.integrations)||null==(i=i[e])||i.start(t._instance)}),!s&&null!=(n=tG.__PosthogExtensions__)&&null!=(n=n.integrations)&&n[e]&&(null==(r=tG.__PosthogExtensions__)||null==(r=r.integrations)||null==(r=r[e])||r.stop())};for(var[n,s]of Object.entries(null!=(e=this._instance.config.integrations)?e:{}))i(n)}}var om="[SessionRecording]",ov=iY(om);class oy{get started(){var e;return!(null==(e=this.sr)||!e.isStarted)}get status(){return this.sr?this.sr.status:this.nr&&!this.ar?"disabled":"lazy_loading"}constructor(e){if(this._forceAllowLocalhostNetworkCapture=!1,this.nr=!1,this.lr=void 0,this._instance=e,!this._instance.sessionManager)throw ov.error("started without valid sessionManager"),Error(om+" started without valid sessionManager. This is a bug.");if("always"===this._instance.config.cookieless_mode)throw Error(om+' cannot be used with cookieless_mode="always"')}get ar(){var e,t=!(null==(e=this._instance.get_property(nd))||!e.enabled),i=!this._instance.config.disable_session_recording,n=this._instance.config.disable_session_recording||this._instance.consent.isOptedOut();return tA&&t&&i&&!n}startIfEnabledOrStop(e){var t;if(!this.ar||null==(t=this.sr)||!t.isStarted){var i=!ii(Object.assign)&&!ii(Array.from);this.ar&&i?(this.ur(e),ov.info("starting")):this.stopRecording()}}ur(e){var t,i,n;this.ar&&(null!=tG&&null!=(t=tG.__PosthogExtensions__)&&null!=(t=t.rrweb)&&t.record&&null!=(i=tG.__PosthogExtensions__)&&i.initSessionRecording?this.hr(e):null==(n=tG.__PosthogExtensions__)||null==n.loadExternalDependency||n.loadExternalDependency(this._instance,this.dr,t=>{if(t)return ov.error("could not load recorder",t);this.hr(e)}))}stopRecording(){var e,t;null==(e=this.lr)||e.call(this),this.lr=void 0,null==(t=this.sr)||t.stop()}vr(){var e;null==(e=this._instance.persistence)||e.unregister(np)}cr(e){if(this._instance.persistence){var t,i,n=this._instance.persistence,s=()=>{var t=!1===e.sessionRecording?void 0:e.sessionRecording,i=null==t?void 0:t.sampleRate,s=io(i)?null:parseFloat(i);io(s)&&this.vr();var r=null==t?void 0:t.minimumDurationMilliseconds;n.register({[nd]:tJ({enabled:!!t},t,{networkPayloadCapture:tJ({capturePerformance:e.capturePerformance},null==t?void 0:t.networkPayloadCapture),canvasRecording:{enabled:null==t?void 0:t.recordCanvas,fps:null==t?void 0:t.canvasFps,quality:null==t?void 0:t.canvasQuality},sampleRate:s,minimumDurationMilliseconds:ii(r)?null:r,endpoint:null==t?void 0:t.endpoint,triggerMatchType:null==t?void 0:t.triggerMatchType,masking:null==t?void 0:t.masking,urlTriggers:null==t?void 0:t.urlTriggers})})};s(),null==(t=this.lr)||t.call(this),this.lr=null==(i=this._instance.sessionManager)?void 0:i.onSessionId(s)}}onRemoteConfig(e){"sessionRecording"in e?!1!==e.sessionRecording?(this.cr(e),this.nr=!0,this.startIfEnabledOrStop()):this.nr=!0:ov.info("skipping remote config with no sessionRecording",e)}log(e,t){var i;void 0===t&&(t="log"),null!=(i=this.sr)&&i.log?this.sr.log(e,t):ov.warn("log called before recorder was ready")}get dr(){var e,t,i=null==(e=this._instance)||null==(e=e.persistence)?void 0:e.get_property(nd);return(null==i||null==(t=i.scriptConfig)?void 0:t.script)||"lazy-recorder"}hr(e){var t,i;if(null==(t=tG.__PosthogExtensions__)||!t.initSessionRecording)throw Error("Called on script loaded before session recording is available");this.sr||(this.sr=null==(i=tG.__PosthogExtensions__)?void 0:i.initSessionRecording(this._instance),this.sr._forceAllowLocalhostNetworkCapture=this._forceAllowLocalhostNetworkCapture),this.sr.start(e)}onRRwebEmit(e){var t;null==(t=this.sr)||null==t.onRRwebEmit||t.onRRwebEmit(e)}overrideLinkedFlag(){var e;null==(e=this.sr)||e.overrideLinkedFlag()}overrideSampling(){var e;null==(e=this.sr)||e.overrideSampling()}overrideTrigger(e){var t;null==(t=this.sr)||t.overrideTrigger(e)}get sdkDebugProperties(){var e;return(null==(e=this.sr)?void 0:e.sdkDebugProperties)||{$recording_status:this.status}}tryAddCustomEvent(e,t){var i;return!(null==(i=this.sr)||!i.tryAddCustomEvent(e,t))}}var ob={},o_=()=>{},ow="posthog",oS=!a_&&-1===(null==tU?void 0:tU.indexOf("MSIE"))&&-1===(null==tU?void 0:tU.indexOf("Mozilla")),ox=e=>{var t;return{api_host:"https://us.i.posthog.com",ui_host:null,token:"",autocapture:!0,rageclick:!0,cross_subdomain_cookie:function(e){var t=null==e?void 0:e.hostname;if(!is(t))return!1;var i=t.split(".").slice(-2).join(".");for(var n of i8)if(i===n)return!1;return!0}(null==tV?void 0:tV.location),persistence:"localStorage+cookie",persistence_name:"",loaded:o_,save_campaign_params:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageview:"2025-05-24"!==e||"history_change",capture_pageleave:"if_capture_pageview",defaults:null!=e?e:"unset",debug:tq&&is(null==tq?void 0:tq.search)&&-1!==tq.search.indexOf("__posthog_debug=true")||!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_web_experiments:!0,disable_surveys:!1,disable_surveys_automatic_display:!1,disable_external_dependency_loading:!1,enable_recording_console_log:void 0,secure_cookie:"https:"===(null==tA||null==(t=tA.location)?void 0:t.protocol),ip:!1,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",consent_persistence_name:null,opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},request_batching:!0,properties_string_max_length:65535,session_recording:{},mask_all_element_attributes:!1,mask_all_text:!1,mask_personal_data_properties:!1,custom_personal_data_properties:[],advanced_disable_flags:!1,advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_only_evaluate_survey_feature_flags:!1,advanced_enable_surveys:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,surveys_request_timeout_ms:1e4,on_request_error:e=>{var t="Bad HTTP status: "+e.statusCode+" "+e.text;iK.error(t)},get_device_id:e=>e,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"identified_only",before_send:void 0,request_queue_config:{flush_interval_ms:3e3},error_tracking:{},_onCapture:o_,__preview_eager_load_replay:!1}},oC=e=>{var t={};ii(e.process_person)||(t.person_profiles=e.process_person),ii(e.xhr_headers)||(t.request_headers=e.xhr_headers),ii(e.cookie_name)||(t.persistence_name=e.cookie_name),ii(e.disable_cookie)||(t.disable_persistence=e.disable_cookie),ii(e.store_google)||(t.save_campaign_params=e.store_google),ii(e.verbose)||(t.debug=e.verbose);var i=i1({},t,e);return t7(e.property_blacklist)&&(ii(e.property_denylist)?i.property_denylist=e.property_blacklist:t7(e.property_denylist)?i.property_denylist=[...e.property_blacklist,...e.property_denylist]:iK.error("Invalid value for property_denylist config: "+e.property_denylist)),i};class ok{constructor(){this.__forceAllowLocalhost=!1}get pr(){return this.__forceAllowLocalhost}set pr(e){iK.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=e}}class oE{get decideEndpointWasHit(){var e,t;return null!=(e=null==(t=this.featureFlags)?void 0:t.hasLoadedFlags)&&e}get flagsEndpointWasHit(){var e,t;return null!=(e=null==(t=this.featureFlags)?void 0:t.hasLoadedFlags)&&e}constructor(){this.webPerformance=new ok,this.gr=!1,this.version=tW.LIB_VERSION,this._r=new aW,this._calculate_event_properties=this.calculateEventProperties.bind(this),this.config=ox(),this.SentryIntegration=sV,this.sentryIntegration=e=>{var t;return t=sO(this,e),{name:sF,processEvent:e=>t(e)}},this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this.mr=!1,this.yr=null,this.br=null,this.wr=null,this.featureFlags=new aV(this),this.toolbar=new sU(this),this.scrollManager=new a9(this),this.pageViewManager=new rJ(this),this.surveys=new a1(this),this.experiments=new oh(this),this.exceptions=new aR(this),this.rateLimiter=new a3(this),this.requestRouter=new ou(this),this.consent=new sP(this),this.externalIntegrations=new of(this),this.people={set:(e,t,i)=>{var n=is(e)?{[e]:t}:e;this.setPersonProperties(n),null==i||i({})},set_once:(e,t,i)=>{var n=is(e)?{[e]:t}:e;this.setPersonProperties(void 0,n),null==i||i({})}},this.on("eventCaptured",e=>iK.info('send "'+(null==e?void 0:e.event)+'"',e))}init(e,t,i){if(i&&i!==ow){var n,s=null!=(n=ob[i])?n:new oE;return s._init(e,t,i),ob[i]=s,ob[ow][i]=s,s}return this._init(e,t,i)}_init(e,t,i){if(void 0===t&&(t={}),ii(e)||ir(e))return iK.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return console.warn("[PostHog.js]","You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},t.debug=this.Sr(t.debug),this.Er=t,this.$r=[],t.person_profiles&&(this.br=t.person_profiles),this.set_config(i1({},ox(t.defaults),oC(t),{name:i,token:e})),this.config.on_xhr_error&&iK.error("on_xhr_error is deprecated. Use on_request_error instead"),this.compression=t.disable_compression?void 0:n7.GZipJS;var n=this.kr();this.persistence=new aB(this.config,n),this.sessionPersistence="sessionStorage"===this.config.persistence||"memory"===this.config.persistence?this.persistence:new aB(tJ({},this.config,{persistence:"sessionStorage"}),n);var s=tJ({},this.persistence.props),r=tJ({},this.sessionPersistence.props);this.register({$initialization_time:(new Date).toISOString()}),this.Pr=new a6(e=>this.Tr(e),this.config.request_queue_config),this.Rr=new a7(this),this.__request_queue=[];var a="always"===this.config.cookieless_mode||"on_reject"===this.config.cookieless_mode&&this.consent.isExplicitlyOptedOut();if(a||(this.sessionManager=new on(this),this.sessionPropsManager=new ot(this,this.sessionManager,this.persistence)),new sW(this).startIfEnabledOrStop(),this.siteApps=new oa(this),null==(o=this.siteApps)||o.init(),a||(this.sessionRecording=new oy(this),this.sessionRecording.startIfEnabledOrStop()),this.config.disable_scroll_properties||this.scrollManager.startMeasuringScrollPosition(),this.autocapture=new sa(this),this.autocapture.startIfEnabled(),this.surveys.loadIfEnabled(),this.heatmaps=new rY(this),this.heatmaps.startIfEnabled(),this.webVitalsAutocapture=new rG(this),this.exceptionObserver=new sA(this),this.exceptionObserver.startIfEnabled(),this.deadClicksAutocapture=new sI(this,sR),this.deadClicksAutocapture.startIfEnabled(),this.historyAutocapture=new sz(this),this.historyAutocapture.startIfEnabled(),tW.DEBUG=tW.DEBUG||this.config.debug,tW.DEBUG&&iK.info("Starting in debug mode",{this:this,config:t,thisC:tJ({},this.config),p:s,s:r}),void 0!==(null==(l=t.bootstrap)?void 0:l.distinctID)){var o,l,c,u,d=this.config.get_device_id(sg()),h=null!=(c=t.bootstrap)&&c.isIdentifiedID?d:t.bootstrap.distinctID;this.persistence.set_property(nS,null!=(u=t.bootstrap)&&u.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:t.bootstrap.distinctID,$device_id:h})}if(this.Ir()){var p,g,f=Object.keys((null==(p=t.bootstrap)?void 0:p.featureFlags)||{}).filter(e=>{var i;return!(null==(i=t.bootstrap)||null==(i=i.featureFlags)||!i[e])}).reduce((e,i)=>{var n;return e[i]=(null==(n=t.bootstrap)||null==(n=n.featureFlags)?void 0:n[i])||!1,e},{}),m=Object.keys((null==(g=t.bootstrap)?void 0:g.featureFlagPayloads)||{}).filter(e=>f[e]).reduce((e,i)=>{var n,s;return null!=(n=t.bootstrap)&&null!=(n=n.featureFlagPayloads)&&n[i]&&(e[i]=null==(s=t.bootstrap)||null==(s=s.featureFlagPayloads)?void 0:s[i]),e},{});this.featureFlags.receivedFeatureFlags({featureFlags:f,featureFlagPayloads:m})}if(a)this.register_once({distinct_id:nL,$device_id:null},"");else if(!this.get_distinct_id()){var v=this.config.get_device_id(sg());this.register_once({distinct_id:v,$device_id:v},""),this.persistence.set_property(nS,"anonymous")}return i9(tA,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this),{passive:!1}),this.toolbar.maybeLoadToolbar(),t.segment?function(e,t){var i=e.config.segment;if(!i)return t();!function(e,t){var i=e.config.segment;if(!i)return t();var n=i=>{var n=()=>i.anonymousId()||sg();e.config.get_device_id=n,i.id()&&(e.register({distinct_id:i.id(),$device_id:n()}),e.persistence.set_property(nS,"identified")),t()},s=i.user();"then"in s&&t9(s.then)?s.then(e=>n(e)):n(s)}(e,()=>{var n;i.register((Promise&&Promise.resolve||s$.warn("This browser does not have Promise support, and can not use the segment integration"),n=(t,i)=>{if(!i)return t;t.event.userId||t.event.anonymousId===e.get_distinct_id()||(s$.info("No userId set, resetting PostHog"),e.reset()),t.event.userId&&t.event.userId!==e.get_distinct_id()&&(s$.info("UserId set, identifying with PostHog"),e.identify(t.event.userId));var n=e.calculateEventProperties(i,t.event.properties);return t.event.properties=Object.assign({},n,t.event.properties),t},{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:()=>!0,load:()=>Promise.resolve(),track:e=>n(e,e.event.event),page:e=>n(e,"$pageview"),identify:e=>n(e,"$identify"),screen:e=>n(e,"$screen")})).then(()=>{t()})})}(this,()=>this.Cr()):this.Cr(),t9(this.config._onCapture)&&this.config._onCapture!==o_&&(iK.warn("onCapture is deprecated. Please use `before_send` instead"),this.on("eventCaptured",e=>this.config._onCapture(e.event,e))),this.config.ip&&iK.warn('The `ip` config option has NO EFFECT AT ALL and has been deprecated. Use a custom transformation or "Discard IP data" project setting instead. See https://posthog.com/tutorials/web-redact-properties#hiding-customer-ip-address for more information.'),this}fi(e){var t,i,n,s,r,a,o,l;if(!tV||!tV.body)return iK.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout(()=>{this.fi(e)},500);this.compression=void 0,e.supportedCompression&&!this.config.disable_compression&&(this.compression=t1(e.supportedCompression,n7.GZipJS)?n7.GZipJS:t1(e.supportedCompression,n7.Base64)?n7.Base64:void 0),null!=(t=e.analytics)&&t.endpoint&&(this.analyticsDefaultEndpoint=e.analytics.endpoint),this.set_config({person_profiles:this.br?this.br:"identified_only"}),null==(i=this.siteApps)||i.onRemoteConfig(e),null==(n=this.sessionRecording)||n.onRemoteConfig(e),null==(s=this.autocapture)||s.onRemoteConfig(e),null==(r=this.heatmaps)||r.onRemoteConfig(e),this.surveys.onRemoteConfig(e),null==(a=this.webVitalsAutocapture)||a.onRemoteConfig(e),null==(o=this.exceptionObserver)||o.onRemoteConfig(e),this.exceptions.onRemoteConfig(e),null==(l=this.deadClicksAutocapture)||l.onRemoteConfig(e)}Cr(){try{this.config.loaded(this)}catch(e){iK.critical("`loaded` function failed",e)}this.Or(),this.config.capture_pageview&&setTimeout(()=>{(this.consent.isOptedIn()||"always"===this.config.cookieless_mode)&&this.Fr()},1),new a4(this).load(),this.featureFlags.flags()}Or(){var e;this.is_capturing()&&this.config.request_batching&&(null==(e=this.Pr)||e.enable())}_dom_loaded(){this.is_capturing()&&iQ(this.__request_queue,e=>this.Tr(e)),this.__request_queue=[],this.Or()}_handle_unload(){var e,t;this.config.request_batching?(this.Mr()&&this.capture("$pageleave"),null==(e=this.Pr)||e.unload(),null==(t=this.Rr)||t.unload()):this.Mr()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}ci(e){this.__loaded&&(oS?this.__request_queue.push(e):this.rateLimiter.isServerRateLimited(e.batchKey)||(e.transport=e.transport||this.config.api_transport,e.url=aS(e.url,{ip:+!!this.config.ip}),e.headers=tJ({},this.config.request_headers),e.compression="best-available"===e.compression?this.compression:e.compression,e.disableXHRCredentials=this.config.__preview_disable_xhr_credentials,this.config.__preview_disable_beacon&&(e.disableTransport=["sendBeacon"]),e.fetchOptions=e.fetchOptions||this.config.fetch_options,(e=>{var t,i,n,s=tJ({},e);s.timeout=s.timeout||6e4,s.url=aS(s.url,{_:(new Date).getTime().toString(),ver:tW.LIB_VERSION,compression:s.compression});var r=null!=(t=s.transport)?t:"fetch",a=ak.filter(e=>!s.disableTransport||!e.transport||!s.disableTransport.includes(e.transport)),o=null!=(i=null==(n=i7(a,e=>e.transport===r))?void 0:n.method)?i:a[0].method;if(!o)throw Error("No available transport method");o(s)})(tJ({},e,{callback:t=>{var i,n;this.rateLimiter.checkForLimiting(t),t.statusCode>=400&&(null==(i=(n=this.config).on_request_error)||i.call(n,t)),null==e.callback||e.callback(t)}}))))}Tr(e){this.Rr?this.Rr.retriableRequest(e):this.ci(e)}_execute_array(e){var t,i=[],n=[],s=[];iQ(e,e=>{e&&(t7(t=e[0])?s.push(e):t9(e)?e.call(this):t7(e)&&"alias"===t?i.push(e):t7(e)&&-1!==t.indexOf("capture")&&t9(this[t])?s.push(e):n.push(e))});var r=function(e,t){iQ(e,function(e){if(t7(e[0])){var i=t;i0(e,function(e){i=i[e[0]].apply(i,e.slice(1))})}else this[e[0]].apply(this,e.slice(1))},t)};r(i,this),r(n,this),r(s,this)}Ir(){var e,t;return(null==(e=this.config.bootstrap)?void 0:e.featureFlags)&&Object.keys(null==(t=this.config.bootstrap)?void 0:t.featureFlags).length>0||!1}push(e){this._execute_array([e])}capture(e,t,i){var n;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this.Pr){if(this.is_capturing())if(!ii(e)&&is(e)){var s=!this.config.opt_out_useragent_filter&&this._is_bot();if(!(s&&!this.config.__preview_capture_bot_pageviews)){var r=null!=i&&i.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(null==r||!r.isRateLimited){null!=t&&t.$current_url&&!is(null==t?void 0:t.$current_url)&&(iK.error("Invalid `$current_url` property provided to `posthog.capture`. Input must be a string. Ignoring provided value."),null==t||delete t.$current_url),this.sessionPersistence.update_search_keyword(),this.config.save_campaign_params&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.save_campaign_params||this.config.save_referrer)&&this.persistence.set_initial_person_info();var a=new Date,o=(null==i?void 0:i.timestamp)||a,l=sg(),c={uuid:l,event:e,properties:this.calculateEventProperties(e,t||{},o,l)};"$pageview"===e&&this.config.__preview_capture_bot_pageviews&&s&&(c.event="$bot_pageview",c.properties.$browser_type="bot"),r&&(c.properties.$lib_rate_limit_remaining_tokens=r.remainingTokens),(null==i?void 0:i.$set)&&(c.$set=null==i?void 0:i.$set);var u,d=this.Ar(null==i?void 0:i.$set_once);if(d&&(c.$set_once=d),(h=c,p=null!=i&&i._noTruncate?null:this.config.properties_string_max_length,g=e=>is(e)&&!ia(p)?e.slice(0,p):e,f=new Set,c=function e(t,i){var n;return t!==Object(t)?g?g(t,i):t:f.has(t)?void 0:(f.add(t),t7(t)?(n=[],iQ(t,t=>{n.push(e(t))})):(n={},i0(t,(t,i)=>{f.has(t)||(n[i]=e(t,i))})),n)}(h)).timestamp=o,ii(null==i?void 0:i.timestamp)||(c.properties.$event_time_override_provided=!0,c.properties.$event_time_override_system_time=a),e===aH.DISMISSED||e===aH.SENT){var h,p,g,f,m,v,y,b=null==t?void 0:t[aU.SURVEY_ID],_=null==t?void 0:t[aU.SURVEY_ITERATION];u={id:b,current_iteration:_},localStorage.getItem(aX(u))||localStorage.setItem(aX(u),"true"),c.$set=tJ({},c.$set,{[(m={id:b,current_iteration:_},y="$survey_"+(v=e===aH.SENT?"responded":"dismissed")+"/"+m.id,m.current_iteration&&m.current_iteration>0&&(y="$survey_"+v+"/"+m.id+"/"+m.current_iteration),y)]:!0})}var w=tJ({},c.properties.$set,c.$set);if(it(w)||this.setPersonPropertiesForFlags(w),!io(this.config.before_send)){var S=this.Dr(c);if(!S)return;c=S}this._r.emit("eventCaptured",c);var x={method:"POST",url:null!=(n=null==i?void 0:i._url)?n:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:c,compression:"best-available",batchKey:null==i?void 0:i._batchKey};return!this.config.request_batching||i&&(null==i||!i._batchKey)||null!=i&&i.send_instantly?this.Tr(x):this.Pr.enqueue(x),c}iK.critical("This capture call is ignored due to client rate limiting.")}}else iK.error("No event name provided to posthog.capture")}else iK.uninitializedWarning("posthog.capture")}Mi(e){return this.on("eventCaptured",t=>e(t.event,t))}calculateEventProperties(e,t,i,n,s){if(i=i||new Date,!this.persistence||!this.sessionPersistence)return t;var r,a=s?void 0:this.persistence.remove_event_timer(e),o=tJ({},t);if(o.token=this.config.token,o.$config_defaults=this.config.defaults,("always"==this.config.cookieless_mode||"on_reject"==this.config.cookieless_mode&&this.consent.isExplicitlyOptedOut())&&(o.$cookieless_mode=!0),"$snapshot"===e){var l=tJ({},this.persistence.properties(),this.sessionPersistence.properties());return o.distinct_id=l.distinct_id,(!is(o.distinct_id)&&!il(o.distinct_id)||ir(o.distinct_id))&&iK.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),o}var c,u=function(e,t){if(!tU)return{};var i,n,s=e?i2([],rT,t||[]):[],[r,a]=function(e){for(var t=0;t<rL.length;t++){var[i,n]=rL[t],s=i.exec(e),r=s&&(t9(n)?n(s,e):n);if(r)return r}return["",""]}(tU);return i1(i6({$os:r,$os_version:a,$browser:rN(tU,navigator.vendor),$device:rR(tU),$device_type:(n=rR(tU))===sZ||n===sX||"Kobo"===n||"Kindle Fire"===n||n===ry?sJ:n===ro||n===rc||n===rl||n===rf?"Console":n===s0?"Wearable":n?sK:"Desktop",$timezone:rH(),$timezone_offset:function(){try{return(new Date).getTimezoneOffset()}catch(e){return}}()}),{$current_url:si(null==tq?void 0:tq.href,s,rD),$host:null==tq?void 0:tq.host,$pathname:null==tq?void 0:tq.pathname,$raw_user_agent:tU.length>1e3?tU.substring(0,997)+"...":tU,$browser_version:rM(tU,navigator.vendor),$browser_language:rV(),$browser_language_prefix:"string"==typeof(i=rV())?i.split("-")[0]:void 0,$screen_height:null==tA?void 0:tA.screen.height,$screen_width:null==tA?void 0:tA.screen.width,$viewport_height:null==tA?void 0:tA.innerHeight,$viewport_width:null==tA?void 0:tA.innerWidth,$lib:"web",$lib_version:tW.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:Date.now()/1e3})}(this.config.mask_personal_data_properties,this.config.custom_personal_data_properties);if(this.sessionManager){var{sessionId:d,windowId:h}=this.sessionManager.checkAndGetSessionAndWindowId(s,i.getTime());o.$session_id=d,o.$window_id=h}this.sessionPropsManager&&i1(o,this.sessionPropsManager.getSessionProps());try{this.sessionRecording&&i1(o,this.sessionRecording.sdkDebugProperties),o.$sdk_debug_retry_queue_size=null==(r=this.Rr)?void 0:r.length}catch(e){o.$sdk_debug_error_capturing_properties=String(e)}if(this.requestRouter.region===ol.CUSTOM&&(o.$lib_custom_api_host=this.config.api_host),c="$pageview"!==e||s?"$pageleave"!==e||s?this.pageViewManager.doEvent():this.pageViewManager.doPageLeave(i):this.pageViewManager.doPageView(i,n),o=i1(o,c),"$pageview"===e&&tV&&(o.title=tV.title),!ii(a)){var p=i.getTime()-a;o.$duration=parseFloat((p/1e3).toFixed(3))}tU&&this.config.opt_out_useragent_filter&&(o.$browser_type=this._is_bot()?"bot":"browser"),(o=i1({},u,this.persistence.properties(),this.sessionPersistence.properties(),o)).$is_identified=this._isIdentified(),t7(this.config.property_denylist)?i0(this.config.property_denylist,function(e){delete o[e]}):iK.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var g=this.config.sanitize_properties;g&&(iK.error("sanitize_properties is deprecated. Use before_send instead"),o=g(o,e));var f=this.jr();return o.$process_person_profile=f,f&&!s&&this.Lr("_calculate_event_properties"),o}Ar(e){if(!this.persistence||!this.jr()||this.gr)return e;var t,i=i1({},this.persistence.get_initial_props(),(null==(t=this.sessionPropsManager)?void 0:t.getSetOnceProps())||{},e||{}),n=this.config.sanitize_properties;return n&&(iK.error("sanitize_properties is deprecated. Use before_send instead"),i=n(i,"$set_once")),this.gr=!0,it(i)?void 0:i}register(e,t){var i;null==(i=this.persistence)||i.register(e,t)}register_once(e,t,i){var n;null==(n=this.persistence)||n.register_once(e,t,i)}register_for_session(e){var t;null==(t=this.sessionPersistence)||t.register(e)}unregister(e){var t;null==(t=this.persistence)||t.unregister(e)}unregister_for_session(e){var t;null==(t=this.sessionPersistence)||t.unregister(e)}Nr(e,t){this.register({[e]:t})}getFeatureFlag(e,t){return this.featureFlags.getFeatureFlag(e,t)}getFeatureFlagPayload(e){var t=this.featureFlags.getFeatureFlagPayload(e);try{return JSON.parse(t)}catch(e){return t}}isFeatureEnabled(e,t){return this.featureFlags.isFeatureEnabled(e,t)}reloadFeatureFlags(){this.featureFlags.reloadFeatureFlags()}updateEarlyAccessFeatureEnrollment(e,t,i){this.featureFlags.updateEarlyAccessFeatureEnrollment(e,t,i)}getEarlyAccessFeatures(e,t,i){return void 0===t&&(t=!1),this.featureFlags.getEarlyAccessFeatures(e,t,i)}on(e,t){return this._r.on(e,t)}onFeatureFlags(e){return this.featureFlags.onFeatureFlags(e)}onSurveysLoaded(e){return this.surveys.onSurveysLoaded(e)}onSessionId(e){var t,i;return null!=(t=null==(i=this.sessionManager)?void 0:i.onSessionId(e))?t:()=>{}}getSurveys(e,t){void 0===t&&(t=!1),this.surveys.getSurveys(e,t)}getActiveMatchingSurveys(e,t){void 0===t&&(t=!1),this.surveys.getActiveMatchingSurveys(e,t)}renderSurvey(e,t){this.surveys.renderSurvey(e,t)}displaySurvey(e,t){void 0===t&&(t=aQ),this.surveys.displaySurvey(e,t)}canRenderSurvey(e){return this.surveys.canRenderSurvey(e)}canRenderSurveyAsync(e,t){return void 0===t&&(t=!1),this.surveys.canRenderSurveyAsync(e,t)}identify(e,t,i){if(!this.__loaded||!this.persistence)return iK.uninitializedWarning("posthog.identify");if(il(e)&&(e=e.toString(),iK.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),e)if(["distinct_id","distinctid"].includes(e.toLowerCase()))iK.critical('The string "'+e+'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.');else if(e!==nL){if(this.Lr("posthog.identify")){var n=this.get_distinct_id();this.register({$user_id:e}),this.get_property("$device_id")||this.register_once({$had_persisted_distinct_id:!0,$device_id:n},""),e!==n&&e!==this.get_property(nt)&&(this.unregister(nt),this.register({distinct_id:e}));var s="anonymous"===(this.persistence.get_property(nS)||"anonymous");e!==n&&s?(this.persistence.set_property(nS,"identified"),this.setPersonPropertiesForFlags(tJ({},i||{},t||{}),!1),this.capture("$identify",{distinct_id:e,$anon_distinct_id:n},{$set:t||{},$set_once:i||{}}),this.wr=aN(e,t,i),this.featureFlags.setAnonymousDistinctId(n)):(t||i)&&this.setPersonProperties(t,i),e!==n&&(this.reloadFeatureFlags(),this.unregister(nw))}}else iK.critical('The string "'+nL+'" was set in posthog.identify which indicates an error. This ID is only used as a sentinel value.');else iK.error("Unique user id has not been set in posthog.identify")}setPersonProperties(e,t){if((e||t)&&this.Lr("posthog.setPersonProperties")){var i=aN(this.get_distinct_id(),e,t);this.wr!==i?(this.setPersonPropertiesForFlags(tJ({},t||{},e||{})),this.capture("$set",{$set:e||{},$set_once:t||{}}),this.wr=i):iK.info("A duplicate setPersonProperties call was made with the same properties. It has been ignored.")}}group(e,t,i){if(e&&t){if(this.Lr("posthog.group")){var n=this.getGroups();n[e]!==t&&this.resetGroupPropertiesForFlags(e),this.register({$groups:tJ({},n,{[e]:t})}),i&&(this.capture("$groupidentify",{$group_type:e,$group_key:t,$group_set:i}),this.setGroupPropertiesForFlags({[e]:i})),n[e]===t||i||this.reloadFeatureFlags()}}else iK.error("posthog.group requires a group type and group key")}resetGroups(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}setPersonPropertiesForFlags(e,t){void 0===t&&(t=!0),this.featureFlags.setPersonPropertiesForFlags(e,t)}resetPersonPropertiesForFlags(){this.featureFlags.resetPersonPropertiesForFlags()}setGroupPropertiesForFlags(e,t){void 0===t&&(t=!0),this.Lr("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(e,t)}resetGroupPropertiesForFlags(e){this.featureFlags.resetGroupPropertiesForFlags(e)}reset(e){if(iK.info("reset"),!this.__loaded)return iK.uninitializedWarning("posthog.reset");var t,i,n,s,r=this.get_property("$device_id");if(this.consent.reset(),null==(t=this.persistence)||t.clear(),null==(i=this.sessionPersistence)||i.clear(),this.surveys.reset(),this.featureFlags.reset(),null==(n=this.persistence)||n.set_property(nS,"anonymous"),null==(s=this.sessionManager)||s.resetSessionId(),this.wr=null,"always"===this.config.cookieless_mode)this.register_once({distinct_id:nL,$device_id:null},"");else{var a=this.config.get_device_id(sg());this.register_once({distinct_id:a,$device_id:e?a:r},"")}this.register({$last_posthog_reset:(new Date).toISOString()},1)}get_distinct_id(){return this.get_property("distinct_id")}getGroups(){return this.get_property("$groups")||{}}get_session_id(){var e,t;return null!=(e=null==(t=this.sessionManager)?void 0:t.checkAndGetSessionAndWindowId(!0).sessionId)?e:""}get_session_replay_url(e){if(!this.sessionManager)return"";var{sessionId:t,sessionStartTimestamp:i}=this.sessionManager.checkAndGetSessionAndWindowId(!0),n=this.requestRouter.endpointFor("ui","/project/"+this.config.token+"/replay/"+t);if(null!=e&&e.withTimestamp&&i){var s,r=null!=(s=e.timestampLookBack)?s:10;if(!i)return n;n+="?t="+Math.max(Math.floor(((new Date).getTime()-i)/1e3)-r,0)}return n}alias(e,t){return e===this.get_property(ne)?(iK.critical("Attempting to create alias for existing People user - aborting."),-2):this.Lr("posthog.alias")?(ii(t)&&(t=this.get_distinct_id()),e!==t?(this.Nr(nt,e),this.capture("$create_alias",{alias:e,distinct_id:t})):(iK.warn("alias matches current distinct_id - skipping api call."),this.identify(e),-1)):void 0}set_config(e){var t=tJ({},this.config);if(ie(e)){i1(this.config,oC(e));var i,n,s,r,a,o=this.kr();null==(i=this.persistence)||i.update_config(this.config,t,o),this.sessionPersistence="sessionStorage"===this.config.persistence||"memory"===this.config.persistence?this.persistence:new aB(tJ({},this.config,{persistence:"sessionStorage"}),o);var l=this.Sr(this.config.debug);ic(l)&&(this.config.debug=l),ic(this.config.debug)&&(this.config.debug?(tW.DEBUG=!0,s_.H()&&s_.G("ph_debug","true"),iK.info("set_config",{config:e,oldConfig:t,newConfig:tJ({},this.config)})):(tW.DEBUG=!1,s_.H()&&s_.V("ph_debug"))),null==(n=this.sessionRecording)||n.startIfEnabledOrStop(),null==(s=this.autocapture)||s.startIfEnabled(),null==(r=this.heatmaps)||r.startIfEnabled(),this.surveys.loadIfEnabled(),this.Ur(),null==(a=this.externalIntegrations)||a.startIfEnabledOrStop()}}startSessionRecording(e){var t,i,n,s,r,a=!0===e,o={sampling:a||!(null==e||!e.sampling),linked_flag:a||!(null==e||!e.linked_flag),url_trigger:a||!(null==e||!e.url_trigger),event_trigger:a||!(null==e||!e.event_trigger)};Object.values(o).some(Boolean)&&(null==(t=this.sessionManager)||t.checkAndGetSessionAndWindowId(),o.sampling&&(null==(i=this.sessionRecording)||i.overrideSampling()),o.linked_flag&&(null==(n=this.sessionRecording)||n.overrideLinkedFlag()),o.url_trigger&&(null==(s=this.sessionRecording)||s.overrideTrigger("url")),o.event_trigger&&(null==(r=this.sessionRecording)||r.overrideTrigger("event"))),this.set_config({disable_session_recording:!1})}stopSessionRecording(){this.set_config({disable_session_recording:!0})}sessionRecordingStarted(){var e;return!(null==(e=this.sessionRecording)||!e.started)}captureException(e,t){var i=Error("PostHog syntheticException"),n=this.exceptions.buildProperties(e,{handled:!0,syntheticException:i});return this.exceptions.sendExceptionEvent(tJ({},n,t))}loadToolbar(e){return this.toolbar.loadToolbar(e)}get_property(e){var t;return null==(t=this.persistence)?void 0:t.props[e]}getSessionProperty(e){var t;return null==(t=this.sessionPersistence)?void 0:t.props[e]}toString(){var e,t=null!=(e=this.config.name)?e:ow;return t!==ow&&(t=ow+"."+t),t}_isIdentified(){var e,t;return"identified"===(null==(e=this.persistence)?void 0:e.get_property(nS))||"identified"===(null==(t=this.sessionPersistence)?void 0:t.get_property(nS))}jr(){var e,t;return!("never"===this.config.person_profiles||"identified_only"===this.config.person_profiles&&!this._isIdentified()&&it(this.getGroups())&&(null==(e=this.persistence)||null==(e=e.props)||!e[nt])&&(null==(t=this.persistence)||null==(t=t.props)||!t[nP]))}Mr(){return!0===this.config.capture_pageleave||"if_capture_pageview"===this.config.capture_pageleave&&(!0===this.config.capture_pageview||"history_change"===this.config.capture_pageview)}createPersonProfile(){this.jr()||this.Lr("posthog.createPersonProfile")&&this.setPersonProperties({},{})}Lr(e){return"never"===this.config.person_profiles?(iK.error(e+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this.Nr(nP,!0),!0)}kr(){if("always"===this.config.cookieless_mode)return!0;var e=this.consent.isOptedOut(),t=this.config.opt_out_persistence_by_default||"on_reject"===this.config.cookieless_mode;return this.config.disable_persistence||e&&!!t}Ur(){var e,t,i,n,s=this.kr();return(null==(e=this.persistence)?void 0:e.wi)!==s&&(null==(i=this.persistence)||i.set_disabled(s)),(null==(t=this.sessionPersistence)?void 0:t.wi)!==s&&(null==(n=this.sessionPersistence)||n.set_disabled(s)),s}opt_in_capturing(e){if("always"!==this.config.cookieless_mode){var t,i;"on_reject"===this.config.cookieless_mode&&this.consent.isExplicitlyOptedOut()&&(this.reset(!0),null==(t=this.sessionManager)||t.destroy(),this.sessionManager=new on(this),this.persistence&&(this.sessionPropsManager=new ot(this,this.sessionManager,this.persistence)),this.sessionRecording=new oy(this),this.sessionRecording.startIfEnabledOrStop()),this.consent.optInOut(!0),this.Ur(),this.Or(),"on_reject"==this.config.cookieless_mode&&this.surveys.loadIfEnabled(),(ii(null==e?void 0:e.captureEventName)||null!=e&&e.captureEventName)&&this.capture(null!=(i=null==e?void 0:e.captureEventName)?i:"$opt_in",null==e?void 0:e.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this.Fr()}else iK.warn('Consent opt in/out is not valid with cookieless_mode="always" and will be ignored')}opt_out_capturing(){var e,t;"always"!==this.config.cookieless_mode?("on_reject"===this.config.cookieless_mode&&this.consent.isOptedIn()&&this.reset(!0),this.consent.optInOut(!1),this.Ur(),"on_reject"===this.config.cookieless_mode&&(this.register({distinct_id:nL,$device_id:null}),null==(e=this.sessionManager)||e.destroy(),this.sessionManager=void 0,this.sessionPropsManager=void 0,null==(t=this.sessionRecording)||t.stopRecording(),this.sessionRecording=void 0,this.Fr())):iK.warn('Consent opt in/out is not valid with cookieless_mode="always" and will be ignored')}has_opted_in_capturing(){return this.consent.isOptedIn()}has_opted_out_capturing(){return this.consent.isOptedOut()}get_explicit_consent_status(){var e=this.consent.consent;return e===sN.GRANTED?"granted":e===sN.DENIED?"denied":"pending"}is_capturing(){return"always"===this.config.cookieless_mode||("on_reject"===this.config.cookieless_mode?this.consent.isExplicitlyOptedOut()||this.consent.isOptedIn():!this.has_opted_out_capturing())}clear_opt_in_out_capturing(){this.consent.reset(),this.Ur()}_is_bot(){return tO?oo(tO,this.config.custom_blocked_useragents):void 0}Fr(){tV&&("visible"===tV.visibilityState?this.mr||(this.mr=!0,this.capture("$pageview",{title:tV.title},{send_instantly:!0}),this.yr&&(tV.removeEventListener("visibilitychange",this.yr),this.yr=null)):this.yr||(this.yr=this.Fr.bind(this),i9(tV,"visibilitychange",this.yr)))}debug(e){!1===e?(null==tA||tA.console.log("You've disabled debug mode."),this.set_config({debug:!1})):(null==tA||tA.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),this.set_config({debug:!0}))}M(){var e,t,i,n,s=this.Er||{};return"advanced_disable_flags"in s?!!s.advanced_disable_flags:!1!==this.config.advanced_disable_flags?!!this.config.advanced_disable_flags:!0===this.config.advanced_disable_decide?(iK.warn("Config field 'advanced_disable_decide' is deprecated. Please use 'advanced_disable_flags' instead. The old field will be removed in a future major version."),!0):(t="advanced_disable_decide",i=(e="advanced_disable_flags")in s&&!ii(s[e]),n=t in s&&!ii(s[t]),i?s[e]:!!n&&(iK&&iK.warn("Config field '"+t+"' is deprecated. Please use '"+e+"' instead. The old field will be removed in a future major version."),s[t]))}Dr(e){if(io(this.config.before_send))return e;var t=t7(this.config.before_send)?this.config.before_send:[this.config.before_send],i=e;for(var n of t){if(io(i=n(i))){var s="Event '"+e.event+"' was rejected in beforeSend function";return iu(e.event)?iK.warn(s+". This can cause unexpected behavior."):iK.info(s),null}i.properties&&!it(i.properties)||iK.warn("Event '"+e.event+"' has no properties after beforeSend function, this is likely an error.")}return i}getPageViewId(){var e;return null==(e=this.pageViewManager.Vt)?void 0:e.pageViewId}captureTraceFeedback(e,t){this.capture("$ai_feedback",{$ai_trace_id:String(e),$ai_feedback_text:t})}captureTraceMetric(e,t,i){this.capture("$ai_metric",{$ai_trace_id:String(e),$ai_metric_name:t,$ai_metric_value:String(i)})}Sr(e){var t=ic(e)&&!e,i=s_.H()&&"true"===s_.q("ph_debug");return!t&&(!!i||e)}}for(var oN=["identify"],oP=0;oP<oN.length;oP++)oE.prototype[oN[oP]]=i4(oE.prototype[oN[oP]]);var oM,oL,oR,oI,oT,oA,oD,oz,o$,oF,oO,oV,oq,oB,oj=(oB=ob[ow]=new oE,function(){function e(){e.done||(e.done=!0,oS=!1,i0(ob,function(e){e._dom_loaded()}))}null!=tV&&tV.addEventListener?"complete"===tV.readyState?e():i9(tV,"DOMContentLoaded",e,{capture:!1}):tA&&iK.error("Browser doesn't support `document.addEventListener` so PostHog couldn't be initialized")}(),oB);const oH=new CSSStyleSheet;oH.replaceSync(String(tN));const oU=["png","svg","webp"];class oG extends HTMLElement{dialog;elements;units;customDimensions;dimensions;margin;patternAspectRatio=1;currentSize;currentPattern;unitFloatingPointsPrecision=0;constructor(){super();let e=this.attachShadow({mode:"open"});e.adoptedStyleSheets=[oH],this.shadowRoot.innerHTML=String(tP),this.dialog=e.querySelector("confirm-dialog"),this.elements={size:e.querySelector("#size"),form:e.querySelector("form"),unitSelect:e.querySelectorAll(".unit-select"),dpi:e.querySelector("#dpi"),dpiBlock:e.querySelector("#dpi_block"),renderNumbersBlock:e.querySelector("#render_numbers_block"),patternDimensions:e.querySelector("#pattern_size"),imageDimensions:e.querySelector("#image_dimensions"),margin:e.querySelector("#margin"),canvas:e.querySelector("#canvas"),transparentBackground:e.querySelector("#transparent_background"),rotateBtn:e.querySelector("#rotate_btn")},this.#ti(),this.setSize(tI[0].id),tL.addEventListener("unitsChange",e=>{"px"!==this.units&&this.setUnits(e)}),e.addEventListener("focusin",e=>{e.target instanceof HTMLInputElement&&("text"===e.target.type||"number"===e.target.type)&&e.target.select()}),e.addEventListener("change",e=>{if(e.target instanceof HTMLSelectElement&&e.target.classList.contains("unit-select")&&this.setUnits(e.target.value),e.target===this.elements.size&&this.setSize(this.elements.size.value),e.target instanceof HTMLInputElement&&"radio"===e.target.type&&"type"===e.target.name){let e=this.elements.form.querySelector('input[name="type"]:checked')?.value;this.setType(e)}e.target instanceof HTMLElement&&null!=e.target.dataset.updatesPreview&&this.updatePreview(),e.target instanceof HTMLSelectElement&&"format"===e.target.id&&this.setImageType(e.target.value)}),this.elements.margin.addEventListener("input",e=>{let t=Number(e.target.value);this.setMargin(isNaN(t)?0:t)}),this.elements.imageDimensions.addEventListener("dimensionchange",({detail:{dimension:e,value:t,...i}})=>{let n=i[e];this.customDimensions&&(this.customDimensions=t,this.setDimensions(t),this.elements.patternDimensions.setMaxDimensions(t),this.elements.patternDimensions[e]=n-2*this.margin),this.updatePreview()}),this.elements.patternDimensions.addEventListener("dimensionchange",({detail:{dimension:e,value:t,...i}})=>{let n=i[e];this.dimensions&&this.setMargin(this.dimensions[+("width"!==e)]-n,{updatePatternDimensions:!1})}),this.elements.rotateBtn.addEventListener("click",()=>this.rotateImage())}setType(e,t=!0){this.shadowRoot.querySelector(`#type_${e}`).checked=!0,this.#tn("nails_map"===e),t&&this.updatePreview()}setImageType(e){this.shadowRoot.querySelector("#format").value=e,b(this.elements.transparentBackground,!oU.includes(e))}getFormValues(){return Object.fromEntries(new FormData(this.elements.form).entries())}get isTransparentBackground(){let e=this.getFormValues();return oU.includes(String(e.format))&&"on"===e.transparent_background}#ti(){this.elements.size.innerHTML=tI.map(({id:e,name:t})=>`<option value="${e}">${t??e}</option>`).join("\n")}#tn(e){b(this.elements.renderNumbersBlock,!e)}get dpi(){return Number(this.elements.dpi.value??300)}rotateImage(){this.setDimensions(this.#ts(this.dimensions))}setUnits(e,t=!0){if(e===this.units)return;let i=this.units;this.units=e,this.elements.unitSelect.forEach(t=>{t.value=e}),this.unitFloatingPointsPrecision=+("px"!==e),"cm"===e||"inch"===e?(tL.setUserPreferredUnits(e),v(this.elements.dpiBlock)):y(this.elements.dpiBlock),this.elements.patternDimensions.setFloatingPoints(this.unitFloatingPointsPrecision),this.elements.imageDimensions.setFloatingPoints(this.unitFloatingPointsPrecision),i&&(this.dimensions&&(this.dimensions=A(this.dimensions,i,e,this.dpi)),this.margin&&this.setMargin(T(this.margin,i,e,this.dpi))),this.dimensions&&this.setDimensions(this.dimensions,t)}getMarginMax(){return this.dimensions?Math.min(this.dimensions[0]/2.1,this.dimensions[1]/2.1):null}setMargin(e,{updatePatternDimensions:t=!0,updatePreview:i=!0}={}){e=Math.max(e,0),this.dimensions&&(e=Math.min(e,this.getMarginMax())),e!==this.margin&&(this.margin=e??0,this.elements.margin.value=String(e.toFixedPrecision(this.unitFloatingPointsPrecision)??0),t&&this.dimensions&&this.updatePatternDimensions(),i&&this.updatePreview())}setSize(e,t=!0){let i=tT(e);this.currentSize=i;let{units:n,dimensions:s,aspectRatio:r,allowSizeEdit:a,defaultUnits:o,inUnits:l,defaultMargin:c=0,allowRotate:u}=i;this.elements.imageDimensions.aspectRatio=r instanceof Function?r({patternAspectRatio:this.patternAspectRatio}):r;let d=s instanceof Function?s({customDimensions:this.customDimensions,currentDimensions:this.dimensions,patternAspectRatio:this.patternAspectRatio}):s;a?(this.elements.imageDimensions.isReadonly=!1,this.customDimensions=d):this.elements.imageDimensions.isReadonly=!0,b(this.elements.rotateBtn,!u);let h=n&&1===n.length&&"px"===n[0];this.togglePixels(!n||n.includes("px")),this.setPixelsOnly(h);let p=o??(h?"px":n&&!n.includes(this.units)?tL.getUserPreferredUnits():this.units);this.setUnits(p),l&&l!==p&&(d=I(A(d,l,p,this.dpi),e=>e.toFixedPrecision(1))),c&&this.setMargin(c),this.setDimensions(d,t),t&&this.updatePreview(),this.elements.size.value=e}togglePixels(e){this.elements.unitSelect.forEach(t=>{b(t.querySelector('[value="px"]'),!e)})}#tr(e){let{dimensions:t}=tT(e);return t instanceof Function?t({customDimensions:this.customDimensions,currentDimensions:this.dimensions,patternAspectRatio:this.patternAspectRatio}):t}setPixelsOnly(e){e&&this.togglePixels(!0),this.elements.unitSelect.forEach(t=>{e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled"),t.querySelectorAll(':not([value="px"])').forEach(t=>b(t,e))})}setDimensions(e,t=!0){this.dimensions=e,this.elements.imageDimensions.width=e[0],this.elements.imageDimensions.height=e[1],this.elements.canvas.style.removeProperty("width"),this.elements.canvas.style.removeProperty("height"),this.elements.margin.setAttribute("max",String(this.getMarginMax())),this.updatePatternDimensions(),t&&this.updatePreview()}updatePatternDimensions(){let e=this.#ta();this.elements.patternDimensions.maxWidth=this.dimensions[0],this.elements.patternDimensions.maxHeight=this.dimensions[1],this.elements.patternDimensions.width=e[0],this.elements.patternDimensions.height=e[1]}#ta(){let e=this.dimensions[0]-2*this.margin,t=I(this.dimensions,e=>e-2*this.margin);return!this.patternAspectRatio||isNaN(this.patternAspectRatio)?t:F([e,e/this.patternAspectRatio],I(this.dimensions,e=>e-2*this.margin))}#ts(e){return[e[1],e[0]]}close(){this.dialog.close()}async show(e){return this.currentPattern=e,this.patternAspectRatio=e.getAspectRatio({size:this.dimensions}),this.elements.patternDimensions.setAttribute("aspect-ratio",String(this.patternAspectRatio)),this.setSize(this.currentSize.id),this.dialog.show(()=>{let t=tr.getPatternDownloadData(e.id);this.setDownloadOptionsToForm(t)}).then(async()=>{let t=this.getFormValues(),i=this.#to(t,e);tr.savePatternDownloadData(e.id,i),await ti(e,i),oj.capture("download",{pattern:e.type,isTemplate:e.isTemplate,...i})})}#to(e,t){let i="nails_map"===e.type,n=this.#tr(e.size);return e.rotate_image&&(n=this.#ts(n)),{size:n,type:"svg"===e.format?"svg":"canvas",imageType:"svg"===e.format?null:e.format,isNailsMap:i,units:e.unit??"px",dpi:Number(e.dpi),margin:Number(e.margin),includeNailNumbers:i&&"on"===e.render_numbers,filename:i?`${t.name} - nail map`:t.name,enableBackground:!this.isTransparentBackground,sizeId:String(e.size),isRotated:!!e.rotate_image}}setDownloadOptionsToForm(e){if(!e){let t=tI[0];e={size:t.dimensions instanceof Function?t.dimensions({patternAspectRatio:this.patternAspectRatio}):t.dimensions,sizeId:t.id,margin:t.defaultMargin,units:t.defaultUnits,enableBackground:!0}}this.setType(e.isNailsMap?"nails_map":"all",!1),this.#tn(e.isNailsMap),this.shadowRoot.querySelector("#render_numbers").value=!0===e.includeNailNumbers;let t=e.sizeId??"custom";this.setSize(t,!1);let i=!0===e.isRotated;this.shadowRoot.querySelector("#rotate_image").checked=i,i&&this.rotateImage(),null!=e.units&&this.setUnits(e.units,!1),this.setMargin(e.margin??0,{updatePreview:!1}),this.elements.dpi.value=String(e.dpi??300),this.setImageType(e.imageType??"png"),this.shadowRoot.querySelector("#transparent_background").value=!e.enableBackground,this.updatePreview()}updatePreview(){if(!this.currentPattern||!this.elements.canvas.clientWidth)return;this.elements.canvas.innerHTML="";let e=A(this.dimensions,this.units,"px",this.dpi);if(this.elements.canvas.clientWidth){let t=F(e,[this.elements.canvas.clientWidth||200,this.elements.canvas.clientHeight||300]);this.elements.canvas.style.width=t[0]+"px",this.elements.canvas.style.height=t[1]+"px"}let t=new B(this.elements.canvas,{updateOnResize:!1}),i=[this.elements.canvas.clientWidth||200,this.elements.canvas.clientHeight||300];t.setFixedSize(i);let n=this.currentPattern.copy(),s=this.getFormValues();n.assignConfig("nails_map"===s.type?{darkMode:!1,showNails:!0,showNailNumbers:"on"===s.render_numbers,showStrings:!1,nailsColor:"#000000",backgroundColor:"#ffffff",enableBackground:!this.isTransparentBackground}:{enableBackground:!this.isTransparentBackground,showNailNumbers:!1,showStrings:!0});let r=i[0]/e[0];n.assignConfig({margin:Math.floor(this.margin*r),nailRadius:Math.max(.5,this.currentPattern.config.nailRadius*r)}),n.draw(t)}}customElements.define("download-dialog",oG);var oW={};oW='.hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}@font-face{font-family:string_art_studio;src:url(string_art_studio.9cced145.ttf)format("truetype"),url(string_art_studio.44d13d52.woff)format("woff"),url(string_art_studio.ae7f2e94.svg#string_art_studio)format("svg");font-weight:400;font-style:normal;font-display:block}i{speak:never;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;line-height:1;font-family:string_art_studio!important}.icon-text:before{content:"î¤—"}.icon-step_back:before{content:"î¤•"}.icon-step_forward:before{content:"î¤–"}.icon-thread:before{content:"î¤”"}.icon-rotate:before{content:"î¤“"}.icon-pencil:before{content:"î¤’"}.icon-plus:before{content:"î¤"}.icon-trash:before{content:"î¤‘"}.icon-diskette_b:before{content:"î¤"}.icon-diskette:before{content:"î¤Ž"}.icon-menu:before{content:"î¤€"}.icon-arrow_left:before{content:"î¤"}.icon-arrow_right:before{content:"î¤‚"}.icon-caret_down:before{content:"î¤ƒ"}.icon-download:before{content:"î¤„"}.icon-fullscreen:before{content:"î¤…"}.icon-hamburger:before{content:"î¤†"}.icon-options:before{content:"î¤‡"}.icon-pause:before{content:"î¤ˆ"}.icon-play:before{content:"î¤‰"}.icon-refresh:before{content:"î¤Š"}.icon-share:before{content:"î¤‹"}.icon-thumbnails:before{content:"î¤Œ"}.icon-x:before{content:"î¤"}#buttons{grid-area:"controls";border-right:var(--border-light);background:var(--color-header);z-index:3;padding:0 var(--horizontal-padding);justify-content:space-evenly;align-items:center;display:flex;position:relative;box-shadow:0 -2px 6px #0000004d}#buttons .btn{margin:0}.btn{color:#fff;cursor:pointer;background:#0375fb;border:none;border-radius:15px;width:100%;height:30px;margin-bottom:8px}.btn:hover{background:#3592ff}.btn_subdued{color:#000;background:#c5c5c5}.btn_subdued:hover{color:#000;background:#efefef}.circular_btn{width:var(--controls-height);height:var(--controls-height);cursor:pointer;color:var(--color-text);background:0 0;border:none;justify-content:center;align-items:center;font-size:28px;display:flex}.circular_btn:hover{color:var(--color-text);background:#0000004d}.circular_btn img{width:18px;height:18px}.circular_btn.active{background:radial-gradient(circle at 50% 100%,#5205e7,#220c1b);padding:0;box-shadow:inset 0 4px 6px #0009}.circular_btn.active i{transform:scale(.95)}#buttons_dialogs{z-index:2;height:calc(100vh - var(--controls-height) - var(--select-height));width:100%;position:absolute;bottom:100%;overflow:hidden}.buttons_dialog{--buttons-dialog-border-radius:10px;bottom:var(--controls-height);z-index:1;background:var(--color-buttons-dialog);width:var(--sidebar-width);padding:var(--vertical-padding)var(--horizontal-padding);padding-top:calc(2*var(--buttons-dialog-border-radius));border-top:var(--border-light);transition:transform .2s ease-out;position:fixed;transform:translateY(100%);box-shadow:0 -2px 7px #000000b3}.buttons_dialog.open{transform:translateY(0)}.btn-icon{color:#fff;cursor:pointer;background:0 0;border:none;align-items:center;font-size:22px;display:flex}.menu_btn{background:var(--color-accent);height:48px;color:var(--color-text);border-radius:24px;align-items:center;padding:0 32px 0 24px;font-weight:500;text-decoration:none;display:inline-flex;font-size:1.1em!important}@media only screen and (width<=800px){.menu_btn{justify-content:center;width:auto;display:flex}}.menu_btn:hover{background:var(--color-accent-hover);color:var(--color-text);text-decoration:none}.menu_btn img{margin-inline-end:8px}.icon_btn{color:#fffc;cursor:pointer;background:0 0;border:none;border-radius:4px;padding:4px 6px;font-size:14px}.icon_btn:hover{color:#fff}.icon_btn>i{position:relative;top:1px}#wrapper{flex-direction:column;width:100%;height:90%;display:flex}form{flex:0}section{margin-bottom:1px}label:not(.icon_btn){margin-bottom:4px;display:block}input[type=checkbox]:checked+.icon_btn{color:#fff;background:#ffffff1a}h4{margin-bottom:0}hr{opacity:.2;position:relative;top:-.5em}#output{border:var(--border-light);background:var(--color-canvas-background);flex:1;max-height:30vh;padding:1em;overflow:auto}';var oK={};oK='<confirm-dialog dialog-title="Textual instructions" submit=Download submit-icon=download centered description="The numbers are nail numbers, which can be printed with the nail positions. This output can also be used with other software, which is used to automatically create a string art project." width=640>\n  <div id=wrapper>\n    <form>\n      <hr>\n      <fieldset>\n        <label for=format>Output format</label>\n        <div class=radio-list>\n          <input type=radio name=format id=format_json value=json checked>\n          <label for=format_json>JSON</label>\n          <input type=radio name=format id=format_txt value=txt>\n          <label for=format_txt>Text</label>\n        </div>\n      </fieldset>\n\n      <fieldset>\n        <label for=color>Color format</label>\n        <div class=radio-list>\n          <input type=radio name=color id=color_rgb value=rgb checked>\n          <label for=color_rgb>RGB</label>\n          <input type=radio name=color id=color_hex value=hex>\n          <label for=color_hex>Hexadecimal</label>\n          <input type=radio name=color id=color_hsl value=hsl>\n          <label for=color_hsl>HSL</label>\n        </div>\n      </fieldset>\n      \n      \n    </form>\n    <h4>Ouput</h4>\n    <pre id=output></pre>\n  </div>\n</confirm-dialog>\n';class oY extends Z{pattern;layers;currentLayer;layerStart;constructor(e,t){super(e,new es),this.pattern=t,this.layers=[]}startLayer({color:e}){this.currentLayer?.color!==e&&this.layers.push(this.currentLayer={color:e,points:[]}),this.layerStart&&(this.goto(...this.layerStart),this.layerStart=null)}goto(e,t){if(!this.currentLayer){this.layerStart=[e,t];return}this.currentLayer?.points.length&&this.startLayer({color:this.currentLayer.color}),this.currentLayer.points.push(this.pattern.getNailNumber(e,t))}stringTo(e,t){this.currentLayer.points.push(this.pattern.getNailNumber(e,t))}}const oJ={dimensions:[100,100],includeNails:!0},oX=/^hsl\((\d{1,3}(?:\.\d+)?),\s?(\d{1,3}(?:\.\d+)?)%,\s?(\d{1,3}(?:\.\d+)?)%\)$/,oZ=/^rgb\((\d{1,3}),\s?(\d{1,3}),\s?(\d{1,3})\)$/,oQ=/^#([0-9|a-f]{2})([0-9|a-f]{2})([0-9|a-f]{2})$/;function o0(e,t){let i=function(e){if(oX.test(e))return"hsl";if(oZ.test(e))return"rgb";if(oQ.test(e))return"hex";throw Error(`Unknown color format for "${e}"`)}(e);if(i===t)return e;if("hsl"===i){let[i,n,s,r]=e.match(oX),a=function(e,t,i){if(e=(e%360+360)%360,i/=100,0==(t/=100)){let e=Math.round(255*i);return[e,e,e]}let n=(1-Math.abs(2*i-1))*t,s=e/60,r=n*(1-Math.abs(s%2-1)),a=0,o=0,l=0;s>=0&&s<1?(a=n,o=r):s<2?(a=r,o=n):s<3?(o=n,l=r):s<4?(o=r,l=n):s<5?(a=r,l=n):(a=n,l=r);let c=i-n/2;return[Math.round((a+c)*255),Math.round((o+c)*255),Math.round((l+c)*255)]}(Number(n),Number(s),Number(r));return"rgb"===t?o1(a):o2(a)}let n="rgb"===i?e.match(oZ).splice(1).map(e=>Number(e)):e.match(oQ).slice(1).map(e=>parseInt(e,16));switch(t){case"hsl":return function([e,t,i]){return`hsl(${e}, ${t}%, ${i}%)`}(function([e,t,i]){let n=Math.max(e/=255,t/=255,i/=255),s=Math.min(e,t,i),r=n-s,a=0,o=0,l=(n+s)/2;if(0!==r){switch(o=r/(1-Math.abs(2*l-1)),n){case e:a=(t-i)/r%6;break;case t:a=(i-e)/r+2;break;case i:a=(e-t)/r+4}(a*=60)<0&&(a+=360)}return[Math.round(a),Math.round(100*o),Math.round(100*l)]}(n));case"rgb":return o1(n);case"hex":return o2(n)}}function o1(e){return`rgb(${e.join(", ")})`}function o2(e){return`#${e.map(e=>e.toString(16).padStart(2,"0")).join("")}`}const o3=new CSSStyleSheet;o3.replaceSync(String(oW));class o5 extends HTMLElement{dialog;elements;currentPattern;formattedInstructions;constructor(){super();let e=this.attachShadow({mode:"open"});e.adoptedStyleSheets=[o3],this.shadowRoot.innerHTML=String(oK),this.dialog=e.querySelector("confirm-dialog"),this.elements={form:e.querySelector("form"),unitSelect:e.querySelectorAll(".unit-select"),output:e.querySelector("#output")},e.addEventListener("focusin",e=>{e.target instanceof HTMLInputElement&&("text"===e.target.type||"number"===e.target.type)&&e.target.select()}),e.addEventListener("change",e=>{e.target instanceof HTMLElement&&this.updatePreview()})}getFormValues(){return Object.fromEntries(new FormData(this.elements.form).entries())}close(){this.dialog.close()}async show(e){return this.currentPattern=e,this.dialog.show(()=>{let t=tr.getPatternDownloadInstructionsData(e.id);this.setDownloadOptionsToForm(t),this.updatePreview()}).then(async()=>{let t=this.getFormValues(),i=this.#to(t,e);tr.savePatternDownloadInstructionsData(e.id,i),function(e,t,i="text/plain"){tt({data:new Blob([e],{type:i}),filename:t})}(this.formattedInstructions,`${e.name}.${"json"===i.format?"json":"txt"}`,"json"===i.format?"text/json":"text/plain")})}#to(e,t){let i="nails_map"===e.type;return{format:"json"===e.format?"json":"txt",filename:i?`${t.name} - instructions`:t.name,includeNailPositions:!0,includeInstructions:!0,colorFormat:e.color}}setDownloadOptionsToForm(e){e||(e={format:"json",includeNailPositions:!0,includeInstructions:!0,colorFormat:"rgb"}),this.setFormat(e.format??"json"),this.setColorFormat(e.colorFormat??"rgb"),this.updatePreview()}setFormat(e,t=!0){this.shadowRoot.querySelector(`#format_${e}`).checked=!0,t&&this.updatePreview()}setColorFormat(e,t=!0){this.shadowRoot.querySelector(`#color_${e}`).checked=!0,t&&this.updatePreview()}updatePreview(){let e=this.getFormValues(),t=this.#to(e,this.currentPattern),i=function(e,t={}){let i=Object.assign({},oJ,t),n=new J(t.dimensions),s=new oY(n,e);e.draw(n,{controller:s});let r={layers:s.layers};return i.includeNails&&(r.nails=e.getNailsCoordinates()),r}(this.currentPattern,{dimensions:[100,100],includeNails:!1});this.formattedInstructions=this.elements.output.innerHTML=this.formatInstructions(i,t)}formatInstructions(e,t){return"json"===t.format?JSON.stringify({layers:e.layers.map(e=>({color:o0(e.color,t.colorFormat),points:e.points.join(", ")}))},null,2).replace(/\"points\": \"([\d\,\s]+)\"/g,'"points": [$1]'):e.layers.map(e=>`${o0(e.color,t.colorFormat)}
${e.points.join(", ")}`).join("\n\n")}}customElements.define("download-instructions-dialog",o5);class o4 extends s{element;renderer;pattern;rendererType;cancelDraw;constructor(e="canvas"){super(),this.rendererType=e,this.element=document.querySelector("#canvas_panel"),this.element.addEventListener("wheel",({deltaY:e})=>{let t=-e/Math.abs(e);this.emit("positionChange",{changeBy:t})},{passive:!0}),r.addEventListener("showInstructionsChange",({showInstructions:e})=>{this.#tl(),e?this.renderer.showInstructions():this.renderer.hideInstructions()}),e5.addEventListener("renderer",e=>{this.rendererType=e,this.renderer=null})}get position(){return this.pattern?.position??-1}get size(){return[this.element.clientWidth,this.element.clientHeight]}setSize(e){this.#tl(),e?(this.element.classList.contains("overflow")||this.element.classList.add("overflow"),this.renderer.setFixedSize(e)):(this.element.classList.remove("overflow"),this.renderer.resetSize())}getLastStringNailNumbers(){return this.pattern.getLastStringNailNumbers()}setRenderer(e){this.renderer=e,e.addEventListener("sizeChange",({size:e})=>this.#tc(e))}setPattern(e){this.pattern=e,!e&&this.renderer&&this.renderer.clear()}#tc(e){e[0]&&e[1]&&this.pattern?.draw(this.renderer,{sizeChanged:!0})}#tu(){let e;this.element.addEventListener("pointerdown",()=>{this.emit("click",null);let t=()=>{clearTimeout(e),this.element.removeEventListener("pointerup",t)};e=setTimeout(()=>{this.element.removeEventListener("pointerup",t),this.emit("touchStart",null);let e=()=>{this.emit("touchEnd",null),this.element.removeEventListener("pointerup",e)};this.element.addEventListener("pointerup",e)},200),this.element.addEventListener("pointerup",t)})}update(e){r.showInstructions=!1,this.#tl(),this.pattern?.draw(this.renderer,{...e})}goto(e){this.#tl(),this.pattern.goto(this.renderer,e,{showInstructions:r.showInstructions})}prev(){0!==this.position&&this.pattern.goto(this.renderer,this.position-1,{showInstructions:r.showInstructions})}next(){return{done:this.pattern.drawNext().done}}getStepCount(){return this.#tl(),this.pattern.getStepCount({size:this.renderer.getSize()})}#tl(){if(!this.renderer){let e="svg"===this.rendererType?te:B;this.setRenderer(new e(this.element))}}}const o6=[30,30],o8=[20,30,40,50,60,70,80,90,100],o7=new class{elements;targetSizeCm=o6;pattern;lastSize;patternMargin;patternNailRadius;constructor(){this.elements={infoPanel:document.querySelector("#info_panel"),nailsCount:document.querySelector("#nails_count"),threadsTotalLength:document.querySelector("#threads_total_length"),threadsPerColor:document.querySelector("#threads_per_color"),closestDistanceBetweenNails:document.querySelector("#closest_distance_between_nails"),dimensions:document.querySelector("#info_dimensions"),dimensionsSelect:document.querySelector("#info_dimensions_select")},this.elements.dimensions.addEventListener("dimensionchange",({detail:{value:e}})=>{this.targetSizeCm=e,this.pattern&&this.update()}),this.elements.dimensionsSelect.addEventListener("change",e=>{let t=Number(this.elements.dimensionsSelect.value);this.targetSizeCm=[t,t],this.update()})}#td(){let e=this.pattern.getAspectRatio({size:[100,100]}),t=o8.map(t=>e>=1?[t,Math.round(t/e)]:[Math.round(t*e),t]);this.elements.dimensionsSelect.innerHTML=t.map((e,t)=>`<option value="${o8[t]}">${e.join("x")} cm`).join("\n"),this.elements.dimensionsSelect.value=this.targetSizeCm[0].toString()}setPattern(e,t){this.pattern=e.copy(),this.lastSize=t,this.patternMargin=e.config.margin,this.patternNailRadius=e.config.nailRadius,this.update(),this.#td()}async update(){if(!this.pattern)throw Error("Can't update info - no pattern.");n?.abort();let e=F(this.lastSize,this.targetSizeCm),t=Math.min(e[0]/this.lastSize[0],e[1]/this.lastSize[1]);this.pattern.assignConfig({margin:this.patternMargin*t,nailRadius:this.patternNailRadius*t}),this.elements.dimensions.value=this.targetSizeCm,n=new TaskController({priority:"background"});let{nailsCount:i,threadsLength:s,closestDistanceBetweenNails:r}=await scheduler.postTask(()=>this.getInfo(this.targetSizeCm),{signal:n.signal});this.elements.nailsCount.textContent=i.toLocaleString(),this.elements.threadsTotalLength.textContent=String(this.#th(s.total)),this.elements.closestDistanceBetweenNails.textContent=String(this.#th(r)),this.elements.threadsPerColor.innerHTML="";let a=Math.max(...s.perColor.map(({length:e})=>e));[...s.perColor].sort((e,t)=>t.length-e.length).forEach(({color:e,length:t})=>{let i=document.createElement("li"),n=document.createElement("div");i.appendChild(n),n.style.background=e,n.className="info__thread_color_value",n.style.width=`max(calc(${100*t/a}% - 70px), 6px)`;let s=document.createElement("span");s.innerText=this.#th(t),s.className="info__thread_color_value_text",i.appendChild(s),this.elements.threadsPerColor.appendChild(i)})}#th(e,t=1){return function(e,t,i=1){let n=e*V;return n>=1?M(n,i).toLocaleString()+" m":n<.01?M(1e3*n,i).toLocaleString()+" mm":M(100*n,i).toLocaleString()+" cm"}(e*t,0)}getInfo(e){let t=new X(e);return this.pattern.draw(t,{sizeChanged:!0,redrawStrings:!0,redrawNails:!0,precision:100}),t.getInfo()}};async function o9(){let e,t,i={main:document.querySelector("main"),resetBtn:document.querySelector("#controls_reset_btn"),buttons:document.querySelector("#buttons"),instructionsLink:document.querySelector("#pattern_select_dropdown_instructions")};oj.init("phc_hYSU225vNE9x5Xz1f9YBYf89Gzzqo0GAdXuMiu0NQII",{api_host:"https://us.i.posthog.com",person_profiles:"always",persistence:"localStorage"});let n=new tr,s=new to(n),r=!1,a=window.viewer=new o4,l=new o(document.querySelector("#instructions"),a);await th(),document.body.querySelectorAll(".pattern_only").forEach(y),await tc()||document.querySelector("#share_menu_item").remove();let c=document.querySelector("#download_dialog"),u=document.querySelector("#download_instructions_dialog"),d={save_as:()=>n.showSaveAsDialog(),delete:()=>n.deletePattern(),save:()=>n.saveCurrentPattern(),rename:()=>n.renameCurrentPattern(),export:()=>n.exportAllPatterns(),download:()=>{e5.navigateToDialog("download")},instructions:()=>f("instructions"),design:()=>f("design"),info:()=>f("info"),share:()=>p(),download_instructions:()=>{e5.navigateToDialog("download_instructions")}},h={download:()=>{c.show(a.pattern).finally(()=>e5.closeDialog())},download_instructions:()=>{u.show(a.pattern).finally(()=>e5.closeDialog())}};async function p(){await tl({renderer:a.renderer,pattern:a.pattern})}e5.addEventListener("dialog",e=>{e in h?h[e]():e in d&&d[e]()}),e5.addEventListener("dialogClosed",()=>{c.close(),u.close()}),document.querySelector("#pattern_menu").addEventListener("select",e=>{let t=e.detail.value,i=document.querySelector(`dropdown-menu-item[value="${t}"]`);i?.hasAttribute("selectable")&&(document.querySelector("#pattern_menu [selected]")?.removeAttribute("selected"),i.setAttribute("selected","selected"));let n=d[t];if(n)n(),oj.capture("pattern_menu_select",{menu_item:t});else throw Error(`No action available for menu item "${t}".`)}),document.body.addEventListener("click",e=>{let t=e.target instanceof HTMLElement&&e.target.closest("[data-toggle-for]");if(t instanceof HTMLElement&&t){let e=t.dataset.toggleFor;t.classList.toggle("active");let i=document.querySelector("#"+e);i&&(i.classList.toggle("open"),document.body.classList.toggle("dialog_"+e))}}),i.resetBtn.addEventListener("click",function(){e7({title:"Reset options",description:t.isTemplate?"Are you sure you wish to reset options to defaults?":"Are you sure you wish to reset to the latest saved options?",submit:"Reset"}).then(()=>{let e=eZ(t.id);e5.navigateToPattern(e)},()=>{})}),i.instructionsLink.addEventListener("click",e=>{e.preventDefault(),e5.navigateToMain()}),s.addEventListener("select",({patternId:e})=>{let t=eZ(e);e5.navigateToPattern(t),oj.capture("thumbnail_select",{pattern:t.type,isTemplate:t.isTemplate})});let g=["info","design","instructions"];function f(e,i=!0){g.forEach(t=>{t!==e&&(document.querySelector("#"+t).classList.remove("open"),document.querySelector(`dropdown-menu-item[value='${t}']`)?.removeAttribute("selected"),document.body.classList.remove("dialog_"+t))}),document.querySelector(`dropdown-menu-item[value='${e}']`).setAttribute("selected","selected");let n=document.querySelector("#"+e);n&&!n.classList.contains("open")&&(n.classList.add("open"),document.body.classList.add("dialog_"+e),t&&a.update()),"info"===e&&(r=!r)&&o7.setPattern(t,a.size),i&&e5.navigateToFolder(e)}function m({control:e}){!1!==e.affectsStepCount&&l.update(a.getStepCount()),e5.navigateToPattern(t,{renderer:a.renderer instanceof te?"svg":void 0,replaceState:!0}),b(),r&&o7.setPattern(t,a.size)}function b(){i.main.dataset.isDefaultConfig=String(t.isDefaultConfig)}e5.addEventListener("folder",e=>f(e,!1)),n.addEventListener("deletePattern",({pattern:e})=>{let t=eZ(e.type);t&&(t.config=e.config,e5.navigateToPattern(t))}),n.addEventListener("save",({pattern:e})=>{e5.navigateToPattern(e)}),n.addEventListener("newPattern",({pattern:e})=>{oj.capture("save_new_pattern",{pattern:e.type,config:JSON.stringify(e.config)})}),v(document.querySelector("main")),setTimeout(()=>{let e=document.location.pathname.replace(/\/$/,"").replace(/^\//,"");e&&f(e)}),e5.addEventListener("pattern",({pattern:o,renderer:c})=>{var u;t=u=o,a.setPattern(u),e?.destroy(),n.setPattern(t),(e=new S(u.configControls,u.config)).addEventListener("input",({control:i,value:n})=>{t&&(t.setConfigValue(i.key,n),e.config=t.config,a.update({redrawNails:!1!==i.affectsNails,redrawStrings:!1!==i.affectsStrings,enableScheduler:!0}))}),e.addEventListener("change",m),s.setCurrentPattern(u),document.title=`${u.name} - String Art Studio`,document.body.setAttribute("data-pattern",u.id),document.body.querySelectorAll(".pattern_only").forEach(v),a.update(),l.update(a.getStepCount(),{draw:!1}),r&&o7.setPattern(u,a.size),i.main.dataset.isTemplate=String(t.isTemplate),b(),a.setPattern(o),s.close()}),e5.addEventListener("main",()=>{s.open(),t=null,a.setPattern(null),s.setCurrentPattern(null),e&&e.destroy(),document.body.querySelectorAll(".pattern_only").forEach(y),document.body.removeAttribute("data-pattern")}),e5.init()}!function(){var e=["user-blocking","user-visible","background"];class t{constructor(){this.t=new MessageChannel,this.i=this.t.port2,this.l={},this.o=1,this.t.port1.onmessage=e=>this.h(e)}u(e){var t=this.o++;return this.l[t]=e,this.i.postMessage(t),t}p(e){delete this.l[e]}h(e){var t=e.data;if(t in this.l){var i=this.l[t];delete this.l[t],i()}}}function i(){return i.v||(i.v=new t),i.v}class n{constructor(e,t,i){void 0===i&&(i=0),this.k=e,this.T=null,this.C=null,this.m=!1,this._(t,i)}isIdleCallback(){return 0===this.T}I(){return 2===this.T}cancel(){if(!this.m)switch(this.m=!0,this.T){case 0:cancelIdleCallback(this.C);break;case 1:clearTimeout(this.C);break;case 2:i().p(this.C);break;default:throw TypeError("Unknown CallbackType")}}_(t,n){if(n&&n>0)return this.T=1,void(this.C=setTimeout(()=>{this.P()},n));if(!e.includes(t))throw TypeError("Invalid task priority : "+t);return"background"===t&&"function"==typeof requestIdleCallback?(this.T=0,void(this.C=requestIdleCallback(()=>{this.P()}))):"function"==typeof MessageChannel?(this.T=2,void(this.C=i().u(()=>{this.P()}))):(this.T=1,void(this.C=setTimeout(()=>{this.P()})))}P(){this.m||this.k()}}var s=0;class r{constructor(){this.j=null,this.M=null}isEmpty(){return null==this.j}push(e){if("object"!=typeof e)throw TypeError("Task must be an Object");e.A=s++,this.isEmpty()?(e.N=null,this.j=e):(e.N=this.M,this.M.O=e),e.O=null,this.M=e}takeNextTask(){if(this.isEmpty())return null;var e=this.j;return this.q(e),e}merge(e,t){if("function"!=typeof t)throw TypeError("Must provide a selector function.");if(null==e)throw Error("sourceQueue cannot be null");for(var i=this.j,n=null,s=e.j;s;){var r=s;if(s=s.O,t(r)){for(e.q(r);i&&i.A<r.A;)n=i,i=i.O;this.D(r,n),n=r}}}D(e,t){if(t!=this.M){var i=t?t.O:this.j;e.O=i,i.N=e,e.N=t,null!=t?t.O=e:this.j=e}else this.push(e)}q(e){if(null==e)throw Error("Expected task to be non-null");e===this.j&&(this.j=e.O),e===this.M&&(this.M=this.M.N),e.O&&(e.O.N=e.N),e.N&&(e.N.O=e.O)}}class a extends Event{constructor(t,i){if(!i||!e.includes(i.previousPriority))throw TypeError("Invalid task priority: '"+i.previousPriority+"'");super(t),this.previousPriority=i.previousPriority}}class o extends AbortController{constructor(t){if(void 0===t&&(t={}),super(),null==t&&(t={}),"object"!=typeof t)throw TypeError("'init' is not an object");var i,n,s=void 0===t.priority?"user-visible":t.priority;if(!e.includes(s))throw TypeError("Invalid task priority: '"+s+"'");this.H=s,this.R=!1,Object.defineProperties(n=(i=this).signal,{priority:{get:function(){return i.H},enumerable:!0},onprioritychange:{value:null,writable:!0,enumerable:!0}}),n.addEventListener("prioritychange",e=>{n.onprioritychange&&n.onprioritychange(e)})}setPriority(t){if(!e.includes(t))throw TypeError("Invalid task priority: "+t);if(this.R)throw new DOMException("","NotAllowedError");if(this.signal.priority!==t){this.R=!0;var i=this.H;this.H=t;var n=new a("prioritychange",{previousPriority:i});this.signal.dispatchEvent(n),this.R=!1}}}void 0===self.scheduler?(self.scheduler=new class{constructor(){this.S={},e.forEach(e=>{this.S[e]=[new r,new r]}),this.U=null,this.W=new WeakMap}yield(){return this.B(()=>{},{priority:"user-visible"},!0)}postTask(e,t){return this.B(e,t,!1)}B(t,i,n){if(void 0!==(i=Object.assign({},i)).signal){if(null===i.signal||!("aborted"in i.signal)||"function"!=typeof i.signal.addEventListener)return Promise.reject(TypeError("'signal' is not a valid 'AbortSignal'"));if(i.signal&&i.signal.priority&&!e.includes(i.signal.priority))return Promise.reject(TypeError("Invalid task priority: '"+i.signal.priority+"'"))}if(void 0!==i.priority&&(null===i.priority||!e.includes(i.priority)))return Promise.reject(TypeError("Invalid task priority: '"+i.priority+"'"));if(void 0===i.delay&&(i.delay=0),i.delay=Number(i.delay),i.delay<0)return Promise.reject(TypeError("'delay' must be a positive number."));var s={callback:t,options:i,resolve:null,reject:null,hostCallback:null,abortCallback:null,onTaskCompleted:function(){this.options.signal&&this.abortCallback&&(this.options.signal.removeEventListener("abort",this.abortCallback),this.abortCallback=null)},onTaskAborted:function(){this.hostCallback&&(this.hostCallback.cancel(),this.hostCallback=null),this.options.signal.removeEventListener("abort",this.abortCallback),this.abortCallback=null,this.reject(this.options.signal.reason)},isAborted:function(){return this.options.signal&&this.options.signal.aborted},isContinuation:n},r=new Promise((e,t)=>{s.resolve=e,s.reject=t});return this._(s),r}_(e){var t=e.options.signal;if(t){if(t.aborted)return void e.reject(t.reason);e.abortCallback=()=>{e.onTaskAborted()},t.addEventListener("abort",e.abortCallback)}e.options.delay>0?e.hostCallback=new n(()=>{e.hostCallback=null,this.F(e)},null,e.options.delay):(this.G(e),this.J())}F(e){this.G(e),this.U&&(this.U.cancel(),this.U=null),this.K()}L(e){var t=this.W.get(e);if(void 0===t)throw Error("Attempting to change priority on an unregistered signal");if(t!==e.priority){for(var i=0;i<2;i++)this.S[e.priority][i].merge(this.S[t][i],t=>t.options.signal===e);this.W.set(e,e.priority)}}K(){this.U=null,this.V(),this.J()}J(){var{priority:e}=this.X();null!=e&&("background"!==e&&this.U&&this.U.isIdleCallback()&&(this.U.cancel(),this.U=null),this.U||(this.U=new n(()=>{this.K()},e,0)))}G(t){var i;if(!e.includes(i=t.options.priority?t.options.priority:t.options.signal&&t.options.signal.priority?t.options.signal.priority:"user-visible"))throw TypeError("Invalid task priority: "+i);if(t.options.signal&&t.options.signal.priority){var n=t.options.signal;this.W.has(n)||(n.addEventListener("prioritychange",()=>{this.L(n)}),this.W.set(n,n.priority))}this.S[i][+!t.isContinuation].push(t)}V(){var e=null;do{var{priority:t,type:i}=this.X();if(null==t)return;e=this.S[t][i].takeNextTask()}while(e.isAborted())try{var n=e.callback();e.resolve(n)}catch(t){e.reject(t)}finally{e.onTaskCompleted()}}X(){for(var t=0;t<e.length;t++)for(var i=e[t],n=0;n<2;n++)if(!this.S[i][n].isEmpty())return{priority:i,type:n};return{priority:null,type:0}}},self.TaskController=o,self.TaskPriorityChangeEvent=a):self.scheduler.yield||(self.scheduler.yield=function(){return self.scheduler.postTask(()=>{},{priority:"user-blocking"})})}(),window.addEventListener("error",function(e){alert("Error:\n"+e.message+"\n\nStack:\n"+e.error.stack),oj.captureException(e)}),window.addEventListener("load",o9);
//# sourceMappingURL=string_art.aeba0c25.js.map
