let e,t;function*i(e,t){let n=0;for(let r of e)yield{control:r,index:n,parent:t},r.children&&(yield*i(r.children,{control:r,parent:t,index:n})),n++}function n(e){return e.map(e=>{let t={...e};return e.children&&(t.children=n(e.children)),e.attr&&(t.attr={...e.attr}),t})}function r(e,t,r){let s=n(e),a=function(e,t){var n=({key:e})=>e===t;for(let t of i(e))if(n(t.control))return t;return null}(s,t);if(a){let{index:e,parent:t}=a;return(t?.control.children??s).splice(e+1,0,...r),s}return e}var s=[{key:"isMultiColor",label:"Use multiple colors",defaultValue:!1,type:"checkbox"},{key:"colorCount",label:"Colors count",defaultValue:7,type:"range",attr:{min:1,max:20,step:1},show:({isMultiColor:e})=>e},{key:"color",label:"String color",defaultValue:"#ff4d00",type:"color",show:({isMultiColor:e})=>!e},{key:"multicolorStart",label:"Multicolor start",defaultValue:1,type:"hue",attr:{colorthumb:!0},show:({isMultiColor:e})=>e},{key:"multicolorRange",label:"Multicolor range",defaultValue:360,type:"hue",attr:{start:({multicolorStart:e})=>e,type:"range"},show:({isMultiColor:e})=>e},{key:"saturation",label:"Saturation",defaultValue:100,type:"range",attr:{min:0,max:100,step:1},show:({isMultiColor:e})=>e},{key:"lightness",label:"Lightness",type:"group",defaultValue:"minimized",show:({isMultiColor:e})=>e,children:[{key:"multicolorByLightness",label:"Multi lightness",defaultValue:!1,type:"checkbox",show:({isMultiColor:e})=>e},{key:"minLightness",label:"Minimum lightness",defaultValue:0,type:"range",attr:{min:0,max:100,step:1,snap:"50",thumbcolor:({minLightness:e})=>`hsl(0 0 ${e})`,background:"linear-gradient(to right, black, white)"},show:({multicolorByLightness:e,isMultiColor:t})=>e&&t},{key:"maxLightness",label:"Maximum lightness",defaultValue:100,type:"range",attr:{min:0,max:100,step:1,snap:"50",thumbcolor:({maxLightness:e})=>`hsl(0 0 ${e})`,background:"linear-gradient(to right, black, white)"},show:({multicolorByLightness:e,isMultiColor:t})=>e&&t}]},{key:"colorOrderGroup",type:"group",label:"Order",defaultValue:"minimized",show:({isMultiColor:e})=>e,children:[{key:"reverseColors",label:"Reverse colors order",defaultValue:!1,type:"checkbox",show:({isMultiColor:e})=>e},{key:"repeatColors",label:"Repeat colors",defaultValue:!0,type:"checkbox",show:({isMultiColor:e})=>e},{key:"mirrorColors",label:"Mirror Colors",defaultValue:!1,type:"checkbox",show:({isMultiColor:e,repeatColors:t})=>e&&t}]}];class a{config;multiColorStep;multiColorLightnessStep;colors;constructor(e){this.config=e;let{multicolorRange:t,colorCount:i,multicolorByLightness:n,minLightness:r=0,maxLightness:s=100,multicolorStart:a,darkMode:l,saturation:o,reverseColors:c,repeatColors:u,mirrorColors:h,isMultiColor:d}=e;if(d){if(this.multiColorStep=t/Math.max(1,i-1),this.multiColorLightnessStep=n?(s-r)/(Math.max(i,2)-1):1,this.colors=Array(i).fill(null).map((e,t)=>{let i=n?r+this.multiColorLightnessStep*t:l?50:40;return`hsl(${a+t*this.multiColorStep}, ${o}%, ${i}%)`}),u&&h){let[e,...t]=this.colors;t.pop(),this.colors=[...this.colors,...t.reverse()]}c&&this.colors.reverse()}}getColor(e){let{isMultiColor:t,colorCount:i,color:n,repeatColors:r}=this.config;return t?(e>=i&&(e=r?e%this.colors.length:this.colors.length-1),this.colors[e]):n}static getOppositeColor(e){let t=e.match(/^hsl\((\d+)(?:deg)?(?:,?\s?)(\d+%?)(?:,?\s?)(\d+%?)\)$/);if(t){let e=(Number(t[1])+180)%360;return`hsl(${e}, ${t[2]}, ${t[3]})`}return null}getColorMap({stepCount:e,colorCount:t}){if(!t)throw Error("Can't get color map, no colorCount provided!");let i=Math.floor(e/t),n=new Map;for(let e=0;e<t;e++)n.set(e*i,this.getColor(e));return n}static getConfig({include:e,exclude:t,defaults:i={},customControls:r,propMapper:a,groupLabel:l,maxColorCount:o}){return{key:"colorGroup",label:l??"Color",type:"group",children:[...r??[],...function e(t,i){return i?t.map(t=>(t.children&&(t={...t,children:e(t.children,i)}),{...t,...i(t)})):t}(function r(a){return(a??n(s)).filter(({key:i})=>(!t||!t.includes(i))&&(!e||e.includes(i))).map(e=>{let t={...e,defaultValue:i[e.key]??e.defaultValue};return"group"===e.type&&(t.children=r(e.children)),"colorCount"===e.key&&o&&(t.attr.max=o),Object.freeze(t)})}(),a)]}}}const l={color:"#ffffff",fontSize:10,radius:1.5,renderNumbers:!1,margin:4};class o{nailRadius;nailsColor;nailNumbersFontSize;nails;addedPoints;renderer;#e=[];constructor(e,t){this.setConfig(t),this.nails=[],this.addedPoints=new Set,this.renderer=e}setConfig({nailRadius:e,nailsColor:t,nailNumbersFontSize:i}){this.nailRadius=e,this.nailsColor=t,this.nailNumbersFontSize=i,this.nails=[],this.addedPoints&&this.addedPoints.clear()}addNail(e){let t=e.point.map(Math.round).join("_");this.addedPoints.has(t)||(this.nails.push(e),this.addedPoints.add(t))}addGroup(e,t){this.#e.push({nails:e,options:t})}#t(e,t){this.renderer.renderNails(e,{...l,...t})}fill({drawNumbers:e=!0}={}){let t={color:this.nailsColor,fontSize:this.nailNumbersFontSize,radius:this.nailRadius,renderNumbers:e};this.#t(this.nails,t),this.nails=[],this.addedPoints.clear(),this.#e.forEach(({nails:e,options:i})=>{this.#t(e,{...t,...i})}),this.#e=[]}}class c{parentElement;color;size;constructor(e){this.parentElement=e}destroy(){this.element.remove()}get element(){throw Error("element getter not implemented!")}setColor(e){this.color=e}setBackground(e){}getSize(){let{width:e,height:t}=this.parentElement.getBoundingClientRect();return[e,t]}setSize(e){this.element.removeAttribute("width"),this.element.removeAttribute("height"),this.element instanceof HTMLElement&&(e?(this.element.style.width=`${e[0]}px`,this.element.style.height=`${e[1]}px`):this.element.removeAttribute("style"))}}const u="#0e0e0e",h=[{key:"strings",label:"Strings",type:"group",defaultValue:"minimized",children:[{key:"showStrings",label:"Show strings",defaultValue:!0,type:"checkbox",isDisabled:({showNails:e})=>!e},{key:"stringWidth",label:"String width",defaultValue:1,type:"range",attr:{min:.2,max:4,step:.1,snap:"1"},show:({showStrings:e})=>e}]},{key:"nails",label:"Nails",type:"group",defaultValue:"minimized",children:[{key:"showNails",label:"Show nails",defaultValue:!0,type:"checkbox",isDisabled:({showStrings:e})=>!e},{key:"showNailNumbers",label:"Show nail numbers",defaultValue:!1,type:"checkbox",show:({showNails:e})=>e},{key:"nailNumbersFontSize",label:"Nail numbers font size",defaultValue:10,type:"range",attr:{min:6,max:24,step:.5},displayValue:({nailNumbersFontSize:e})=>`${e}px`,show:({showNails:e,showNailNumbers:t})=>e&&t},{key:"margin",label:"Margin",defaultValue:20,type:"number",attr:{min:0,max:500,step:1},displayValue:({margin:e})=>`${e}px`},{key:"nailRadius",label:"Nail size",defaultValue:1.5,type:"range",attr:{min:.5,max:5,step:.25,snap:"1.5"},show:({showNails:e})=>e},{key:"nailsColor",label:"Nails color",defaultValue:"#ffffff",type:"color",show:({showNails:e})=>e}]},{key:"background",label:"Background",type:"group",defaultValue:"minimized",children:[{key:"darkMode",label:"Dark mode",defaultValue:!0,type:"checkbox",isDisabled:({enableBackground:e})=>!e},{key:"customBackgroundColor",label:"Custom background color",defaultValue:!1,type:"checkbox",isDisabled:({enableBackground:e})=>!e},{key:"backgroundColor",label:"Background color",defaultValue:u,type:"color",show:({customBackgroundColor:e})=>e,isDisabled:({enableBackground:e})=>!e},{key:"enableBackground",label:"Enable background",defaultValue:!0,type:"checkbox"}]}];var d=class{renderer;controls;defaultValues;stepCount=null;size=null;center=null;nails=null;position=0;stringsIterator;id;name;link;linkText;#i;#n;#r;constructor(e){if(!e)throw Error("Renderer not specified!");if(!(e instanceof c))throw Error("Renderer is not an instance of Renderer!");this.renderer=e}getCommonControls(){return h}get configControls(){return(this.controls??[]).concat(this.getCommonControls())}get controlsIndex(){return this.#n||(this.#n=function(e){let t={};for(let{control:n}of i(e))t[n.key]=n;return t}(this.configControls)),this.#n}get defaultConfig(){return this.#r||(this.#r=Object.freeze(Object.assign(function(e){let t={};for(let{control:{key:n,defaultValue:r}}of i(e))r instanceof Function||(t[n]=r);return t}(this.configControls),this.defaultValues))),this.#r}get config(){return this.#i??this.defaultConfig}set config(e){this.#i=Object.assign({},this.defaultConfig,e)}setConfig(e){let t=this.config;if(this.config=e,this.onConfigChange){let i=Object.keys(t).filter(i=>e[i]!==t[i]);this.onConfigChange(i.map(t=>({control:this.controlsIndex[t],value:e[t]})))}}resetStructure(){}onConfigChange(e){e.some(({control:e})=>e.isStructural)&&(this.resetStructure(),null!=this.stepCount&&e.some(({control:e})=>!1!==e.affectsStepCount)&&(this.stepCount=null))}onResize(){this.resetStructure()}setConfigValue(e,t){(!this.#i||this.#i[e]!==t)&&(this.#i=Object.freeze({...this.#i??this.defaultConfig,[e]:t}),this.onConfigChange&&this.onConfigChange([{control:this.controlsIndex[e],value:t}].filter(({control:e})=>!!e)))}getSize(){return this.renderer.getSize()}setUpDraw(){let e=this.size;this.renderer.reset();let[t,i]=this.size=this.getSize();Object.assign(this,this.size),this.center=this.size.map(e=>e/2),e&&(e[0]!==t||e[1]!==i)&&this.onResize&&this.onResize(),this.nails?this.nails.setConfig(this.config):this.nails=new o(this.renderer,this.config),this.renderer.setLineWidth(this.config.stringWidth)}afterDraw(){let{showNails:e,showNailNumbers:t}=this.config;e&&(this.drawNails(),this.nails.fill({drawNumbers:t}))}initDraw(){this.setUpDraw();let{showNails:e,showNailNumbers:t,darkMode:i,backgroundColor:n,customBackgroundColor:r,enableBackground:s}=this.config;s&&this.renderer.setBackground(r?n:i?u:"#ffffff"),e&&(this.drawNails(),this.nails.fill({drawNumbers:t}))}draw({position:e=1/0}={}){this.initDraw();let{showStrings:t}=this.config;if(t){for(this.stringsIterator=this.generateStrings(),this.position=0;!this.drawNext().done&&this.position<e;);this.afterDraw()}}goto(e){if(e!==this.position)if(this.stringsIterator&&e>this.position)for(;!this.drawNext().done&&this.position<e;);else this.draw({position:e})}drawNext(){let e=this.stringsIterator.next();return e.done?this.afterDraw():this.position++,e}};const g={linear:e=>e,inOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeOutQuint:e=>1-Math.pow(1-e,5),fastSlowFast:e=>.5*(1-Math.cos(Math.PI*(e=Math.max(0,Math.min(1,e)))))**1.5,fastInOutSquare:e=>e<=.5?(1-Math.pow(1-2*e,2))/2:.5+Math.pow(2*e-1,2)/2,fastInOutCubic:e=>e<=.5?(1-Math.pow(1-2*e,3))/2:.5+Math.pow(2*e-1,3)/2,fastInOutQuint:e=>e<=.5?(1-Math.pow(1-2*e,5))/2:.5+Math.pow(2*e-1,5)/2,fastInOut:(e,t)=>t<=.5?(1-Math.pow(1-2*t,e))/2:.5+Math.pow(2*t-1,e)/2,fastInOutFixed(e,t,i){if(i>t&&i<1-t){let n=(1-Math.pow(1-2*t,e))/2,r=.5+Math.pow((1-t)*2-1,e)/2;return n+(i-t)*(r-n)/(1-2*t)}return i<=t?(1-Math.pow(1-2*i,e))/2:.5+Math.pow(2*i-1,e)/2}};g.fastInOut.requirePower=!0,g.fastInOutFixed.requirePower=!0,g.fastInOutFixed.requireFastArea=!0;const p=2*Math.PI;class f{serializedConfig;points;easingFunction;config;center;xyRadius;rotationAngle=0;indexAngle;isReverse=!1;radius;constructor(e){this.setConfig(e)}getPoint(e=0){let t=this.getNailIndex(e);if(this.points.has(e))return this.points.get(e);let i=this.easingFunction(t/this.config.n)*p+this.rotationAngle,n=[this.center[0]+Math.sin(i)*this.xyRadius[0],this.center[1]+Math.cos(i)*this.xyRadius[1]];return this.points.set(e,n),n}getNailIndex(e=0){let t=this.isReverse?this.config.n-1-e:e;return t>this.config.n-1&&(t%=this.config.n),t}setConfig(e){let t=this.#s(e);if(t!==this.serializedConfig){let{n:i,size:n,margin:r=0,rotation:s=0,center:a,radius:l,reverse:o=!1}=e,c=a??n.map(e=>e/2),u=l??Math.min(...c)-r,h=[u,u];e.distortion&&(h=function(e,t){let i=Math.min(t[0]/e[0],t[1]/e[1]);return e.map(e=>e*i)}(e.distortion<0?[u*(1-Math.abs(e.distortion)),u]:[u/(1-e.distortion),u],c.map(e=>e-r)));let d={center:c,radius:u,xyRadius:h,indexAngle:p/i,rotationAngle:-p*s,isReverse:o},f=e.displacementFunc?g[e.displacementFunc]:g.linear,m=[];f.requirePower&&m.push(e.displacementMag),f.requireFastArea&&m.push(e.displacementFastArea);let y=m.length?f.bind(null,...m):f;this.easingFunction=y,this.config=e,this.serializedConfig=t,Object.assign(this,d),this.points?this.points.clear():this.points=new Map}}#s({n:e,size:t,margin:i=0,rotation:n=0,center:r,radius:s,reverse:a=!1,distortion:l=0,displacementFunc:o,displacementMag:c,displacementFastArea:u}){return[t?.join(","),r?.join(","),s,i,e,n,a,l].concat("linear"===o?[]:[o,c,u]).join("_")}*generateNails({nailsNumberStart:e=0,getNumber:t}={}){for(let i=0;i<this.config.n;i++)yield{point:this.getPoint(i),number:t?t(i):i+e}}drawNails(e,t={}){for(let i of this.generateNails(t))e.addNail(i)}*drawRing(e,{ringSize:t,color:i}){let n,{n:r}=this.config,s=Math.floor(t*r),a=0,l=!1;e.setColor(i);for(let t=0;t<r;t++){n||(n=this.getPoint(0));let i=n,o=[];a=l?t:a+s,n=this.getPoint(a),o.push(n),t<r-1&&(a++,n=this.getPoint(a),o.push(n)),e.renderLines(i,...o),yield,l=!l}}static rotationConfig={key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1+1/360,step:1/360,snap:"0.25, 0.5, 0.75"},displayValue:({rotation:e})=>`${Math.round(360*e)}\xb0`,isStructural:!0,affectsStepCount:!1};static nailsConfig=Object.freeze({key:"n",label:"Number of nails",defaultValue:144,type:"range",attr:{min:3,max:300,step:1},isStructural:!0});static displacementConfig={key:"displacement",label:"Displacement",type:"group",children:[{key:"displacementFunc",label:"Displacement function",defaultValue:"linear",type:"select",options:Object.keys(g),isStructural:!0,affectsStepCount:!1},{key:"displacementMag",label:"Displacement magnitude",defaultValue:3,type:"range",attr:{min:0,max:10,step:.1},show:({displacementFunc:e})=>g[e].requirePower,isStructural:!0,affectsStepCount:!1},{key:"displacementFastArea",label:"Displacement fast area",defaultValue:.4,type:"range",attr:{min:0,max:.5,step:.01},show:({displacementFunc:e})=>g[e].requireFastArea,isStructural:!0,affectsStepCount:!1}]};static distortionConfig={key:"distortion",label:"Distortion",defaultValue:0,type:"range",attr:{min:-.99,max:.99,step:.01,snap:"0"},isStructural:!0,affectsStepCount:!1}}const m=a.getConfig({defaults:{isMultiColor:!0,colorCount:7,color:"#ffbb29",multicolorRange:21,multicolorStart:32,multicolorByLightness:!0,minLightness:36,maxLightness:98}});class y extends d{id="spiral";name="Spiral";link="https://www.etsy.com/il-en/listing/840974781/boho-wall-decor-artwork-spiral-round";controls=[{...f.nailsConfig,defaultValue:200},{key:"repetition",label:"Repetition",defaultValue:5,type:"range",attr:{min:1,max:20,step:1}},{key:"innerLength",label:"Spiral thickness",defaultValue:.5,type:"range",attr:{min:({n:e})=>1/e,max:1,step:({n:e})=>1/e},displayValue:({n:e,innerLength:t})=>Math.round(e*t)},{...f.rotationConfig,defaultValue:.75},f.distortionConfig,m];#a;#l;#o;#c;setUpDraw(){super.setUpDraw();let{n:e,rotation:t,margin:i,colorCount:n,repetition:r,distortion:s}=this.config;this.#a=2*r-1;let l={size:this.size,n:e,margin:i,rotation:t,distortion:s};this.#l?this.#l.setConfig(l):this.#l=new f(l),this.#o=new a({...this.config,colorCount:n}),n&&(this.#c=this.#o.getColorMap({stepCount:this.getStepCount(),colorCount:n}))}*drawSpiral({shift:e=0,color:t="#ffffff"}={}){let{innerLength:i,n:n}=this.config,r=Math.round(i*n),s=0;this.renderer.setColor(t);let a=e,l=this.#l.getPoint(a),o=!1;for(let e=0;r>0;e++){if(this.#c){let t=this.#c.get(e);t&&this.renderer.setColor(t)}a=o?a-r+1:a+r,s===this.#a?(r--,s=0,a++):s++;let t=this.#l.getPoint(a);this.renderer.renderLines(l,t),l=t,yield,o=!o}}*generateStrings(){yield*this.drawSpiral({color:this.#o.getColor(0)})}getStepCount(){let{innerLength:e,repetition:t,n:i}=this.config;return Math.round(2*e*i*t)}drawNails(){this.#l.drawNails(this.nails)}static thumbnailConfig={n:60}}class b extends d{name="Spirals";id="spirals";link="https://www.etsy.com/il-en/listing/974865185/3d-string-art-spiral-mandala-wall?ref=shop_home_active_10&frs=1";controls=[{key:"radiusIncrease",label:"Radius change",defaultValue:5.7,type:"range",attr:{min:1,max:20,step:.1}},{key:"angleStep",label:"Angle step",defaultValue:.45,type:"range",attr:{min:0,max:1,step:.01}},{key:"nSpirals",label:"Number of spirals",defaultValue:3,type:"range",attr:{min:1,max:20,step:1}},{...f.rotationConfig,defaultValue:330/360},a.getConfig({defaults:{isMultiColor:!0,colorCount:4,color:"#00d5ff",multicolorRange:1,multicolorStart:190,multicolorByLightness:!0,minLightness:50,maxLightness:88,reverseColors:!0}})];calc;color;colorMap;getCalc(){let{nSpirals:e,rotation:t,margin:i,radiusIncrease:n,angleStep:r}=this.config,s=Math.min(...this.size)/2-i;return{spiralRotations:Array(e).fill(null).map((t,i)=>i*p/e),rotationAngle:-p*t,nailsPerSpiral:Math.floor(s/n),angleIncrease:r/(s/50)}}setUpDraw(){super.setUpDraw();let{colorCount:e}=this.config;this.calc=this.getCalc(),this.color=new a(this.config),this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:e})}*generatePoints(){let{nSpirals:e}=this.config;for(let t=0;t<this.calc.nailsPerSpiral;t++)for(let i=0;i<e;i++){let e=this.getPoint(i,t);yield{point:e,nailNumber:`${i}_${t}`}}}getPoint(e,t){let[i,n]=this.center,{radiusIncrease:r}=this.config,s=this.calc.rotationAngle+this.calc.angleIncrease*t+this.calc.spiralRotations[e],a=t*r;return[i+a*Math.sin(s),n+a*Math.cos(s)]}*generateStrings(){let e=this.generatePoints(),t=0;this.renderer.setColor(this.color.getColor(0));let i=this.center;for(let{point:n}of e){if(this.colorMap){let e=this.colorMap.get(t);e&&this.renderer.setColor(e)}i&&this.renderer.renderLines(i,n),i=n,t++,yield}}getStepCount(){let{nSpirals:e,radiusIncrease:t,margin:i}=this.config;return Math.floor((Math.min(...this.getSize())/2-i)/t)*e}drawNails(){for(let{point:e,nailNumber:t}of this.generatePoints())this.nails.addNail({point:e,number:t})}static thumbnailConfig={radiusIncrease:1.4,angleStep:.11}}class C extends d{name="Mandala";id="mandala";link="https://www.youtube.com/watch?v=qhbuKbxJsk8";linkText="Learn";controls=[{key:"n",label:"Number of nails",defaultValue:180,type:"range",attr:{min:3,max:240,step:1}},{key:"base",label:"Multiplication",defaultValue:2,type:"range",attr:{min:2,max:99,step:1}},{key:"layers",label:"Layers",defaultValue:7,type:"range",attr:{min:1,max:20,step:1}},f.rotationConfig,f.distortionConfig,a.getConfig({defaults:{isMultiColor:!0,multicolorRange:165,multicolorStart:256,color:"#ff4d00"},exclude:["colorCount"]})];circle;color;calc;get n(){return this.calc.n}getCalc(){let{n:e,layers:t,layerFill:i}=this.config,n=e-e%t;return{n:n,stringsPerLayer:i?Math.floor(n*i):n,layerShift:Math.floor(n/t)}}setUpDraw(){super.setUpDraw();let{layers:e,rotation:t,distortion:i,margin:n,layerFill:r,base:s,reverse:l}=this.config;this.calc=this.getCalc();let o={size:this.size,n:this.n,margin:n,rotation:t,distortion:i,reverse:l};this.circle?this.circle.setConfig(o):this.circle=new f(o),this.color=new a({...this.config,colorCount:e})}*drawTimesTable(e){let{reverse:t,base:i}=this.config,{n:n,layerShift:r,stringsPerLayer:s}=this.calc,a=r*e*(t?1:-1),l=this.color.getColor(e);this.renderer.setColor(l);let o=this.circle.getPoint(a);for(let e=1;e<=s;e++){let t=o;o=this.circle.getPoint(e+a);let r=e*i%n;this.renderer.renderLines(t,o,this.circle.getPoint(r+a)),yield}}*generateStrings(){let{layers:e}=this.config;for(let t=0;t<e;t++)yield*this.drawTimesTable(t)}drawNails(){this.circle.drawNails(this.nails)}getStepCount(){let{layers:e,layerFill:t}=this.config,{n:i}=this.getCalc();return(e??1)*(t?Math.floor(i*t):i)}static thumbnailConfig={n:70}}function S(e){return`${Math.round(100*e)}%`}class w extends C{id="wave";name="Wave";link="https://www.etsy.com/il-en/listing/943140543/personalized-gift-string-art-mandala?ref=sim_rv-5&pro=1";controls=[{...f.nailsConfig,defaultValue:200},{key:"layerFill",label:"Layer fill",defaultValue:.5,type:"range",attr:{min:({n:e})=>1/e,max:1,step:({n:e})=>1/e},displayValue:({layerFill:e})=>S(e)},{...f.rotationConfig,defaultValue:176/360},f.distortionConfig,{key:"layers",label:"Layers",defaultValue:11,type:"range",attr:{min:1,max:20,step:1}},{key:"layerSpread",label:"Layer spread",defaultValue:.075,type:"range",attr:{min:0,max:1,step:({n:e})=>1/e},displayValue:({layerSpread:e,n:t})=>Math.round(e*t)},{key:"reverse",label:"Reverse",defaultValue:!0,type:"checkbox"},a.getConfig({defaults:{isMultiColor:!0,multicolorRange:196,multicolorStart:273,color:"#ffffff",multicolorByLightness:!0,minLightness:10,maxLightness:90},exclude:["colorCount"]})];defaultValues={base:2};setUpDraw(){super.setUpDraw();let{n:e,layerSpread:t}=this.config;this.calc.layerShift=Math.round(e*t)}*generateStrings(){let{layers:e}=this.config;for(let t=0;t<e;t++)yield*this.drawTimesTable(t)}static thumbnailConfig={n:70}}const k=["left","bottom","right","top"],x=["left","bottom","right","top"],v={left:0,bottom:Math.PI/2,right:Math.PI,top:1.5*Math.PI};class M extends d{name="Eye";id="eye";link="https://www.etsy.com/listing/489853161/rose-of-space-string-art-sacred-geometry?ga_order=most_relevant&ga_search_type=all&ga_view_type=gallery&ga_search_query=string+art&ref=sr_gallery_1&epik=dj0yJnU9WXNpM1BDTnNkLVBtcWdCa3AxN1J5QUZRY1FlbkJ5Z18mcD0wJm49ZXdJb2JXZmVpNVVwN1NKQ3lXMy10ZyZ0PUFBQUFBR0ZuUzZv";controls=[{key:"n",label:"Number of nails per side",defaultValue:82,type:"range",attr:{min:2,max:200,step:1}},{key:"layers",label:"Layers",defaultValue:13,type:"range",attr:{min:1,max:20,step:1}},{key:"angle",label:"Layer angle",defaultValue:30,displayValue:({angle:e})=>`${e}\xb0`,type:"range",attr:{min:0,max:45,step:1}},a.getConfig({defaults:{isMultiColor:!0,color:"#ffffff",multicolorRange:107,multicolorStart:226,multicolorByLightness:!1,minLightness:40,maxLightness:50,colorCount:2},customControls:[{key:"colorPerLayer",label:"Color per layer",defaultValue:!1,type:"checkbox",show:({isMultiColor:e})=>e}],exclude:["colorCount","repeatColors"]})];defaultValues={nailsColor:"#000000"};#u;color;getCalc(){let{n:e,angle:t,layers:i,margin:n}=this.config,r=Math.min(...this.size)-2*n,s=r/(e-1),a=t*Math.PI/180,l=e=>{let t=r/Math.pow(Math.cos(a)+Math.sin(a),e),i=[this.center[0]-t/2,this.center[1]-t/2],n=Math.floor(t/s);return{layerAngle:a*e,layerSize:t,layerStart:i,layerStringCount:n}};return{maxSize:r,nailSpacing:s,layerAngle:a,layers:Array(i).fill(null).map((e,t)=>l(t))}}setUpDraw(){super.setUpDraw(),this.color=new a({...this.config,repeatColors:!0,colorCount:2}),this.#u=this.getCalc()}getPoint({index:e,angle:t,layerStart:i,rotation:n}){let r=t+n,s=[i[0],i[1]+this.#u.nailSpacing*e],a=this.center,l=Math.cos(r),o=Math.sin(r);return[l*(s[0]-a[0])-o*(s[1]-a[1])+a[0],o*(s[0]-a[0])+l*(s[1]-a[1])+a[1]]}*drawSide({side:e,color:t="#ffffff",angle:i,size:n,layerStart:r,layerStringCount:s}){let a=k.indexOf(e),l=k[a===k.length-1?0:a+1],o=v[e],c=v[l],u={layerStringCount:s,size:n,layerStart:r,angle:i};this.renderer.setColor(t);for(let e=0;e<=s;e++)this.renderer.renderLines(this.getPoint({index:e,rotation:o,...u}),this.getPoint({index:e,rotation:c,...u})),yield}*drawLayer(e){let{colorPerLayer:t}=this.config,{layerAngle:i,layerSize:n,layerStart:r,layerStringCount:s}=this.#u.layers[e];for(let a=0;a<k.length;a++)yield*this.drawSide({color:this.color.getColor(t?e:a),side:x[a],angle:i,size:n,layerStart:r,layerStringCount:s})}*generateStrings(){let{layers:e}=this.config;for(let t=e-1;t>=0;t--)yield*this.drawLayer(t)}getStepCount(){let e=0,{layers:t,angle:i,n:n,margin:r}=this.config,s=i*Math.PI/180,a=Math.min(...this.renderer.getSize())-2*r,l=a/(n-1);for(let i=0;i<t;i++)e+=4*(Math.floor(a/Math.pow(Math.cos(s)+Math.sin(s),i)/l)+1);return e}drawNails(){let{layers:e}=this.config;for(let t=e-1;t>=0;t--){let{layerAngle:e,layerSize:i,layerStart:n,layerStringCount:r}=this.#u.layers[t];for(let s=0;s<k.length;s++){let a=v[x[s]];for(let l=0;l<=r;l++){let o={layerStringCount:r,size:i,layerStart:n,angle:e};this.nails.addNail({point:this.getPoint({index:l,rotation:a,...o}),number:`${t}_${s}_${l}`})}}}}static thumbnailConfig={n:25,layers:7}}function L(e,t,i){if(e===t)return!0;if("object"==typeof e&&"object"==typeof t){if(null===e!=(null===t))return!1;if(e instanceof Array&&t instanceof Array){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!L(e[i],t[i]))return!1;return!0}if(!i&&(i=Object.keys(e)).length!==Object.keys(t).length||i&&i.some(i=>!L(e[i],t[i])))return!1}return e===t}class N{config;center;calc;constructor(e){this.setConfig(e)}static getCalc({radius:e,sides:t,sideNails:i,rotation:n,centerRadius:r=0,maxCurveSize:s=1}){let a=e*r,l=2*Math.PI/t,o=n?-(2*Math.PI)*n/t:0;return{sideAngle:l,nailSpacing:(e-a)/(i-1),centerRadius:a,linesPerRound:t%2?2*t:t,sidesConnectionCount:Math.floor(Math.min(1,s)*i),sideSize:e-a,sides:Array(t).fill(null).map((e,t)=>{let i=t*l+o;return{sinSideAngle:Math.sin(i),cosSideAngle:Math.cos(i)}})}}getPoint(e=0,t=0){let i=this.calc.centerRadius+t*this.calc.nailSpacing,{sinSideAngle:n,cosSideAngle:r}=this.calc.sides[e];return[this.center[0]+n*i,this.center[1]+r*i]}setConfig(e){if(L(e,this.config,["radius","sides","sideNails","rotation","center","size","centerRadius","maxCurveSize"]))return;let t=e.center??e.size.map(e=>e/2);this.config=e,this.center=t,this.calc=N.getCalc(e)}drawNails(e,{getNumber:t,reverseOrder:i,...n}={}){let{sides:r,sideNails:s}=this.config,a=[];for(let e=0;e<r;e++)for(let n=0;n<s;n++){let r=i?s-n:n;a.push({point:this.getPoint(e,r),number:t?t(e,r):r||this.config.centerRadius?`${e}_${r}`:0})}e.addGroup(a,n)}*generateStrings(e,{size:t}={}){let{sideNails:i,sides:n}=this.config,{sidesConnectionCount:r,linesPerRound:s}=this.calc,a=t?Math.max(1,Math.min(Math.floor(t),i)):i,l=Math.max(0,a-r),o=!1,c=n%2?Math.ceil(Math.min(a,r)/2):a-l,u=l,h=this.getPoint(0,u);for(let t=0;t<c;t++){let i=t===c-1,r=0;for(let c=0;c<s;c++){r=(r+1)%n,u=(o=!o)?a-t-1:t+l;let s=this.getPoint(r,u);if(e.renderLines(h,s),h=s,yield,i&&c===n-1&&n%2&&a%2)break}if(!i){u=o?u-1:u+1;let t=this.getPoint(0,u);e.renderLines(h,t),h=t}}}getStepCount(e){return N.getStepCount(this.config,{size:e})}static getStepCount({sides:e,sideNails:t,maxCurveSize:i=1},{size:n}={}){let r=Math.floor(Math.min(1,i)*t),s=n?Math.min(Math.floor(n),t):t,a=Math.max(0,s-r);return(e%2?Math.ceil(Math.min(s,r)/2):s-a)*(e%2?2*e:e)-(e%2&&s%2?e:0)}static nailsConfig=Object.freeze({key:"sideNails",label:"Nails per side",defaultValue:40,type:"range",attr:{min:1,max:200,step:1},isStructural:!0});static sidesConfig=Object.freeze({key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:40,step:1},isStructural:!0});static maxCurveSize={key:"maxCurveSize",label:"Max curve size",description:"The maximum number of connections used to create a curve between two sides.",defaultValue:1,type:"range",displayValue:({maxCurveSize:e,sideNails:t})=>Math.floor(e*t),attr:{min:0,max:1,step:({sideNails:e})=>1/e},isStructural:!0};static centerRadiusConfig={key:"centerRadius",label:"Center radius",defaultValue:0,type:"range",attr:{min:0,max:({sideNails:e})=>(e-1)/e,step:.01},displayValue:({centerRadius:e})=>S(e),isStructural:!0};static rotationConfig={key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01,snap:"0.5"},displayValue:({rotation:e})=>`${Math.round(360*e)}\xb0`,isStructural:!0,affectsStepCount:!1};static StarConfig=[N.nailsConfig,N.sidesConfig,N.centerRadiusConfig,N.maxCurveSize,N.rotationConfig]}class V extends d{name="Star";id="star";link="https://www.etsy.com/listing/557818258/string-art-meditation-geometric-yoga?epik=dj0yJnU9Mm1hYmZKdks1eTc3bVY2TkVhS2p2Qlg0N2dyVWJxaTEmcD0wJm49MGlWSXE1SVJ2Vm0xZ0xtaGhITDBWQSZ0PUFBQUFBR0Zwd2lj";controls=[{key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:20,step:1}},{key:"sideNails",label:"Nails per side",defaultValue:40,type:"range",attr:{min:1,max:200,step:1}},N.centerRadiusConfig,{key:"ringSize",label:"Outer ring size",defaultValue:.1,type:"range",attr:{min:0,max:.5,step:({sideNails:e,sides:t})=>1/(e*t)},displayValue:({sideNails:e,sides:t,ringSize:i})=>Math.floor(i*e*t)},function(e,t){let i=e.attr;if(!i)return e;let n={...i};return delete n[t],{...e,attr:n}}(f.rotationConfig,"snap"),f.distortionConfig,{key:"colorGroup",label:"Color",type:"group",children:[{key:"innerColor",label:"Star color",defaultValue:"#2ec0ff",type:"color"},{key:"outerColor",label:"Outter color",defaultValue:"#2a82c6",type:"color"},{key:"ringColor",label:"Ring color",defaultValue:"#2ec0ff",type:"color"}]}];#h=null;#l;setUpDraw(){super.setUpDraw();let{sides:e,rotation:t,distortion:i,sideNails:n,margin:r=0}=this.config,s={size:this.size,n:n*e,margin:r,rotation:t?t/e:0,distortion:i};this.#l?this.#l.setConfig(s):this.#l=new f(s);let a={...this.config,radius:this.#l.radius,size:this.size};this.#h?this.#h.setConfig(a):this.#h=new N(a)}getArcPoint({side:e,sideIndex:t}){return this.#l.getPoint(e*this.config.sideNails+t)}*drawStar(){let{innerColor:e}=this.config;this.renderer.setColor(e),yield*this.#h.generateStrings(this.renderer)}*drawCircle(){let{outerColor:e,sides:t,sideNails:i}=this.config;this.renderer.setColor(e);let n=this.#h.getPoint(0,0),r=!1,s=!1,a=t%2?Math.ceil(i/2):i,l=0,o=t%2?4*t:2*t;for(let e=0;e<=a;e++){let c=o-(e===a?2*t:0);for(let a=0;a<c;a++){let a={side:l,sideIndex:r?i-e-1:e},o=s?this.#h.getPoint(a.side,a.sideIndex):this.getArcPoint(a);this.renderer.renderLines(n,o),n=o,yield,(s=!s)&&(l=l!==t-1?l+1:0,r=!r)}n=this.#h.getPoint(0,e+1)}}*generateStrings(){yield*this.drawCircle();let{ringSize:e,ringColor:t}=this.config;0!==e&&(yield*this.#l.drawRing(this.renderer,{ringSize:e,color:t})),yield*this.drawStar()}drawNails(){this.#l.drawNails(this.nails),this.#h.drawNails(this.nails),this.#l.drawNails(this.nails)}#d(){let{sides:e,sideNails:t}=this.config;return((e%2?Math.ceil(t/2):t)+1)*(e%2?4*e:2*e)-2*e}getStepCount(){let{sides:e,sideNails:t,ringSize:i}=this.config;return this.#d()+(i?t*e:0)+N.getStepCount(this.config)}static thumbnailConfig={sideNails:18}}const z=[{size:.25,end:1,color:"#a94fb0"},{size:.125,end:.888,color:"#ec6ad0"},{size:0,end:.826,color:"#f08ad5",reverse:!0}];class R extends d{name="Assymetry";id="assymetry";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[f.nailsConfig,f.rotationConfig,f.distortionConfig,{key:"layers",label:"Layers",type:"group",children:z.map(({size:e,end:t,color:i,reverse:n},r)=>{let s=r+1;return{key:`layer${s}`,label:`Layer ${s}`,type:"group",children:[{key:`show${s}`,label:"Enable",defaultValue:!0,type:"checkbox"},{key:`size${s}`,label:"Size",defaultValue:e,type:"range",attr:{min:0,max:.5,step:({n:e})=>1/e},displayValue:e=>Math.round(e.n*e[`size${s}`]),show:e=>e[`show${s}`]},{key:`end${s}`,label:"End Position",defaultValue:t,type:"range",attr:{min:0,max:1,step:({n:e})=>1/e},displayValue:e=>Math.round(e.n*e[`end${s}`]),show:e=>e[`show${s}`]},{key:`color${s}`,label:"Color",defaultValue:i,type:"color",show:e=>e[`show${s}`]},{key:`reverse${s}`,label:"Reverse",defaultValue:!0===n,type:"checkbox",show:e=>e[`show${s}`]}]}})}];#l;#u;setUpDraw(){super.setUpDraw(),this.#u=this.#g()}#g(){let e,{rotation:t,n:i,margin:n=0,distortion:r}=this.config,s={size:this.getSize(),n:i,margin:n,rotation:t-.25,distortion:r};this.#u?.circle?(e=this.#u.circle,this.#u.circle.setConfig(s)):e=new f(s);let a=e.indexAngle*e.radius,l=Math.floor(e.radius/a)-1;a+=(e.radius-a*l)/l;let o=e.getPoint(0),c=l+i;return{circle:e,lineSpacing:a,lineNailCount:l,firstCirclePoint:o,layers:[,,,].fill(null).map((e,t)=>u.call(this,t+1)).filter(({enable:e})=>e),totalNailCount:c,totalIndexCount:c+l};function u(e){let t=Math.round(i*this.config["size"+e])+l;return{size:t,endIndex:Math.round(this.config["end"+e]*(c+l))-t,color:this.config["color"+e],enable:this.config["show"+e],isReverse:this.config["reverse"+e]}}}getPoint(e){if(e<this.#u.lineNailCount||e>this.#u.totalNailCount){let t=(e<this.#u.lineNailCount?this.#u.lineNailCount-e:e-this.#u.totalNailCount)*this.#u.lineSpacing;return[this.#u.firstCirclePoint[0]-t*Math.sin(this.#u.circle.rotationAngle),this.#u.firstCirclePoint[1]-t*Math.cos(this.#u.circle.rotationAngle)]}{let t=e-this.#u.lineNailCount;return this.#u.circle.getPoint(t)}}*drawCircle({endIndex:e,color:t,isReverse:i,size:n}){let r,s,a=!1;this.renderer.setColor(t);let l=this,o=i?-1:1;for(let t=0;t<=e;t++){let e=r??this.getPoint(c(t)),i=[];r&&i.push(this.getPoint(s+o)),s=c(a?t:t+n),i.push(r=this.getPoint(s)),this.renderer.renderLines(e,...i),yield,a=!a}function c(e){return i?l.#u.totalIndexCount-e:e}}*generateStrings(){for(let e of this.#u.layers)yield*this.drawCircle(e)}drawNails(){this.#u.circle.drawNails(this.nails,{nailsNumberStart:this.#u.lineNailCount});for(let e=0;e<this.#u.lineNailCount;e++)this.nails.addNail({point:this.getPoint(e),number:e})}getStepCount(){let{layers:e}=this.#g();return e.reduce((e,t)=>e+t.endIndex+1,0)}static thumbnailConfig={n:50}}const E={label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1+1/360,step:1/360},isStructural:!0,affectsStepCount:!1};class P extends d{name="Freestyle";id="freestyle";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[{key:"n",label:"Circle nails",defaultValue:80,type:"range",attr:{min:1,max:300,step:1}},{key:"minNailDistance",label:"Min nail distance",defaultValue:20,type:"range",attr:{min:1,max:300,step:1}},{key:"color",label:"Color",defaultValue:"#ec6ad0",type:"color"},{key:"layers",label:"Layers",type:"group",children:[{key:"layer1",label:"Layer 1",type:"group",children:[{key:"show1",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius1",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show1:e})=>e},{key:"x1",label:"Position X",defaultValue:.5,type:"range",attr:{min:0,max:1,step:.01},show:({show1:e})=>e},{key:"y1",label:"Position Y",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01},show:({show1:e})=>e},{...E,key:"rotation1",show:({show1:e})=>e,displayValue:({rotation1:e})=>`${Math.round(360*e)}\xb0`},{key:"reverse1",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show1:e})=>e}]},{key:"layer2",label:"Layer 2",type:"group",children:[{key:"show2",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius2",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show2:e})=>e},{key:"x2",label:"Position X",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01},show:({show2:e})=>e},{key:"y2",label:"Position Y",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show2:e})=>e},{...E,key:"rotation2",show:({show2:e})=>e,displayValue:({rotation2:e})=>`${Math.round(360*e)}\xb0`},{key:"reverse2",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show2:e})=>e}]},{key:"layer3",label:"Layer 3",type:"group",children:[{key:"show3",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius3",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show3:e})=>e},{key:"x3",label:"Position X",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show3:e})=>e},{key:"y3",label:"Position Y",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show3:e})=>e},{...E,key:"rotation3",show:({show3:e})=>e,displayValue:({rotation3:e})=>`${Math.round(360*e)}\xb0`},{key:"reverse3",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show3:e})=>e}]}]}];#u;setUpDraw(){super.setUpDraw(),this.#u=this.getCalc()}getCalc(){let{n:e,margin:t=0,minNailDistance:i}=this.config,n=this.getSize(),r=Math.min(...n.map(e=>e-2*t))/2,s=[,,,].fill(null).map((e,t)=>l.call(this,t+1)).filter(({enable:e})=>e),a=Math.max(...s.map(({circle:e})=>e.config.n));return{layers:s,maxShapeNailsCount:a};function l(s){let a=e=>this.config[e+s],l={enable:a("show"),isReverse:a("reverse"),position:[a("x"),a("y")],radius:r*a("radius"),rotation:a("rotation")},o=Math.min(e,Math.floor(2*Math.PI*l.radius/i));return{circle:new f({radius:l.radius,size:this.size,center:l.position.map((e,i)=>l.radius+t+(n[i]-(l.radius+t)*2)*e),n:o,rotation:l.rotation,reverse:l.isReverse}),...l}}}getPoint(e,t){let{circle:i}=e,n=Math.round(t*i.config.n/this.#u.maxShapeNailsCount);return i.getPoint(n)}*generateStrings(){let e,{color:t}=this.config;this.renderer.setColor(t);for(let t=0;t<this.#u.maxShapeNailsCount;t++)for(let i=0;i<this.#u.layers.length;i++){let n=this.#u.layers[i],r=e??this.getPoint(n,t),s=[];0===i&&t&&s.push(this.getPoint(n,t));let a=i+1;a===this.#u.layers.length&&(a=0),e=this.getPoint(this.#u.layers[a],t),this.renderer.renderLines(r,e),yield}}drawNails(){this.#u.layers.forEach(({circle:e},t)=>e.drawNails(this.nails,{getNumber:e=>`${t+1}_${e+1}`}))}getStepCount(){let{layers:e,maxShapeNailsCount:t}=this.getCalc();return e.length*t-1}static thumbnailConfig={minNailDistance:3}}class A{config;#p;#u;constructor(e){this.setConfig(e)}setConfig(e){if(!L(e,this.config)&&(this.config=e,this.#p?this.#p.clear():this.#p=new Map,this.#u=this.#g(),e.fitSize)){let e=this.#f();this.#p.clear(),this.#u={...this.#g(),...e}}}#f(){let{size:e,margin:t}=this.config,i=this.getBoundingRect(),n=Math.min((e[0]-2*t)/i.width,(e[1]-2*t)/i.height);return{size:e.map(e=>e*n),center:[this.#u.center[0]-n*(i.left-e[0]+i.right)/2,this.#u.center[1]-n*(i.top-e[1]+i.bottom)/2]}}#g(){let{size:e,rotation:t=0,sides:i,center:n,margin:r,nailsSpacing:s}=this.config,a=p/i,l=Array(i).fill(null).map((e,i)=>{let n=a*i+p*t,r=-a*(i-.5)-p*t;return{cos:Math.cos(n),sin:Math.sin(n),center:{cos:Math.cos(r),sin:Math.sin(r)}}}),o=n??this.config.size.map(e=>e/2),c=Math.min(...e)/2-r,u=2*c*Math.sin(a/2),h=[c*Math.sin(a/2),c*Math.cos(a/2)],d=u*s,g=Math.floor(c/d);return{nailsPerSide:1/s,center:o,radius:c,sideSize:u,start:h,nailsDistance:d,radiusNailsCount:g,radiusNailsDistance:c/g,sides:l,sideAngle:a}}get nailsPerSide(){return this.#u.nailsPerSide}get radiusNailsCount(){return this.#u.radiusNailsCount}get sideSize(){return this.#u.sideSize}getSidePoint({side:e,index:t}){let i=[e,t].join("_");if(this.#p.has(i))return this.#p.get(i);let n=this.#u.start[0]-t*this.#u.nailsDistance,{cos:r,sin:s}=this.#u.sides[e],a=[r*n-s*this.#u.start[1]+this.#u.center[0],s*n+r*this.#u.start[1]+this.#u.center[1]];return this.#p.set(i,a),a}getCenterPoint({side:e,index:t}){let i=t*this.#u.radiusNailsDistance,{sin:n,cos:r}=this.#u.sides[e].center;return[this.#u.center[0]+n*i,this.#u.center[1]+r*i]}getBoundingRect(){let e=this.#u.sides.map((e,t)=>this.getSidePoint({side:t,index:0})),t=e[0],i=e.slice(1).reduce((e,[t,i])=>({left:Math.min(e.left,t),right:Math.max(e.right,t),top:Math.min(e.top,i),bottom:Math.max(e.bottom,i)}),{left:t[0],right:t[0],top:t[1],bottom:t[1]});return{...i,height:i.bottom-i.top,width:i.right-i.left}}drawNails(e,{drawCenter:t=!1,drawSides:i=!0,filterCenterNails:n}){for(let r=0;r<this.config.sides;r++){let s=r*this.#u.nailsPerSide;if(i)for(let t=0;t<this.#u.nailsPerSide;t++)e.addNail({point:this.getSidePoint({side:r,index:t}),number:s+t});if(t)for(let t=0;t<this.#u.radiusNailsCount;t++)(!n||n(r,t))&&e.addNail({point:this.getCenterPoint({side:r,index:t}),number:`${r}_${t}`})}}static rotationConfig={key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1,step:.02},displayValue:({rotation:e,sides:t})=>`${Math.round(180*e/t)}\xb0`,isStructural:!0,affectsStepCount:!1}}const I=a.getConfig({defaults:{isMultiColor:!0,color:"#ff0000",multicolorRange:1,multicolorStart:0,multicolorByLightness:!0,minLightness:20,maxLightness:50},exclude:["colorCount"]});class T extends d{name="Polygon";id="polygon";controls=[{key:"sides",label:"Sides",defaultValue:5,type:"range",attr:{min:3,max:10,step:1}},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:1,max:100,step:1}},{key:"bezier",label:"Bezier",defaultValue:2,type:"range",attr:{min:1,max:4,step:1},show:({sides:e})=>e>4},A.rotationConfig,I];defaultValues={nailsColor:"#5c5c5c",nailRadius:1};#m;color;colorMap;setUpDraw(){super.setUpDraw();let{n:e,rotation:t,sides:i,margin:n,isMultiColor:r}=this.config,s={sides:i,rotation:t/(2*i),margin:n,size:this.getSize(),nailsSpacing:1/e,fitSize:!0};this.#m?this.#m.setConfig(s):this.#m=new A(s),this.color=new a({...this.config,isMultiColor:r,colorCount:i}),r?this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:i}):this.colorMap=null}*generateStrings(){let{sides:e,bezier:t}=this.config,i=Math.min(t,Math.ceil(e/2)-1),n=0;this.renderer.setColor(this.color.getColor(0));for(let t=0;t<e;t++){let r=(t+i)%e;this.colorMap&&this.renderer.setColor(this.colorMap.get(n));for(let e=0;e<this.#m.nailsPerSide;e++)this.renderer.renderLines(this.#m.getSidePoint({side:t,index:e}),this.#m.getSidePoint({side:r,index:e})),yield,n++}}getStepCount(){let{sides:e,n:t}=this.config;return e*t}drawNails(){this.#m.drawNails(this.nails)}static thumbnailConfig={n:20}}const D=a.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:132,multicolorStart:53,multicolorByLightness:!1,minLightness:30,maxLightness:70},exclude:["colorCount"]});class _ extends d{name="Flower";id="flower";link="https://www.sqrt.ch/Buch/fadenmodell4_100.svg";controls=[{key:"sides",label:"Sides",defaultValue:4,type:"range",attr:{min:3,max:10,step:1}},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:1,max:100,step:1}},{key:"layers",label:"Layers",defaultValue:2,type:"range",attr:{min:1,max:10,step:1}},A.rotationConfig,D];defaultValues={nailsColor:"#29f1ff",nailRadius:1,stringWidth:.5};#y;color;colorMap;setUpDraw(){super.setUpDraw();let{n:e,rotation:t,sides:i,layers:n,margin:r,isMultiColor:s}=this.config,l=this.getSize(),o=1/(i*n);this.#y=Array(n).fill(null).map((n,s)=>new A({sides:i,rotation:t/i+s*o,margin:r,size:l,nailsSpacing:1/e})),this.color=new a({...this.config,isMultiColor:s,colorCount:n}),s?this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:n}):this.colorMap=null}*generateStrings(){let{sides:e,layers:t}=this.config,i=0;this.renderer.setColor(this.color.getColor(0));for(let n=0;n<t;n++){let t=this.#y[n];for(let n=0;n<e;n++){let r=n===e-1?0:n+1;for(let e=0;e<=t.nailsPerSide;e++){this.colorMap?.has(i)&&this.renderer.setColor(this.colorMap.get(i));let s=this.getCenterIndexes({polygon:t,sideIndex:e});this.renderer.renderLines(t.getCenterPoint({side:n,index:s[0]}),t.getSidePoint({side:n,index:e}),t.getCenterPoint({side:r,index:s[1]})),yield,i++}}}}getCenterIndexes({polygon:e,sideIndex:t}){let i=e.nailsPerSide-e.radiusNailsCount;return[t<i?-i+t:t-i,e.radiusNailsCount-t]}getStepCount(){let{sides:e,n:t,layers:i}=this.config;return e*(t+1)*i}drawNails(){let e=this.#y[0].radiusNailsCount-this.#y[0].nailsPerSide,t=e>0?(t,i)=>i>=e:null;this.#y.forEach(e=>e.drawNails(this.nails,{drawCenter:!0,filterCenterNails:t}))}static thumbnailConfig={n:20}}const F=a.getConfig({defaults:{isMultiColor:!0,color:"#ffffff",multicolorRange:102,multicolorStart:239,multicolorByLightness:!1,minLightness:30,maxLightness:70,colorCount:4},exclude:["repeatColors","mirrorColors"]});class $ extends d{name="Maurer Rose";id="maurer_rose";link="https://blog.glitch.land/en/posts/maurer-rose/";linkText="Learn";controls=[{key:"n",label:"N",defaultValue:4,type:"range",attr:{min:1,max:12,step:1},isStructural:!0},{key:"maxSteps",label:"Max steps",defaultValue:512,type:"range",attr:{min:3,max:720,step:1},isStructural:!0},{key:"angle",label:"Angle",defaultValue:341,type:"range",attr:{min:1,max:720,step:1},displayValue:({angle:e})=>`${e}\xb0`,isStructural:!0},f.rotationConfig,F];calc;points;color;colorMap;resetStructure(){super.resetStructure(),this.points&&this.points.clear(),this.calc=null}setUpDraw(){super.setUpDraw();let{isMultiColor:e,colorCount:t}=this.config;this.calc||(this.calc=this.getCalc()),this.points||(this.points=new Map),this.stepCount||(this.stepCount=this.getStepCount()),this.color=new a({...this.config,isMultiColor:e,colorCount:t}),e?this.colorMap=this.color.getColorMap({stepCount:this.stepCount,colorCount:t}):this.colorMap=null}getCalc(){let{angle:e,rotation:t,maxSteps:i}=this.config,n=this.getSize();return{angleRadians:p*e/i,radius:Math.min(...n)/2,currentSize:n,rotationAngle:-(2*Math.PI)*t}}getPoint(e){let{rotationAngle:t,angleRadians:i,radius:n}=this.calc;if(this.points.has(e))return this.points.get(e);let r=e*i,s=n*Math.sin(this.config.n*r),a=[this.center[0]-s*Math.cos(r-t),this.center[1]-s*Math.sin(r-t)];return this.points.set(e,a),a}*generatePoints(){let e=this.stepCount;for(let t=0;t<e+1;t++)yield{point:this.getPoint(t),index:t}}*generateStrings(){let e,t=this.generatePoints();for(let{point:i,index:n}of(this.renderer.setColor(this.color.getColor(0)),t)){if(!e){e=i;continue}if(this.colorMap){let e=this.colorMap.get(n);e&&this.renderer.setColor(e)}this.renderer.renderLines(e,i),e=i,yield}}getStepCount(){if(this.stepCount)return this.stepCount;let{maxSteps:e,angle:t,n:i}=this.config,n=function e(t,i){return i?e(i,t%i):t}(e,t),r=e/n;return!(r%2)&&i%2&&(r/=2),Math.round(r)}drawNails(){for(let{point:e,index:t}of this.generatePoints())this.nails.addNail({point:e,number:t})}static thumbnailConfig={maxSteps:160,angle:213}}const B=a.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:30,multicolorStart:25,multicolorByLightness:!0,minLightness:40,maxLightness:95,colorCount:3,repeatColors:!0,saturation:83,reverseColors:!0},customControls:[{key:"colorPerLevel",label:"Color per level",defaultValue:!0,type:"checkbox"}]}),O=-p/6,G=Array(6).fill(null).map((e,t)=>Math.PI/2+O*t),q={evenly:{f:(e,{ringSize:t,layers:i,n:n})=>Math.floor((i-e)*Math.floor(n*t)/i),name:"Evenly"},distance:{f:(e,{n:t,ringSize:i,layerDistance:n})=>{let r=Math.floor(t*i);return e>0?r-e*n:r},name:"Specific distance"}},U=a.getConfig({defaults:{isMultiColor:!0,color:"#ff0000",multicolorRange:133,multicolorStart:239,multicolorByLightness:!1,minLightness:30,maxLightness:70,colorCount:4},customControls:[{key:"colorPerLayer",label:"Color per layer",defaultValue:!0,type:"checkbox"}]});class j extends d{name="Comet";id="comet";controls=[f.nailsConfig,{key:"layers",label:"Layers",defaultValue:5,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},{key:"ringSize",label:"First layer size",description:"Nail count from the top center nail to the first connected nail in the first layer",defaultValue:.3,type:"range",attr:{min:0,max:1,step:.01},displayValue:({ringSize:e,n:t})=>Math.floor(t*e),isStructural:!0},{key:"layerSpread",label:"Layer Spread",type:"select",defaultValue:"distance",options:Object.entries(q).map(([e,{name:t}])=>({value:e,label:t})),isStructural:!0},{key:"layerDistance",label:"Layer Distance",type:"range",attr:{min:1,max:({n:e,layers:t})=>Math.floor(e/2/t),step:1},defaultValue:1,isStructural:!0,show:({layerSpread:e})=>"evenly"!==e},f.rotationConfig,f.distortionConfig,f.displacementConfig,U];defaultValues={n:51,layers:11,colorPerLayer:!0,multicolorRange:203,multicolorStart:137,ringSize:.47,rotation:.25,distortion:.38,displacementFunc:"fastInOut",displacementMag:1.8,displacementFastArea:.43,layerSpread:"distance",layerDistance:1};#l;color;setUpDraw(){super.setUpDraw();let e={size:this.size,n:this.config.n,margin:this.config.margin,rotation:this.config.rotation,distortion:this.config.distortion,displacementFunc:this.config.displacementFunc,displacementMag:this.config.displacementMag,displacementFastArea:this.config.displacementFastArea};this.#l?this.#l.setConfig(e):this.#l=new f(e),this.stepCount||(this.stepCount=this.getStepCount());let{isMultiColor:t,colorCount:i,layers:n,colorPerLayer:r}=this.config,s=t?r?n:Math.min(i,n):1;this.color=new a({...this.config,isMultiColor:t,colorCount:s})}getLayerRingDistance(e){let t=q[this.config.layerSpread];if(!t)throw Error(`Invalid spread mode, "${this.config.layerSpread}"!`);return t.f(e,this.config)}getLayerRingStepCount(e){let t=this.getLayerRingDistance(e);return(this.config.n-t+1)*2-1}*drawLayer(e=0){let{n:t}=this.config,i=this.getLayerRingDistance(e),n=t-i+1,r=this.#l.getPoint(0),s=0;this.renderer.setColor(this.color.getColor(e));for(let e=0;e<t-i+1;e++){let t=e+i,a=this.#l.getPoint(t);this.renderer.renderLines(r,a),yield,e!==n-1&&(s=e+1,r=this.#l.getPoint(s),this.renderer.renderLines(a,r),yield)}}*generateStrings(){for(let e=0;e<this.config.layers;e++)yield*this.drawLayer(e)}getStepCount(){if(this.stepCount)return this.stepCount;let{layers:e}=this.config;return Array(e).fill(0).reduce((e,t,i)=>e+this.getLayerRingStepCount(i),0)}drawNails(){this.#l.drawNails(this.nails)}static thumbnailConfig={n:24,layers:8}}class H extends d{name="Sun";id="sun";controls=[{key:"starGroup",label:"Star",type:"group",children:[...r([...N.StarConfig,a.getConfig({defaults:{isMultiColor:!0,multicolorRange:1,multicolorStart:237,color:"#ffffff",saturation:40,multicolorByLightness:!0,minLightness:20,maxLightness:97},exclude:["colorCount"]})],"sides",[{key:"layers",label:"Layers",defaultValue:4,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},{key:"layerSpread",label:"Layer spread",defaultValue:.1625,type:"range",displayValue:({layerSpread:e})=>S(e),attr:{min:.01,max:1,step:.02},show:({layers:e})=>1!==e,isStructural:!0},{key:"starRadius",label:"Star Radius",defaultValue:1,type:"range",displayValue:({starRadius:e})=>S(e),attr:{min:.2,max:1,step:.01},isStructural:!0,affectsStepCount:!1}])]},{key:"backdrop",label:"Backdrop",type:"group",children:[{key:"backdropSize",label:"Backdrop size",defaultValue:.5,type:"range",displayValue:({backdropSize:e})=>S(e),attr:{min:0,max:1,step:({sideNails:e})=>1/e},isStructural:!0},{key:"backdropRadius",label:"Backdrop radius",defaultValue:1,type:"range",displayValue:({backdropRadius:e})=>S(e),attr:{min:0,max:1,step:.01},isStructural:!0,affectsStepCount:!1},{key:"backdropShift",label:"Backdrop shift",defaultValue:0,type:"range",displayValue:({backdropShift:e})=>S(e),attr:{min:0,max:1,step:({sideNails:e,backdropSize:t})=>(1/(e*(1-t))).toFixed(3)},isStructural:!0,affectsStepCount:!1},{key:"backdropSkip",label:"Backdrop skip",description:"If yes, connections in the backdrop are from the backdrop's nail to the second-nearest side, not the ones near it",defaultValue:!1,type:"checkbox",isStructural:!0,affectsStepCount:!1,show:({sides:e})=>e>3},a.getConfig({defaults:{isMultiColor:!0,multicolorRange:20,multicolorStart:0,color:"#ffffff",saturation:57,multicolorByLightness:!0,minLightness:20,maxLightness:40},propMapper:({key:e,show:t})=>{e[0].toUpperCase(),e.slice(1);let i={key:"backdrop"+e[0].toUpperCase()+e.slice(1),show:t?({backdropIsMultiColor:t})=>"color"===e?!t:t:null};return"multicolorRange"===e&&(i.attr={start:({backdropMulticolorStart:e})=>e,type:"range"}),i},groupLabel:"Backdrop color",maxColorCount:2})]}];getCommonControls(){return r(super.getCommonControls(),"nailsColor",[{key:"backdropNailsColor",label:"Backdrop nails color",type:"color",defaultValue:"#ffffff",show:({showNails:e})=>e},{key:"backdropNailsRadius",label:"Backdrop nails radius",type:"range",defaultValue:1.5,attr:{min:.5,max:5,step:.25},show:({showNails:e})=>e}])}#l=null;#h=null;#u;#o;#b;defaultValues={sideNails:50,sides:16,layers:4,layerSpread:.77,backdropSize:.26,backdropRadius:.9,backdropShift:.59,backdropColorCount:2,centerRadius:.2,maxCurveSize:.64,rotation:.5,saturation:73,multicolorStart:206,multicolorRange:1,multicolorByLightness:!0,minLightness:35,maxLightness:100,nailsColor:"#000000",backdropNailsColor:"#ffffff",backdropNailsRadius:2.275};getCalc(){let{sideNails:e,backdropSize:t,layers:i}=this.config;return{backdropNails:Math.floor(e*t)}}resetStructure(){super.resetStructure(),this.#u=null}setUpDraw(){super.setUpDraw();let{margin:e=0,layers:t,backdropRadius:i=1,backdropSize:n,rotation:r,sides:s,starRadius:l=1,backdropColorCount:o}=this.config,c=Math.min(...this.size.map(e=>e/2))-e;this.#u||(this.#u=this.getCalc());let u={...this.config,radius:n&&l<i?c*l/i:c,size:this.size};this.#h?this.#h.setConfig(u):this.#h=new N(u),this.#o=new a({...this.config,colorCount:t}),this.#b=new a({...function(e,t){let i={};return Object.entries(e).forEach(([e,n])=>i[t(e,n)]=n),i}(this.config,e=>{let t=e.match(/^backdrop(\w)(.+)/);return t?t[1].toLowerCase()+t[2]:e}),colorCount:o});let h={size:this.size,n:s,rotation:-1/s/2+(r?r/s:0),radius:i<l?c*i/l:c};this.#l?this.#l.setConfig(h):this.#l=new f(h)}*drawStar(e){yield*this.#h.generateStrings(this.renderer,{size:e})}*generateLayers(){let{sideNails:e,layerSpread:t,layers:i}=this.config;for(let e=0;e<i;e++){let t=this.#o.getColor(e);this.renderer.setColor(t);let i=this.#C(e);yield*this.drawStar(i)}}*drawBackdrop(){let e,{backdropNails:t}=this.#u,{sides:i,backdropShift:n,sideNails:r,backdropSkip:s}=this.config,a=s&&i>3,l=0,o=Math.floor(n*(r-t))+t-1;for(let n=0;n<i;n++){this.renderer.setColor(this.#b.getColor(n%2?0:1));let r=this.#l.getPoint(a?(n+1)%i:n),s=!1,c=n%2?1:-1;e=this.#h.getPoint(n,o);for(let u=0;u<t;u++)if(this.renderer.renderLines(e,r),yield,l=(s?n:n+(a?3:1))%i,e=this.#h.getPoint(l,o),this.renderer.renderLines(r,e),yield,u<t-1){s=!s,o+=c;let t=this.#h.getPoint(l,o);this.renderer.renderLines(e,t),e=t}}}*generateStrings(){yield*this.drawBackdrop(),yield*this.generateLayers()}drawNails(){let{backdropSize:e,backdropNailsColor:t,backdropNailsRadius:i}=this.config;if(this.#h.drawNails(this.nails),e){let e=[];for(let t of this.#l.generateNails())e.push(t);this.nails.addGroup(e,{color:t,radius:i})}}#C(e){let{layers:t,layerSpread:i,sideNails:n}=this.config;return Math.max(1,n-e*Math.max(1,Math.floor(n/t*i)))}getStepCount(){let{layers:e,sides:t}=this.config,{backdropNails:i}=this.getCalc(),n=t*i*2;for(let t=0;t<e;t++){let e=this.#C(t);n+=N.getStepCount(this.config,{size:e})}return n}static thumbnailConfig={sideNails:10,backdropNailsRadius:.5}}const W=[V,R,C,y,b,w,M,P,T,_,$,class extends d{name="Flower of Life";id="flower_of_life";link="https://www.reddit.com/r/psychedelicartwork/comments/mk97gi/rainbow_flower_of_life_uv_reactive_string_art/";controls=[{key:"levels",label:"Levels",defaultValue:3,type:"range",attr:{min:1,max:10,step:1},isStructural:!0},{key:"density",label:"Density",defaultValue:10,type:"range",attr:{min:1,max:50,step:1},isStructural:!0},{key:"globalRotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:30,step:1},displayValue:({globalRotation:e})=>`${e}\xb0`,isStructural:!0,affectsStepCount:!1},{key:"fillGroup",label:"Fill",type:"group",children:[{key:"fill",label:"Show fill",defaultValue:!0,type:"checkbox",isStructural:!0},{key:"fillColor",label:"Fill color",defaultValue:"#292e29",type:"color",show:({fill:e})=>e}]},{key:"ringGroup",label:"Ring",type:"group",children:[{key:"renderRing",label:"Show outer ring",type:"checkbox",defaultValue:!0,isStructural:!0},{key:"ringNailCount",label:"Ring nail count",defaultValue:144,type:"range",attr:{min:3,max:360,step:1},show:({renderRing:e})=>e,isStructural:!0},{key:"ringSize",label:"Outer ring size",defaultValue:.23,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:e})=>e,displayValue:({ringSize:e})=>S(e),isStructural:!0},{key:"ringPadding",label:"Ring padding",defaultValue:.06,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:e})=>e,isStructural:!0,displayValue:({ringPadding:e})=>S(e)},{key:"ringColor",label:"Ring color",defaultValue:"#e8b564",type:"color",show:({renderRing:e})=>e}]},{key:"renderTriangles",label:"Show triangles",defaultValue:!0,type:"checkbox",isStructural:!0},{key:"renderCaps",label:"Show caps",defaultValue:!0,type:"checkbox",show:({renderTriangles:e})=>e,isStructural:!0},B];defaultValues={nailsColor:"#474747"};#u;points;color;colorMap;#l;getCalc(){let{levels:e,density:t,margin:i,globalRotation:n,renderCaps:r,renderRing:s,ringNailCount:a,ringSize:l,ringPadding:o}=this.config,c=n*Math.PI/180+Math.PI/6,u=s?Math.min(...(this.size??this.getSize()).map(e=>e/2-i)):null,h=s?Math.floor(l*a/2):0,d=s?u*(1-Math.cos(h/a*p/2)):0,g=new A({sides:6,size:this.getSize(),margin:i+d+(s&&l?o*u:0),rotation:c,fitSize:!1,nailsSpacing:2}).sideSize/e,f=g/(2*Math.cos(Math.PI/6)),m=Array(e+ +!!r).fill(null).map((e,t)=>2*t+1);return{edgeSize:g,triangleHeight:g*Math.sqrt(3)/2,nailsLength:f,triangleCenterDistance:g/2,nailDistance:f/t,triangleCount:6*e**2,countPerLevelSide:m,globalRotationRadians:c,radius:u}}resetStructure(){super.resetStructure(),this.points=null,this.#u=null}setUpDraw(){super.setUpDraw();let{isMultiColor:e,levels:t,colorPerLevel:i,colorCount:n,renderRing:r,ringSize:s,ringNailCount:l,...o}=this.config;if(this.#u||(this.#u=this.getCalc()),r&&s){let e={size:this.size,n:l,margin:o.margin,rotation:o.globalRotation};this.#l?this.#l.setConfig(e):this.#l=new f(e)}else this.#l=null;this.points||(this.points=this.getPoints()),this.stepCount||(this.stepCount=this.getStepCount(this.#u));let c=e?i?t:Math.min(n,t):1;this.color=new a({...o,isMultiColor:e,colorCount:c}),e?this.colorMap=this.color.getColorMap({stepCount:c,colorCount:c}):this.colorMap=null}getTrianglePoints({center:e,rotation:t,isCapLevel:i,triangleIndexInSide:n}){let r;i&&(r=this.#S((n+2)%3));let s=[,,,].fill(null).map((t,i)=>i===r?[]:[e]);for(let n=0;n<3;n++){if(i&&n===r)continue;let a=t+p/3*n,l=s[n],o=Math.cos(a),c=Math.sin(a);for(let t=1;t<=this.config.density;t++){let i=t*this.#u.nailDistance;l.push([e[0]+i*o,e[1]+i*c])}}return s}getPoints(){if(this.points)return this.points;let{levels:e,renderCaps:t}=this.config,i=this.#u.nailsLength,n=this.#u.triangleHeight-i,r=[],s=t?e+1:e;for(let a=0;a<s;a++){let s=t&&a===e,l=[];r.push(l);let o=this.#u.countPerLevelSide[a],c=Array(o).fill(null).map((e,t)=>{let r=t%2==0,s=[this.#u.triangleCenterDistance*(t-a),a*this.#u.triangleHeight+(r?i:n)];return{rotation:Math.atan(s[0]/s[1]),distanceFromCenter:Math.sqrt(s[0]**2+s[1]**2)}});for(let e=0;e<6;e++){let t=G[e];for(let i=0;i<o;i++){if(s&&i%2==0){l.push(null);continue}let{distanceFromCenter:n,rotation:r}=c[i],a=t-r-this.#u.globalRotationRadians,o=[this.center[0]+n*Math.cos(a),this.center[1]-n*Math.sin(a)],u=this.getTrianglePoints({center:o,rotation:t+e*p/3-i*O+this.#u.globalRotationRadians,isCapLevel:s,triangleIndexInSide:i});l.push(u)}}}return r}*generateTriangleStrings({points:e,level:t,indexInSide:i}){this.renderer.setColor(this.color.getColor(t));let{density:n,levels:r}=this.config,s=t===r,a=s?this.#S(i%3):0,l=s?a:2,o=s?n:n-1;for(let t=a;t<=l;t++){let i=this.#S(t),r=e[t][0];for(let s=0;s<=o;s++){let a=s%2==0,l=[],o=a?this.config.density-s:s,c=a?i:t;l.push(e[c][o]),s<n&&l.push(e[c][a?o-1:o+1]),this.renderer.renderLines(r,...l),r=l[l.length-1],yield}}}*generateStringsBetweenTriangles({triangle1:e,triangle2:t,level:i,triangleIndex:n,triangleIndexInSide:r,isNextLevel:s}){let{density:a,fillColor:l}=this.config,o=this.#u.countPerLevelSide[i],c=n%o%3;this.renderer.setColor(l);let u=r===o-1,h=s?[this.#S(c),this.#S(c,-1)]:[c,this.#S(c,r%2?1:-1)];for(let e=0;e<2;e++)for(let{pointIndex:t,triangle1Points:i,triangle2Points:n}of d.call(this,e))this.renderer.renderLines(i[t],n[t]),yield;function*d(i){let n=h[i],r=(function(){return s?this.#S(n):0===i&&u?1:1===i&&u?0:this.#S(n,1)}).call(this),l=e[n],o=t[r],c=i?a:a-1;if(0===i)for(let e=0;e<=c;e++)yield{pointIndex:a-e,triangle1Points:l,triangle2Points:o};else for(let e=c;e>=1;e--)yield{pointIndex:a-e,triangle1Points:l,triangle2Points:o}}}#S(e,t=1){let i=e+t;return i<0?2:i>2?0:i}*generateStrings(){let{fill:e,renderTriangles:t,renderCaps:i,levels:n,renderRing:r,ringSize:s,ringColor:a}=this.config,l=this.getPoints(),o=-1;for(let r of l){let s=++o===n,a=-1,c=r.length-1;for(let u of r){a++;let h=this.#u.countPerLevelSide[o],d=a%h;if(e&&!s&&(0===a&&(yield*this.generateStringsBetweenTriangles({triangle1:r[c],triangle2:u,level:o,triangleIndex:c,triangleIndexInSide:c%h})),a!==c&&(yield*this.generateStringsBetweenTriangles({triangle1:u,triangle2:r[a+1],level:o,triangleIndex:a,triangleIndexInSide:d})),d%2==0&&(i||o<n-1))){let e=Math.floor(a/h)*this.#u.countPerLevelSide[o+1]+d+1;yield*this.generateStringsBetweenTriangles({triangle1:u,triangle2:l[o+1][e],level:o,triangleIndex:a,triangleIndexInSide:d,isNextLevel:!0})}let g=a%this.#u.countPerLevelSide[o];t&&(!s||g%2)&&(yield*this.generateTriangleStrings({points:u,level:o,indexInSide:g}))}}r&&s&&(yield*this.#l.drawRing(this.renderer,{ringSize:s/2,color:a}))}getStepCount(e){if(this.stepCount)return this.stepCount;e||(e=this.getCalc());let{levels:t,density:i,fill:n,renderTriangles:r,renderCaps:s,ringNailCount:a=0}=this.config,{triangleCount:l}=e,o=n?2*i:0,c=t+ +!!s;return l*((r?3*i:0)+o)+(r&&s?6*t*(i+1):0)+o*(c-1)*6*c/2+a}drawNails(){let e=this.getPoints(),t=0;for(let i of e)for(let e of i)if(null!=e)for(let i of e)for(let e of i)this.nails.addNail({point:e,number:t++});this.#l&&this.#l.drawNails(this.nails)}static thumbnailConfig={levels:3,density:3,fill:!1,renderRing:!0}},j,H];class J extends HTMLElement{static formAssociated=!0;internals;start=1;colorThumb=!1;reverse=!1;type="hue";#w=null;constructor(){super(),this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.innerHTML=`
        <string-art-range-input min="1" max="360" step="1" />
    `,this.#w=this.shadowRoot.querySelector("string-art-range-input"),this.internals=this.attachInternals()}static get observedAttributes(){return["start","colorthumb","value","reverse","type"]}attributeChangedCallback(e,t,i){"value"===e&&(this.value=i),"start"===e&&(this.start=parseInt(i,10),this.#k()),"reverse"===e&&(this.reverse=!!i,this.#k()),"colorthumb"===e&&(this.colorThumb=!!i,this.#x()),"type"===e&&(this.type="range"===i?"range":"hue",this.#k())}get value(){return this.#w.value}set value(e){this.#w.value=e,this.#k(),this.colorThumb&&this.#x()}connectedCallback(){this.hasAttribute("value")&&(this.value=parseInt(this.getAttribute("value"))),this.hasAttribute("colorthumb")&&(this.colorThumb=!0),this.#x(),this.#w.addEventListener("input",e=>this.#v(e))}#v(e){let t=this.value;this.internals.setFormValue(String(t)),this.dispatchEvent(new CustomEvent("input",{detail:{value:t}})),this.#k(),this.#x()}disconnectedCallback(){}focus(){}blur(){}#k(){let e="range"===this.type?`linear-gradient(to ${this.reverse?"left":"right"} in hsl ${this.value>=180?"longer":"shorter"} hue, hsl(${this.start} 100 50), hsl(${this.start+(180===this.value?181:this.value)} 100 50))`:"linear-gradient(to right in hsl longer hue, hsl(1 100 50), hsl(360 100 50))";this.#w.setAttribute("background",e)}#x(){let e=this.colorThumb?`hsl(${this.value}deg 100 50)`:"white";this.#w.setAttribute("thumbcolor",e)}}customElements.define("string-art-hue-input",J);const Z="rgba(0,0,0,.2)";class Q extends HTMLElement{static formAssociated=!0;internals;min;max;#w=null;#M=null;#L=.05;#N=null;#V=null;#z=null;#R=null;#E=null;#P=null;#A=null;#I;constructor(){super(),this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.innerHTML=`
          <style>
            input[type="range"] {
              width: 100%;
              appearance: none;
              background: transparent;
              border: none;
              margin: 2px;
              cursor: pointer;
            }

            input[type="range"]::-webkit-slider-thumb {
              appearance: none;
              width: 16px;
              height: 16px;
              border-radius: 50%;
              background: var(--color-input);
              cursor: pointer;
              border: none;
              margin-top: -4px;
              z-index: 10;
              box-shadow: 0 0 5px rgba(0,0,0,.5)
            }

            input[type="range"]::-webkit-slider-thumb:hover {
              background: var(--color-input-hover);
            }
              
            input[type="range"]:active::-webkit-slider-thumb {
              background: var(--color-input-active);
            }

            input[type="range"]::-webkit-slider-runnable-track {
              height: 8px;
              border-radius: 4px;
              margin: 0;
            }
          </style>
          <style id="background"></style>
          <input type="range">
        `,this.#w=this.shadowRoot.querySelector('input[type="range"]'),this.#M=this.shadowRoot.querySelector("#background"),this.#L=.05,this.#V=null,this.internals=this.attachInternals()}static get observedAttributes(){return["min","max","value","step","snap","background","thumbcolor"]}attributeChangedCallback(e,t,i){let n;if("snap"===e?this.#z=this.getTickValues():this.#w&&(this.#w[e]=i),("min"===e||"max"===e)&&(this[e]=Number(i)),"value"===e&&(n=Number(i)),"background"===e&&(this.#E=i),"thumbcolor"===e&&(this.#P=i),null!=this.min&&null!=this.max&&(this.min>this.max&&(this.max=this.min,this.#w.max=String(this.min)),this.#R=(this.max-this.min)*this.#L||.05,this.#z&&null!=this.value)){let e=this.getClosestTick(n);null!=e&&(this.#V=e)}this.#T()}get value(){return Number(this.#w.value)}set value(e){this.#w.value=String(e),this.#T()}connectedCallback(){["min","max","value","step"].forEach(e=>{this.hasAttribute(e)&&(this.#w[e]=this.getAttribute(e))}),this.#z=this.getTickValues(),this.#I=new ResizeObserver(e=>{for(let t of e)t.contentRect.width,this.#T()}),this.#I.observe(this.#w),this.#w.addEventListener("input",()=>this.handleInput()),this.#w.addEventListener("keydown",e=>this.handleKeydown(e)),this.#w.addEventListener("change",()=>this.#A=null),this.tabIndex=0}disconnectedCallback(){this.#I.unobserve(this)}getTickValues(){let e=this.getAttribute("snap"),t=e?.match(/\d+(\.\d+)?/g);return t?t.map(Number).filter(e=>!isNaN(e)).sort():[]}#D(e,t){if(null==t&&(t=this.getClosestTick(e)),null==t)return!0;let i=Math.abs(e-t);return!!(i>=this.#R/2&&i>Math.abs(this.#N-t))}#_(e,t){return Math.abs(e-t)/(this.max-this.min)>=.2}focus(){this.#w.focus()}blur(){this.#w.blur()}handleInput(){let e=Number(this.#w.value),t=this.getClosestTick(e);this.internals.setFormValue(this.#w.value),null!=t&&this.#A!==t&&this.#D(e,t)&&(this.#A=t),t!==this.#A&&(null!==t?(this.#w.value=String(t),t!==this.#V&&(this.#F(),this.#V=t)):null!=this.#V&&(this.#V=null)),null!=this.#A&&null==t&&this.#_(e,this.#A)&&(this.#A=null),this.#T(),this.#N=e,this.dispatchEvent(new CustomEvent("input",{detail:{value:this.#w.value}}))}handleKeydown(e){let t;e.preventDefault();let i=Number(this.#w.step||1),n=Number(this.#w.value);if("ArrowLeft"===e.key)t=Math.max(this.min,n-i);else if("ArrowRight"===e.key)t=Math.min(this.max,n+i);else if("ArrowUp"===e.key){let e=this.#z.find(e=>e>n);void 0!==e?t=e:n!==this.max&&(t=this.max)}else if("ArrowDown"===e.key){let e=[...this.#z].reverse().find(e=>e<n);void 0!==e?t=e:n!==this.min&&(t=this.min)}return null!=t&&(this.value=t,this.#N=t,this.dispatchEvent(new CustomEvent("input",{detail:{value:t},bubbles:!0,composed:!0}))),!1}getClosestTick(e){if(!this.#z||0===this.#z.length)return null;for(let t of this.#z)if(Math.abs(e-t)<=this.#R)return t;return null}#F(){"vibrate"in navigator&&navigator.vibrate(10)}#T(){let e=this.#w.clientWidth;if(!e)return;let t=this.value-this.min,i=this.max-this.min,n=e-16,r=8+n*t/i,s=this.#z?.filter(e=>e!==this.min&&e!==this.max).map(e=>8+n*(e-this.min)/i-1),a=s?.map(e=>`transparent ${e}px, ${Z} ${e}px, ${Z} ${e+2}px, transparent ${e+2}px`).join(", "),l=s?.length?`linear-gradient(to right, ${a}), `:null,o=[`input[type="range"]::-webkit-slider-runnable-track {
        background: ${l||""}${this.#E??`linear-gradient(to right, var(--color-input) ${r}px, #ddd ${r}px)`};
      }${this.#E?"":`
       input[type="range"]:hover::-webkit-slider-runnable-track {
        background: ${l||""}linear-gradient(to right, var(--color-input-hover) ${r}px, #ddd ${r}px);
      }
        input[type="range"]:active::-webkit-slider-runnable-track {
        background: ${l||""}linear-gradient(to right, var(--color-input-active) ${r}px, #ddd ${r}px);
      }`}`];null!=this.#P&&o.push(`input[type="range"]::-webkit-slider-thumb { background: ${this.#P} !important}`),this.#M.innerHTML=o.join("\n")}}customElements.define("string-art-range-input",Q);const X={controls:document.querySelector("#controls"),controlsPanel:document.querySelector("#controls_panel"),sidebarForm:document.querySelector("#sidebar_form")},Y=new Set(["input","change"]),K="controls_state";class ee{config;controlsConfig;state;eventHandlers;controlElements={};#$=!1;#B;#O;#G;#q;#U;#j;#H;#W;#J=!1;#Z;constructor(e,t){this.config=t,this.controlsConfig=e,this.state=this._getState()??{groups:{}},this.eventHandlers={input:new Set,change:new Set},this.#O=this.#Q.bind(this),X.controls.addEventListener("input",this.#O),this.#G=this.#X.bind(this),X.controls.addEventListener("touchstart",this.#G),X.controls.addEventListener("mousedown",this.#Y),this.#Z=this.#K.bind(this),X.sidebarForm.addEventListener("click",this.#Z),X.sidebarForm.addEventListener("keydown",this.#ee),this.controlElements={},this.renderControls()}destroy(){X.controls.removeEventListener("input",this.#O),X.sidebarForm.removeEventListener("click",this.#Z),X.sidebarForm.removeEventListener("keydown",this.#ee),X.controls.removeEventListener("touchstart",this.#G),X.controls.removeEventListener("mousedown",this.#Y),X.controls.innerHTML=""}#K(e){if("LEGEND"===e.target.nodeName){e.target.parentElement.classList.toggle("minimized");let t=e.target.parentElement.dataset.group;this.state={...this.state,groups:{...this.state.groups,[t]:!e.target.parentElement.classList.contains("minimized")}},this._updateState(this.state)}}#ee(e){"LEGEND"===e.target.nodeName&&"Enter"===e.key&&this.#K(e)}addEventListener(e,t){if(!Y.has(e))throw Error(`Unsupported event for EditorControls, "${e}"!`);if(!(t instanceof Function))throw Error("Invalid event handler.");this.eventHandlers[e].add(t)}_triggerEvent(e,t){for(let i of this.eventHandlers[e])i(t)}#Y(){let e=window.getSelection();e&&e.removeAllRanges()}#X(e){et(e.target)&&(this.#$=!0,this.#j=e.target,this.#H=e.target.value,this.#W=window.setTimeout(()=>{this.#$=!1},120),this.#q=this.#et.bind(this),document.body.addEventListener("touchend",this.#q),this.#U=this.#ei.bind(this),X.controlsPanel.addEventListener("scroll",this.#U))}#et(){document.body.removeEventListener("touchend",this.#q),X.controlsPanel.removeEventListener("scroll",this.#U),this.#J&&(this.#J=!1,this.#j&&(this.#j.value=this.#H)),this.#j=this.#H=null}#ei(){this.#J=!0}#Q(t){return(clearTimeout(e),clearTimeout(this.#B),this.#$&&et(t.target))?(t.preventDefault(),this.#B=window.setTimeout(()=>{this.#Q(t)},120),!1):this.#J?(t.preventDefault(),!1):void((t.target instanceof HTMLInputElement||et(t.target)||t.target instanceof HTMLSelectElement)&&this.updateInput({inputElement:t.target,originalEvent:t,deferChange:!0}))}updateControlDisplayValue(e){let{config:t,displayValueElement:i,input:n}=this.controlElements[e];i&&(i.innerText=String(t.displayValue?t.displayValue(this.config):n.value))}updateInput({inputElement:t,originalEvent:i,deferChange:n=!0}){let r=function(e){if(et(e))return Number(e.value);if(e instanceof HTMLInputElement)switch(e.type){case"range":case"number":return parseFloat(e.value);case"hue":default:return e.value;case"checkbox":return e.checked}if(e instanceof HTMLSelectElement)return e.value}(t),s=t.id.replace(/^config_/,"");if(this.config[s]===r)return;this.updateControlDisplayValue(s);let a=Object.freeze({control:s,value:r,originalEvent:i});this._triggerEvent("input",a);let l=()=>{this._triggerEvent("change",a),this.updateControlsVisibility()};this.updateControlsAttributes(),n?e=window.setTimeout(l,100):l()}_getState(){let e=localStorage.getItem(K);if(e)try{return JSON.parse(e)}catch(e){}return null}_updateState(e){e?localStorage.setItem(K,JSON.stringify(e)):localStorage.removeItem(K)}updateControlsAttributes(e){e||(e=this.controlsConfig),e.forEach(e=>{if("group"===e.type)this.updateControlsAttributes(e.children);else if(e.attr){let t=Object.entries(e.attr).filter(([e,t])=>t instanceof Function);if(t.length){let i=this.controlElements[e.key].input;i&&t.forEach(([t,n])=>{let r=this.getConfigValue(n,this.config);r!=i.getAttribute(t)&&(i.setAttribute(t,String(r)),"min"===t&&i.value<r||"max"===t&&i.value>r?(i.value=String(r),clearTimeout(i.updateTimeout),i.updateTimeout=window.setTimeout(()=>{this.updateInput({inputElement:i})},100)):this.updateControlDisplayValue(e.key))})}}})}updateControlsVisibility(e){(e??this.controlsConfig).forEach(e=>{if(e.show){let t=e.show(this.config),i=this.controlElements[e.key].element;i&&(t?i.removeAttribute("hidden"):i.setAttribute("hidden","hidden"))}if(e.isDisabled){let t=e.isDisabled(this.config),i=this.controlElements[e.key].input;i&&(t?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled"))}e.children&&this.updateControlsVisibility(e.children)})}renderControls(e=X.controls,t,i){let n=t??this.controlsConfig;e.innerHTML="";let r=document.createDocumentFragment();i=i??1,n.forEach((e,t)=>{let i,n,s,a=`config_${String(e.key)}`;if("group"===e.type){(i=document.createElement("fieldset")).setAttribute("data-group",String(e.key));let t=document.createElement("legend");t.setAttribute("tabindex","0"),t.innerText=e.label,i.appendChild(t),i.className="control control_group","minimized"===e.defaultValue&&(i.classList.add("minimized"),this.state.groups[String(e.key)]=!1);let n=document.createElement("div");i.appendChild(n),this.renderControls(n,e.children)}else{(i=document.createElement("div")).className="control";let r=document.createElement("label");r.innerHTML=e.label,r.setAttribute("for",a),et(n=document.createElement(function(e){switch(e){case"select":return"select";case"range":return"string-art-range-input";case"hue":return"string-art-hue-input";default:return"input"}}(e.type)))&&n.classList.add("range-input"),n.setAttribute("tabindex",String(t));let l=this.config[e.key]??this.getConfigValue(e.defaultValue,this.config);if("select"===e.type){let t=document.createDocumentFragment();e.options.forEach(e=>{let{value:i,label:n}="string"==typeof e?{value:e,label:e}:e,r=document.createElement("option");r.setAttribute("value",i),r.innerText=n,t.appendChild(r)}),n.appendChild(t),n.value=String(l),i.appendChild(r),i.appendChild(n)}else"range"!==e.type&&n.setAttribute("type",e.type),"checkbox"===e.type?(n.checked=!!l,i.appendChild(n),i.appendChild(r)):(i.appendChild(r),i.appendChild(n),setTimeout(()=>{n.value=String(l)}),(s=document.createElement("span")).id=`config_${String(e.key)}_value`,s.innerText=String(e.displayValue?e.displayValue(this.config):l),s.className="control_input_value",i.appendChild(s));e.attr&&Object.entries(e.attr).forEach(([e,t])=>{let i=this.getConfigValue(t,this.config);n.setAttribute(e,String(i))}),n.id=a}this.controlElements[e.key]={config:e,displayValueElement:s,input:n,element:i},i.id=`control_${String(e.key)}`,r.appendChild(i)}),e.appendChild(r),this.updateGroupsState(),requestAnimationFrame(()=>this.updateControlsVisibility())}updateGroupsState(){X.sidebarForm.querySelectorAll("[data-group]").forEach(e=>{if(e instanceof HTMLFieldSetElement){let t=e.dataset.group,i=this.state.groups[t];"boolean"==typeof i&&(i?e.classList.remove("minimized"):e.classList.add("minimized"))}})}getConfigValue(e,t){return e instanceof Function?e(t):e}}function et(e){return e instanceof Q||e instanceof J}const ei=document.querySelector("#size_controls"),en={sizeSelect:ei.querySelector("#size_select"),sizeCustom:ei.querySelector("#size_custom"),width:ei.querySelector("#size_custom_width"),height:ei.querySelector("#size_custom_height"),orientationSelect:ei.querySelector("#size_orientation_select")};function er(e,t=300){return Math.floor(e/2.54*t)}const es=[Math.floor(window.screen.width),Math.floor(window.screen.height)],ea=[{id:"fit",name:"Fit to screen"},{id:"A4",value:[20,28].map(e=>er(e)),orientationSelect:!0},{id:"A3",value:[28,40].map(e=>er(e)),orientationSelect:!0},{id:"screen",name:`Screen size (${es.join("x")})`,value:es},{id:"custom",name:"Custom..."}];class el{element=document.querySelector("#size_controls");constructor({getCurrentSize:e}){let t=document.createDocumentFragment();ea.forEach(e=>{let i=document.createElement("option");i.setAttribute("value",e.id),i.innerText=e.name??e.id,t.appendChild(i)}),en.sizeSelect.appendChild(t),this.selectedSize=ea[0],en.sizeSelect.addEventListener("change",t=>{let i=t.target.value,n=ea.find(({id:e})=>e===i);if(this.selectedSize=n,"custom"===n.id){en.sizeCustom.removeAttribute("hidden");let[t,i]=e();en.width.value=t,en.height.value=i}else en.sizeCustom.setAttribute("hidden","hidden"),this._notifyOnChange(this.getValue());n.orientationSelect?en.orientationSelect.removeAttribute("hidden"):en.orientationSelect.setAttribute("hidden","hidden")}),en.orientationSelect.addEventListener("change",e=>{this._notifyOnChange(this.getValue())}),en.sizeCustom.addEventListener("focusin",e=>{e.target.select()}),en.sizeCustom.addEventListener("input",()=>{this._notifyOnChange([en.width.value?parseInt(en.width.value):null,en.height.value?parseInt(en.height.value):null])})}_notifyOnChange([e,t]=[]){this.element.dispatchEvent(new CustomEvent("sizechange",{detail:e&&t?[e,t]:null}))}getValue(){if("custom"===this.selectedSize.id)return[parseInt(en.width.value,10),parseInt(en.height.value,10)];{let e=this.selectedSize.value;return this.selectedSize.orientationSelect&&"horizontal"===en.orientationSelect.value&&(e=Array.from(e).reverse()),e}}}class eo extends c{canvas;ctx;pixelRatio;constructor(e){super(e),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");let t=window.devicePixelRatio||1;this.pixelRatio=t,this.ctx.globalCompositeOperation="source-over",e.appendChild(this.canvas)}get element(){return this.canvas}reset(){this.ctx.clearRect(0,0,...this.getSize()),this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height");let[e,t]=this.getSize();this.canvas.setAttribute("width",String(e)),this.canvas.setAttribute("height",String(t))}setColor(e){this.ctx.strokeStyle=e}setLineWidth(e){this.ctx.lineWidth=e}setBackground(e){this.ctx.globalCompositeOperation="destination-over",this.ctx.fillStyle=e,this.ctx.fillRect(0,0,...this.getSize()),this.ctx.globalCompositeOperation="source-over"}getSize(){return[this.canvas.clientWidth*this.pixelRatio,this.canvas.clientHeight*this.pixelRatio]}renderLines(e,...t){for(let i of(this.ctx.beginPath(),this.ctx.moveTo(...e),t))this.ctx.lineTo(...i);this.ctx.stroke()}renderNails(e,{color:t,fontSize:i,radius:n,renderNumbers:r,margin:s=0}){let a=this.canvas.width/2;this.ctx.globalCompositeOperation="source-over",this.ctx.beginPath(),this.ctx.fillStyle=t,this.ctx.textBaseline="middle",this.ctx.font=`${i}px sans-serif`;let l=n+s;e.forEach(({point:[e,t],number:i})=>{if(this.ctx.moveTo(e+n,t),this.ctx.arc(e,t,n,0,p),r&&null!=i){let n=e<a,r=[n?e-l:e+l,t];this.ctx.textAlign=n?"right":"left",this.ctx.fillText(String(i),...r)}}),this.ctx.fill()}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}toDataURL(){return this.canvas.toDataURL()}}const ec="minimized";class eu{elements={root:document.querySelector("#pattern_select_panel"),thumbnails:document.querySelector("#pattern_select_thumbnails"),toggleBtn:document.querySelector("#pattern_select_btn"),dropdown:document.querySelector("#pattern_select_dropdown")};pattern;thumbnailsRendered=!1;_onClickOutside;constructor(){this.elements.toggleBtn.addEventListener("click",()=>this.toggle())}toggle(){this.elements.root.classList.contains(ec)?this.open():this.pattern&&this.close()}open(){this.elements.root.classList.contains(ec)&&(this.elements.root.classList.remove(ec),this.thumbnailsRendered||(this.createThumbnails(),this.thumbnailsRendered=!0),this._onClickOutside=e=>{e.target instanceof HTMLElement&&!e.target.closest("#pattern_select_panel")&&this.toggle()},document.body.addEventListener("mousedown",this._onClickOutside))}close(){this.elements.root.classList.contains(ec)||(this.elements.root.classList.add(ec),document.body.removeEventListener("mousedown",this._onClickOutside),this._onClickOutside=null)}setCurrentPattern(e){this.pattern=e,this.elements.toggleBtn.innerText=e?.name??"Choose a pattern"}createThumbnails(){let e=document.createDocumentFragment(),t=[];W.forEach(i=>{let n=document.createElement("a"),r=new eo(n);n.style.width=n.style.height="100px";let s=new i(r);s.config={margin:1,enableBackground:!1,nailRadius:.5,...i.thumbnailConfig},t.push(s);let a=document.createElement("li");e.appendChild(a),n.href=`?pattern=${s.id}`,n.setAttribute("data-pattern",s.id),n.title=s.name,a.appendChild(n)}),this.elements.thumbnails.appendChild(e),t.forEach(e=>e.draw()),this.elements.thumbnails.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();let t=e.target instanceof HTMLElement&&e.target.closest("[data-pattern]");if(!t)return!1;this.elements.root.dispatchEvent(new CustomEvent("change",{detail:{pattern:t.dataset.pattern}})),this.toggle()})}addOnChangeListener(e){this.elements.root.addEventListener("change",e)}removeOnChangeListener(e){this.elements.root.removeEventListener("change",e)}}const eh=/^\-?\d+(\.\d+)?$/,ed=/^(?:!)([01])$/;async function eg(e){try{navigator.share(await ef(e))}catch(e){alert("Error: "+e.message)}}async function ep(e){if(!navigator.share)return!1;let t=await ef(e);return navigator.canShare(t)}async function ef({renderer:e,pattern:t}){let i=e.toDataURL(),n=await (await fetch(i)).blob(),r=[new File([n],t.name+".jpg",{type:n.type,lastModified:new Date().getTime()})];return{url:window.location.href,files:r,title:document.title,text:"String Art Studio - "+t.name}}async function em(){if(navigator.serviceWorker&&"127.0.0.1"!==document.location.hostname)try{let e=await navigator.serviceWorker.register("service-worker.js");e.onupdatefound=()=>{let t=e.installing;null!=t&&(t.onstatechange=()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."):console.log("Content is cached for offline use."))})}}catch(e){console.error("Error during service worker registration:",e)}}const ey="http://www.w3.org/2000/svg";class eb extends c{svg;backgroundGroup;background=null;linesGroup;nailsGroup;nailsCirclesGroup;nailsTextGroup;currentColor=null;lineWidth=1;currentLineGroup=null;constructor(e){super(e),this.svg=document.createElementNS(ey,"svg"),this.svg.style.setProperty("display","block"),this.backgroundGroup=document.createElementNS(ey,"g"),this.backgroundGroup.setAttribute("data-id","background"),this.linesGroup=document.createElementNS(ey,"g"),this.linesGroup.setAttribute("data-id","lines"),this.nailsGroup=document.createElementNS(ey,"g"),this.nailsGroup.setAttribute("data-id","nails"),this.nailsCirclesGroup=document.createElementNS(ey,"g"),this.nailsCirclesGroup.setAttribute("data-id","nailsCircles"),this.nailsTextGroup=document.createElementNS(ey,"g"),this.nailsTextGroup.setAttribute("data-id","nailsText"),this.nailsGroup.appendChild(this.nailsCirclesGroup),this.nailsGroup.appendChild(this.nailsTextGroup),this.svg.appendChild(this.backgroundGroup),this.svg.appendChild(this.linesGroup),this.svg.appendChild(this.nailsGroup),this.svg.setAttribute("xmlns",ey),e.appendChild(this.svg)}get element(){return this.svg}reset(){this.linesGroup.innerHTML="",this.nailsCirclesGroup.innerHTML="",this.nailsTextGroup.innerHTML="";let[e,t]=this.getSize().map(Math.trunc);this.svg.setAttributeNS(ey,"viewBox",`0 0 ${e} ${t}`),this.svg.setAttributeNS(ey,"width",String(e)),this.svg.setAttributeNS(ey,"height",String(t)),this.svg.style.width=e+"px",this.svg.style.height=t+"px",this.currentColor=null,this.lineWidth=null}setColor(e){e!==this.currentColor&&(this.currentLineGroup=document.createElementNS(ey,"g"),this.currentLineGroup.setAttribute("stroke",e),this.currentLineGroup.setAttribute("stroke-width",String(this.lineWidth)),this.linesGroup.appendChild(this.currentLineGroup),this.currentColor=e)}setLineWidth(e){this.lineWidth=e??"1",this.linesGroup.setAttributeNS(ey,"stroke-width",e??"1"),this.linesGroup.childNodes.forEach(t=>{t instanceof SVGGElement&&t.setAttributeNS(ey,"stroke-width",e??"1")})}setBackground(e){e?(this.background||(this.background=document.createElementNS(ey,"rect"),this.background.setAttribute("width","100%"),this.background.setAttribute("height","100%"),this.backgroundGroup.appendChild(this.background)),this.background.setAttribute("fill",e)):(this.background=null,this.backgroundGroup.innerHTML="")}getSize(){return[this.svg.clientWidth,this.svg.clientHeight]}setSize(e){if(super.setSize(e),e){let[t,i]=e.map(Math.trunc);this.svg.setAttributeNS(ey,"viewBox",`0 0 ${t} ${i}`),this.svg.setAttributeNS(ey,"width",String(t)),this.svg.setAttributeNS(ey,"height",String(i))}}renderLines(e,...t){let i=e,n=document.createDocumentFragment();for(let e of t){let t=document.createElementNS(ey,"line");t.setAttribute("x1",String(Math.trunc(i[0]))),t.setAttribute("y1",String(Math.trunc(i[1]))),t.setAttribute("x2",String(Math.trunc(e[0]))),t.setAttribute("y2",String(Math.trunc(e[1]))),i=e,n.appendChild(t)}this.currentLineGroup.appendChild(n)}renderNails(e,{color:t,fontSize:i,radius:n,renderNumbers:r,margin:s=0}){let a=this.getSize()[0]/2;this.nailsCirclesGroup.innerHTML=this.nailsTextGroup.innerHTML="";let l=document.createDocumentFragment(),o=document.createDocumentFragment();this.nailsGroup.setAttribute("fill",t);let c=n+s;this.nailsTextGroup.style.fontSize=i,e.forEach(({point:[e,t],number:i})=>{let s=document.createElementNS(ey,"circle");if(s.setAttribute("cx",e),s.setAttribute("cy",t),s.setAttribute("r",n),l.appendChild(s),r&&null!=i){let n=e<a,r=[n?e-c:e+c,t],s=document.createElementNS(ey,"text");s.innerHTML=String(i),s.setAttribute("x",r[0]),s.setAttribute("y",r[1]),n&&s.setAttribute("text-anchor","end"),o.appendChild(s)}}),this.nailsCirclesGroup.appendChild(l),this.nailsTextGroup.appendChild(o)}clear(){this.linesGroup.innerHTML="",this.nailsGroup.innerHTML=""}toDataURL(){return""}}function eC(e,t){let i=document.createElement("a");i.href=e,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i)}window.addEventListener("error",function(e){alert("Error: "+e.message)});const eS={canvas:document.querySelector("#canvas_panel"),patternLink:document.querySelector("#pattern_link"),downloadBtn:document.querySelector("#download_btn"),downloadSVGBtn:document.querySelector("#download_svg_btn"),downloadNailsBtn:document.querySelector("#download_nails_btn"),resetBtn:document.querySelector("#reset_btn"),shareBtn:document.querySelector("#share_btn"),playerBtn:document.querySelector("#player_btn"),buttons:document.querySelector("#buttons"),instructionsLink:document.querySelector("#pattern_select_dropdown_instructions")},ew=new class{elements;stepCount;#en;stringArt;#er;constructor(e){this.elements={player:e,step:e.querySelector("#step"),playerPosition:e.querySelector("#player_position"),playBtn:e.querySelector("#play_btn"),pauseBtn:e.querySelector("#pause_btn"),text:e.querySelector("#player_text")},this.stepCount=0,this.#en=!1,this.elements.playerPosition.addEventListener("input",({target:e})=>{"value"in e&&this.goto(+e.value)}),this.elements.playBtn.addEventListener("click",()=>{this.play()}),this.elements.pauseBtn.addEventListener("click",()=>{this.pause()})}updateStatus(e){this.#en!==e&&(this.elements.player.classList.toggle("playing"),this.#en=e)}update(e,{draw:t=!0}={}){this.stringArt=e,this.stepCount=e.getStepCount(),this.elements.playerPosition.setAttribute("max",String(this.stepCount)),this.elements.step.innerText=`${this.stepCount}/${this.stepCount}`,this.elements.text.style.removeProperty("width"),this.elements.text.style.width=(this.elements.text.clientWidth||70)+"px",this.goto(this.stepCount,{updateStringArt:t})}updatePosition(e){this.elements.step.innerText=`${e}/${this.stepCount}`,this.elements.playerPosition.value=String(e)}goto(e,{updateStringArt:t=!0}={}){e>this.stepCount||e<1||(this.pause(),this.updatePosition(e),t&&this.stringArt.goto(e))}advance(e=1){this.elements.playerPosition.value,this.goto(Math.max(1,Math.min(this.stepCount,Number(this.elements.playerPosition.value)+e)))}setInstructions(e){}play(){this.updateStatus(!0),cancelAnimationFrame(this.#er),this.stringArt.position===this.stepCount&&this.stringArt.goto(0);let e=this;!function t(){e.stringArt.drawNext().done?e.updateStatus(!1):e.#er=requestAnimationFrame(t),e.updatePosition(e.stringArt.position)}()}pause(){cancelAnimationFrame(this.#er),this.updateStatus(!1)}toggle(){this.#en?this.pause():this.play()}}(document.querySelector("#player")),ek=new el({getCurrentSize:()=>[eS.canvas.clientWidth,eS.canvas.clientHeight]}),ex=new eu;async function ev(){let e,i;window.addEventListener("popstate",({state:e})=>{s(e)}),await em(),document.body.querySelectorAll(".pattern_only").forEach(eL),eM(document.querySelector("main"));let n=new URLSearchParams(document.location.search);t="svg"===n.get("renderer")?new eb(eS.canvas):new eo(eS.canvas);let r=W.map(e=>new e(t));if(history.state?.pattern)s(history.state);else{let e=n.get("pattern");e?s({pattern:e,config:n.get("config")}):ex.toggle()}function s(e){if(e?.pattern){let t=a(e.pattern);g(t,{draw:!1,config:e.config?function(e,t){let i=t.replace(/(?:~)(\d+)(?:_)/g,(e,t)=>Array(+t).fill("_").join("")).split("_").map(e=>{if(""===e)return null;if(eh.test(e))return parseFloat(e);let t=e.match(ed);return t?"1"===t[1]:e}),n=Object.keys(e.defaultConfig);return i.reduce((e,t,i)=>{if(null!==t){let r=n[i];return{...e,[r]:t}}return e},{})}(t,e.config):{}}),ex.close(),i.draw()}else p(),ex.open()}function a(e){let t=r.find(({id:t})=>t===e);if(!t)throw Error(`Pattern with id "${e}" not found!`);return t}async function l(){if(!i)throw Error("Can't init pattern - no current pattern available!");ek.element.addEventListener("sizechange",({detail:e})=>{var n;(n=e)&&2===n.length?(t.setSize(n),eS.canvas.classList.contains("overflow")||eS.canvas.classList.add("overflow")):(eS.canvas.classList.remove("overflow"),t.setSize(null)),i.draw()}),window.addEventListener("resize",()=>i&&i.draw()),eS.downloadBtn.addEventListener("click",o),eS.downloadNailsBtn.addEventListener("click",c),eS.resetBtn.addEventListener("click",u),await ep({renderer:t,pattern:i})&&eM(eS.shareBtn)}function o(){eC(t.toDataURL(),i.name+".png")}function c(){let e=i.config;i.config={...e,darkMode:!1,showNails:!0,showNailNumbers:!0,showStrings:!1,nailsColor:"#000000"},i.draw(),o(),i.config=e,i.draw()}function u(){confirm("Are you sure you wish to reset options to defaults?")&&d(i,{config:{}})}function h(){ew.update(i);let e=function(e){let{defaultConfig:t,config:i}=e,n=Object.entries(i).map(([e,i])=>i===t[e]?null:"boolean"==typeof i?`!${+!!i}`:"number"==typeof i?parseFloat(i.toFixed(6)):i);for(;null===n[n.length-1];)n.pop();return n.length?n.join("_").replace(/\_{2,}/g,e=>"~"+e.length+"_"):""}(i);history.replaceState({pattern:i.id,config:e},i.name,`?pattern=${i.id}${e?`&config=${encodeURIComponent(e)}`:""}`)}function d(e,t){g(e,t),history.pushState({pattern:e.id},e.name,"?pattern="+e.id)}function g(t,{config:n,draw:r=!0}={}){let s=!i;i=t,n&&i.setConfig(n),e&&e.destroy(),(e=new ee(t.configControls,t.config)).addEventListener("input",({control:t,value:n})=>{i.setConfigValue(t,n),e.config=i.config,i.draw()}),e.addEventListener("change",h),t.link?(eS.patternLink.setAttribute("href",t.link),eS.patternLink.innerText=t.linkText??"Example",eM(eS.patternLink)):eL(eS.patternLink),r&&requestAnimationFrame(()=>{i.draw()}),ex.setCurrentPattern(t),document.title=`${t.name} - String Art Studio`,document.body.setAttribute("data-pattern",t.id),s&&(l(),document.body.querySelectorAll(".pattern_only").forEach(eM)),ew.update(i,{draw:!1})}function p(){i=null,t.clear(),eL(eS.patternLink),ex.setCurrentPattern(null),e&&e.destroy(),document.body.querySelectorAll(".pattern_only").forEach(eL),document.body.removeAttribute("data-pattern")}eS.downloadBtn.addEventListener("click",o),eS.downloadSVGBtn.addEventListener("click",function(){!function(e,t){let i=document.createElement("article");i.style.width=t[0]+"px",i.style.height=t[1]+"px",document.body.appendChild(i);let n=new eb(i),r=new e.constructor(n);r.setConfig(e.config),r.draw();var s=new Blob([r.renderer.svg.outerHTML],{type:"image/svg+xml;charset=utf-8"});eC(URL.createObjectURL(s),e.name+".svg"),document.body.removeChild(i)}(i,t.getSize())}),eS.downloadNailsBtn.addEventListener("click",c),eS.resetBtn.addEventListener("click",u),eS.shareBtn.addEventListener("click",async()=>await eg({renderer:t,pattern:i})),eS.playerBtn.addEventListener("click",()=>{document.querySelectorAll("#buttons [data-toggle-for]").forEach(e=>{e instanceof HTMLElement&&e.classList.contains("active")&&e.click()})}),eS.instructionsLink.addEventListener("click",e=>{e.preventDefault(),history.pushState({pattern:null},"String Art Studio","./"),p()}),ex.addOnChangeListener(({detail:e})=>{d(a(e.pattern))}),eS.canvas.addEventListener("wheel",({deltaY:e})=>{let t=-e/Math.abs(e);ew.advance(t)}),document.body.addEventListener("click",e=>{let t=e.target instanceof HTMLElement&&e.target.closest("[data-toggle-for]");if(t instanceof HTMLElement&&t){let e=t.dataset.toggleFor;t.classList.toggle("active"),document.querySelector("#"+e).classList.toggle("open"),document.body.classList.toggle("dialog_"+e),i&&i.draw({position:i.position})}})}function eM(e){e.removeAttribute("hidden")}function eL(e){e.setAttribute("hidden","hidden")}window.addEventListener("load",ev);
//# sourceMappingURL=string_art.745fbc83.js.map
