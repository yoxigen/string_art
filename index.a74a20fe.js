const t=[{key:"isMultiColor",label:"Use multiple colors",defaultValue:!1,type:"checkbox"},{key:"colorCount",label:"Colors count",defaultValue:7,type:"range",attr:{min:1,max:20,step:1},show:({isMultiColor:t})=>t},{key:"color",label:"String color",defaultValue:"#ff4d00",type:"color",show:({isMultiColor:t})=>!t},{key:"repeatColors",label:"Repeat colors",defaultValue:!1,type:"checkbox",show:({isMultiColor:t})=>t},{key:"multicolorRange",label:"Multicolor range",defaultValue:360,type:"range",attr:{min:1,max:360,step:1},show:({isMultiColor:t})=>t},{key:"multicolorStart",label:"Multicolor start",defaultValue:0,type:"range",attr:{min:0,max:360,step:1},show:({isMultiColor:t})=>t},{key:"reverseColors",label:"Reverse colors order",defaultValue:!1,type:"checkbox",show:({isMultiColor:t})=>t},{key:"saturation",label:"Saturation",defaultValue:100,type:"range",attr:{min:0,max:100,step:1},show:({isMultiColor:t})=>t},{key:"lightness",label:"Lightness",type:"group",defaultValue:"minimized",show:({isMultiColor:t})=>t,children:[{key:"multicolorByLightness",label:"Multi lightness",defaultValue:!1,type:"checkbox",show:({isMultiColor:t})=>t},{key:"minLightness",label:"Minimum lightness",defaultValue:0,type:"range",attr:{min:0,max:100,step:1},show:({multicolorByLightness:t,isMultiColor:e})=>t&&e},{key:"maxLightness",label:"Maximum lightness",defaultValue:100,type:"range",attr:{min:0,max:100,step:1},show:({multicolorByLightness:t,isMultiColor:e})=>t&&e}]}];class e{constructor(t){this.config=t;const{multicolorRange:e,colorCount:i,multicolorByLightness:n,minLightness:s=0,maxLightness:o=100,multicolorStart:a,darkMode:r,saturation:l,reverseColors:c,isMultiColor:h}=t;h&&(this.multiColorStep=e/i,this.multiColorLightnessStep=n?(o-s)/(Math.max(i,2)-1):1,this.colors=new Array(i).fill(null).map(((t,e)=>{const i=n?s+this.multiColorLightnessStep*e:r?50:40;return`hsl(${a+e*this.multiColorStep}, ${l}%, ${i}%)`})),c&&this.colors.reverse())}getColor(t){const{isMultiColor:e,colorCount:i,color:n,repeatColors:s}=this.config;return e?(t>=i&&(t=s?t%i:i-1),this.colors[t]):n}getColorMap({stepCount:t,colorCount:e}){if(!e)throw new Error("Can't get color map, no colorCount provided!");const i=Math.floor(t/e),n=new Map;for(let t=0;t<e;t++)n.set(t*i,this.getColor(t));return n}static getConfig({include:e,exclude:i,defaults:n={},customControls:s}){const o=function s(o=t){return o.filter((({key:t})=>(!i||!i.includes(t))&&(!e||e.includes(t)))).map((t=>{const e={...t,defaultValue:n[t.key]??t.defaultValue};return"group"===t.type&&(e.children=s(t.children)),Object.freeze(e)}))}();return{key:"colorGroup",label:"Color",type:"group",children:[...s??[],...o]}}}function i(t,e){return e?i(e,t%e):t}const n=2*Math.PI;class s{constructor(t,e){this.context=t.getContext("2d"),this.setConfig(e),this.centerX=t.width/2,this.nails=[],this.addedPoints=new Set}setConfig({nailRadius:t,nailsColor:e,nailNumbersFontSize:i}){this.nailRadius=t,this.nailsColor=e,this.nailNumbersFontSize=i,this.nails=[],this.addedPoints&&this.addedPoints.clear()}addNail(t){const e=t.point.map(Math.round).join("_");this.addedPoints.has(e)||(this.nails.push(t),this.addedPoints.add(e))}fill({drawNumbers:t=!0}={}){this.context.globalCompositeOperation="source-over",this.context.beginPath(),this.context.fillStyle=this.nailsColor,this.context.textBaseline="middle",this.context.font=`${this.nailNumbersFontSize}px sans-serif`;const e=this.nailRadius+4;this.nails.forEach((({point:[i,s],number:o})=>{if(this.context.moveTo(i+this.nailRadius,s),this.context.arc(i,s,this.nailRadius,0,n),t&&null!=o){const t=i<this.centerX,n=[t?i-e:i+e,s];this.context.textAlign=t?"right":"left",this.context.fillText(String(o),...n)}})),this.context.fill(),this.nails=[],this.addedPoints.clear()}}const o="#0e0e0e",a="#ffffff",r=[{key:"strings",label:"Strings",type:"group",defaultValue:"minimized",children:[{key:"showStrings",label:"Show strings",defaultValue:!0,type:"checkbox",isDisabled:({showNails:t})=>!t},{key:"stringWidth",label:"String width",defaultValue:1,type:"range",attr:{min:.2,max:4,step:.1},show:({showStrings:t})=>t}]},{key:"nails",label:"Nails",type:"group",defaultValue:"minimized",children:[{key:"showNails",label:"Show nails",defaultValue:!0,type:"checkbox",isDisabled:({showStrings:t})=>!t},{key:"showNailNumbers",label:"Show nail numbers",defaultValue:!1,type:"checkbox",show:({showNails:t})=>t},{key:"nailNumbersFontSize",label:"Nail numbers font size",defaultValue:10,type:"range",attr:{min:6,max:24,step:.5},displayValue:({nailNumbersFontSize:t})=>`${t}px`,show:({showNails:t,showNailNumbers:e})=>t&&e},{key:"margin",label:"Margin",defaultValue:20,type:"number",attr:{min:0,max:500,step:1},displayValue:({margin:t})=>`${t}px`},{key:"nailRadius",label:"Nail size",defaultValue:1.5,type:"range",attr:{min:.5,max:5,step:.25},show:({showNails:t})=>t},{key:"nailsColor",label:"Nails color",defaultValue:"#ffffff",type:"color",show:({showNails:t})=>t}]},{key:"background",label:"Background",type:"group",defaultValue:"minimized",children:[{key:"darkMode",label:"Dark mode",defaultValue:!0,type:"checkbox",isDisabled:({enableBackground:t})=>!t},{key:"customBackgroundColor",label:"Custom background color",defaultValue:!1,type:"checkbox",isDisabled:({enableBackground:t})=>!t},{key:"backgroundColor",label:"Background color",defaultValue:o,type:"color",show:({customBackgroundColor:t})=>t,isDisabled:({enableBackground:t})=>!t},{key:"enableBackground",label:"Enable background",defaultValue:!0,type:"checkbox"}]}];function l(t){return t.reduce(((t,{key:e,defaultValue:i,children:n})=>n?{...t,...l(n)}:{...t,[e]:i}),{})}function c(t){return t.reduce(((t,e)=>e.children?{...t,...c(e.children)}:{...t,[e.key]:e}),{})}var h=class{constructor(t){if(!t)throw new Error("Canvas not specified!");this.canvas=t,this.ctx=this.canvas.getContext("2d");const e=window.devicePixelRatio||1,i=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1;this.pixelRatio=e/i}get configControls(){return(this.controls??[]).concat(r)}get controlsIndex(){return this._controlsIndex||(this._controlsIndex=c(this.controls)),this._controlsIndex}get defaultConfig(){return this._defaultConfig||(this._defaultConfig=Object.freeze(Object.assign(l(this.configControls),this.defaultValues))),this._defaultConfig}get config(){return this._config??this.defaultConfig}set config(t){this._config=Object.assign({},this.defaultConfig,t)}setConfigValue(t,e){this._config=Object.freeze({...this._config??this.defaultConfig,[t]:e}),this.onConfigChange&&this.onConfigChange({control:this.controlsIndex[t],value:e})}getSize(){return[this.canvas.clientWidth,this.canvas.clientHeight].map((t=>t*this.pixelRatio))}setUpDraw(){const t=this.size;this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height");const[e,i]=this.size=this.getSize();Object.assign(this,this.size),this.canvas.setAttribute("width",e),this.canvas.setAttribute("height",i),this.center=this.size.map((t=>t/2)),!t||t[0]===e&&t[1]===i||this.onResize&&this.onResize(),this.nails?this.nails.setConfig(this.config):this.nails=new s(this.canvas,this.config),this.ctx.clearRect(0,0,...this.size),this.ctx.lineWidth=this.config.stringWidth}afterDraw(){const{showNails:t,showNailNumbers:e}=this.config;t&&(this.drawNails(),this.nails.fill({drawNumbers:e}))}initDraw(){this.setUpDraw(this.config);const{showNails:t,showNailNumbers:e,darkMode:i,backgroundColor:n,customBackgroundColor:s,enableBackground:r}=this.config;this.ctx.beginPath(),r&&(this.ctx.globalCompositeOperation="destination-over",this.ctx.fillStyle=s?n:i?o:a,this.ctx.fillRect(0,0,...this.size)),this.ctx.globalCompositeOperation="source-over",t&&(this.drawNails(),this.nails.fill({drawNumbers:e}))}draw({position:t=1/0}={}){this.initDraw();const{showStrings:e}=this.config;if(e){for(this.stringsIterator=this.generateStrings(),this.position=0;!this.drawNext().done&&this.position<t;);this.afterDraw()}}goto(t){if(t!==this.position)if(this.stringsIterator&&t>this.position)for(;!this.drawNext().done&&this.position<t;);else this.draw({position:t})}drawNext(){const t=this.stringsIterator.next();return t.done?this.afterDraw():this.position++,t}generateStrings(){throw new Error("generateStrings method not defined!")}getStepCount(){throw new Error(`'getStepCount' method not implemented for string art type "${this.name}"`)}};class u{constructor(t){this.setConfig(t)}getPoint(t=0){const e=this.getNailIndex(t);if(this.points.has(t))return this.points.get(t);const i=[this.center[0]+Math.sin(e*this.indexAngle+this.rotationAngle)*this.radius,this.center[1]+Math.cos(e*this.indexAngle+this.rotationAngle)*this.radius];return this.points.set(t,i),i}getNailIndex(t=0){let e=this.isReverse?this.config.n-1-t:t;return e>this.config.n-1&&(e%=this.config.n),e}setConfig(t){const e=this._serializeConfig(t);if(e!==this.serializedConfig){const{n:i,size:s,margin:o=0,rotation:a=0,center:r,radius:l,reverse:c=!1}=t,h=r??s.map((t=>t/2)),u={center:h,radius:l??Math.min(...h)-o,indexAngle:n/i,rotationAngle:-n*a,isReverse:c};this.config=t,this.serializedConfig=e,Object.assign(this,u),this.points?this.points.clear():this.points=new Map}}_serializeConfig({n:t,size:e,margin:i=0,rotation:n=0,center:s,radius:o,reverse:a=!1}){return[e?.join(","),s?.join(","),o,i,t,n,a].join("_")}drawNails(t,{nailsNumberStart:e=0,getNumber:i}={}){for(let n=0;n<this.config.n;n++)t.addNail({point:this.getPoint(n),number:i?i(n):n+e})}*drawRing(t,{ringSize:e,color:i}){const{n:n}=this.config,s=Math.floor(e*n);let o,a=0,r=!1;t.strokeStyle=i;for(let e=0;e<n;e++)t.beginPath(),o||(o=this.getPoint(0)),t.moveTo(...o),a=r?e:a+s,o=this.getPoint(a),t.lineTo(...o),e<n-1&&(a++,o=this.getPoint(a),t.lineTo(...o)),t.stroke(),yield,r=!r}static rotationConfig=Object.freeze({key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1+1/360,step:1/360},displayValue:(t,{key:e})=>`${Math.round(360*t[e])}°`,isStructural:!0,affectsStepCount:!1});static nailsConfig=Object.freeze({key:"n",label:"Number of nails",defaultValue:144,type:"range",attr:{min:3,max:300,step:1},isStructural:!0})}const d=e.getConfig({defaults:{isMultiColor:!0,colorCount:7,color:"#ffbb29",multicolorRange:"21",multicolorStart:32,multicolorByLightness:!0,minLightness:36,maxLightness:98}});var g=class extends h{name="Spirals";id="spirals";link="https://www.etsy.com/il-en/listing/974865185/3d-string-art-spiral-mandala-wall?ref=shop_home_active_10&frs=1";controls=[{key:"radiusIncrease",label:"Radius change",defaultValue:5.7,type:"range",attr:{min:1,max:20,step:.1}},{key:"angleStep",label:"Angle step",defaultValue:.45,type:"range",attr:{min:0,max:1,step:.01}},{key:"nSpirals",label:"Number of spirals",defaultValue:3,type:"range",attr:{min:1,max:20,step:1}},{...u.rotationConfig,defaultValue:330/360},e.getConfig({defaults:{isMultiColor:!0,colorCount:4,color:"#00d5ff",multicolorRange:1,multicolorStart:190,multicolorByLightness:!0,minLightness:50,maxLightness:88,reverseColors:!0}})];setUpDraw(){super.setUpDraw();const{nSpirals:t,rotation:i,margin:s,radiusIncrease:o,angleStep:a,colorCount:r}=this.config;this.spiralRotations=new Array(t).fill(null).map(((e,i)=>i*n/t)),this.rotationAngle=-n*i;const l=Math.min(...this.size)/2-s;this.nailsPerSpiral=Math.floor(l/o),this.angleIncrease=a/(l/50),this.color=new e(this.config),this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:r})}*generatePoints(){const{nSpirals:t}=this.config;for(let e=0;e<this.nailsPerSpiral;e++)for(let i=0;i<t;i++){const t=this.getPoint(i,e);yield{point:t,nailNumber:`${i}_${e}`}}}getPoint(t,e){const[i,n]=this.center,{radiusIncrease:s}=this.config,o=this.rotationAngle+this.angleIncrease*e+this.spiralRotations[t],a=e*s;return[i+a*Math.sin(o),n+a*Math.cos(o)]}*generateStrings(){const t=this.generatePoints();let e,i=0;this.ctx.beginPath(),this.ctx.moveTo(...this.center),this.ctx.strokeStyle=this.color.getColor(0);for(const{point:n}of t){if(this.colorMap){const t=this.colorMap.get(i);t&&(this.ctx.strokeStyle=t)}this.ctx.beginPath(),e&&(this.ctx.moveTo(...e),this.ctx.lineTo(...n)),e=n,this.ctx.stroke(),yield i++}}getStepCount(){const{nSpirals:t,radiusIncrease:e,margin:i}=this.config,n=Math.min(...this.getSize())/2-i;return Math.floor(n/e)*t}drawNails(){const t=this.generatePoints();for(const{point:e,nailNumber:i}of t)this.nails.addNail({point:e,number:i})}static thumbnailConfig={radiusIncrease:1.4,angleStep:.11}};class p extends h{name="Mandala";id="mandala";link="https://www.youtube.com/watch?v=qhbuKbxJsk8";linkText="Learn";controls=[{key:"n",label:"Number of nails",defaultValue:180,type:"range",attr:{min:3,max:240,step:1}},{key:"base",label:"Multiplication",defaultValue:2,type:"range",attr:{min:2,max:99,step:1}},{key:"layers",label:"Layers",defaultValue:7,type:"range",attr:{min:1,max:20,step:1}},u.rotationConfig,e.getConfig({defaults:{isMultiColor:!0,multicolorRange:180,multicolorStart:256,color:"#ff4d00"},exclude:["colorCount"]})];get n(){if(!this._n){const{n:t,layers:e}=this.config,i=t%e;this._n=t-i}return this._n}setUpDraw(){this._n=null,super.setUpDraw();const{layers:t,rotation:i,margin:n,layerFill:s,base:o,reverse:a}=this.config,r={size:this.size,n:this.n,margin:n,rotation:i,reverse:a};this.stringsPerLayer=s?Math.floor(this.n*s):this.n,this.circle?this.circle.setConfig(r):this.circle=new u(r),this.color=new e({...this.config,colorCount:t}),this.layerShift=Math.floor(this.n/t),this.base=o}*drawTimesTable({shift:t=0,color:e="#f00",time:i}){const n=this.n;let s=this.circle.getPoint(t);for(let o=1;o<=this.stringsPerLayer;o++){this.ctx.beginPath(),this.ctx.moveTo(...s),s=this.circle.getPoint(o+t),this.ctx.lineTo(...s);const a=o*this.base%n;this.ctx.lineTo(...this.circle.getPoint(a+t)),this.ctx.strokeStyle=e,this.ctx.stroke(),yield{instructions:`${o-1} → ${o} → ${a} → ${o}`,index:i*n+o}}}*generateStrings(){const{layers:t}=this.config;for(let e=0;e<t;e++){const t=this.color.getColor(e);yield*this.drawTimesTable({time:e,color:t,shift:this.layerShift*e})}}drawNails(){this.circle.drawNails(this.nails)}getStepCount(){const{layers:t,layerFill:e}=this.config;return(t??1)*(e?Math.floor(this.n*e):this.n)}static thumbnailConfig={n:70}}const f=["left","bottom","right","top"],m=["left","bottom","right","top"],y={left:0,bottom:Math.PI/2,right:Math.PI,top:1.5*Math.PI};var w=class extends h{name="Eye";id="eye";link="https://www.etsy.com/listing/489853161/rose-of-space-string-art-sacred-geometry?ga_order=most_relevant&ga_search_type=all&ga_view_type=gallery&ga_search_query=string+art&ref=sr_gallery_1&epik=dj0yJnU9WXNpM1BDTnNkLVBtcWdCa3AxN1J5QUZRY1FlbkJ5Z18mcD0wJm49ZXdJb2JXZmVpNVVwN1NKQ3lXMy10ZyZ0PUFBQUFBR0ZuUzZv";controls=[{key:"n",label:"Number of nails per side",defaultValue:82,type:"range",attr:{min:2,max:200,step:1}},{key:"layers",label:"Layers",defaultValue:13,type:"range",attr:{min:1,max:20,step:1}},{key:"angle",label:"Layer angle",defaultValue:30,displayValue:({angle:t})=>`${t}°`,type:"range",attr:{min:0,max:45,step:1}},{key:"color",label:"Color",type:"group",children:[{key:"color1",label:"String #1 color",defaultValue:"#11e8bd",type:"color"},{key:"color2",label:"String #2 color",defaultValue:"#6fff52",type:"color"},{key:"colorPerLayer",label:"Color per layer",defaultValue:!1,type:"checkbox"}]}];setUpDraw(){super.setUpDraw();const{n:t,angle:e,layers:i,margin:n}=this.config;this.maxSize=Math.min(...this.size)-2*n,this.nailSpacing=this.maxSize/(t-1),this.layerAngle=e*Math.PI/180,this.layers=new Array(i).fill(null).map(((t,e)=>this._getLayerProps(e)))}getPoint({index:t,angle:e,layerStart:i,rotation:n}){const s=e+n,o=i.x,a=i.y+this.nailSpacing*t,r=this.center[0],l=this.center[1],c=Math.cos(s),h=Math.sin(s);return[c*(o-r)-h*(a-l)+r,h*(o-r)+c*(a-l)+l]}*drawSide({side:t,color:e="#ffffff",angle:i,size:n,layerStart:s,layerStringCount:o}){const a=f.indexOf(t),r=f[a===f.length-1?0:a+1],l=y[t],c=y[r],h={layerStringCount:o,size:n,layerStart:s,angle:i};for(let i=0;i<=o;i++)this.ctx.beginPath(),this.ctx.moveTo(...this.getPoint({side:t,index:i,rotation:l,...h})),this.ctx.lineTo(...this.getPoint({side:r,index:i,rotation:c,...h})),this.ctx.strokeStyle=e,this.ctx.stroke(),yield i}_getLayerProps(t){const e=this._getLayerColors(t),i=this.layerAngle*t,n=this.maxSize/Math.pow(Math.cos(this.layerAngle)+Math.sin(this.layerAngle),t);return{colors:e,layerAngle:i,layerSize:n,layerStart:{x:this.center[0]-n/2,y:this.center[1]-n/2},layerStringCount:Math.floor(n/this.nailSpacing)}}_getLayerColors(t){const{color1:e,color2:i,colorPerLayer:n}=this.config;if(n){const n=t%2?e:i;return[n,n,n,n]}return[i,e,i,e]}*drawLayer(t){const{colors:e,layerAngle:i,layerSize:n,layerStart:s,layerStringCount:o}=this.layers[t];for(let t=0;t<f.length;t++)yield*this.drawSide({color:e[t],side:m[t],angle:i,size:n,layerStart:s,layerStringCount:o})}*generateStrings(){const{layers:t}=this.config;for(let e=t-1;e>=0;e--)yield*this.drawLayer(e)}getStepCount(){let t=0;const{layers:e,angle:i,n:n,margin:s}=this.config,o=i*Math.PI/180,a=Math.min(this.canvas.clientWidth,this.canvas.clientHeight)-2*s,r=a/(n-1);for(let i=0;i<e;i++){const e=a/Math.pow(Math.cos(o)+Math.sin(o),i);t+=4*(Math.floor(e/r)+1)}return t}drawNails(){const{layers:t}=this.config;for(let e=t-1;e>=0;e--){const{layerAngle:t,layerSize:i,layerStart:n,layerStringCount:s}=this.layers[e];for(let o=0;o<f.length;o++){const a=m[o],r=y[a];for(let l=0;l<=s;l++){const c={layerStringCount:s,size:i,layerStart:n,angle:t};this.nails.addNail({point:this.getPoint({sideOrder:a,index:l,rotation:r,...c}),number:`${e}_${o}_${l}`})}}}}static thumbnailConfig={n:25,layers:7}};class b{constructor(t){this.setConfig(t)}setConfig(t){if(this._serializeConfig(t)!==this.serializedConfig){const{rotation:e=0,sides:i}=this.config=t,s=n/i,o=new Array(i).fill(null).map(((t,i)=>{const o=s*i+n*e,a=-s*(i-.5)-n*e;return{cos:Math.cos(o),sin:Math.sin(o),center:{cos:Math.cos(a),sin:Math.sin(a)}}}));Object.assign(this,{sides:o,sideCount:i,sideAngle:s}),this.points?this.points.clear():this.points=new Map,Object.assign(this,this._getProps()),t.fitSize&&(Object.assign(this,this._getProps(this.getSizeAndCenter())),this.points.clear())}}getSizeAndCenter(){const{size:t,margin:e}=this.config,i=this.getBoundingRect(),n=Math.min((t[0]-2*e)/i.width,(t[1]-2*e)/i.height),s=t.map((t=>t*n)),o=[this.center[0]-n*(i.left-t[0]+i.right)/2,this.center[1]-n*(i.top-t[1]+i.bottom)/2];return this.points.clear(),{size:s,center:o}}_getProps(t){const{nailsSpacing:e,size:i,margin:n=0,center:s}=Object.assign({},this.config,t),o=s??this.config.size.map((t=>t/2)),a=Math.min(...i)/2-n,r=2*a*Math.sin(this.sideAngle/2),l=[a*Math.sin(this.sideAngle/2),a*Math.cos(this.sideAngle/2)],c=r*e,h=Math.floor(a/c);return{nailsSpacing:e,nailsPerSide:1/e,center:o,radius:a,sideSize:r,start:l,nailsDistance:c,radiusNailsCount:h,radiusNailsDistance:a/h}}_serializeConfig({size:t,margin:e=0,rotation:i=0,center:n,sides:s}){return[t?.join(","),n?.join(","),s,e,i].join("_")}getSidePoint({side:t,index:e}){const i=[t,e].join("_");if(this.points.has(i))return this.points.get(i);const n=this.start[0]-e*this.nailsDistance,{cos:s,sin:o}=this.sides[t],a=[s*n-o*this.start[1]+this.center[0],o*n+s*this.start[1]+this.center[1]];return this.points.set(i,a),a}getCenterPoint({side:t,index:e}){const i=e*this.radiusNailsDistance,{sin:n,cos:s}=this.sides[t].center;return[this.center[0]+n*i,this.center[1]+s*i]}getBoundingRect(){const t=this.sides.map(((t,e)=>this.getSidePoint({side:e,index:0}))),e=t[0],i=t.slice(1).reduce(((t,[e,i])=>({left:Math.min(t.left,e),right:Math.max(t.right,e),top:Math.min(t.top,i),bottom:Math.max(t.bottom,i)})),{left:e[0],right:e[0],top:e[1],bottom:e[1]});return i.height=i.bottom-i.top,i.width=i.right-i.left,Object.freeze(i),i}drawNails(t,{drawCenter:e=!1,drawSides:i=!0}={}){for(let n=0;n<this.sideCount;n++){const s=n*this.nailsPerSide;if(i)for(let e=0;e<this.nailsPerSide;e++)t.addNail({point:this.getSidePoint({side:n,index:e}),number:s+e});if(e)for(let e=0;e<this.radiusNailsCount;e++)t.addNail({point:this.getCenterPoint({side:n,index:e}),number:`${n}_${e}`})}}}const C=e.getConfig({defaults:{isMultiColor:!0,color:"#ff0000",multicolorRange:1,multicolorStart:0,multicolorByLightness:!0,minLightness:20,maxLightness:50},exclude:["colorCount"]});const S=e.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:264,multicolorStart:53,multicolorByLightness:!1,minLightness:30,maxLightness:70},exclude:["colorCount"]});const x=e.getConfig({defaults:{isMultiColor:!0,color:"#ffffff",multicolorRange:133,multicolorStart:239,multicolorByLightness:!1,minLightness:30,maxLightness:70,colorCount:4}});const k=e.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:22,multicolorStart:50,multicolorByLightness:!0,minLightness:40,maxLightness:95,colorCount:3,repeatColors:!0,saturation:100,reverseColors:!0},customControls:[{key:"colorPerLevel",label:"Color per level",defaultValue:!0,type:"checkbox"}]}),v=-n/6,M=new Array(6).fill(null).map(((t,e)=>Math.PI/2+v*e));var _=[class extends h{name="Star";id="star";link="https://www.etsy.com/listing/557818258/string-art-meditation-geometric-yoga?epik=dj0yJnU9Mm1hYmZKdks1eTc3bVY2TkVhS2p2Qlg0N2dyVWJxaTEmcD0wJm49MGlWSXE1SVJ2Vm0xZ0xtaGhITDBWQSZ0PUFBQUFBR0Zwd2lj";controls=[{key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:20,step:1}},{key:"sideNails",label:"Nails per side",defaultValue:40,type:"range",attr:{min:1,max:200,step:1}},{key:"ringSize",label:"Outer ring size",defaultValue:.1,type:"range",attr:{min:0,max:.5,step:({config:{sideNails:t,sides:e}})=>1/(t*e)},displayValue:({sideNails:t,sides:e,ringSize:i})=>Math.floor(i*t*e)},u.rotationConfig,{key:"colorGroup",label:"Color",type:"group",children:[{key:"innerColor",label:"Star color",defaultValue:"#2ec0ff",type:"color"},{key:"outterColor",label:"Outter color",defaultValue:"#2a82c6",type:"color"},{key:"ringColor",label:"Ring color",defaultValue:"#2ec0ff",type:"color"}]}];get n(){if(!this._n){const{n:t,sides:e}=this.config,i=t%e;this._n=t-i}return this._n}setUpDraw(){this._n=null,super.setUpDraw();const{sides:t,rotation:e,sideNails:i,margin:n=0}=this.config,s={size:this.size,n:i*t,margin:n,rotation:e};this.circle?this.circle.setConfig(s):this.circle=new u(s),this.sideAngle=2*Math.PI/t,this.nailSpacing=this.circle.radius/i,this.starCenterStart=i%1*this.nailSpacing,this.sides=new Array(t).fill(null).map(((t,e)=>{const n=e*this.sideAngle+this.circle.rotationAngle,s=e*i;return{sinSideAngle:Math.sin(n),cosSideAngle:Math.cos(n),circlePointsStart:s,circlePointsEnd:s+i}}))}getStarPoint({side:t,sideIndex:e}){const i=this.starCenterStart+e*this.nailSpacing,{sinSideAngle:n,cosSideAngle:s}=this.sides[t],[o,a]=this.circle.center;return[o+n*i,a+s*i]}getArcPoint({side:t,sideIndex:e}){return this.circle.getPoint(t*this.config.sideNails+e)}*generateStarPoints({reverseOrder:t=!1}={}){const{sides:e,sideNails:i}=this.config;for(let n=0;n<e;n++){const s=0===n?e-1:n-1;for(let e=0;e<i;e++){const o=t?i-e:e;yield{side:n,prevSide:s,sideIndex:o,point:this.getStarPoint({side:n,sideIndex:o})}}}}*drawStar(){const{innerColor:t,sideNails:e,sides:i}=this.config;this.ctx.strokeStyle=t;let n=!1;const s=i%2?2*i:i,o=i%2?Math.floor(e/2):e;let a=0,r=this.getStarPoint({side:0,sideIndex:a});for(let t=0;t<=o;t++){let l=0;const c=s-(t===o?i:0);for(let s=0;s<c;s++)this.ctx.beginPath(),this.ctx.moveTo(...r),l=l!==i-1?l+1:0,n=!n,a=n?e-t:t,r=this.getStarPoint({side:l,sideIndex:a}),this.ctx.lineTo(...r),this.ctx.stroke(),yield;a=n?a-1:a+1,r=this.getStarPoint({side:0,sideIndex:a}),this.ctx.lineTo(...r)}}*drawCircle(){const{outterColor:t,sides:e,sideNails:i}=this.config;this.ctx.strokeStyle=t;let n=this.getStarPoint({side:0,sideIndex:0}),s=!1,o=!1;const a=e%2?Math.ceil(i/2):i;let r=0;const l=e%2?4*e:2*e;for(let t=0;t<=a;t++){const c=l-(t===a?2*e:0);for(let a=0;a<c;a++){this.ctx.beginPath(),this.ctx.moveTo(...n);const a={side:r,sideIndex:s?i-t:t};n=o?this.getStarPoint(a):this.getArcPoint(a),this.ctx.lineTo(...n),this.ctx.stroke(),yield,o=!o,o&&(r=r!==e-1?r+1:0,s=!s)}n=this.getStarPoint({side:0,sideIndex:t+1})}}*generateStrings(){yield*this.drawCircle();const{ringSize:t,ringColor:e}=this.config;0!==t&&(yield*this.circle.drawRing(this.ctx,{ringSize:t,color:e})),yield*this.drawStar()}drawNails(){this.circle.drawNails(this.nails);for(const{point:t,side:e,sideIndex:i}of this.generateStarPoints())this.nails.addNail({point:t,number:i?`${e}_${i}`:0});this.circle.drawNails(this.nails)}getStepCount(){const{sides:t,sideNails:e,ringSize:i}=this.config;return 3*t*(e+(t%2?1:0))+(i?e*t:0)}static thumbnailConfig={sideNails:18}},class extends h{name="Assymetry";id="assymetry";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[u.nailsConfig,u.rotationConfig,{key:"layers",label:"Layers",type:"group",children:[{key:"layer1",label:"Layer 1",type:"group",children:[{key:"show1",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"size1",label:"Size",defaultValue:.25,type:"range",attr:{min:0,max:.5,step:({config:{n:t}})=>1/t},displayValue:({size1:t,n:e})=>Math.round(e*t),show:({show1:t})=>t},{key:"end1",label:"End Position",defaultValue:1,type:"range",attr:{min:0,max:1,step:({config:{n:t}})=>1/t},displayValue:({end1:t,n:e})=>Math.round(e*t),show:({show1:t})=>t},{key:"color1",label:"Color",defaultValue:"#a94fb0",type:"color",show:({show1:t})=>t},{key:"reverse1",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show1:t})=>t}]},{key:"layer2",label:"Layer 2",type:"group",children:[{key:"show2",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"size2",label:"Size",defaultValue:.125,type:"range",attr:{min:0,max:.5,step:({config:{n:t}})=>1/t},displayValue:({size2:t,n:e})=>Math.round(e*t),show:({show2:t})=>t},{key:"end2",label:"End Position",defaultValue:.888,type:"range",attr:{min:0,max:1,step:({config:{n:t}})=>1/t},displayValue:({end2:t,n:e})=>Math.round(e*t),show:({show2:t})=>t},{key:"color2",label:"Color",defaultValue:"#ec6ad0",type:"color",show:({show2:t})=>t},{key:"reverse2",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show2:t})=>t}]},{key:"layer3",label:"Layer 3",type:"group",children:[{key:"show3",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"size3",label:"Size",defaultValue:0,type:"range",attr:{min:0,max:.5,step:({config:{n:t}})=>1/t},displayValue:({size3:t,n:e})=>Math.round(e*t),show:({show3:t})=>t},{key:"end3",label:"End Position",defaultValue:.826,type:"range",attr:{min:0,max:1,step:({config:{n:t}})=>1/t},displayValue:({end2:t,n:e})=>Math.round(e*t),show:({show3:t})=>t},{key:"color3",label:"Color",defaultValue:"#f08ad5",type:"color",show:({show3:t})=>t},{key:"reverse3",label:"Reverse",defaultValue:!0,type:"checkbox",show:({show3:t})=>t}]}]}];setUpDraw(){super.setUpDraw(),Object.assign(this,this.getSetUp())}getSetUp(){const{rotation:t,n:e,margin:i=0}=this.config,n={size:this.getSize(),n:e,margin:i,rotation:t-.25};let s;this.circle?(s=this.circle,this.circle.setConfig(n)):s=new u(n);let o=s.indexAngle*s.radius;const a=Math.floor(s.radius/o)-1;o+=(s.radius-o*a)/a;const r=s.getPoint(0),l=a+e,c=l+a,h=new Array(3).fill(null).map(((t,e)=>d.call(this,e+1))).filter((({enable:t})=>t));function d(t){const i=Math.round(e*this.config["size"+t])+a;return{size:i,endIndex:Math.round(this.config["end"+t]*(l+a))-i,color:this.config["color"+t],enable:this.config["show"+t],isReverse:this.config["reverse"+t]}}return{circle:s,lineSpacing:o,lineNailCount:a,firstCirclePoint:r,layers:h,totalNailCount:l,totalIndexCount:c}}getPoint(t){if(t<this.lineNailCount||t>this.totalNailCount){const e=(t<this.lineNailCount?this.lineNailCount-t:t-this.totalNailCount)*this.lineSpacing;return[this.firstCirclePoint[0]-e*Math.sin(this.circle.rotationAngle),this.firstCirclePoint[1]-e*Math.cos(this.circle.rotationAngle)]}{const e=t-this.lineNailCount;return this.circle.getPoint(e)}}*drawCircle({endIndex:t,color:e,isReverse:i,size:n}){let s,o,a=!1;this.ctx.strokeStyle=e;const r=this,l=i?-1:1;for(let e=0;e<=t;e++)this.ctx.beginPath(),s?(this.ctx.moveTo(...s),this.ctx.lineTo(...this.getPoint(o+l))):this.ctx.moveTo(...this.getPoint(c(e))),o=c(a?e:e+n),s=this.getPoint(o),this.ctx.lineTo(...s),this.ctx.stroke(),yield,a=!a;function c(t){return i?r.totalIndexCount-t:t}}*generateStrings(){for(const t of this.layers)yield*this.drawCircle(t)}drawNails(){this.circle.drawNails(this.nails,{nailsNumberStart:this.lineNailCount});for(let t=0;t<this.lineNailCount;t++)this.nails.addNail({point:this.getPoint(t),number:t})}getStepCount(){const{layers:t}=this.getSetUp();return t.reduce(((t,e)=>t+e.endIndex+1),0)}static thumbnailConfig={n:50}},p,class extends h{id="spiral";name="Spiral";link="https://www.etsy.com/il-en/listing/840974781/boho-wall-decor-artwork-spiral-round";controls=[{...u.nailsConfig,defaultValue:200},{key:"repetition",label:"Repetition",defaultValue:5,type:"range",attr:{min:1,max:20,step:1}},{key:"innerLength",label:"Spiral thickness",defaultValue:.5,type:"range",attr:{min:({config:{n:t}})=>1/t,max:1,step:({config:{n:t}})=>1/t},displayValue:({n:t,innerLength:e})=>Math.round(t*e)},{...u.rotationConfig,defaultValue:.75},d];setUpDraw(){super.setUpDraw();const{n:t,rotation:i,layers:n,margin:s,colorCount:o,repetition:a}=this.config;this.layersCount=n??1,this.realRepetition=2*a-1;const r={size:this.size,n:t,margin:s,rotation:i};this.circle?this.circle.setConfig(r):this.circle=new u(r),this.color=new e({...this.config,colorCount:n??o}),o&&(this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:o}))}*drawSpiral({shift:t=0,color:e="#ffffff"}={}){const{innerLength:i,n:n}=this.config;let s=Math.round(i*n),o=0;this.ctx.strokeStyle=e;let a=t,r=this.circle.getPoint(a),l=!1;for(let t=0;s>0;t++){if(this.colorMap){const e=this.colorMap.get(t);e&&(this.ctx.strokeStyle=e)}this.ctx.beginPath(),this.ctx.moveTo(...r),a=l?a-s+1:a+s,o===this.realRepetition?(s--,o=0,a++):o++,r=this.circle.getPoint(a),this.ctx.lineTo(...r),this.ctx.stroke(),yield t,l=!l}}*generateStrings(){yield*this.drawSpiral({color:this.color.getColor(0)})}getStepCount(){const{innerLength:t,repetition:e,n:i,layers:n=1}=this.config;return Math.round(n*i*(2*t)*e)}drawNails(){this.circle.drawNails(this.nails)}static thumbnailConfig={n:60}},g,class extends p{id="wave";name="Wave";link="https://www.etsy.com/il-en/listing/943140543/personalized-gift-string-art-mandala?ref=sim_rv-5&pro=1";controls=[{...u.nailsConfig,defaultValue:200},{key:"layerFill",label:"Layer fill",defaultValue:.5,type:"range",attr:{min:({config:{n:t}})=>1/t,max:1,step:({config:{n:t}})=>1/t},displayValue:({layerFill:t})=>Math.floor(100*t)+"%"},{...u.rotationConfig,defaultValue:176/360},{key:"layers",label:"Layers",defaultValue:11,type:"range",attr:{min:1,max:20,step:1}},{key:"layerSpread",label:"Layer spread",defaultValue:.075,type:"range",attr:{min:0,max:1,step:({config:{n:t}})=>1/t},displayValue:({layerSpread:t,n:e})=>Math.round(t*e)},{key:"reverse",label:"Reverse",defaultValue:!0,type:"checkbox"},e.getConfig({defaults:{isMultiColor:!0,multicolorRange:216,multicolorStart:263,color:"#ffffff",multicolorByLightness:!0,minLightness:10,maxLightness:90},exclude:["colorCount"]})];setUpDraw(){super.setUpDraw();const{n:t,layerSpread:e}=this.config;this.layerShift=Math.round(t*e),this.base=2}*generateStrings(){const{layers:t,reverse:e}=this.config;for(let i=0;i<t;i++)yield*this.drawTimesTable({color:this.color.getColor(i),shift:this.layerShift*(e?1:-1)*i,time:i})}static thumbnailConfig={n:70}},w,class extends h{name="Freestyle";id="freestyle";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[{key:"n",label:"Circle nails",defaultValue:80,type:"range",attr:{min:1,max:300,step:1}},{key:"minNailDistance",label:"Min nail distance",defaultValue:20,type:"range",attr:{min:1,max:300,step:1}},{key:"color",label:"Color",defaultValue:"#ec6ad0",type:"color"},{key:"layers",label:"Layers",type:"group",children:[{key:"layer1",label:"Layer 1",type:"group",children:[{key:"show1",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius1",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show1:t})=>t},{key:"x1",label:"Position X",defaultValue:.5,type:"range",attr:{min:0,max:1,step:.01},show:({show1:t})=>t},{key:"y1",label:"Position Y",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01},show:({show1:t})=>t},{...u.rotationConfig,key:"rotation1",show:({show1:t})=>t},{key:"reverse1",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show1:t})=>t}]},{key:"layer2",label:"Layer 2",type:"group",children:[{key:"show2",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius2",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show2:t})=>t},{key:"x2",label:"Position X",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01},show:({show2:t})=>t},{key:"y2",label:"Position Y",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show2:t})=>t},{...u.rotationConfig,key:"rotation2",show:({show2:t})=>t},{key:"reverse2",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show2:t})=>t}]},{key:"layer3",label:"Layer 3",type:"group",children:[{key:"show3",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius3",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show3:t})=>t},{key:"x3",label:"Position X",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show3:t})=>t},{key:"y3",label:"Position Y",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show3:t})=>t},{...u.rotationConfig,key:"rotation3",show:({show3:t})=>t},{key:"reverse3",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show3:t})=>t}]}]}];setUpDraw(){super.setUpDraw(),Object.assign(this,this.getSetUp())}getSetUp(){const{n:t,margin:e=0,minNailDistance:i}=this.config,n=this.getSize(),s=Math.min(...n.map((t=>t-2*e)))/2,o=new Array(3).fill(null).map(((t,e)=>r.call(this,e+1))).filter((({enable:t})=>t)),a=Math.max(...o.map((({circle:t})=>t.config.n)));function r(o){const a=t=>this.config[t+o],r={enable:a("show"),isReverse:a("reverse"),position:[a("x"),a("y")],radius:s*a("radius"),rotation:a("rotation")},l=2*Math.PI*r.radius,c=Math.min(t,Math.floor(l/i));return{circle:new u({radius:r.radius,center:r.position.map(((t,i)=>r.radius+e+(n[i]-2*(r.radius+e))*t)),n:c,rotation:r.rotation,reverse:r.isReverse}),...r}}return{layers:o,maxShapeNailsCount:a}}getPoint(t,e){const{circle:i}=t;let n=Math.round(e*i.config.n/this.maxShapeNailsCount);return i.getPoint(n)}*generateStrings(){const{n:t,color:e}=this.config;let i;this.ctx.strokeStyle=e;for(let t=0;t<this.maxShapeNailsCount;t++)for(let e=0;e<this.layers.length;e++){const n=this.layers[e];this.ctx.beginPath(),this.ctx.moveTo(...i??this.getPoint(n,t)),0===e&&t&&this.ctx.lineTo(...this.getPoint(n,t));let s=e+1;s===this.layers.length&&(s=0),i=this.getPoint(this.layers[s],t),this.ctx.lineTo(...i),this.ctx.stroke(),yield}}drawNails(){this.config;this.layers.forEach((({circle:t},e)=>t.drawNails(this.nails,{getNumber:t=>`${e+1}_${t+1}`})))}getStepCount(){const{layers:t,maxShapeNailsCount:e}=this.getSetUp();return t.length*e-1}static thumbnailConfig={minNailDistance:3}},class extends h{name="Polygon";id="polygon";controls=[{key:"sides",label:"Sides",defaultValue:5,type:"range",attr:{min:3,max:10,step:1}},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:1,max:100,step:1}},{key:"bezier",label:"Bezier",defaultValue:2,type:"range",attr:{min:1,max:4,step:1},show:({sides:t})=>t>4},u.rotationConfig,C];defaultValues={nailsColor:"#5c5c5c",nailRadius:1};setUpDraw(){super.setUpDraw();const{n:t,rotation:i,sides:n,margin:s,isMultiColor:o}=this.config,a={sides:n,rotation:i,margin:s,size:this.getSize(),nailsSpacing:1/t,fitSize:!0};this.polygon?this.polygon.setConfig(a):this.polygon=new b(a),this.color=new e({...this.config,isMultiColor:o,colorCount:n}),this.colorMap=o?this.color.getColorMap({stepCount:this.getStepCount(),colorCount:n}):null}*generateStrings(){const{sides:t,bezier:e}=this.config,i=Math.min(e,Math.ceil(t/2)-1);let n=0,s=this.color.getColor(0);for(let e=0;e<t;e++){const o=(e+i)%t;for(let t=0;t<this.polygon.nailsPerSide;t++)this.colorMap&&(s=this.colorMap.get(n)),this.ctx.strokeStyle=s,this.ctx.beginPath(),this.ctx.moveTo(...this.polygon.getSidePoint({side:e,index:t})),this.ctx.lineTo(...this.polygon.getSidePoint({side:o,index:t})),this.ctx.stroke(),yield,n++}}getStepCount(){const{sides:t,n:e}=this.config;return t*e}drawNails(){this.polygon.drawNails(this.nails)}static thumbnailConfig={n:20}},class extends h{name="Flower";id="flower";link="https://www.sqrt.ch/Buch/fadenmodell4_100.svg";controls=[{key:"sides",label:"Sides",defaultValue:4,type:"range",attr:{min:3,max:10,step:1}},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:1,max:100,step:1}},{key:"layers",label:"Layers",defaultValue:2,type:"range",attr:{min:1,max:10,step:1}},u.rotationConfig,S];defaultValues={nailsColor:"#29f1ff",nailRadius:1,stringWidth:.5};setUpDraw(){super.setUpDraw();const{n:t,rotation:i,sides:n,layers:s,margin:o,isMultiColor:a}=this.config,r=this.getSize(),l=1/(n*s);this.polygons=new Array(s).fill(null).map(((e,s)=>new b({sides:n,rotation:i+s*l,margin:o,size:r,nailsSpacing:1/t}))),this.color=new e({...this.config,isMultiColor:a,colorCount:s}),this.colorMap=a?this.color.getColorMap({stepCount:this.getStepCount(),colorCount:s}):null}*generateStrings(){const{sides:t,layers:e}=this.config;let i=0,n=this.color.getColor(0);for(let s=0;s<e;s++){const e=this.polygons[s];for(let s=0;s<t;s++){const o=s===t-1?0:s+1;for(let t=0;t<=e.nailsPerSide;t++){this.colorMap&&(n=this.colorMap.get(i));const a=this.getCenterIndexes({polygon:e,sideIndex:t});this.ctx.strokeStyle=n,this.ctx.beginPath(),this.ctx.moveTo(...e.getSidePoint({side:s,index:t})),this.ctx.lineTo(...e.getCenterPoint({side:s,index:a[0]})),this.ctx.moveTo(...e.getSidePoint({side:s,index:t})),this.ctx.lineTo(...e.getCenterPoint({side:o,index:a[1]})),this.ctx.stroke(),yield,i++}}}}getCenterIndexes({polygon:t,sideIndex:e}){const i=t.nailsPerSide-t.radiusNailsCount;return[e<i?-i+e:e-i,t.radiusNailsCount-e]}getStepCount(){const{sides:t,n:e,layers:i}=this.config;return t*(e+1)*i}drawNails(){this.polygons.forEach((t=>t.drawNails(this.nails,{drawCenter:!0})))}static thumbnailConfig={n:20}},class extends h{name="Maurer Rose";id="maurer_rose";link="https://blog.glitch.land/en/posts/maurer-rose/";linkText="Learn";controls=[{key:"n",label:"N",defaultValue:4,type:"range",attr:{min:1,max:12,step:1},isStructural:!0},{key:"maxSteps",label:"Max steps",defaultValue:512,type:"range",attr:{min:3,max:720,step:1},isStructural:!0},{key:"angle",label:"Angle",defaultValue:341,type:"range",attr:{min:1,max:720,step:1},displayValue:({angle:t})=>`${t}°`,isStructural:!0},u.rotationConfig,x];resetStructure(){this.points&&this.points.clear(),this.calc=null}onConfigChange({control:t}){t?.isStructural&&(this.resetStructure(),!1!==t.affectsStepCount&&(this.stepCount=null))}onResize(){this.resetStructure()}setUpDraw(){super.setUpDraw();const{isMultiColor:t,colorCount:i}=this.config;this.calc||(this.calc=this.getCalc()),this.points||(this.points=new Map),this.stepCount||(this.stepCount=this.getStepCount()),this.color=new e({...this.config,isMultiColor:t,colorCount:i}),this.colorMap=t?this.color.getColorMap({stepCount:this.stepCount,colorCount:i}):null}getCalc(){const{n:t,angle:e,rotation:i,maxSteps:s}=this.config,o=this.getSize();return{n:t,angleRadians:n*e/s,radius:Math.min(...o)/2,currentSize:o,rotationAngle:2*-Math.PI*i}}getPoint(t){if(this.points.has(t))return this.points.get(t);const e=t*this.calc.angleRadians,i=this.calc.radius*Math.sin(this.calc.n*e),n=[this.center[0]-i*Math.cos(e-this.calc.rotationAngle),this.center[1]-i*Math.sin(e-this.calc.rotationAngle)];return this.points.set(t,n),n}*generatePoints(){const t=this.stepCount;for(let e=0;e<t+1;e++)yield{point:this.getPoint(e),index:e}}*generateStrings(){const t=this.generatePoints();let e;this.ctx.strokeStyle=this.color.getColor(0);for(const{point:i,index:n}of t)if(e){if(this.colorMap){const t=this.colorMap.get(n);t&&(this.ctx.strokeStyle=t)}this.ctx.beginPath(),this.ctx.moveTo(...e),e=i,this.ctx.lineTo(...i),this.ctx.stroke(),yield}else e=i}getStepCount(){if(this.stepCount)return this.stepCount;const{maxSteps:t,angle:e,n:n}=this.config;let s=t/i(t,e);return!(s%2)&&n%2&&(s/=2),Math.round(s)}drawNails(){const t=this.generatePoints();for(const{point:e,index:i}of t)this.nails.addNail({point:e,number:i})}static thumbnailConfig={maxSteps:160,angle:213}},class extends h{name="Flower of Life";id="flower_of_life";link="https://www.reddit.com/r/psychedelicartwork/comments/mk97gi/rainbow_flower_of_life_uv_reactive_string_art/";controls=[{key:"levels",label:"Levels",defaultValue:3,type:"range",attr:{min:1,max:10,step:1},isStructural:!0},{key:"density",label:"Density",defaultValue:10,type:"range",attr:{min:1,max:50,step:1},isStructural:!0},{key:"globalRotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:30,step:1},displayValue:(t,{key:e})=>`${t[e]}°`,isStructural:!0,affectsStepCount:!1},{key:"fillGroup",label:"Fill",type:"group",children:[{key:"fill",label:"Show fill",defaultValue:!0,type:"checkbox",isStructural:!0},{key:"fillColor",label:"Fill color",defaultValue:"#292e29",type:"color",show:({fill:t})=>t}]},{key:"ringGroup",label:"Ring",type:"group",children:[{key:"renderRing",label:"Show outer ring",type:"checkbox",defaultValue:!0,isStructural:!0},{key:"ringNailCount",label:"Ring nail count",defaultValue:144,type:"range",attr:{min:3,max:360,step:1},show:({renderRing:t})=>t,isStructural:!0},{key:"ringSize",label:"Outer ring size",defaultValue:.23,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:t})=>t,displayValue:({ringSize:t})=>`${Math.round(100*t)}%`,isStructural:!0},{key:"ringPadding",label:"Ring padding",defaultValue:.06,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:t})=>t,isStructural:!0,displayValue:({ringPadding:t})=>`${Math.round(100*t)}%`},{key:"ringColor",label:"Ring color",defaultValue:"#ceaf12",type:"color",show:({renderRing:t})=>t}]},{key:"renderTriangles",label:"Show triangles",defaultValue:!0,type:"checkbox",isStructural:!0},{key:"renderCaps",label:"Show caps",defaultValue:!0,type:"checkbox",show:({renderTriangles:t})=>t,isStructural:!0},k];defaultValues={nailsColor:"#474747"};getCalc(){const{levels:t,density:e,margin:i,globalRotation:s,renderCaps:o,fill:a,renderTriangles:r,renderRing:l,ringNailCount:c,ringSize:h,ringPadding:u}=this.config,d=s*Math.PI/180+Math.PI/6,g=l?Math.min(...(this.size??this.getSize()).map((t=>t/2-i))):null,p=l?Math.floor(h*c/2):0,f=l?g*(1-Math.cos(n*(p/c)/2)):0,m=new b({sides:6,size:this.getSize(),margin:i+f+u*g,rotation:d,fitSize:!1}).sideSize/t,y=m/(2*Math.cos(Math.PI/6)),w=new Array(t+(o?1:0)).fill(null).map(((t,e)=>2*e+1));return{edgeSize:m,triangleHeight:m*Math.sqrt(3)/2,nailsLength:y,triangleCenterDistance:m/2,nailDistance:y/e,triangleCount:6*t**2,countPerLevelSide:w,globalRotationRadians:d,fill:a,renderTriangles:r,renderCaps:o,ringNailCount:c,radius:g}}resetStructure(){this.points=null,this.calc=null}onConfigChange({control:t}){t?.isStructural&&(this.resetStructure(),!1!==t.affectsStepCount&&(this.stepCount=null))}onResize(){this.resetStructure()}setUpDraw(){super.setUpDraw();const{isMultiColor:t,levels:i,colorPerLevel:n,colorCount:s,renderRing:o,ringSize:a,...r}=this.config;if(this.calc||(this.calc=this.getCalc()),o&&a){const t={size:this.size,n:this.calc.ringNailCount,margin:r.margin,rotation:r.globalRotation};this.circle?this.circle.setConfig(t):this.circle=new u(t)}else this.circle=null;this.points||(this.points=this.getPoints()),this.stepCount||(this.stepCount=this.getStepCount(this.calc));const l=t?n?i:Math.min(s,i):1;this.color=new e({...r,isMultiColor:t,colorCount:l}),this.colorMap=t?this.color.getColorMap({stepCount:l,colorCount:l}):null}getTrianglePoints({center:t,rotation:e,isCapLevel:i,triangleIndexInSide:s}){let o;if(i){const t=(s+2)%3;o=this._getNextIndexInTriangle(t)}const a=new Array(3).fill(null).map(((e,i)=>i===o?[]:[t]));for(let s=0;s<3;s++){if(i&&s===o)continue;const r=e+s*(n/3),l=a[s],c=Math.cos(r),h=Math.sin(r);for(let e=1;e<=this.config.density;e++){const i=e*this.calc.nailDistance;l.push([t[0]+i*c,t[1]+i*h])}}return a}getPoints(){if(this.points)return this.points;const{levels:t,renderCaps:e}=this.config,i=this.calc.nailsLength,s=this.calc.triangleHeight-i,o=[],a=e?t+1:t;for(let r=0;r<a;r++){const a=e&&r===t,l=[];o.push(l);const c=this.calc.countPerLevelSide[r],h=new Array(c).fill(null).map(((t,e)=>{const n=e%2==0,o=[this.calc.triangleCenterDistance*(e-r),r*this.calc.triangleHeight+(n?i:s)];return{rotation:Math.atan(o[0]/o[1]),distanceFromCenter:Math.sqrt(o[0]**2+o[1]**2)}}));for(let t=0;t<6;t++){const e=M[t];for(let i=0;i<c;i++){if(a&&i%2==0){l.push(null);continue}const{distanceFromCenter:s,rotation:o}=h[i],r=e-o-this.calc.globalRotationRadians,c=[this.center[0]+s*Math.cos(r),this.center[1]-s*Math.sin(r)],u=this.getTrianglePoints({center:c,rotation:e+t*n/3-i*v+this.calc.globalRotationRadians,isCapLevel:a,triangleIndexInSide:i});l.push(u)}}}return o}*generateTriangleStrings({points:t,level:e,indexInSide:i}){this.ctx.strokeStyle=this.color.getColor(e);const{density:n,levels:s}=this.config,o=e===s,a=o?this._getNextIndexInTriangle(i%3):0,r=o?a:2,l=o?n:n-1;for(let e=a;e<=r;e++){const i=this._getNextIndexInTriangle(e);let s=t[e][0];for(let o=0;o<=l;o++){const a=o%2==0;this.ctx.beginPath(),this.ctx.moveTo(...s);const r=a?this.config.density-o:o,l=a?i:e;s=t[l][r],this.ctx.lineTo(...s),this.ctx.stroke(),o<n&&(s=t[l][a?r-1:r+1],this.ctx.lineTo(...s),this.ctx.stroke()),yield}}}*generateStringsBetweenTriangles({triangle1:t,triangle2:e,level:i,triangleIndex:n,triangleIndexInSide:s,isNextLevel:o,nextLevelTriangleIndex:a}){const{density:r,fillColor:l}=this.config,c=this.calc.countPerLevelSide[i],h=n%c%3;this.ctx.strokeStyle=l;const u=s===c-1,d=h,g=o?[this._getNextIndexInTriangle(h),this._getNextIndexInTriangle(h,-1)]:[d,this._getNextIndexInTriangle(d,s%2?1:-1)];for(let t=0;t<2;t++){const e=p.call(this,t);for(const{pointIndex:t,triangle1Points:i,triangle2Points:n}of e)this.ctx.beginPath(),this.ctx.moveTo(...i[t]),this.ctx.lineTo(...n[t]),this.ctx.stroke(),yield}function*p(i){const n=g[i],s=function(){return o?this._getNextIndexInTriangle(n):0===i&&u?1:1===i&&u?0:this._getNextIndexInTriangle(n,1)}.call(this),a=t[n],l=e[s],c=i?r:r-1;if(0===i)for(let t=0;t<=c;t++)yield{pointIndex:r-t,triangle1Points:a,triangle2Points:l};else for(let t=c;t>=1;t--)yield{pointIndex:r-t,triangle1Points:a,triangle2Points:l}}}_getNextIndexInTriangle(t,e=1){const i=t+e;return i<0?2:i>2?0:i}*generateStrings(){const{fill:t,renderTriangles:e,renderCaps:i,levels:n,renderRing:s,ringSize:o,ringColor:a}=this.config,r=this.getPoints();let l=-1;for(const s of r){l++;const o=l===n;let a=-1;const c=s.length-1;for(const h of s){a++;const u=this.calc.countPerLevelSide[l],d=a%u;if(t&&!o&&(0===a&&(yield*this.generateStringsBetweenTriangles({triangle1:s[c],triangle2:h,level:l,triangleIndex:c,triangleIndexInSide:c%u})),a!==c&&(yield*this.generateStringsBetweenTriangles({triangle1:h,triangle2:s[a+1],level:l,triangleIndex:a,triangleIndexInSide:d})),d%2==0&&(i||l<n-1))){const t=Math.floor(a/u)*this.calc.countPerLevelSide[l+1]+d+1;yield*this.generateStringsBetweenTriangles({triangle1:h,triangle2:r[l+1][t],level:l,triangleIndex:a,triangleIndexInSide:d,isNextLevel:!0,nextLevelTriangleIndex:t})}const g=a%this.calc.countPerLevelSide[l];e&&(!o||g%2)&&(yield*this.generateTriangleStrings({points:h,level:l,indexInSide:g}))}}s&&o&&(yield*this.circle.drawRing(this.ctx,{ringSize:o/2,color:a}))}getStepCount(t){if(this.stepCount)return this.stepCount;t||(t=this.getCalc());const{levels:e,density:i,fill:n,renderTriangles:s,renderCaps:o}=this.config,{triangleCount:a,ringNailCount:r=0}=t,l=n?2*i:0,c=e+(o?1:0);return a*((s?3*i:0)+l)+(s&&o?6*e*(i+1):0)+l*(c-1)*6*c/2+r}drawNails(){const t=this.getPoints();let e=0;for(const i of t)for(const t of i)if(null!=t)for(const i of t)for(const t of i)this.nails.addNail({point:t,number:e++});this.circle&&this.circle.drawNails(this.nails)}static thumbnailConfig={levels:3,density:3,fill:!1,renderRing:!0}}];const P={controls:document.querySelector("#controls"),controlsPanel:document.querySelector("#controls_panel"),sidebarForm:document.querySelector("#sidebar_form")},V=new Set(["input","change"]);let L;class z{constructor({pattern:t}){this.pattern=t,this.state=this._getState()??{groups:{}},this.eventHandlers={input:new Set,change:new Set},this._toggleFieldset=t=>{if("LEGEND"===t.target.nodeName){t.target.parentElement.classList.toggle("minimized");const e=t.target.parentElement.dataset.group;this.state={...this.state,groups:{...this.state.groups,[e]:!t.target.parentElement.classList.contains("minimized")}},this._updateState(this.state)}},this._toggleFieldSetOnEnter=t=>{"LEGEND"===t.target.nodeName&&"Enter"===t.key&&this._toggleFieldset(t)},this._wrappedOnInput=t=>this._onInput(t),P.controls.addEventListener("input",this._wrappedOnInput),this._wrappedOnTouchStart=t=>this._onTouchStart(t),P.controls.addEventListener("touchstart",this._wrappedOnTouchStart),P.sidebarForm.addEventListener("click",this._toggleFieldset),P.sidebarForm.addEventListener("keydown",this._toggleFieldSetOnEnter),this.controlElements={},this.renderControls()}destroy(){P.controls.removeEventListener("input",this._wrappedOnInput),P.sidebarForm.removeEventListener("click",this._toggleFieldset),P.sidebarForm.removeEventListener("keydown",this._toggleFieldSetOnEnter),P.controls.removeEventListener("touchstart",this._wrappedOnTouchStart),P.controls.innerHTML=""}addEventListener(t,e){if(!V.has(t))throw new Error(`Unsupported event for EditorControls, "${t}"!`);if(!(e instanceof Function))throw new Error("Invalid event handler.");this.eventHandlers[t].add(e)}_triggerEvent(t,e){for(const i of this.eventHandlers[t])i(e)}_onTouchStart(t){"range"===t.target.getAttribute("type")&&(this._postponeRangeInput=!0,this.currentInputRange=t.target,this.currentInputRangeValue=t.target.value,this._rangeLockTimeout=setTimeout((()=>{this._postponeRangeInput=!1}),120),this._wrappedOnTouchEnd=t=>this._onTouchEnd(t),document.body.addEventListener("touchend",this._wrappedOnTouchEnd),this._wrappedOnRangeScroll=t=>this._onRangeScroll(t),P.controlsPanel.addEventListener("scroll",this._wrappedOnRangeScroll))}_onTouchEnd(){document.body.removeEventListener("touchend",this._wrappedOnTouchEnd),P.controlsPanel.removeEventListener("scroll",this._wrappedOnRangeScroll),this._lockRange&&(this._lockRange=!1,this.currentInputRange&&(this.currentInputRange.value=this.currentInputRangeValue)),this.currentInputRange=this.currentInputRangeValue=null}_onRangeScroll(){this._lockRange=!0}_onInput(t){return clearTimeout(L),clearTimeout(this._postponeRangeInputTimeout),this._postponeRangeInput&&"range"===t.target.getAttribute("type")?(t.preventDefault(),this._postponeRangeInputTimeout=setTimeout((()=>{this._onInput(t)}),120),!1):this._lockRange?(t.preventDefault(),!1):void this.updateInput({inputElement:t.target,originalEvent:t,deferChange:!0})}updateInput({inputElement:t,originalEvent:e,deferChange:i=!0}){const n=function(t,e){switch(t){case"range":case"number":return parseFloat(e.value);case"checkbox":return e.checked;default:return e.value}}(t.type,t),s=t.id.replace(/^config_/,"");this.pattern.setConfigValue(s,n);const{config:o,displayValue:a}=this.controlElements[s];if(a){const e=o.displayValue?o.displayValue(this.pattern.config,o):t.value;a.innerText=e}const r=Object.freeze({control:s,value:n,originalEvent:e,pattern:this.pattern});this._triggerEvent("input",r);const l=()=>{this._triggerEvent("change",r),this.updateControlsVisibility()};i?L=setTimeout(l,100):l()}_getState(){const t=localStorage.getItem("controls_state");if(t)try{return JSON.parse(t)}catch(t){return null}return null}_updateState(t){t?localStorage.setItem("controls_state",JSON.stringify(t)):localStorage.removeItem("controls_state")}updateControlsVisibility(t=this.pattern.configControls){t.forEach((t=>{if(t.show){const e=t.show(this.pattern.config),i=this.controlElements[t.key].control;i&&(e?i.removeAttribute("hidden"):i.setAttribute("hidden","hidden"))}if(t.isDisabled){const e=t.isDisabled(this.pattern.config),i=this.controlElements[t.key].input;i&&(e?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled"))}t.children&&this.updateControlsVisibility(t.children)}))}updateInputs(t){Object.entries(t).forEach((([t,e])=>{const{input:i,value:n}=this.controlElements[t];i&&("checkbox"===i.type?i.checked=e:i.value=e,n&&(n.innerText=e))}))}renderControls(t=P.controls,e){const i=e??this.pattern.configControls;t.innerHTML="";const n=document.createDocumentFragment();i.forEach((t=>{const e=`config_${t.key}`,i=this.controlElements[t.key]={config:t};let s;if("group"===t.type){s=document.createElement("fieldset"),s.setAttribute("data-group",t.key);const e=document.createElement("legend");e.setAttribute("tabindex","0"),e.innerText=t.label,s.appendChild(e),s.className="control control_group","minimized"===t.defaultValue&&(s.classList.add("minimized"),this.state.groups[t.key]=!1);const i=document.createElement("div");s.appendChild(i),this.renderControls(i,t.children)}else{s=document.createElement("div"),s.className="control";const n=document.createElement("label");n.innerHTML=t.label,n.setAttribute("for",e);const o=i.input=document.createElement("input");o.setAttribute("type",t.type);const a=this.pattern.config[t.key]??t.defaultValue;if(t.attr&&Object.entries(t.attr).forEach((([t,e])=>{const i=e instanceof Function?e(this.pattern):e;o.setAttribute(t,i)})),"checkbox"===t.type)o.checked=a,s.appendChild(o),s.appendChild(n);else{s.appendChild(n),s.appendChild(o),o.value=a;const e=i.displayValue=document.createElement("span");e.id=`config_${t.key}_value`,e.innerText=t.displayValue?t.displayValue(this.pattern.config,t):a,e.className="control_input_value",s.appendChild(e)}o.id=e}this.controlElements[t.key].control=s,s.id=`control_${t.key}`,n.appendChild(s)})),t.appendChild(n),this.updateGroupsState(),requestAnimationFrame((()=>this.updateControlsVisibility()))}updateGroupsState(){P.sidebarForm.querySelectorAll("[data-group]").forEach((t=>{const e=t.dataset.group,i=this.state.groups[e];"boolean"==typeof i&&(i?t.classList.remove("minimized"):t.classList.add("minimized"))}))}}const N=document.querySelector("#size_controls"),E={sizeSelect:N.querySelector("#size_select"),sizeCustom:N.querySelector("#size_custom"),width:N.querySelector("#size_custom_width"),height:N.querySelector("#size_custom_height"),orientationSelect:N.querySelector("#size_orientation_select")};function I(t,e=300){return Math.floor(t/2.54*e)}const R=[Math.floor(window.screen.width),Math.floor(window.screen.height)],A=[{id:"fit",name:"Fit to screen"},{id:"A4",value:[20,28].map((t=>I(t))),orientationSelect:!0},{id:"A3",value:[28,40].map((t=>I(t))),orientationSelect:!0},{id:"screen",name:`Screen size (${R.join("x")})`,value:R},{id:"custom",name:"Custom..."}];const T=/^\-?\d+(\.\d+)?$/,D=/^(?:!)([01])$/;function B(t,e){const i=e.replace(/(?:~)(\d+)(?:_)/g,((t,e)=>new Array(+e).fill("_").join(""))).split("_").map((t=>{if(""===t)return null;if(T.test(t))return parseFloat(t);const e=t.match(D);return e?"1"===e[1]:t})),n=Object.keys(t.defaultConfig);return i.reduce(((t,e,i)=>{if(null!==e){const s=n[i];return{...t,[s]:e}}return t}),{})}async function O({canvas:t,pattern:e}){const i=t.toDataURL(),n=await(await fetch(i)).blob(),s=[new File([n],e.name+".jpg",{type:n.type,lastModified:(new Date).getTime()})];return{url:window.location.href,files:s,title:document.title,text:"String Art Studio - "+e.name}}window.addEventListener("error",(function(t){alert("Error: "+t.message)}));const F={canvas:document.querySelector("canvas"),patternLink:document.querySelector("#pattern_link"),downloadBtn:document.querySelector("#download_btn"),downloadNailsBtn:document.querySelector("#download_nails_btn"),resetBtn:document.querySelector("#reset_btn"),shareBtn:document.querySelector("#share_btn"),playerBtn:document.querySelector("#player_btn"),buttons:document.querySelector("#buttons"),instructionsLink:document.querySelector("#pattern_select_dropdown_instructions")},$=_.map((t=>new t(F.canvas)));let U;const q=new class{constructor(t){this.elements={player:t,step:t.querySelector("#step"),playerPosition:t.querySelector("#player_position"),playBtn:t.querySelector("#play_btn"),pauseBtn:t.querySelector("#pause_btn"),text:t.querySelector("#player_text")},this.stepCount=0,this._isPlaying=!1,this.elements.playerPosition.addEventListener("input",(({target:t})=>{this.goto(+t.value)})),this.elements.playBtn.addEventListener("click",(()=>{this.play()})),this.elements.pauseBtn.addEventListener("click",(()=>{this.pause()}))}updateStatus(t){this._isPlaying!==t&&(this.elements.player.classList.toggle("playing"),this._isPlaying=t)}update(t,{draw:e=!0}={}){this.stringArt=t,this.stepCount=t.getStepCount(),this.elements.playerPosition.setAttribute("max",this.stepCount),this.elements.step.innerText=`${this.stepCount}/${this.stepCount}`,this.elements.text.style.removeProperty("width"),this.elements.text.style.width=(this.elements.text.clientWidth||70)+"px",this.goto(this.stepCount,{updateStringArt:e})}updatePosition(t){this.elements.step.innerText=`${t}/${this.stepCount}`,this.elements.playerPosition.value=t}goto(t,{updateStringArt:e=!0}={}){this.pause(),this.updatePosition(t),e&&this.stringArt.goto(t)}setInstructions(t){}play(){this.updateStatus(!0),cancelAnimationFrame(this.renderRafId),this.stringArt.position===this.stepCount&&this.stringArt.goto(0);const t=this;!function e(){t.stringArt.drawNext().done?t.updateStatus(!1):t.renderRafId=requestAnimationFrame(e);t.updatePosition(t.stringArt.position)}()}pause(){cancelAnimationFrame(this.renderRafId),this.updateStatus(!1)}toggle(){this._isPlaying?this.pause():this.play()}}(document.querySelector("#player")),j=new class{element=document.querySelector("#size_controls");constructor({getCurrentSize:t}){const e=document.createDocumentFragment();A.forEach((t=>{const i=document.createElement("option");i.setAttribute("value",t.id),i.innerText=t.name??t.id,e.appendChild(i)})),E.sizeSelect.appendChild(e),this.selectedSize=A[0],E.sizeSelect.addEventListener("change",(e=>{const i=e.target.value,n=A.find((({id:t})=>t===i));if(this.selectedSize=n,"custom"===n.id){E.sizeCustom.removeAttribute("hidden");const[e,i]=t();E.width.value=e,E.height.value=i}else E.sizeCustom.setAttribute("hidden","hidden"),this._notifyOnChange(this.getValue());n.orientationSelect?E.orientationSelect.removeAttribute("hidden"):E.orientationSelect.setAttribute("hidden","hidden")})),E.orientationSelect.addEventListener("change",(t=>{this._notifyOnChange(this.getValue())})),E.sizeCustom.addEventListener("focusin",(t=>{t.target.select()})),E.sizeCustom.addEventListener("input",(()=>{this._notifyOnChange([E.width.value?parseInt(E.width.value):null,E.height.value?parseInt(E.height.value):null])}))}_notifyOnChange([t,e]=[]){this.element.dispatchEvent(new CustomEvent("sizechange",{detail:{width:t,height:e}}))}getValue(){if("custom"===this.selectedSize.id)return[parseInt(E.width.value,10),parseInt(E.height.value,10)];{let t=this.selectedSize.value;return this.selectedSize.orientationSelect&&"horizontal"===E.orientationSelect.value&&(t=Array.from(t).reverse()),t}}}({getCurrentSize:()=>[F.canvas.clientWidth,F.canvas.clientHeight]}),W=new class{elements={root:document.querySelector("#pattern_select_panel"),thumbnails:document.querySelector("#pattern_select_thumbnails"),toggleBtn:document.querySelector("#pattern_select_btn"),dropdown:document.querySelector("#pattern_select_dropdown")};constructor(){this.elements.toggleBtn.addEventListener("click",(()=>this.toggle()))}toggle(){this.elements.root.classList.contains("minimized")?this.open():this.pattern&&this.close()}open(){this.elements.root.classList.contains("minimized")&&(this.elements.root.classList.remove("minimized"),this.thumbnailsRendered||(this.createThumbnails(),this.thumbnailsRendered=!0),this._onClickOutside=t=>{t.target.closest("#pattern_select_panel")||this.toggle()},document.body.addEventListener("mousedown",this._onClickOutside))}close(){this.elements.root.classList.contains("minimized")||(this.elements.root.classList.add("minimized"),document.body.removeEventListener("mousedown",this._onClickOutside),this._onClickOutside=null)}setCurrentPattern(t){this.pattern=t,this.elements.toggleBtn.innerText=t?.name??"Choose a pattern"}createThumbnails(){const t=document.createDocumentFragment(),e=[];_.forEach((i=>{const n=document.createElement("canvas");n.style.width=n.style.height="100px";const s=new i(n);s.config=Object.assign({margin:1,enableBackground:!1,nailRadius:.5},i.thumbnailConfig),e.push(s);const o=document.createElement("li");t.appendChild(o);const a=document.createElement("a");a.href=`?pattern=${s.id}`,a.setAttribute("data-pattern",s.id),a.title=s.name,a.appendChild(n),o.appendChild(a)})),this.elements.thumbnails.appendChild(t),e.forEach((t=>t.draw())),this.elements.thumbnails.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();const e=t.target.closest("[data-pattern]");if(!e)return!1;this.elements.root.dispatchEvent(new CustomEvent("change",{detail:{pattern:e.dataset.pattern}})),this.toggle()}))}addOnChangeListener(t){this.elements.root.addEventListener("change",t)}removeOnChangeListener(t){this.elements.root.removeEventListener("change",t)}};let J;async function H(){if(!U)throw new Error("Can't init pattern - no current pattern available!");j.element.addEventListener("sizechange",(({detail:t})=>{!function({width:t,height:e}){F.canvas.removeAttribute("width"),F.canvas.removeAttribute("height"),t&&e?(F.canvas.style.width=`${t}px`,F.canvas.style.height=`${e}px`,F.canvas.parentElement.classList.contains("overflow")||F.canvas.parentElement.classList.add("overflow")):(F.canvas.parentElement.classList.remove("overflow"),F.canvas.removeAttribute("style")),U.draw()}(t)})),window.addEventListener("resize",(()=>U&&U.draw())),F.downloadBtn.addEventListener("click",Z),F.downloadNailsBtn.addEventListener("click",G),F.resetBtn.addEventListener("click",X);await async function(t){if(!navigator.share)return!1;const e=await O(t);return navigator.canShare(e)}({canvas:F.canvas,pattern:U})&&it(F.shareBtn)}function Z(){const t=document.createElement("a");t.download=U.name+".png",t.href=F.canvas.toDataURL("image/png"),t.setAttribute("target","download"),t.click()}function G(){const t=U.config;U.config={darkMode:!1,showNails:!0,showNailNumbers:!0,showStrings:!1,nailsColor:"#000000"},U.draw(),Z(),U.config=t,U.draw()}function X(){confirm("Are you sure you wish to reset options to defaults?")&&Y(U,{config:{}})}function Q({withConfig:t=!0}={}){q.update(U);const e=t?function(t){const{defaultConfig:e,config:i}=t,n=Object.entries(i).map((([t,i])=>i===e[t]?null:"boolean"==typeof i?"!"+(i?1:0):"number"==typeof i?parseFloat(i.toFixed(6)):i));for(;null===n[n.length-1];)n.pop();return n.length?n.join("_").replace(/\_{2,}/g,(t=>"~"+t.length+"_")):""}(U):null;history.replaceState({pattern:U.id,config:e},U.name,`?pattern=${U.id}${t&&e?`&config=${encodeURIComponent(e)}`:""}`)}function Y(t,e){et(t,e),history.pushState({pattern:t.id},t.name,"?pattern="+t.id)}function K(t){if(t?.pattern){const e=tt(t.pattern);et(e,{draw:!1,config:t.config?B(e,t.config):{}}),W.close(),U.draw()}else st(),W.open()}function tt(t){const e=$.find((({id:e})=>e===t));if(!e)throw new Error(`Pattern with id "${t}" not found!`);return e}function et(t,{config:e,draw:i=!0}={}){const n=!U;U=t,e&&(U.config=e),J&&J.destroy(),J=new z({pattern:t,config:e}),J.addEventListener("input",(()=>U.draw())),J.addEventListener("change",Q),t.link?(F.patternLink.setAttribute("href",t.link),F.patternLink.innerText=t.linkText??"Example",it(F.patternLink)):nt(F.patternLink),i&&requestAnimationFrame((()=>{U.draw()})),q.update(U,{draw:!1}),W.setCurrentPattern(t),document.title=`${t.name} - String Art Studio`,document.body.setAttribute("data-pattern",t.id),n&&(H(),document.body.querySelectorAll(".pattern_only").forEach(it))}function it(t){t.removeAttribute("hidden")}function nt(t){t.setAttribute("hidden","hidden")}function st(){U=null;F.canvas.getContext("2d").clearRect(0,0,F.canvas.width,F.canvas.height),nt(F.patternLink),W.setCurrentPattern(null),J&&J.destroy(),document.body.querySelectorAll(".pattern_only").forEach(nt),document.body.removeAttribute("data-pattern")}window.addEventListener("load",(async function(){if(function(){window.addEventListener("popstate",(({state:t})=>{K(t)}))}(),await async function(){if(navigator.serviceWorker&&"127.0.0.1"!==document.location.hostname)try{const t=await navigator.serviceWorker.register("service-worker.js");t.onupdatefound=()=>{const e=t.installing;null!=e&&(e.onstatechange=()=>{"installed"===e.state&&(navigator.serviceWorker.controller?console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."):console.log("Content is cached for offline use."))})}}catch(t){console.error("Error during service worker registration:",t)}}(),document.body.querySelectorAll(".pattern_only").forEach(nt),it(document.querySelector("main")),history.state?.pattern)K(history.state);else{const t=new URLSearchParams(document.location.search),e=t.get("pattern");if(e){const i=t.get("config");K({pattern:e,config:i})}else W.toggle()}F.downloadBtn.addEventListener("click",Z),F.downloadNailsBtn.addEventListener("click",G),F.resetBtn.addEventListener("click",X),F.shareBtn.addEventListener("click",(async()=>await async function(t){try{navigator.share(await O(t))}catch(t){alert("Error: "+t.message)}}({canvas:F.canvas,pattern:U}))),F.playerBtn.addEventListener("click",(()=>{document.querySelectorAll("#buttons [data-toggle-for]").forEach((t=>{t.classList.contains("active")&&t.click()}))})),F.instructionsLink.addEventListener("click",(t=>{t.preventDefault(),history.pushState({pattern:null},"String Art Studio","./"),st()})),W.addOnChangeListener((({detail:t})=>{Y(tt(t.pattern))})),document.body.addEventListener("click",(t=>{const e=t.target.closest("[data-toggle-for]");if(e){const t=e.dataset.toggleFor;e.classList.toggle("active");document.querySelector("#"+t).classList.toggle("open"),document.body.classList.toggle("dialog_"+t),U&&U.draw({position:U.position})}}))}));
//# sourceMappingURL=index.a74a20fe.js.map
