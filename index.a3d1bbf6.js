const t=2*Math.PI;class e{constructor(t,e){this.context=t.getContext("2d"),this.setConfig(e),this.nails=[]}setConfig({nailRadius:t,darkMode:e}){this.nailRadius=t,this.nailsColor=e?"#ffffff":"#000000",this.nails=[]}addNail(t){this.nails.push(t)}fill(){this.context.globalCompositeOperation="source-over",this.context.beginPath(),this.nails.forEach((({point:[e,i]})=>{this.context.moveTo(e+this.nailRadius,i),this.context.arc(e,i,this.nailRadius,0,t)})),this.context.fillStyle=this.nailsColor,this.context.fill(),this.nails=[]}}const i=[{key:"general",label:"General",type:"group",children:[{key:"darkMode",label:"Dark mode",defaultValue:!0,type:"checkbox"},{key:"showStrings",label:"Show strings",defaultValue:!0,type:"checkbox",isDisabled:({showNails:t})=>!t},{key:"showNails",label:"Show nails",defaultValue:!0,type:"checkbox",isDisabled:({showStrings:t})=>!t},{key:"nailRadius",label:"Nail size",defaultValue:1,type:"range",attr:{min:1,max:5,step:1},show:({showNails:t})=>t},{key:"stringWidth",label:"String width",defaultValue:1,type:"range",attr:{min:1,max:4,step:.2}}]}];function s(t){return t.reduce(((t,{key:e,defaultValue:i,children:n})=>n?{...t,...s(n)}:{...t,[e]:i}),{})}var n=class{constructor(t){if(!t)throw new Error("Canvas not specified!");this.canvas=t,this.ctx=this.canvas.getContext("2d");const e=window.devicePixelRatio||1,i=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1;this.pixelRatio=e/i}get configControls(){return(this.controls??[]).concat(i)}get defaultConfig(){return this._defaultConfig||(this._defaultConfig=s(this.configControls)),this._defaultConfig}get config(){return this._config??this.defaultConfig}set config(t){this._config=Object.assign({},this.defaultConfig,t)}setUpDraw(){this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height");const t=[this.canvas.clientWidth,this.canvas.clientHeight],[i,s]=this.size=t.map((t=>t*this.pixelRatio));Object.assign(this,this.size),this.canvas.setAttribute("width",i),this.canvas.setAttribute("height",s),this.center=this.size.map((t=>t/2)),this.nails?this.nails.setConfig(this.config):this.nails=new e(this.canvas,this.config),this.ctx.clearRect(0,0,...this.size),this.ctx.lineWidth=this.config.stringWidth}afterDraw(){this.config.showNails&&(this.drawNails(),this.nails.fill())}initDraw(){this.setUpDraw(this.config);const{showNails:t}=this.config;this.ctx.beginPath(),this.ctx.globalCompositeOperation="destination-over",this.ctx.fillStyle=this.config.darkMode?"#222222":"#ffffff",this.ctx.fillRect(0,0,...this.size),this.ctx.globalCompositeOperation="source-over",t&&(this.drawNails(),this.nails.fill())}draw({position:t=1/0}={}){this.initDraw();const{showStrings:e}=this.config;if(e){for(this.stringsIterator=this.generateStrings(),this.position=0;!this.drawNext().done&&this.position<t;);this.afterDraw()}}goto(t){if(t!==this.position)if(this.stringsIterator&&t>this.position){for(;!this.drawNext().done&&this.position<t;);this.afterDraw()}else this.draw({position:t})}drawNext(){const t=this.stringsIterator.next();return t.done?this.afterDraw():this.position++,t}generateStrings(t){throw new Error("generateStrings method not defined!")}getStepCount(t){throw new Error(`'getStepCount' method not implemented for string art type "${this.name}"`)}};var o=class extends n{name="Spirals";id="spirals";link="https://www.etsy.com/il-en/listing/974865185/3d-string-art-spiral-mandala-wall?ref=shop_home_active_10&frs=1";controls=[{key:"n",label:"Number of nails",defaultValue:92,type:"range",attr:{min:3,max:200,step:1}},{key:"radiusIncrease",label:"Size",defaultValue:3,type:"range",attr:{min:1,max:20,step:.2}},{key:"angleStep",label:"Angle step",defaultValue:.05,type:"range",attr:{min:.01,max:1,step:.01}},{key:"nSpirals",label:"Number of spirals",defaultValue:3,type:"range",attr:{min:1,max:20,step:1}},{key:"color",label:"String color",defaultValue:"#00ddff",type:"color"}];*generatePoints(){const{n:t,radiusIncrease:e,angleStep:i,nSpirals:s}=this.config;let n=0,o=0;const[a,r]=this.center;for(let l=0;l<t;l++){for(let t=0;t<s;t++){const e=2*t*Math.PI/s,i=[a+n*Math.sin(o+e),r+n*Math.cos(o+e)];yield i}o+=i,n+=e}}*generateStrings(){const t=this.generatePoints();let e=0;this.ctx.beginPath(),this.ctx.moveTo(...this.center),this.ctx.strokeStyle=this.config.color;let i=this.center;for(const s of t)this.ctx.beginPath(),this.ctx.moveTo(...i),i=s,this.ctx.lineTo(...s),this.ctx.strokeStyle=this.config.color,this.ctx.stroke(),yield e++}getStepCount(){const{n:t,nSpirals:e}=this.config;return t*e}drawNails(){const t=this.generatePoints();let e=0;for(const i of t)this.nails.addNail({point:i,number:""+e++})}};const a=2*Math.PI;class r{constructor(t){const{n:e,size:i,margin:s=0,rotation:n=0,center:o}=this.config=t;this.center=o??i.map((t=>t/2)),this.radius=Math.min(...this.center)-s,this.indexAngle=a/e,this.rotationAngle=-a*n}getPoint(t=0){return[this.center[0]+Math.sin(t*this.indexAngle+this.rotationAngle)*this.radius,this.center[1]+Math.cos(t*this.indexAngle+this.rotationAngle)*this.radius]}drawNails(t){for(let e=0;e<this.config.n;e++)t.addNail({point:this.getPoint(e)})}}const l=["left","bottom","right","top"],c=["left","bottom","right","top"],h={left:0,bottom:Math.PI/2,right:Math.PI,top:1.5*Math.PI};var d=class extends n{name="Eye";id="eye";link="https://www.etsy.com/listing/489853161/rose-of-space-string-art-sacred-geometry?ga_order=most_relevant&ga_search_type=all&ga_view_type=gallery&ga_search_query=string+art&ref=sr_gallery_1&epik=dj0yJnU9WXNpM1BDTnNkLVBtcWdCa3AxN1J5QUZRY1FlbkJ5Z18mcD0wJm49ZXdJb2JXZmVpNVVwN1NKQ3lXMy10ZyZ0PUFBQUFBR0ZuUzZv";controls=[{key:"n",label:"Number of nails per side",defaultValue:82,type:"range",attr:{min:2,max:200,step:1}},{key:"layers",label:"Layers",defaultValue:13,type:"range",attr:{min:1,max:20,step:1}},{key:"angle",label:"Layer angle",defaultValue:30,type:"range",attr:{min:0,max:45,step:1}},{key:"color1",label:"String #1 color",defaultValue:"#11e8bd",type:"color"},{key:"color2",label:"String #2 color",defaultValue:"#6fff52",type:"color"}];setUpDraw(){super.setUpDraw();const{n:t,angle:e}=this.config;this.maxSize=Math.min(...this.size)-40,this.nailSpacing=this.maxSize/(t-1),this.layerAngle=e*Math.PI/180}getPoint({index:t,angle:e,layerStart:i,rotation:s}){const n=e+s,o=i.x,a=i.y+this.nailSpacing*t,r=this.center[0],l=this.center[1],c=Math.cos(n),h=Math.sin(n);return[c*(o-r)-h*(a-l)+r,h*(o-r)+c*(a-l)+l]}*drawSide({side:t,color:e="#ffffff",angle:i,size:s,layerStart:n}){const o=l.indexOf(t),a=l[o===l.length-1?0:o+1],r=h[t],c=h[a],d=Math.floor(s/this.nailSpacing),g={nLayer:d,size:s,layerStart:n,angle:i};for(let i=0;i<=d;i++)this.ctx.beginPath(),this.ctx.moveTo(...this.getPoint({side:t,index:i,rotation:r,...g})),this.ctx.lineTo(...this.getPoint({side:a,index:i,rotation:c,...g})),this.ctx.strokeStyle=e,this.ctx.stroke(),yield i}*drawLayer(t){const{color1:e,color2:i}=this.config,s=[i,e,i,e],n=this.layerAngle*t,o=this.maxSize/Math.pow(Math.cos(this.layerAngle)+Math.sin(this.layerAngle),t),a={x:this.center[0]-o/2,y:this.center[1]-o/2};for(let t=0;t<l.length;t++)yield*this.drawSide({color:s[t],side:c[t],angle:n,size:o,layerStart:a})}*generateStrings(){const{layers:t}=this.config;for(let e=t-1;e>=0;e--)yield*this.drawLayer(e)}getStepCount(){let t=0;const{layers:e,angle:i,n:s}=this.config,n=i*Math.PI/180,o=Math.min(this.canvas.clientWidth,this.canvas.clientHeight)-40,a=o/(s-1);for(let i=0;i<e;i++){const e=o/Math.pow(Math.cos(n)+Math.sin(n),i);t+=4*(Math.floor(e/a)+1)}return t}drawNails(){const{n:t}=this.config;for(let e=0;e<4;e++){l[e];for(let e=0;e<t;e++);}}};var g=[class extends n{name="Times Tables";id="times_tables";link="https://www.youtube.com/watch?v=LWin7w9hF-E&ab_channel=Jorgedelatierra";controls=[{key:"n",label:"Number of nails",defaultValue:180,type:"range",attr:{min:3,max:240,step:1}},{key:"base",label:"Multiplication",defaultValue:2,type:"range",attr:{min:2,max:99,step:1}},{key:"layers",label:"Layers",defaultValue:7,type:"range",attr:{min:1,max:20,step:1}},{key:"colorGroup",label:"Color",type:"group",children:[{key:"multicolor",label:"Use multiple colors",defaultValue:!0,type:"checkbox"},{key:"multicolorRange",label:"Multicolor range",defaultValue:180,type:"range",attr:{min:1,max:360,step:1},show:({multicolor:t})=>t},{key:"multicolorStart",label:"Multicolor start",defaultValue:256,type:"range",attr:{min:0,max:360,step:1},show:({multicolor:t})=>t},{key:"color",label:"String color",defaultValue:"#ff4d00",type:"color",show:({multicolor:t})=>!t}]}];get n(){if(!this._n){const{n:t,layers:e}=this.config,i=t%e;this._n=t-i}return this._n}setUpDraw(){this._n=null,super.setUpDraw();const{layers:t,multicolorRange:e}=this.config;this.circle=new r({size:this.size,n:this.n,margin:20}),this.multiColorStep=e/t,this.layerShift=Math.floor(this.n/t)}*drawTimesTable({shift:t=0,color:e="#f00",steps:i,time:s}){const{base:n}=this.config,o=this.n,a=i??o;let r=this.circle.getPoint(t);for(let i=1;i<=a;i++){this.ctx.beginPath(),this.ctx.moveTo(...r),r=this.circle.getPoint(i+t),this.ctx.lineTo(...r);const a=i*n%o;this.ctx.lineTo(...this.circle.getPoint(a+t)),this.ctx.strokeStyle=e,this.ctx.stroke(),yield{instructions:`${i-1} → ${i} → ${a} → ${i}`,index:s*o+i}}}*generateStrings(){const{color:t,multicolor:e,layers:i}=this.config;for(let s=0;s<i;s++){const n=e?this.getTimeColor(s,i):t;yield*this.drawTimesTable({time:s,color:n,shift:this.layerShift*s})}}drawNails(){this.circle.drawNails(this.nails)}getTimeColor(t){const{multicolorStart:e,darkMode:i}=this.config;return`hsl(${e+t*this.multiColorStep}, 80%, ${i?50:40}%)`}getStepCount(){return this.config.layers*this.n}},o,class extends n{id="spiral";name="Spiral";link="https://www.etsy.com/il-en/listing/943140543/personalized-gift-string-art-mandala?ref=sim_rv-5&pro=1";controls=[{key:"n",label:"Number of nails",defaultValue:144,type:"range",attr:{min:3,max:200,step:1}},{key:"repetition",label:"Repetition",defaultValue:2,type:"range",attr:{min:1,max:60,step:1}},{key:"innerLength",label:"Spiral thickness",defaultValue:72,type:"range",attr:{min:1,max:144,step:1}},{key:"rotation",label:"Rotation",defaultValue:.49,type:"range",attr:{min:0,max:1,step:.01}},{key:"layers",label:"Layers",defaultValue:9,type:"range",attr:{min:1,max:20,step:1}},{key:"layerSpread",label:"Layer spread",defaultValue:13,type:"range",attr:{min:1,max:200,step:1}},{key:"colorGroup",label:"Color",type:"group",children:[{key:"multicolorRange",label:"Multicolor range",defaultValue:216,type:"range",attr:{min:1,max:360,step:1}},{key:"multicolorStart",label:"Multicolor start",defaultValue:263,type:"range",attr:{min:0,max:360,step:1}},{key:"multicolorByLightness",label:"Multicolor by lightness",defaultValue:!0,type:"checkbox"}]}];setUpDraw(){super.setUpDraw();const{n:t,rotation:e}=this.config;this.circle=new r({size:this.size,n:t,rotation:e,margin:20});const{layers:i,multicolorRange:s,multicolorByLightness:n,layerSpread:o}=this.config;this.multiColorStep=s/i,this.multiColorLightnessStep=n?100/i:1,this.layerShift=o}*drawSpiral({shift:t=0,color:e="#f00"}={}){const{repetition:i,innerLength:s}=this.config;this.ctx.moveTo(...this.circle.getPoint(t));let n=s,o=0;this.ctx.strokeStyle=e;for(let e=0;n;e++)this.ctx.beginPath(),this.ctx.lineTo(...this.circle.getPoint(e+n+t)),this.ctx.lineTo(...this.circle.getPoint(e+1+t)),this.ctx.stroke(),o++,o===i&&(n--,o=0),yield e}*generateStrings(){const{layers:t}=this.config;for(let e=0;e<t;e++)yield*this.drawSpiral({color:this.getLayerColor(e),shift:-this.layerShift*e})}getLayerColor(t){const{multicolorStart:e,darkMode:i,multicolorByLightness:s}=this.config,n=s?this.multiColorLightnessStep*t:i?50:40;return`hsl(${e+t*this.multiColorStep}, 80%, ${n}%)`}getStepCount(){const{innerLength:t,repetition:e,layers:i}=this.config;return i*t*e}drawNails(){this.circle.drawNails(this.nails)}},d,class extends n{name="Star";id="star";link="https://www.etsy.com/listing/557818258/string-art-meditation-geometric-yoga?epik=dj0yJnU9Mm1hYmZKdks1eTc3bVY2TkVhS2p2Qlg0N2dyVWJxaTEmcD0wJm49MGlWSXE1SVJ2Vm0xZ0xtaGhITDBWQSZ0PUFBQUFBR0Zwd2lj";controls=[{key:"n",label:"Circle of nails",defaultValue:120,type:"range",attr:{min:3,max:300,step:1}},{key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:20,step:1}},{key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01}},{key:"colorGroup",label:"Color",type:"group",children:[{key:"innerColor",label:"Star color",defaultValue:"#2ec0ff",type:"color"},{key:"outterColor",label:"Outter color",defaultValue:"#2a82c6",type:"color"}]}];get n(){if(!this._n){const{n:t,sides:e}=this.config,i=t%e;this._n=t-i}return this._n}setUpDraw(){this._n=null,super.setUpDraw();const{sides:t,rotation:e}=this.config;this.circle=new r({size:this.size,n:this.n,margin:20,rotation:e}),this.sideAngle=2*Math.PI/t;let i=Math.floor(this.n/t);this.nailSpacing=this.circle.radius/i,this.starCenterStart=i%1*this.nailSpacing,this.sideNails=i;const s=this.n/t;this.sides=new Array(t).fill(null).map(((t,e)=>{const i=e*this.sideAngle+this.circle.rotationAngle,n=e*s;return{sinSideAngle:Math.sin(i),cosSideAngle:Math.cos(i),circlePointsStart:n,circlePointsEnd:n+s}}))}getStarPoint({side:t,sideIndex:e}){const i=this.starCenterStart+e*this.nailSpacing,{sinSideAngle:s,cosSideAngle:n}=this.sides[t],[o,a]=this.circle.center;return[o+s*i,a+n*i]}*generateStarPoints({reverseOrder:t=!1}={}){for(let e=0;e<this.config.sides;e++){const i=0===e?this.config.sides-1:e-1;for(let s=0;s<this.sideNails;s++){const n=t?this.sideNails-s:s;yield{side:e,prevSide:i,sideIndex:n,point:this.getStarPoint({side:e,sideIndex:n})}}}}*drawStar(){const{innerColor:t}=this.config;let e;this.ctx.strokeStyle=t;for(const{prevSide:t,sideIndex:i,point:s}of this.generateStarPoints()){this.ctx.beginPath(),!i||i%2?this.ctx.moveTo(...s):(this.ctx.moveTo(...e),this.ctx.lineTo(...s));const n=this.sideNails-i;this.ctx.lineTo(...this.getStarPoint({side:t,sideIndex:n})),e=s,this.ctx.stroke(),yield}}*drawCircle(){const{outterColor:t,sides:e}=this.config;let i,s=!1;this.ctx.strokeStyle=t;for(const{side:t,prevSide:e,sideIndex:n,point:o}of this.generateStarPoints({reverseOrder:!0})){this.ctx.beginPath(),i||(i=this.circle.getPoint(this.sides[e].circlePointsStart)),this.ctx.moveTo(...i),this.ctx.lineTo(...o),this.ctx.stroke(),yield,this.ctx.beginPath(),this.ctx.moveTo(...o);const a=s?this.sides[e].circlePointsEnd-n:this.sides[t].circlePointsStart+n,r=this.circle.getPoint(a);this.ctx.lineTo(...r),i=this.circle.getPoint(s?this.sides[e].circlePointsEnd-n+1:this.sides[t].circlePointsStart+n-1),this.ctx.lineTo(...i),this.ctx.stroke(),s=!s,yield}}*generateStrings(){yield*this.drawCircle(),yield*this.drawStar()}drawNails(){this.circle.drawNails(this.nails);for(const{point:t}of this.generateStarPoints())this.nails.addNail({point:t});this.circle.drawNails(this.nails)}getStepCount(){const{sides:t}=this.config;return 3*(Math.floor(this.n/t)*t)}}];const u=document.querySelector("canvas"),p=document.querySelector("#pattern_select"),f=document.querySelector("#controls"),y=document.querySelector("#pattern_link"),m=g.map((t=>new t(u)));let x,S;const w=new class{constructor(t){this.elements={player:t,step:t.querySelector("#step"),stepInstructions:t.querySelector("#step_instructions"),playerPosition:t.querySelector("#player_position"),playBtn:t.querySelector("#play_btn"),pauseBtn:t.querySelector("#pause_btn")},this.stepCount=0,this.elements.playerPosition.addEventListener("input",(({target:t})=>{this.setPosition(+t.value)})),this.elements.playBtn.addEventListener("click",(()=>{this.play(),this.togglePlaying()})),this.elements.pauseBtn.addEventListener("click",(()=>{this.pause(),this.togglePlaying()}))}togglePlaying(){this.elements.player.classList.toggle("playing")}update(t){this.stringArt=t,this.stepCount=t.getStepCount(),this.elements.playerPosition.setAttribute("max",this.stepCount),this.setPosition(this.stepCount)}updatePosition(t){this.elements.step.innerText=`${t}/${this.stepCount}`,this.elements.playerPosition.value=t}setPosition(t){this.updatePosition(t),this.stringArt.goto(t)}setInstructions(t){this.elements.stepInstructions.innerText=t}play(){cancelAnimationFrame(this.renderRafId),this.stringArt.position===this.stepCount&&this.stringArt.goto(0);const t=this;!function e(){t.stringArt.drawNext().done?t.togglePlaying():t.renderRafId=requestAnimationFrame(e);t.updatePosition(t.stringArt.position)}()}pause(){cancelAnimationFrame(this.renderRafId)}}(document.querySelector("#player"));function b(t){const e=k(t.pattern);var i;p.value=e.id,P(e,{draw:!1,config:t.config?JSON.parse(t.config):null}),x.draw(),i=x.config,Object.entries(i).forEach((([t,e])=>{const i=document.querySelector(`#config_${t}`);if(i){const s=document.querySelector(`#config_${t}_value`);"checkbox"===i.type?i.checked=e:i.value=e,s&&(s.innerText=e)}}))}function k(t){const e=m.find((({id:e})=>e===t));if(!e)throw new Error(`Pattern with id "${t} not found!`);return e}function P(t,{config:e,draw:i=!0}={}){x=t,e&&(x.config=e),C(),y.setAttribute("href",t.link),i&&x.draw(),w.update(x),document.title=`${t.name} - String Art Pattern Creator`}function v(t=x.configControls){t.forEach((t=>{if(t.show){const e=t.show(x.config),i=document.querySelector(`#control_${t.key}`);i&&(e?i.removeAttribute("hidden"):i.setAttribute("hidden","hidden"))}if(t.isDisabled){const e=t.isDisabled(x.config),i=document.querySelector(`#config_${t.key}`);i&&(e?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled"))}t.children&&v(t.children)}))}function C(t=f,e=x.configControls){t.innerHTML="",e.forEach((e=>{const i=`config_${e.key}`;let s;if("group"===e.type){s=document.createElement("fieldset");const t=document.createElement("legend");t.innerText=e.label,s.appendChild(t),s.className="control control_group";const i=document.createElement("div");s.appendChild(i),C(i,e.children)}else{s=document.createElement("div"),s.className="control";const t=document.createElement("label");t.innerHTML=e.label,t.setAttribute("for",i);const n=document.createElement("input");n.setAttribute("type",e.type);const o=x.config[e.key]??e.defaultValue;if(e.attr&&Object.entries(e.attr).forEach((([t,e])=>{const i=e instanceof Function?e(x):e;n.setAttribute(t,i)})),"checkbox"===e.type)n.checked=o,s.appendChild(n),s.appendChild(t);else{s.appendChild(t),s.appendChild(n),n.value=o;const i=document.createElement("span");i.id=`config_${e.key}_value`,i.innerText=o,i.className="control_input_value",s.appendChild(i)}n.id=i}s.id=`control_${e.key}`,t.appendChild(s)})),requestAnimationFrame((()=>v()))}!function(){if(function(){f.addEventListener("input",(t=>{requestAnimationFrame((()=>{clearTimeout(S);const e=function(t,e){switch(t){case"range":return parseFloat(e.value);case"checkbox":return e.checked;default:return e.value}}(t.target.type,t.target),i=t.target.id.replace(/^config_/,"");x.config=Object.freeze({...x.config,[i]:e});const s=document.querySelector("#"+t.target.id+"_value");s&&(s.innerText=t.target.value),x.draw(),S=setTimeout((()=>{w.update(x,{goToEnd:!1});const t=JSON.stringify(x.config);history.replaceState({pattern:x.id,config:t},x.name,`?pattern=${x.id}&config=${encodeURIComponent(t)}`),v()}),100)}))})),m.forEach((t=>{const e=document.createElement("option");e.innerText=t.name,e.value=t.id,p.appendChild(e)})),p.addEventListener("change",(t=>{const e=t.target.value;P(k(e)),history.pushState({pattern:e},e,"?pattern="+e)}))}(),function(){window.addEventListener("popstate",(({state:t})=>{b(t)}))}(),history.state?.pattern)b(history.state);else{const t=new URLSearchParams(document.location.search),e=t.get("pattern");if(e){const i=t.get("config");b({pattern:e,config:i})}else P(m[0])}window.addEventListener("resize",(()=>x.draw()))}();
//# sourceMappingURL=index.a3d1bbf6.js.map
