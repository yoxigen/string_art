let t,e;class i{#t={};addEventListener(t,e){let i=this.#t[t]??=[];return i.includes(e)||i.push(e),()=>{let t=i.indexOf(e);-1!==t&&i.splice(t,1)}}removeEventListener(t,e){let i=this.#t[t];if(!i)return;let n=i.indexOf(e);-1!==n&&i.splice(n,1)}emit(t,e){this.#t[t]?.forEach(t=>t(e))}}const n=new class extends i{#e=!1;#i="auto";get instructionsMode(){return this.#i}set instructionsMode(t){t!==this.#i&&(this.#i=t,this.emit("instructionsModeChange",t))}get showInstructions(){return this.#e}set showInstructions(t){t!==this.#e&&(this.#e=t,this.emit("showInstructionsChange",{showInstructions:t}))}};class s{viewer;elements;stepCount;#n;#s;#r;constructor(t,e){this.viewer=e,this.elements={player:t,step:t.querySelector("#step"),playerPosition:t.querySelector("#player_position"),playBtn:t.querySelector("#play_btn"),pauseBtn:t.querySelector("#pause_btn"),text:t.querySelector("#player_text")},this.stepCount=0,this.#n=!1,this.elements.playerPosition.addEventListener("input",({target:t})=>{"value"in t&&this.goto(+t.value)}),this.elements.playBtn.addEventListener("click",()=>{this.play({restartIfAtEnd:!0})}),this.elements.pauseBtn.addEventListener("click",()=>{this.pause()}),e.addEventListener("positionChange",({changeBy:t})=>this.advance(t)),e.addEventListener("click",()=>this.#n?this.pause():this.advance()),e.addEventListener("touchStart",()=>this.play({speed:200})),e.addEventListener("touchEnd",()=>this.pause()),n.addEventListener("showInstructionsChange",({showInstructions:t})=>{t&&this.#r?.()})}updateStatus(t){this.#n!==t&&(this.elements.player.classList.toggle("playing"),this.#n=t)}update(t,{draw:e=!0}={}){this.stepCount=t,this.elements.playerPosition.setAttribute("max",String(this.stepCount)),this.elements.step.innerText=`${this.stepCount}/${this.stepCount}`,this.elements.text.style.removeProperty("width"),this.elements.text.style.width=(this.elements.text.clientWidth||70)+"px",n.showInstructions=!1,this.goto(this.stepCount,{updateStringArt:e,showInstructions:!1})}updatePosition(t){this.elements.step.innerText=`${t}/${this.stepCount}`,this.elements.playerPosition.value=String(t)}goto(t,{updateStringArt:e=!0,showInstructions:i=!0}={}){if(!(t>this.stepCount)&&!(t<1)&&(this.#r?.(),this.pause(),this.updatePosition(t),i&&(n.showInstructions=!0),e&&this.viewer.goto(t),"auto"===n.instructionsMode&&t===this.stepCount&&n.showInstructions)){let t=setTimeout(()=>{n.showInstructions=!1},1e3);this.#r=()=>clearTimeout(t)}}advance(t=1){this.goto(Math.max(1,Math.min(this.stepCount,Number(this.elements.playerPosition.value)+t)))}setInstructions(t){}play({restartIfAtEnd:t=!1,speed:e}={}){let i=this.viewer.position===this.stepCount;if(i&&!t)return;this.updateStatus(!0),this.#s?.(),n.showInstructions=!1,i&&this.viewer.goto(0);let s=()=>{if(this.viewer.next().done)this.updateStatus(!1);else if(e){let t=setTimeout(s,e);this.#s=()=>clearTimeout(t)}else{let t=requestAnimationFrame(s);this.#s=()=>cancelAnimationFrame(t)}this.updatePosition(this.viewer.position)};s()}pause(){this.#s?.(),this.updateStatus(!1)}toggle(){this.#n?this.pause():this.play()}}var r={};r='fieldset{border:var(--border-light);background:#ffffff08;border-radius:9px;padding-inline:.5em}fieldset>legend{cursor:pointer;opacity:.8}fieldset>legend:hover{opacity:1}div{padding-top:8px}fieldset.minimized{background:0 0;border:none;padding:0}fieldset.minimized>legend{padding:0;transform:translate(-6px)}fieldset.minimized>div{display:none}legend:before{content:"";opacity:.7;vertical-align:top;margin-inline-end:2px;font-family:string_art_studio;font-size:20px;display:inline-block}fieldset.minimized>legend:before{transform:rotate(-90deg)}';const a=new CSSStyleSheet;a.replaceSync(String(r));class o extends HTMLElement{#a;#o;constructor(){super();let t=this.attachShadow({mode:"open"});t.adoptedStyleSheets=[a],this.shadowRoot.innerHTML=`
      <fieldset>
        <legend></legend>
        <div>
            <slot></slot>
        </div>
      </fieldset>
      `,this.#a=t.querySelector("legend"),this.#o=t.querySelector("fieldset"),this.#a.addEventListener("click",()=>this.toggle())}static get observedAttributes(){return["legend","minimized"]}connectedCallback(){this.syncAttributes()}attributeChangedCallback(){this.syncAttributes()}syncAttributes(){this.hasAttribute("legend")?this.#a.textContent=this.getAttribute("legend"):(this.#o.classList.remove("minimized"),this.#a.textContent=""),this.hasAttribute("minimized")?this.#o.classList.add("minimized"):this.#o.classList.remove("minimized")}toggle(){this.#o.classList.toggle("minimized")}open(){this.#o.classList.remove("minimized")}close(){this.#o.classList.add("minimized")}}customElements.define("expandable-panel",o);var l={};l=':root{--color-accent:#ff218f;--color-accent-hover:#b11b66;--color-buttons-dialog:#212124;--color-canvas-background:#0e0e0e;--color-config:#212124;--color-gray3:#262629;--color-header:#2b2b31;--color-lighter:#ffffff87;--color-link:#68c0ff;--color-link-hover:#85ccff;--color-player:#222226;--color-text:White;--color-text-hover:#85ccff;--color-input:#c51880;--color-input-hover:#961663;--color-input-active:#e20c8c;--color-dialog-background:#212124;--color-error:#c00;--horizontal-padding:16px;--vertical-padding:12px;--logo1:#9892ff;--logo1-active:#c5c2ff;--logo2:#d4c1ff;--border-light:solid 1px #3a3a3a;--border-lighter:dotted 1px #505050;--border-dialog:solid 1px #fff3;--circular_button_width:38px;--controls-height:50px;--header-height:45px;--select-height:49px;--sidebar-form-padding-top:16px;--sidebar-width:270px;--player-mobile-height:40px;--responsive-width:600px}span{white-space:nowrap}input{appearance:none;cursor:pointer;vertical-align:middle;border:2px solid #666;border-radius:2px;width:18px;height:18px;margin:0 2px;position:relative}input:checked{background-color:var(--color-input-active);border-color:var(--color-input)}input:checked:after{content:"";border:2px solid #fff;border-width:0 2px 2px 0;width:4px;height:11px;position:absolute;top:-1px;left:4px;transform:rotate(36deg)}label{margin-top:0;margin-inline-start:2px;font-size:14px;display:inline-block;position:relative;top:1px}';const c=new CSSStyleSheet;c.replaceSync(String(l));class u extends HTMLElement{static formAssociated=!0;internals;#l;disabled=!1;#c;#u;constructor(){super();let t=this.attachShadow({mode:"open",delegatesFocus:!0});t.adoptedStyleSheets=[c],this.shadowRoot.innerHTML=`
          <span>
            <input id="checkbox" type="checkbox">
            <label for="checkbox"></label>
          </span>
        `,this.#u=t.querySelector("input"),this.#c=t.querySelector("label"),this.internals=this.attachInternals()}static get observedAttributes(){return["checked","label","disabled","name"]}attributeChangedCallback(){this.syncAttributes()}get checked(){return this.#l}set checked(t){(this.#l=t)?this.#u.checked=!0:this.#u.checked=!1,this.internals.setFormValue(this.#l?"on":null)}get value(){return this.checked}set value(t){this.checked=t}connectedCallback(){this.syncAttributes(),this.#u.addEventListener("input",()=>{this.#l=this.#u.checked,this.internals.setFormValue(this.#l?"on":null),this.dispatchEvent(new CustomEvent("input",{detail:{checked:this.#l}})),this.dispatchEvent(new CustomEvent("change",{detail:{checked:this.#l},bubbles:!0}))}),this.internals.setFormValue(this.#l?"on":null),this.tabIndex=0}syncAttributes(){this.hasAttribute("label")&&(this.#c.textContent=this.hasAttribute("label")?this.getAttribute("label"):""),this.hasAttribute("checked")&&(this.checked=!0),this.hasAttribute("disabled")&&(this.disabled=!0),this.hasAttribute("name")&&this.internals.setFormValue(this.#l?"on":null)}focus(){this.#u.focus()}blur(){this.#u.blur()}}customElements.define("string-art-checkbox",u);class d extends HTMLElement{static formAssociated=!0;internals;start=1;colorThumb=!1;reverse=!1;type="hue";#u=null;constructor(){super(),this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.innerHTML=`
        <string-art-range-input min="1" max="360" step="1" />
    `,this.#u=this.shadowRoot.querySelector("string-art-range-input"),this.internals=this.attachInternals()}static get observedAttributes(){return["start","colorthumb","value","reverse","type"]}attributeChangedCallback(t,e,i){"value"===t&&(this.value=i),"start"===t&&(this.start=parseInt(i,10),this.#d()),"reverse"===t&&(this.reverse=!!i,this.#d()),"colorthumb"===t&&(this.colorThumb=!!i,this.#h()),"type"===t&&(this.type="range"===i?"range":"hue",this.#d())}get value(){return this.#u.value}set value(t){this.#u.value=t,this.#d(),this.colorThumb&&this.#h()}connectedCallback(){this.hasAttribute("value")&&(this.value=parseInt(this.getAttribute("value"))),this.hasAttribute("colorthumb")&&(this.colorThumb=!0),this.#h(),this.#u.addEventListener("input",t=>this.#p(t))}#p(t){let e=this.value;this.internals.setFormValue(String(e)),this.dispatchEvent(new CustomEvent("input",{detail:{value:e}})),this.#d(),this.#h()}disconnectedCallback(){}focus(){}blur(){}#d(){let t="range"===this.type?`linear-gradient(to ${this.reverse?"left":"right"} in hsl ${this.value>=180?"longer":"shorter"} hue, hsl(${this.start} 100 50), hsl(${this.start+(180===this.value?181:this.value)} 100 50))`:"linear-gradient(to right in hsl longer hue, hsl(1 100 50), hsl(360 100 50))";this.#u.setAttribute("background",t)}#h(){let t=this.colorThumb?`hsl(${this.value}deg 100 50)`:"white";this.#u.setAttribute("thumbcolor",t)}}customElements.define("string-art-hue-input",d);const h="rgba(0,0,0,.2)";class p extends HTMLElement{static formAssociated=!0;internals;min;max;#u=null;#g=null;#f=.05;#m=null;#b=null;#y=null;#C=null;#S=null;#w=null;#v=null;#x;constructor(){super(),this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.innerHTML=`
          <style>
            input[type="range"] {
              width: 100%;
              appearance: none;
              -webkit-appearance: none; /* remove iOS default */
              background: transparent;
              border: none;
              margin: 2px;
              cursor: pointer;
            }

            input[type="range"]::-webkit-slider-thumb {
              appearance: none;
              -webkit-appearance: none;
              width: 16px;
              height: 16px;
              border-radius: 50%;
              background: var(--color-input);
              cursor: pointer;
              border: none;
              margin-top: -4px;
              z-index: 10;
              box-shadow: 0 0 5px rgba(0,0,0,.5)
            }

            input[type="range"]::-webkit-slider-thumb:hover {
              background: var(--color-input-hover);
            }
              
            input[type="range"]:active::-webkit-slider-thumb {
              background: var(--color-input-active);
            }

            input[type="range"]::-webkit-slider-runnable-track {
              height: 8px;
              border-radius: 4px;
              margin: 0;
            }
          </style>
          <style id="background"></style>
          <input type="range">
        `,this.#u=this.shadowRoot.querySelector('input[type="range"]'),this.#g=this.shadowRoot.querySelector("#background"),this.#f=.05,this.#b=null,this.internals=this.attachInternals()}static get observedAttributes(){return["min","max","value","step","snap","background","thumbcolor"]}attributeChangedCallback(t,e,i){let n;if("snap"===t?this.#y=this.getTickValues():this.#u&&(this.#u[t]=i),("min"===t||"max"===t)&&(this[t]=Number(i)),"value"===t&&(n=Number(i)),"background"===t&&(this.#S=i),"thumbcolor"===t&&(this.#w=i),null!=this.min&&null!=this.max&&(this.min>this.max&&(this.max=this.min,this.#u.max=String(this.min)),this.#C=(this.max-this.min)*this.#f||.05,this.#y&&null!=this.value)){let t=this.getClosestTick(n);null!=t&&(this.#b=t)}this.#k()}get value(){return Number(this.#u.value)}set value(t){this.#u.value=String(t),this.#k()}connectedCallback(){["min","max","value","step"].forEach(t=>{this.hasAttribute(t)&&(this.#u[t]=this.getAttribute(t))}),this.#y=this.getTickValues(),this.#x=new ResizeObserver(t=>{for(let e of t)e.contentRect.width,this.#k()}),this.#x.observe(this.#u),this.#u.addEventListener("input",()=>this.handleInput()),this.#u.addEventListener("keydown",t=>this.handleKeydown(t)),this.#u.addEventListener("change",()=>this.#v=null),this.tabIndex=0}disconnectedCallback(){this.#x.unobserve(this)}getTickValues(){let t=this.getAttribute("snap"),e=t?.match(/\d+(\.\d+)?/g);return e?e.map(Number).filter(t=>!isNaN(t)).sort():[]}#M(t,e){if(null==e&&(e=this.getClosestTick(t)),null==e)return!0;let i=Math.abs(t-e);return!!(i>=this.#C/2&&i>Math.abs(this.#m-e))}#N(t,e){return Math.abs(t-e)/(this.max-this.min)>=.2}focus(){this.#u.focus()}blur(){this.#u.blur()}handleInput(){let t=Number(this.#u.value),e=this.getClosestTick(t);this.internals.setFormValue(this.#u.value),null!=e&&this.#v!==e&&this.#M(t,e)&&(this.#v=e),e!==this.#v&&(null!==e?(this.#u.value=String(e),e!==this.#b&&(this.#L(),this.#b=e)):null!=this.#b&&(this.#b=null)),null!=this.#v&&null==e&&this.#N(t,this.#v)&&(this.#v=null),this.#k(),this.#m=t,this.dispatchEvent(new CustomEvent("input",{detail:{value:this.#u.value}}))}handleKeydown(t){let e;t.preventDefault();let i=Number(this.#u.step||1),n=Number(this.#u.value);if("ArrowLeft"===t.key)e=Math.max(this.min,n-i);else if("ArrowRight"===t.key)e=Math.min(this.max,n+i);else if("ArrowUp"===t.key){let t=this.#y.find(t=>t>n);void 0!==t?e=t:n!==this.max&&(e=this.max)}else if("ArrowDown"===t.key){let t=[...this.#y].reverse().find(t=>t<n);void 0!==t?e=t:n!==this.min&&(e=this.min)}return null!=e&&(this.value=e,this.#m=e,this.dispatchEvent(new CustomEvent("input",{detail:{value:e},bubbles:!0,composed:!0}))),!1}getClosestTick(t){if(!this.#y||0===this.#y.length)return null;for(let e of this.#y)if(Math.abs(t-e)<=this.#C)return e;return null}#L(){"vibrate"in navigator&&navigator.vibrate(10)}#k(){let t=this.#u.clientWidth;if(!t)return;let e=this.value-this.min,i=this.max-this.min,n=t-16,s=8+n*e/i,r=this.#y?.filter(t=>t!==this.min&&t!==this.max).map(t=>8+n*(t-this.min)/i-1),a=r?.map(t=>`transparent ${t}px, ${h} ${t}px, ${h} ${t+2}px, transparent ${t+2}px`).join(", "),o=r?.length?`linear-gradient(to right, ${a}), `:null,l=[`input[type="range"]::-webkit-slider-runnable-track {
        background: ${o||""}${this.#S??`linear-gradient(to right, var(--color-input) ${s}px, #ddd ${s}px)`};
      }${this.#S?"":`
       input[type="range"]:hover::-webkit-slider-runnable-track {
        background: ${o||""}linear-gradient(to right, var(--color-input-hover) ${s}px, #ddd ${s}px);
      }
        input[type="range"]:active::-webkit-slider-runnable-track {
        background: ${o||""}linear-gradient(to right, var(--color-input-active) ${s}px, #ddd ${s}px);
      }`}`];null!=this.#w&&l.push(`input[type="range"]::-webkit-slider-thumb { background: ${this.#w} !important}`),this.#g.innerHTML=l.join("\n")}}function g(t){t.removeAttribute("hidden")}function f(t){t.setAttribute("hidden","hidden")}function m(t,e){null!=e?e?f(t):g(t):t.hasAttribute("hidden")?g(t):f(t)}customElements.define("string-art-range-input",p);const b={controls:document.querySelector("#controls"),controlsPanel:document.querySelector("#controls_panel"),sidebarForm:document.querySelector("#sidebar_form")},y="controls_state";class C extends i{config;controlsConfig;state;controlElements={};#P=!1;#R;#z;#E;#A;#V;#T;#_;#I;#D=!1;#$;constructor(t,e){super(),this.config=e,this.controlsConfig=t,this.state=this._getState()??{groups:{}},this.#z=this.#F.bind(this),b.controls.addEventListener("input",this.#z),this.#E=this.#O.bind(this),b.controls.addEventListener("touchstart",this.#E),b.controls.addEventListener("mousedown",this.#B),this.#$=this.#q.bind(this),b.sidebarForm.addEventListener("click",this.#$),b.sidebarForm.addEventListener("keydown",this.#H),this.controlElements={},this.renderControls();let i=document.querySelector("#controls_menu"),n=document.querySelector("#controls_panel");i.addEventListener("click",t=>{if(t.target instanceof HTMLElement){let e=t.target.closest(".controls_menu_item")?.getAttribute("href");if(t.preventDefault(),e)if("#controls_top"===e)n.scrollTo({top:0,behavior:"smooth"});else{let t=document.querySelector(e);t instanceof o&&(t.open(),t.scrollIntoView({behavior:"smooth"}))}}})}destroy(){b.controls.removeEventListener("input",this.#z),b.sidebarForm.removeEventListener("click",this.#$),b.sidebarForm.removeEventListener("keydown",this.#H),b.controls.removeEventListener("touchstart",this.#E),b.controls.removeEventListener("mousedown",this.#B),b.controls.innerHTML=""}#q(t){if("LEGEND"===t.target.nodeName){t.target.parentElement.classList.toggle("minimized");let e=t.target.parentElement.dataset.group;this.state={...this.state,groups:{...this.state.groups,[e]:!t.target.parentElement.classList.contains("minimized")}},this._updateState(this.state)}}#H(t){"LEGEND"===t.target.nodeName&&"Enter"===t.key&&this.#q(t)}#B(){let t=window.getSelection();t&&t.removeAllRanges()}#O(t){S(t.target)&&(this.#P=!0,this.#T=t.target,this.#_=t.target.value,this.#I=window.setTimeout(()=>{this.#P=!1},120),this.#A=this.#G.bind(this),document.body.addEventListener("touchend",this.#A),this.#V=this.#U.bind(this),b.controlsPanel.addEventListener("scroll",this.#V))}#G(){document.body.removeEventListener("touchend",this.#A),b.controlsPanel.removeEventListener("scroll",this.#V),this.#D&&(this.#D=!1,this.#T&&(this.#T.value=this.#_)),this.#T=this.#_=null}#U(){this.#D=!0}#F(e){return(clearTimeout(t),clearTimeout(this.#R),this.#P&&S(e.target))?(e.preventDefault(),this.#R=window.setTimeout(()=>{this.#F(e)},120),!1):this.#D?(e.preventDefault(),!1):void((e.target instanceof HTMLInputElement||e.target instanceof u||S(e.target)||e.target instanceof HTMLSelectElement)&&this.updateInput({inputElement:e.target,originalEvent:e,deferChange:!0}))}updateControlDisplayValue(t){let{config:e,displayValueElement:i,input:n}=this.controlElements[t];i&&(i.innerText=String(e.displayValue?e.displayValue(this.config):n.value))}updateInput({inputElement:e,originalEvent:i,deferChange:n=!0}){let s=e.id.replace(/^config_/,""),r=function(t){if(S(t))return Number(t.value);if(t instanceof HTMLInputElement)switch(t.type){case"range":case"number":return parseFloat(t.value);case"hue":default:return t.value;case"checkbox":return t.checked}return t instanceof u?t.checked:t instanceof HTMLSelectElement?t.value:void 0}(e);if(this.config[s]===r)return;let a={control:this.controlElements[s].config,value:r,originalEvent:i};this.emit("input",a);let o=()=>{this.emit("change",a),this.updateControlsVisibility(),this.updateControlsLabels()};this.updateControlsAttributes(),this.updateControlDisplayValue(s),n?t=window.setTimeout(o,100):o()}_getState(){let t=localStorage.getItem(y);if(t)try{return JSON.parse(t)}catch(t){}return null}_updateState(t){t?localStorage.setItem(y,JSON.stringify(t)):localStorage.removeItem(y)}updateControlsAttributes(t){t||(t=this.controlsConfig),t.forEach(t=>{if("group"===t.type)this.updateControlsAttributes(t.children);else if(t.attr){let e=Object.entries(t.attr).filter(([t,e])=>e instanceof Function);if(e.length){let i=this.controlElements[t.key].input;i&&e.forEach(([e,n])=>{let s=this.getConfigValue(n,this.config);s!=i.getAttribute(e)&&(i.setAttribute(e,String(s)),"min"===e&&i.value<s||"max"===e&&i.value>s?(i.value=String(s),clearTimeout(i.updateTimeout),i.updateTimeout=window.setTimeout(()=>{this.updateInput({inputElement:i})},100)):this.updateControlDisplayValue(t.key))})}}})}updateControlsLabels(t){(t??this.controlsConfig).forEach(t=>{if(t.label instanceof Function){let{label:e,element:i}=this.controlElements[t.key],n=t.label(this.config);"checkbox"===t.type?i.setAttribute("label",n):"group"===t.type?i.setAttribute("legend",n):e&&(e.innerText=n)}"group"===t.type&&this.updateControlsLabels(t.children)})}updateControlsVisibility(t){(t??this.controlsConfig).forEach(t=>{if(t.show){let e=t.show(this.config),i=this.controlElements[t.key].element;i&&m(i,!e)}if(t.isDisabled){let e=t.isDisabled(this.config),i=this.controlElements[t.key].input;i&&(e?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled"))}t.children&&this.updateControlsVisibility(t.children)})}renderControls(t=b.controls,e,i){let n=e??this.controlsConfig;t.innerHTML="";let s=document.createDocumentFragment();i=i??1,n.forEach((t,e)=>{let i,n,r,a,o=`config_${String(t.key)}`;if("group"===t.type)(i=document.createElement("expandable-panel")).setAttribute("legend",this.getConfigValue(t.label,this.config)),i.setAttribute("data-group",String(t.key)),i.className="control control_group","minimized"===t.defaultValue&&(i.setAttribute("minimized","minimized"),this.state.groups[String(t.key)]=!1),this.renderControls(i,t.children);else{(i=document.createElement("div")).className="control","checkbox"!==t.type&&((a=document.createElement("label")).innerHTML=this.getConfigValue(t.label,this.config),a.setAttribute("for",o)),S(n=document.createElement(function(t){switch(t){case"select":return"select";case"range":return"string-art-range-input";case"hue":return"string-art-hue-input";case"checkbox":return"string-art-checkbox";default:return"input"}}(t.type)))&&n.classList.add("range-input"),n.setAttribute("tabindex",String(e));let s=this.config[t.key]??this.getConfigValue(t.defaultValue,this.config);if("select"===t.type){let e=document.createDocumentFragment();t.options.forEach(t=>{let{value:i,label:n}="string"==typeof t?{value:t,label:t}:t,s=document.createElement("option");s.setAttribute("value",i),s.innerText=n,e.appendChild(s)}),n.appendChild(e),n.value=String(s),i.appendChild(a),i.appendChild(n)}else"range"!==t.type&&n.setAttribute("type",t.type),"checkbox"===t.type?(n.checked=!!s,n.setAttribute("label",this.getConfigValue(t.label,this.config)),i.appendChild(n)):(i.appendChild(a),i.appendChild(n),setTimeout(()=>{n.value=String(s)}),(r=document.createElement("span")).id=`config_${String(t.key)}_value`,r.innerText=String(t.displayValue?t.displayValue(this.config):s),r.className="control_input_value",i.appendChild(r));t.attr&&Object.entries(t.attr).forEach(([t,e])=>{let i=this.getConfigValue(e,this.config);n.setAttribute(t,String(i))}),n.id=o}this.controlElements[t.key]={config:t,displayValueElement:r,input:n,element:i,label:a},i.id=`control_${String(t.key)}`,s.appendChild(i)}),t.appendChild(s),this.updateGroupsState(),requestAnimationFrame(()=>this.updateControlsVisibility())}updateGroupsState(){b.sidebarForm.querySelectorAll("[data-group]").forEach(t=>{if(t instanceof HTMLFieldSetElement){let e=t.dataset.group,i=this.state.groups[e];"boolean"==typeof i&&(i?t.classList.remove("minimized"):t.classList.add("minimized"))}})}getConfigValue(t,e){return t instanceof Function?t(e):t}}function S(t){return t instanceof p||t instanceof d}const w={updateOnResize:!0};class v extends i{parentElement;color;size;fixedSize;pixelRatio=1;options;#j=!0;currentSize;lastLine;lastStringCoordinates;hasInstructions=!1;currentLayerOptions;#W;#J;constructor(t,e){super(),this.options=e??w;let{updateOnResize:i=!0}=this.options;this.parentElement=t,i&&this.#Y()}#Y(){let t=new ResizeObserver(t=>{for(let e of t)this.#j||this.fixedSize||this.setSize([e.contentRect.width,e.contentRect.height]),this.#j=!1});this.#J=()=>t.disconnect(),t.observe(this.parentElement)}destroy(){this.parentElement&&(this.parentElement.innerHTML=""),this.#W?.(),this.#J?.()}get element(){throw Error("element getter not implemented!")}setColor(t){this.color=t}resetSize(){this.fixedSize=null}getSize(){let{width:t,height:e}=this.parentElement.getBoundingClientRect();return[t,e]}getLogicalSize(){return this.getSize()}setStartingPoint(t){this.lastStringCoordinates=t}startLayer(t){this.currentLayerOptions=t,t.color&&this.setColor(t.color)}endLayer(){this.currentLayerOptions=null}setFixedSize(t){this.fixedSize=null,this.setSize(t),this.fixedSize=t}enablePixelRatio(){let t=window.devicePixelRatio||1;if(this.pixelRatio=t,!1!==this.options.updateOnResize){let e=()=>{this.#W?.();let i=matchMedia(`(resolution: ${t}dppx)`);i.addEventListener("change",e),this.#W=()=>{i.removeEventListener("change",e)},this.pixelRatio=window.devicePixelRatio,this.emit("devicePixelRatioChange",{devicePixelRatio:this.pixelRatio})};e()}}disablePixelRatio(){this.pixelRatio=1,this.#W?.()}renderInstructionsForLastLine(){this.renderInstructions(...this.lastLine)}}const x=2*Math.PI;function k(t){return t<0?[1-Math.abs(t),1]:[1/(1-t),1]}function M(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function N(t,e){let i=Math.pow(10,e);return Math.round(t*i)/i}function L(t,e){return t[0]===e[0]&&t[1]===e[1]}Object.defineProperty(Number.prototype,"toFixedPrecision",{value:function(t){let e=Math.pow(10,t);return Math.round(this*e)/e},writable:!0,configurable:!0,enumerable:!1});const P=new Set(["cm","inch"]);function R(t,e){return t.map(e)}function z(t,e,i,n){if(e===i)return t;if(P.has(e)!==P.has(i)&&!n)throw Error(`Can't convert from ${e} to ${i} without DPI!`);switch(e){case"cm":switch(i){case"inch":return t/2.54;case"px":return t/2.54*n}case"inch":switch(i){case"cm":return 2.54*t;case"px":return t*n}case"px":switch(i){case"cm":return t/n*2.54;case"inch":return t/n}}}function E(t,e,i,n){return R(t,t=>z(t,e,i,n))}function A(...t){return t.reduce((t,e)=>{let i={...t,left:t.left?Math.min(t.left,e.left):e.left,right:t.right?Math.max(t.right,e.right):e.right,top:t.top?Math.min(t.top,e.top):e.top,bottom:e.bottom?Math.max(t.bottom,e.bottom):t.bottom};return Object.assign(i,{width:i.right-i.left,height:i.bottom-i.top}),i},{left:0,right:0,top:0,bottom:0,width:0,height:0})}function V(t){return t.width/t.height}function T(t,e){let i=Math.min(e[0]/t[0],e[1]/t[1]);return R(t,t=>t*i)}function _(t){return R(t,t=>t/2)}const I=.01;let D=0;class $ extends v{#S;#Z;#X;#Q;#K;constructor(t,e){super(t,e);let i=document.createElement("canvas"),n=document.createElement("canvas"),s=document.createElement("canvas");i.setAttribute("data-id",String(D++)),this.#X={strings:{canvas:i,ctx:i.getContext("2d")},nails:{canvas:n,ctx:n.getContext("2d")},instructions:{canvas:s,ctx:s.getContext("2d")}},i.id="CanvasRenderer__strings",n.id="CanvasRenderer__nails",s.id="CanvasRenderer_instructions",this.instructionsCtx.lineWidth=4,this.instructionsCtx.strokeStyle="Red",this.canvases.forEach(e=>{e.classList.add("CanvasRenderer__canvas"),t.appendChild(e),e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%"}),this.enablePixelRatio(),this.ctxs.forEach(t=>t.globalCompositeOperation="source-over"),this.addEventListener("devicePixelRatioChange",()=>{this.setSize([this.stringsCanvas.clientWidth,this.stringsCanvas.clientHeight])}),this.resetSize(!1)}get element(){return this.#X.strings.canvas}get canvases(){return[this.#X.strings.canvas,this.#X.nails.canvas,this.#X.instructions.canvas]}get ctxs(){return[this.#X.strings.ctx,this.#X.nails.ctx,this.#X.instructions.ctx]}get stringsCtx(){return this.#X.strings.ctx}get nailsCtx(){return this.#X.nails.ctx}get stringsCanvas(){return this.#X.strings.canvas}get instructionsCanvas(){return this.#X.instructions.canvas}get instructionsCtx(){return this.#X.instructions.ctx}resetSize(t=!0){super.resetSize(),this.canvases.forEach(t=>{t.removeAttribute("width"),t.removeAttribute("height"),t.style.removeProperty("width"),t.style.removeProperty("height")});let e=this.getSize();return this.canvases.forEach(t=>{t.setAttribute("width",String(e[0])),t.setAttribute("height",String(e[1]))}),this.currentSize&&L(e,this.currentSize)||(this.currentSize=e,t&&this.emit("sizeChange",{size:e})),e}setSize(t){if(!t)return this.resetSize();if(this.fixedSize)return console.warn(`Trying to set size for Renderer to [${t.join(", ")}], but size is fixed to [${this.fixedSize.join(", ")}].`),this.fixedSize;let e=t.map(t=>t*this.pixelRatio);return this.canvases.forEach(i=>{i.setAttribute("width",String(e[0])),i.setAttribute("height",String(e[1])),i.style.setProperty("width",`${t[0]}px`),i.style.setProperty("height",`${t[1]}px`)}),this.currentSize&&L(e,this.currentSize)||(this.currentSize=e,this.emit("sizeChange",{size:e})),e}resetStrings(){this.stringsCtx.clearRect(0,0,...this.getSize())}resetNails(){this.#X.nails.ctx.clearRect(0,0,...this.getSize())}setColor(t){this.#Z=t,this.stringsCtx.strokeStyle=t}setLineWidth(t){this.stringsCtx.lineWidth=t}setBackground(t){(this.#S=t)?(this.parentElement.style.background=t,this.#Q&&(this.#Q.style.background=t)):(this.parentElement.style.removeProperty("background"),this.#Q&&(this.#Q.style.background="black"))}#tt(t,e){t.globalCompositeOperation="destination-over",t.fillStyle=e,t.fillRect(0,0,...this.getSize()),t.globalCompositeOperation="source-over"}getLogicalSize(){return this.fixedSize??[this.stringsCanvas.clientWidth,this.stringsCanvas.clientHeight]}getSize(){return this.getLogicalSize().map(t=>t*this.pixelRatio)}renderLine(t,e){this.lastStringCoordinates=t,this.lineTo(e)}lineTo(t){if(!this.lastStringCoordinates)throw Error("no last string coordinates, can't lineTo");this.stringsCtx.beginPath(),this.stringsCtx.moveTo(...this.lastStringCoordinates),this.stringsCtx.lineTo(...t),this.stringsCtx.stroke(),this.lastLine=[this.lastStringCoordinates,t],this.lastStringCoordinates=t}renderNails(t,{color:e,fontSize:i,radius:n,renderNumbers:s,margin:r=0}){let a=this.stringsCanvas.width/2;this.nailsCtx.globalCompositeOperation="source-over",this.nailsCtx.beginPath(),this.nailsCtx.fillStyle=e,this.nailsCtx.textBaseline="middle",this.nailsCtx.font=`${i}px sans-serif`;let o=n+r;t.forEach(({point:[t,e],number:i})=>{if(this.nailsCtx.moveTo(t+n,e),this.nailsCtx.arc(t,e,n,0,x),s&&null!=i){let n=t<a,s=[n?t-o:t+o,e];this.nailsCtx.textAlign=n?"right":"left",this.nailsCtx.fillText(String(i),...s)}}),this.nailsCtx.fill()}showInstructions(){if(this.#K?.(),this.#Q)g(this.#Q);else{this.#Q=document.createElement("div"),this.#Q.id="CanvasRenderer__instructions";let t=document.createElement("div");t.id="CanvasRenderer__instructions_overlay",t.style=`background: ${this.parentElement.style.background??"black"}; position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.5`,this.#Q.appendChild(t),this.#Q.appendChild(this.instructionsCanvas),this.parentElement.appendChild(this.#Q)}}hideInstructions(){if(this.#Q){let t=1,e=()=>{if(t-=.02,this.#Q.style.opacity=String(t),t>0){let t=requestAnimationFrame(e);this.#K=()=>{cancelAnimationFrame(t),this.#Q.style.removeProperty("opacity")}}else f(this.#Q),this.clearInstructions(),this.#Q.style.removeProperty("opacity")};e()}}renderInstructions(t,e){this.showInstructions();let i="white",n=this.#Z??"red";this.clearInstructions(),this.instructionsCtx.clearRect(0,0,...this.getSize()),this.instructionsCtx.beginPath(),this.instructionsCtx.lineWidth=3;let s=t;this.#te(s,e,{strokeColor:i,fillColor:n}),s=e,this.instructionsCtx.stroke(),this.instructionsCtx.beginPath(),[t,e].forEach(([t,e])=>{this.instructionsCtx.moveTo(t+4,e),this.instructionsCtx.arc(t,e,4,0,x)}),this.instructionsCtx.strokeStyle=i,this.instructionsCtx.stroke(),this.instructionsCtx.fillStyle=n,this.instructionsCtx.fill(),this.hasInstructions=!0}clearInstructions(){this.hasInstructions&&(this.instructionsCtx.clearRect(0,0,...this.getSize()),this.hasInstructions=!1)}#te(t,e,{strokeColor:i="white",fillColor:n="red"}){let s=this.instructionsCtx,r=Math.atan2(e[1]-t[1],e[0]-t[0]);s.save(),s.strokeStyle=i,s.fillStyle=n,s.beginPath(),s.moveTo(t[0],t[1]),s.lineTo(e[0],e[1]),s.stroke();let a=[t[0]+(e[0]-t[0])/2,t[1]+(e[1]-t[1])/2];s.beginPath(),s.moveTo(a[0],a[1]),s.lineTo(a[0]-15*Math.cos(r-Math.PI/6),a[1]-15*Math.sin(r-Math.PI/6)),s.lineTo(a[0]-15*Math.cos(r+Math.PI/6),a[1]-15*Math.sin(r+Math.PI/6)),s.closePath(),s.fill(),s.restore()}clear(){this.ctxs.forEach(t=>t.clearRect(0,0,...this.getSize()))}toDataURL(){return this.getComposite().toDataURL()}async toBlob(t="png",e=1){return new Promise((i,n)=>{this.getComposite().toBlob(t=>t?i(t):n(),`image/${t}`,Math.max(0,Math.min(e,1)))})}getComposite(){let t=document.createElement("canvas");t.width=this.stringsCanvas.width,t.height=this.stringsCanvas.height;let e=t.getContext("2d");return this.#S&&this.#tt(e,this.#S),this.canvases.filter(t=>t!==this.instructionsCanvas).forEach(t=>e.drawImage(t,0,0)),t}}const F="prompt_dialog";function O({value:t,...e}){let i=document.querySelector(`#${F}`);return i||((i=document.createElement("input-dialog")).id=F,document.body.appendChild(i)),["title","description","submit","cancel","type","submitIcon"].forEach(t=>{null!=e[t]&&""!==e[t]?i.setAttribute(function(t){switch(t){case"title":return"dialog-title";case"submitIcon":return"submit-icon";default:return t}}(t),e[t]):i.removeAttribute(t)}),i.show(t)}const B="confirm_dialog";function q(t){let e=document.querySelector(`#${B}`);return e||((e=document.createElement("confirm-dialog")).id=B,document.body.appendChild(e)),["title","description","submit","cancel","type"].forEach(i=>{null!=t[i]&&""!==t[i]?e.setAttribute("title"===i?"dialog-title":i,t[i]):e.removeAttribute(i)}),e.show()}function H(t){let{defaultConfig:e,config:i}=t,n=Object.entries(i).map(([t,i])=>i===e[t]?null:"boolean"==typeof i?`!${+!!i}`:"number"==typeof i?parseFloat(i.toFixed(6)):i);for(;null===n[n.length-1];)n.pop();return n.length?n.join("_").replace(/\_{2,}/g,t=>"~"+t.length+"_"):""}const G=/^\-?\d+(\.\d+)?$/,U=/^(?:!)([01])$/;function j(t,{renderer:e,patternAsTemplate:i=!1}={}){let n=t.isDefaultConfig?void 0:H(t);return`?pattern=${!i?t.id:t.type}${n?`&config=${encodeURIComponent(n)}`:""}${"svg"===e?"&renderer=svg":""}`}function W(){let t=new URLSearchParams(document.location.search);return{pattern:t.get("pattern"),config:t.get("config"),name:t.get("name"),renderer:"svg"===t.get("renderer")?"svg":null}}function*J(t,e){let i=0;for(let n of t)yield{control:n,index:i,parent:e},n.children&&(yield*J(n.children,{control:n,parent:e,index:i})),i++}function Y(t,e){let i=t.attr;if(!i)return t;let n={...i};return delete n[e],{...t,attr:n}}function Z(t){return t.map(t=>{let e={...t};return t.children&&(e.children=Z(t.children)),t.attr&&(e.attr={...t.attr}),e})}function X(t,e,i){let n=Z(t),s=function(t,e){var i=({key:t})=>t===e;for(let e of J(t))if(i(e.control))return e;return null}(n,e);if(s){let{index:t,parent:e}=s;return(e?.control.children??n).splice(t+1,0,...i),n}return t}var Q=[{key:"isMultiColor",label:"Use multiple colors",defaultValue:!1,type:"checkbox",affectsNails:!1,affectsStepCount:!1},{key:"colorCount",label:"Colors count",defaultValue:7,type:"range",attr:{min:1,max:20,step:1},show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"color",label:"String color",defaultValue:"#ff4d00",type:"color",show:({isMultiColor:t})=>!t,affectsNails:!1,affectsStepCount:!1},{key:"multicolorStart",label:"Multicolor start",defaultValue:1,type:"hue",attr:{colorthumb:!0},show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"multicolorRange",label:"Multicolor range",defaultValue:360,type:"hue",attr:{start:({multicolorStart:t})=>t,type:"range"},show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"saturation",label:"Saturation",defaultValue:100,type:"range",attr:{min:0,max:100,step:1},show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"lightness",label:"Lightness",type:"group",defaultValue:"minimized",show:({isMultiColor:t})=>t,children:[{key:"multicolorByLightness",label:"Multi lightness",defaultValue:!1,type:"checkbox",show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"minLightness",label:"Minimum lightness",defaultValue:0,type:"range",attr:{min:0,max:100,step:1,snap:"50",thumbcolor:({minLightness:t})=>`hsl(0 0 ${t})`,background:"linear-gradient(to right, black, white)"},show:({multicolorByLightness:t,isMultiColor:e})=>t&&e,affectsNails:!1,affectsStepCount:!1},{key:"maxLightness",label:"Maximum lightness",defaultValue:100,type:"range",attr:{min:0,max:100,step:1,snap:"50",thumbcolor:({maxLightness:t})=>`hsl(0 0 ${t})`,background:"linear-gradient(to right, black, white)"},show:({multicolorByLightness:t,isMultiColor:e})=>t&&e,affectsNails:!1,affectsStepCount:!1}]},{key:"colorOrderGroup",type:"group",label:"Order",defaultValue:"minimized",show:({isMultiColor:t})=>t,children:[{key:"reverseColors",label:"Reverse colors order",defaultValue:!1,type:"checkbox",show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"repeatColors",label:"Repeat colors",defaultValue:!0,type:"checkbox",show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"mirrorColors",label:"Mirror Colors",defaultValue:!1,type:"checkbox",show:({isMultiColor:t,repeatColors:e})=>t&&e,affectsNails:!1,affectsStepCount:!1}]}];class K{config;multiColorStep;multiColorLightnessStep;colors;constructor(t){this.config=t;let{multicolorRange:e,colorCount:i,multicolorByLightness:n,minLightness:s=0,maxLightness:r=100,multicolorStart:a,darkMode:o,saturation:l,reverseColors:c,repeatColors:u,mirrorColors:d,isMultiColor:h}=t;if(h){if(this.multiColorStep=e/Math.max(1,i-1),this.multiColorLightnessStep=n?(r-s)/(Math.max(i,2)-1):1,this.colors=Array(i).fill(null).map((t,e)=>{let i=n?s+this.multiColorLightnessStep*e:o?50:40;return`hsl(${a+e*this.multiColorStep}, ${l}%, ${i}%)`}),u&&d){let[t,...e]=this.colors;e.pop(),this.colors=[...this.colors,...e.reverse()]}c&&this.colors.reverse()}}getColor(t){let{isMultiColor:e,colorCount:i,color:n,repeatColors:s}=this.config;return e?(t>=i&&(t=s?t%this.colors.length:this.colors.length-1),this.colors[t]):n}static getOppositeColor(t){let e=t.match(/^hsl\((\d+)(?:deg)?(?:,?\s?)(\d+%?)(?:,?\s?)(\d+%?)\)$/);if(e){let t=(Number(e[1])+180)%360;return`hsl(${t}, ${e[2]}, ${e[3]})`}return null}getColorMap({stepCount:t,colorCount:e}){if(!e)throw Error("Can't get color map, no colorCount provided!");let i=Math.floor(t/e),n=new Map;for(let t=0;t<e;t++)n.set(t*i,this.getColor(t));return n}static getConfig({include:t,exclude:e,defaults:i={},customControls:n,propMapper:s,groupLabel:r,maxColorCount:a}){return{key:"colorGroup",label:r??"Color",type:"group",children:[...n??[],...function t(e,i){return i?e.map(e=>(e.children&&(e={...e,children:t(e.children,i)}),{...e,...i(e)})):e}(function n(s){return(s??Z(Q)).filter(({key:i})=>(!e||!e.includes(i))&&(!t||t.includes(i))).map(t=>{let e={...t,defaultValue:i[t.key]??t.defaultValue};return"group"===t.type&&(e.children=n(t.children)),"colorCount"===t.key&&a&&(e.attr.max=a),Object.freeze(e)})}(),s)]}}}function tt(t,e,i){if(t===e)return!0;if("object"==typeof t&&"object"==typeof e){if(null===t!=(null===e))return!1;if(t instanceof Array&&e instanceof Array){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!tt(t[i],e[i]))return!1;return!0}return(!!i||(i=Object.keys(t)).length===Object.keys(e).length)&&!(i&&i.some(i=>!tt(t[i],e[i])))}return t===e}const te={color:"#ffffff",fontSize:10,radius:1.5,renderNumbers:!1,margin:4};class ti{nailRadius=te.radius;nailsColor=te.color;nailNumbersFontSize=te.fontSize;nails;addedPoints;addedNumbers;#ti=[];constructor(t){this.setConfig(t),this.nails=[],this.addedPoints=new Map,this.addedNumbers=new Set}setConfig({nailRadius:t,nailsColor:e,nailNumbersFontSize:i}){this.nailRadius=t,this.nailsColor=e,this.nailNumbersFontSize=i,this.nails=[],this.addedPoints&&this.addedPoints.clear()}#tn(t){if(this.addedNumbers.has(t.number))throw Error(`Nails already contains number ${t.number}.`);this.addedNumbers.add(t.number);let e=this.addedPoints.get(t.point[0]);return e?!e.has(t.point[1])&&(e.add(t.point[1]),!0):(this.addedPoints.set(t.point[0],new Set([t.point[1]])),!0)}addNail(t){this.#tn(t)&&this.nails.push(t)}addGroup(t,e){t.forEach(t=>this.#tn(t)),this.#ti.push({nails:t,options:e})}#ts(t,e,i){t.renderNails(e,{...te,...i})}draw(t,{drawNumbers:e=!0}={}){let i={color:this.nailsColor,fontSize:this.nailNumbersFontSize,radius:this.nailRadius,renderNumbers:e};this.#ts(t,this.nails,i),this.nails=[],this.addedPoints.clear(),this.#ti.forEach(({nails:e,options:n})=>{this.#ts(t,e,{...i,...n})}),this.#ti=[]}}class tn extends v{strings=[];nails=[];lineWidth=1;size=[0,0];background;constructor(t){super(null,{updateOnResize:!1}),this.size=t}resetStrings(){this.strings.length=0}resetNails(){this.nails.length=0}setLineWidth(t){this.lineWidth=t}renderLine(t,e){this.strings.push([t,e])}renderInstructions(t,e){}clearInstructions(){}lineTo(t){this.strings.push([[0,0],t])}renderNails(t,e){this.nails.push(...t)}clear(){this.resetStrings(),this.resetNails()}toDataURL(){return""}getSize(){return this.size}setSize(t){return this.size=t}setBackground(t){this.background=t}showInstructions(){}hideInstructions(){}}class ts extends tn{#tr=0;#ta=0;#to;#Z;#tl;#tc;#tu;constructor(t){super(t),this.#tl=new Map,this.#tc=[],this.#tu=this.#td(1.5)}get threadsLength(){return{total:Math.round(this.#tr),perColor:Array.from(this.#tl.entries()).map(([t,e])=>({color:t,length:e}))}}get nailCount(){return this.#ta}resetStrings(){this.#tr=0,this.#tl=new Map}renderLine(t,e){let i=M(t,e)+this.#tu;this.#tr+=i,this.#tl.set(this.#Z,this.#tl.get(this.#Z)+i),this.#to=e}resetNails(){this.#ta=0,this.#tc=[]}renderNails(t,{radius:e}){this.#ta+=t.length,this.#tu=this.#td(e),this.#tc=this.#tc.concat(t.map(({point:t})=>t))}setStartingPoint(t){this.#to=t}setColor(t){this.#Z=t,this.#tl.has(t)||this.#tl.set(t,0)}lineTo(t){if(!this.#to)throw Error("no last string coordinates, can't lineTo");this.renderLine(this.#to,t)}getInfo(){return{nailsCount:this.#ta,threadsLength:this.threadsLength,closestDistanceBetweenNails:function(t){if(t.length<2)return 1/0;let e=[...t].sort((t,e)=>t[0]-e[0]),i=[...t].sort((t,e)=>t[1]-e[1]),n=(t,e)=>{let i=t.length;if(i<=3){let e=1/0;for(let n=0;n<i;n++)for(let s=n+1;s<i;s++){let i=M(t[n],t[s]);i>=1e-8&&(e=Math.min(e,i))}return e}let s=Math.floor(i/2),r=t[s][0],a=t.slice(0,s),o=t.slice(s),l=[],c=[];for(let t of e)(t[0]<=r?l:c).push(t);let u=Math.min(n(a,l),n(o,c)),d=e.filter(t=>Math.abs(t[0]-r)<u);for(let t=0;t<d.length;t++)for(let e=t+1;e<d.length&&d[e][1]-d[t][1]<u;e++){let i=M(d[t],d[e]);i>=1e-8&&(u=Math.min(u,i))}return u};return n(e,i)}(this.#tc)}}#td(t){return x*t*2}}!function(){var t=["user-blocking","user-visible","background"];class e{constructor(){this.t=new MessageChannel,this.i=this.t.port2,this.l={},this.o=1,this.t.port1.onmessage=t=>this.h(t)}u(t){var e=this.o++;return this.l[e]=t,this.i.postMessage(e),e}p(t){delete this.l[t]}h(t){var e=t.data;if(e in this.l){var i=this.l[e];delete this.l[e],i()}}}function i(){return i.v||(i.v=new e),i.v}class n{constructor(t,e,i){void 0===i&&(i=0),this.k=t,this.T=null,this.C=null,this.m=!1,this._(e,i)}isIdleCallback(){return 0===this.T}I(){return 2===this.T}cancel(){if(!this.m)switch(this.m=!0,this.T){case 0:cancelIdleCallback(this.C);break;case 1:clearTimeout(this.C);break;case 2:i().p(this.C);break;default:throw TypeError("Unknown CallbackType")}}_(e,n){if(n&&n>0)return this.T=1,void(this.C=setTimeout(()=>{this.P()},n));if(!t.includes(e))throw TypeError("Invalid task priority : "+e);return"background"===e&&"function"==typeof requestIdleCallback?(this.T=0,void(this.C=requestIdleCallback(()=>{this.P()}))):"function"==typeof MessageChannel?(this.T=2,void(this.C=i().u(()=>{this.P()}))):(this.T=1,void(this.C=setTimeout(()=>{this.P()})))}P(){this.m||this.k()}}var s=0;class r{constructor(){this.j=null,this.M=null}isEmpty(){return null==this.j}push(t){if("object"!=typeof t)throw TypeError("Task must be an Object");t.A=s++,this.isEmpty()?(t.N=null,this.j=t):(t.N=this.M,this.M.O=t),t.O=null,this.M=t}takeNextTask(){if(this.isEmpty())return null;var t=this.j;return this.q(t),t}merge(t,e){if("function"!=typeof e)throw TypeError("Must provide a selector function.");if(null==t)throw Error("sourceQueue cannot be null");for(var i=this.j,n=null,s=t.j;s;){var r=s;if(s=s.O,e(r)){for(t.q(r);i&&i.A<r.A;)n=i,i=i.O;this.D(r,n),n=r}}}D(t,e){if(e!=this.M){var i=e?e.O:this.j;t.O=i,i.N=t,t.N=e,null!=e?e.O=t:this.j=t}else this.push(t)}q(t){if(null==t)throw Error("Expected task to be non-null");t===this.j&&(this.j=t.O),t===this.M&&(this.M=this.M.N),t.O&&(t.O.N=t.N),t.N&&(t.N.O=t.O)}}class a extends Event{constructor(e,i){if(!i||!t.includes(i.previousPriority))throw TypeError("Invalid task priority: '"+i.previousPriority+"'");super(e),this.previousPriority=i.previousPriority}}class o extends AbortController{constructor(e){if(void 0===e&&(e={}),super(),null==e&&(e={}),"object"!=typeof e)throw TypeError("'init' is not an object");var i,n,s=void 0===e.priority?"user-visible":e.priority;if(!t.includes(s))throw TypeError("Invalid task priority: '"+s+"'");this.H=s,this.R=!1,Object.defineProperties(n=(i=this).signal,{priority:{get:function(){return i.H},enumerable:!0},onprioritychange:{value:null,writable:!0,enumerable:!0}}),n.addEventListener("prioritychange",t=>{n.onprioritychange&&n.onprioritychange(t)})}setPriority(e){if(!t.includes(e))throw TypeError("Invalid task priority: "+e);if(this.R)throw new DOMException("","NotAllowedError");if(this.signal.priority!==e){this.R=!0;var i=this.H;this.H=e;var n=new a("prioritychange",{previousPriority:i});this.signal.dispatchEvent(n),this.R=!1}}}void 0===self.scheduler?(self.scheduler=new class{constructor(){this.S={},t.forEach(t=>{this.S[t]=[new r,new r]}),this.U=null,this.W=new WeakMap}yield(){return this.B(()=>{},{priority:"user-visible"},!0)}postTask(t,e){return this.B(t,e,!1)}B(e,i,n){if(void 0!==(i=Object.assign({},i)).signal){if(null===i.signal||!("aborted"in i.signal)||"function"!=typeof i.signal.addEventListener)return Promise.reject(TypeError("'signal' is not a valid 'AbortSignal'"));if(i.signal&&i.signal.priority&&!t.includes(i.signal.priority))return Promise.reject(TypeError("Invalid task priority: '"+i.signal.priority+"'"))}if(void 0!==i.priority&&(null===i.priority||!t.includes(i.priority)))return Promise.reject(TypeError("Invalid task priority: '"+i.priority+"'"));if(void 0===i.delay&&(i.delay=0),i.delay=Number(i.delay),i.delay<0)return Promise.reject(TypeError("'delay' must be a positive number."));var s={callback:e,options:i,resolve:null,reject:null,hostCallback:null,abortCallback:null,onTaskCompleted:function(){this.options.signal&&this.abortCallback&&(this.options.signal.removeEventListener("abort",this.abortCallback),this.abortCallback=null)},onTaskAborted:function(){this.hostCallback&&(this.hostCallback.cancel(),this.hostCallback=null),this.options.signal.removeEventListener("abort",this.abortCallback),this.abortCallback=null,this.reject(this.options.signal.reason)},isAborted:function(){return this.options.signal&&this.options.signal.aborted},isContinuation:n},r=new Promise((t,e)=>{s.resolve=t,s.reject=e});return this._(s),r}_(t){var e=t.options.signal;if(e){if(e.aborted)return void t.reject(e.reason);t.abortCallback=()=>{t.onTaskAborted()},e.addEventListener("abort",t.abortCallback)}t.options.delay>0?t.hostCallback=new n(()=>{t.hostCallback=null,this.F(t)},null,t.options.delay):(this.G(t),this.J())}F(t){this.G(t),this.U&&(this.U.cancel(),this.U=null),this.K()}L(t){var e=this.W.get(t);if(void 0===e)throw Error("Attempting to change priority on an unregistered signal");if(e!==t.priority){for(var i=0;i<2;i++)this.S[t.priority][i].merge(this.S[e][i],e=>e.options.signal===t);this.W.set(t,t.priority)}}K(){this.U=null,this.V(),this.J()}J(){var{priority:t}=this.X();null!=t&&("background"!==t&&this.U&&this.U.isIdleCallback()&&(this.U.cancel(),this.U=null),this.U||(this.U=new n(()=>{this.K()},t,0)))}G(e){var i;if(!t.includes(i=e.options.priority?e.options.priority:e.options.signal&&e.options.signal.priority?e.options.signal.priority:"user-visible"))throw TypeError("Invalid task priority: "+i);if(e.options.signal&&e.options.signal.priority){var n=e.options.signal;this.W.has(n)||(n.addEventListener("prioritychange",()=>{this.L(n)}),this.W.set(n,n.priority))}this.S[i][+!e.isContinuation].push(e)}V(){var t=null;do{var{priority:e,type:i}=this.X();if(null==e)return;t=this.S[e][i].takeNextTask()}while(t.isAborted())try{var n=t.callback();t.resolve(n)}catch(e){t.reject(e)}finally{t.onTaskCompleted()}}X(){for(var e=0;e<t.length;e++)for(var i=t[e],n=0;n<2;n++)if(!this.S[i][n].isEmpty())return{priority:i,type:n};return{priority:null,type:0}}},self.TaskController=o,self.TaskPriorityChangeEvent=a):self.scheduler.yield||(self.scheduler.yield=function(){return self.scheduler.postTask(()=>{},{priority:"user-blocking"})})}();const tr="#0e0e0e",ta=[{key:"strings",label:"Strings",type:"group",defaultValue:"minimized",children:[{key:"showStrings",label:"Show strings",defaultValue:!0,type:"checkbox",isDisabled:({showNails:t})=>!t,affectsNails:!1},{key:"stringWidth",label:"String width",defaultValue:1,type:"range",attr:{min:.2,max:4,step:.1,snap:"1"},show:({showStrings:t})=>t,affectsNails:!1}]},{key:"nails",label:"Nails",type:"group",defaultValue:"minimized",children:[{key:"showNails",label:"Show nails",defaultValue:!0,type:"checkbox",isDisabled:({showStrings:t})=>!t,affectsStrings:!1},{key:"showNailNumbers",label:"Show nail numbers",defaultValue:!1,type:"checkbox",show:({showNails:t})=>t,affectsStrings:!1},{key:"nailNumbersFontSize",label:"Nail numbers font size",defaultValue:10,type:"range",attr:{min:6,max:24,step:.5},displayValue:({nailNumbersFontSize:t})=>`${t}px`,show:({showNails:t,showNailNumbers:e})=>t&&e,affectsStrings:!1},{key:"margin",label:"Margin",defaultValue:20,type:"number",attr:{min:0,max:500,step:1},displayValue:({margin:t})=>`${t}px`,isStructural:!0},{key:"nailRadius",label:"Nail size",defaultValue:1.5,type:"range",attr:{min:.5,max:5,step:.25,snap:"1.5"},show:({showNails:t})=>t,affectsStrings:!1},{key:"nailsColor",label:"Nails color",defaultValue:"#ffffff",type:"color",show:({showNails:t})=>t,affectsStrings:!1}]},{key:"background",label:"Background",type:"group",defaultValue:"minimized",children:[{key:"darkMode",label:"Dark mode",defaultValue:!0,type:"checkbox",affectsNails:!1,affectsStrings:!1},{key:"customBackgroundColor",label:"Custom background color",defaultValue:!1,type:"checkbox",affectsNails:!1,affectsStrings:!1},{key:"backgroundColor",label:"Background color",defaultValue:tr,type:"color",show:({customBackgroundColor:t})=>t,affectsNails:!1,affectsStrings:!1}]}];var to=class extends i{controls=[];defaultValues={};stepCount=null;size=null;position=0;stringsIterator;id;name;link;linkText;calc;#th;#tp;#tg;#tf;constructor(){super()}getNailCount(t){let e=new ts(t);return this.draw(e),e.nailCount}getThreadLengths(t){let e=new ts(t);return this.draw(e),e.threadsLength}thumbnailConfig;testStepCountConfig;static type;getCommonControls(){return ta}get configControls(){return(this.controls??[]).concat(this.getCommonControls())}get controlsIndex(){return this.#tp||(this.#tp=function(t){let e={};for(let{control:i}of J(t))e[i.key]=i;return e}(this.configControls)),this.#tp}get type(){return this.constructor.type}get isTemplate(){return this.type===this.id}get defaultConfig(){return this.#tg||(this.#tg=Object.freeze(Object.assign(function(t){let e={};for(let{control:{key:i,defaultValue:n}}of J(t))n instanceof Function||(e[i]=n);return e}(this.configControls),this.defaultValues))),this.#tg}get config(){return this.#th??this.defaultConfig}set config(t){this.#th=Object.assign({},this.defaultConfig,t)}get isDefaultConfig(){return tt(this.config,this.#tg)}markConfigAsDefault(){this.#tg=this.config}resetDefaultConfig(){this.#tg=null}assignConfig(t){this.#th=Object.assign({},this.config,t)}setConfig(t){let e=this.config;if(this.config=t,this.onConfigChange){let i=Object.keys(e).filter(i=>t[i]!==e[i]);this.onConfigChange(i.map(e=>({control:this.controlsIndex[e],value:t[e]})))}}resetStructure(){this.calc=null}getCalc(t){return{}}onConfigChange(t){t.some(({control:t})=>t.isStructural)&&(this.resetStructure(),null!=this.stepCount&&t.some(({control:t})=>!1!==t.affectsStepCount)&&(this.stepCount=null))}onResize(){this.resetStructure()}setConfigValue(t,e){(!this.#th||this.#th[t]!==e)&&(this.#th=Object.freeze({...this.#th??this.defaultConfig,[t]:e}),this.onConfigChange&&this.onConfigChange([{control:this.controlsIndex[t],value:e}].filter(({control:t})=>!!t)))}setUpDraw(t){this.calc||(this.calc=this.getCalc(t))}afterDraw(){this.emit("drawdone",null)}initDraw(t,{redrawNails:e=!0,redrawStrings:i=!0,sizeChanged:n}={}){n&&this.resetStructure(),i&&t.resetStrings(),e&&t.resetNails(),t.clearInstructions(),t.setLineWidth(this.config.stringWidth);let s=t.getSize();this.setUpDraw({size:s})}draw(t,e={}){return e.enableScheduler?(this.#tf&&!this.#tf.signal.aborted&&this.#tf.abort("Redraw"),this.#tf=new TaskController({priority:"background"}),scheduler.postTask(()=>this.#tm(t,e),{signal:this.#tf.signal}).catch(t=>{}),()=>{this.#tf?.abort("Cancelled")}):(this.#tm(t,e),()=>{})}#tm(t,{position:e,...i}={}){this.initDraw(t,i);let{showNails:n,showNailNumbers:s,darkMode:r,backgroundColor:a,customBackgroundColor:o,enableBackground:l}=this.config;if(t.setBackground(!1!==l?o?a:r?tr:"#ffffff":null),n&&!1!==i.redrawNails){let e=new ti(this.config);this.drawNails(e),e.draw(t,{drawNumbers:s})}if(!1!==i.redrawStrings&&this.config.showStrings)for(this.stringsIterator=this.drawStrings(t),this.position=0;!this.drawNext().done&&(null==e||this.position<e););return()=>{this.#tf?.abort("Cancelled")}}goto(t,e,{showInstructions:i=!0}={}){if(e!==this.position){if(this.stringsIterator&&e>this.position)for(;!this.drawNext().done&&this.position<e;);else this.draw(t,{position:e,redrawNails:!1});i&&t.renderInstructionsForLastLine()}}drawNext(){let t=this.stringsIterator.next();return t.done?this.afterDraw():this.position++,t}copy(){let t=this.config,e=new this.constructor;return e.config=t,e}};const tl={linear:t=>t,inOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeOutQuint:t=>1-Math.pow(1-t,5),easeOutCubic:t=>1-Math.pow(1-t,4),fastSlowFast:t=>.5*(1-Math.cos(Math.PI*(t=Math.max(0,Math.min(1,t)))))**1.5,fastInOutSquare:t=>t<=.5?(1-Math.pow(1-2*t,2))/2:.5+Math.pow(2*t-1,2)/2,fastInOutCubic:t=>t<=.5?(1-Math.pow(1-2*t,3))/2:.5+Math.pow(2*t-1,3)/2,fastInOutQuint:t=>t<=.5?(1-Math.pow(1-2*t,5))/2:.5+Math.pow(2*t-1,5)/2,fastInOut:(t,e)=>e<=.5?(1-Math.pow(1-2*e,t))/2:.5+Math.pow(2*e-1,t)/2,fastInOutFixed(t,e,i){if(i>e&&i<1-e){let n=(1-Math.pow(1-2*e,t))/2,s=.5+Math.pow((1-e)*2-1,t)/2;return n+(i-e)*(s-n)/(1-2*e)}return i<=e?(1-Math.pow(1-2*i,t))/2:.5+Math.pow(2*i-1,t)/2},easeOutFixed(t,e,i){let n=1-e;if(i<n||0===e)return 1-Math.pow(1-i,t);let s=1-Math.pow(1-n,t);return s+(1-s)*(i-n)/e}};tl.fastInOut.requirePower=!0,tl.fastInOutFixed.requirePower=!0,tl.fastInOutFixed.requireFastArea=!0,tl.easeOutFixed.requirePower=!0,tl.easeOutFixed.requireFastArea=!0;class tc{}function tu(t){return`${Math.round(100*t)}%`}function td(t){return`${Math.round((t??0)*360)}\xb0`}function th(t){return t[0].toLocaleUpperCase()+t.slice(1)}function tp(t,e){return Array(t).fill(null).map((t,i)=>e(i))}class tg extends tc{config;#tb;#ty;constructor(t){super(),this.setConfig(t)}setConfig(t){if(!tt(t,this.config)&&(this.config=t,this.#tb?this.#tb.clear():this.#tb=new Map,this.#ty=this.#tC(),t.fitSize)){let t=this.#tS();this.#tb.clear(),this.#ty={...this.#tC(),...t}}}#tS(){let{size:t,margin:e}=this.config,i=this.getBoundingRect(),n=Math.min((t[0]-2*e)/i.width,(t[1]-2*e)/i.height);return{size:t.map(t=>t*n),center:[this.#ty.center[0]-n*(i.left-t[0]+i.right)/2,this.#ty.center[1]-n*(i.top-t[1]+i.bottom)/2]}}#tC(){let{size:t,rotation:e=0,sides:i,center:n,margin:s=0,nailsPerSide:r,radiusNailsCountSameAsSides:a=!1}=this.config,o=x/i,l=tp(i,t=>{let i=o*t+x*e,n=-o*(t-.5)-x*e;return{cos:Math.cos(i),sin:Math.sin(i),center:{cos:Math.cos(n),sin:Math.sin(n)}}}),c=n??_(t),u=Math.min(...t)/2-s,d=2*u*Math.sin(o/2),h=[u*Math.sin(o/2),u*Math.cos(o/2)],p=d/(r-1),g=a?r:Math.max(2,Math.floor(u/p));return{center:c,radius:u,sideSize:d,start:h,nailsDistance:p,radiusNailsCount:g,radiusNailsDistance:u/(g-1),sides:l,sideAngle:o}}get radiusNailsCount(){return this.#ty.radiusNailsCount}get sideSize(){return this.#ty.sideSize}getPoint(t){let{nailsPerSide:e}=this.config,i=Math.floor(t/e);return this.getSidePoint({side:i,index:t%e})}getSidePoint({side:t,index:e}){let i=[t,e].join("_");if(this.#tb.has(i))return this.#tb.get(i);let n=this.#ty.start[0]-e*this.#ty.nailsDistance,{cos:s,sin:r}=this.#ty.sides[t],a=[s*n-r*this.#ty.start[1]+this.#ty.center[0],r*n+s*this.#ty.start[1]+this.#ty.center[1]];return this.#tb.set(i,a),a}getCenterPoint({side:t,index:e}){if(e<0)throw Error(`Can't get polygon center point for index = (${e}).`);if(t<0)throw Error(`Can't get polygon center point for side = (${e}).`);let i=e*this.#ty.radiusNailsDistance,{sin:n,cos:s}=this.#ty.sides[t].center;return[this.#ty.center[0]+n*i,this.#ty.center[1]+s*i]}getBoundingRect(){let t=tp(this.config.sides,t=>this.getSidePoint({side:t,index:0})),e=t[0],i=t.slice(1).reduce((t,[e,i])=>({left:Math.min(t.left,e),right:Math.max(t.right,e),top:Math.min(t.top,i),bottom:Math.max(t.bottom,i)}),{left:e[0],right:e[0],top:e[1],bottom:e[1]});return{...i,height:i.bottom-i.top,width:i.right-i.left}}getAspectRatio(){return V(this.getBoundingRect())}drawNails(t,{nailsNumberStart:e=0,getNumber:i,drawCenter:n=!1,drawSides:s=!0,drawCenterNail:r=!0}={}){let{nailsPerSide:a}=this.config;n&&r&&t.addNail({point:this.getCenterPoint({side:0,index:0}),number:"C"});for(let r=0;r<this.config.sides;r++){let o=e+r*a;if(s)for(let e=0;e<a-1;e++){let n=o+e;t.addNail({point:this.getSidePoint({side:r,index:e}),number:i?i(n):n})}if(n)for(let e=1;e<this.#ty.radiusNailsCount-1;e++){let n=`${r}_${e}`;t.addNail({point:this.getCenterPoint({side:r,index:e}),number:i?i(n):n})}}}getNailsCount({drawCenter:t=!1,drawSides:e=!0,drawCenterNail:i=!0}={}){let n=(e?this.config.nailsPerSide-1:0)+(t?this.#ty.radiusNailsCount-2:0);return this.config.sides*n+(t&&i?1:0)}static rotationConfig={key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1,step:.02},displayValue:({rotation:t,sides:e})=>td(t/(2*e)),isStructural:!0,affectsStepCount:!1}}class tf extends tc{points;easingFunction;config;center;xyRadius;rotationAngle=0;indexAngle;isReverse=!1;radius;arc=x;isPartialArc=!1;excludedNailIndexes;constructor(t){super(),this.setConfig(t)}getPoint(t){let e=this.getNailIndex(t);if(this.points.has(t))return this.points.get(t);let i=this.easingFunction(e/(this.config.n-!!this.isPartialArc))*this.arc+this.rotationAngle+(this.config.angleStart??0),n=[this.center[0]+Math.sin(i)*this.xyRadius[0],this.center[1]+Math.cos(i)*this.xyRadius[1]];return this.points.set(t,n),n}getNailIndex(t=0){let e=this.isReverse?this.config.n-1-t:t;return e>this.config.n-1&&(e%=this.config.n),e}getAspectRatio(){if(!this.config.distortion)return 1;let t=k(this.config.distortion);return t[0]/t[1]}getBoundingRect(){let{n:t,rotation:e}=this.config;return t<16?new tg({sides:t,rotation:e,size:[2*this.radius,2*this.radius],nailsPerSide:1,center:this.center}).getBoundingRect():{top:this.center[1]-this.xyRadius[1],left:this.center[0]-this.xyRadius[0],right:this.center[0]+this.xyRadius[0],bottom:this.center[1]+this.xyRadius[1],width:2*this.xyRadius[0],height:2*this.xyRadius[1]}}setConfig(t){if(!tt(t,this.config)){let{n:e,size:i,margin:n=0,rotation:s=0,center:r,radius:a,reverse:o=!1,angleStart:l,angleEnd:c}=t,u=r??_(i),d=Math.max(1,(a??Math.min(..._(i)))-n),h=[d,d];t.distortion&&(h=T(k(t.distortion).map(t=>d*t),i.map(t=>Math.max(0,t/2-n)))),this.isPartialArc=l&&c&&c>l;let p=this.isPartialArc?c-l:x,g={center:u,radius:d,xyRadius:h,indexAngle:p/(this.isPartialArc?e-1:e),rotationAngle:-x*s,isReverse:o,arc:p},f=t.displacementFunc?tl[t.displacementFunc]:tl.linear,m=[];f.requirePower&&m.push(t.displacementMag),f.requireFastArea&&m.push(t.displacementFastArea);let b=m.length?f.bind(null,...m):f;this.easingFunction=b,this.config=t,Object.assign(this,g),this.points?this.points.clear():this.points=new Map}}*generateNails({nailsNumberStart:t=0,getNumber:e,excludedNailRanges:i}={}){let n,{n:s}=this.config;i&&(n=new Set,i.forEach(([t,e])=>{let i=Math.min(e,s);for(let e=Math.max(0,t);e<=i;e++)n.add(e)}));let r=0;for(let i=0;i<this.config.n;i++)!n?.has(i)&&(yield{point:this.getPoint(i),number:e?e(r):r+t},r++)}drawNails(t,e={}){let i=[],{color:n,...s}=e;for(let t of this.generateNails(s))i.push(t);t.addGroup(i,{color:n})}*drawRing(t,{ringSize:e,color:i}){let n,{n:s}=this.config,r=Math.floor(e*s),a=0,o=!1;i&&t.setColor(i);for(let e=0;e<s;e++){n||(n=this.getPoint(0));let i=n,l=[];if(a=o?e:a+r,n=this.getPoint(a),l.push(n),t.renderLine(i,n),yield,e<s-1){a++;let e=this.getPoint(a);t.renderLine(n,e),yield,n=e,l.push(n)}o=!o}}getRingStepCount(){return 2*this.config.n-1}static rotationConfig={key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1+1/360,step:1/360,snap:"0.25, 0.5, 0.75"},displayValue:({rotation:t})=>td(t),isStructural:!0,affectsStepCount:!1};static nailsConfig=Object.freeze({key:"n",label:"Number of nails",defaultValue:144,type:"range",attr:{min:3,max:300,step:1},isStructural:!0});static displacementConfig={key:"displacement",label:"Displacement",type:"group",children:[{key:"displacementFunc",label:"Displacement function",defaultValue:"linear",type:"select",options:Object.keys(tl),isStructural:!0,affectsStepCount:!1},{key:"displacementMag",label:"Displacement magnitude",defaultValue:3,type:"range",attr:{min:0,max:10,step:.1},show:({displacementFunc:t})=>tl[t].requirePower,isStructural:!0,affectsStepCount:!1},{key:"displacementFastArea",label:"Displacement fast area",defaultValue:.4,type:"range",attr:{min:0,max:.5,step:.01},show:({displacementFunc:t})=>tl[t].requireFastArea,isStructural:!0,affectsStepCount:!1}]};static distortionConfig={key:"distortion",label:"Distortion",defaultValue:0,type:"range",attr:{min:-.99,max:.99,step:.01,snap:"0"},isStructural:!0,affectsStepCount:!1}}const tm=K.getConfig({defaults:{isMultiColor:!0,colorCount:7,color:"#ffbb29",multicolorRange:21,multicolorStart:32,multicolorByLightness:!0,minLightness:36,maxLightness:98}});class tb extends to{static type="spiral";id="spiral";name="Spiral";link="https://www.etsy.com/il-en/listing/840974781/boho-wall-decor-artwork-spiral-round";controls=[{...tf.nailsConfig,defaultValue:200},{key:"repetition",label:"Repetition",defaultValue:5,type:"range",attr:{min:1,max:20,step:1},affectsNails:!1,isStructural:!0},{key:"innerLength",label:"Spiral thickness",defaultValue:.5,type:"range",attr:{min:({n:t})=>1/t,max:1,step:({n:t})=>1/t},displayValue:({n:t,innerLength:e})=>Math.round(t*e),affectsNails:!1},{...Y(tf.rotationConfig,"snap"),defaultValue:.75},tf.distortionConfig,tm];#tw;#tv;getCalc({size:t}){let{n:e,rotation:i,margin:n,repetition:s,distortion:r}=this.config;return{circle:new tf({size:t,n:e,margin:n,rotation:i,distortion:r}),realRepetition:2*s-1}}setUpDraw(t){super.setUpDraw(t);let{colorCount:e}=this.config;this.#tw=new K({...this.config,colorCount:e}),e&&(this.#tv=this.#tw.getColorMap({stepCount:this.getStepCount(),colorCount:e}))}getAspectRatio(t){let{circle:e}=this.getCalc(t);return e.getAspectRatio()}*drawSpiral(t,{shift:e=0,color:i="#ffffff"}={}){let{innerLength:n,n:s}=this.config,r=Math.round(n*s),a=0;t.setColor(i);let o=e,l=this.calc.circle.getPoint(o),c=!1;for(let e=0;r>0;e++){if(this.#tv){let i=this.#tv.get(e);i&&t.setColor(i)}o=c?o-r+1:o+r,a===this.calc.realRepetition?(r--,a=0,o++):a++;let i=this.calc.circle.getPoint(o);t.renderLine(l,i),l=i,yield,c=!c}}*drawStrings(t){yield*this.drawSpiral(t,{color:this.#tw.getColor(0)})}getStepCount(){let{innerLength:t,repetition:e,n:i}=this.config;return Math.round(2*t*i*e)}drawNails(t){this.calc.circle.drawNails(t)}thumbnailConfig=({n:t})=>({n:Math.min(t,60)})}class ty extends to{static type="spirals";name="Spirals";id="spirals";link="https://www.etsy.com/il-en/listing/974865185/3d-string-art-spiral-mandala-wall?ref=shop_home_active_10&frs=1";controls=[{key:"nSpirals",label:"Number of spirals",defaultValue:3,type:"range",attr:{min:2,max:20,step:1},isStructural:!0},{key:"nailsPerSpiral",label:"Nails per spiral",type:"range",defaultValue:80,attr:{min:3,max:300,step:1},isStructural:!0},{key:"angle",label:"Angle",type:"range",defaultValue:.52,attr:{min:0,max:2,step:.026},displayValue:({angle:t})=>td(t),isStructural:!0,affectsStepCount:!1},{key:"radiusEasing",label:"Radius easing",defaultValue:1.8,type:"range",attr:{min:1,max:10,step:.1},isStructural:!0,affectsStepCount:!1},{key:"angleEasing",label:"Angle easing",defaultValue:1.3,type:"range",attr:{min:1,max:10,step:.1},isStructural:!0,affectsStepCount:!1},{...tf.rotationConfig,defaultValue:65/360},K.getConfig({defaults:{isMultiColor:!0,colorCount:4,color:"#00d5ff",multicolorRange:1,multicolorStart:190,multicolorByLightness:!0,minLightness:50,maxLightness:88,reverseColors:!0}})];color;colorMap;getCalc({size:t}){let{nSpirals:e,rotation:i,margin:n,angle:s}=this.config,r=Math.min(...t)/2-n;return{spiralRotations:tp(e,t=>t*x/e),rotationAngle:-x*i,angle:s*x,center:_(t),radius:r}}setUpDraw(t){super.setUpDraw(t);let{colorCount:e}=this.config;this.color=new K(this.config),this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:e})}getAspectRatio(){return 1}*generatePoints(t=!0){let{nSpirals:e,nailsPerSpiral:i}=this.config;for(let n=1;n<i;n++)for(let i=0;i<e;i++){let e=this.getPoint(i,n);yield{point:e,nailNumber:t?`${i+1}_${n+1}`:null}}}getPoint(t,e){let{center:i,radius:n,angle:s}=this.calc,{nailsPerSpiral:r,radiusEasing:a,angleEasing:o}=this.config,l=e/(r-1),c=this.calc.rotationAngle+tl.easeOutFixed(o,0,l)*s+this.calc.spiralRotations[t],u=tl.easeOutFixed(a,0,l)*n;return[i[0]+u*Math.sin(c),i[1]+u*Math.cos(c)]}*drawStrings(t){let e=this.generatePoints(),i=0;for(let{point:n}of(t.setColor(this.color.getColor(0)),t.setStartingPoint(this.calc.center),e)){if(this.colorMap){let e=this.colorMap.get(i);e&&t.setColor(e)}t.lineTo(n),yield,i++}}getStepCount(){let{nSpirals:t,nailsPerSpiral:e}=this.config;return(e-1)*t}drawNails(t){for(let{point:e,nailNumber:i}of(t.addNail({point:this.calc.center,number:"1"}),this.generatePoints()))t.addNail({point:e,number:i})}getNailCount(){let{nSpirals:t,nailsPerSpiral:e}=this.config;return t*(e-1)+1}thumbnailConfig=({nailsPerSpiral:t})=>({nailsPerSpiral:Math.min(30,t)})}class tC extends to{static type="mandala";name="Mandala";id="mandala";link="https://www.youtube.com/watch?v=qhbuKbxJsk8";linkText="Learn";controls=[{key:"n",label:"Number of nails",defaultValue:180,type:"range",attr:{min:3,max:240,step:1},isStructural:!0},{key:"base",label:"Multiplication",defaultValue:2,type:"range",attr:{min:2,max:99,step:1},affectsNails:!1},{key:"layers",label:"Layers",defaultValue:7,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},tf.rotationConfig,tf.distortionConfig,K.getConfig({defaults:{isMultiColor:!0,multicolorRange:165,multicolorStart:256,color:"#ff4d00"},exclude:["colorCount"]})];color;get n(){return this.calc.n}getCalc({size:t}){let{n:e,layers:i,layerFill:n,rotation:s,distortion:r,margin:a,reverse:o}=this.config,l=e-e%i;return{n:l,stringsPerLayer:n?Math.floor(l*n):l,layerShift:Math.floor(l/i),circle:new tf({size:t,n:l,margin:a,rotation:s,distortion:r,reverse:o})}}setUpDraw(t){super.setUpDraw(t);let{layers:e}=this.config;this.color=new K({...this.config,colorCount:e})}getAspectRatio(t){return this.getCalc(t).circle.getAspectRatio()}*drawLayer(t,e){let{reverse:i,base:n}=this.config,{n:s,layerShift:r,stringsPerLayer:a}=this.calc,o=r*e*(i?1:-1),l=this.color.getColor(e);t.setColor(l);let c=this.calc.circle.getPoint(o);for(let e=1;e<=a;e++){let i=c;c=this.calc.circle.getPoint(e+o);let r=e*n%s;t.renderLine(i,c),yield,t.renderLine(c,this.calc.circle.getPoint(r+o)),yield}}*drawStrings(t){let{layers:e}=this.config;for(let i=0;i<e;i++)yield*this.drawLayer(t,i)}drawNails(t){this.calc.circle.drawNails(t)}getStepCount(t){let{layers:e,layerFill:i}=this.config,{n:n}=this.getCalc(t);return(e??1)*(i?Math.floor(n*i):n)*2}getNailCount(){let{n:t,layers:e}=this.config;return t-t%e}thumbnailConfig=({n:t})=>({n:Math.min(t,70)})}class tS extends tC{static type="wave";id="wave";name="Wave";link="https://www.etsy.com/il-en/listing/943140543/personalized-gift-string-art-mandala?ref=sim_rv-5&pro=1";controls=[{...tf.nailsConfig,defaultValue:200},{key:"layerFill",label:"Layer fill",defaultValue:.5,type:"range",attr:{min:({n:t})=>1/t,max:1,step:({n:t})=>1/t},displayValue:({layerFill:t})=>tu(t),affectsNails:!1,isStructural:!0},Y(tf.rotationConfig,"snap"),tf.distortionConfig,{key:"layers",label:"Layers",defaultValue:11,type:"range",attr:{min:1,max:20,step:1}},{key:"layerSpread",label:"Layer spread",defaultValue:.075,type:"range",attr:{min:0,max:1,step:({n:t})=>1/t},displayValue:({layerSpread:t,n:e})=>Math.round(t*e),affectsNails:!1,isStructural:!0},{key:"reverse",label:"Reverse",defaultValue:!0,type:"checkbox",isStructural:!0},K.getConfig({defaults:{isMultiColor:!0,multicolorRange:196,multicolorStart:273,color:"#ffffff",multicolorByLightness:!0,minLightness:10,maxLightness:90},exclude:["colorCount"]})];defaultValues={base:2,rotation:176/360};getCalc(t){let{n:e,layerSpread:i}=this.config;return{...super.getCalc(t),layerShift:Math.round(e*i)}}*drawStrings(t){let{layers:e}=this.config;for(let i=0;i<e;i++)yield*this.drawLayer(t,i)}}const tw=["left","bottom","right","top"],tv=["left","bottom","right","top"],tx={left:0,bottom:Math.PI/2,right:Math.PI,top:1.5*Math.PI};class tk extends to{static type="eye";name="Eye";id="eye";link="https://www.etsy.com/listing/489853161/rose-of-space-string-art-sacred-geometry?ga_order=most_relevant&ga_search_type=all&ga_view_type=gallery&ga_search_query=string+art&ref=sr_gallery_1&epik=dj0yJnU9WXNpM1BDTnNkLVBtcWdCa3AxN1J5QUZRY1FlbkJ5Z18mcD0wJm49ZXdJb2JXZmVpNVVwN1NKQ3lXMy10ZyZ0PUFBQUFBR0ZuUzZv";controls=[{key:"n",label:"Number of nails per side",defaultValue:82,type:"range",attr:{min:2,max:200,step:1},isStructural:!0},{key:"layers",label:"Layers",defaultValue:13,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},{key:"angle",label:"Layer angle",defaultValue:30,displayValue:({angle:t})=>`${t}\xb0`,type:"range",attr:{min:0,max:45,step:1},isStructural:!0},K.getConfig({defaults:{isMultiColor:!0,color:"#ffffff",multicolorRange:107,multicolorStart:226,multicolorByLightness:!1,minLightness:40,maxLightness:50,colorCount:2},customControls:[{key:"colorPerLayer",label:"Color per layer",defaultValue:!1,type:"checkbox",show:({isMultiColor:t})=>t,affectsNails:!1}],exclude:["colorCount","repeatColors"]})];defaultValues={nailsColor:"#000000"};color;getCalc({size:t}){let{n:e,angle:i,layers:n,margin:s}=this.config,r=_(t),a=Math.min(...t)-2*s,o=a/(e-1),l=i*Math.PI/180;return{maxSize:a,nailSpacing:o,layerAngle:l,layers:tp(n,t=>(t=>{let e=a/Math.pow(Math.cos(l)+Math.sin(l),t),i=[r[0]-e/2,r[1]-e/2],n=Math.floor(e/o);return{layerAngle:l*t,layerSize:e,layerStart:i,layerStringCount:n}})(t)),center:r}}setUpDraw(t){super.setUpDraw(t),this.color=new K({...this.config,repeatColors:!0,colorCount:2})}getAspectRatio(){return 1}getPoint({index:t,angle:e,layerStart:i,rotation:n}){let s=e+n,r=[i[0],i[1]+this.calc.nailSpacing*t],a=this.calc.center,o=Math.cos(s),l=Math.sin(s);return[o*(r[0]-a[0])-l*(r[1]-a[1])+a[0],l*(r[0]-a[0])+o*(r[1]-a[1])+a[1]]}*drawSide(t,{side:e,color:i="#ffffff",angle:n,size:s,layerStart:r,layerStringCount:a}){let o=tw.indexOf(e),l=tw[o===tw.length-1?0:o+1],c=tx[e],u=tx[l],d={layerStringCount:a,size:s,layerStart:r,angle:n};t.setColor(i);for(let e=0;e<=a;e++)t.renderLine(this.getPoint({index:e,rotation:c,...d}),this.getPoint({index:e,rotation:u,...d})),yield}*drawLayer(t,e){let{colorPerLayer:i}=this.config,{layerAngle:n,layerSize:s,layerStart:r,layerStringCount:a}=this.calc.layers[e];for(let o=0;o<tw.length;o++)yield*this.drawSide(t,{color:this.color.getColor(i?e:o),side:tv[o],angle:n,size:s,layerStart:r,layerStringCount:a})}*drawStrings(t){let{layers:e}=this.config;for(let i=e-1;i>=0;i--)yield*this.drawLayer(t,i)}getStepCount({size:t}){let e=0,{layers:i,angle:n,n:s,margin:r}=this.config,a=n*Math.PI/180,o=Math.min(...t)-2*r,l=o/(s-1);for(let t=0;t<i;t++)e+=4*(Math.floor(o/Math.pow(Math.cos(a)+Math.sin(a),t)/l)+1);return e}drawNails(t){let{layers:e}=this.config;for(let i=e-1;i>=0;i--){let{layerAngle:e,layerSize:n,layerStart:s,layerStringCount:r}=this.calc.layers[i];for(let a=0;a<tw.length;a++){let o=tx[tv[a]];for(let l=0;l<=r;l++){let c={layerStringCount:r,size:n,layerStart:s,angle:e};t.addNail({point:this.getPoint({index:l,rotation:o,...c}),number:`${i}_${a}_${l}`})}}}}thumbnailConfig=({n:t,layers:e})=>({n:Math.min(t,25),layers:Math.min(e,7)})}class tM extends tc{config;center;calc;constructor(t){super(),this.setConfig(t)}static getCalc({radius:t,sides:e,sideNails:i,rotation:n,centerRadius:s=0,maxCurveSize:r=1,sidesCenterRadiusShift:a}){let o=t*s,l=2*Math.PI/e,c=n?-(2*Math.PI)*n/e:0;return{sideAngle:l,nailSpacing:(t-o)/(i-1),centerRadius:o,linesPerRound:e%2?2*e:e,sidesConnectionCount:Math.floor(Math.min(1,r)*i),sideSize:t-o,sides:Array(e).fill(null).map((t,e)=>{let i=e*l+c;return{sinSideAngle:Math.sin(i),cosSideAngle:Math.cos(i)}}),sidesCenterRadius:a?a.map(t=>o*t):null}}getPoint(t){let e=Math.floor(t/this.config.sideNails),i=t%this.config.sideNails;return this.getSidePoint(e,i)}getSidePoint(t=0,e=0){let i=this.calc.centerRadius+e*this.calc.nailSpacing-(this.calc.sidesCenterRadius?.[t]??0),{sinSideAngle:n,cosSideAngle:s}=this.calc.sides[t];return[this.center[0]+n*i,this.center[1]+s*i]}setConfig(t){if(tt(t,this.config,["radius","sides","sideNails","rotation","center","size","centerRadius","maxCurveSize"]))return;if(!t.center&&!t.size)throw Error("StarShape requires a config value for either center or size.");let e=t.center??_(t.size);this.config=t,this.center=e,this.calc=tM.getCalc(t)}drawNails(t,{getNumber:e,reverseOrder:i,excludeSides:n,...s}={}){let{sides:r,sideNails:a,centerRadius:o}=this.config,l=[],c=null==o||0===o;c&&t.addGroup([{point:this.getSidePoint(0,0),number:"C"}],s);for(let t=0;t<r;t++)if(!n||!n.includes(t))for(let n=+!!c;n<a;n++){let s=i?a-n:n;l.push({point:this.getSidePoint(t,s),number:e?e(`${t}_${s}`):s||!c?`${t}_${s}`:0})}t.addGroup(l,s)}*drawStrings(t,{size:e}={}){let{sideNails:i,sides:n}=this.config,{sidesConnectionCount:s,linesPerRound:r}=this.calc,a=e?Math.max(1,Math.min(Math.floor(e),i)):i,o=Math.max(0,a-s),l=!1,c=n%2?Math.ceil(Math.min(a,s)/2):a-o,u=o,d=this.getSidePoint(0,u);for(let e=0;e<c;e++){let i=e===c-1,s=0;for(let c=0;c<r;c++){s=(s+1)%n,u=(l=!l)?a-e-1:e+o;let r=this.getSidePoint(s,u);if(t.renderLine(d,r),d=r,yield,i&&c===n-1&&n%2&&a%2)break}if(!i){u=l?u-1:u+1;let e=this.getSidePoint(0,u);t.renderLine(d,e),d=e}}}getStepCount(t){return tM.getStepCount(this.config,{size:t})}static getStepCount({sides:t,sideNails:e,maxCurveSize:i=1},{size:n}={}){let s=Math.floor(Math.min(1,i)*e),r=n?Math.min(Math.floor(n),e):e,a=Math.max(0,r-s);return(t%2?Math.ceil(Math.min(r,s)/2):r-a)*(t%2?2*t:t)-(t%2&&r%2?t:0)}getBoundingRect(){let{radius:t,sides:e,rotation:i,sideNails:n}=this.config;return new tg({size:[2*t,2*t],sides:e,nailsPerSide:n,margin:0,rotation:i}).getBoundingRect()}getAspectRatio(){return V(this.getBoundingRect())}static nailsConfig=Object.freeze({key:"sideNails",label:"Nails per side",defaultValue:40,type:"range",attr:{min:1,max:200,step:1},isStructural:!0});static sidesConfig=Object.freeze({key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:40,step:1},isStructural:!0});static maxCurveSize={key:"maxCurveSize",label:"Max curve size",description:"The maximum number of connections used to create a curve between two sides.",defaultValue:1,type:"range",displayValue:({maxCurveSize:t,sideNails:e})=>Math.floor(t*e),attr:{min:0,max:1,step:({sideNails:t})=>1/t},isStructural:!0};static centerRadiusConfig={key:"centerRadius",label:"Center radius",defaultValue:0,type:"range",attr:{min:0,max:({sideNails:t})=>(t-1)/t,step:.01},displayValue:({centerRadius:t})=>tu(t),isStructural:!0};static rotationConfig={key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01,snap:"0.5"},displayValue:({rotation:t,sides:e})=>td(t/e),isStructural:!0,affectsStepCount:!1};static StarConfig=[tM.nailsConfig,tM.sidesConfig,tM.centerRadiusConfig,tM.maxCurveSize,tM.rotationConfig]}class tN extends to{static type="star";name="Star";id="star";link="https://www.etsy.com/listing/557818258/string-art-meditation-geometric-yoga?epik=dj0yJnU9Mm1hYmZKdks1eTc3bVY2TkVhS2p2Qlg0N2dyVWJxaTEmcD0wJm49MGlWSXE1SVJ2Vm0xZ0xtaGhITDBWQSZ0PUFBQUFBR0Zwd2lj";controls=[{key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:20,step:1},isStructural:!0},{key:"sideNails",label:"Nails per side",defaultValue:40,type:"range",attr:{min:1,max:200,step:1},isStructural:!0},tM.centerRadiusConfig,{key:"ringSize",label:"Outer ring size",defaultValue:.1,type:"range",attr:{min:0,max:.5,step:({sideNails:t,sides:e})=>1/(t*e)},displayValue:({sideNails:t,sides:e,ringSize:i})=>Math.floor(i*t*e),affectsNails:!1},Y(tf.rotationConfig,"snap"),tf.distortionConfig,{key:"renderStar",label:"Show star",type:"checkbox",defaultValue:!0,affectsNails:!1,isStructural:!0},{key:"colorGroup",label:"Color",type:"group",children:[{key:"isSingleColor",label:"Is single color",type:"checkbox",defaultValue:!1,affectsNails:!1,affectsStepCount:!1},{key:"singleColor",label:"Color",defaultValue:"#2ec0ff",type:"color",affectsNails:!1,affectsStepCount:!1,show:({isSingleColor:t})=>t},{key:"innerColor",label:"Star color",defaultValue:"#2ec0ff",type:"color",affectsNails:!1,affectsStepCount:!1,show:({isSingleColor:t,renderStar:e})=>!t&&e},{key:"outerColor",label:"Outter color",defaultValue:"#2a82c6",type:"color",affectsNails:!1,affectsStepCount:!1,show:({isSingleColor:t})=>!t},{key:"ringColor",label:"Ring color",defaultValue:"#2ec0ff",type:"color",affectsNails:!1,affectsStepCount:!1,show:({isSingleColor:t})=>!t}]}];getCalc({size:t}){let{sides:e,rotation:i,distortion:n,sideNails:s,margin:r=0}=this.config,a=new tf({size:t,n:e*(s-1),margin:r,rotation:i?i/e:0,distortion:n}),o={...this.config,radius:a.radius,size:t};return{circle:a,star:new tM(o)}}getAspectRatio(t){let{circle:e,star:i}=this.getCalc(t),n=e.getBoundingRect(),s=i.getBoundingRect();return Math.max(n.width,s.width)/Math.max(n.height,s.height)}getArcPoint({side:t,sideIndex:e}){return this.calc.circle.getPoint(t*(this.config.sideNails-1)+e)}*drawStar(t){let{innerColor:e,isSingleColor:i}=this.config;i||t.setColor(e),yield*this.calc.star.drawStrings(t)}*drawCircle(t){let{outerColor:e,sides:i,sideNails:n,isSingleColor:s}=this.config,{star:r}=this.calc;s||t.setColor(e);let a=!1,o=!1,l=i%2?Math.ceil(n/2):n-1,c=0,u=i%2?4*i:2*i;t.setStartingPoint(r.getSidePoint(0,0));for(let e=0;e<l;e++){let s=e===l-1,d=i%2&&(0===e||s&&n%2)?u-2*i:u;for(let s=0;s<d;s++){let s={side:c,sideIndex:a?n-e-1:e},l=o?r.getSidePoint(s.side,s.sideIndex):this.getArcPoint(s);t.lineTo(l),yield,(o=!o)&&(c=(c+1)%i,a=!a)}s||(t.lineTo(r.getSidePoint(0,e+1)),yield,o=!1,a=!1)}t.endLayer()}*drawStrings(t){let{ringSize:e,ringColor:i,isSingleColor:n,singleColor:s,renderStar:r=!0}=this.config;n&&t.setColor(s),yield*this.drawCircle(t),0!==e&&(yield*this.calc.circle.drawRing(t,{ringSize:e,color:n?null:i})),r&&(yield*this.drawStar(t))}drawNails(t){this.calc.circle.drawNails(t),this.calc.star.drawNails(t)}getStepCount(t){let{ringSize:e,sides:i,sideNails:n,renderStar:s}=this.config,r=this.getCalc(t),a=e?r.circle.getRingStepCount():0;return(i%2?Math.ceil(n/2):n-1)*((i%2?4*i:2*i)+1)-(i%2?2*i+(n%2?2*i:0):0)-1+a+(s?tM.getStepCount(this.config):0)}getNailCount(){let{sides:t,sideNails:e,centerRadius:i}=this.config;return t*e+t*(e-1)-(i?0:t-1)}thumbnailConfig=({sideNails:t})=>({sideNails:Math.min(t,18)});testStepCountConfig=[{sides:3,sideNails:4,ringSize:0,renderStar:!1},{sides:3,sideNails:11,ringSize:0,renderStar:!1},{sides:4,sideNails:11,ringSize:0,renderStar:!1},{sides:4,sideNails:10,ringSize:0,renderStar:!1}]}const tL=[{size:.25,end:1,color:"#a94fb0"},{size:.125,end:.888,color:"#ec6ad0"},{size:0,end:.826,color:"#f08ad5",reverse:!0}];class tP extends to{static type="assymetry";name="Assymetry";id="assymetry";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[tf.nailsConfig,tf.rotationConfig,tf.distortionConfig,{key:"layers",label:"Layers",type:"group",children:tL.map(({size:t,end:e,color:i,reverse:n},s)=>{let r=s+1;return{key:`layer${r}`,label:`Layer ${r}`,type:"group",children:[{key:`show${r}`,label:"Enable",defaultValue:!0,type:"checkbox",isStructural:!0},{key:`size${r}`,label:"Size",defaultValue:t,type:"range",attr:{min:0,max:.5,step:({n:t})=>1/t},displayValue:t=>Math.round(t.n*t[`size${r}`]),show:t=>t[`show${r}`],isStructural:!0},{key:`end${r}`,label:"End Position",defaultValue:e,type:"range",attr:{min:0,max:1,step:({n:t})=>1/t},displayValue:t=>Math.round(t.n*t[`end${r}`]),show:t=>t[`show${r}`],affectsNails:!1,isStructural:!0},{key:`color${r}`,label:"Color",defaultValue:i,type:"color",show:t=>t[`show${r}`],affectsNails:!1,isStructural:!0},{key:`reverse${r}`,label:"Reverse",defaultValue:!0===n,type:"checkbox",show:t=>t[`show${r}`],affectsNails:!1,isStructural:!0}]}})}];getAspectRatio(){return(this.calc??this.getCalc({size:[100,100]})).circle.getAspectRatio()}getCalc({size:t}){let{rotation:e,n:i,margin:n=0,distortion:s}=this.config,r=new tf({size:t,n:i,margin:n,rotation:e-.25,distortion:s}),a=x*r.radius/i,o=r.radius,l=Math.round(o/a),c=r.getPoint(0),u=l+i;return{circle:r,lineSpacing:o/l,lineNailCount:l,firstCirclePoint:c,layers:[,,,].fill(null).map((t,e)=>d.call(this,e+1)).filter(({enable:t})=>t),totalNailCount:u,totalIndexCount:u+l};function d(t){let e=Math.round(i*this.config["size"+t])+l;return{size:e,endIndex:Math.round(this.config["end"+t]*(u+l))-e,color:this.config["color"+t],enable:this.config["show"+t],isReverse:this.config["reverse"+t]}}}getPoint(t){if(t<this.calc.lineNailCount||t>this.calc.totalNailCount){let e=(t<this.calc.lineNailCount?this.calc.lineNailCount-t:t-this.calc.totalNailCount)*this.calc.lineSpacing;return[this.calc.firstCirclePoint[0]-e*Math.sin(this.calc.circle.rotationAngle),this.calc.firstCirclePoint[1]-e*Math.cos(this.calc.circle.rotationAngle)]}{let e=t-this.calc.lineNailCount;return this.calc.circle.getPoint(e)}}*drawCircle(t,{endIndex:e,color:i,isReverse:n,size:s}){let r,a,o=!1;t.setColor(i);let l=this,c=n?-1:1;for(let i=0;i<=e;i++){r&&(t.renderLine(r,this.getPoint(a+c)),yield);let e=r?this.getPoint(a+c):this.getPoint(u(i));a=u(o?i:i+s),r=this.getPoint(a),t.renderLine(e,r),yield,o=!o}function u(t){return n?l.calc.totalIndexCount-t:t}}*drawStrings(t){for(let e of this.calc.layers)yield*this.drawCircle(t,e)}drawNails(t){this.calc.circle.drawNails(t,{nailsNumberStart:this.calc.lineNailCount+1});for(let e=0;e<this.calc.lineNailCount;e++)t.addNail({point:this.getPoint(e),number:e+1})}getStepCount(t){let{layers:e}=this.getCalc(t);return e.reduce((t,e)=>t+2*e.endIndex+1,0)}getNailCount(t){let e=this.getCalc({size:t});return e.circle.config.n+e.lineNailCount}thumbnailConfig=({n:t})=>({n:Math.min(t,50)})}const tR={label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1+1/360,step:1/360},isStructural:!0,affectsStepCount:!1};class tz extends to{static type="freestyle";name="Freestyle";id="freestyle";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[{key:"n",label:"Circle nails",defaultValue:80,type:"range",attr:{min:1,max:300,step:1},isStructural:!0},{key:"minNailDistance",label:"Min nail distance",defaultValue:20,type:"range",attr:{min:1,max:300,step:1},isStructural:!0},{key:"color",label:"Color",defaultValue:"#ec6ad0",type:"color",affectsNails:!1,affectsStepCount:!1},{key:"layers",label:"Layers",type:"group",children:[{key:"layer1",label:"Layer 1",type:"group",children:[{key:"show1",label:"Enable",defaultValue:!0,type:"checkbox",isStructural:!0},{key:"radius1",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show1:t})=>t,isStructural:!0},{key:"x1",label:"Position X",defaultValue:.5,type:"range",attr:{min:0,max:1,step:.01},show:({show1:t})=>t,isStructural:!0},{key:"y1",label:"Position Y",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01},show:({show1:t})=>t,isStructural:!0},{...tR,key:"rotation1",show:({show1:t})=>t,displayValue:({rotation1:t})=>td(t)},{key:"reverse1",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show1:t})=>t,isStructural:!0}]},{key:"layer2",label:"Layer 2",type:"group",children:[{key:"show2",label:"Enable",defaultValue:!0,type:"checkbox",isStructural:!0},{key:"radius2",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show2:t})=>t,isStructural:!0},{key:"x2",label:"Position X",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01},show:({show2:t})=>t,isStructural:!0},{key:"y2",label:"Position Y",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show2:t})=>t,isStructural:!0},{...tR,key:"rotation2",show:({show2:t})=>t,displayValue:({rotation2:t})=>td(t)},{key:"reverse2",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show2:t})=>t,isStructural:!0}]},{key:"layer3",label:"Layer 3",type:"group",children:[{key:"show3",label:"Enable",defaultValue:!0,type:"checkbox",isStructural:!0},{key:"radius3",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show3:t})=>t,isStructural:!0},{key:"x3",label:"Position X",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show3:t})=>t,affectsStepCount:!1,isStructural:!0},{key:"y3",label:"Position Y",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show3:t})=>t,affectsStepCount:!1,isStructural:!0},{...tR,key:"rotation3",show:({show3:t})=>t,displayValue:({rotation3:t})=>td(t),affectsStepCount:!1},{key:"reverse3",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show3:t})=>t,affectsNails:!1,affectsStepCount:!1,isStructural:!0}]}]}];getAspectRatio({size:t}){return t[0]/t[1]}getCalc({size:t}){let{n:e,margin:i=0,minNailDistance:n}=this.config,s=Math.min(...t.map(t=>t-2*i))/2,r=[,,,].fill(null).map((t,e)=>o.call(this,e+1)).filter(({enable:t})=>t),a=Math.max(...r.map(({circle:t})=>t.config.n));return{layers:r,maxShapeNailsCount:a};function o(r){let a=t=>this.config[t+r],o={enable:a("show"),isReverse:a("reverse"),position:[a("x"),a("y")],radius:s*a("radius"),rotation:a("rotation")},l=Math.min(e,Math.floor(2*Math.PI*o.radius/n));return{circle:new tf({radius:o.radius,size:t,center:o.position.map((e,n)=>o.radius+i+(t[n]-(o.radius+i)*2)*e),n:l,rotation:o.rotation,reverse:o.isReverse}),...o}}}getPoint(t,e){let{circle:i}=t,n=Math.round(e*i.config.n/this.calc.maxShapeNailsCount);return i.getPoint(n)}*drawStrings(t){let e,{color:i}=this.config;t.setColor(i);for(let i=0;i<this.calc.maxShapeNailsCount;i++)for(let n=0;n<this.calc.layers.length;n++){let s=this.calc.layers[n],r=e??this.getPoint(s,i),a=[];0===n&&i&&a.push(this.getPoint(s,i));let o=n+1;o===this.calc.layers.length&&(o=0),e=this.getPoint(this.calc.layers[o],i),t.renderLine(r,e),yield}}drawNails(t){this.calc.layers.forEach(({circle:e},i)=>e.drawNails(t,{getNumber:t=>`${i+1}_${t+1}`}))}getStepCount(t){let{layers:e,maxShapeNailsCount:i}=this.getCalc(t);return e.length*i}thumbnailConfig=({n:t,minNailDistance:e})=>({minNailDistance:Math.min(e,3),n:Math.min(t,40)})}const tE=K.getConfig({defaults:{isMultiColor:!0,color:"#ff0000",multicolorRange:1,multicolorStart:0,multicolorByLightness:!0,minLightness:20,maxLightness:50},exclude:["colorCount"]});class tA extends to{static type="polygon";name="Polygon";id="polygon";controls=[{key:"sides",label:"Sides",defaultValue:5,type:"range",attr:{min:3,max:10,step:1},isStructural:!0},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:1,max:100,step:1},isStructural:!0},{key:"bezier",label:"Bezier",defaultValue:2,type:"range",attr:{min:1,max:4,step:1},show:({sides:t})=>t>4,affectsNails:!1,affectsStepCount:!1},tg.rotationConfig,tE];defaultValues={nailsColor:"#5c5c5c",nailRadius:1};color;colorMap;getCalc({size:t}){let{n:e,rotation:i,sides:n,margin:s}=this.config;return{polygon:new tg({sides:n,rotation:i/(2*n),margin:s,size:t,nailsPerSide:e,fitSize:!0})}}setUpDraw(t){super.setUpDraw(t);let{sides:e,isMultiColor:i}=this.config;this.color=new K({...this.config,isMultiColor:i,colorCount:e}),i?this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:e}):this.colorMap=null}getAspectRatio(t){let{polygon:e}=this.getCalc(t);return e.getAspectRatio()}*drawStrings(t){let{sides:e,bezier:i}=this.config,n=Math.min(i,Math.ceil(e/2)-1),s=0;t.setColor(this.color.getColor(0));for(let i=0;i<e;i++){let r=(i+n)%e;this.colorMap&&t.setColor(this.colorMap.get(s));for(let e=0;e<this.config.n;e++)t.renderLine(this.calc.polygon.getSidePoint({side:i,index:e}),this.calc.polygon.getSidePoint({side:r,index:e})),yield,s++}}getStepCount(){let{sides:t,n:e}=this.config;return t*e}drawNails(t){this.calc.polygon.drawNails(t)}thumbnailConfig=({n:t})=>({n:Math.min(t,20)})}const tV=K.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:132,multicolorStart:53,multicolorByLightness:!1,minLightness:30,maxLightness:70},exclude:["colorCount"]});class tT extends to{static type="flower";name="Flower";id="flower";link="https://www.sqrt.ch/Buch/fadenmodell4_100.svg";controls=[{key:"sides",label:"Sides",defaultValue:4,type:"range",attr:{min:3,max:20,step:1},isStructural:!0},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:2,max:100,step:1},isStructural:!0},{key:"layers",label:"Layers",defaultValue:2,type:"range",attr:{min:1,max:10,step:1},isStructural:!0},tg.rotationConfig,tV];defaultValues={nailsColor:"#29f1ff",nailRadius:1,stringWidth:.5};color;getCalc({size:t}){let{n:e,rotation:i,sides:n,layers:s,margin:r}=this.config,a=1/(n*s);return{polygons:tp(s,s=>new tg({sides:n,rotation:i/n+s*a,margin:r,size:t,nailsPerSide:e,radiusNailsCountSameAsSides:!0}))}}setUpDraw(t){super.setUpDraw(t);let{layers:e,isMultiColor:i}=this.config;this.color=new K({...this.config,isMultiColor:i,colorCount:e})}getAspectRatio(){return V(A(...(this.calc??this.getCalc({size:[100,100]})).polygons.map(t=>t.getBoundingRect())))}*drawStrings(t){let{sides:e,layers:i,n:n}=this.config;for(let s=0;s<i;s++){t.setColor(this.color.getColor(s));let i=this.calc.polygons[s];for(let s=0;s<e;s++){let r=(s+1)%e;for(let e=0;e<n;e++){let n=[e,this.config.n-e-1];t.renderLine(i.getCenterPoint({side:s,index:n[0]}),i.getSidePoint({side:s,index:e})),yield,t.lineTo(i.getCenterPoint({side:r,index:n[1]})),yield}}}}drawNails(t){t.addNail({point:this.calc.polygons[0].getCenterPoint({side:0,index:0}),number:"C"}),this.calc.polygons.forEach((e,i)=>e.drawNails(t,{drawCenter:!0,drawCenterNail:!1,getNumber:t=>`${String.fromCharCode(65+i)}_${t}`}))}getStepCount(){let{sides:t,n:e,layers:i}=this.config;return t*e*2*i}getNailCount(t){let{layers:e}=this.config;return e*(this.calc??this.getCalc({size:t})).polygons[0].getNailsCount({drawCenter:!0,drawCenterNail:!1})+1}thumbnailConfig=({n:t})=>({n:Math.min(t,20)});testStepCountConfig=[{sides:3,n:2,layers:1}]}const t_=K.getConfig({defaults:{isMultiColor:!0,color:"#ffffff",multicolorRange:102,multicolorStart:239,multicolorByLightness:!1,minLightness:30,maxLightness:70,colorCount:4},exclude:["repeatColors","mirrorColors"]});class tI extends to{static type="maurer_rose";name="Maurer Rose";id="maurer_rose";link="https://blog.glitch.land/en/posts/maurer-rose/";linkText="Learn";controls=[{key:"n",label:"N",defaultValue:4,type:"range",attr:{min:2,max:12,step:1},isStructural:!0},{key:"maxSteps",label:"Max steps",defaultValue:512,type:"range",attr:{min:3,max:720,step:1},isStructural:!0},{key:"angle",label:"Angle",defaultValue:341,type:"range",attr:{min:1,max:720,step:1},displayValue:({angle:t})=>`${t}\xb0`,isStructural:!0},Y(tf.rotationConfig,"snap"),t_];points;color;colorMap;resetStructure(){super.resetStructure(),this.points&&this.points.clear()}setUpDraw(t){super.setUpDraw(t);let{isMultiColor:e,colorCount:i}=this.config;this.points||(this.points=new Map),this.stepCount||(this.stepCount=this.getStepCount()),this.color=new K({...this.config,isMultiColor:e,colorCount:i}),e?this.colorMap=this.color.getColorMap({stepCount:this.stepCount,colorCount:i}):this.colorMap=null}getAspectRatio({size:t}){let{n:e,rotation:i,margin:n}=this.config;return new tg({size:t,sides:e%2?e:2*e,nailsPerSide:10,margin:n,rotation:i,center:_(t)}).getAspectRatio()}getCalc({size:t}){let{angle:e,rotation:i,maxSteps:n,margin:s}=this.config;return{angleRadians:x*e/n,radius:Math.min(...t)/2-s,currentSize:R(t,t=>t-2*s),rotationAngle:-(2*Math.PI)*i,center:_(t)}}getPoint(t){let{rotationAngle:e,angleRadians:i,radius:n,center:s}=this.calc;if(this.points.has(t))return this.points.get(t);let r=t*i,a=n*Math.sin(this.config.n*r),o=[s[0]-a*Math.cos(r-e),s[1]-a*Math.sin(r-e)];return this.points.set(t,o),o}*generatePoints(){let t=this.stepCount;for(let e=0;e<t+1;e++)yield{point:this.getPoint(e),index:e}}*drawStrings(t){let e,i=this.generatePoints();for(let{point:n,index:s}of(t.setColor(this.color.getColor(0)),i)){if(!e){e=n;continue}if(this.colorMap){let e=this.colorMap.get(s);e&&t.setColor(e)}t.renderLine(e,n),e=n,yield}}getStepCount(){if(this.stepCount)return this.stepCount;let{maxSteps:t,angle:e,n:i}=this.config,n=function t(e,i){return i?t(i,e%i):e}(t,e),s=t/n;return!(s%2)&&i%2&&(s/=2),Math.round(s)}drawNails(t){for(let{point:e,index:i}of this.generatePoints())t.addNail({point:e,number:i})}}const tD=K.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:30,multicolorStart:25,multicolorByLightness:!0,minLightness:40,maxLightness:95,colorCount:3,repeatColors:!0,saturation:83,reverseColors:!0},customControls:[{key:"colorPerLevel",label:"Color per level",defaultValue:!0,type:"checkbox",affectsNails:!1}]}),t$=-x/6,tF=Array(6).fill(null).map((t,e)=>Math.PI/2+t$*e),tO={evenly:{f:(t,{ringSize:e,layers:i,n:n})=>Math.floor((i-t)*Math.floor(n*e)/i),name:"Evenly"},distance:{f:(t,{n:e,ringSize:i,layerDistance:n})=>{let s=Math.floor(e*i);return t>0?s-t*n:s},name:"Specific distance"}},tB=K.getConfig({defaults:{isMultiColor:!0,color:"#ff0000",multicolorRange:133,multicolorStart:239,multicolorByLightness:!1,minLightness:30,maxLightness:70,colorCount:4},customControls:[{key:"colorPerLayer",label:"Color per layer",defaultValue:!0,type:"checkbox",affectsNails:!1}]});class tq extends to{static type="comet";name="Comet";id="comet";controls=[tf.nailsConfig,{key:"layers",label:"Layers",defaultValue:5,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},{key:"ringSize",label:"First layer size",description:"Nail count from the top center nail to the first connected nail in the first layer",defaultValue:.3,type:"range",attr:{min:0,max:1,step:.01},displayValue:({ringSize:t,n:e})=>Math.floor(e*t),isStructural:!0,affectsNails:!1},{key:"layerSpread",label:"Layer Spread",type:"select",defaultValue:"distance",options:Object.entries(tO).map(([t,{name:e}])=>({value:t,label:e})),isStructural:!0,affectsNails:!1},{key:"layerDistance",label:"Layer Distance",type:"range",attr:{min:1,max:({n:t,layers:e})=>Math.floor(t/2/e),step:1},defaultValue:1,isStructural:!0,show:({layerSpread:t})=>"evenly"!==t,affectsNails:!1},tf.rotationConfig,tf.distortionConfig,tf.displacementConfig,tB];defaultValues={n:51,layers:11,colorPerLayer:!0,multicolorRange:203,multicolorStart:137,ringSize:.47,rotation:.25,distortion:.38,displacementFunc:"fastInOut",displacementMag:1.8,displacementFastArea:.43,layerSpread:"distance",layerDistance:1};color;getCalc(t){return{circle:new tf({size:t.size,n:this.config.n,margin:this.config.margin,rotation:this.config.rotation,distortion:this.config.distortion,displacementFunc:this.config.displacementFunc,displacementMag:this.config.displacementMag,displacementFastArea:this.config.displacementFastArea})}}setUpDraw(t){super.setUpDraw(t),this.stepCount||(this.stepCount=this.getStepCount());let{isMultiColor:e,colorCount:i,layers:n,colorPerLayer:s}=this.config,r=e?s?n:Math.min(i,n):1;this.color=new K({...this.config,isMultiColor:e,colorCount:r})}getAspectRatio(t){return this.getCalc(t).circle.getAspectRatio()}getLayerRingDistance(t){let e=tO[this.config.layerSpread];if(!e)throw Error(`Invalid spread mode, "${this.config.layerSpread}"!`);return e.f(t,this.config)}getLayerRingStepCount(t){let e=this.getLayerRingDistance(t);return(this.config.n-e+1)*2-1}*drawLayer(t,e=0){let{n:i}=this.config,n=this.getLayerRingDistance(e),s=i-n+1,r=this.calc.circle.getPoint(0),a=0;t.setColor(this.color.getColor(e));for(let e=0;e<i-n+1;e++){let i=e+n,o=this.calc.circle.getPoint(i);t.renderLine(r,o),yield,e!==s-1&&(a=e+1,r=this.calc.circle.getPoint(a),t.renderLine(o,r),yield)}}*drawStrings(t){for(let e=0;e<this.config.layers;e++)yield*this.drawLayer(t,e)}getStepCount(){if(this.stepCount)return this.stepCount;let{layers:t}=this.config;return Array(t).fill(0).reduce((t,e,i)=>t+this.getLayerRingStepCount(i),0)}getNailCount(){return this.config.n}drawNails(t){this.calc.circle.drawNails(t)}thumbnailConfig=({n:t,layers:e})=>({n:Math.min(t,t%2?29:28),layers:Math.min(e,8)})}class tH extends to{static type="sun";name="Sun";id="sun";controls=[{key:"starGroup",label:"Star",type:"group",children:[...X([...tM.StarConfig,K.getConfig({defaults:{isMultiColor:!0,multicolorRange:1,multicolorStart:237,color:"#ffffff",saturation:40,multicolorByLightness:!0,minLightness:20,maxLightness:97},exclude:["colorCount"]})],"sides",[{key:"layers",label:"Layers",defaultValue:4,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},{key:"layerSpread",label:"Layer spread",defaultValue:.1625,type:"range",displayValue:({layerSpread:t})=>tu(t),attr:{min:.01,max:1,step:.02},show:({layers:t})=>1!==t,isStructural:!0},{key:"starRadius",label:"Star Radius",defaultValue:1,type:"range",displayValue:({starRadius:t})=>tu(t),attr:{min:.2,max:1,step:.01},isStructural:!0,affectsStepCount:!1}])]},{key:"backdrop",label:"Backdrop",type:"group",children:[{key:"backdropSize",label:"Backdrop size",defaultValue:.5,type:"range",displayValue:({backdropSize:t})=>tu(t),attr:{min:0,max:1,step:({sideNails:t})=>1/t},isStructural:!0},{key:"backdropRadius",label:"Backdrop radius",defaultValue:1,type:"range",displayValue:({backdropRadius:t})=>tu(t),attr:{min:0,max:1,step:.01},isStructural:!0,affectsStepCount:!1},{key:"backdropShift",label:"Backdrop shift",defaultValue:0,type:"range",displayValue:({backdropShift:t})=>tu(t),attr:{min:0,max:1,step:({sideNails:t,backdropSize:e})=>(1/(t*(1-e))).toFixed(3)},isStructural:!0,affectsStepCount:!1,affectsNails:!1},{key:"backdropSkip",label:"Backdrop skip",description:"If yes, connections in the backdrop are from the backdrop's nail to the second-nearest side, not the ones near it",defaultValue:!1,type:"checkbox",isStructural:!0,affectsStepCount:!1,show:({sides:t})=>t>3},K.getConfig({defaults:{isMultiColor:!0,multicolorRange:20,multicolorStart:0,color:"#ffffff",saturation:57,multicolorByLightness:!0,minLightness:20,maxLightness:40},propMapper:({key:t,show:e})=>{t[0].toUpperCase(),t.slice(1);let i={key:"backdrop"+t[0].toUpperCase()+t.slice(1),show:e?({backdropIsMultiColor:e})=>"color"===t?!e:e:null};return"multicolorRange"===t&&(i.attr={start:({backdropMulticolorStart:t})=>t,type:"range"}),i},groupLabel:"Backdrop color",maxColorCount:2})]}];getCommonControls(){return X(super.getCommonControls(),"nailsColor",[{key:"backdropNailsColor",label:"Backdrop nails color",type:"color",defaultValue:"#ffffff",show:({showNails:t})=>t,affectsStrings:!1},{key:"backdropNailsRadius",label:"Backdrop nails radius",type:"range",defaultValue:1.5,attr:{min:.5,max:5,step:.25},show:({showNails:t})=>t,affectsStrings:!1}])}#tw;#tx;defaultValues={sideNails:50,sides:16,layers:4,layerSpread:.77,backdropSize:.26,backdropRadius:.9,backdropShift:.59,backdropColorCount:2,centerRadius:.2,maxCurveSize:.64,rotation:.5,saturation:73,multicolorStart:206,multicolorRange:1,multicolorByLightness:!0,minLightness:35,maxLightness:100,nailsColor:"#000000",backdropNailsColor:"#ffffff",backdropNailsRadius:2.275};getCalc({size:t}){let{margin:e=0,sideNails:i,backdropRadius:n=1,backdropSize:s,rotation:r,sides:a,starRadius:o=1}=this.config,l=Math.min(..._(t))-e,c={...this.config,radius:s&&o<n?l*o/n:l,size:t};return{backdropNails:Math.floor(i*s),star:new tM(c),circle:new tf({size:t,n:a,rotation:-1/a/2+(r?r/a:0),radius:n<o?l*n/o:l})}}setUpDraw(t){super.setUpDraw(t);let{layers:e,backdropColorCount:i}=this.config;this.#tw=new K({...this.config,colorCount:e}),this.#tx=new K({...function(t,e){let i={};return Object.entries(t).forEach(([t,n])=>i[e(t,n)]=n),i}(this.config,t=>{let e=t.match(/^backdrop(\w)(.+)/);return e?e[1].toLowerCase()+e[2]:t}),colorCount:i})}getAspectRatio(t){let e=this.getCalc(t);return V(A(e.circle.getBoundingRect(),e.star.getBoundingRect()))}*drawStar(t,e){yield*this.calc.star.drawStrings(t,{size:e})}*generateLayers(t){let{layers:e}=this.config;for(let i=0;i<e;i++){let e=this.#tw.getColor(i);t.setColor(e);let n=this.#tk(i);yield*this.drawStar(t,n)}}*drawBackdrop(t){let e,{backdropNails:i,circle:n,star:s}=this.calc,{sides:r,backdropShift:a,sideNails:o,backdropSkip:l}=this.config,c=l&&r>3,u=0,d=Math.floor(a*(o-i))+i-1;for(let a=0;a<r;a++){t.setColor(this.#tx.getColor(a%2?0:1));let o=n.getPoint(c?(a+1)%r:a),l=!1,h=a%2?1:-1;e=s.getSidePoint(a,d);for(let n=0;n<i;n++)if(t.renderLine(e,o),yield,u=(l?a:a+(c?3:1))%r,e=s.getSidePoint(u,d),t.renderLine(o,e),yield,n<i-1){l=!l,d+=h;let i=s.getSidePoint(u,d);t.renderLine(e,i),e=i}}}*drawStrings(t){yield*this.drawBackdrop(t),yield*this.generateLayers(t)}drawNails(t){let{backdropSize:e,backdropNailsColor:i,backdropNailsRadius:n}=this.config;if(this.calc.star.drawNails(t),e){let e=[];for(let t of this.calc.circle.generateNails())e.push(t);t.addGroup(e,{color:i,radius:n})}}#tk(t){let{layers:e,layerSpread:i,sideNails:n}=this.config;return Math.max(1,n-t*Math.max(1,Math.floor(n/e*i)))}getStepCount(t){let{layers:e,sides:i}=this.config,{backdropNails:n}=this.getCalc(t),s=i*n*2;for(let t=0;t<e;t++){let e=this.#tk(t);s+=tM.getStepCount(this.config,{size:e})}return s}thumbnailConfig=({sideNails:t,backdropNailsRadius:e})=>({sideNails:Math.min(t,10),backdropNailsRadius:Math.min(e,.5)})}class tG extends to{static type="lotus";name="Lotus";id="lotus";controls=[{key:"sides",label:"Sides",description:"How many petals there are in the Lotus",type:"range",defaultValue:18,attr:{min:5,max:64,step:1},isStructural:!0},{key:"density",label:"Density",type:"range",defaultValue:15,attr:{min:1,max:30,step:1},isStructural:!0},Y(tf.rotationConfig,"snap"),{key:"removeSections",label:"Remove sections",type:"range",attr:{min:0,max:1,step:({sides:t,renderCenter:e})=>1/tj(t,e)},defaultValue:4/7,displayValue:({removeSections:t,sides:e,renderCenter:i})=>Math.round(t*tj(e,i)),isStructural:!0},{key:"renderCenter",label:"Render center",type:"checkbox",defaultValue:!0,isStructural:!0},{key:"centerRadius",label:"Center radius",type:"range",defaultValue:1,attr:{min:0,max:1,step:.01},displayValue:({centerRadius:t})=>tu(t),show:({renderCenter:t})=>t,isStructural:!0,affectsStepCount:!1},{key:"renderCenterNails",label:"Render center nails",type:"checkbox",defaultValue:!1,isStructural:!0,show:({renderCenter:t})=>t},K.getConfig({defaults:{isMultiColor:!0,multicolorStart:20,multicolorRange:26,multicolorByLightness:!0,minLightness:32,maxLightness:85,saturation:100,colorCount:6,mirrorColors:!0},customControls:[{key:"radialColor",label:"Radial color",defaultValue:!1,type:"checkbox",affectsNails:!1,affectsStepCount:!1}],maxColorCount:32})];defaultValues={nailsColor:"#a08346"};#tw;getCalc({size:t}){let{sides:e,density:i,margin:n,rotation:s,removeSections:r,centerRadius:a,renderCenter:o}=this.config,l=_(t),c=.5*Math.min(...t)/2,u=x/e,d=i*e,h={n:d,center:[0,0],size:[0,0],radius:0,rotation:0},p=0;if(r){var g;let t=tj(e,o),i=u*(p=Math.min(t,Math.round(r*t))),s=2*c*Math.sin((Math.PI-i)/2),a=(2*c-n)/s;h.n=Math.round(Math.max(e,(g=d*a)-g%e)*(1-2*p/e)+1),c*=a,Object.assign(h,{angleStart:i,angleEnd:x-i})}Object.assign(h,{size:[c-n/2,c-n/2],radius:c-n/2});let f=new tf({n:e,size:t.map(t=>.5*t-n),center:l,radius:c-n/2,rotation:s}),m=tp(e,t=>new tf({...h,center:f.getPoint(t),rotation:s-t/e})),b={circles:m,circleNailsCount:h.n,sideAngle:u,sections:tU(e),removedSections:p,nailsPerSection:Math.floor(h.n/(e-2*p)),nailsPerCircle:h.n,center:l};if(o&&a){let t=b.sections-1-b.removedSections,i=m[0].getPoint(t*b.nailsPerSection),n=a*Math.floor(M(f.center,i));b.centerCircle=new tf({n:e,center:f.center,size:[n,n],radius:n,rotation:s+-Math.ceil((e-4)/2)/2/e})}return b}setUpDraw(t){super.setUpDraw(t);let e=this.config.radialColor?this.calc.sections-this.calc.removedSections-1:this.config.colorCount;!this.config.renderCenter&&this.config.radialColor&&e--,this.#tw=new K({...this.config,colorCount:e})}getAspectRatio(t){return V(A(...this.getCalc(t).circles.map(t=>t.getBoundingRect())))}#tM(t,e){let{radialColor:i}=this.config,{removedSections:n}=this.calc;return this.#tw.getColor(i?e-n:t)}*#tN(t,e,i){let{sides:n}=this.config,{circles:s,sections:r,nailsPerSection:a,nailsPerCircle:o,removedSections:l}=this.calc,c=this.#tM(e,i),u=s[e];t.setColor(c);let d=this.calc.circles[0===e?n-1:e-1];if(0===i){let e=d.getPoint(2*a);for(let i=o-a;i<o;i++)t.renderLine(u.getPoint(i),e),yield;for(let i=0;i<=a;i++)t.renderLine(u.getPoint(i),e),yield}else{let c=i===r-2&&this.calc.centerCircle?this.calc.centerCircle.getPoint(e):d.getPoint(a*(i+2-l)-(n%2&&i===r-2?a/2:0)),h=s[(e+i)%n],p=o-(i+1-l)*a-!!l;for(let e=0;e<=a;e++)t.renderLine(h.getPoint(p+e),c),yield;let g=(i-l)*a+1;for(let e=g;e<g+a;e++)t.renderLine(u.getPoint(e),c),yield}}*drawStrings(t){for(let{side:e,section:i}of this.#tL())yield*this.#tN(t,e,i)}*#tL(){let{radialColor:t,sides:e,renderCenter:i}=this.config,{sections:n,removedSections:s}=this.calc,r=n-(i?1:2);if(t)for(let t=s;t<r;t++)for(let i=0;i<e;i++)yield{side:i,section:t};else for(let t=0;t<e;t++)for(let e=s;e<r;e++)yield{side:t,section:e}}drawNails(t){let{renderCenter:e,renderCenterNails:i}=this.config,{circles:n,centerCircle:s}=this.calc;n.forEach((e,n)=>{e.drawNails(t,{getNumber:t=>`${n+1}_${t}`,excludedNailRanges:i?null:this.#tP()})}),e&&(s?s.drawNails(t,{getNumber:t=>`C_${t+1}`}):t.addNail({point:this.calc.center,number:"C"}))}#tP(){let{renderCenter:t}=this.config,{sections:e,nailsPerSection:i,nailsPerCircle:n,removedSections:s}=this.calc,r=(e-1-s-!t)*i+1;return[[r,n-r]]}getStepCount(t){let{nailsPerSection:e,sections:i,removedSections:n}=this.getCalc(t),{sides:s}=this.config;return(2*e+1)*(i-n-1)*s}thumbnailConfig=({density:t})=>({density:Math.min(t,5)})}function tU(t){return t%2?Math.ceil(t/2):t/2}function tj(t,e){return tU(t)-(e?2:3)}const tW=K.getConfig({defaults:{isMultiColor:!0,colorCount:7,color:"#ffbb29",multicolorRange:21,multicolorStart:32,multicolorByLightness:!0,minLightness:36,maxLightness:98}});function tJ(t,e){return{key:`shape${e}`,label:t,type:"group",children:[{key:`shape${e}Type`,label:"Type",type:"select",defaultValue:"circle",options:[{value:"circle",label:"Circle"},{value:"polygon",label:"Polygon"}],isStructural:!0},2===e?{key:`shape${e}Size`,label:"Size",type:"range",attr:{min:.1,max:1,step:.01},defaultValue:1,displayValue:t=>tu(t[`shape${e}Size`]),isStructural:!0,affectsStepCount:!1}:void 0,{key:`shape${e}Sides`,label:"Sides",type:"range",attr:{min:3,max:24,step:1},defaultValue:7,isStructural:!0,show:t=>"polygon"===t[`shape${e}Type`]},{...tf.distortionConfig,key:`shape${e}Distortion`,show:t=>"circle"===t[`shape${e}Type`]},2===e?{key:"identicalNailCount",label:"Nail count as outer shape",type:"checkbox",defaultValue:!1,isStructural:!0}:null,{key:`shape${e}NailCount`,label:"Nail count",type:"range",attr:{min:3,max:400,step:1},defaultValue:100,isStructural:!0,show:({identicalNailCount:t})=>1===e||!t},{key:`shape${e}Rotation`,label:"Rotation",type:"range",attr:{min:0,max:1,step:.0027},defaultValue:0,displayValue:t=>td(t[`shape${e}Rotation`]),isStructural:!0}].filter(Boolean)}}class tY extends to{static type="dance_of_planets";name="Dance of Planets";id="dance_of_planets";controls=[tJ("Outer shape",1),tJ("Inner shape",2),{type:"range",key:"rounds",label:"Rounds",attr:{min:1,max:30,step:1},defaultValue:1,affectsNails:!1},{key:"reverse",type:"checkbox",label:"Reverse order",description:"If on, while the first shape advances in one direction, the second shape advances in the opposite direction",defaultValue:!1,isStructural:!1,affectsNails:!1},tW];defaultValues={shape1Type:"circle",shape1NailCount:150,shape1Rotation:0,shape2Type:"circle",shape2Size:.8,shape2NailCount:117,shape2Distortion:-.12,shape2Rotation:.216,rounds:2,multicolorRange:132,multicolorStart:198,isMultiColor:!0,multicolorByLightness:!1,colorCount:2};color;colorMap;getCalc({size:t}){let{margin:e}=this.config,i=_(t);function n({type:n,diameter:s=1,nailCount:r,sides:a,rotation:o=0,distortion:l}){return"circle"===n?new tf({size:R(t,t=>t*s),n:r,radius:Math.min(...t)*s/2,center:i,margin:e,reverse:!0,rotation:o,distortion:l}):(r=Math.max(r,a=a??3),new tg({size:R(t,t=>t*s),sides:a??3,nailsPerSide:Math.round(r/a),center:i,margin:e,rotation:o}))}let s=this.#tR(this.config.shape1Type,this.config.shape1NailCount,this.config.shape1Sides),r=this.config.identicalNailCount?s:this.config.shape2NailCount;return r=this.#tR(this.config.shape2Type,r,this.config.shape2Sides),{shape1:n({type:this.config.shape1Type,nailCount:s,sides:this.config.shape1Sides,rotation:this.config.shape1Rotation,distortion:this.config.shape1Distortion}),shape2:n({type:this.config.shape2Type,diameter:this.config.shape2Size,nailCount:r,sides:this.config.shape2Sides,rotation:this.config.shape2Rotation,distortion:this.config.shape2Distortion}),shape1NailCount:s,shape2NailCount:r}}#tR(t,e,i){return"circle"===t?e:e<=i?i:e-e%i}setUpDraw(t){super.setUpDraw(t);let{colorCount:e}=this.config;this.color=new K(this.config),e&&(this.colorMap=this.color.getColorMap({stepCount:this.#tz(),colorCount:e}))}getAspectRatio(){let{shape1:t,shape2:e}=this.calc??this.getCalc({size:[100,100]}),i=t.getBoundingRect(),n=e.getBoundingRect();return Math.max(i.width,n.width)/Math.max(i.height,n.height)}#tz(){let{shape1NailCount:t,shape2NailCount:e}=this.calc;return Math.max(t,e)*this.config.rounds}*drawStrings(t){let{shape1:e,shape2:i,shape1NailCount:n,shape2NailCount:s}=this.calc,{reverse:r}=this.config,a=this.#tz();t.setColor("#ffffff"),t.setStartingPoint(e.getPoint(0));let o=!0,l=r?t=>s-(t%s||s):t=>t%s;for(let s=0;s<a;s++){let r=this.colorMap.get(s);r&&t.setColor(r),t.lineTo(o?i.getPoint(l(s)):e.getPoint(s%n)),yield,s!==a-1&&(t.lineTo(o?i.getPoint(l(s+1)):e.getPoint((s+1)%n)),yield,o=!o)}}getStepCount(t){return this.calc||(this.calc=this.getCalc(t)),2*this.#tz()-1}getNailCount(t){let e=this.getCalc({size:t});return e.shape1NailCount+e.shape2NailCount}drawNails(t){this.calc.shape1.drawNails(t,{getNumber:t=>`A_${t}`}),this.calc.shape2.drawNails(t,{getNumber:t=>`B_${t}`})}thumbnailConfig=t=>{let e=this.#tR(t.shape1Type,t.shape1NailCount,t.shape1Sides),i=t.identicalNailCount?e:t.shape2NailCount;if(e<=80&&i<=80)return{};let n=e/i;return n>=1?(e=80,i=80/n):(i=80,e=80*n),{shape1NailCount:e,shape2NailCount:i}}}class tZ extends tc{config;from;to;distance;spaces;constructor(t){if(super(),t.n<1)throw Error("Can't create a Line with n less than 1.");this.config=t;let{rotation:e,from:i,to:n,n:s}=t;if(e){let t=-x*e,s=this.#tE();this.from=this.#tA(i,s,t),this.to=this.#tA(n,s,t)}else this.from=t.from,this.to=t.to;this.distance=[this.to[0]-this.from[0],this.to[1]-this.from[1]],this.spaces=s-1}#tE(){let{from:t,to:e,rotationCenter:i}=this.config;if(!i||"center"===i)return[t[0]+(e[0]-t[0])/2,t[1]+(e[1]-t[1])/2];switch(i){case"from":return t;case"to":return e;default:return i}}#tA(t,e,i){let n=t[0]-e[0],s=t[1]-e[1],r=Math.hypot(n,s);if(!r)return t;let a=Math.asin(n/r)+(s<0?Math.PI:0);return[e[0]+Math.sin(a+i)*r,e[1]+Math.cos(a+i)*r]}getPoint(t){let{from:e}=this;return R(e,(e,i)=>e+this.distance[i]*t/this.spaces)}drawNails(t,{getNumber:e,color:i}={}){let n=[];for(let t=0;t<this.config.n;t++)n.push({point:this.getPoint(t),number:e?e(t):t+1});t.addGroup(n,{color:i})}getBoundingRect(){let{from:t,to:e}=this;return{width:Math.abs(this.distance[0]),height:Math.abs(this.distance[1]),top:Math.min(e[1],t[1]),bottom:Math.max(e[1],t[1]),left:Math.min(t[0],e[0]),right:Math.max(t[0],e[0])}}getAspectRatio(){let{width:t,height:e}=this.getBoundingRect();return t/e}}function tX(t){return"h"===t?"vertical":"horizontal"}function tQ(t){return"h"===t?"horizontal":"vertical"}class tK extends to{static type="crosses";name="Crosses";id="crosses";controls=[{type:"range",key:"n",label:"Nails per side",attr:{min:2,max:100,step:1},defaultValue:25,isStructural:!0},{key:"orientation",type:"select",label:"Orientation",defaultValue:"v",options:[{value:"v",label:"↕ Vertical"},{value:"h",label:"↔ Horizontal"}],affectsStepCount:!1,isStructural:!0},{key:"sidesRotation",type:"range",label:"Sides rotation",attr:{min:-.25,max:.25,step:.005,snap:"0"},displayValue:({sidesRotation:t})=>td(t),defaultValue:0,affectsStepCount:!1,isStructural:!0},{key:"fineControl",type:"checkbox",label:"Fine control",defaultValue:!1,affectsStepCount:!1,isStructural:!0},{key:"lockGap",type:"checkbox",label:"Lock horizontal/vertical gap",defaultValue:!0,isStructural:!0,affectsStepCount:!1,show:({fineControl:t})=>!t},{key:"lengthGap",type:"range",label:({orientation:t,lockGap:e})=>e?"Gap":`${th(tQ(t))} gap`,attr:{min:0,max:1,step:.01},displayValue:({lengthGap:t})=>tu(t),defaultValue:.27,affectsStepCount:!1,isStructural:!0,show:({fineControl:t})=>!t},{key:"widthGap",type:"range",label:({orientation:t})=>`${th(tX(t))} gap`,attr:{min:0,max:5,step:.01},displayValue:({widthGap:t})=>tu(t),defaultValue:.43,affectsStepCount:!1,isStructural:!0,show:({lockGap:t,fineControl:e})=>!e&&!t},{key:"center",type:"group",label:"Center ◈",show:({fineControl:t})=>t,children:[{key:"centerLengthSpread",type:"range",label:({orientation:t})=>`Center ${tQ(t)} spread`,attr:{min:.2,max:5,step:.01,snap:"1"},displayValue:({centerLengthSpread:t})=>tu(t),defaultValue:1,affectsStepCount:!1,isStructural:!0},{key:"centerLengthGap",type:"range",label:({orientation:t})=>`Center ${tQ(t)} gap`,attr:{min:0,max:5,step:.01},displayValue:({centerLengthGap:t})=>tu(t),defaultValue:0,affectsStepCount:!1,isStructural:!0},{key:"symmetricCenter",type:"checkbox",label:({orientation:t})=>`Symmetric ${tX(t)} center`,defaultValue:!0,affectsStepCount:!1,isStructural:!0},{key:"centerSpread",type:"range",label:({orientation:t})=>`Center ${tX(t)} spread`,attr:{min:.2,max:5,step:.01,snap:"1"},displayValue:({centerSpread:t})=>tu(t),defaultValue:1,affectsStepCount:!1,isStructural:!0,show:({symmetricCenter:t})=>t},{key:"centerWidthGap",type:"range",label:({orientation:t})=>`Center ${tX(t)} gap`,attr:{min:0,max:5,step:.01},displayValue:({centerWidthGap:t})=>tu(t),defaultValue:0,affectsStepCount:!1,isStructural:!0,show:({symmetricCenter:t})=>t},{key:"centerStartSpread",type:"range",label:({orientation:t})=>`Center ${"v"===t?"left":"up"} spread`,attr:{min:.2,max:5,step:.01,snap:"1"},displayValue:({centerStartSpread:t})=>tu(t),defaultValue:1,affectsStepCount:!1,isStructural:!0,show:({symmetricCenter:t})=>!t},{key:"centerStartGap",type:"range",label:({orientation:t})=>`Center ${"v"===t?"left":"up"} gap`,attr:{min:0,max:5,step:.01},displayValue:({centerStartGap:t})=>tu(t),defaultValue:0,affectsStepCount:!1,isStructural:!0,show:({symmetricCenter:t})=>!t},{key:"centerEndSpread",type:"range",label:({orientation:t})=>`Center ${"v"===t?"right":"down"} spread`,attr:{min:.2,max:5,step:.01,snap:"1"},displayValue:({centerEndSpread:t})=>tu(t),defaultValue:1,affectsStepCount:!1,isStructural:!0,show:({symmetricCenter:t})=>!t},{key:"centerEndGap",type:"range",label:({orientation:t})=>`Center ${"v"===t?"right":"down"} gap`,attr:{min:0,max:5,step:.01},displayValue:({centerEndGap:t})=>tu(t),defaultValue:0,affectsStepCount:!1,isStructural:!0,show:({symmetricCenter:t})=>!t}]},{key:"edges",label:"Edges ◅ ▻",type:"group",show:({fineControl:t})=>t,children:[{key:"edgesSpread",type:"range",label:({orientation:t})=>`Edges ${tQ(t)} spread`,attr:{min:.2,max:5,step:.01,snap:"1"},displayValue:({edgesSpread:t})=>tu(t),defaultValue:1,affectsStepCount:!1,isStructural:!0},{key:"edgesGap",type:"range",label:({orientation:t})=>`Edges ${tQ(t)} gap`,attr:{min:0,max:1,step:.01,snap:"1"},displayValue:({edgesGap:t})=>tu(t),defaultValue:0,affectsStepCount:!1,isStructural:!0},{key:"edgesWidthSpread",type:"range",label:({orientation:t})=>`Edges ${tX(t)} spread`,attr:{min:.2,max:5,step:.01,snap:"1"},displayValue:({edgesWidthSpread:t})=>tu(t),defaultValue:1,affectsStepCount:!1,isStructural:!0},{key:"edgesWidthGap",type:"range",label:({orientation:t})=>`Edges ${tX(t)} gap`,attr:{min:0,max:1,step:.01,snap:"1"},displayValue:({edgesWidthGap:t})=>tu(t),defaultValue:0,affectsStepCount:!1,isStructural:!0}]},K.getConfig({defaults:{isMultiColor:!0,colorCount:2,color:"#ffffff",multicolorRange:1,multicolorStart:1,multicolorByLightness:!0,minLightness:40,maxLightness:100,reverseColors:!0},customControls:[{key:"setCenterColor",label:"Manually set center color",defaultValue:!1,type:"checkbox",affectsNails:!1,affectsStepCount:!1},{key:"centerColor",type:"color",label:"Center color",defaultValue:"#ffd500",show:({setCenterColor:t})=>t,affectsNails:!1,affectsStepCount:!1}],exclude:["repeatColors"],maxColorCount:2})];color;getCalc({size:t}){let{n:e,orientation:i,margin:n,lengthGap:s,widthGap:r,lockGap:a,fineControl:o,centerWidthGap:l,centerSpread:c,symmetricCenter:u,centerLengthGap:d,centerLengthSpread:h,centerStartGap:p,centerStartSpread:g,centerEndGap:f,centerEndSpread:m,edgesGap:b,edgesSpread:y,edgesWidthGap:C,edgesWidthSpread:S,sidesRotation:w}=this.config,v=_(t),k="v"===i,M=(k?t[1]:t[0])-2*n,N=.8*M/3,L=(o?d:s)*N,P=o?(.8*M-s*N)*b/2:s*N,R=o?h:1,z=(M-(L+2*P))/(2*(o?R:1)+2*(o?y:1)),E=0,A=o?z*y:z,V=+!k;function T(){let t=(t,e,i)=>[v[V]-(i?.gap1??t)*z-(i?.length1??e)+E,v[V]+(i?.gap2??t)*z+(i?.length2??e)+E],e=o?null:t(a?s:r,z),[i,n]=o?t(l,c*z,u?void 0:{gap1:p,gap2:f,length1:g*z,length2:m*z}):e,[d,h]=o?t(C,S*z):e,[b,y]=t(C,Math.cos(w*x)*(o?S:1)*z),M=2*(A+z*R+P)+L,N=v[+!!k]-M/2,T=L/2+z*R+P/2+Math.sin(w*x)*z*S,[_,I]=[v[+!!k]-T,v[+!!k]+T],D=Math.min(b,i),$=Math.max(y,n),F=Math.min(N,_),O=Math.max(N+M,I);return{lengthStart:N,edgesWidthStart:d,edgesWidthEnd:h,centerStart:i,centerEnd:n,width:$-D,widthStart:D,widthEnd:$,heightStart:F,height:O-F}}let I=T(),D=t.map(t=>t-2*n),$=D[V],F=D[+!!k],O=Math.min($/I.width,F/I.height),B=v[V]-I.width/2,q=!1,H=Math.trunc(B)-Math.trunc(I.widthStart);H!==E&&(E=H,q=!0),O<1&&(M*=O,L*=O,z*=O,E*=O,A*=O,q=!0,P*=O),q&&(I=T());let{lengthStart:G,width:U}=I,j=tp(4,function(t){let e=G;return 0===t?{vertical:e,horizontal:-1,length:A}:(e+=P+A,1===t)?{vertical:e,horizontal:e-P/2,length:z*R}:(e+=z*R+L,2===t)?{vertical:e,horizontal:e-L/2,length:z*R}:{vertical:e+=z*R+P,horizontal:e-P/2,length:A}}),W=(k?v[0]:v[1])+E,J=tp(4,function(t){let{vertical:i,length:n}=j[t],s=[W,i],r=[W,i+n];return k||(s.reverse(),r.reverse()),new tZ({from:s,to:r,n:e})}),Y=(t,e)=>{if(!w||1===t)return null;let i=w;return k||(i*=-1),(1===e&&0===t||0===e&&2===t)&&(i*=-1),{rotation:i,rotationCenter:"to"}};function Z(t,e){return o?1===t?u?z*c:z*(0===e?g:m):z*S:z}return{verticalLines:J,horizontalLines:tp(3,t=>{let i=1===t?I.centerStart:I.edgesWidthStart,n=1===t?I.centerEnd:I.edgesWidthEnd,s=j[t+1].horizontal,r=Z(t,0),a=Z(t,1);return[new tZ({...Y(t,0),...k?{from:[i,s],to:[i+r,s],n:e}:{from:[s,i],to:[s,i+r],n:e}}),new tZ({...Y(t,1),...k?{from:[n,s],to:[n-a,s],n:e}:{from:[s,n],to:[s,n-a],n:e}})]}),width:U,height:M}}setUpDraw(t){super.setUpDraw(t),this.color=new K(this.config)}getAspectRatio(){let{verticalLines:t,horizontalLines:e}=this.calc??this.getCalc({size:[100,100]}),i=function(...t){if(!t.length)return{top:0,bottom:0,left:0,right:0,width:0,height:0};let e=t[0].getBoundingRect();if(1===t.length)return e;let i=t.slice(1).reduce((t,e)=>{let i=e.getBoundingRect();return{top:Math.min(t.top,i.top),bottom:Math.max(t.bottom,i.bottom),left:Math.min(t.left,i.left),right:Math.max(t.right,i.right),width:0,height:0}},e);return Object.assign(i,{width:i.right-i.left,height:i.bottom-i.top}),i}(...t.concat(e.flat()));return i.width/i.height}*connectLines(t,{verticalLine:e,row:i,isReverse:n=!1,color:s}){let r,{n:a}=this.config,o=this.calc.horizontalLines[i];t.setColor(s),t.setStartingPoint(o[0].getPoint(0));let l=!1;for(let i=0;i<a;i++)r&&(t.lineTo(r.getPoint(i)),yield),t.lineTo(e.getPoint(n?i:a-1-i)),yield,r=o[+!l],t.lineTo(r.getPoint(i)),yield,l=!l}*drawStrings(t){let{verticalLines:e}=this.calc,{setCenterColor:i,centerColor:n,isMultiColor:s}=this.config;for(let[s,r]of[[0,0],[0,1],[1,0],[1,1],[3,2],[3,1],[2,1],[2,2],[1,2],[2,0]]){let a,o=r<s;i&&(1===s||2===s)&&1===r&&(a=n),a||(a=this.color.getColor(+(r>s||s-r>1))),yield*this.connectLines(t,{verticalLine:e[s],row:r,isReverse:o,color:a})}}getStepCount(){let{n:t}=this.config;return 10*(3*t-1)}getNailCount(){return 10*this.config.n}drawNails(t){this.calc.verticalLines.forEach((e,i)=>e.drawNails(t,{getNumber:t=>`${String.fromCharCode(65+i)}_${t+1}`})),this.calc.horizontalLines.forEach(([e,i],n)=>{e.drawNails(t,{getNumber:t=>`1_${n+1}_${t}`}),i.drawNails(t,{getNumber:t=>`2_${n+1}_${t}`})})}thumbnailConfig=t=>({n:Math.min(10,t.n)})}const t0=[tN,tP,tC,tb,ty,tS,tk,tz,tA,tT,tI,class extends to{static type="flower_of_life";name="Flower of Life";id="flower_of_life";link="https://www.reddit.com/r/psychedelicartwork/comments/mk97gi/rainbow_flower_of_life_uv_reactive_string_art/";controls=[{key:"levels",label:"Levels",defaultValue:3,type:"range",attr:{min:1,max:10,step:1},isStructural:!0},{key:"density",label:"Density",defaultValue:10,type:"range",attr:{min:1,max:50,step:1},isStructural:!0},{key:"globalRotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:30,step:1},displayValue:({globalRotation:t})=>`${t}\xb0`,isStructural:!0,affectsStepCount:!1},{key:"fillGroup",label:"Fill",type:"group",children:[{key:"fill",label:"Show fill",defaultValue:!0,type:"checkbox",isStructural:!0,affectsNails:!1},{key:"fillColor",label:"Fill color",defaultValue:"#292e29",type:"color",show:({fill:t})=>t,affectsNails:!1}]},{key:"ringGroup",label:"Ring",type:"group",children:[{key:"renderRing",label:"Show outer ring",type:"checkbox",defaultValue:!0,isStructural:!0},{key:"ringNailCount",label:"Ring nail count",defaultValue:144,type:"range",attr:{min:3,max:360,step:1},show:({renderRing:t})=>t,isStructural:!0},{key:"ringSize",label:"Outer ring size",defaultValue:.23,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:t})=>t,displayValue:({ringSize:t})=>tu(t),isStructural:!0},{key:"ringPadding",label:"Ring padding",defaultValue:.06,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:t})=>t,isStructural:!0,displayValue:({ringPadding:t})=>tu(t)},{key:"ringColor",label:"Ring color",defaultValue:"#e8b564",type:"color",show:({renderRing:t})=>t,affectsNails:!1}]},{key:"renderTriangles",label:"Show triangles",defaultValue:!0,type:"checkbox",isStructural:!0,affectsNails:!1},{key:"renderCaps",label:"Show caps",defaultValue:!0,type:"checkbox",show:({renderTriangles:t})=>t,isStructural:!0},tD];defaultValues={nailsColor:"#474747"};color;colorMap;getCalc(t){let{size:e}=t,{levels:i,density:n,margin:s,globalRotation:r,renderCaps:a,renderRing:o,ringNailCount:l,ringSize:c,ringPadding:u}=this.config,d=r*Math.PI/180+Math.PI/6,h=o?Math.min(...e.map(t=>t/2-s)):null,p=o?Math.floor(c*l/2):0,g=new tg({sides:6,size:e,margin:s+(o?h*(1-Math.cos(p/l*x/2)):0)+(o&&c?u*h:0),rotation:d,fitSize:!1,nailsPerSide:2}).sideSize/i,f=g/(2*Math.cos(Math.PI/6)),m=o&&c?new tf({size:e,n:l,margin:s,rotation:r}):null,b=Array(i+ +!!a).fill(null).map((t,e)=>2*e+1),y={edgeSize:g,triangleHeight:g*Math.sqrt(3)/2,nailsLength:f,triangleCenterDistance:g/2,nailDistance:f/n,triangleCount:6*i**2,countPerLevelSide:b,globalRotationRadians:d,radius:h,ringCircle:m};return{...y,points:this.#tV(y,_(e))}}setUpDraw(t){super.setUpDraw(t);let{isMultiColor:e,levels:i,colorPerLevel:n,colorCount:s,renderRing:r,ringSize:a,ringNailCount:o,...l}=this.config;this.stepCount||(this.stepCount=this.getStepCount(t));let c=e?n?i:Math.min(s,i):1;this.color=new K({...l,isMultiColor:e,colorCount:c}),e?this.colorMap=this.color.getColorMap({stepCount:c,colorCount:c}):this.colorMap=null}getAspectRatio(){return 1}#tT(t,{center:e,rotation:i,isCapLevel:n,triangleIndexInSide:s}){let r;n&&(r=this.#t_((s+2)%3));let a=[,,,].fill(null).map((t,i)=>i===r?[]:[e]);for(let s=0;s<3;s++){if(n&&s===r)continue;let o=i+x/3*s,l=a[s],c=Math.cos(o),u=Math.sin(o);for(let i=1;i<=this.config.density;i++){let n=i*t.nailDistance;l.push([e[0]+n*c,e[1]+n*u])}}return a}#tV(t,e){let{levels:i,renderCaps:n}=this.config,s=t.nailsLength,r=t.triangleHeight-s,a=[],o=n?i+1:i;for(let l=0;l<o;l++){let o=n&&l===i,c=[];a.push(c);let u=t.countPerLevelSide[l],d=tp(u,e=>{let i=e%2==0,n=[t.triangleCenterDistance*(e-l),l*t.triangleHeight+(i?s:r)];return{rotation:Math.atan(n[0]/n[1]),distanceFromCenter:Math.hypot(n[0],n[1])}});for(let i=0;i<6;i++){let n=tF[i];for(let s=0;s<u;s++){if(o&&s%2==0){c.push(null);continue}let{distanceFromCenter:r,rotation:a}=d[s],l=n-a-t.globalRotationRadians,u=[e[0]+r*Math.cos(l),e[1]-r*Math.sin(l)],h=this.#tT(t,{center:u,rotation:n+i*x/3-s*t$+t.globalRotationRadians,isCapLevel:o,triangleIndexInSide:s});c.push(h)}}}return a}*generateTriangleStrings(t,{points:e,level:i,indexInSide:n}){t.setColor(this.color.getColor(i));let{density:s,levels:r}=this.config,a=i===r,o=a?this.#t_(n%3):0,l=a?o:2,c=a?s:s-1;for(let i=o;i<=l;i++){let n=this.#t_(i),r=e[i][0];for(let a=0;a<=c;a++){let o=a%2==0,l=o?this.config.density-a:a,c=o?n:i,u=e[c][l];t.renderLine(r,u),yield,a<s&&(r=e[c][o?l-1:l+1],t.renderLine(u,r),yield)}}}*generateStringsBetweenTriangles(t,{triangle1:e,triangle2:i,level:n,triangleIndex:s,triangleIndexInSide:r,isNextLevel:a}){let{density:o,fillColor:l}=this.config,c=this.calc.countPerLevelSide[n],u=s%c%3;t.setColor(l);let d=r===c-1,h=a?[this.#t_(u),this.#t_(u,-1)]:[u,this.#t_(u,r%2?1:-1)];for(let e=0;e<2;e++)for(let{pointIndex:i,triangle1Points:n,triangle2Points:s}of p.call(this,e))t.renderLine(n[i],s[i]),yield;function*p(t){let n=h[t],s=(function(){return a?this.#t_(n):0===t&&d?1:1===t&&d?0:this.#t_(n,1)}).call(this),r=e[n],l=i[s],c=t?o:o-1;if(0===t)for(let t=0;t<=c;t++)yield{pointIndex:o-t,triangle1Points:r,triangle2Points:l};else for(let t=c;t>=1;t--)yield{pointIndex:o-t,triangle1Points:r,triangle2Points:l}}}#t_(t,e=1){let i=t+e;return i<0?2:i>2?0:i}*drawStrings(t){let{fill:e,renderTriangles:i,renderCaps:n,levels:s,renderRing:r,ringSize:a,ringColor:o}=this.config,l=this.calc.points,c=-1;for(let r of l){let a=++c===s,o=-1,u=r.length-1;for(let d of r){o++;let h=this.calc.countPerLevelSide[c],p=o%h;if(e&&!a&&(0===o&&(yield*this.generateStringsBetweenTriangles(t,{triangle1:r[u],triangle2:d,level:c,triangleIndex:u,triangleIndexInSide:u%h})),o!==u&&(yield*this.generateStringsBetweenTriangles(t,{triangle1:d,triangle2:r[o+1],level:c,triangleIndex:o,triangleIndexInSide:p})),p%2==0&&(n&&i||c<s-1))){let e=Math.floor(o/h)*this.calc.countPerLevelSide[c+1]+p+1;yield*this.generateStringsBetweenTriangles(t,{triangle1:d,triangle2:l[c+1][e],level:c,triangleIndex:o,triangleIndexInSide:p,isNextLevel:!0})}let g=o%this.calc.countPerLevelSide[c];i&&(!a||g%2)&&(yield*this.generateTriangleStrings(t,{points:d,level:c,indexInSide:g}))}}r&&a&&(yield*this.calc.ringCircle.drawRing(t,{ringSize:a/2,color:o}))}getStepCount(t){if(this.stepCount)return this.stepCount;let e=this.calc??this.getCalc(t),{density:i,renderTriangles:n,renderCaps:s,levels:r,fill:a}=this.config,{triangleCount:o,ringCircle:l}=e,c=n&&s?6*r:0,u=0;if(a){let t=t=>6*(2*t+1);for(let e=0;e<r;e++)u+=t(e)+6*e;u+=c}let d=u*i*2;return(n?o*i*6:0)+c*(2*i+1)+d+(l?l.getRingStepCount():0)}drawNails(t){let e=this.calc.points,i=1;for(let n of e)for(let e of n)if(null!=e)for(let n of e)for(let e of n)t.addNail({point:e,number:i++});this.calc.ringCircle&&this.calc.ringCircle.drawNails(t,{nailsNumberStart:i})}thumbnailConfig=({density:t})=>({density:Math.min(t,3)})},tq,tH,tG,tY,tK];function t1(t){let e=t0.find(({type:e})=>e===t);return e?new e:t5.getPatternByID(t)}const t2="string_art_app_data";class t5 extends i{elements;currentPattern;constructor(){super(),this.elements={saveDialog:document.querySelector("#save_dialog")},document.querySelector("#pattern_menu").addEventListener("select",t=>{switch(t.detail.value){case"save_as":this.#tI();break;case"delete":this.deletePattern();break;case"save":this.saveCurrentPattern();break;case"rename":this.renameCurrentPattern()}}),document.querySelector("#save_btn").addEventListener("click",()=>{this.currentPattern.isTemplate?this.#tI():this.saveCurrentPattern()})}#tI(){let t=this.#tD(),e=W().name??`Pattern #${t}`;O({title:"Save pattern",description:"Name this pattern:",submit:"Save",value:e}).then(t=>{this.saveNewPattern({type:this.currentPattern.type,config:this.currentPattern.config,name:null==t||""===t?e:t})},()=>{})}setPattern(t){this.currentPattern=t}static patternDataToStringArt({type:t,...e}){let i=function(t){let e=t0.find(({type:e})=>e===t);if(!e)throw Error(`Unknown pattern type, "${t}"!`);return new e}(t);return Object.assign(i,e),i.markConfigAsDefault(),i}static getSavedPatterns(){let{patterns:t}=this.loadAppData();return t.map(this.patternDataToStringArt)}static getPatternByID(t){let e=this.loadPatternDataById(t);return e?this.patternDataToStringArt(e):null}static loadPatternDataById(t){let{patterns:e}=this.loadAppData();return e.find(({id:e})=>e===t)}#tD(){let t=t5.loadAppData(),e=t?.patterns?.length?Number(t.patterns[t.patterns.length-1].id):0;return String(isNaN(e)?1:e+1)}saveNewPattern(t){let e=t5.loadAppData(),i=this.#tD(),n={...t,id:i};return e.patterns.push(n),t5.saveAppData(e),this.emit("newPattern",{pattern:t5.patternDataToStringArt(n)}),n}savePattern(t){let e=t5.loadAppData(),i=e.patterns.findIndex(({id:t})=>t===this.currentPattern.id);-1!==i&&(e.patterns[i]=t,t5.saveAppData(e),this.emit("save",{pattern:t5.patternDataToStringArt(t)}))}saveCurrentPattern(){let t={id:this.currentPattern.id,name:this.currentPattern.name,type:this.currentPattern.type,config:this.currentPattern.config};return this.savePattern(t),t}renameCurrentPattern(){O({title:"Rename",description:"Name this pattern:",submit:"Save",value:this.currentPattern.name}).then(t=>{if(t!==this.currentPattern.name){let e=t5.loadPatternDataById(this.currentPattern.id);e.name=t,this.savePattern(e)}this.currentPattern.name=t})}deletePattern(){q({title:"Delete pattern",description:"Are you sure you wish to delete this pattern?",submit:"Delete",type:"error"}).then(()=>{let t=t5.loadAppData(),e=t.patterns.findIndex(({id:t})=>t===this.currentPattern.id);if(-1===e)throw Error(`Can't delete pattern with ID "${this.currentPattern.id}", it's not found!`);let i=t.patterns.splice(e,1)[0];t5.saveAppData(t);let n=t5.patternDataToStringArt(i);n.resetDefaultConfig(),this.emit("deletePattern",{pattern:n})},()=>{})}static savePatternDownloadData(t,e){let i=t5.loadAppData();i.downloadData||(i.downloadData={}),i.downloadData[t]=e,this.saveAppData(i)}static getPatternDownloadData(t){let e=t5.loadAppData();return e.downloadData?.[t]}static loadAppData(){let t=localStorage.getItem(t2);try{return t?JSON.parse(t):{patterns:[],downloadData:{}}}catch(t){throw Error("App data is corrupted, failed to load it. "+t.message)}}static saveAppData(t){localStorage.setItem(t2,JSON.stringify(t))}}const t3="minimized";class t4 extends i{elements={root:document.querySelector("#pattern_select_panel"),thumbnails:document.querySelector("#thumbnails"),toggleBtn:document.querySelector("#pattern_select_btn"),dropdown:document.querySelector("#pattern_select_dropdown"),patternName:document.querySelector("#pattern_name")};pattern;thumbnailsRendered=!1;_onClickOutside;constructor(t){super(),this.elements.toggleBtn.addEventListener("click",()=>this.toggle()),t.addEventListener("newPattern",({pattern:t})=>{this.isOpen?this.createThumbnails():this.thumbnailsRendered=!1,this.setCurrentPattern(t),this.emit("select",{patternId:t.id})}),t.addEventListener("save",({pattern:t})=>{this.isOpen?this.createThumbnails():this.thumbnailsRendered=!1,this.setCurrentPattern(t)}),t.addEventListener("deletePattern",({pattern:t})=>{this.isOpen?this.elements.thumbnails.querySelector(`[data-pattern="${t.id}"]`).remove():this.thumbnailsRendered=!1}),this.elements.thumbnails.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();let e=t.target instanceof HTMLElement&&t.target.closest("[data-pattern]");if(!e)return!1;this.emit("select",{patternId:e.dataset.pattern})})}get isOpen(){return!this.elements.root.classList.contains(t3)}toggle(){this.isOpen?this.pattern&&this.close():this.open()}open(){this.isOpen||(this.elements.root.classList.remove(t3),this.thumbnailsRendered||(this.createThumbnails(),this.thumbnailsRendered=!0),this._onClickOutside=t=>{t.target instanceof HTMLElement&&!t.target.closest("#pattern_select_panel")&&this.toggle()},document.body.addEventListener("mousedown",this._onClickOutside))}close(){this.isOpen&&(this.elements.root.classList.add(t3),document.body.removeEventListener("mousedown",this._onClickOutside),this._onClickOutside=null)}setCurrentPattern(t){this.pattern=t,this.elements.patternName.innerText=t?.name??"Choose a pattern"}#t$(t,e){let i=document.createElement("section"),n=document.createElement("h3");n.className="pattern_select_thumbnails_title",n.innerText=t,i.appendChild(n);let s=document.createElement("ul");s.className="pattern_select_thumbnails",i.appendChild(s);let r=document.createDocumentFragment(),a={};e.forEach(t=>{let e=document.createElement("a");e.style.width=e.style.height="100px",a[t.id]=e;let i=t.thumbnailConfig;t.assignConfig({margin:1,enableBackground:!t.config.darkMode||t.config.customBackgroundColor,nailRadius:.5,...i instanceof Function?i(t.config):i});let n=document.createElement("li");r.appendChild(n),e.href=`?pattern=${t.id}`,e.setAttribute("data-pattern",t.id),e.title=t.name,n.appendChild(e)}),s.appendChild(r),this.elements.thumbnails.appendChild(i),e.forEach(t=>{let e=new $(a[t.id],{updateOnResize:!1});e.setSize([100,100]),t.draw(e)})}createThumbnails(){this.elements.thumbnails.innerHTML="",t5.getSavedPatterns().length&&this.#t$("My Patterns",t5.getSavedPatterns());let t=t0.map(t=>new t);this.#t$("Built-in patterns",t)}}const t6="http://www.w3.org/2000/svg";class t8 extends v{svg;backgroundGroup;background=null;linesGroup;nailsGroup;nailsCirclesGroup;nailsTextGroup;currentColor=null;lineWidth=1;currentLineGroup=null;constructor(t){super(t),this.svg=document.createElementNS(t6,"svg"),this.svg.style.setProperty("display","block"),this.backgroundGroup=document.createElementNS(t6,"g"),this.backgroundGroup.setAttribute("data-id","background"),this.linesGroup=document.createElementNS(t6,"g"),this.linesGroup.setAttribute("data-id","lines"),this.nailsGroup=document.createElementNS(t6,"g"),this.nailsGroup.setAttribute("data-id","nails"),this.nailsCirclesGroup=document.createElementNS(t6,"g"),this.nailsCirclesGroup.setAttribute("data-id","nailsCircles"),this.nailsTextGroup=document.createElementNS(t6,"g"),this.nailsTextGroup.setAttribute("data-id","nailsText"),this.nailsGroup.appendChild(this.nailsCirclesGroup),this.nailsGroup.appendChild(this.nailsTextGroup),this.svg.appendChild(this.backgroundGroup),this.svg.appendChild(this.linesGroup),this.svg.appendChild(this.nailsGroup),this.svg.setAttribute("xmlns",t6),t.appendChild(this.svg)}get element(){return this.svg}resetSize(){super.resetSize(),this.svg.style.removeProperty("width"),this.svg.style.removeProperty("height");let t=this.getSize().map(Math.trunc),[e,i]=t;return this.svg.setAttributeNS(t6,"viewBox",`0 0 ${e} ${i}`),this.svg.setAttributeNS(t6,"width",String(e)),this.svg.setAttributeNS(t6,"height",String(i)),this.svg.style.width=e+"px",this.svg.style.height=i+"px",this.currentSize&&L(t,this.currentSize)||(this.currentSize=t,this.emit("sizeChange",{size:t})),t}resetNails(){this.nailsCirclesGroup.innerHTML="",this.nailsTextGroup.innerHTML=""}resetStrings(){this.linesGroup.innerHTML="",this.currentColor=null,this.lineWidth=null}setColor(t){t!==this.currentColor&&(this.currentLineGroup=document.createElementNS(t6,"g"),this.currentLineGroup.setAttribute("stroke",t),this.currentLineGroup.setAttribute("stroke-width",String(this.lineWidth)),this.linesGroup.appendChild(this.currentLineGroup),this.currentColor=t)}setLineWidth(t){this.lineWidth=t??"1",this.linesGroup.setAttributeNS(t6,"stroke-width",String(t??1)),this.linesGroup.childNodes.forEach(e=>{e instanceof SVGGElement&&e.setAttributeNS(t6,"stroke-width",String(t??1))})}setBackground(t){t?(this.background||(this.background=document.createElementNS(t6,"rect"),this.background.setAttribute("width","100%"),this.background.setAttribute("height","100%"),this.backgroundGroup.appendChild(this.background)),this.background.setAttribute("fill",t)):(this.background=null,this.backgroundGroup.innerHTML="")}getSize(){return[this.svg.clientWidth,this.svg.clientHeight]}setSize(t){if(!t)return this.resetSize();if(this.fixedSize)return console.warn(`Trying to set size for Renderer to [${t.join(", ")}], but size is fixed to [${this.fixedSize.join(", ")}].`),this.fixedSize;this.svg.removeAttributeNS(t6,"width"),this.svg.removeAttributeNS(t6,"height"),this.svg.style.width=`${t[0]}px`,this.svg.style.height=`${t[1]}px`;let e=t.map(Math.trunc),[i,n]=e;return this.svg.setAttributeNS(t6,"viewBox",`0 0 ${i} ${n}`),this.svg.setAttributeNS(t6,"width",String(i)),this.svg.setAttributeNS(t6,"height",String(n)),this.currentSize&&L(e,this.currentSize)||(this.currentSize=e,this.emit("sizeChange",{size:e})),e}renderLine(t,e){let i=document.createElementNS(t6,"line");i.setAttribute("x1",String(Math.trunc(t[0]))),i.setAttribute("y1",String(Math.trunc(t[1]))),i.setAttribute("x2",String(Math.trunc(e[0]))),i.setAttribute("y2",String(Math.trunc(e[1]))),this.currentLineGroup.appendChild(i)}clearInstructions(){}renderInstructions(t,e){}renderInstructionsForLastLine(){}hideInstructions(){}showInstructions(){}renderNails(t,{color:e,fontSize:i,radius:n,renderNumbers:s,margin:r=0}){let a=this.getSize()[0]/2;this.nailsCirclesGroup.innerHTML=this.nailsTextGroup.innerHTML="";let o=document.createDocumentFragment(),l=document.createDocumentFragment(),c=n+r;this.nailsTextGroup.style.fontSize=String(i),t.forEach(({point:[t,e],number:i})=>{let r=document.createElementNS(t6,"circle");if(r.setAttribute("cx",String(t)),r.setAttribute("cy",String(e)),r.setAttribute("r",String(n)),o.appendChild(r),s&&null!=i){let n=t<a,s=[n?t-c:t+c,e],r=document.createElementNS(t6,"text");r.innerHTML=String(i),r.setAttribute("x",String(s[0])),r.setAttribute("y",String(s[1])),n&&r.setAttribute("text-anchor","end"),l.appendChild(r)}}),this.nailsCirclesGroup.appendChild(o),this.nailsTextGroup.appendChild(l),null!=e&&(this.nailsCirclesGroup.setAttribute("fill",e),this.nailsTextGroup.setAttribute("fill",e))}clear(){this.linesGroup.innerHTML="",this.nailsGroup.innerHTML=""}toDataURL(){return""}}async function t7(t){try{navigator.share(await ee(t))}catch(t){alert("Error: "+t.message)}}async function t9(){if(!navigator.share)return!1;let t=document.createElement("canvas");t.width=1,t.height=1;let e=t.getContext("2d");e.fillStyle="black",e.fillRect(0,0,1,1);let i=t.toDataURL(),n=await et(i,"test","test.jpg");return navigator.canShare(n)}async function et(t,e,i,n){let s=await (await fetch(t)).blob(),r=[new File([s],i,{type:s.type,lastModified:new Date().getTime()})];return{url:n??window.location.href,files:r,title:document.title,text:e}}async function ee({renderer:t,pattern:e}){return et(t.toDataURL(),"String Art Studio - "+e.name,e.name+".jpg",j(e,{renderer:t instanceof t8?"svg":"canvas",patternAsTemplate:!0}))}async function ei(){if(navigator.serviceWorker&&"127.0.0.1"!==document.location.hostname)try{let t=await navigator.serviceWorker.register("service-worker.js");t.onupdatefound=()=>{let e=t.installing;null!=e&&(e.onstatechange=()=>{"installed"===e.state&&(navigator.serviceWorker.controller?console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."):console.log("Content is cached for offline use."))})}}catch(t){console.error("Error during service worker registration:",t)}}var en={};en=".hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}#inputs,#readonly{white-space:nowrap}#readonly{font-size:14px}input{width:70px}#connector.linked{display:inline-block;transform:rotate(45deg)}";const es=new CSSStyleSheet;es.replaceSync(String(en));const er=["width","height"];class ea extends HTMLElement{static formAssociated=!0;internals;#tF;#tO;#tB;#tq;#tH=!1;floatingPoints;#tG;constructor(){super();let t=this.attachShadow({mode:"open",delegatesFocus:!0});t.adoptedStyleSheets=[es],this.shadowRoot.innerHTML=`
      <span id="inputs">
        <input
          type="number"
          id="width"
          maxlength="3"
          min="1"
          class="dialog-input size-input"
          name="width"
        />
        <span id="connector">&times;</span>
        <input
          type="number"
          id="height"
          maxlength="3"
          min="1"
          class="dialog-input size-input"
          name="height"
        />
      </span>
      <span id="readonly" hidden></span>
    `,this.#tF={width:{element:t.querySelector("#width"),value:0,max:null,defaultValue:null},height:{element:t.querySelector("#height"),value:0,max:null,defaultValue:null}},this.#tG=t.querySelector("#connector"),this.#tO=t.querySelector("#inputs"),this.#tB=t.querySelector("#readonly"),this.internals=this.attachInternals()}static get observedAttributes(){return["width","height","aspect-ratio","max-width","max-height","readonly","default-width","default-height","floating-points"]}get inputs(){return[this.#tF.width.element,this.#tF.height.element]}get width(){return this.#tF.width.value}set width(t){this.setDimensionValue("width",t,{updateOtherDimensionOnce:!0})}get height(){return this.#tF.height.value}set height(t){this.setDimensionValue("height",t,{updateOtherDimensionOnce:!0})}get value(){return[this.width,this.height]}set value(t){if("string"==typeof t){let e=t.match(/^(\d+(?:\.\d+)?),\s?(\d+(?:\.\d+)?)$/);e&&(this.width=Number(e[1]),this.height=Number(e[2]))}else this.width=t[0],this.height=t[1]}get maxWidth(){return this.#tF.width.max}get maxHeight(){return this.#tF.height.max}set maxWidth(t){this.setMaxDimensionValue("width",t)}set maxHeight(t){this.setMaxDimensionValue("height",t)}get isReadonly(){return this.#tH}set isReadonly(t){(this.#tH=t&&"false"!==t)?(f(this.#tO),g(this.#tB)):(g(this.#tO),f(this.#tB))}#tU(){this.#tB.innerHTML=`${this.width} &times; ${this.height}`}applyAspectRatio(t,e){return this.#tq?"width"===t?e*this.#tq:e/this.#tq:e}getOtherDimension(t){return"width"===t?"height":"width"}get aspectRatio(){return this.#tq}set aspectRatio(t){this.#tq=t?Number(t):null,isNaN(this.#tq)&&(this.#tq=null),this.#tq?(this.#tG.classList.contains("linked")||this.#tG.classList.add("linked"),this.#tG.innerHTML="\uD83D\uDD17"):(this.#tG.classList.remove("linked"),this.#tG.innerHTML="&times;")}setMaxDimensionValue(t,e,i=!0){let n=this.#tF[t],s=e=Number(e);if(null!=this.floatingPoints&&(s=e.toFixedPrecision(this.floatingPoints)),s!==n.max&&(n.max=isNaN(s)?null:s,n.max?(n.value&&n.value>s&&(this[t]=s),n.element.setAttribute("max",String(n.max))):n.element.removeAttribute("max"),i&&this.#tq)){let i=this.getOtherDimension(t),n=this.applyAspectRatio(i,e);(!this.#tF[i].max||n<this.#tF[i].max)&&this.setMaxDimensionValue(i,n,!1)}}setMaxDimensions(t){this.setMaxDimensionValue("width",t[0],!1),this.setMaxDimensionValue("height",t[1],!1)}setDimensionValue(t,e,{updateOtherDimension:i=!0,updateOtherDimensionOnce:n=!1}={}){let s=this.#tF[t],r=e;if(null!=this.floatingPoints&&(r=e.toFixedPrecision(this.floatingPoints)),r!==this[t]){if(isNaN(r))console.warn("Attempting to set a NaN value to DimensionsInput width.");else{if(s.max&&(r=Math.min(r,s.max)),s.value=r,s.element.value=String(null!=this.floatingPoints?r.toFixedPrecision(this.floatingPoints):r),i&&this.#tq){let e=this.getOtherDimension(t);this.setDimensionValue(e,this.applyAspectRatio(e,r),{updateOtherDimension:n})}this.#tU()}this.#tj()}}attributeChangedCallback(t,e,i){"aspect-ratio"===t?this.aspectRatio=i:"max-width"===t?this.maxWidth=i:"max-height"===t?this.maxHeight=i:"floating-points"===t?this.setFloatingPoints(Number(i)):"readonly"===t&&(this.isReadonly=i)}connectedCallback(){this.shadowRoot.addEventListener("input",t=>this.#p(t)),this.shadowRoot.addEventListener("focusin",t=>{t.target instanceof HTMLInputElement&&t.target.select()}),this.#tW()}#p(t){if(t.target instanceof HTMLInputElement){let e=Number(t.target.value);for(let i of er)if(t.target===this.#tF[i].element){this[i]=e,this.dispatchEvent(new CustomEvent("dimensionchange",{detail:{value:this.value,dimension:i,width:this.width,height:this.height}}));break}this.#tj()}}#tj(){this.internals.setFormValue(String(this.value.join(",")))}#tW(){for(let t of er){let e=this.#tF[t];if(this.hasAttribute("default-"+t)){let i=Number(this.getAttribute("default-"+t));e.defaultValue=isNaN(i)?0:i,e.element.placeholder=String(i)}if(this.setMaxDimensionValue(t,this.getAttribute("max-"+t)),this.hasAttribute(t)){let i=Number(this.getAttribute(t));this[t]=isNaN(i)?e.defaultValue:i}}if(this.aspectRatio=this.getAttribute("aspect-ratio"),this.isReadonly=this.getAttribute("readonly"),this.hasAttribute("floating-points")){let t=Number(this.getAttribute("floating-points"));this.setFloatingPoints(isNaN(t)?null:t)}}setFloatingPoints(t){null==t||isNaN(t)?(this.floatingPoints=null,this.inputs.forEach(t=>t.removeAttribute("step"))):(this.floatingPoints=t,this.inputs.forEach(t=>t.setAttribute("step",String(1/10**this.floatingPoints))),er.forEach(e=>{this[e]&&(this[e]=this[e].toFixedPrecision(t))}))}}customElements.define("dimensions-input",ea);class eo extends HTMLElement{button;#tJ;constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
      <style>
        :host {
          display: inline-block;
          position: relative;
        }

        button {
          display: block;
          padding: 10px 15px;
          background: transparent;
          color: white;
          border: none;
          cursor: pointer;
          font: inherit;
        }

        button:hover {
          background: #444;
        }

        button:focus {
          background: rgba(255,255,255,.2)
        }
        ul {
          display: none;
          position: absolute;
          top: 100%;
          right: 0;
          min-width: 120px;
          background: var(--color-dialog-background);
          border: var(--border-dialog);
          margin: 0;
          padding: 0;
          list-style: none;
          z-index: 1000;
          box-shadow: 1px 1px 10px rgba(0,0,0,.7)
        }

        :host(.open) ul {
          display: block;
        }
      </style>

      <button aria-haspopup="true" aria-expanded="false">
        <slot name="label">Menu</slot>
      </button>
      <ul role="menu">
        <slot></slot>
      </ul>
    `}connectedCallback(){this.button=this.shadowRoot.querySelector("button"),this.button.addEventListener("click",()=>this.toggle()),this.#tJ&&(this.button.style=this.#tJ),document.addEventListener("click",t=>{this.contains(t.target)||this.shadowRoot.contains(t.target)||this.close()}),this.button.addEventListener("keydown",t=>{"Escape"===t.key&&(this.close(),this.button.focus())}),this.addEventListener("item-selected",t=>{this.dispatchEvent(new CustomEvent("select",{detail:{value:t.detail.value},bubbles:!0,composed:!0})),this.close()})}static get observedAttributes(){return["button-style"]}attributeChangedCallback(t,e,i){"button-style"===t&&(this.button?this.button.style=i:this.#tJ=i)}toggle(){let t=this.classList.toggle("open");this.button.setAttribute("aria-expanded",String(t))}close(){this.classList.remove("open"),this.button.setAttribute("aria-expanded","false")}}customElements.define("dropdown-menu",eo);class el extends HTMLElement{static get observedAttributes(){return["value"]}value="";constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
      <style>
        li {
          list-style: none;
          padding: 12px 40px 12px 20px;
          color: White;
          text-decoration: none;
          white-space: nowrap;
          background: transparent;
          cursor: pointer;
        }
        li:hover {
          background: rgba(255,255,255,.1);
        }
        span:not(:empty) {
          float: left; 
          margin-right: .5em;
          position: relative;
          left: -4px;
          top: 1px;
        }
      </style>
      <li role="menuitem">
        <span id="icon"><slot name="icon"></span>
        <slot></slot>
      </li>
    `}connectedCallback(){this.shadowRoot.querySelector("li").addEventListener("click",t=>{t.preventDefault(),this.dispatchEvent(new CustomEvent("item-selected",{detail:{value:this.value},bubbles:!0,composed:!0}))})}attributeChangedCallback(t,e,i){"value"===t&&(this.value=i)}}customElements.define("dropdown-menu-item",el);var ec={};ec='.hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}@font-face{font-family:string_art_studio;src:url(string_art_studio.09832b61.ttf)format("truetype"),url(string_art_studio.ca3bae77.woff)format("woff"),url(string_art_studio.3d53e5dd.svg#string_art_studio)format("svg");font-weight:400;font-style:normal;font-display:block}i{speak:never;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;line-height:1;font-family:string_art_studio!important}.icon-thread:before{content:""}.icon-rotate:before{content:""}.icon-pencil:before{content:""}.icon-plus:before{content:""}.icon-trash:before{content:""}.icon-diskette_b:before{content:""}.icon-diskette:before{content:""}.icon-menu:before{content:""}.icon-arrow_left:before{content:""}.icon-arrow_right:before{content:""}.icon-caret_down:before{content:""}.icon-download:before{content:""}.icon-fullscreen:before{content:""}.icon-hamburger:before{content:""}.icon-options:before{content:""}.icon-pause:before{content:""}.icon-play:before{content:""}.icon-refresh:before{content:""}.icon-share:before{content:""}.icon-thumbnails:before{content:""}.icon-x:before{content:""}[hidden]{display:none!important}dialog{background:var(--color-dialog-background);color:#fff;border:var(--border-dialog);box-sizing:border-box;width:400px;max-width:calc(100vw - 20px);margin:0;padding:0;position:fixed;top:100px;left:50%;transform:translate(-50%);box-shadow:0 0 10px #000c}dialog[open]{flex-direction:column;display:flex}#dialog_wrapper{box-sizing:border-box;width:100%;max-height:calc(100vh - 20px);padding:1em;overflow:auto}dialog.centered{top:50%;transform:translate(-50%)translateY(-50%)}dialog::backdrop{background:#000000b3}.dialog-title{color:var(--color-accent);text-shadow:1px 1px 1px #000;margin-top:0;font-size:1.4em;font-weight:400}dialog.error .dialog-title{color:var(--color-error)}.dialog-menu{text-align:end;flex-direction:row;justify-content:end;align-items:center;margin-bottom:0;display:flex}.dialog-menu button{color:#fff;cursor:pointer;background:0 0;border:none;border-radius:4px;margin-inline-start:.5em;padding:8px 16px;font-size:1em}.dialog-menu button.btn-submit{background:var(--color-input)}dialog.error .dialog-menu button.btn-submit{background:var(--color-error)}.dialog-menu button.btn-submit:hover{background:var(--color-input-active)}.dialog-menu .btn-cancel{opacity:.5}.dialog-menu .btn-cancel:hover,.dialog-menu .btn-cancel:focus{opacity:1}.dialog-menu button>i{vertical-align:middle;margin-inline-end:4px;display:inline-block;transform:translateY(-2px)}#dialog_contents{display:flex}#dialog_context_menu{z-index:2;position:absolute;top:0;right:0}';const eu=new CSSStyleSheet;eu.replaceSync(String(ec));class ed extends HTMLElement{dialog;input;static get observedAttributes(){return["dialog-title","description","value","submit","cancel","type","submit-icon"]}constructor(){super();let t=this.attachShadow({mode:"open"});t.adoptedStyleSheets=[eu],this.shadowRoot.innerHTML=`
      <confirm-dialog>
        <input
            type="text"
            class="dialog-input dialog-input-tall"
            name="patternName"
            required
          />
      </confirm-dialog>
    `,this.dialog=t.querySelector("confirm-dialog"),this.input=t.querySelector("input"),this.input.addEventListener("keypress",t=>{"Enter"===t.code&&this.dialog.submit()})}connectedCallback(){this.syncAttributes()}attributeChangedCallback(){this.syncAttributes()}syncAttributes(){ed.observedAttributes.filter(t=>"value"!==t).forEach(t=>{this.hasAttribute(t)?this.dialog.setAttribute(t,this.getAttribute(t)):this.dialog.removeAttribute(t)}),this.hasAttribute("value")&&(this.input.value=this.getAttribute("value")||"")}show(t){return void 0!==t?this.input.value=t:this.hasAttribute("value")&&(this.input.value=this.getAttribute("value")||""),this.input.select(),this.dialog.show().then(()=>this.input.value)}getValue(){return this.input.value}}customElements.define("input-dialog",ed);var eh={};eh='.hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}@font-face{font-family:string_art_studio;src:url(string_art_studio.09832b61.ttf)format("truetype"),url(string_art_studio.ca3bae77.woff)format("woff"),url(string_art_studio.3d53e5dd.svg#string_art_studio)format("svg");font-weight:400;font-style:normal;font-display:block}i{speak:never;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;line-height:1;font-family:string_art_studio!important}.icon-thread:before{content:""}.icon-rotate:before{content:""}.icon-pencil:before{content:""}.icon-plus:before{content:""}.icon-trash:before{content:""}.icon-diskette_b:before{content:""}.icon-diskette:before{content:""}.icon-menu:before{content:""}.icon-arrow_left:before{content:""}.icon-arrow_right:before{content:""}.icon-caret_down:before{content:""}.icon-download:before{content:""}.icon-fullscreen:before{content:""}.icon-hamburger:before{content:""}.icon-options:before{content:""}.icon-pause:before{content:""}.icon-play:before{content:""}.icon-refresh:before{content:""}.icon-share:before{content:""}.icon-thumbnails:before{content:""}.icon-x:before{content:""}[hidden]{display:none!important}dialog{background:var(--color-dialog-background);color:#fff;border:var(--border-dialog);box-sizing:border-box;width:400px;max-width:calc(100vw - 20px);margin:0;padding:0;position:fixed;top:100px;left:50%;transform:translate(-50%);box-shadow:0 0 10px #000c}dialog[open]{flex-direction:column;display:flex}#dialog_wrapper{box-sizing:border-box;width:100%;max-height:calc(100vh - 20px);padding:1em;overflow:auto}dialog.centered{top:50%;transform:translate(-50%)translateY(-50%)}dialog::backdrop{background:#000000b3}.dialog-title{color:var(--color-accent);text-shadow:1px 1px 1px #000;margin-top:0;font-size:1.4em;font-weight:400}dialog.error .dialog-title{color:var(--color-error)}.dialog-menu{text-align:end;flex-direction:row;justify-content:end;align-items:center;margin-bottom:0;display:flex}.dialog-menu button{color:#fff;cursor:pointer;background:0 0;border:none;border-radius:4px;margin-inline-start:.5em;padding:8px 16px;font-size:1em}.dialog-menu button.btn-submit{background:var(--color-input)}dialog.error .dialog-menu button.btn-submit{background:var(--color-error)}.dialog-menu button.btn-submit:hover{background:var(--color-input-active)}.dialog-menu .btn-cancel{opacity:.5}.dialog-menu .btn-cancel:hover,.dialog-menu .btn-cancel:focus{opacity:1}.dialog-menu button>i{vertical-align:middle;margin-inline-end:4px;display:inline-block;transform:translateY(-2px)}#dialog_contents{display:flex}#dialog_context_menu{z-index:2;position:absolute;top:0;right:0}';var ep={};ep="<dialog>\n  <div id=dialog_wrapper>\n    <div id=dialog_context_menu>\n      <slot name=context-menu></slot>\n    </div>\n    <form method=dialog>\n      <h2 class=dialog-title></h2>\n      <p class=dialog-desc></p>\n      <div id=dialog_contents>\n        <slot></slot>\n      </div>\n      <menu class=dialog-menu>\n        <button type=button class=btn-cancel>Cancel</button>\n        <button value=confirm class=btn-submit>\n          <i id=submit_icon class=icon hidden></i>\n          <span id=submit_text></span>\n        </button>\n      </menu>\n    </form>\n  </div>\n</dialog>\n";const eg=new CSSStyleSheet;eg.replaceSync(String(eh));class ef extends HTMLElement{dialog;cancelBtn;submitBtn;titleEl;descEl;submitText;submitIcon;static get observedAttributes(){return["dialog-title","description","submit","cancel","type","centered","submit-icon","width"]}constructor(){super();let t=this.attachShadow({mode:"open"});t.adoptedStyleSheets=[eg],this.shadowRoot.innerHTML=String(ep),this.dialog=t.querySelector("dialog"),this.cancelBtn=t.querySelector(".btn-cancel"),this.submitBtn=t.querySelector(".btn-submit"),this.titleEl=t.querySelector(".dialog-title"),this.descEl=t.querySelector(".dialog-desc"),this.submitText=t.querySelector("#submit_text"),this.submitIcon=t.querySelector("#submit_icon")}connectedCallback(){this.cancelBtn.addEventListener("click",()=>{this.dialog.returnValue="",this.dialog.close()}),this.syncAttributes()}attributeChangedCallback(){this.syncAttributes()}syncAttributes(){if(this.hasAttribute("dialog-title")&&(this.titleEl.textContent=this.getAttribute("dialog-title")),this.hasAttribute("description")&&(this.descEl.textContent=this.getAttribute("description")),this.submitText.textContent=this.getAttribute("submit")||"Submit",this.cancelBtn.textContent=this.getAttribute("cancel")||"Cancel",this.hasAttribute("type")&&"error"===this.getAttribute("type")?this.dialog.classList.add("error"):this.dialog.classList.remove("error"),this.hasAttribute("centered")&&"false"!==this.getAttribute("centered")?this.dialog.classList.add("centered"):this.dialog.classList.remove("centered"),this.hasAttribute("submit-icon")?(this.submitIcon.className="icon-"+this.getAttribute("submit-icon"),g(this.submitIcon)):f(this.submitIcon),this.hasAttribute("width")){let t=this.getAttribute("width"),e=/^\d+$/.test(t);this.dialog.style.setProperty("width",e?`${t}px`:t)}else this.dialog.style.removeProperty("width")}show(t){return this.dialog.showModal(),t?.(),new Promise((t,e)=>{let i=()=>{this.dialog.removeEventListener("close",i),"confirm"===this.dialog.returnValue?t():e()};this.dialog.addEventListener("close",i)})}submit(){this.submitBtn.click()}}customElements.define("confirm-dialog",ef);var em={};em='.hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}@font-face{font-family:string_art_studio;src:url(string_art_studio.09832b61.ttf)format("truetype"),url(string_art_studio.ca3bae77.woff)format("woff"),url(string_art_studio.3d53e5dd.svg#string_art_studio)format("svg");font-weight:400;font-style:normal;font-display:block}i{speak:never;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;line-height:1;font-family:string_art_studio!important}.icon-thread:before{content:""}.icon-rotate:before{content:""}.icon-pencil:before{content:""}.icon-plus:before{content:""}.icon-trash:before{content:""}.icon-diskette_b:before{content:""}.icon-diskette:before{content:""}.icon-menu:before{content:""}.icon-arrow_left:before{content:""}.icon-arrow_right:before{content:""}.icon-caret_down:before{content:""}.icon-download:before{content:""}.icon-fullscreen:before{content:""}.icon-hamburger:before{content:""}.icon-options:before{content:""}.icon-pause:before{content:""}.icon-play:before{content:""}.icon-refresh:before{content:""}.icon-share:before{content:""}.icon-thumbnails:before{content:""}.icon-x:before{content:""}#buttons{grid-area:"controls";border-right:var(--border-light);background:var(--color-header);z-index:3;padding:0 var(--horizontal-padding);justify-content:space-evenly;align-items:center;display:flex;position:relative;box-shadow:0 -2px 6px #0000004d}#buttons .btn{margin:0}.btn{color:#fff;cursor:pointer;background:#0375fb;border:none;border-radius:15px;width:100%;height:30px;margin-bottom:8px}.btn:hover{background:#3592ff}.btn_subdued{color:#000;background:#c5c5c5}.btn_subdued:hover{color:#000;background:#efefef}.circular_btn{width:var(--controls-height);height:var(--controls-height);cursor:pointer;color:var(--color-text);background:0 0;border:none;justify-content:center;align-items:center;font-size:28px;display:flex}.circular_btn:hover{color:var(--color-text);background:#0000004d}.circular_btn img{width:18px;height:18px}.circular_btn.active{background:radial-gradient(circle at 50% 100%,#5205e7,#220c1b);padding:0;box-shadow:inset 0 4px 6px #0009}.circular_btn.active i{transform:scale(.95)}#buttons_dialogs{z-index:2;height:calc(100vh - var(--controls-height) - var(--select-height));width:100%;position:absolute;bottom:100%;overflow:hidden}.buttons_dialog{--buttons-dialog-border-radius:10px;bottom:var(--controls-height);z-index:1;background:var(--color-buttons-dialog);width:var(--sidebar-width);padding:var(--vertical-padding)var(--horizontal-padding);padding-top:calc(2*var(--buttons-dialog-border-radius));border-top:var(--border-light);transition:transform .2s ease-out;position:fixed;transform:translateY(100%);box-shadow:0 -2px 7px #000000b3}.buttons_dialog.open{transform:translateY(0)}.btn-icon{color:#fff;cursor:pointer;background:0 0;border:none;align-items:center;font-size:22px;display:flex}.menu_btn{background:var(--color-accent);height:48px;color:var(--color-text);border-radius:24px;align-items:center;padding:0 32px 0 24px;font-weight:500;text-decoration:none;display:inline-flex;font-size:1.1em!important}@media only screen and (width<=600px){.menu_btn{justify-content:center;width:auto;display:flex}}.menu_btn:hover{background:var(--color-accent-hover);color:var(--color-text);text-decoration:none}.menu_btn img{margin-inline-end:8px}.icon_btn{color:#fffc;cursor:pointer;background:0 0;border:none;border-radius:4px;padding:4px 6px;font-size:14px}.icon_btn:hover{color:#fff}.icon_btn>i{position:relative;top:1px}#wrapper{width:100%;display:block}form{grid-area:form;overflow:auto}#preview{margin-top:1em}#canvas{--checkers1:#fff;--checkers2:#bbb;box-sizing:border-box;background:conic-gradient(var(--checkers2)25%,var(--checkers1)0 50%,var(--checkers2)0 75%,var(--checkers1)0);background-size:40px 40px;outline:1px solid #666;width:100%;height:300px;margin-top:4px;position:relative;box-shadow:inset 0 1px 5px #0000}canvas{width:100%;height:100%;position:absolute;top:0;left:0}@media only screen and (width<=600px){#canvas{max-height:250px}}@media only screen and (width>=601px){#wrapper{grid-template:"preview form"1fr/200px 1fr;gap:1em;display:grid}#preview{grid-area:preview;margin-top:0}}section{margin-bottom:1px}label:not(.icon_btn){margin-bottom:4px;display:block}input[type=checkbox]:checked+.icon_btn{color:#fff;background:#ffffff1a}';var eb={};eb='<confirm-dialog dialog-title="Download image" submit=Download submit-icon=download centered width=640>\n  <div id=wrapper>\n    <form>\n      <fieldset>\n        <label for=type>Type</label>\n        <div class=radio-list>\n          <input type=radio name=type id=type_all value=all checked>\n          <label for=type_all>Image</label>\n          <input type=radio name=type id=type_nails_map value=nails_map>\n          <label for=type_nails_map>Nails map 🔨</label>\n        </div>\n      </fieldset>\n      <label for=size>Image size</label>\n      <section>\n        <div style=flex:0>\n          <select id=size class=dialog-input style=width:auto name=size></select>\n        </div>\n        <div style=white-space:nowrap;flex:1;margin-top:.5em>\n          <div id=width_and_height>\n            <dimensions-input id=image_dimensions name=image_dimensions></dimensions-input>\n            <select class="dialog-lesser-select unit-select" name=unit>\n              <option value=cm>cm</option>\n              <option value=inch>inch</option>\n              <option value=px>px</option>\n            </select>\n            <input type=checkbox id=rotate_image name=rotate_image hidden>\n            <label id=rotate_btn class=icon_btn title=Rotate type=button for=rotate_image>\n              <i class=icon-rotate></i>\n            </label>\n          </div>\n        </div>\n      </section>\n      <section>\n        <label for=pattern_size>Pattern size</label>\n        <dimensions-input id=pattern_size name=pattern_dimensions></dimensions-input>\n        <select class="dialog-lesser-select unit-select" name=unit>\n          <option value=cm>cm</option>\n          <option value=inch>inch</option>\n          <option value=px>px</option>\n        </select>\n      </section>\n      <section>\n        <label for=margin>Margin</label>\n        <input type=number id=margin value=0 style=width:70px min=0 step=1 class="dialog-input size-input" name=margin>\n        <select class="dialog-lesser-select unit-select" name=unit>\n          <option value=cm>cm</option>\n          <option value=inch>inch</option>\n          <option value=px>px</option>\n        </select>\n      </section>\n      <div style=margin-top:1.5em>\n        <expandable-panel legend="More options" minimized>\n          <fieldset class=dialog-checkbox hidden id=render_numbers_block>\n            <string-art-checkbox id=render_numbers label="Show nail numbers" name=render_numbers data-updates-preview>\n          </string-art-checkbox></fieldset>\n\n          <fieldset id=dpi_block>\n            <label for=dpi>Print resolution</label>\n            <select id=dpi value=300 class=dialog-input style=width:80px name=dpi>\n              <option value=72>72</option>\n              <option value=150>150</option>\n              <option value=200>200</option>\n              <option value=300 selected>300</option>\n              <option value=360>360</option>\n              <option value=600>600</option>\n              <option value=720>720</option>\n              <option value=1200>1200</option>\n              <option value=2400>2400</option>\n              <option value=2880>2880</option>\n            </select>\n            <label for=dpi style=display:inline>DPI</label>\n          </fieldset>\n          <fieldset>\n            <section>\n              <label for=format>Image type</label>\n              <select id=format class=dialog-input name=format data-updates-preview>\n                <option value=png>PNG</option>\n                <option value=jpeg>JPEG</option>\n                <option value=webp>WEBP</option>\n                <option value=svg>SVG</option>\n              </select>\n            </section>\n            <section id=transparent_background_block>\n              <string-art-checkbox id=transparent_background label="Transparent background" name=transparent_background data-updates-preview>\n            </string-art-checkbox></section>\n          </fieldset>\n        </expandable-panel>\n      </div>\n    </form>\n    <div id=preview>\n      Preview\n      <article id=canvas></article>\n    </div>\n  </div>\n</confirm-dialog>\n';const ey="units",eC=new class extends i{#tY;getUserPreferredUnits(){return this.#tY||(this.#tY="inch"===localStorage.getItem(ey)?"inch":"cm"),this.#tY}setUserPreferredUnits(t){this.#tY!==t&&(this.#tY=t,localStorage.setItem(ey,t),this.emit("unitsChange",t))}};async function eS(t,{type:e,...i}){let n=function(t){let e={};return t.margin&&(e.margin=z(t.margin,t.units??"px","px",t.dpi)),t.isNailsMap&&Object.assign(e,{darkMode:!1,showNails:!0,showNailNumbers:t.includeNailNumbers,showStrings:!1,nailsColor:"#000000",backgroundColor:"#ffffff"}),null!=t.enableBackground&&Object.assign(e,{enableBackground:t.enableBackground}),0===Object.keys(e).length?null:e}(i);n&&(t=t.copy()).assignConfig(n),i.units&&(i={...i,size:E(i.size,i.units,"px",i.dpi)}),function({data:t,filename:e}){let i=URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}("svg"===e?function(t,{size:e,filename:i}){let n=document.createElement("article");n.style.width=e[0]+"px",n.style.height=e[1]+"px",document.body.appendChild(n);let s=new t8(n);return s.setFixedSize(e),t.draw(s),{data:new Blob([s.svg.outerHTML],{type:"image/svg+xml;charset=utf-8"}),filename:i??t.name+".svg"}}(t,i):await ew(t,i))}async function ew(t,{size:e,filename:i,imageType:n}){let s=new $(document.createElement("article"),{updateOnResize:!1});return s.disablePixelRatio(),s.setFixedSize(e),t.draw(s),{data:await s.toBlob(n),filename:`${i??t.name}.${n??"png"}`}}const ev=[10,10],ex=[{id:"fit",name:"Fit pattern",dimensions:({customDimensions:t,patternAspectRatio:e})=>{let i=t;if(!i){let t=Math.min(screen.width,screen.height),e=window.devicePixelRatio??1;i=R([t,t],t=>t*e)}return T([i[0],i[0]/e],i)},units:["px","cm","inch"],defaultUnits:"px",defaultMargin:20,allowSizeEdit:!0,aspectRatio:({patternAspectRatio:t})=>t},{id:"screen",name:"Screen size",dimensions:()=>{let t=window.devicePixelRatio??1;return[window.screen.width,window.screen.height].map(e=>Math.floor(e*t))},units:["px"],defaultMargin:10,allowRotate:!0},...[{id:"A4",dimensions:[21,29.7]},{id:"A3",dimensions:[29.7,42]},{id:"A2",dimensions:[42,59.4]},{id:"A1",dimensions:[59.4,84.1]}].map(t=>({...t,units:["cm","inch"],inUnits:"cm",defaultMargin:1,allowRotate:!0})),{id:"custom",name:"Custom size…",dimensions:({customDimensions:t,currentDimensions:e})=>e??t??ev,allowSizeEdit:!0,allowRotate:!0}];function ek(t){return ex.find(({id:e})=>e===t)}const eM=new CSSStyleSheet;eM.replaceSync(String(em));const eN=["png","svg","webp"];class eL extends HTMLElement{dialog;elements;units;customDimensions;dimensions;margin;patternAspectRatio=1;currentSize;currentPattern;unitFloatingPointsPrecision=0;constructor(){super();let t=this.attachShadow({mode:"open"});t.adoptedStyleSheets=[eM],this.shadowRoot.innerHTML=String(eb),this.dialog=t.querySelector("confirm-dialog"),this.elements={size:t.querySelector("#size"),form:t.querySelector("form"),unitSelect:t.querySelectorAll(".unit-select"),dpi:t.querySelector("#dpi"),dpiBlock:t.querySelector("#dpi_block"),renderNumbersBlock:t.querySelector("#render_numbers_block"),patternDimensions:t.querySelector("#pattern_size"),imageDimensions:t.querySelector("#image_dimensions"),margin:t.querySelector("#margin"),canvas:t.querySelector("#canvas"),transparentBackground:t.querySelector("#transparent_background"),rotateBtn:t.querySelector("#rotate_btn")},this.#tZ(),this.setSize(ex[0].id),eC.addEventListener("unitsChange",t=>{"px"!==this.units&&this.setUnits(t)}),t.addEventListener("focusin",t=>{t.target instanceof HTMLInputElement&&("text"===t.target.type||"number"===t.target.type)&&t.target.select()}),t.addEventListener("change",t=>{if(t.target instanceof HTMLSelectElement&&t.target.classList.contains("unit-select")&&this.setUnits(t.target.value),t.target===this.elements.size&&this.setSize(this.elements.size.value),t.target instanceof HTMLInputElement&&"radio"===t.target.type&&"type"===t.target.name){let t=this.elements.form.querySelector('input[name="type"]:checked')?.value;this.setType(t)}t.target instanceof HTMLElement&&null!=t.target.dataset.updatesPreview&&this.updatePreview(),t.target instanceof HTMLSelectElement&&"format"===t.target.id&&this.setImageType(t.target.value)}),this.elements.margin.addEventListener("input",t=>{let e=Number(t.target.value);this.setMargin(isNaN(e)?0:e)}),this.elements.imageDimensions.addEventListener("dimensionchange",({detail:{dimension:t,value:e,...i}})=>{let n=i[t];this.customDimensions&&(this.customDimensions=e,this.setDimensions(e),this.elements.patternDimensions.setMaxDimensions(e),this.elements.patternDimensions[t]=n-2*this.margin),this.updatePreview()}),this.elements.patternDimensions.addEventListener("dimensionchange",({detail:{dimension:t,value:e,...i}})=>{let n=i[t];this.dimensions&&this.setMargin(this.dimensions[+("width"!==t)]-n,{updatePatternDimensions:!1})}),this.elements.rotateBtn.addEventListener("click",()=>this.rotateImage())}setType(t,e=!0){this.shadowRoot.querySelector(`#type_${t}`).checked=!0,this.#tX("nails_map"===t);let i=this.shadowRoot.querySelector("#transparent_background_block");"nails_map"===t?f(i):g(i),e&&this.updatePreview()}setImageType(t){this.shadowRoot.querySelector("#format").value=t,m(this.elements.transparentBackground,!eN.includes(t))}getFormValues(){return Object.fromEntries(new FormData(this.elements.form).entries())}get isTransparentBackground(){let t=this.getFormValues();return"nails_map"!==t.type&&eN.includes(String(t.format))&&"on"===t.transparent_background}#tZ(){this.elements.size.innerHTML=ex.map(({id:t,name:e})=>`<option value="${t}">${e??t}</option>`).join("\n")}#tX(t){m(this.elements.renderNumbersBlock,!t)}get dpi(){return Number(this.elements.dpi.value??300)}rotateImage(){this.setDimensions(this.#tQ(this.dimensions))}setUnits(t,e=!0){if(t===this.units)return;let i=this.units;this.units=t,this.elements.unitSelect.forEach(e=>{e.value=t}),this.unitFloatingPointsPrecision=+("px"!==t),"cm"===t||"inch"===t?(eC.setUserPreferredUnits(t),g(this.elements.dpiBlock)):f(this.elements.dpiBlock),this.elements.patternDimensions.setFloatingPoints(this.unitFloatingPointsPrecision),this.elements.imageDimensions.setFloatingPoints(this.unitFloatingPointsPrecision),i&&(this.dimensions&&(this.dimensions=E(this.dimensions,i,t,this.dpi)),this.margin&&this.setMargin(z(this.margin,i,t,this.dpi))),this.dimensions&&this.setDimensions(this.dimensions,e)}getMarginMax(){return this.dimensions?Math.min(this.dimensions[0]/2.1,this.dimensions[1]/2.1):null}setMargin(t,{updatePatternDimensions:e=!0,updatePreview:i=!0}={}){t=Math.max(t,0),this.dimensions&&(t=Math.min(t,this.getMarginMax())),t!==this.margin&&(this.margin=t??0,this.elements.margin.value=String(t.toFixedPrecision(this.unitFloatingPointsPrecision)??0),e&&this.dimensions&&this.updatePatternDimensions(),i&&this.updatePreview())}setSize(t,e=!0){let i=ek(t);this.currentSize=i;let{units:n,dimensions:s,aspectRatio:r,allowSizeEdit:a,defaultUnits:o,inUnits:l,defaultMargin:c=0,allowRotate:u}=i;this.elements.imageDimensions.aspectRatio=r instanceof Function?r({patternAspectRatio:this.patternAspectRatio}):r;let d=s instanceof Function?s({customDimensions:this.customDimensions,currentDimensions:this.dimensions,patternAspectRatio:this.patternAspectRatio}):s;a?(this.elements.imageDimensions.isReadonly=!1,this.customDimensions=d):this.elements.imageDimensions.isReadonly=!0,m(this.elements.rotateBtn,!u);let h=n&&1===n.length&&"px"===n[0];this.togglePixels(!n||n.includes("px")),this.setPixelsOnly(h);let p=o??(h?"px":n&&!n.includes(this.units)?eC.getUserPreferredUnits():this.units);this.setUnits(p),l&&l!==p&&(d=R(E(d,l,p,this.dpi),t=>t.toFixedPrecision(1))),c&&this.setMargin(c),this.setDimensions(d,e),e&&this.updatePreview(),this.elements.size.value=t}togglePixels(t){this.elements.unitSelect.forEach(e=>{m(e.querySelector('[value="px"]'),!t)})}#tK(t){let{dimensions:e}=ek(t);return e instanceof Function?e({customDimensions:this.customDimensions,currentDimensions:this.dimensions,patternAspectRatio:this.patternAspectRatio}):e}setPixelsOnly(t){t&&this.togglePixels(!0),this.elements.unitSelect.forEach(e=>{t?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled"),e.querySelectorAll(':not([value="px"])').forEach(e=>m(e,t))})}setDimensions(t,e=!0){this.dimensions=t,this.elements.imageDimensions.width=t[0],this.elements.imageDimensions.height=t[1],this.elements.canvas.style.removeProperty("width"),this.elements.canvas.style.removeProperty("height"),this.elements.margin.setAttribute("max",String(this.getMarginMax())),this.updatePatternDimensions(),e&&this.updatePreview()}updatePatternDimensions(){let t=this.#t0();this.elements.patternDimensions.maxWidth=this.dimensions[0],this.elements.patternDimensions.maxHeight=this.dimensions[1],this.elements.patternDimensions.width=t[0],this.elements.patternDimensions.height=t[1]}#t0(){let t=this.dimensions[0]-2*this.margin,e=R(this.dimensions,t=>t-2*this.margin);return!this.patternAspectRatio||isNaN(this.patternAspectRatio)?e:T([t,t/this.patternAspectRatio],R(this.dimensions,t=>t-2*this.margin))}#tQ(t){return[t[1],t[0]]}async show(t){return this.currentPattern=t,this.patternAspectRatio=t.getAspectRatio({size:this.dimensions}),this.elements.patternDimensions.setAttribute("aspect-ratio",String(this.patternAspectRatio)),this.setSize(this.currentSize.id),this.dialog.show(()=>{let e=t5.getPatternDownloadData(t.id);this.setDownloadOptionsToForm(e)}).then(async()=>{let e=this.getFormValues(),i=this.#t1(e,t);t5.savePatternDownloadData(t.id,i),await eS(t,i)})}#t1(t,e){let i="nails_map"===t.type,n=this.#tK(t.size);return t.rotate_image&&(n=this.#tQ(n)),{size:n,type:"svg"===t.format?"svg":"canvas",imageType:"svg"===t.format?null:t.format,isNailsMap:i,units:t.unit??"px",dpi:Number(t.dpi),margin:Number(t.margin),includeNailNumbers:i&&"on"===t.render_numbers,filename:i?`${e.name} - nail map`:e.name,enableBackground:!this.isTransparentBackground,sizeId:String(t.size),isRotated:!!t.rotate_image}}setDownloadOptionsToForm(t){if(!t){let e=ex[0];t={size:e.dimensions instanceof Function?e.dimensions({patternAspectRatio:this.patternAspectRatio}):e.dimensions,sizeId:e.id,margin:e.defaultMargin,units:e.defaultUnits,enableBackground:!0}}this.setType(t.isNailsMap?"nails_map":"all",!1),this.#tX(t.isNailsMap),this.shadowRoot.querySelector("#render_numbers").value=!0===t.includeNailNumbers;let e=t.sizeId??"custom";this.setSize(e,!1);let i=!0===t.isRotated;this.shadowRoot.querySelector("#rotate_image").checked=i,i&&this.rotateImage(),null!=t.units&&this.setUnits(t.units,!1),this.setMargin(t.margin??0,{updatePreview:!1}),this.elements.dpi.value=String(t.dpi??300),this.setImageType(t.imageType??"png"),this.shadowRoot.querySelector("#transparent_background").value=!t.enableBackground,this.updatePreview()}updatePreview(){if(!this.currentPattern||!this.elements.canvas.clientWidth)return;if(this.elements.canvas.innerHTML="",this.elements.canvas.clientWidth){let t=T(E(this.dimensions,this.units,"px",this.dpi),[this.elements.canvas.clientWidth||200,this.elements.canvas.clientHeight||300]);this.elements.canvas.style.width=t[0]+"px",this.elements.canvas.style.height=t[1]+"px"}let t=new $(this.elements.canvas,{updateOnResize:!1}),e=[this.elements.canvas.clientWidth||200,this.elements.canvas.clientHeight||300];t.setFixedSize(e);let i=this.currentPattern.copy(),n=this.getFormValues();i.assignConfig("nails_map"===n.type?{darkMode:!1,showNails:!0,showNailNumbers:"on"===n.render_numbers,showStrings:!1,nailsColor:"#000000",backgroundColor:"#ffffff",enableBackground:!0}:{enableBackground:!this.isTransparentBackground}),i.assignConfig({margin:Math.floor(this.margin/this.dimensions[0]*e[0])}),i.draw(t)}}customElements.define("download-dialog",eL);const eP=new class extends i{#t2;#t5="canvas";constructor(){super();let t=this.#t2=({state:t})=>{this.#t3(t??{})};window.addEventListener("popstate",t)}#t3(t){let{pattern:e,name:i,config:n,renderer:s="canvas"}=t,r="svg"===s?"svg":"canvas";if(r!==this.#t5&&(this.#t5=r,this.emit("renderer",r)),e){let t=t1(e);if(t)i&&(t.name=i),n&&t.setConfig(function(t,e){let i=e.replace(/(?:~)(\d+)(?:_)/g,(t,e)=>Array(+e).fill("_").join("")).split("_").map(t=>{if(""===t)return null;if(G.test(t))return parseFloat(t);let e=t.match(U);return e?"1"===e[1]:t}),n=Object.keys(t.defaultConfig);return i.reduce((t,e,i)=>{if(null!==e){let s=n[i];return{...t,[s]:e}}return t},{})}(t,n)),this.emit("pattern",{pattern:t,renderer:r});else throw Error(`Unknown pattern with ID "${e}".`)}else this.emit("main",null)}init(){if(history.state?.patternId)this.#t3(history.state);else{let t=W();this.#t3(t)}}destroy(){window.removeEventListener("popstate",this.#t2)}navigateToMain(){history.pushState({patternId:null},"String Art Studio","./"),this.emit("main",null)}navigateToPattern(t,{renderer:e="canvas",replaceState:i=!1}={}){let n=t.isDefaultConfig?void 0:H(t);(i?history.replaceState:history.pushState).bind(history)({pattern:t.id,config:n,renderer:e,name:t.name},t.name,j(t,{renderer:e,patternAsTemplate:!1})),i||this.emit("pattern",{pattern:t,renderer:e})}};class eR extends i{element;renderer;pattern;rendererType;cancelDraw;constructor(t="canvas"){super(),this.rendererType=t,this.element=document.querySelector("#canvas_panel"),this.element.addEventListener("wheel",({deltaY:t})=>{let e=-t/Math.abs(t);this.emit("positionChange",{changeBy:e})}),n.addEventListener("showInstructionsChange",({showInstructions:t})=>{this.#t4(),t?this.renderer.showInstructions():this.renderer.hideInstructions()}),eP.addEventListener("renderer",t=>{this.rendererType=t,this.renderer=null})}get position(){return this.pattern?.position??-1}get size(){return[this.element.clientWidth,this.element.clientHeight]}setSize(t){this.#t4(),t?(this.element.classList.contains("overflow")||this.element.classList.add("overflow"),this.renderer.setFixedSize(t)):(this.element.classList.remove("overflow"),this.renderer.resetSize())}setRenderer(t){this.renderer=t,t.addEventListener("sizeChange",({size:t})=>this.#t6(t))}setPattern(t){this.pattern=t,!t&&this.renderer&&this.renderer.clear()}#t6(t){t[0]&&t[1]&&this.pattern?.draw(this.renderer,{sizeChanged:!0})}#t8(){let t;this.element.addEventListener("pointerdown",()=>{this.emit("click",null);let e=()=>{clearTimeout(t),this.element.removeEventListener("pointerup",e)};t=setTimeout(()=>{this.element.removeEventListener("pointerup",e),this.emit("touchStart",null);let t=()=>{this.emit("touchEnd",null),this.element.removeEventListener("pointerup",t)};this.element.addEventListener("pointerup",t)},200),this.element.addEventListener("pointerup",e)})}update(t){n.showInstructions=!1,this.#t4(),this.pattern?.draw(this.renderer,t)}goto(t){this.#t4(),this.pattern.goto(this.renderer,t,{showInstructions:n.showInstructions})}next(){return{done:this.pattern.drawNext().done}}getStepCount(){return this.#t4(),this.pattern.getStepCount({size:this.renderer.getSize()})}#t4(){if(!this.renderer){let t="svg"===this.rendererType?t8:$;this.setRenderer(new t(this.element))}}}const ez=[30,30],eE=[20,30,40,50,60,70,80,90,100],eA=new class{elements;targetSizeCm=ez;pattern;lastSize;patternMargin;patternNailRadius;constructor(){this.elements={infoPanel:document.querySelector("#info_panel"),nailsCount:document.querySelector("#nails_count"),threadsTotalLength:document.querySelector("#threads_total_length"),threadsPerColor:document.querySelector("#threads_per_color"),closestDistanceBetweenNails:document.querySelector("#closest_distance_between_nails"),dimensions:document.querySelector("#info_dimensions"),dimensionsSelect:document.querySelector("#info_dimensions_select")},this.elements.dimensions.addEventListener("dimensionchange",({detail:{value:t}})=>{this.targetSizeCm=t,this.pattern&&this.update()}),this.elements.dimensionsSelect.addEventListener("change",t=>{let e=Number(this.elements.dimensionsSelect.value);this.targetSizeCm=[e,e],this.update()})}#t7(){let t=this.pattern.getAspectRatio({size:[100,100]}),e=eE.map(e=>t>=1?[e,Math.round(e/t)]:[Math.round(e*t),e]);this.elements.dimensionsSelect.innerHTML=e.map((t,e)=>`<option value="${eE[e]}">${t.join("x")} cm`).join("\n"),this.elements.dimensionsSelect.value=this.targetSizeCm[0].toString()}setPattern(t,e){this.pattern=t.copy(),this.lastSize=e,this.patternMargin=t.config.margin,this.patternNailRadius=t.config.nailRadius,this.update(),this.#t7()}async update(){if(!this.pattern)throw Error("Can't update info - no pattern.");e?.abort();let t=T(this.lastSize,this.targetSizeCm),i=Math.min(t[0]/this.lastSize[0],t[1]/this.lastSize[1]);this.pattern.assignConfig({margin:this.patternMargin*i,nailRadius:this.patternNailRadius*i}),this.elements.dimensions.value=this.targetSizeCm,e=new TaskController({priority:"background"});let{nailsCount:n,threadsLength:s,closestDistanceBetweenNails:r}=await scheduler.postTask(()=>this.getInfo(this.targetSizeCm),{signal:e.signal});this.elements.nailsCount.textContent=n.toLocaleString(),this.elements.threadsTotalLength.textContent=String(this.#t9(s.total)),this.elements.closestDistanceBetweenNails.textContent=String(this.#t9(r)),this.elements.threadsPerColor.innerHTML="";let a=Math.max(...s.perColor.map(({length:t})=>t));[...s.perColor].sort((t,e)=>e.length-t.length).forEach(({color:t,length:e})=>{let i=document.createElement("li"),n=document.createElement("div");i.appendChild(n),n.style.background=t,n.className="info__thread_color_value",n.style.width=`max(calc(${100*e/a}% - 70px), 6px)`;let s=document.createElement("span");s.innerText=this.#t9(e),s.className="info__thread_color_value_text",i.appendChild(s),this.elements.threadsPerColor.appendChild(i)})}#t9(t,e=1){return function(t,e,i=1){let n=t*I;return n>=1?N(n,i).toLocaleString()+" m":n<.01?N(1e3*n,i).toLocaleString()+" mm":N(100*n,i).toLocaleString()+" cm"}(t*e,0)}getInfo(t){let e=new ts(t);return this.pattern.draw(e,{sizeChanged:!0,redrawStrings:!0,redrawNails:!0}),e.getInfo()}};async function eV(){let t,e,i={main:document.querySelector("main"),downloadBtn:document.querySelector("#download_btn"),resetBtn:document.querySelector("#controls_reset_btn"),shareBtn:document.querySelector("#share_btn"),playerBtn:document.querySelector("#player_btn"),infoBtn:document.querySelector("#info_btn"),buttons:document.querySelector("#buttons"),instructionsLink:document.querySelector("#pattern_select_dropdown_instructions")},n=new t5,r=new t4(n),a=!1,o=new eR,l=new s(document.querySelector("#player"),o);function c({control:t}){!1!==t.affectsStepCount&&l.update(o.getStepCount()),eP.navigateToPattern(e,{renderer:o.renderer instanceof t8?"svg":void 0,replaceState:!0}),u(),a&&eA.setPattern(e,o.size)}function u(){i.main.dataset.isDefaultConfig=String(e.isDefaultConfig)}await ei(),document.body.querySelectorAll(".pattern_only").forEach(f),await t9()&&g(i.shareBtn),i.downloadBtn.addEventListener("click",()=>{document.querySelector("#download_dialog").show(o.pattern)}),i.resetBtn.addEventListener("click",function(){q({title:"Reset options",description:e.isTemplate?"Are you sure you wish to reset options to defaults?":"Are you sure you wish to reset to the latest saved options?",submit:"Reset"}).then(()=>{let t=t1(e.id);eP.navigateToPattern(t)},()=>{})}),i.shareBtn.addEventListener("click",async()=>await t7({renderer:o.renderer,pattern:o.pattern})),i.instructionsLink.addEventListener("click",t=>{t.preventDefault(),eP.navigateToMain()}),r.addEventListener("select",({patternId:t})=>{let e=t1(t);eP.navigateToPattern(e)}),document.body.addEventListener("click",t=>{let i=t.target instanceof HTMLElement&&t.target.closest("[data-toggle-for]");if(i instanceof HTMLElement&&i){var n;let t=i.dataset.toggleFor;n=[t],document.querySelectorAll("#buttons [data-toggle-for].active").forEach(t=>{t instanceof HTMLElement&&!n?.includes(t.getAttribute("data-toggle-for"))&&t.click()}),i.classList.toggle("active");let s=document.querySelector("#"+t);s&&(s.classList.toggle("open"),document.body.classList.toggle("dialog_"+t),e&&o.update()),"info"===t&&(a=i.classList.contains("active"))&&eA.setPattern(e,o.size)}}),n.addEventListener("deletePattern",({pattern:t})=>{let e=t1(t.type);e&&(e.config=t.config,eP.navigateToPattern(e))}),n.addEventListener("save",({pattern:t})=>{eP.navigateToPattern(t)}),g(document.querySelector("main")),eP.addEventListener("pattern",({pattern:s,renderer:d})=>{var h;e=h=s,o.setPattern(h),t?.destroy(),n.setPattern(e),(t=new C(h.configControls,h.config)).addEventListener("input",({control:i,value:n})=>{e&&(e.setConfigValue(i.key,n),t.config=e.config,o.update({redrawNails:!1!==i.affectsNails,redrawStrings:!1!==i.affectsStrings,enableScheduler:!0}))}),t.addEventListener("change",c),r.setCurrentPattern(h),document.title=`${h.name} - String Art Studio`,document.body.setAttribute("data-pattern",h.id),document.body.querySelectorAll(".pattern_only").forEach(g),o.update(),l.update(o.getStepCount(),{draw:!1}),a&&eA.setPattern(h,o.size),i.main.dataset.isTemplate=String(e.isTemplate),u(),o.setPattern(s),r.close()}),eP.addEventListener("main",()=>{r.open(),e=null,o.setPattern(null),r.setCurrentPattern(null),t&&t.destroy(),document.body.querySelectorAll(".pattern_only").forEach(f),document.body.removeAttribute("data-pattern")}),eP.init()}window.addEventListener("error",function(t){alert("Error:\n"+t.message+"\n\nStack:\n"+t.error.stack)}),window.addEventListener("load",eV);
//# sourceMappingURL=string_art.a84de309.js.map
