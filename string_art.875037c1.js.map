{"mappings":"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","sources":["<anon>","src/scripts/main.ts","src/scripts/editor/Player.ts","src/scripts/viewer/ViewOptions.ts","src/scripts/helpers/EventBus.ts","src/scripts/editor/EditorControls.ts","src/scripts/components/expandable_panel/ExpandablePanel.ts","node_modules/@parcel/runtime-js/lib/bundles/runtime-f5584766e59f4c9f.js","src/scripts/components/inputs/StringArtCheckbox.ts","node_modules/@parcel/runtime-js/lib/bundles/runtime-84dd34b3f4a02b9e.js","src/scripts/components/inputs/StringArtHueInput.ts","src/scripts/components/inputs/StringArtRangeInput.ts","src/scripts/helpers/dom_utils.ts","src/scripts/thumbnails/Thumbnails.ts","src/scripts/infra/renderers/CanvasRenderer.ts","src/scripts/infra/renderers/Renderer.ts","src/scripts/helpers/math_utils.ts","src/scripts/helpers/size_utils.ts","src/scripts/Persistance.ts","src/scripts/helpers/dialogs.ts","src/scripts/helpers/url_utils.ts","src/scripts/Serialize.ts","src/scripts/helpers/pattern_utils.ts","src/scripts/pattern_types.ts","src/scripts/string_art_types/Spiral.ts","src/scripts/helpers/color/Color.ts","src/scripts/helpers/config_utils.ts","src/scripts/helpers/color/color_controls.ts","src/scripts/infra/StringArt.ts","src/scripts/helpers/object_utils.ts","src/scripts/infra/nails/Nails.ts","src/scripts/infra/nails/NailsGroup.ts","src/scripts/infra/renderers/MeasureRenderer.ts","src/scripts/infra/renderers/TestRenderer.ts","src/scripts/shapes/Circle.ts","src/scripts/helpers/easing.ts","src/scripts/shapes/Polygon.ts","src/scripts/helpers/string_utils.ts","src/scripts/helpers/array_utils.ts","src/scripts/string_art_types/Spirals.ts","src/scripts/string_art_types/Wave.ts","src/scripts/string_art_types/Mandala.ts","src/scripts/string_art_types/Eye.ts","src/scripts/string_art_types/Star.ts","src/scripts/shapes/StarShape.ts","src/scripts/string_art_types/Assymetry.ts","src/scripts/string_art_types/Freestyle.ts","src/scripts/string_art_types/PolygonPattern.ts","src/scripts/string_art_types/Flower.ts","src/scripts/string_art_types/MaurerRose.ts","src/scripts/string_art_types/FlowerOfLife.ts","src/scripts/string_art_types/Comet.ts","src/scripts/string_art_types/Sun.ts","src/scripts/string_art_types/Lotus.ts","src/scripts/string_art_types/DanceOfPlanets.ts","src/scripts/string_art_types/Crosses.ts","src/scripts/shapes/Line.ts","src/scripts/helpers/shape_utils.ts","src/scripts/share.ts","src/scripts/infra/renderers/SVGRenderer.ts","src/scripts/pwa.ts","src/scripts/components/components.ts","src/scripts/components/inputs/DimensionsInput.ts","node_modules/@parcel/runtime-js/lib/bundles/runtime-94fceca3c63c79d1.js","src/scripts/components/DropdownMenu.ts","src/scripts/components/DropdownMenuItem.ts","src/scripts/components/dialogs/InputDialog.ts","node_modules/@parcel/runtime-js/lib/bundles/runtime-f124c8be16fdc81b.js","src/scripts/components/dialogs/ConfirmDialog.ts","node_modules/@parcel/runtime-js/lib/bundles/runtime-c376ef0475a71006.js","node_modules/@parcel/runtime-js/lib/bundles/runtime-0f8d9e7229779c52.js","src/scripts/components/dialogs/download_dialog/DownloadDialog.ts","node_modules/@parcel/runtime-js/lib/bundles/runtime-b91af69516b51bea.js","node_modules/@parcel/runtime-js/lib/bundles/runtime-8ec9ff1c983efa67.js","src/scripts/helpers/preferences.ts","src/scripts/download/Download.ts","src/scripts/components/dialogs/download_dialog/download_image_sizes.ts","src/scripts/viewer/Viewer.ts","src/scripts/routing.ts","src/scripts/Info.ts","node_modules/scheduler-polyfill/dist/scheduler-polyfill.js","node_modules/scheduler-polyfill/src/scheduler-priorities.js","node_modules/scheduler-polyfill/src/host-callback.js","node_modules/scheduler-polyfill/src/intrusive-task-queue.js","node_modules/scheduler-polyfill/src/task-controller.js","node_modules/scheduler-polyfill/src/polyfill.js","node_modules/scheduler-polyfill/src/scheduler.js","node_modules/scheduler-polyfill/src/yield.js"],"sourcesContent":["class $00df09d341073864$export$2e2bcd8739ae039 {\n    #eventHandlers = {};\n    /**\n   * Adds an event handler for the specified event\n   * @param event\n   * @param handler\n   * @returns A function that can be called to remove the event handler\n   */ addEventListener(event, handler) {\n        const handlers = this.#eventHandlers[event] ??= [];\n        if (!handlers.includes(handler)) handlers.push(handler);\n        return ()=>{\n            const handlerIndex = handlers.indexOf(handler);\n            if (handlerIndex !== -1) handlers.splice(handlerIndex, 1);\n        };\n    }\n    removeEventListener(event, handler) {\n        const handlers = this.#eventHandlers[event];\n        if (!handlers) return;\n        const index = handlers.indexOf(handler);\n        if (index !== -1) handlers.splice(index, 1);\n    }\n    emit(event, payload) {\n        this.#eventHandlers[event]?.forEach((handler)=>handler(payload));\n    }\n}\n\n\nclass $5082caf0e2beae35$var$ViewOptions extends (0, $00df09d341073864$export$2e2bcd8739ae039) {\n    #showInstructions = false;\n    #instructionsMode = 'auto';\n    get instructionsMode() {\n        return this.#instructionsMode;\n    }\n    set instructionsMode(mode) {\n        if (mode !== this.#instructionsMode) {\n            this.#instructionsMode = mode;\n            this.emit('instructionsModeChange', mode);\n        }\n    }\n    get showInstructions() {\n        return this.#showInstructions;\n    }\n    set showInstructions(showInstructions) {\n        if (showInstructions !== this.#showInstructions) {\n            this.#showInstructions = showInstructions;\n            this.emit('showInstructionsChange', {\n                showInstructions: showInstructions\n            });\n        }\n    }\n}\nconst $5082caf0e2beae35$var$viewOptions = new $5082caf0e2beae35$var$ViewOptions();\nvar $5082caf0e2beae35$export$2e2bcd8739ae039 = $5082caf0e2beae35$var$viewOptions;\n\n\nconst $f003126099aabc1e$var$SLOW_PLAY_SPEED = 200;\nclass $f003126099aabc1e$export$2e2bcd8739ae039 {\n    viewer;\n    elements;\n    stepCount;\n    #isPlaying;\n    #cancelNextPlayStep;\n    #cancelHideInstruction;\n    constructor(parentEl, viewer){\n        this.viewer = viewer;\n        this.elements = {\n            player: parentEl,\n            step: parentEl.querySelector('#step'),\n            //stepInstructions: parentEl.querySelector('#step_instructions'),\n            playerPosition: parentEl.querySelector('#player_position'),\n            playBtn: parentEl.querySelector('#play_btn'),\n            pauseBtn: parentEl.querySelector('#pause_btn'),\n            text: parentEl.querySelector('#player_text')\n        };\n        this.stepCount = 0;\n        this.#isPlaying = false;\n        this.elements.playerPosition.addEventListener('input', ({ target: target })=>{\n            if ('value' in target) this.goto(+target.value);\n        });\n        this.elements.playBtn.addEventListener('click', ()=>{\n            this.play({\n                restartIfAtEnd: true\n            });\n        });\n        this.elements.pauseBtn.addEventListener('click', ()=>{\n            this.pause();\n        });\n        viewer.addEventListener('positionChange', ({ changeBy: changeBy })=>this.advance(changeBy));\n        viewer.addEventListener('click', ()=>this.#isPlaying ? this.pause() : this.advance());\n        viewer.addEventListener('touchStart', ()=>this.play({\n                speed: $f003126099aabc1e$var$SLOW_PLAY_SPEED\n            }));\n        viewer.addEventListener('touchEnd', ()=>this.pause());\n        (0, $5082caf0e2beae35$export$2e2bcd8739ae039).addEventListener('showInstructionsChange', ({ showInstructions: showInstructions })=>{\n            if (showInstructions) this.#cancelHideInstruction?.();\n        });\n    }\n    updateStatus(isPlaying) {\n        if (this.#isPlaying !== isPlaying) {\n            this.elements.player.classList.toggle('playing');\n            this.#isPlaying = isPlaying;\n        }\n    }\n    update(stepCount, { draw: draw = true } = {}) {\n        this.stepCount = stepCount;\n        this.elements.playerPosition.setAttribute('max', String(this.stepCount));\n        this.elements.step.innerText = `${this.stepCount}/${this.stepCount}`;\n        this.elements.text.style.removeProperty('width');\n        this.elements.text.style.width = (this.elements.text.clientWidth || 70) + 'px';\n        (0, $5082caf0e2beae35$export$2e2bcd8739ae039).showInstructions = false;\n        this.goto(this.stepCount, {\n            updateStringArt: draw,\n            showInstructions: false\n        });\n    }\n    updatePosition(position) {\n        this.elements.step.innerText = `${position}/${this.stepCount}`;\n        this.elements.playerPosition.value = String(position);\n    }\n    goto(position, { updateStringArt: updateStringArt = true, showInstructions: showInstructions = true } = {}) {\n        if (position > this.stepCount || position < 1) return;\n        this.#cancelHideInstruction?.();\n        this.pause();\n        this.updatePosition(position);\n        if (showInstructions) (0, $5082caf0e2beae35$export$2e2bcd8739ae039).showInstructions = true;\n        if (updateStringArt) this.viewer.goto(position);\n        if ((0, $5082caf0e2beae35$export$2e2bcd8739ae039).instructionsMode === 'auto' && position === this.stepCount && (0, $5082caf0e2beae35$export$2e2bcd8739ae039).showInstructions) {\n            const hideIntructionsTimeout = setTimeout(()=>{\n                (0, $5082caf0e2beae35$export$2e2bcd8739ae039).showInstructions = false;\n            }, 1000);\n            this.#cancelHideInstruction = ()=>clearTimeout(hideIntructionsTimeout);\n        }\n    }\n    advance(value = 1) {\n        this.goto(Math.max(1, Math.min(this.stepCount, Number(this.elements.playerPosition.value) + value)));\n    }\n    setInstructions(instructions) {\n    // this.elements.stepInstructions.innerText = instructions;\n    }\n    play({ restartIfAtEnd: restartIfAtEnd = false, speed: speed } = {}) {\n        const isAtEnd = this.viewer.position === this.stepCount;\n        if (isAtEnd && !restartIfAtEnd) return;\n        this.updateStatus(true);\n        this.#cancelNextPlayStep?.();\n        (0, $5082caf0e2beae35$export$2e2bcd8739ae039).showInstructions = false;\n        // if (\n        //   viewOptions.instructionsMode === 'auto' ||\n        //   viewOptions.instructionsMode === 'show'\n        // ) {\n        //   viewOptions.showInstructions = true;\n        // }\n        if (isAtEnd) this.viewer.goto(0);\n        const step = ()=>{\n            if (!this.viewer.next().done) {\n                if (speed) {\n                    const stepTimeout = setTimeout(step, speed);\n                    this.#cancelNextPlayStep = ()=>clearTimeout(stepTimeout);\n                } else {\n                    const stepRafId = requestAnimationFrame(step);\n                    this.#cancelNextPlayStep = ()=>cancelAnimationFrame(stepRafId);\n                }\n            } else this.updateStatus(false);\n            this.updatePosition(this.viewer.position);\n        };\n        step();\n    }\n    pause() {\n        this.#cancelNextPlayStep?.();\n        this.updateStatus(false);\n    }\n    toggle() {\n        if (this.#isPlaying) this.pause();\n        else this.play();\n    }\n}\n\n\nvar $2d2165ae7b4acbcd$exports = {};\n$2d2165ae7b4acbcd$exports = \"fieldset{border:var(--border-light);background:#ffffff08;border-radius:9px;padding-inline:.5em}fieldset>legend{cursor:pointer;opacity:.8}fieldset>legend:hover{opacity:1}div{padding-top:8px}fieldset.minimized{background:0 0;border:none;padding:0}fieldset.minimized>legend{padding:0;transform:translate(-6px)}fieldset.minimized>div{display:none}legend:before{content:\\\"\\\";opacity:.7;vertical-align:top;margin-inline-end:2px;font-family:string_art_studio;font-size:20px;display:inline-block}fieldset.minimized>legend:before{transform:rotate(-90deg)}\";\n\n\nconst $4a7965eeea97d4bb$var$sheet = new CSSStyleSheet();\n$4a7965eeea97d4bb$var$sheet.replaceSync(String($2d2165ae7b4acbcd$exports));\nclass $4a7965eeea97d4bb$export$dbf21a0adc6a9ee0 extends HTMLElement {\n    #legend;\n    #fieldset;\n    constructor(){\n        super();\n        const shadow = this.attachShadow({\n            mode: 'open'\n        });\n        shadow.adoptedStyleSheets = [\n            $4a7965eeea97d4bb$var$sheet\n        ];\n        this.shadowRoot.innerHTML = `\n      <fieldset>\n        <legend></legend>\n        <div>\n            <slot></slot>\n        </div>\n      </fieldset>\n      `;\n        this.#legend = shadow.querySelector('legend');\n        this.#fieldset = shadow.querySelector('fieldset');\n        this.#legend.addEventListener('click', ()=>this.toggle());\n    }\n    static get observedAttributes() {\n        return [\n            'legend',\n            'minimized'\n        ];\n    }\n    connectedCallback() {\n        this.syncAttributes();\n    }\n    attributeChangedCallback() {\n        this.syncAttributes();\n    }\n    syncAttributes() {\n        if (this.hasAttribute('legend')) this.#legend.textContent = this.getAttribute('legend');\n        else {\n            this.#fieldset.classList.remove('minimized');\n            this.#legend.textContent = '';\n        }\n        if (this.hasAttribute('minimized')) this.#fieldset.classList.add('minimized');\n        else this.#fieldset.classList.remove('minimized');\n    }\n    toggle() {\n        this.#fieldset.classList.toggle('minimized');\n    }\n    open() {\n        this.#fieldset.classList.remove('minimized');\n    }\n    close() {\n        this.#fieldset.classList.add('minimized');\n    }\n}\ncustomElements.define('expandable-panel', $4a7965eeea97d4bb$export$dbf21a0adc6a9ee0);\n\n\nvar $c743accf33ce06b6$exports = {};\n$c743accf33ce06b6$exports = \":root{--color-accent:#ff218f;--color-accent-hover:#b11b66;--color-buttons-dialog:#212124;--color-canvas-background:#0e0e0e;--color-config:#212124;--color-gray3:#262629;--color-header:#2b2b31;--color-lighter:#ffffff87;--color-link:#68c0ff;--color-link-hover:#85ccff;--color-player:#222226;--color-text:White;--color-text-hover:#85ccff;--color-input:#c51880;--color-input-hover:#961663;--color-input-active:#e20c8c;--color-dialog-background:#212124;--color-error:#c00;--horizontal-padding:16px;--vertical-padding:12px;--logo1:#9892ff;--logo1-active:#c5c2ff;--logo2:#d4c1ff;--border-light:solid 1px #3a3a3a;--border-lighter:dotted 1px #505050;--border-dialog:solid 1px #fff3;--circular_button_width:38px;--controls-height:50px;--header-height:45px;--select-height:49px;--sidebar-form-padding-top:16px;--sidebar-width:270px;--player-mobile-height:40px;--responsive-width:600px}span{white-space:nowrap}input{appearance:none;cursor:pointer;vertical-align:middle;border:2px solid #666;border-radius:2px;width:18px;height:18px;margin:0 2px;position:relative}input:checked{background-color:var(--color-input-active);border-color:var(--color-input)}input:checked:after{content:\\\"\\\";border:2px solid #fff;border-width:0 2px 2px 0;width:4px;height:11px;position:absolute;top:-1px;left:4px;transform:rotate(36deg)}label{margin-top:0;margin-inline-start:2px;font-size:14px;display:inline-block;position:relative;top:1px}\";\n\n\nconst $3ce3bee09e11519c$var$sheet = new CSSStyleSheet();\n$3ce3bee09e11519c$var$sheet.replaceSync(String($c743accf33ce06b6$exports));\nclass $3ce3bee09e11519c$export$2e2bcd8739ae039 extends HTMLElement {\n    static formAssociated = true;\n    internals;\n    #checked;\n    disabled = false;\n    #label;\n    #input;\n    constructor(){\n        super();\n        const shadow = this.attachShadow({\n            mode: 'open',\n            delegatesFocus: true\n        });\n        shadow.adoptedStyleSheets = [\n            $3ce3bee09e11519c$var$sheet\n        ];\n        this.shadowRoot.innerHTML = `\n          <span>\n            <input id=\"checkbox\" type=\"checkbox\">\n            <label for=\"checkbox\"></label>\n          </span>\n        `;\n        this.#input = shadow.querySelector('input');\n        this.#label = shadow.querySelector('label');\n        this.internals = this.attachInternals();\n    }\n    static get observedAttributes() {\n        return [\n            'checked',\n            'label',\n            'disabled',\n            'name'\n        ];\n    }\n    attributeChangedCallback() {\n        this.syncAttributes();\n    }\n    get checked() {\n        return this.#checked;\n    }\n    set checked(v) {\n        if (this.#checked = v) this.#input.checked = true;\n        else this.#input.checked = false;\n        this.internals.setFormValue(this.#checked ? 'on' : null);\n    }\n    get value() {\n        return this.checked;\n    }\n    set value(v) {\n        this.checked = v;\n    }\n    connectedCallback() {\n        this.syncAttributes();\n        this.#input.addEventListener('input', ()=>{\n            this.#checked = this.#input.checked;\n            this.internals.setFormValue(this.#checked ? 'on' : null);\n            this.dispatchEvent(new CustomEvent('input', {\n                detail: {\n                    checked: this.#checked\n                }\n            }));\n            this.dispatchEvent(new CustomEvent('change', {\n                detail: {\n                    checked: this.#checked\n                },\n                bubbles: true\n            }));\n        });\n        this.internals.setFormValue(this.#checked ? 'on' : null);\n        this.tabIndex = 0;\n    }\n    syncAttributes() {\n        if (this.hasAttribute('label')) this.#label.textContent = this.hasAttribute('label') ? this.getAttribute('label') : '';\n        if (this.hasAttribute('checked')) this.checked = true;\n        if (this.hasAttribute('disabled')) this.disabled = true;\n        if (this.hasAttribute('name')) this.internals.setFormValue(this.#checked ? 'on' : null);\n    }\n    focus() {\n        this.#input.focus();\n    }\n    blur() {\n        this.#input.blur();\n    }\n}\ncustomElements.define('string-art-checkbox', $3ce3bee09e11519c$export$2e2bcd8739ae039);\n\n\nconst $c6b5ffbe96e4aeb4$var$DEFAULT_THUMB_COLOR = 'white';\nconst $c6b5ffbe96e4aeb4$var$FULL_GAMUT_GRADIENT = 'linear-gradient(to right in hsl longer hue, hsl(1 100 50), hsl(360 100 50))';\nclass $c6b5ffbe96e4aeb4$export$2e2bcd8739ae039 extends HTMLElement {\n    static formAssociated = true;\n    internals;\n    start = 1;\n    colorThumb = false;\n    reverse = false;\n    type = 'hue';\n    #input = null;\n    constructor(){\n        super();\n        this.attachShadow({\n            mode: 'open',\n            delegatesFocus: true\n        });\n        this.shadowRoot.innerHTML = `\n        <string-art-range-input min=\"1\" max=\"360\" step=\"1\" />\n    `;\n        this.#input = this.shadowRoot.querySelector('string-art-range-input');\n        this.internals = this.attachInternals();\n    }\n    static get observedAttributes() {\n        return [\n            'start',\n            'colorthumb',\n            'value',\n            'reverse',\n            'type'\n        ];\n    }\n    attributeChangedCallback(name, oldVal, newVal) {\n        if (name === 'value') this.value = newVal;\n        if (name === 'start') {\n            this.start = parseInt(newVal, 10);\n            this.#setBackground();\n        }\n        if (name === 'reverse') {\n            this.reverse = !!newVal;\n            this.#setBackground();\n        }\n        if (name === 'colorthumb') {\n            this.colorThumb = !!newVal;\n            this.#setThumbColor();\n        // Update color thumb\n        }\n        if (name === 'type') {\n            this.type = newVal === 'range' ? 'range' : 'hue';\n            this.#setBackground();\n        }\n    }\n    get value() {\n        return this.#input.value;\n    }\n    set value(v) {\n        this.#input.value = v;\n        this.#setBackground();\n        if (this.colorThumb) this.#setThumbColor();\n    }\n    connectedCallback() {\n        if (this.hasAttribute('value')) this.value = parseInt(this.getAttribute('value'));\n        if (this.hasAttribute('colorthumb')) this.colorThumb = true;\n        this.#setThumbColor();\n        this.#input.addEventListener('input', (e)=>this.#handleInput(e));\n    }\n    #handleInput(e) {\n        const value = this.value;\n        this.internals.setFormValue(String(value));\n        this.dispatchEvent(new CustomEvent('input', {\n            detail: {\n                value: value\n            }\n        }));\n        this.#setBackground();\n        this.#setThumbColor();\n    }\n    disconnectedCallback() {\n    // Destroy EditorControls here\n    }\n    focus() {}\n    blur() {}\n    #setBackground() {\n        const background = this.type === 'range' ? `linear-gradient(to ${this.reverse ? 'left' : 'right'} in hsl ${this.value >= 180 ? 'longer' : 'shorter'} hue, hsl(${this.start} 100 50), hsl(${// Fixes a bug in Chrome, that for a 180 deg hue gradient, it always goes in reverse\n        this.start + (this.value === 180 ? 181 : this.value)} 100 50))` : $c6b5ffbe96e4aeb4$var$FULL_GAMUT_GRADIENT;\n        this.#input.setAttribute('background', background);\n    }\n    #setThumbColor() {\n        const thumbColor = this.colorThumb ? `hsl(${this.value}deg 100 50)` : $c6b5ffbe96e4aeb4$var$DEFAULT_THUMB_COLOR;\n        this.#input.setAttribute('thumbcolor', thumbColor);\n    }\n}\ncustomElements.define('string-art-hue-input', $c6b5ffbe96e4aeb4$export$2e2bcd8739ae039);\n\n\nconst $01dabe55fddff864$var$DEFAULT_SNAP_DISTANCE = 0.05;\nconst $01dabe55fddff864$var$THUMB_RADIUS = 8;\nconst $01dabe55fddff864$var$TICK_WIDTH = 2;\nconst $01dabe55fddff864$var$TICK_COLOR = 'rgba(0,0,0,.2)';\nconst $01dabe55fddff864$var$FAR_VALUES_DISTANCE = 0.2; // values are considered far from each other if they are at least a fifth of the width of the input apart\nclass $01dabe55fddff864$export$2e2bcd8739ae039 extends HTMLElement {\n    static formAssociated = true;\n    internals;\n    min;\n    max;\n    #input = null;\n    #backgroundStyle = null;\n    #snap = $01dabe55fddff864$var$DEFAULT_SNAP_DISTANCE;\n    #prevValue = null;\n    #prevSnapValue = null;\n    #tickValues = null;\n    #snapDistance = null;\n    #background = null;\n    #thumbColor = null;\n    #snapDisabledTick = null;\n    #resizeObserver;\n    constructor(){\n        super();\n        this.attachShadow({\n            mode: 'open',\n            delegatesFocus: true\n        });\n        this.shadowRoot.innerHTML = `\n          <style>\n            input[type=\"range\"] {\n              width: 100%;\n              appearance: none;\n              -webkit-appearance: none; /* remove iOS default */\n              background: transparent;\n              border: none;\n              margin: 2px;\n              cursor: pointer;\n            }\n\n            input[type=\"range\"]::-webkit-slider-thumb {\n              appearance: none;\n              -webkit-appearance: none;\n              width: ${$01dabe55fddff864$var$THUMB_RADIUS * 2}px;\n              height: ${$01dabe55fddff864$var$THUMB_RADIUS * 2}px;\n              border-radius: 50%;\n              background: var(--color-input);\n              cursor: pointer;\n              border: none;\n              margin-top: -4px;\n              z-index: 10;\n              box-shadow: 0 0 5px rgba(0,0,0,.5)\n            }\n\n            input[type=\"range\"]::-webkit-slider-thumb:hover {\n              background: var(--color-input-hover);\n            }\n              \n            input[type=\"range\"]:active::-webkit-slider-thumb {\n              background: var(--color-input-active);\n            }\n\n            input[type=\"range\"]::-webkit-slider-runnable-track {\n              height: 8px;\n              border-radius: 4px;\n              margin: 0;\n            }\n          </style>\n          <style id=\"background\"></style>\n          <input type=\"range\">\n        `;\n        this.#input = this.shadowRoot.querySelector('input[type=\"range\"]');\n        this.#backgroundStyle = this.shadowRoot.querySelector('#background');\n        this.#snap = $01dabe55fddff864$var$DEFAULT_SNAP_DISTANCE;\n        this.#prevSnapValue = null;\n        this.internals = this.attachInternals();\n    }\n    static get observedAttributes() {\n        return [\n            'min',\n            'max',\n            'value',\n            'step',\n            'snap',\n            'background',\n            'thumbcolor'\n        ];\n    }\n    attributeChangedCallback(name, oldVal, newVal) {\n        if (name === 'snap') this.#tickValues = this.getTickValues();\n        else if (this.#input) this.#input[name] = newVal;\n        if (name === 'min' || name === 'max') this[name] = Number(newVal);\n        let value;\n        if (name === 'value') value = Number(newVal);\n        if (name === 'background') this.#background = newVal;\n        if (name === 'thumbcolor') this.#thumbColor = newVal;\n        if (this.min != null && this.max != null) {\n            if (this.min > this.max) {\n                this.max = this.min;\n                this.#input.max = String(this.min);\n            }\n            this.#snapDistance = (this.max - this.min) * this.#snap || $01dabe55fddff864$var$DEFAULT_SNAP_DISTANCE;\n            if (this.#tickValues && this.value != null) {\n                const snappedValue = this.getClosestTick(value);\n                if (snappedValue != null) this.#prevSnapValue = snappedValue;\n            }\n        }\n        this.#setStyle();\n    }\n    get value() {\n        return Number(this.#input.value);\n    }\n    set value(v) {\n        this.#input.value = String(v);\n        this.#setStyle();\n    }\n    connectedCallback() {\n        [\n            'min',\n            'max',\n            'value',\n            'step'\n        ].forEach((attr)=>{\n            if (this.hasAttribute(attr)) this.#input[attr] = this.getAttribute(attr);\n        });\n        this.#tickValues = this.getTickValues();\n        this.#resizeObserver = new ResizeObserver((entries)=>{\n            for (let entry of entries){\n                const width = entry.contentRect.width;\n                this.#setStyle();\n            }\n        });\n        this.#resizeObserver.observe(this.#input);\n        this.#input.addEventListener('input', ()=>this.handleInput());\n        this.#input.addEventListener('keydown', (e)=>this.handleKeydown(e));\n        this.#input.addEventListener('change', ()=>this.#snapDisabledTick = null);\n        this.tabIndex = 0;\n    }\n    disconnectedCallback() {\n        this.#resizeObserver.unobserve(this);\n    }\n    getTickValues() {\n        const ticks = this.getAttribute('snap');\n        const ticksMatch = ticks?.match(/\\d+(\\.\\d+)?/g);\n        if (!ticksMatch) return [];\n        return ticksMatch.map(Number).filter((n)=>!isNaN(n)).sort();\n    }\n    #shouldAvoidSnap(newValue, closestTick) {\n        if (closestTick == null) closestTick = this.getClosestTick(newValue);\n        if (closestTick == null) return true;\n        // If moving away from the snap value, don't snap:\n        const distanceFromTick = Math.abs(newValue - closestTick);\n        if (distanceFromTick >= this.#snapDistance / 2 && distanceFromTick > Math.abs(this.#prevValue - closestTick)) return true;\n        return false;\n    }\n    // Checks whether two values are far apart,\n    #areValuesFar(value1, value2) {\n        const distance = Math.abs(value1 - value2) / (this.max - this.min);\n        return distance >= $01dabe55fddff864$var$FAR_VALUES_DISTANCE;\n    }\n    focus() {\n        this.#input.focus();\n    }\n    blur() {\n        this.#input.blur();\n    }\n    handleInput() {\n        const value = Number(this.#input.value);\n        const closestTick = this.getClosestTick(value);\n        this.internals.setFormValue(this.#input.value);\n        if (closestTick != null && this.#snapDisabledTick !== closestTick && this.#shouldAvoidSnap(value, closestTick)) this.#snapDisabledTick = closestTick;\n        if (closestTick !== this.#snapDisabledTick) {\n            if (closestTick !== null) {\n                this.#input.value = String(closestTick);\n                if (closestTick !== this.#prevSnapValue) {\n                    this.#vibrate();\n                    this.#prevSnapValue = closestTick;\n                }\n            } else if (this.#prevSnapValue != null) this.#prevSnapValue = null;\n        }\n        if (this.#snapDisabledTick != null && closestTick == null && this.#areValuesFar(value, this.#snapDisabledTick)) this.#snapDisabledTick = null;\n        this.#setStyle();\n        this.#prevValue = value;\n        this.dispatchEvent(new CustomEvent('input', {\n            detail: {\n                value: this.#input.value\n            }\n        }));\n    }\n    handleKeydown(event) {\n        event.preventDefault();\n        const step = Number(this.#input.step || 1);\n        const value = Number(this.#input.value);\n        let newValue;\n        if (event.key === 'ArrowLeft') newValue = Math.max(this.min, value - step);\n        else if (event.key === 'ArrowRight') newValue = Math.min(this.max, value + step);\n        else if (event.key === 'ArrowUp') {\n            const next = this.#tickValues.find((t)=>t > value);\n            if (next !== undefined) newValue = next;\n            else if (value !== this.max) // no next tick found, go to max\n            newValue = this.max;\n        } else if (event.key === 'ArrowDown') {\n            const reversed = [\n                ...this.#tickValues\n            ].reverse();\n            const prev = reversed.find((t)=>t < value);\n            if (prev !== undefined) newValue = prev;\n            else if (value !== this.min) newValue = this.min;\n        }\n        if (newValue != null) {\n            this.value = newValue;\n            this.#prevValue = newValue;\n            // emit event and prevent default for arrow keys\n            this.dispatchEvent(new CustomEvent('input', {\n                detail: {\n                    value: newValue\n                },\n                bubbles: true,\n                composed: true\n            }));\n        }\n        return false;\n    }\n    getClosestTick(value) {\n        if (!this.#tickValues || this.#tickValues.length === 0) return null;\n        for (const tickValue of this.#tickValues){\n            const distance = Math.abs(value - tickValue);\n            if (distance <= this.#snapDistance) return tickValue;\n        }\n        return null;\n    }\n    #vibrate() {\n        if ('vibrate' in navigator) navigator.vibrate(10);\n    }\n    #setStyle() {\n        const inputWidth = this.#input.clientWidth;\n        if (!inputWidth) return;\n        const valueInRange = this.value - this.min;\n        const range = this.max - this.min;\n        const availableWidth = inputWidth - 2 * $01dabe55fddff864$var$THUMB_RADIUS;\n        const valueWidth = $01dabe55fddff864$var$THUMB_RADIUS + availableWidth * valueInRange / range;\n        // The center of the thumb of the range input doesn't reach 0 and 100%, so the actual range to display leaves out the thumb's radius on the left and right.\n        // Due to this, the ticks are placed in the constricted range of [THUMB_RADIUS::inputWidth - 2 * THUMB_RADIUS]\n        const tickPositions = this.#tickValues?.filter((v)=>v !== this.min && v !== this.max).map((v)=>$01dabe55fddff864$var$THUMB_RADIUS + availableWidth * (v - this.min) / range - $01dabe55fddff864$var$TICK_WIDTH / 2);\n        const tickPositionsInGradient = tickPositions?.map((p)=>`transparent ${p}px, ${$01dabe55fddff864$var$TICK_COLOR} ${p}px, ${$01dabe55fddff864$var$TICK_COLOR} ${p + $01dabe55fddff864$var$TICK_WIDTH}px, transparent ${p + $01dabe55fddff864$var$TICK_WIDTH}px`).join(', ');\n        const ticksBackground = tickPositions?.length ? `linear-gradient(to right, ${tickPositionsInGradient}), ` : null;\n        const styles = [\n            `input[type=\"range\"]::-webkit-slider-runnable-track {\n        background: ${ticksBackground ? ticksBackground : ''}${this.#background ?? `linear-gradient(to right, var(--color-input) ${valueWidth}px, #ddd ${valueWidth}px)`};\n      }${this.#background ? '' : `\n       input[type=\"range\"]:hover::-webkit-slider-runnable-track {\n        background: ${ticksBackground ? ticksBackground : ''}linear-gradient(to right, var(--color-input-hover) ${valueWidth}px, #ddd ${valueWidth}px);\n      }\n        input[type=\"range\"]:active::-webkit-slider-runnable-track {\n        background: ${ticksBackground ? ticksBackground : ''}linear-gradient(to right, var(--color-input-active) ${valueWidth}px, #ddd ${valueWidth}px);\n      }`}`\n        ];\n        if (this.#thumbColor != null) styles.push(`input[type=\"range\"]::-webkit-slider-thumb { background: ${this.#thumbColor} !important}`);\n        this.#backgroundStyle.innerHTML = styles.join('\\n');\n    }\n}\ncustomElements.define('string-art-range-input', $01dabe55fddff864$export$2e2bcd8739ae039);\n\n\nfunction $8d5cef8e7fea78a8$export$f823a0c1cf7adf68(element) {\n    element.removeAttribute('hidden');\n}\nfunction $8d5cef8e7fea78a8$export$fe8985bb6374093c(element) {\n    element.setAttribute('hidden', 'hidden');\n}\nfunction $8d5cef8e7fea78a8$export$1a3b688c8bc0de17(element, isHidden) {\n    if (isHidden != null) isHidden ? $8d5cef8e7fea78a8$export$fe8985bb6374093c(element) : $8d5cef8e7fea78a8$export$f823a0c1cf7adf68(element);\n    else if (element.hasAttribute('hidden')) $8d5cef8e7fea78a8$export$f823a0c1cf7adf68(element);\n    else $8d5cef8e7fea78a8$export$fe8985bb6374093c(element);\n}\n\n\n\nconst $da037f8140467741$var$elements = {\n    controls: document.querySelector('#controls'),\n    controlsPanel: document.querySelector('#controls_panel'),\n    sidebarForm: document.querySelector('#sidebar_form')\n};\nconst $da037f8140467741$var$STATE_LOCAL_STORAGE_KEY = 'controls_state';\nconst $da037f8140467741$var$RANGE_SCROLL_LOCK_TIMEOUT = 120;\nlet $da037f8140467741$var$inputTimeout;\nclass $da037f8140467741$export$2e2bcd8739ae039 extends (0, $00df09d341073864$export$2e2bcd8739ae039) {\n    config;\n    controlsConfig;\n    state;\n    controlElements = {};\n    #postponeRangeInput = false;\n    #postponeRangeInputTimeout;\n    #wrappedOnInput;\n    #wrappedOnTouchStart;\n    #wrappedOnTouchEnd;\n    #wrappedOnRangeScroll;\n    #currentInputRange;\n    #currentInputRangeValue;\n    #rangeLockTimeout;\n    #lockRange = false;\n    #boundToggleFieldset;\n    constructor(controlsConfig, config){\n        super();\n        this.config = config;\n        this.controlsConfig = controlsConfig;\n        this.state = this._getState() ?? {\n            groups: {}\n        };\n        this.#wrappedOnInput = this.#onInput.bind(this);\n        $da037f8140467741$var$elements.controls.addEventListener('input', this.#wrappedOnInput);\n        this.#wrappedOnTouchStart = this.#onTouchStart.bind(this);\n        $da037f8140467741$var$elements.controls.addEventListener('touchstart', this.#wrappedOnTouchStart, {\n            passive: true\n        });\n        $da037f8140467741$var$elements.controls.addEventListener('mousedown', this.#onMouseDown);\n        this.#boundToggleFieldset = this.#toggleFieldset.bind(this);\n        $da037f8140467741$var$elements.sidebarForm.addEventListener('click', this.#boundToggleFieldset);\n        $da037f8140467741$var$elements.sidebarForm.addEventListener('keydown', this.#toggleFieldSetOnEnter);\n        this.controlElements = {};\n        this.renderControls();\n        const menu = document.querySelector('#controls_menu');\n        const controlsPanel = document.querySelector('#controls_panel');\n        menu.addEventListener('click', (e)=>{\n            if (e.target instanceof HTMLElement) {\n                const href = e.target.closest('.controls_menu_item')?.getAttribute('href');\n                e.preventDefault();\n                if (href) {\n                    if (href === '#controls_top') controlsPanel.scrollTo({\n                        top: 0,\n                        behavior: 'smooth'\n                    });\n                    else {\n                        const menuTarget = document.querySelector(href);\n                        if (menuTarget instanceof (0, $4a7965eeea97d4bb$export$dbf21a0adc6a9ee0)) {\n                            menuTarget.open();\n                            menuTarget.scrollIntoView({\n                                behavior: 'smooth'\n                            });\n                        }\n                    }\n                }\n            }\n        });\n    }\n    destroy() {\n        $da037f8140467741$var$elements.controls.removeEventListener('input', this.#wrappedOnInput);\n        $da037f8140467741$var$elements.sidebarForm.removeEventListener('click', this.#boundToggleFieldset);\n        $da037f8140467741$var$elements.sidebarForm.removeEventListener('keydown', this.#toggleFieldSetOnEnter);\n        $da037f8140467741$var$elements.controls.removeEventListener('touchstart', this.#wrappedOnTouchStart);\n        $da037f8140467741$var$elements.controls.removeEventListener('mousedown', this.#onMouseDown);\n        $da037f8140467741$var$elements.controls.innerHTML = '';\n    }\n    #toggleFieldset(e) {\n        if (e.target.nodeName === 'LEGEND') {\n            e.target.parentElement.classList.toggle('minimized');\n            const groupId = e.target.parentElement.dataset.group;\n            this.state = {\n                ...this.state,\n                groups: {\n                    ...this.state.groups,\n                    [groupId]: !e.target.parentElement.classList.contains('minimized')\n                }\n            };\n            this._updateState(this.state);\n        }\n    }\n    #toggleFieldSetOnEnter(e) {\n        if (e.target.nodeName === 'LEGEND' && e.key === 'Enter') this.#toggleFieldset(e);\n    }\n    #onMouseDown() {\n        // Clearing selection when starting to click in the controls, do avoid a buggy behavior,\n        // when if a control's display value was selected (can happen by mistake), the drag of range input doesn't work.\n        const selection = window.getSelection();\n        if (selection) selection.removeAllRanges();\n    }\n    /**\n   * Needed for range inputs, to avoid changing the value when the user drags to\n   * scroll and accidentally touches a range input when intending to scroll.\n   * @param {Event} e\n   */ #onTouchStart(e) {\n        if ($da037f8140467741$var$isRangeInput(e.target)) {\n            this.#postponeRangeInput = true;\n            this.#currentInputRange = e.target;\n            this.#currentInputRangeValue = e.target.value;\n            this.#rangeLockTimeout = window.setTimeout(()=>{\n                this.#postponeRangeInput = false;\n            }, $da037f8140467741$var$RANGE_SCROLL_LOCK_TIMEOUT);\n            this.#wrappedOnTouchEnd = this.#onTouchEnd.bind(this);\n            document.body.addEventListener('touchend', this.#wrappedOnTouchEnd, {\n                passive: true\n            });\n            this.#wrappedOnRangeScroll = this.#onRangeScroll.bind(this);\n            $da037f8140467741$var$elements.controlsPanel.addEventListener('scroll', this.#wrappedOnRangeScroll);\n        }\n    }\n    #onTouchEnd() {\n        document.body.removeEventListener('touchend', this.#wrappedOnTouchEnd);\n        $da037f8140467741$var$elements.controlsPanel.removeEventListener('scroll', this.#wrappedOnRangeScroll);\n        if (this.#lockRange) {\n            this.#lockRange = false;\n            if (this.#currentInputRange) this.#currentInputRange.value = this.#currentInputRangeValue;\n        }\n        this.#currentInputRange = this.#currentInputRangeValue = null;\n    }\n    #onRangeScroll() {\n        this.#lockRange = true;\n    }\n    #onInput(e) {\n        clearTimeout($da037f8140467741$var$inputTimeout);\n        clearTimeout(this.#postponeRangeInputTimeout);\n        if (this.#postponeRangeInput && $da037f8140467741$var$isRangeInput(e.target)) {\n            e.preventDefault();\n            this.#postponeRangeInputTimeout = window.setTimeout(()=>{\n                this.#onInput(e);\n            }, $da037f8140467741$var$RANGE_SCROLL_LOCK_TIMEOUT);\n            return false;\n        }\n        if (this.#lockRange) {\n            e.preventDefault();\n            return false;\n        }\n        if (e.target instanceof HTMLInputElement || e.target instanceof (0, $3ce3bee09e11519c$export$2e2bcd8739ae039) || $da037f8140467741$var$isRangeInput(e.target) || e.target instanceof HTMLSelectElement) this.updateInput({\n            inputElement: e.target,\n            originalEvent: e,\n            deferChange: true\n        });\n    }\n    updateControlDisplayValue(controlKey) {\n        const { config: config, displayValueElement: displayValueElement, input: input } = this.controlElements[controlKey];\n        if (displayValueElement) {\n            const formattedValue = config.displayValue ? config.displayValue(this.config) : input.value;\n            displayValueElement.innerText = String(formattedValue);\n        }\n    }\n    updateInput({ inputElement: inputElement, originalEvent: originalEvent, deferChange: deferChange = true }) {\n        const controlKey = inputElement.id.replace(/^config_/, '');\n        const inputValue = $da037f8140467741$var$getInputValue(inputElement);\n        if (this.config[controlKey] === inputValue) return;\n        const eventData = {\n            control: this.controlElements[controlKey].config,\n            value: inputValue,\n            originalEvent: originalEvent\n        };\n        this.emit('input', eventData);\n        const triggerChange = ()=>{\n            this.emit('change', eventData);\n            this.updateControlsVisibility();\n            this.updateControlsLabels();\n        };\n        this.updateControlsAttributes();\n        this.updateControlDisplayValue(controlKey);\n        if (deferChange) $da037f8140467741$var$inputTimeout = window.setTimeout(triggerChange, 100);\n        else triggerChange();\n    }\n    _getState() {\n        const state = localStorage.getItem($da037f8140467741$var$STATE_LOCAL_STORAGE_KEY);\n        if (state) try {\n            return JSON.parse(state);\n        } catch (e) {\n            return null;\n        }\n        return null;\n    }\n    _updateState(newState) {\n        if (newState) localStorage.setItem($da037f8140467741$var$STATE_LOCAL_STORAGE_KEY, JSON.stringify(newState));\n        else localStorage.removeItem($da037f8140467741$var$STATE_LOCAL_STORAGE_KEY);\n    }\n    updateControlsAttributes(controlsConfig) {\n        if (!controlsConfig) controlsConfig = this.controlsConfig;\n        controlsConfig.forEach((control)=>{\n            if (control.type === 'group') this.updateControlsAttributes(control.children);\n            else if (control.attr) {\n                const functionAttrs = Object.entries(control.attr).filter(([_, value])=>value instanceof Function);\n                if (functionAttrs.length) {\n                    const inputEl = this.controlElements[control.key].input;\n                    if (inputEl) functionAttrs.forEach(([name, attributeValueFn])=>{\n                        const newAttrValue = this.getConfigValue(attributeValueFn, this.config);\n                        if (newAttrValue != inputEl.getAttribute(name)) {\n                            inputEl.setAttribute(name, String(newAttrValue));\n                            // If the min or max of the input changed and they're not within the new min/max, update the value of the input\n                            if (name === 'min' && inputEl.value < newAttrValue || name === 'max' && inputEl.value > newAttrValue) {\n                                inputEl.value = String(newAttrValue);\n                                clearTimeout(inputEl.updateTimeout);\n                                inputEl.updateTimeout = window.setTimeout(()=>{\n                                    this.updateInput({\n                                        inputElement: inputEl\n                                    });\n                                }, 100);\n                            } else this.updateControlDisplayValue(control.key);\n                        }\n                    });\n                }\n            }\n        });\n    }\n    updateControlsLabels(controlsConfig) {\n        (controlsConfig ?? this.controlsConfig).forEach((control)=>{\n            if (control.label instanceof Function) {\n                const { label: labelEl, element: element } = this.controlElements[control.key];\n                const labelText = control.label(this.config);\n                if (control.type === 'checkbox') element.setAttribute('label', labelText);\n                else if (control.type === 'group') element.setAttribute('legend', labelText);\n                else if (labelEl) labelEl.innerText = labelText;\n            }\n            if (control.type === 'group') this.updateControlsLabels(control.children);\n        });\n    }\n    updateControlsVisibility(controlsConfig) {\n        (controlsConfig ?? this.controlsConfig).forEach((control)=>{\n            if (control.show) {\n                const shouldShowControl = control.show(this.config);\n                const controlEl = this.controlElements[control.key].element;\n                if (controlEl) (0, $8d5cef8e7fea78a8$export$1a3b688c8bc0de17)(controlEl, !shouldShowControl);\n            }\n            if (control.isDisabled) {\n                const shouldDisableControl = control.isDisabled(this.config);\n                const inputEl = this.controlElements[control.key].input;\n                if (inputEl) {\n                    if (shouldDisableControl) inputEl.setAttribute('disabled', 'disabled');\n                    else inputEl.removeAttribute('disabled');\n                }\n            }\n            if (control.children) this.updateControlsVisibility(control.children);\n        });\n    }\n    renderControls(containerEl = $da037f8140467741$var$elements.controls, _controlsConfig, indexStart) {\n        const controlsConfig = _controlsConfig ?? this.controlsConfig;\n        containerEl.innerHTML = '';\n        const controlsFragment = document.createDocumentFragment();\n        indexStart = indexStart ?? 1;\n        controlsConfig.forEach((controlConfig, controlIndex)=>{\n            const controlId = `config_${String(controlConfig.key)}`;\n            let controlEl;\n            let inputEl;\n            let displayValueElement;\n            let label;\n            if (controlConfig.type === 'group') {\n                controlEl = document.createElement('expandable-panel');\n                controlEl.setAttribute('legend', this.getConfigValue(controlConfig.label, this.config));\n                controlEl.setAttribute('data-group', String(controlConfig.key));\n                controlEl.className = 'control control_group';\n                if (controlConfig.defaultValue === 'minimized') {\n                    controlEl.setAttribute('minimized', 'minimized');\n                    this.state.groups[String(controlConfig.key)] = false;\n                }\n                this.renderControls(controlEl, controlConfig.children);\n            } else {\n                controlEl = document.createElement('div');\n                controlEl.className = 'control';\n                if (controlConfig.type !== 'checkbox') {\n                    label = document.createElement('label');\n                    label.innerHTML = this.getConfigValue(controlConfig.label, this.config);\n                    label.setAttribute('for', controlId);\n                }\n                inputEl = document.createElement($da037f8140467741$var$getElementTagNameForControlType(controlConfig.type));\n                if ($da037f8140467741$var$isRangeInput(inputEl)) inputEl.classList.add('range-input');\n                inputEl.setAttribute('tabindex', String(controlIndex));\n                const inputValue = this.config[controlConfig.key] ?? this.getConfigValue(controlConfig.defaultValue, this.config);\n                if (controlConfig.type === 'select') {\n                    const selectOptions = document.createDocumentFragment();\n                    controlConfig.options.forEach((_option)=>{\n                        const { value: value, label: label } = typeof _option === 'string' ? {\n                            value: _option,\n                            label: _option\n                        } : _option;\n                        const optionEl = document.createElement('option');\n                        optionEl.setAttribute('value', value);\n                        optionEl.innerText = label;\n                        selectOptions.appendChild(optionEl);\n                    });\n                    inputEl.appendChild(selectOptions);\n                    inputEl.value = String(inputValue);\n                    controlEl.appendChild(label);\n                    controlEl.appendChild(inputEl);\n                } else {\n                    if (controlConfig.type !== 'range') inputEl.setAttribute('type', controlConfig.type);\n                    if (controlConfig.type === 'checkbox') {\n                        inputEl.checked = !!inputValue;\n                        inputEl.setAttribute('label', this.getConfigValue(controlConfig.label, this.config));\n                        controlEl.appendChild(inputEl);\n                    } else {\n                        controlEl.appendChild(label);\n                        controlEl.appendChild(inputEl);\n                        setTimeout(()=>{\n                            inputEl.value = String(inputValue);\n                        });\n                        displayValueElement = document.createElement('span');\n                        displayValueElement.id = `config_${String(controlConfig.key)}_value`;\n                        displayValueElement.innerText = String(controlConfig.displayValue ? controlConfig.displayValue(this.config) : inputValue);\n                        displayValueElement.className = 'control_input_value';\n                        controlEl.appendChild(displayValueElement);\n                    }\n                }\n                if (controlConfig.attr) Object.entries(controlConfig.attr).forEach(([attr, value])=>{\n                    const realValue = this.getConfigValue(value, this.config);\n                    inputEl.setAttribute(attr, String(realValue));\n                });\n                inputEl.id = controlId;\n            }\n            this.controlElements[controlConfig.key] = {\n                config: controlConfig,\n                displayValueElement: displayValueElement,\n                input: inputEl,\n                element: controlEl,\n                label: label\n            };\n            controlEl.id = `control_${String(controlConfig.key)}`;\n            controlsFragment.appendChild(controlEl);\n        });\n        containerEl.appendChild(controlsFragment);\n        this.updateGroupsState();\n        requestAnimationFrame(()=>this.updateControlsVisibility());\n    }\n    updateGroupsState() {\n        const groups = $da037f8140467741$var$elements.sidebarForm.querySelectorAll('[data-group]');\n        groups.forEach((groupEl)=>{\n            if (groupEl instanceof HTMLFieldSetElement) {\n                const groupId = groupEl.dataset.group;\n                const groupState = this.state.groups[groupId];\n                if (typeof groupState === 'boolean') {\n                    if (groupState) groupEl.classList.remove('minimized');\n                    else groupEl.classList.add('minimized');\n                }\n            }\n        });\n    }\n    getConfigValue(valueOrFn, config) {\n        if (valueOrFn instanceof Function) return valueOrFn(config);\n        return valueOrFn;\n    }\n}\nfunction $da037f8140467741$var$getInputValue(inputElement) {\n    if ($da037f8140467741$var$isRangeInput(inputElement)) return Number(inputElement.value);\n    if (inputElement instanceof HTMLInputElement) {\n        const type = inputElement.type;\n        switch(type){\n            case 'range':\n                return parseFloat(inputElement.value);\n            case 'hue':\n                return inputElement.value;\n            case 'checkbox':\n                return inputElement.checked;\n            case 'number':\n                return parseFloat(inputElement.value);\n            default:\n                return inputElement.value;\n        }\n    } else if (inputElement instanceof (0, $3ce3bee09e11519c$export$2e2bcd8739ae039)) return inputElement.checked;\n    else if (inputElement instanceof HTMLSelectElement) return inputElement.value;\n}\nfunction $da037f8140467741$var$getElementTagNameForControlType(controlType) {\n    switch(controlType){\n        case 'select':\n            return 'select';\n        case 'range':\n            return 'string-art-range-input';\n        case 'hue':\n            return 'string-art-hue-input';\n        case 'checkbox':\n            return 'string-art-checkbox';\n        default:\n            return 'input';\n    }\n}\nfunction $da037f8140467741$var$isRangeInput(element) {\n    return element instanceof (0, $01dabe55fddff864$export$2e2bcd8739ae039) || element instanceof (0, $c6b5ffbe96e4aeb4$export$2e2bcd8739ae039);\n}\n\n\n\nconst $66d8ae1974721b90$var$DEFAULT_OPTIONS = {\n    updateOnResize: true\n};\nclass $66d8ae1974721b90$export$2e2bcd8739ae039 extends (0, $00df09d341073864$export$2e2bcd8739ae039) {\n    parentElement;\n    color;\n    size;\n    fixedSize;\n    pixelRatio = 1;\n    options;\n    #isResizeFirstTime = true;\n    /**\n   * The current dimensions of the renderer. Should be fixed for device pixel ratio, if used by the renderer!\n   */ currentSize;\n    lastLine;\n    lastStringCoordinates;\n    hasInstructions = false;\n    currentLayerOptions;\n    #removeDevicePixelListener;\n    #removeOnResizeListener;\n    constructor(parentElement, options){\n        super();\n        this.options = options ?? $66d8ae1974721b90$var$DEFAULT_OPTIONS;\n        const { updateOnResize: updateOnResize = true } = this.options;\n        this.parentElement = parentElement;\n        if (updateOnResize) this.#setOnResize();\n    }\n    #setOnResize() {\n        const resizeObserver = new ResizeObserver((entries)=>{\n            for (const entry of entries){\n                if (!this.#isResizeFirstTime) {\n                    if (!this.fixedSize) this.setSize([\n                        entry.contentRect.width,\n                        entry.contentRect.height\n                    ]);\n                }\n                this.#isResizeFirstTime = false;\n            }\n        });\n        this.#removeOnResizeListener = ()=>resizeObserver.disconnect();\n        resizeObserver.observe(this.parentElement);\n    }\n    destroy() {\n        if (this.parentElement) this.parentElement.innerHTML = '';\n        this.#removeDevicePixelListener?.();\n        this.#removeOnResizeListener?.();\n    }\n    get element() {\n        throw new Error('element getter not implemented!');\n    }\n    setColor(color) {\n        this.color = color;\n    }\n    resetSize() {\n        this.fixedSize = null;\n    }\n    getSize() {\n        const { width: width, height: height } = this.parentElement.getBoundingClientRect();\n        return [\n            width,\n            height\n        ];\n    }\n    /**\n   * Returns the CSS pixel space dimensions of the renderer (as opposed to the device pixels, which uses device pixel ratio)\n   * @returns\n   */ getLogicalSize() {\n        return this.getSize();\n    }\n    setStartingPoint(coordinates) {\n        this.lastStringCoordinates = coordinates;\n    }\n    startLayer(options) {\n        this.currentLayerOptions = options;\n        if (options.color) this.setColor(options.color);\n    }\n    endLayer() {\n        this.currentLayerOptions = null;\n    }\n    /**\n   * Sets a fixed size for the renderer, which doesn't get updates on resize changes\n   * A fixed size can be cancelled with `resetSize` or setSize(null).\n   */ setFixedSize(size) {\n        // First setting to null because the `setSize` method won't override an existing fixedSize\n        this.fixedSize = null;\n        this.setSize(size);\n        this.fixedSize = size;\n    }\n    enablePixelRatio() {\n        const dpr = window.devicePixelRatio || 1;\n        this.pixelRatio = dpr;\n        if (this.options.updateOnResize !== false) {\n            const updatePixelRatio = ()=>{\n                this.#removeDevicePixelListener?.();\n                const mqString = `(resolution: ${dpr}dppx)`;\n                const media = matchMedia(mqString);\n                media.addEventListener('change', updatePixelRatio);\n                this.#removeDevicePixelListener = ()=>{\n                    media.removeEventListener('change', updatePixelRatio);\n                };\n                this.pixelRatio = window.devicePixelRatio;\n                this.emit('devicePixelRatioChange', {\n                    devicePixelRatio: this.pixelRatio\n                });\n            };\n            updatePixelRatio();\n        }\n    }\n    disablePixelRatio() {\n        this.pixelRatio = 1;\n        this.#removeDevicePixelListener?.();\n    }\n    renderInstructionsForLastLine() {\n        this.renderInstructions(...this.lastLine);\n    }\n}\n\n\nfunction $e2b746416d2bf62b$export$f81847884871263e(int1, int2) {\n    if (!int2) return int1;\n    return $e2b746416d2bf62b$export$f81847884871263e(int2, int1 % int2);\n}\nconst $e2b746416d2bf62b$export$f4644083ce95e7e3 = Math.PI * 2;\nfunction $e2b746416d2bf62b$export$643b64bfca4574ff(distortion) {\n    return distortion < 0 ? [\n        1 - Math.abs(distortion),\n        1\n    ] : [\n        1 / (1 - distortion),\n        1\n    ];\n}\nfunction $e2b746416d2bf62b$export$27796bb1a51212b7(from, to) {\n    return Math.hypot(to[0] - from[0], to[1] - from[1]);\n}\nfunction $e2b746416d2bf62b$export$a3992db8dd0fd9e6(v, decimalPoints) {\n    const pow10 = Math.pow(10, decimalPoints);\n    return Math.round(v * pow10) / pow10;\n}\nconst $e2b746416d2bf62b$var$SMALLEST_DISTANCE = Math.pow(10, -8);\nfunction $e2b746416d2bf62b$export$e2b09acd39c6280(points) {\n    if (points.length < 2) return Infinity;\n    const ptsByX = [\n        ...points\n    ].sort((a, b)=>a[0] - b[0]);\n    const ptsByY = [\n        ...points\n    ].sort((a, b)=>a[1] - b[1]);\n    // If two points are closest than SMALLEST_DISTANCE, it's considered that they're on the same place and the same, the distance isn't used\n    const recurse = (px, py)=>{\n        const n = px.length;\n        if (n <= 3) {\n            let min = Infinity;\n            for(let i = 0; i < n; i++)for(let j = i + 1; j < n; j++){\n                const pointsDist = $e2b746416d2bf62b$export$27796bb1a51212b7(px[i], px[j]);\n                if (pointsDist >= $e2b746416d2bf62b$var$SMALLEST_DISTANCE) min = Math.min(min, pointsDist);\n            }\n            return min;\n        }\n        const mid = Math.floor(n / 2);\n        const midX = px[mid][0];\n        const leftX = px.slice(0, mid);\n        const rightX = px.slice(mid);\n        const leftY = [];\n        const rightY = [];\n        for (const p of py)(p[0] <= midX ? leftY : rightY).push(p);\n        const dLeft = recurse(leftX, leftY);\n        const dRight = recurse(rightX, rightY);\n        let d = Math.min(dLeft, dRight);\n        // Build strip around mid line\n        const strip = py.filter((p)=>Math.abs(p[0] - midX) < d);\n        // Check up to 7 points ahead for each in strip\n        for(let i = 0; i < strip.length; i++)for(let j = i + 1; j < strip.length && strip[j][1] - strip[i][1] < d; j++){\n            const stripDist = $e2b746416d2bf62b$export$27796bb1a51212b7(strip[i], strip[j]);\n            if (stripDist >= $e2b746416d2bf62b$var$SMALLEST_DISTANCE) d = Math.min(d, stripDist);\n        }\n        return d;\n    };\n    return recurse(ptsByX, ptsByY);\n}\n\n\n\nconst $b683a3137b30eaa9$var$INCH_TO_CM = 2.54;\nObject.defineProperty(Number.prototype, 'toFixedPrecision', {\n    value: function(fractionDigits) {\n        const factor = Math.pow(10, fractionDigits);\n        return Math.round(this * factor) / factor;\n    },\n    writable: true,\n    configurable: true,\n    enumerable: false\n});\nfunction $b683a3137b30eaa9$export$b81d802eaada750f(d1, d2) {\n    return d1[0] === d2[0] && d1[1] === d2[1];\n}\nfunction $b683a3137b30eaa9$export$f3f3516e40845898(cm, dpi = 300) {\n    return Math.floor(cm / $b683a3137b30eaa9$var$INCH_TO_CM * dpi);\n}\nfunction $b683a3137b30eaa9$export$d7223786e48f6cef(cm) {\n    return cm / $b683a3137b30eaa9$var$INCH_TO_CM;\n}\nfunction $b683a3137b30eaa9$export$18bf5c4f04de9fc8(inch, dpi) {\n    return inch * dpi;\n}\nfunction $b683a3137b30eaa9$export$3770e152b9978d1(cm, dpi) {\n    return $b683a3137b30eaa9$export$18bf5c4f04de9fc8($b683a3137b30eaa9$export$d7223786e48f6cef(cm), dpi);\n}\nfunction $b683a3137b30eaa9$export$4fb29fadf64dd497(inch) {\n    return inch * $b683a3137b30eaa9$var$INCH_TO_CM;\n}\nfunction $b683a3137b30eaa9$export$8a2c229e5a0b9f4f(pixels, dpi) {\n    return pixels / dpi;\n}\nfunction $b683a3137b30eaa9$export$ff05d281b1c1eba7(pixels, dpi) {\n    return $b683a3137b30eaa9$export$4fb29fadf64dd497($b683a3137b30eaa9$export$8a2c229e5a0b9f4f(pixels, dpi));\n}\nfunction $b683a3137b30eaa9$export$b4179f68b165b05c(dimensions) {\n    return dimensions.map($b683a3137b30eaa9$export$d7223786e48f6cef);\n}\nfunction $b683a3137b30eaa9$export$593c4f3f624319dc(dimensions) {\n    return dimensions.map($b683a3137b30eaa9$export$4fb29fadf64dd497);\n}\nconst $b683a3137b30eaa9$var$LENGTH_UNITS = new Set([\n    'cm',\n    'inch'\n]);\nfunction $b683a3137b30eaa9$export$c566af9defc62c6(dimensions, mapper) {\n    return dimensions.map(mapper);\n}\nfunction $b683a3137b30eaa9$export$6625f4a88a935670(value, from, to, dpi) {\n    if (from === to) return value;\n    if ($b683a3137b30eaa9$var$LENGTH_UNITS.has(from) !== $b683a3137b30eaa9$var$LENGTH_UNITS.has(to) && !dpi) throw new Error(`Can't convert from ${from} to ${to} without DPI!`);\n    switch(from){\n        case 'cm':\n            switch(to){\n                case 'inch':\n                    return $b683a3137b30eaa9$export$d7223786e48f6cef(value);\n                case 'px':\n                    return $b683a3137b30eaa9$export$3770e152b9978d1(value, dpi);\n            }\n        case 'inch':\n            switch(to){\n                case 'cm':\n                    return $b683a3137b30eaa9$export$4fb29fadf64dd497(value);\n                case 'px':\n                    return $b683a3137b30eaa9$export$18bf5c4f04de9fc8(value, dpi);\n            }\n        case 'px':\n            switch(to){\n                case 'cm':\n                    return $b683a3137b30eaa9$export$ff05d281b1c1eba7(value, dpi);\n                case 'inch':\n                    return $b683a3137b30eaa9$export$8a2c229e5a0b9f4f(value, dpi);\n            }\n    }\n}\nfunction $b683a3137b30eaa9$export$2e7f3602dd2acd76(dimensions, from, to, dpi) {\n    return $b683a3137b30eaa9$export$c566af9defc62c6(dimensions, (v)=>$b683a3137b30eaa9$export$6625f4a88a935670(v, from, to, dpi));\n}\nconst $b683a3137b30eaa9$export$e8dd885a22676074 = [\n    {\n        id: 'A4',\n        dimensions: [\n            21,\n            29.7\n        ]\n    },\n    {\n        id: 'A3',\n        dimensions: [\n            29.7,\n            42\n        ]\n    },\n    {\n        id: 'A2',\n        dimensions: [\n            42,\n            59.4\n        ]\n    },\n    {\n        id: 'A1',\n        dimensions: [\n            59.4,\n            84.1\n        ]\n    }\n];\nfunction $b683a3137b30eaa9$export$1d3cc206d049790e(...boundingRects) {\n    return boundingRects.reduce((box, boundingRect)=>{\n        const newBox = {\n            ...box,\n            left: !box.left ? boundingRect.left : Math.min(box.left, boundingRect.left),\n            right: !box.right ? boundingRect.right : Math.max(box.right, boundingRect.right),\n            top: !box.top ? boundingRect.top : Math.min(box.top, boundingRect.top),\n            bottom: !boundingRect.bottom ? box.bottom : Math.max(box.bottom, boundingRect.bottom)\n        };\n        Object.assign(newBox, {\n            width: newBox.right - newBox.left,\n            height: newBox.bottom - newBox.top\n        });\n        return newBox;\n    }, {\n        left: 0,\n        right: 0,\n        top: 0,\n        bottom: 0,\n        width: 0,\n        height: 0\n    });\n}\nfunction $b683a3137b30eaa9$export$8c48870e8825fa45(coordinates) {\n    if (coordinates.length === 0) throw new Error(\"Can't get bounding rect, no coordinates specified.\");\n    if (coordinates.length === 1) return {\n        top: coordinates[0][1],\n        bottom: coordinates[0][1],\n        left: coordinates[0][0],\n        right: coordinates[0][0],\n        width: 0,\n        height: 0\n    };\n    const sides = coordinates.reduce((box, point)=>({\n            top: Math.min(box.top, point[1]),\n            bottom: Math.max(box.bottom, point[1]),\n            left: Math.min(box.left, point[0]),\n            right: Math.max(box.right, point[0])\n        }), {\n        top: Infinity,\n        left: Infinity,\n        bottom: -Infinity,\n        right: -Infinity\n    });\n    return {\n        ...sides,\n        width: sides.right - sides.left,\n        height: sides.bottom - sides.top\n    };\n}\nfunction $b683a3137b30eaa9$export$d2646d47608819e2(boundingRect) {\n    return boundingRect.width / boundingRect.height;\n}\nfunction $b683a3137b30eaa9$export$18c295d7a6a8189d(size1, size2) {\n    const ratio = Math.min(size2[0] / size1[0], size2[1] / size1[1]);\n    return $b683a3137b30eaa9$export$c566af9defc62c6(size1, (v)=>v * ratio);\n}\nfunction $b683a3137b30eaa9$export$c91255cadecfe081(size) {\n    return $b683a3137b30eaa9$export$c566af9defc62c6(size, (v)=>v / 2);\n}\nconst $b683a3137b30eaa9$var$METRIC_UNITS = {\n    m: 1,\n    cm: 0.01,\n    mm: 0.001\n};\nfunction $b683a3137b30eaa9$export$deca72617c96d902(length, sourceUnits, decimalPoints = 1) {\n    const meters = length * $b683a3137b30eaa9$var$METRIC_UNITS[sourceUnits];\n    if (meters >= 1) return (0, $e2b746416d2bf62b$export$a3992db8dd0fd9e6)(meters, decimalPoints).toLocaleString() + ' m';\n    else if (meters < 0.01) return (0, $e2b746416d2bf62b$export$a3992db8dd0fd9e6)(meters * 1000, decimalPoints).toLocaleString() + ' mm';\n    else return (0, $e2b746416d2bf62b$export$a3992db8dd0fd9e6)(meters * 100, decimalPoints).toLocaleString() + ' cm';\n}\n\n\n\nlet $2f2e0bbe9a3a6970$var$lastId = 0;\nconst $2f2e0bbe9a3a6970$var$INSTRUCTIONS_NAIL_RADIUS = 4;\nclass $2f2e0bbe9a3a6970$export$2e2bcd8739ae039 extends (0, $66d8ae1974721b90$export$2e2bcd8739ae039) {\n    #background;\n    #currentColor;\n    #layers;\n    #instructions;\n    #cancelInstructionsHide;\n    constructor(parentElement, options){\n        super(parentElement, options);\n        const stringsCanvas = document.createElement('canvas');\n        const nailsCanvas = document.createElement('canvas');\n        const instructionsCanvas = document.createElement('canvas');\n        stringsCanvas.setAttribute('data-id', String($2f2e0bbe9a3a6970$var$lastId++));\n        this.#layers = {\n            strings: {\n                canvas: stringsCanvas,\n                ctx: stringsCanvas.getContext('2d')\n            },\n            nails: {\n                canvas: nailsCanvas,\n                ctx: nailsCanvas.getContext('2d')\n            },\n            instructions: {\n                canvas: instructionsCanvas,\n                ctx: instructionsCanvas.getContext('2d')\n            }\n        };\n        stringsCanvas.id = 'CanvasRenderer__strings';\n        nailsCanvas.id = 'CanvasRenderer__nails';\n        instructionsCanvas.id = 'CanvasRenderer_instructions';\n        this.instructionsCtx.lineWidth = 4;\n        this.instructionsCtx.strokeStyle = 'Red';\n        this.canvases.forEach((canvas)=>{\n            canvas.classList.add('CanvasRenderer__canvas');\n            parentElement.appendChild(canvas);\n            canvas.style.position = 'absolute';\n            canvas.style.top = '0';\n            canvas.style.left = '0';\n            canvas.style.width = '100%';\n            canvas.style.height = '100%';\n        });\n        this.enablePixelRatio();\n        this.ctxs.forEach((ctx)=>ctx.globalCompositeOperation = 'source-over');\n        this.addEventListener('devicePixelRatioChange', ()=>{\n            this.setSize([\n                this.stringsCanvas.clientWidth,\n                this.stringsCanvas.clientHeight\n            ]);\n        });\n        this.resetSize(false);\n    }\n    get element() {\n        return this.#layers.strings.canvas;\n    }\n    get canvases() {\n        return [\n            this.#layers.strings.canvas,\n            this.#layers.nails.canvas,\n            this.#layers.instructions.canvas\n        ];\n    }\n    get ctxs() {\n        return [\n            this.#layers.strings.ctx,\n            this.#layers.nails.ctx,\n            this.#layers.instructions.ctx\n        ];\n    }\n    get stringsCtx() {\n        return this.#layers.strings.ctx;\n    }\n    get nailsCtx() {\n        return this.#layers.nails.ctx;\n    }\n    get stringsCanvas() {\n        return this.#layers.strings.canvas;\n    }\n    get instructionsCanvas() {\n        return this.#layers.instructions.canvas;\n    }\n    get instructionsCtx() {\n        return this.#layers.instructions.ctx;\n    }\n    resetSize(notifyOnChange = true) {\n        super.resetSize();\n        this.canvases.forEach((canvas)=>{\n            canvas.removeAttribute('width');\n            canvas.removeAttribute('height');\n            canvas.style.removeProperty('width');\n            canvas.style.removeProperty('height');\n        });\n        const newSize = this.getSize();\n        this.canvases.forEach((canvas)=>{\n            canvas.setAttribute('width', String(newSize[0]));\n            canvas.setAttribute('height', String(newSize[1]));\n        });\n        if (!this.currentSize || !(0, $b683a3137b30eaa9$export$b81d802eaada750f)(newSize, this.currentSize)) {\n            this.currentSize = newSize;\n            if (notifyOnChange) this.emit('sizeChange', {\n                size: newSize\n            });\n        }\n        return newSize;\n    }\n    setSize(size) {\n        if (!size) return this.resetSize();\n        if (this.fixedSize) {\n            console.warn(`Trying to set size for Renderer to [${size.join(', ')}], but size is fixed to [${this.fixedSize.join(', ')}].`);\n            return this.fixedSize;\n        }\n        const realSize = size.map((v)=>v * this.pixelRatio);\n        this.canvases.forEach((canvas)=>{\n            canvas.setAttribute('width', String(realSize[0]));\n            canvas.setAttribute('height', String(realSize[1]));\n            canvas.style.setProperty('width', `${size[0]}px`);\n            canvas.style.setProperty('height', `${size[1]}px`);\n        });\n        if (!this.currentSize || !(0, $b683a3137b30eaa9$export$b81d802eaada750f)(realSize, this.currentSize)) {\n            this.currentSize = realSize;\n            this.emit('sizeChange', {\n                size: realSize\n            });\n        }\n        return realSize;\n    }\n    resetStrings() {\n        this.stringsCtx.clearRect(0, 0, ...this.getSize());\n    }\n    /**\n   * Clears the stringsCanvas and resets the width and height\n   */ resetNails() {\n        this.#layers.nails.ctx.clearRect(0, 0, ...this.getSize());\n    }\n    setColor(color) {\n        this.#currentColor = color;\n        this.stringsCtx.strokeStyle = color;\n    }\n    setLineWidth(width) {\n        this.stringsCtx.lineWidth = width;\n    }\n    setBackground(color) {\n        if (this.#background = color) {\n            this.parentElement.style.background = color;\n            if (this.#instructions) this.#instructions.style.background = color;\n        } else {\n            this.parentElement.style.removeProperty('background');\n            if (this.#instructions) this.#instructions.style.background = 'black';\n        }\n    }\n    #setBackgroundOnCanvas(context, color) {\n        context.globalCompositeOperation = 'destination-over';\n        context.fillStyle = color;\n        context.fillRect(0, 0, ...this.getSize());\n        context.globalCompositeOperation = 'source-over';\n    }\n    getLogicalSize() {\n        return this.fixedSize ?? [\n            this.stringsCanvas.clientWidth,\n            this.stringsCanvas.clientHeight\n        ];\n    }\n    getSize() {\n        return this.getLogicalSize().map((v)=>v * this.pixelRatio);\n    }\n    renderLine(from, to) {\n        this.lastStringCoordinates = from;\n        this.lineTo(to);\n    }\n    lineTo(to) {\n        if (!this.lastStringCoordinates) throw new Error(\"no last string coordinates, can't lineTo\");\n        this.stringsCtx.beginPath();\n        this.stringsCtx.moveTo(...this.lastStringCoordinates);\n        this.stringsCtx.lineTo(...to);\n        this.stringsCtx.stroke();\n        this.lastLine = [\n            this.lastStringCoordinates,\n            to\n        ];\n        this.lastStringCoordinates = to;\n    }\n    renderNails(nails, { color: color, fontSize: fontSize, radius: radius, renderNumbers: renderNumbers, margin: margin = 0, numbersStart: numbersStart = 1 }) {\n        const centerX = this.stringsCanvas.width / 2;\n        this.nailsCtx.globalCompositeOperation = 'source-over';\n        this.nailsCtx.beginPath();\n        this.nailsCtx.fillStyle = color;\n        this.nailsCtx.textBaseline = 'middle';\n        this.nailsCtx.font = `${fontSize}px sans-serif`;\n        const nailNumberOffset = radius + margin;\n        let number = numbersStart;\n        for (let [x, y] of nails){\n            this.nailsCtx.moveTo(x + radius, y);\n            this.nailsCtx.arc(x, y, radius, 0, (0, $e2b746416d2bf62b$export$f4644083ce95e7e3));\n            if (renderNumbers && number != null) {\n                const isRightAlign = x < centerX;\n                const numberPosition = [\n                    isRightAlign ? x - nailNumberOffset : x + nailNumberOffset,\n                    y\n                ];\n                this.nailsCtx.textAlign = isRightAlign ? 'right' : 'left';\n                this.nailsCtx.fillText(String(number), ...numberPosition);\n            }\n            number++;\n        }\n        this.nailsCtx.fill();\n    }\n    showInstructions() {\n        this.#cancelInstructionsHide?.();\n        if (!this.#instructions) {\n            this.#instructions = document.createElement('div');\n            this.#instructions.id = 'CanvasRenderer__instructions';\n            const instructionsOverlay = document.createElement('div');\n            instructionsOverlay.id = 'CanvasRenderer__instructions_overlay';\n            instructionsOverlay.style = `background: ${this.parentElement.style.background ?? 'black'}; position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.5`;\n            this.#instructions.appendChild(instructionsOverlay);\n            this.#instructions.appendChild(this.instructionsCanvas);\n            this.parentElement.appendChild(this.#instructions);\n        } else (0, $8d5cef8e7fea78a8$export$f823a0c1cf7adf68)(this.#instructions);\n    }\n    hideInstructions() {\n        if (this.#instructions) {\n            let opacity = 1;\n            const fadeOut = ()=>{\n                opacity -= 0.02;\n                this.#instructions.style.opacity = String(opacity);\n                if (opacity > 0) {\n                    const raf = requestAnimationFrame(fadeOut);\n                    this.#cancelInstructionsHide = ()=>{\n                        cancelAnimationFrame(raf);\n                        this.#instructions.style.removeProperty('opacity');\n                    };\n                } else {\n                    (0, $8d5cef8e7fea78a8$export$fe8985bb6374093c)(this.#instructions);\n                    this.clearInstructions();\n                    this.#instructions.style.removeProperty('opacity');\n                }\n            };\n            fadeOut();\n        }\n    }\n    renderInstructions(from, to) {\n        this.showInstructions();\n        const strokeColor = 'white';\n        const fillColor = this.#currentColor ?? 'red';\n        this.clearInstructions();\n        this.instructionsCtx.clearRect(0, 0, ...this.getSize());\n        this.instructionsCtx.beginPath();\n        this.instructionsCtx.lineWidth = 3;\n        let prevPosition = from;\n        this.#drawArrow(prevPosition, to, {\n            strokeColor: strokeColor,\n            fillColor: fillColor\n        });\n        prevPosition = to;\n        this.instructionsCtx.stroke();\n        this.instructionsCtx.beginPath();\n        [\n            from,\n            to\n        ].forEach(([x, y])=>{\n            this.instructionsCtx.moveTo(x + $2f2e0bbe9a3a6970$var$INSTRUCTIONS_NAIL_RADIUS, y);\n            this.instructionsCtx.arc(x, y, $2f2e0bbe9a3a6970$var$INSTRUCTIONS_NAIL_RADIUS, 0, (0, $e2b746416d2bf62b$export$f4644083ce95e7e3));\n        });\n        this.instructionsCtx.strokeStyle = strokeColor;\n        this.instructionsCtx.stroke();\n        this.instructionsCtx.fillStyle = fillColor;\n        this.instructionsCtx.fill();\n        this.hasInstructions = true;\n    }\n    clearInstructions() {\n        if (this.hasInstructions) {\n            this.instructionsCtx.clearRect(0, 0, ...this.getSize());\n            this.hasInstructions = false;\n        }\n    }\n    #drawArrow(from, to, { strokeColor: strokeColor = 'white', fillColor: fillColor = 'red' }) {\n        const arrowHeadSize = 15;\n        const ctx = this.instructionsCtx;\n        // Calculate angle of the line\n        const angle = Math.atan2(to[1] - from[1], to[0] - from[0]);\n        ctx.save(); // Save the current canvas state\n        ctx.strokeStyle = strokeColor;\n        ctx.fillStyle = fillColor; // For filling the arrowhead\n        // Draw the main line\n        ctx.beginPath();\n        ctx.moveTo(from[0], from[1]);\n        ctx.lineTo(to[0], to[1]);\n        ctx.stroke();\n        const arrowPos = [\n            from[0] + (to[0] - from[0]) / 2,\n            from[1] + (to[1] - from[1]) / 2\n        ];\n        // Draw the arrowhead\n        ctx.beginPath();\n        ctx.moveTo(arrowPos[0], arrowPos[1]);\n        ctx.lineTo(arrowPos[0] - arrowHeadSize * Math.cos(angle - Math.PI / 6), arrowPos[1] - arrowHeadSize * Math.sin(angle - Math.PI / 6));\n        ctx.lineTo(arrowPos[0] - arrowHeadSize * Math.cos(angle + Math.PI / 6), arrowPos[1] - arrowHeadSize * Math.sin(angle + Math.PI / 6));\n        ctx.closePath(); // Connects the last point to the first, closing the triangle\n        ctx.fill(); // Fills the arrowhead\n        ctx.restore(); // Restore the canvas state\n    }\n    clear() {\n        this.ctxs.forEach((ctx)=>ctx.clearRect(0, 0, ...this.getSize()));\n    }\n    toDataURL() {\n        return this.getComposite().toDataURL();\n    }\n    async toBlob(type = 'png', quality = 1) {\n        return new Promise((resolve, reject)=>{\n            this.getComposite().toBlob((blob)=>blob ? resolve(blob) : reject(), `image/${type}`, Math.max(0, Math.min(quality, 1)));\n        });\n    }\n    getComposite() {\n        const compositeCanvas = document.createElement('canvas');\n        compositeCanvas.width = this.stringsCanvas.width;\n        compositeCanvas.height = this.stringsCanvas.height;\n        const ctx = compositeCanvas.getContext('2d');\n        if (this.#background) this.#setBackgroundOnCanvas(ctx, this.#background);\n        this.canvases.filter((canvas)=>canvas !== this.instructionsCanvas).forEach((c)=>ctx.drawImage(c, 0, 0));\n        return compositeCanvas;\n    }\n}\n\n\n\nconst $174f2c93f6348ee5$var$promptDialogId = 'prompt_dialog';\nfunction $174f2c93f6348ee5$export$195ba6d62321b933({ value: value, ...options }) {\n    let dialog = document.querySelector(`#${$174f2c93f6348ee5$var$promptDialogId}`);\n    if (!dialog) {\n        dialog = document.createElement('input-dialog');\n        dialog.id = $174f2c93f6348ee5$var$promptDialogId;\n        document.body.appendChild(dialog);\n    }\n    [\n        'title',\n        'description',\n        'submit',\n        'cancel',\n        'type',\n        'submitIcon'\n    ].forEach((attr)=>{\n        if (options[attr] != null && options[attr] !== '') dialog.setAttribute(getAttributeForProp(attr), options[attr]);\n        else dialog.removeAttribute(attr);\n    });\n    return dialog.show(value);\n    function getAttributeForProp(prop) {\n        switch(prop){\n            case 'title':\n                return 'dialog-title';\n            case 'submitIcon':\n                return 'submit-icon';\n            default:\n                return prop;\n        }\n    }\n}\nconst $174f2c93f6348ee5$var$CONFIRM_DIALOG_ID = 'confirm_dialog';\nfunction $174f2c93f6348ee5$export$715f9d76bb8c1fea(options) {\n    let dialog = document.querySelector(`#${$174f2c93f6348ee5$var$CONFIRM_DIALOG_ID}`);\n    if (!dialog) {\n        dialog = document.createElement('confirm-dialog');\n        dialog.id = $174f2c93f6348ee5$var$CONFIRM_DIALOG_ID;\n        document.body.appendChild(dialog);\n    }\n    [\n        'title',\n        'description',\n        'submit',\n        'cancel',\n        'type'\n    ].forEach((attr)=>{\n        if (options[attr] != null && options[attr] !== '') dialog.setAttribute(attr === 'title' ? 'dialog-title' : attr, options[attr]);\n        else dialog.removeAttribute(attr);\n    });\n    return dialog.show();\n}\n\n\nconst $d8f8628a77747326$var$MAX_FLOAT_DECIMALS = 6;\nfunction $d8f8628a77747326$export$fa8157df3262779b(pattern) {\n    const { defaultConfig: defaultConfig, config: config } = pattern;\n    const nonDefaultConfigValues = Object.entries(config).map(([key, value])=>{\n        if (value === defaultConfig[key]) return null;\n        if (typeof value === 'boolean') return `!${value ? 1 : 0}`;\n        if (typeof value === 'number') return parseFloat(value.toFixed($d8f8628a77747326$var$MAX_FLOAT_DECIMALS));\n        return value;\n    });\n    while(nonDefaultConfigValues[nonDefaultConfigValues.length - 1] === null)nonDefaultConfigValues.pop();\n    if (!nonDefaultConfigValues.length) return '';\n    const serializedConfigValues = nonDefaultConfigValues.join('_').replace(/\\_{2,}/g, (match)=>'~' + match.length + '_');\n    return serializedConfigValues;\n}\nconst $d8f8628a77747326$var$numberRegExp = /^\\-?\\d+(\\.\\d+)?$/;\nconst $d8f8628a77747326$var$booleanRegExp = /^(?:!)([01])$/;\nfunction $d8f8628a77747326$export$39ef19ebad6081a3(pattern, serializedCofig) {\n    const serializedConfigValues = serializedCofig.replace(/(?:~)(\\d+)(?:_)/g, (_, commaCount)=>new Array(+commaCount).fill('_').join('')).split('_').map((v)=>{\n        if (v === '') return null;\n        if ($d8f8628a77747326$var$numberRegExp.test(v)) return parseFloat(v);\n        const booleanMatch = v.match($d8f8628a77747326$var$booleanRegExp);\n        if (booleanMatch) return booleanMatch[1] === '1';\n        return v;\n    });\n    const configKeys = Object.keys(pattern.defaultConfig);\n    return serializedConfigValues.reduce((config, serializedValue, i)=>{\n        if (serializedValue !== null) {\n            const key = configKeys[i];\n            return {\n                ...config,\n                [key]: serializedValue\n            };\n        }\n        return config;\n    }, {});\n}\n\n\nfunction $2509ceef6c629a64$export$87dcc7060093bbda(pattern, { renderer: renderer, patternAsTemplate: patternAsTemplate = false } = {}) {\n    const configQuery = pattern.isDefaultConfig ? undefined : (0, $d8f8628a77747326$export$fa8157df3262779b)(pattern);\n    return `?pattern=${!patternAsTemplate ? pattern.id : pattern.type}${configQuery ? `&config=${encodeURIComponent(configQuery)}` : ''}${renderer === 'svg' ? '&renderer=svg' : ''}`;\n}\nfunction $2509ceef6c629a64$export$e2de15bbd9edf9c6() {\n    const queryParams = new URLSearchParams(document.location.search);\n    return {\n        pattern: queryParams.get('pattern'),\n        config: queryParams.get('config'),\n        name: queryParams.get('name'),\n        renderer: queryParams.get('renderer') === 'svg' ? 'svg' : null\n    };\n}\n\n\nfunction* $b103c63dc979d40c$export$596571ef134d4065(controlsConfig, parent) {\n    let index = 0;\n    for (const control of controlsConfig){\n        yield {\n            control: control,\n            index: index,\n            parent: parent\n        };\n        if (control.children) yield* $b103c63dc979d40c$export$596571ef134d4065(control.children, {\n            control: control,\n            parent: parent,\n            index: index\n        });\n        index++;\n    }\n}\nfunction $b103c63dc979d40c$var$findControlConfigNode(controlsConfig, findFn) {\n    for (const node of $b103c63dc979d40c$export$596571ef134d4065(controlsConfig)){\n        if (findFn(node.control)) return node;\n    }\n    return null;\n}\nfunction $b103c63dc979d40c$var$getControlConfigNodeByKey(controlsConfig, controlKey) {\n    return $b103c63dc979d40c$var$findControlConfigNode(controlsConfig, ({ key: key })=>key === controlKey);\n}\nfunction $b103c63dc979d40c$export$2d97e2da46663803(controlConfig, attributeName) {\n    const attr = controlConfig.attr;\n    if (!attr) return controlConfig;\n    const attrCopy = {\n        ...attr\n    };\n    delete attrCopy[attributeName];\n    return {\n        ...controlConfig,\n        attr: attrCopy\n    };\n}\nfunction $b103c63dc979d40c$export$68091c7c829a57b8(controlsConfig) {\n    return controlsConfig.map((control)=>{\n        const copy = {\n            ...control\n        };\n        if (control.children) copy.children = $b103c63dc979d40c$export$68091c7c829a57b8(control.children);\n        if (control.attr) copy.attr = {\n            ...control.attr\n        };\n        return copy;\n    });\n}\nfunction $b103c63dc979d40c$export$e6b0de4153cc8c78(controlsConfig, controlKey) {\n    const controlNode = $b103c63dc979d40c$var$getControlConfigNodeByKey(controlsConfig, controlKey);\n    if (controlNode) {\n        const path = [\n            controlNode.index\n        ];\n        let parentNode = controlNode.parent;\n        while(parentNode){\n            path.unshift(parentNode.index);\n            parentNode = parentNode.parent;\n        }\n        return path;\n    }\n    return null;\n}\nfunction $b103c63dc979d40c$export$c4f94c8b3850a5a9(controlsConfig, insertAfterKey, controlsConfigToInsert) {\n    const configCopy = $b103c63dc979d40c$export$68091c7c829a57b8(controlsConfig);\n    const nodeToAddAfter = $b103c63dc979d40c$var$getControlConfigNodeByKey(configCopy, insertAfterKey);\n    if (nodeToAddAfter) {\n        const { index: index, parent: parent } = nodeToAddAfter;\n        let list = parent?.control.children ?? configCopy;\n        list.splice(index + 1, 0, ...controlsConfigToInsert);\n        return configCopy;\n    }\n    return controlsConfig;\n}\nfunction $b103c63dc979d40c$export$d9fe7d5b8b296e7c(controlsConfig, controlPropMapper) {\n    return controlPropMapper ? controlsConfig.map((control)=>{\n        if (control.children) control = {\n            ...control,\n            children: $b103c63dc979d40c$export$d9fe7d5b8b296e7c(control.children, controlPropMapper)\n        };\n        return {\n            ...control,\n            ...controlPropMapper(control)\n        };\n    }) : controlsConfig;\n}\nfunction $b103c63dc979d40c$export$38c07eba5c3aa11b(configControls) {\n    const defaultValues = {};\n    for (const { control: { key: key, defaultValue: defaultValue } } of $b103c63dc979d40c$export$596571ef134d4065(configControls))if (!(defaultValue instanceof Function)) // @ts-ignore\n    defaultValues[key] = defaultValue;\n    return defaultValues;\n}\nfunction $b103c63dc979d40c$export$ab1c0bf676278196(configControls) {\n    const configIndex = {};\n    for (const { control: control } of $b103c63dc979d40c$export$596571ef134d4065(configControls))configIndex[control.key] = control;\n    return configIndex;\n}\n\n\nconst $9e482fa80a49eb9a$var$COLOR_CONTROLS = [\n    {\n        key: 'isMultiColor',\n        label: 'Use multiple colors',\n        defaultValue: false,\n        type: 'checkbox',\n        affectsNails: false,\n        affectsStepCount: false\n    },\n    {\n        key: 'colorCount',\n        label: 'Colors count',\n        defaultValue: 7,\n        type: 'range',\n        attr: {\n            min: 1,\n            max: 20,\n            step: 1\n        },\n        show: ({ isMultiColor: isMultiColor })=>isMultiColor,\n        affectsNails: false,\n        affectsStepCount: false\n    },\n    {\n        key: 'color',\n        label: 'String color',\n        defaultValue: '#ff4d00',\n        type: 'color',\n        show: ({ isMultiColor: isMultiColor })=>!isMultiColor,\n        affectsNails: false,\n        affectsStepCount: false\n    },\n    {\n        key: 'multicolorStart',\n        label: 'Multicolor start',\n        defaultValue: 1,\n        type: 'hue',\n        attr: {\n            colorthumb: true\n        },\n        show: ({ isMultiColor: isMultiColor })=>isMultiColor,\n        affectsNails: false,\n        affectsStepCount: false\n    },\n    {\n        key: 'multicolorRange',\n        label: 'Multicolor range',\n        defaultValue: 360,\n        type: 'hue',\n        attr: {\n            start: ({ multicolorStart: multicolorStart })=>multicolorStart,\n            type: 'range'\n        },\n        show: ({ isMultiColor: isMultiColor })=>isMultiColor,\n        affectsNails: false,\n        affectsStepCount: false\n    },\n    {\n        key: 'saturation',\n        label: 'Saturation',\n        defaultValue: 100,\n        type: 'range',\n        attr: {\n            min: 0,\n            max: 100,\n            step: 1\n        },\n        show: ({ isMultiColor: isMultiColor })=>isMultiColor,\n        affectsNails: false,\n        affectsStepCount: false\n    },\n    {\n        key: 'lightness',\n        label: 'Lightness',\n        type: 'group',\n        defaultValue: 'minimized',\n        show: ({ isMultiColor: isMultiColor })=>isMultiColor,\n        children: [\n            {\n                key: 'multicolorByLightness',\n                label: 'Multi lightness',\n                defaultValue: false,\n                type: 'checkbox',\n                show: ({ isMultiColor: isMultiColor })=>isMultiColor,\n                affectsNails: false,\n                affectsStepCount: false\n            },\n            {\n                key: 'minLightness',\n                label: 'Minimum lightness',\n                defaultValue: 0,\n                type: 'range',\n                attr: {\n                    min: 0,\n                    max: 100,\n                    step: 1,\n                    snap: '50',\n                    thumbcolor: ({ minLightness: minLightness })=>`hsl(0 0 ${minLightness})`,\n                    background: 'linear-gradient(to right, black, white)'\n                },\n                show: ({ multicolorByLightness: multicolorByLightness, isMultiColor: isMultiColor })=>multicolorByLightness && isMultiColor,\n                affectsNails: false,\n                affectsStepCount: false\n            },\n            {\n                key: 'maxLightness',\n                label: 'Maximum lightness',\n                defaultValue: 100,\n                type: 'range',\n                attr: {\n                    min: 0,\n                    max: 100,\n                    step: 1,\n                    snap: '50',\n                    thumbcolor: ({ maxLightness: maxLightness })=>`hsl(0 0 ${maxLightness})`,\n                    background: 'linear-gradient(to right, black, white)'\n                },\n                show: ({ multicolorByLightness: multicolorByLightness, isMultiColor: isMultiColor })=>multicolorByLightness && isMultiColor,\n                affectsNails: false,\n                affectsStepCount: false\n            }\n        ]\n    },\n    {\n        key: 'colorOrderGroup',\n        type: 'group',\n        label: 'Order',\n        defaultValue: 'minimized',\n        show: ({ isMultiColor: isMultiColor })=>isMultiColor,\n        children: [\n            {\n                key: 'reverseColors',\n                label: 'Reverse colors order',\n                defaultValue: false,\n                type: 'checkbox',\n                show: ({ isMultiColor: isMultiColor })=>isMultiColor,\n                affectsNails: false,\n                affectsStepCount: false\n            },\n            {\n                key: 'repeatColors',\n                label: 'Repeat colors',\n                defaultValue: true,\n                type: 'checkbox',\n                show: ({ isMultiColor: isMultiColor })=>isMultiColor,\n                affectsNails: false,\n                affectsStepCount: false\n            },\n            {\n                key: 'mirrorColors',\n                label: 'Mirror Colors',\n                defaultValue: false,\n                type: 'checkbox',\n                show: ({ isMultiColor: isMultiColor, repeatColors: repeatColors })=>isMultiColor && repeatColors,\n                affectsNails: false,\n                affectsStepCount: false\n            }\n        ]\n    }\n];\nvar $9e482fa80a49eb9a$export$2e2bcd8739ae039 = $9e482fa80a49eb9a$var$COLOR_CONTROLS;\n\n\nclass $44d9dab6555abf73$export$2e2bcd8739ae039 {\n    config;\n    multiColorStep;\n    multiColorLightnessStep;\n    colors;\n    constructor(config){\n        this.config = config;\n        const { multicolorRange: multicolorRange, colorCount: colorCount, multicolorByLightness: multicolorByLightness, minLightness: minLightness = 0, maxLightness: maxLightness = 100, multicolorStart: multicolorStart, darkMode: darkMode, saturation: saturation, reverseColors: reverseColors, repeatColors: repeatColors, mirrorColors: mirrorColors, isMultiColor: isMultiColor } = config;\n        if (isMultiColor) {\n            this.multiColorStep = multicolorRange / Math.max(1, colorCount - 1);\n            this.multiColorLightnessStep = multicolorByLightness ? (maxLightness - minLightness) / (Math.max(colorCount, 2) - 1) : 1;\n            this.colors = new Array(colorCount).fill(null).map((_, colorIndex)=>{\n                const lightness = multicolorByLightness ? minLightness + this.multiColorLightnessStep * colorIndex : darkMode ? 50 : 40;\n                return `hsl(${multicolorStart + colorIndex * this.multiColorStep}, ${saturation}%, ${lightness}%)`;\n            });\n            if (repeatColors && mirrorColors) {\n                const [_firstColor, ...restColors] = this.colors;\n                restColors.pop();\n                this.colors = [\n                    ...this.colors,\n                    ...restColors.reverse()\n                ];\n            }\n            if (reverseColors) this.colors.reverse();\n        }\n    }\n    /**\n   * Returns the color to be used in the provided layer index. If no multiColor is used, will use the 'color' config property.\n   * @param {number} colorIndex\n   * @returns string\n   */ getColor(colorIndex) {\n        const { isMultiColor: isMultiColor, colorCount: colorCount, color: color, repeatColors: repeatColors } = this.config;\n        if (!isMultiColor) return color;\n        if (colorIndex >= colorCount) colorIndex = repeatColors ? colorIndex % this.colors.length : this.colors.length - 1;\n        return this.colors[colorIndex];\n    }\n    /**\n   * Returns the color with the opposite hue to the color at this index\n   */ static getOppositeColor(hslColor) {\n        const hslMatch = hslColor.match(/^hsl\\((\\d+)(?:deg)?(?:,?\\s?)(\\d+%?)(?:,?\\s?)(\\d+%?)\\)$/);\n        if (hslMatch) {\n            const oppositeHue = (Number(hslMatch[1]) + 180) % 360;\n            return `hsl(${oppositeHue}, ${hslMatch[2]}, ${hslMatch[3]})`;\n        }\n        return null;\n    }\n    getColorMap({ stepCount: stepCount, colorCount: colorCount }) {\n        if (!colorCount) throw new Error(\"Can't get color map, no colorCount provided!\");\n        const stepsPerColor = Math.floor(stepCount / colorCount);\n        const colorMap = new Map();\n        for(let i = 0; i < colorCount; i++)colorMap.set(i * stepsPerColor, this.getColor(i));\n        return colorMap;\n    }\n    static getConfig({ include: include, exclude: exclude, defaults: defaults = {}, customControls: customControls, propMapper: propMapper, groupLabel: groupLabel, maxColorCount: maxColorCount }) {\n        const controls = (0, $b103c63dc979d40c$export$d9fe7d5b8b296e7c)(getControls(), propMapper);\n        return {\n            key: 'colorGroup',\n            label: groupLabel ?? 'Color',\n            type: 'group',\n            children: [\n                ...customControls ?? [],\n                ...controls\n            ]\n        };\n        function getControls(controlsConfig) {\n            return (controlsConfig ?? (0, $b103c63dc979d40c$export$68091c7c829a57b8)((0, $9e482fa80a49eb9a$export$2e2bcd8739ae039))).filter(({ key: key })=>(!exclude || !exclude.includes(key)) && (!include || include.includes(key))).map((control)=>{\n                const finalControl = {\n                    ...control,\n                    defaultValue: defaults[control.key] ?? control.defaultValue\n                };\n                if (control.type === 'group') finalControl.children = getControls(control.children);\n                if (control.key === 'colorCount' && maxColorCount) finalControl.attr.max = maxColorCount;\n                return Object.freeze(finalControl);\n            });\n        }\n    }\n}\n\n\n\n\n/**\n * Returns true if the two objects have the same values. Deep compares the objects.\n */ function $c29d66861308df7e$export$f05027632b38f3a4(obj1, obj2, /**\n   * An array of keys to compare. If not specified, all keys are compared.\n   */ props) {\n    if (obj1 === obj2) return true;\n    if (typeof obj1 === 'object' && typeof obj2 === 'object') {\n        if (obj1 === null !== (obj2 === null)) return false;\n        if (obj1 instanceof Array && obj2 instanceof Array) {\n            if (obj1.length !== obj2.length) return false;\n            for(let i = 0; i < obj1.length; i++){\n                if (!$c29d66861308df7e$export$f05027632b38f3a4(obj1[i], obj2[i])) return false;\n            }\n            return true;\n        }\n        if (!props) {\n            props = Object.keys(obj1);\n            if (props.length !== Object.keys(obj2).length) return false;\n        }\n        if (props && props.some((p)=>!$c29d66861308df7e$export$f05027632b38f3a4(obj1[p], obj2[p]))) return false;\n        return true;\n    }\n    return obj1 === obj2;\n}\nfunction $c29d66861308df7e$export$781522908e4e76a1(obj, mapper) {\n    const mappedObj = {};\n    Object.entries(obj).forEach(([key, value])=>mappedObj[mapper(key, value)] = value);\n    return mappedObj;\n}\n\n\nclass $d8b2fd23c47cc34c$export$2e2bcd8739ae039 {\n    options;\n    #nails;\n    constructor(options){\n        this.options = options;\n        this.#nails = new Map();\n    }\n    get length() {\n        return this.#nails.size;\n    }\n    get coordinates() {\n        return this.#nails.values();\n    }\n    addNail(key, coordinates) {\n        if (this.#nails.has(key)) console.warn(`Attempting to add a nail to NailsGroup, with already existing key, [${key}].`);\n        this.#nails.set(key, coordinates);\n    }\n    addGroup(nailsGroup) {\n        throw new Error('Adding sub groups not implemented yet.');\n    }\n    getNailCoordinates(key) {\n        return this.#nails.get(key);\n    }\n    *getUniqueCoordinates(precision = 1000) {\n        const addedCoordinates = new Set();\n        for (const point of this.coordinates){\n            const hash = 1e5 * Math.round(point[0] * precision) + Math.round(point[1] * precision);\n            if (!addedCoordinates.has(hash)) {\n                yield point;\n                addedCoordinates.add(hash);\n            }\n        }\n    }\n    forEach(callback) {\n        this.#nails.forEach((coordinates, number)=>callback(coordinates, number));\n    }\n}\n\n\nclass $a2a2cf72b22d53bf$export$2e2bcd8739ae039 {\n    options;\n    #nailGroups;\n    #defaultNailsGroup;\n    constructor(options){\n        this.options = options;\n        this.#nailGroups = [\n            new (0, $d8b2fd23c47cc34c$export$2e2bcd8739ae039)(options)\n        ];\n        this.#defaultNailsGroup = this.#nailGroups[0];\n    }\n    addNail(key, coordinates) {\n        this.#defaultNailsGroup.addNail(key, coordinates);\n    }\n    addGroup(nailsGroup) {\n        //nails.forEach(nail => this.#addNailToSets(nail));\n        this.#nailGroups.push(nailsGroup);\n    }\n    draw(renderer, { precision: precision } = {}) {\n        let numbersStart = 1;\n        this.#nailGroups.forEach((group)=>{\n            renderer.renderNails(group.getUniqueCoordinates(precision), {\n                ...this.options,\n                ...group.options,\n                numbersStart: numbersStart\n            });\n            numbersStart += group.length;\n        });\n    }\n}\n\n\n\n\nclass $9ee6280c93a20bac$export$5d318302d9efabc7 extends (0, $66d8ae1974721b90$export$2e2bcd8739ae039) {\n    strings = [];\n    nails = [];\n    lineWidth = 1;\n    size = [\n        0,\n        0\n    ];\n    background;\n    constructor(size){\n        super(null, {\n            updateOnResize: false\n        });\n        this.size = size;\n    }\n    resetStrings() {\n        this.strings.length = 0;\n    }\n    resetNails() {\n        this.nails.length = 0;\n    }\n    setLineWidth(width) {\n        this.lineWidth = width;\n    }\n    renderLine(from, to) {\n        this.strings.push([\n            from,\n            to\n        ]);\n    }\n    renderInstructions(from, to) {}\n    clearInstructions() {}\n    lineTo(to) {\n        this.strings.push([\n            [\n                0,\n                0\n            ],\n            to\n        ]);\n    }\n    renderNails(nails, options) {\n        for (let nail of nails)this.nails.push(nail);\n    }\n    clear() {\n        this.resetStrings();\n        this.resetNails();\n    }\n    toDataURL() {\n        return '';\n    }\n    getSize() {\n        return this.size;\n    }\n    setSize(size) {\n        return this.size = size;\n    }\n    setBackground(color) {\n        this.background = color;\n    }\n    showInstructions() {}\n    hideInstructions() {}\n}\n\n\nconst $fa5e071b86283164$var$DEFAULT_NAIL_RADIUS = 1.5;\nclass $fa5e071b86283164$export$f14c78f74247c3d extends (0, $9ee6280c93a20bac$export$5d318302d9efabc7) {\n    #threadsLength = 0;\n    #nailCount = 0;\n    #lastPoint;\n    #currentColor;\n    #threadsLengthPerColor;\n    #nailCoords;\n    #nailThreadLength;\n    constructor(size){\n        super(size);\n        this.#threadsLengthPerColor = new Map();\n        this.#nailCoords = [];\n        this.#nailThreadLength = this.#getNailThreadLength($fa5e071b86283164$var$DEFAULT_NAIL_RADIUS);\n    }\n    get threadsLength() {\n        return {\n            total: Math.round(this.#threadsLength),\n            perColor: Array.from(this.#threadsLengthPerColor.entries()).map(([color, length])=>({\n                    color: color,\n                    length: length\n                }))\n        };\n    }\n    get nailCount() {\n        return this.#nailCount;\n    }\n    resetStrings() {\n        this.#threadsLength = 0;\n        this.#threadsLengthPerColor = new Map();\n    }\n    renderLine(from, to) {\n        const lineLength = (0, $e2b746416d2bf62b$export$27796bb1a51212b7)(from, to) + this.#nailThreadLength;\n        this.#threadsLength += lineLength;\n        this.#threadsLengthPerColor.set(this.#currentColor, this.#threadsLengthPerColor.get(this.#currentColor) + lineLength);\n        this.#lastPoint = to;\n    }\n    resetNails() {\n        this.#nailCount = 0;\n        this.#nailCoords.length = 0;\n    }\n    renderNails(nails, { radius: radius }) {\n        for (let nail of nails){\n            this.#nailCount++;\n            this.#nailCoords.push(nail);\n        }\n        this.#nailThreadLength = this.#getNailThreadLength(radius);\n    }\n    setStartingPoint(coordinates) {\n        this.#lastPoint = coordinates;\n    }\n    setColor(color) {\n        this.#currentColor = color;\n        if (!this.#threadsLengthPerColor.has(color)) this.#threadsLengthPerColor.set(color, 0);\n    }\n    lineTo(to) {\n        if (!this.#lastPoint) throw new Error(\"no last string coordinates, can't lineTo\");\n        this.renderLine(this.#lastPoint, to);\n    }\n    getInfo() {\n        return {\n            nailsCount: this.#nailCount,\n            threadsLength: this.threadsLength,\n            closestDistanceBetweenNails: (0, $e2b746416d2bf62b$export$e2b09acd39c6280)(this.#nailCoords)\n        };\n    }\n    #getNailThreadLength(nailRadius) {\n        // Assuming two rounds around each nail, to be on the safe side when measuring total thread length\n        return (0, $e2b746416d2bf62b$export$f4644083ce95e7e3) * nailRadius * 2;\n    }\n}\n\n\nconst $ed62eab3f3d51c1d$var$COLORS = {\n    dark: '#0e0e0e',\n    light: '#ffffff'\n};\nconst $ed62eab3f3d51c1d$var$COMMON_CONFIG_CONTROLS = [\n    {\n        key: 'strings',\n        label: 'Strings',\n        type: 'group',\n        defaultValue: 'minimized',\n        children: [\n            {\n                key: 'showStrings',\n                label: 'Show strings',\n                defaultValue: true,\n                type: 'checkbox',\n                isDisabled: ({ showNails: showNails })=>!showNails,\n                affectsNails: false\n            },\n            {\n                key: 'stringWidth',\n                label: 'String width',\n                defaultValue: 1,\n                type: 'range',\n                attr: {\n                    min: 0.2,\n                    max: 4,\n                    step: 0.1,\n                    snap: '1'\n                },\n                show: ({ showStrings: showStrings })=>showStrings,\n                affectsNails: false\n            }\n        ]\n    },\n    {\n        key: 'nails',\n        label: 'Nails',\n        type: 'group',\n        defaultValue: 'minimized',\n        children: [\n            {\n                key: 'showNails',\n                label: 'Show nails',\n                defaultValue: true,\n                type: 'checkbox',\n                isDisabled: ({ showStrings: showStrings })=>!showStrings,\n                affectsStrings: false\n            },\n            {\n                key: 'showNailNumbers',\n                label: 'Show nail numbers',\n                defaultValue: false,\n                type: 'checkbox',\n                show: ({ showNails: showNails })=>showNails,\n                affectsStrings: false\n            },\n            {\n                key: 'nailNumbersFontSize',\n                label: 'Nail numbers font size',\n                defaultValue: 10,\n                type: 'range',\n                attr: {\n                    min: 6,\n                    max: 24,\n                    step: 0.5\n                },\n                displayValue: ({ nailNumbersFontSize: nailNumbersFontSize })=>`${nailNumbersFontSize}px`,\n                show: ({ showNails: showNails, showNailNumbers: showNailNumbers })=>showNails && showNailNumbers,\n                affectsStrings: false\n            },\n            {\n                key: 'margin',\n                label: 'Margin',\n                defaultValue: 20,\n                type: 'number',\n                attr: {\n                    min: 0,\n                    max: 500,\n                    step: 1\n                },\n                displayValue: ({ margin: margin })=>`${margin}px`,\n                isStructural: true\n            },\n            {\n                key: 'nailRadius',\n                label: 'Nail size',\n                defaultValue: 1.5,\n                type: 'range',\n                attr: {\n                    min: 0.5,\n                    max: 5,\n                    step: 0.25,\n                    snap: '1.5'\n                },\n                show: ({ showNails: showNails })=>showNails,\n                affectsStrings: false\n            },\n            {\n                key: 'nailsColor',\n                label: 'Nails color',\n                defaultValue: '#ffffff',\n                type: 'color',\n                show: ({ showNails: showNails })=>showNails,\n                affectsStrings: false\n            }\n        ]\n    },\n    {\n        key: 'background',\n        label: 'Background',\n        type: 'group',\n        defaultValue: 'minimized',\n        children: [\n            {\n                key: 'darkMode',\n                label: 'Dark mode',\n                defaultValue: true,\n                type: 'checkbox',\n                affectsNails: false,\n                affectsStrings: false\n            },\n            {\n                key: 'customBackgroundColor',\n                label: 'Custom background color',\n                defaultValue: false,\n                type: 'checkbox',\n                affectsNails: false,\n                affectsStrings: false\n            },\n            {\n                key: 'backgroundColor',\n                label: 'Background color',\n                defaultValue: $ed62eab3f3d51c1d$var$COLORS.dark,\n                type: 'color',\n                show: ({ customBackgroundColor: customBackgroundColor })=>customBackgroundColor,\n                affectsNails: false,\n                affectsStrings: false\n            }\n        ]\n    }\n];\nclass $ed62eab3f3d51c1d$var$StringArt extends (0, $00df09d341073864$export$2e2bcd8739ae039) {\n    controls = [];\n    defaultValues = {};\n    stepCount = null;\n    size = null;\n    position = 0;\n    stringsIterator;\n    id;\n    name;\n    link;\n    linkText;\n    calc;\n    #config;\n    #controlsIndex;\n    #defaultConfig;\n    #controller;\n    constructor(){\n        super();\n    }\n    getNailCount(size) {\n        const renderer = new (0, $fa5e071b86283164$export$f14c78f74247c3d)(size);\n        this.draw(renderer);\n        return renderer.nailCount;\n    }\n    getThreadLengths(size) {\n        const renderer = new (0, $fa5e071b86283164$export$f14c78f74247c3d)(size);\n        this.draw(renderer);\n        return renderer.threadsLength;\n    }\n    thumbnailConfig;\n    /**\n   * Set testStepCountConfig to automatically test that the step count is correct for the given configurations\n   */ testStepCountConfig;\n    static type;\n    getCommonControls() {\n        return $ed62eab3f3d51c1d$var$COMMON_CONFIG_CONTROLS;\n    }\n    get configControls() {\n        return (this.controls ?? []).concat(this.getCommonControls());\n    }\n    get controlsIndex() {\n        if (!this.#controlsIndex) this.#controlsIndex = (0, $b103c63dc979d40c$export$ab1c0bf676278196)(this.configControls);\n        return this.#controlsIndex;\n    }\n    get type() {\n        return this.constructor.type;\n    }\n    /**\n   * A pattern is considered a template if the id is the same as the type. These are built-in patterns.\n   */ get isTemplate() {\n        return this.type === this.id;\n    }\n    get defaultConfig() {\n        if (!this.#defaultConfig) this.#defaultConfig = Object.freeze(Object.assign((0, $b103c63dc979d40c$export$38c07eba5c3aa11b)(this.configControls), this.defaultValues));\n        return this.#defaultConfig;\n    }\n    get config() {\n        return this.#config ?? this.defaultConfig;\n    }\n    set config(value) {\n        this.#config = Object.assign({}, this.defaultConfig, value);\n    }\n    get isDefaultConfig() {\n        return (0, $c29d66861308df7e$export$f05027632b38f3a4)(this.config, this.#defaultConfig);\n    }\n    /**\n   * Marks the current config as default. Useful for saved patterns\n   */ markConfigAsDefault() {\n        this.#defaultConfig = this.config;\n    }\n    resetDefaultConfig() {\n        this.#defaultConfig = null;\n    }\n    /**\n   * Assigns the partial config to the current configuration of the StringArt\n   * @param config\n   */ assignConfig(config) {\n        this.#config = Object.assign({}, this.config, config);\n    }\n    /**\n   * Sets the config of the StringArt and updates using `onConfigChange`\n   * @param config\n   */ setConfig(config) {\n        const currentConfig = this.config;\n        this.config = config;\n        if (this.onConfigChange) {\n            const changedControlKeys = Object.keys(currentConfig).filter((key)=>config[key] !== currentConfig[key]);\n            this.onConfigChange(changedControlKeys.map((key)=>({\n                    control: this.controlsIndex[key],\n                    value: config[key]\n                })));\n        }\n    }\n    /**\n   * Child classes can define this method to clear any structural cache when config values for `isStructural=true` controls change.\n   */ resetStructure() {\n        this.calc = null;\n    }\n    /**\n   * Base method for getCalc\n   * @param options\n   * @returns\n   */ getCalc(options) {\n        return {};\n    }\n    onConfigChange(controls) {\n        if (controls.some(({ control: control })=>control.isStructural)) {\n            this.resetStructure();\n            if (this.stepCount != null && controls.some(({ control: control })=>control.affectsStepCount !== false)) this.stepCount = null;\n        }\n    }\n    onResize() {\n        this.resetStructure();\n    }\n    setConfigValue(controlKey, value) {\n        if (this.#config && this.#config[controlKey] === value) return;\n        this.#config = Object.freeze({\n            ...this.#config ?? this.defaultConfig,\n            [controlKey]: value\n        });\n        if (this.onConfigChange) this.onConfigChange([\n            {\n                control: this.controlsIndex[controlKey],\n                value: value\n            }\n        ].filter(({ control: control })=>!!control));\n    }\n    setUpDraw(options) {\n        if (!this.calc) this.calc = this.getCalc(options);\n    }\n    afterDraw() {\n        this.emit('drawdone', null);\n    }\n    /**\n   * Sets up the pattern for rendering, by:\n   * 1. Clearing strings and nails from the renderer (if required for any of them)\n   * 2. Creates the Nails object\n   * 3. Sets the strings line width\n   * 4. Calls the pattern's `setUpDraw` method.\n   * @param renderer\n   * @param param1\n   */ initDraw(renderer, { redrawNails: redrawNails = true, redrawStrings: redrawStrings = true, sizeChanged: sizeChanged } = {}) {\n        if (sizeChanged) this.resetStructure();\n        if (redrawStrings) renderer.resetStrings();\n        if (redrawNails) renderer.resetNails();\n        renderer.clearInstructions();\n        renderer.setLineWidth(this.config.stringWidth);\n        const size = renderer.getSize();\n        this.setUpDraw({\n            size: size\n        });\n    }\n    draw(renderer, options = {}) {\n        if (!options.enableScheduler) {\n            this.#draw(renderer, options);\n            return ()=>{};\n        }\n        if (this.#controller && !this.#controller.signal.aborted) this.#controller.abort('Redraw');\n        this.#controller = new TaskController({\n            priority: 'background'\n        });\n        scheduler.postTask(()=>this.#draw(renderer, options), {\n            signal: this.#controller.signal\n        }).catch((reason)=>{\n        // The controller was aborted\n        });\n        return ()=>{\n            this.#controller?.abort('Cancelled');\n        };\n    }\n    /**\n   * Draws the string art on the renderer\n   */ #draw(renderer, { position: position, precision: precision, ...drawOptions } = {}) {\n        this.initDraw(renderer, drawOptions);\n        const { showNails: showNails, darkMode: darkMode, backgroundColor: backgroundColor, customBackgroundColor: customBackgroundColor, enableBackground: enableBackground } = this.config;\n        renderer.setBackground(enableBackground !== false ? customBackgroundColor ? backgroundColor : darkMode ? $ed62eab3f3d51c1d$var$COLORS.dark : $ed62eab3f3d51c1d$var$COLORS.light : null);\n        if (showNails && drawOptions.redrawNails !== false) {\n            const nails = new (0, $a2a2cf72b22d53bf$export$2e2bcd8739ae039)({\n                color: this.config.nailsColor,\n                fontSize: this.config.nailNumbersFontSize,\n                radius: this.config.nailRadius,\n                renderNumbers: this.config.showNailNumbers\n            });\n            this.drawNails(nails);\n            nails.draw(renderer, {\n                precision: precision\n            });\n        }\n        if (drawOptions.redrawStrings !== false && this.config.showStrings) {\n            this.stringsIterator = this.drawStrings(renderer);\n            this.position = 0;\n            while(!this.drawNext().done && (position == null || this.position < position));\n        }\n        return ()=>{\n            this.#controller?.abort('Cancelled');\n        };\n    }\n    goto(renderer, position, { showInstructions: showInstructions = true } = {}) {\n        if (position === this.position) return;\n        if (this.stringsIterator && position > this.position) {\n            while(!this.drawNext().done && this.position < position);\n        } else this.draw(renderer, {\n            position: position,\n            redrawNails: false\n        });\n        if (showInstructions) renderer.renderInstructionsForLastLine();\n    }\n    /**\n   *\n   * @returns Advance the strings iterator by one. If the iterator is done, calls this.afterDraw().\n   */ drawNext() {\n        const result = this.stringsIterator.next();\n        if (result.done) this.afterDraw();\n        else this.position++;\n        return result;\n    }\n    copy(overrideConfig) {\n        // @ts-ignore\n        const patternCopy = new this.constructor();\n        patternCopy.config = {\n            ...this.config,\n            overrideConfig: overrideConfig\n        };\n        return patternCopy;\n    }\n}\nvar $ed62eab3f3d51c1d$export$2e2bcd8739ae039 = $ed62eab3f3d51c1d$var$StringArt;\n\n\nconst $6e85582323150d4b$var$easing = {\n    linear: (x)=>x,\n    inOutCirc (x) {\n        return x < 0.5 ? (1 - Math.sqrt(1 - Math.pow(2 * x, 2))) / 2 : (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2;\n    },\n    easeOutQuint (x) {\n        return 1 - Math.pow(1 - x, 5);\n    },\n    easeOutCubic (x) {\n        return 1 - Math.pow(1 - x, 4);\n    },\n    fastSlowFast (t) {\n        // Clamp t to [0,1] just to be safe\n        t = Math.max(0, Math.min(1, t));\n        // Custom easing formula: accelerates, slows in middle, then accelerates again\n        return 0.5 * (1 - Math.cos(Math.PI * t)) ** 1.5;\n    },\n    fastInOutSquare (x) {\n        return x <= 0.5 ? (1 - Math.pow(1 - x * 2, 2)) / 2 : 0.5 + Math.pow(x * 2 - 1, 2) / 2;\n    },\n    fastInOutCubic (x) {\n        return x <= 0.5 ? (1 - Math.pow(1 - x * 2, 3)) / 2 : 0.5 + Math.pow(x * 2 - 1, 3) / 2;\n    },\n    fastInOutQuint (x) {\n        return x <= 0.5 ? (1 - Math.pow(1 - x * 2, 5)) / 2 : 0.5 + Math.pow(x * 2 - 1, 5) / 2;\n    },\n    fastInOut (pow, x) {\n        return x <= 0.5 ? (1 - Math.pow(1 - x * 2, pow)) / 2 : 0.5 + Math.pow(x * 2 - 1, pow) / 2;\n    },\n    fastInOutFixed (pow, fastArea, x) {\n        if (x > fastArea && x < 1 - fastArea) {\n            const y1 = (1 - Math.pow(1 - fastArea * 2, pow)) / 2;\n            const y2 = 0.5 + Math.pow((1 - fastArea) * 2 - 1, pow) / 2;\n            return y1 + (x - fastArea) * (y2 - y1) / (1 - 2 * fastArea);\n        }\n        return x <= fastArea ? (1 - Math.pow(1 - x * 2, pow)) / 2 : 0.5 + Math.pow(x * 2 - 1, pow) / 2;\n    },\n    easeOutFixed (pow, fixedAreaSize, x) {\n        const fixedAreaStart = 1 - fixedAreaSize;\n        if (x < fixedAreaStart || fixedAreaSize === 0) return 1 - Math.pow(1 - x, pow);\n        const fixedAreaResultStart = 1 - Math.pow(1 - fixedAreaStart, pow);\n        return fixedAreaResultStart + (1 - fixedAreaResultStart) * (x - fixedAreaStart) / fixedAreaSize;\n    }\n};\n// @ts-ignore\n$6e85582323150d4b$var$easing.fastInOut.requirePower = true;\n// @ts-ignore\n$6e85582323150d4b$var$easing.fastInOutFixed.requirePower = true;\n// @ts-ignore\n$6e85582323150d4b$var$easing.fastInOutFixed.requireFastArea = true;\n// @ts-ignore\n$6e85582323150d4b$var$easing.easeOutFixed.requirePower = true;\n// @ts-ignore\n$6e85582323150d4b$var$easing.easeOutFixed.requireFastArea = true;\nvar $6e85582323150d4b$export$2e2bcd8739ae039 = $6e85582323150d4b$var$easing;\n\n\n\n\n\n\n\nfunction $96d8651f67c6b219$export$f481ea230fad194b(value) {\n    return `${Math.round(value * 100)}%`;\n}\nfunction $96d8651f67c6b219$export$b5632b5e53e50dc(value) {\n    return `${Math.round((value ?? 0) * 360)}\\xb0`;\n}\nfunction $96d8651f67c6b219$export$9a00dee1beb8f576(value) {\n    return value[0].toLocaleUpperCase() + value.slice(1);\n}\n\n\nfunction $c190f550efa69733$export$7f1ebd623f131021(size, mapper) {\n    return new Array(size).fill(null).map((_, i)=>mapper(i));\n}\n\n\nclass $cf574edfbef72605$export$2e2bcd8739ae039 {\n    config;\n    #points;\n    #calc;\n    constructor(config){\n        this.setConfig(config);\n    }\n    setConfig(config) {\n        if (!(0, $c29d66861308df7e$export$f05027632b38f3a4)(config, this.config)) {\n            this.config = config;\n            if (this.#points) this.#points.clear();\n            else this.#points = new Map();\n            this.#calc = this.#getCalc();\n            if (config.fitSize) {\n                const sizeAndCenter = this.#getSizeAndCenter();\n                this.#points.clear();\n                this.#calc = {\n                    ...this.#getCalc(),\n                    ...sizeAndCenter\n                };\n            }\n        }\n    }\n    #getSizeAndCenter() {\n        const { size: configSize, margin: margin } = this.config;\n        const boundingRect = this.getBoundingRect();\n        const scale = Math.min((configSize[0] - 2 * margin) / boundingRect.width, (configSize[1] - 2 * margin) / boundingRect.height);\n        const size = configSize.map((v)=>v * scale);\n        const center = [\n            this.#calc.center[0] - scale * (boundingRect.left - configSize[0] + boundingRect.right) / 2,\n            this.#calc.center[1] - scale * (boundingRect.top - configSize[1] + boundingRect.bottom) / 2\n        ];\n        return {\n            size: size,\n            center: center\n        };\n    }\n    #getCalc() {\n        const { size: size, rotation: rotation = 0, sides: sideCount, center: configCenter, margin: margin = 0, nailsPerSide: nailsPerSide, radiusNailsCountSameAsSides: radiusNailsCountSameAsSides = false, radius: radiusConfig } = this.config;\n        const sideAngle = (0, $e2b746416d2bf62b$export$f4644083ce95e7e3) / sideCount;\n        const sides = (0, $c190f550efa69733$export$7f1ebd623f131021)(sideCount, (i)=>{\n            const angle = sideAngle * i + (0, $e2b746416d2bf62b$export$f4644083ce95e7e3) * rotation;\n            const radiusAngle = -sideAngle * (i - 0.5) - (0, $e2b746416d2bf62b$export$f4644083ce95e7e3) * rotation;\n            return {\n                cos: Math.cos(angle),\n                sin: Math.sin(angle),\n                center: {\n                    cos: Math.cos(radiusAngle),\n                    sin: Math.sin(radiusAngle)\n                }\n            };\n        });\n        const center = configCenter ?? (0, $b683a3137b30eaa9$export$c91255cadecfe081)(size);\n        const radius = radiusConfig ?? Math.min(...size) / 2 - margin;\n        const sideSize = 2 * radius * Math.sin(sideAngle / 2);\n        const start = [\n            radius * Math.sin(sideAngle / 2),\n            radius * Math.cos(sideAngle / 2)\n        ];\n        const nailsDistance = sideSize / (nailsPerSide - 1);\n        const radiusNailsCount = radiusNailsCountSameAsSides ? nailsPerSide : Math.max(2, Math.floor(radius / nailsDistance));\n        const radiusNailsDistance = radius / (radiusNailsCount - 1);\n        return {\n            center: center,\n            radius: radius,\n            sideSize: sideSize,\n            start: start,\n            nailsDistance: nailsDistance,\n            radiusNailsCount: radiusNailsCount,\n            radiusNailsDistance: radiusNailsDistance,\n            sides: sides,\n            sideAngle: sideAngle\n        };\n    }\n    get radiusNailsCount() {\n        return this.#calc.radiusNailsCount;\n    }\n    get sideSize() {\n        return this.#calc.sideSize;\n    }\n    getPoint(index) {\n        const { nailsPerSide: nailsPerSide } = this.config;\n        const position = index / nailsPerSide;\n        const side = Math.floor(position);\n        const sideIndex = index % nailsPerSide;\n        return this.getSidePoint({\n            side: side,\n            index: sideIndex\n        });\n    }\n    getSidePoint({ side: side, index: index }) {\n        const pointsMapIndex = [\n            side,\n            index\n        ].join('_');\n        if (this.#points.has(pointsMapIndex)) return this.#points.get(pointsMapIndex);\n        const startX = this.#calc.start[0] - index * this.#calc.nailsDistance;\n        const { cos: cos, sin: sin } = this.#calc.sides[side];\n        const point = [\n            cos * startX - sin * this.#calc.start[1] + this.#calc.center[0],\n            sin * startX + cos * this.#calc.start[1] + this.#calc.center[1]\n        ];\n        this.#points.set(pointsMapIndex, point);\n        return point;\n    }\n    getCenterPoint({ side: side, index: index }) {\n        if (index < 0) throw new Error(`Can't get polygon center point for index = (${index}).`);\n        if (side < 0) throw new Error(`Can't get polygon center point for side = (${index}).`);\n        const radius = index * this.#calc.radiusNailsDistance;\n        const { sin: sin, cos: cos } = this.#calc.sides[side].center;\n        return [\n            this.#calc.center[0] + sin * radius,\n            this.#calc.center[1] + cos * radius\n        ];\n    }\n    getBoundingRect() {\n        const points = (0, $c190f550efa69733$export$7f1ebd623f131021)(this.config.sides, (side)=>this.getSidePoint({\n                side: side,\n                index: 0\n            }));\n        const firstPoint = points[0];\n        const boundingRect = points.slice(1).reduce((boundingRect, [x, y])=>({\n                left: Math.min(boundingRect.left, x),\n                right: Math.max(boundingRect.right, x),\n                top: Math.min(boundingRect.top, y),\n                bottom: Math.max(boundingRect.bottom, y)\n            }), {\n            left: firstPoint[0],\n            right: firstPoint[0],\n            top: firstPoint[1],\n            bottom: firstPoint[1]\n        });\n        return {\n            ...boundingRect,\n            height: boundingRect.bottom - boundingRect.top,\n            width: boundingRect.right - boundingRect.left\n        };\n    }\n    getAspectRatio() {\n        return (0, $b683a3137b30eaa9$export$d2646d47608819e2)(this.getBoundingRect());\n    }\n    drawNails(nails, { drawCenter: drawCenter = false, drawSides: drawSides = true, drawCenterNail: drawCenterNail = true, getUniqueKey: getUniqueKey } = {}) {\n        const { nailsPerSide: nailsPerSide } = this.config;\n        let nailIndex = 0;\n        if (drawCenter && drawCenterNail) {\n            nails.addNail(nailIndex, this.getCenterPoint({\n                side: 0,\n                index: 0\n            }));\n            nailIndex++;\n        }\n        for(let side = 0; side < this.config.sides; side++){\n            if (drawSides) for(let index = 0; index < nailsPerSide - 1; index++){\n                nails.addNail(getUniqueKey?.(nailIndex) ?? nailIndex, this.getSidePoint({\n                    side: side,\n                    index: index\n                }));\n                nailIndex++;\n            }\n            if (drawCenter) for(let index = 1; index < this.#calc.radiusNailsCount - 1; index++){\n                nails.addNail(getUniqueKey?.(nailIndex) ?? nailIndex, this.getCenterPoint({\n                    side: side,\n                    index: index\n                }));\n                nailIndex++;\n            }\n        }\n    }\n    getNailsCount({ drawCenter: drawCenter = false, drawSides: drawSides = true, drawCenterNail: drawCenterNail = true } = {}) {\n        const nailsPerSide = (drawSides ? this.config.nailsPerSide - 1 : 0) + (drawCenter ? this.#calc.radiusNailsCount - 2 : 0);\n        return this.config.sides * nailsPerSide + (drawCenter && drawCenterNail ? 1 : 0);\n    }\n    static rotationConfig = {\n        key: 'rotation',\n        label: 'Rotation',\n        defaultValue: 0,\n        type: 'range',\n        attr: {\n            min: 0,\n            max: 1,\n            step: 0.02\n        },\n        displayValue: ({ rotation: rotation, sides: sides })=>(0, $96d8651f67c6b219$export$b5632b5e53e50dc)(rotation / (2 * sides)),\n        isStructural: true,\n        affectsStepCount: false\n    };\n}\n\n\n\n\nclass $06de6887437e6fa7$export$2e2bcd8739ae039 {\n    points;\n    easingFunction;\n    config;\n    center;\n    xyRadius;\n    rotationAngle = 0;\n    indexAngle;\n    isReverse = false;\n    radius;\n    arc = (0, $e2b746416d2bf62b$export$f4644083ce95e7e3);\n    isPartialArc = false;\n    excludedNailIndexes;\n    constructor(config){\n        this.setConfig(config);\n    }\n    getPoint(index) {\n        const realIndex = this.#getNailIndex(index);\n        if (this.points.has(index)) return this.points.get(index);\n        const angle = this.easingFunction(realIndex / (this.config.n - (this.isPartialArc ? 1 : 0))) * this.arc + this.rotationAngle + (this.config.angleStart ?? 0);\n        const point = [\n            this.center[0] + Math.sin(angle) * this.xyRadius[0],\n            this.center[1] + Math.cos(angle) * this.xyRadius[1]\n        ];\n        this.points.set(index, point);\n        return point;\n    }\n    #getNailIndex(index = 0) {\n        return (this.isReverse ? this.config.n - 1 - index : index) % this.config.n;\n    }\n    getAspectRatio() {\n        if (!this.config.distortion) return 1;\n        const aspectRatio = (0, $e2b746416d2bf62b$export$643b64bfca4574ff)(this.config.distortion);\n        return aspectRatio[0] / aspectRatio[1];\n    }\n    /**\n   * The bounding rect of the Circle is not just [diameter, diameter], because a 3 nail circle is a triangle, for example,\n   * in which case the bounding rect won't take that fill rect. Using a Polygon instead, which is more precise.\n   */ getBoundingRect() {\n        const { n: n, rotation: rotation } = this.config;\n        if (n < 16) {\n            const polygon = new (0, $cf574edfbef72605$export$2e2bcd8739ae039)({\n                sides: n,\n                rotation: rotation,\n                size: [\n                    this.radius * 2,\n                    this.radius * 2\n                ],\n                nailsPerSide: 1,\n                center: this.center\n            });\n            return polygon.getBoundingRect();\n        }\n        return {\n            top: this.center[1] - this.xyRadius[1],\n            left: this.center[0] - this.xyRadius[0],\n            right: this.center[0] + this.xyRadius[0],\n            bottom: this.center[1] + this.xyRadius[1],\n            width: this.xyRadius[0] * 2,\n            height: this.xyRadius[1] * 2\n        };\n    }\n    setConfig(config) {\n        if (!(0, $c29d66861308df7e$export$f05027632b38f3a4)(config, this.config)) {\n            const { n: n, size: size, margin: margin = 0, rotation: rotation = 0, center: configCenter, radius: radius, reverse: reverse = false, angleStart: angleStart, angleEnd: angleEnd } = config;\n            const center = configCenter ?? (0, $b683a3137b30eaa9$export$c91255cadecfe081)(size);\n            const clampedRadius = Math.max(1, (radius ?? Math.min(...(0, $b683a3137b30eaa9$export$c91255cadecfe081)(size))) - margin);\n            let xyRadius = [\n                clampedRadius,\n                clampedRadius\n            ];\n            if (config.distortion) {\n                const aspectRatio = (0, $e2b746416d2bf62b$export$643b64bfca4574ff)(config.distortion);\n                const distortedBox = aspectRatio.map((v)=>clampedRadius * v);\n                xyRadius = (0, $b683a3137b30eaa9$export$18c295d7a6a8189d)(distortedBox, size.map((v)=>Math.max(0, v / 2 - margin)));\n            }\n            // Normally, the whole circle is rendered, but if angleStart and angleEnd are configured and valid, and arc between them is rendered:\n            this.isPartialArc = angleStart && angleEnd && angleEnd > angleStart;\n            const arc = this.isPartialArc ? angleEnd - angleStart : (0, $e2b746416d2bf62b$export$f4644083ce95e7e3);\n            const props = {\n                center: center,\n                radius: clampedRadius,\n                xyRadius: xyRadius,\n                indexAngle: arc / (this.isPartialArc ? n - 1 : n),\n                rotationAngle: -(0, $e2b746416d2bf62b$export$f4644083ce95e7e3) * rotation,\n                isReverse: reverse,\n                arc: arc\n            };\n            const easingFunction = config.displacementFunc ? (0, $6e85582323150d4b$export$2e2bcd8739ae039)[config.displacementFunc] : (0, $6e85582323150d4b$export$2e2bcd8739ae039).linear;\n            const easingParams = [];\n            // @ts-ignore\n            if (easingFunction.requirePower) easingParams.push(config.displacementMag);\n            // @ts-ignore\n            if (easingFunction.requireFastArea) easingParams.push(config.displacementFastArea);\n            const easingFunctionWithParams = easingParams.length ? easingFunction.bind(null, ...easingParams) : easingFunction;\n            this.easingFunction = easingFunctionWithParams;\n            this.config = config;\n            Object.assign(this, props);\n            if (this.points) this.points.clear();\n            else this.points = new Map();\n        }\n    }\n    /**\n   * Given a Nails instance, uses it to draw the nails of this Circle\n   * @param {Nails} nails\n   * @param {{nailsNumberStart?: number, getNumber?: Function}} param1\n   */ drawNails(nails, { excludedNailRanges: excludedNailRanges, getUniqueKey: getUniqueKey } = {}) {\n        const { n: n } = this.config;\n        let excludedNailIndexes;\n        if (excludedNailRanges) {\n            excludedNailIndexes = new Set();\n            excludedNailRanges.forEach(([start, end])=>{\n                const max = Math.min(end, n);\n                for(let i = Math.max(0, start); i <= max; i++)excludedNailIndexes.add(i);\n            });\n        }\n        for(let i = 0; i < this.config.n; i++)if (!excludedNailIndexes?.has(i)) nails.addNail(getUniqueKey?.(i) ?? i, this.getPoint(i));\n    }\n    *drawRing(renderer, { ringSize: ringSize, color: color }) {\n        const { n: n } = this.config;\n        const ringDistance = Math.floor(ringSize * n);\n        let prevPoint;\n        let prevPointIndex = 0;\n        let isPrevSide = false;\n        if (color) renderer.setColor(color);\n        for(let i = 0; i < n; i++){\n            if (!prevPoint) prevPoint = this.getPoint(0);\n            const startPoint = prevPoint;\n            const positions = [];\n            prevPointIndex = isPrevSide ? i : prevPointIndex + ringDistance;\n            prevPoint = this.getPoint(prevPointIndex);\n            positions.push(prevPoint);\n            renderer.renderLine(startPoint, prevPoint);\n            yield;\n            if (i < n - 1) {\n                prevPointIndex++;\n                const nextPoint = this.getPoint(prevPointIndex);\n                renderer.renderLine(prevPoint, nextPoint);\n                yield;\n                prevPoint = nextPoint;\n                positions.push(prevPoint);\n            }\n            isPrevSide = !isPrevSide;\n        }\n    }\n    getRingStepCount() {\n        return this.config.n * 2 - 1;\n    }\n    static rotationConfig = {\n        key: 'rotation',\n        label: 'Rotation',\n        defaultValue: 0,\n        type: 'range',\n        attr: {\n            min: 0,\n            max: 1 + 1 / 360,\n            step: 1 / 360,\n            snap: '0.25, 0.5, 0.75'\n        },\n        displayValue: ({ rotation: rotation })=>(0, $96d8651f67c6b219$export$b5632b5e53e50dc)(rotation),\n        isStructural: true,\n        affectsStepCount: false\n    };\n    static nailsConfig = Object.freeze({\n        key: 'n',\n        label: 'Number of nails',\n        defaultValue: 144,\n        type: 'range',\n        attr: {\n            min: 3,\n            max: 300,\n            step: 1\n        },\n        isStructural: true\n    });\n    static displacementConfig = {\n        key: 'displacement',\n        label: 'Displacement',\n        type: 'group',\n        children: [\n            {\n                key: 'displacementFunc',\n                label: 'Displacement function',\n                defaultValue: 'linear',\n                type: 'select',\n                options: Object.keys((0, $6e85582323150d4b$export$2e2bcd8739ae039)),\n                isStructural: true,\n                affectsStepCount: false\n            },\n            {\n                key: 'displacementMag',\n                label: 'Displacement magnitude',\n                defaultValue: 3,\n                type: 'range',\n                attr: {\n                    min: 0,\n                    max: 10,\n                    step: 0.1\n                },\n                // @ts-ignore\n                show: ({ displacementFunc: displacementFunc })=>(0, $6e85582323150d4b$export$2e2bcd8739ae039)[displacementFunc].requirePower,\n                isStructural: true,\n                affectsStepCount: false\n            },\n            {\n                key: 'displacementFastArea',\n                label: 'Displacement fast area',\n                defaultValue: 0.4,\n                type: 'range',\n                attr: {\n                    min: 0,\n                    max: 0.5,\n                    step: 0.01\n                },\n                show: ({ displacementFunc: displacementFunc })=>// @ts-ignore\n                    (0, $6e85582323150d4b$export$2e2bcd8739ae039)[displacementFunc].requireFastArea,\n                isStructural: true,\n                affectsStepCount: false\n            }\n        ]\n    };\n    static distortionConfig = {\n        key: 'distortion',\n        label: 'Distortion',\n        defaultValue: 0,\n        type: 'range',\n        attr: {\n            min: -0.99,\n            max: 0.99,\n            step: 0.01,\n            snap: '0'\n        },\n        isStructural: true,\n        affectsStepCount: false\n    };\n}\n\n\n\nconst $44064e6908c034c2$var$COLOR_CONFIG = (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n    defaults: {\n        isMultiColor: true,\n        colorCount: 7,\n        color: '#ffbb29',\n        multicolorRange: 21,\n        multicolorStart: 32,\n        multicolorByLightness: true,\n        minLightness: 36,\n        maxLightness: 98\n    }\n});\nclass $44064e6908c034c2$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'spiral';\n    id = 'spiral';\n    name = 'Spiral';\n    link = 'https://www.etsy.com/il-en/listing/840974781/boho-wall-decor-artwork-spiral-round';\n    controls = [\n        {\n            ...(0, $06de6887437e6fa7$export$2e2bcd8739ae039).nailsConfig,\n            defaultValue: 200\n        },\n        {\n            key: 'repetition',\n            label: 'Repetition',\n            defaultValue: 5,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 20,\n                step: 1\n            },\n            affectsNails: false,\n            isStructural: true\n        },\n        {\n            key: 'innerLength',\n            label: 'Spiral thickness',\n            defaultValue: 0.5,\n            type: 'range',\n            attr: {\n                min: ({ n: n })=>1 / n,\n                max: 1,\n                step: ({ n: n })=>1 / n\n            },\n            displayValue: ({ n: n, innerLength: innerLength })=>Math.round(n * innerLength),\n            affectsNails: false\n        },\n        {\n            ...(0, $b103c63dc979d40c$export$2d97e2da46663803)((0, $06de6887437e6fa7$export$2e2bcd8739ae039).rotationConfig, 'snap'),\n            defaultValue: 0.75\n        },\n        (0, $06de6887437e6fa7$export$2e2bcd8739ae039).distortionConfig,\n        $44064e6908c034c2$var$COLOR_CONFIG\n    ];\n    #color;\n    #colorMap;\n    getCalc({ size: size }) {\n        const { n: n, rotation: rotation, margin: margin, repetition: repetition, distortion: distortion } = this.config;\n        const circleConfig = {\n            size: size,\n            n: n,\n            margin: margin,\n            rotation: rotation,\n            distortion: distortion\n        };\n        return {\n            circle: new (0, $06de6887437e6fa7$export$2e2bcd8739ae039)(circleConfig),\n            realRepetition: repetition * 2 - 1\n        };\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        const { colorCount: colorCount } = this.config;\n        this.#color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)({\n            ...this.config,\n            colorCount: colorCount\n        });\n        if (colorCount) this.#colorMap = this.#color.getColorMap({\n            stepCount: this.getStepCount(),\n            colorCount: colorCount\n        });\n    }\n    getAspectRatio(options) {\n        const { circle: circle } = this.getCalc(options);\n        return circle.getAspectRatio();\n    }\n    *drawSpiral(renderer, { shift: shift = 0, color: color = '#ffffff' } = {}) {\n        const { innerLength: innerLength, n: n } = this.config;\n        let currentInnerLength = Math.round(innerLength * n);\n        let repetitionCount = 0;\n        renderer.setColor(color);\n        let prevPointIndex = shift;\n        let prevPoint = this.calc.circle.getPoint(prevPointIndex);\n        let isPrevPoint = false;\n        for(let i = 0; currentInnerLength > 0; i++){\n            if (this.#colorMap) {\n                const stepColor = this.#colorMap.get(i);\n                if (stepColor) renderer.setColor(stepColor);\n            }\n            prevPointIndex = isPrevPoint ? prevPointIndex - currentInnerLength + 1 : prevPointIndex + currentInnerLength;\n            if (repetitionCount === this.calc.realRepetition) {\n                currentInnerLength--;\n                repetitionCount = 0;\n                prevPointIndex++;\n            } else repetitionCount++;\n            const nextPoint = this.calc.circle.getPoint(prevPointIndex);\n            renderer.renderLine(prevPoint, nextPoint);\n            prevPoint = nextPoint;\n            yield;\n            isPrevPoint = !isPrevPoint;\n        }\n    }\n    *drawStrings(renderer) {\n        yield* this.drawSpiral(renderer, {\n            color: this.#color.getColor(0)\n        });\n    }\n    getStepCount() {\n        const { innerLength: innerLength, repetition: repetition, n: n } = this.config;\n        return Math.round(n * (innerLength * 2) * repetition);\n    }\n    drawNails(nails) {\n        this.calc.circle.drawNails(nails);\n    }\n    thumbnailConfig = ({ n: n })=>({\n            n: Math.min(n, 60)\n        });\n}\n\n\n\n\n\n\n\n\n\n\nclass $63660c6a2fc9a003$var$Spirals extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'spirals';\n    name = 'Spirals';\n    id = 'spirals';\n    link = 'https://www.etsy.com/il-en/listing/974865185/3d-string-art-spiral-mandala-wall?ref=shop_home_active_10&frs=1';\n    controls = [\n        {\n            key: 'nSpirals',\n            label: 'Number of spirals',\n            defaultValue: 3,\n            type: 'range',\n            attr: {\n                min: 2,\n                max: 20,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'nailsPerSpiral',\n            label: 'Nails per spiral',\n            type: 'range',\n            defaultValue: 80,\n            attr: {\n                min: 3,\n                max: 300,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'angle',\n            label: 'Angle',\n            type: 'range',\n            defaultValue: 0.52,\n            attr: {\n                min: 0,\n                max: 2,\n                step: 0.026\n            },\n            displayValue: ({ angle: angle })=>(0, $96d8651f67c6b219$export$b5632b5e53e50dc)(angle),\n            isStructural: true,\n            affectsStepCount: false\n        },\n        {\n            key: 'radiusEasing',\n            label: 'Radius easing',\n            defaultValue: 1.8,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 10,\n                step: 0.1\n            },\n            isStructural: true,\n            affectsStepCount: false\n        },\n        {\n            key: 'angleEasing',\n            label: 'Angle easing',\n            defaultValue: 1.3,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 10,\n                step: 0.1\n            },\n            isStructural: true,\n            affectsStepCount: false\n        },\n        {\n            ...(0, $06de6887437e6fa7$export$2e2bcd8739ae039).rotationConfig,\n            defaultValue: 65 / 360\n        },\n        (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n            defaults: {\n                isMultiColor: true,\n                colorCount: 4,\n                color: '#00d5ff',\n                multicolorRange: 1,\n                multicolorStart: 190,\n                multicolorByLightness: true,\n                minLightness: 50,\n                maxLightness: 88,\n                reverseColors: true\n            }\n        })\n    ];\n    color;\n    colorMap;\n    getCalc({ size: size }) {\n        const { nSpirals: nSpirals, rotation: rotation, margin: margin, angle: angle } = this.config;\n        const maxRadius = Math.min(...size) / 2 - margin;\n        return {\n            spiralRotations: (0, $c190f550efa69733$export$7f1ebd623f131021)(nSpirals, (i)=>i * (0, $e2b746416d2bf62b$export$f4644083ce95e7e3) / nSpirals),\n            rotationAngle: -(0, $e2b746416d2bf62b$export$f4644083ce95e7e3) * rotation,\n            angle: angle * (0, $e2b746416d2bf62b$export$f4644083ce95e7e3),\n            center: (0, $b683a3137b30eaa9$export$c91255cadecfe081)(size),\n            radius: maxRadius\n        };\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        const { colorCount: colorCount } = this.config;\n        this.color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)(this.config);\n        this.colorMap = this.color.getColorMap({\n            stepCount: this.getStepCount(),\n            colorCount: colorCount\n        });\n    }\n    /**\n   * TODO: The aspect ratio isn't really 1, but it's hard to calculate. Will tackle it in the future\n   */ getAspectRatio() {\n        return 1;\n    }\n    *generatePoints() {\n        const { nSpirals: nSpirals, nailsPerSpiral: nailsPerSpiral } = this.config;\n        for(let i = 1; i < nailsPerSpiral; i++)for(let s = 0; s < nSpirals; s++)yield this.getPoint(s, i);\n    }\n    getPoint(spiralIndex, index) {\n        const { center: center, radius: maxRadius, angle: totalAngle } = this.calc;\n        const { nailsPerSpiral: nailsPerSpiral, radiusEasing: radiusEasing, angleEasing: angleEasing } = this.config;\n        const position = index / (nailsPerSpiral - 1);\n        const angle = this.calc.rotationAngle + (0, $6e85582323150d4b$export$2e2bcd8739ae039).easeOutFixed(angleEasing, 0, position) * totalAngle + this.calc.spiralRotations[spiralIndex];\n        const radius = (0, $6e85582323150d4b$export$2e2bcd8739ae039).easeOutFixed(radiusEasing, 0, position) * maxRadius;\n        return [\n            center[0] + radius * Math.sin(angle),\n            center[1] + radius * Math.cos(angle)\n        ];\n    }\n    *drawStrings(renderer) {\n        const points = this.generatePoints();\n        let index = 0;\n        renderer.setColor(this.color.getColor(0));\n        renderer.setStartingPoint(this.calc.center);\n        for (const point of points){\n            if (this.colorMap) {\n                const stepColor = this.colorMap.get(index);\n                if (stepColor) renderer.setColor(stepColor);\n            }\n            renderer.lineTo(point);\n            yield;\n            index++;\n        }\n    }\n    getStepCount() {\n        const { nSpirals: nSpirals, nailsPerSpiral: nailsPerSpiral } = this.config;\n        return (nailsPerSpiral - 1) * nSpirals;\n    }\n    drawNails(nails) {\n        const points = this.generatePoints();\n        let i = 0;\n        for (const point of points){\n            nails.addNail(i, point);\n            i++;\n        }\n    }\n    getNailCount() {\n        const { nSpirals: nSpirals, nailsPerSpiral: nailsPerSpiral } = this.config;\n        return nSpirals * (nailsPerSpiral - 1);\n    }\n    thumbnailConfig = ({ nailsPerSpiral: nailsPerSpiral })=>({\n            nailsPerSpiral: Math.min(30, nailsPerSpiral)\n        });\n}\nvar $63660c6a2fc9a003$export$2e2bcd8739ae039 = $63660c6a2fc9a003$var$Spirals;\n\n\n\n\n\n\n\nclass $ad2ceb60c48a58dd$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'mandala';\n    name = 'Mandala';\n    id = 'mandala';\n    link = 'https://www.youtube.com/watch?v=qhbuKbxJsk8';\n    linkText = 'Learn';\n    controls = [\n        {\n            key: 'n',\n            label: 'Number of nails',\n            defaultValue: 180,\n            type: 'range',\n            attr: {\n                min: 3,\n                max: 240,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'base',\n            label: 'Multiplication',\n            defaultValue: 2,\n            type: 'range',\n            attr: {\n                min: 2,\n                max: 99,\n                step: 1\n            },\n            affectsNails: false\n        },\n        {\n            key: 'layers',\n            label: 'Layers',\n            defaultValue: 7,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 20,\n                step: 1\n            },\n            isStructural: true\n        },\n        (0, $06de6887437e6fa7$export$2e2bcd8739ae039).rotationConfig,\n        (0, $06de6887437e6fa7$export$2e2bcd8739ae039).distortionConfig,\n        (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n            defaults: {\n                isMultiColor: true,\n                multicolorRange: 165,\n                multicolorStart: 256,\n                color: '#ff4d00'\n            },\n            exclude: [\n                'colorCount'\n            ]\n        })\n    ];\n    color;\n    get n() {\n        return this.calc.n;\n    }\n    getCalc({ size: size }) {\n        const { n: nConfig, layers: layers, layerFill: layerFill, rotation: rotation, distortion: distortion, margin: margin, reverse: reverse } = this.config;\n        const extraNails = nConfig % layers;\n        const n = nConfig - extraNails; // The number of nails should be a multiple of the layers, so the strings are exactly on the nails.\n        const circleConfig = {\n            size: size,\n            n: n,\n            margin: margin,\n            rotation: rotation,\n            distortion: distortion,\n            reverse: reverse\n        };\n        return {\n            n: n,\n            stringsPerLayer: layerFill ? Math.floor(n * layerFill) : n,\n            layerShift: Math.floor(n / layers),\n            circle: new (0, $06de6887437e6fa7$export$2e2bcd8739ae039)(circleConfig)\n        };\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        const { layers: layers } = this.config;\n        this.color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)({\n            ...this.config,\n            colorCount: layers\n        });\n    }\n    getAspectRatio(options) {\n        const calc = this.getCalc(options);\n        return calc.circle.getAspectRatio();\n    }\n    *drawLayer(renderer, layerIndex) {\n        const { reverse: reverse, base: base } = this.config;\n        const { n: n, layerShift: layerShift, stringsPerLayer: stringsPerLayer } = this.calc;\n        const shift = layerShift * layerIndex * (reverse ? 1 : -1);\n        const color = this.color.getColor(layerIndex);\n        renderer.setColor(color);\n        let point = this.calc.circle.getPoint(shift);\n        for(let i = 1; i <= stringsPerLayer; i++){\n            const startPoint = point;\n            point = this.calc.circle.getPoint(i + shift);\n            const toIndex = i * base % n;\n            renderer.renderLine(startPoint, point);\n            yield;\n            renderer.renderLine(point, this.calc.circle.getPoint(toIndex + shift));\n            yield;\n        }\n    }\n    *drawStrings(renderer) {\n        const { layers: layers } = this.config;\n        for(let layer = 0; layer < layers; layer++)yield* this.drawLayer(renderer, layer);\n    }\n    drawNails(nails) {\n        this.calc.circle.drawNails(nails);\n    }\n    getStepCount(options) {\n        const { layers: layers, layerFill: layerFill } = this.config;\n        const { n: n } = this.getCalc(options);\n        const stringsPerLayer = layerFill ? Math.floor(n * layerFill) : n;\n        return (layers ?? 1) * stringsPerLayer * 2;\n    }\n    getNailCount() {\n        const { n: nConfig, layers: layers } = this.config;\n        const extraNails = nConfig % layers;\n        return nConfig - extraNails;\n    }\n    // @ts-ignore\n    thumbnailConfig = ({ n: n })=>({\n            n: Math.min(n, 70)\n        });\n}\n\n\n\n\nclass $33e9badd1f194d7c$export$2e2bcd8739ae039 extends (0, $ad2ceb60c48a58dd$export$2e2bcd8739ae039) {\n    static type = 'wave';\n    id = 'wave';\n    name = 'Wave';\n    link = 'https://www.etsy.com/il-en/listing/943140543/personalized-gift-string-art-mandala?ref=sim_rv-5&pro=1';\n    controls = [\n        {\n            ...(0, $06de6887437e6fa7$export$2e2bcd8739ae039).nailsConfig,\n            defaultValue: 200\n        },\n        {\n            key: 'layerFill',\n            label: 'Layer fill',\n            defaultValue: 0.5,\n            type: 'range',\n            attr: {\n                min: ({ n: n })=>1 / n,\n                max: 1,\n                step: ({ n: n })=>1 / n\n            },\n            displayValue: ({ layerFill: layerFill })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(layerFill),\n            affectsNails: false,\n            isStructural: true\n        },\n        (0, $b103c63dc979d40c$export$2d97e2da46663803)((0, $06de6887437e6fa7$export$2e2bcd8739ae039).rotationConfig, 'snap'),\n        (0, $06de6887437e6fa7$export$2e2bcd8739ae039).distortionConfig,\n        {\n            key: 'layers',\n            label: 'Layers',\n            defaultValue: 11,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 20,\n                step: 1\n            }\n        },\n        {\n            key: 'layerSpread',\n            label: 'Layer spread',\n            defaultValue: 0.075,\n            type: 'range',\n            attr: {\n                min: 0,\n                max: 1,\n                step: ({ n: n })=>1 / n\n            },\n            displayValue: ({ layerSpread: layerSpread, n: n })=>Math.round(layerSpread * n),\n            affectsNails: false,\n            isStructural: true\n        },\n        {\n            key: 'reverse',\n            label: 'Reverse',\n            defaultValue: true,\n            type: 'checkbox',\n            isStructural: true\n        },\n        (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n            defaults: {\n                isMultiColor: true,\n                multicolorRange: 196,\n                multicolorStart: 273,\n                color: '#ffffff',\n                multicolorByLightness: true,\n                minLightness: 10,\n                maxLightness: 90\n            },\n            exclude: [\n                'colorCount'\n            ]\n        })\n    ];\n    defaultValues = {\n        base: 2,\n        rotation: 176 / 360\n    };\n    getCalc(options) {\n        const { n: n, layerSpread: layerSpread } = this.config;\n        return {\n            ...super.getCalc(options),\n            layerShift: Math.round(n * layerSpread)\n        };\n    }\n    *drawStrings(renderer) {\n        const { layers: layers } = this.config;\n        for(let layer = 0; layer < layers; layer++)yield* this.drawLayer(renderer, layer);\n    }\n}\n\n\n\n\n\n\nconst $aa2c32cdcace5ae2$var$SIDES = [\n    'left',\n    'bottom',\n    'right',\n    'top'\n];\nconst $aa2c32cdcace5ae2$var$SIDES_ORDER = [\n    'left',\n    'bottom',\n    'right',\n    'top'\n];\nconst $aa2c32cdcace5ae2$var$SIDES_ROTATION = {\n    left: 0,\n    bottom: Math.PI / 2,\n    right: Math.PI,\n    top: Math.PI * 1.5\n};\nclass $aa2c32cdcace5ae2$var$Eye extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'eye';\n    name = 'Eye';\n    id = 'eye';\n    link = 'https://www.etsy.com/listing/489853161/rose-of-space-string-art-sacred-geometry?ga_order=most_relevant&ga_search_type=all&ga_view_type=gallery&ga_search_query=string+art&ref=sr_gallery_1&epik=dj0yJnU9WXNpM1BDTnNkLVBtcWdCa3AxN1J5QUZRY1FlbkJ5Z18mcD0wJm49ZXdJb2JXZmVpNVVwN1NKQ3lXMy10ZyZ0PUFBQUFBR0ZuUzZv';\n    controls = [\n        {\n            key: 'n',\n            label: 'Number of nails per side',\n            defaultValue: 82,\n            type: 'range',\n            attr: {\n                min: 2,\n                max: 200,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'layers',\n            label: 'Layers',\n            defaultValue: 13,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 20,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'angle',\n            label: 'Layer angle',\n            defaultValue: 30,\n            displayValue: ({ angle: angle })=>`${angle}\\xb0`,\n            type: 'range',\n            attr: {\n                min: 0,\n                max: 45,\n                step: 1\n            },\n            isStructural: true\n        },\n        (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n            defaults: {\n                isMultiColor: true,\n                color: '#ffffff',\n                multicolorRange: 107,\n                multicolorStart: 226,\n                multicolorByLightness: false,\n                minLightness: 40,\n                maxLightness: 50,\n                colorCount: 2\n            },\n            customControls: [\n                {\n                    key: 'colorPerLayer',\n                    label: 'Color per layer',\n                    defaultValue: false,\n                    type: 'checkbox',\n                    show: ({ isMultiColor: isMultiColor })=>isMultiColor,\n                    affectsNails: false\n                }\n            ],\n            exclude: [\n                'colorCount',\n                'repeatColors'\n            ]\n        })\n    ];\n    defaultValues = {\n        nailsColor: '#000000'\n    };\n    color;\n    getCalc({ size: size }) {\n        const { n: n, angle: angle, layers: layers, margin: margin } = this.config;\n        const center = (0, $b683a3137b30eaa9$export$c91255cadecfe081)(size);\n        const maxSize = Math.min(...size) - 2 * margin;\n        const nailSpacing = maxSize / (n - 1);\n        const layerAngle = angle * Math.PI / 180;\n        const getLayerProps = (layerIndex)=>{\n            const layerSize = maxSize / Math.pow(Math.cos(layerAngle) + Math.sin(layerAngle), layerIndex);\n            const layerStart = [\n                center[0] - layerSize / 2,\n                center[1] - layerSize / 2\n            ];\n            const layerSideNailCount = Math.floor(layerSize / nailSpacing);\n            return {\n                layerAngle: layerAngle * layerIndex,\n                layerSize: layerSize,\n                layerStart: layerStart,\n                layerSideNailCount: layerSideNailCount\n            };\n        };\n        return {\n            maxSize: maxSize,\n            nailSpacing: nailSpacing,\n            layerAngle: layerAngle,\n            layers: (0, $c190f550efa69733$export$7f1ebd623f131021)(layers, (layerIndex)=>getLayerProps(layerIndex)),\n            center: center\n        };\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        this.color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)({\n            ...this.config,\n            repeatColors: true,\n            colorCount: 2\n        });\n    }\n    getAspectRatio() {\n        return 1;\n    }\n    // Sides: top, right, bottom, left\n    getPoint({ index: index, angle: angle, layerStart: layerStart, rotation: rotation }) {\n        const theta = angle + rotation;\n        const point = [\n            layerStart[0],\n            layerStart[1] + this.calc.nailSpacing * index\n        ];\n        const pivot = this.calc.center;\n        const cosAngle = Math.cos(theta);\n        const sinAngle = Math.sin(theta);\n        return [\n            cosAngle * (point[0] - pivot[0]) - sinAngle * (point[1] - pivot[1]) + pivot[0],\n            sinAngle * (point[0] - pivot[0]) + cosAngle * (point[1] - pivot[1]) + pivot[1]\n        ];\n    }\n    *drawSide(renderer, { side: side, color: color = '#ffffff', angle: angle, size: size, layerStart: layerStart, layerSideNailCount: layerSideNailCount }) {\n        const sideIndex = $aa2c32cdcace5ae2$var$SIDES.indexOf(side);\n        const nextSide = $aa2c32cdcace5ae2$var$SIDES[sideIndex === $aa2c32cdcace5ae2$var$SIDES.length - 1 ? 0 : sideIndex + 1];\n        const rotation = $aa2c32cdcace5ae2$var$SIDES_ROTATION[side];\n        const nextSideRotation = $aa2c32cdcace5ae2$var$SIDES_ROTATION[nextSide];\n        const sideProps = {\n            layerSideNailCount: layerSideNailCount,\n            size: size,\n            layerStart: layerStart,\n            angle: angle\n        };\n        renderer.setColor(color);\n        for(let i = 0; i <= layerSideNailCount; i++){\n            renderer.renderLine(this.getPoint({\n                index: i,\n                rotation: rotation,\n                ...sideProps\n            }), this.getPoint({\n                index: i,\n                rotation: nextSideRotation,\n                ...sideProps\n            }));\n            yield;\n        }\n    }\n    *drawLayer(renderer, layerIndex) {\n        const { colorPerLayer: colorPerLayer } = this.config;\n        const { layerAngle: layerAngle, layerSize: layerSize, layerStart: layerStart, layerSideNailCount: layerSideNailCount } = this.calc.layers[layerIndex];\n        for(let i = 0; i < $aa2c32cdcace5ae2$var$SIDES.length; i++)yield* this.drawSide(renderer, {\n            color: this.color.getColor(colorPerLayer ? layerIndex : i),\n            side: $aa2c32cdcace5ae2$var$SIDES_ORDER[i],\n            angle: layerAngle,\n            size: layerSize,\n            layerStart: layerStart,\n            layerSideNailCount: layerSideNailCount\n        });\n    }\n    *drawStrings(renderer) {\n        const { layers: layers } = this.config;\n        for(let layer = layers - 1; layer >= 0; layer--)yield* this.drawLayer(renderer, layer);\n    }\n    getStepCount({ size: size }) {\n        let count = 0;\n        const { layers: layers, angle: angle, n: n, margin: margin } = this.config;\n        const layerAngle = angle * Math.PI / 180;\n        const maxSize = Math.min(...size) - 2 * margin;\n        const nailSpacing = maxSize / (n - 1);\n        for(let layer = 0; layer < layers; layer++){\n            const layerSize = maxSize / Math.pow(Math.cos(layerAngle) + Math.sin(layerAngle), layer);\n            count += 4 * (Math.floor(layerSize / nailSpacing) + 1);\n        }\n        return count;\n    }\n    // getNailCount(size: Dimensions): number {\n    //   return this.#getNailCount(this.calc ?? this.getCalc({ size }));\n    // }\n    // #getNailCount({ layers }: TCalc): number {\n    //   return layers.reduce(\n    //     (nailCount: number, layer) =>\n    //       nailCount + (layer.layerSideNailCount + 1) * SIDES.length,\n    //     0\n    //   );\n    // }\n    drawNails(nails) {\n        const { layers: layers } = this.config;\n        let nailIndex = 0;\n        for(let layer = layers - 1; layer >= 0; layer--){\n            const { layerAngle: angle, layerSize: size, layerStart: layerStart, layerSideNailCount: layerSideNailCount } = this.calc.layers[layer];\n            for(let s = 0; s < $aa2c32cdcace5ae2$var$SIDES.length; s++){\n                const sideOrder = $aa2c32cdcace5ae2$var$SIDES_ORDER[s];\n                const rotation = $aa2c32cdcace5ae2$var$SIDES_ROTATION[sideOrder];\n                for(let i = 0; i <= layerSideNailCount; i++){\n                    const sideProps = {\n                        layerSideNailCount: layerSideNailCount,\n                        size: size,\n                        layerStart: layerStart,\n                        angle: angle\n                    };\n                    nails.addNail(this.#getPointKey(layer, s, i), this.getPoint({\n                        index: i,\n                        rotation: rotation,\n                        ...sideProps\n                    }));\n                    nailIndex++;\n                }\n            }\n        }\n    }\n    #getPointKey(layer, side, index) {\n        return `${layer}_${side}_${index}`;\n    }\n    thumbnailConfig = ({ n: n, layers: layers })=>({\n            n: Math.min(n, 25),\n            layers: Math.min(layers, 7)\n        });\n}\nvar $aa2c32cdcace5ae2$export$2e2bcd8739ae039 = $aa2c32cdcace5ae2$var$Eye;\n\n\n\n\n\n\n\n\n\nclass $a643183efb8a0ce0$export$2e2bcd8739ae039 {\n    config;\n    center;\n    calc;\n    constructor(config){\n        this.setConfig(config);\n    }\n    static getCalc({ radius: radius, sides: sides, sideNails: sideNails, rotation: rotation, centerRadius: centerRadiusFraction = 0, maxCurveSize: maxCurveSize = 1, sidesCenterRadiusShift: sidesCenterRadiusShift }) {\n        const centerRadius = radius * centerRadiusFraction;\n        const nailSpacing = (radius - centerRadius) / (sideNails - 1); // The distance between nails on the same side, in px\n        const sidesAngle = Math.PI * 2 / sides; // The angle, in radians, between each side\n        const rotationAngle = rotation ? -Math.PI * 2 * rotation / sides : 0;\n        return {\n            sideAngle: sidesAngle,\n            nailSpacing: nailSpacing,\n            centerRadius: centerRadius,\n            linesPerRound: sides % 2 ? sides * 2 : sides,\n            sidesConnectionCount: Math.floor(Math.min(1, maxCurveSize) * sideNails),\n            sideSize: radius - centerRadius,\n            sides: new Array(sides).fill(null).map((_, side)=>{\n                const sideAngle = side * sidesAngle + rotationAngle;\n                return {\n                    sinSideAngle: Math.sin(sideAngle),\n                    cosSideAngle: Math.cos(sideAngle)\n                };\n            }),\n            sidesCenterRadius: sidesCenterRadiusShift ? sidesCenterRadiusShift.map((v)=>centerRadius * v) : null\n        };\n    }\n    getPoint(index) {\n        const position = index / this.config.sideNails;\n        const side = Math.floor(position);\n        const sideIndex = index % this.config.sideNails;\n        return this.getSidePoint(side, sideIndex);\n    }\n    getSidePoint(side = 0, index = 0) {\n        const radius = this.calc.centerRadius + index * this.calc.nailSpacing - (this.calc.sidesCenterRadius?.[side] ?? 0);\n        const { sinSideAngle: sinSideAngle, cosSideAngle: cosSideAngle } = this.calc.sides[side];\n        return [\n            this.center[0] + sinSideAngle * radius,\n            this.center[1] + cosSideAngle * radius\n        ];\n    }\n    setConfig(config) {\n        if ((0, $c29d66861308df7e$export$f05027632b38f3a4)(config, this.config, [\n            'radius',\n            'sides',\n            'sideNails',\n            'rotation',\n            'center',\n            'size',\n            'centerRadius',\n            'maxCurveSize'\n        ])) return;\n        if (!config.center && !config.size) throw new Error('StarShape requires a config value for either center or size.');\n        const center = config.center ?? (0, $b683a3137b30eaa9$export$c91255cadecfe081)(config.size);\n        this.config = config;\n        this.center = center;\n        this.calc = $a643183efb8a0ce0$export$2e2bcd8739ae039.getCalc(config);\n    }\n    /**\n   * Given a Nails instance, uses it to draw the nails of this Circle\n   */ drawNails(nails, { reverseOrder: reverseOrder, getUniqueKey: getUniqueKey } = {}) {\n        const { sides: sides, sideNails: sideNails, centerRadius: centerRadius } = this.config;\n        const renderCenterNail = centerRadius == null || centerRadius === 0;\n        let nailIndex = 0;\n        if (renderCenterNail) {\n            nails.addNail(getUniqueKey?.(nailIndex) ?? nailIndex, this.getSidePoint(0, 0));\n            nailIndex++;\n        }\n        for(let side = 0; side < sides; side++)for(let i = renderCenterNail ? 1 : 0; i < sideNails; i++){\n            const sideIndex = reverseOrder ? sideNails - i : i;\n            nails.addNail(getUniqueKey?.(nailIndex) ?? nailIndex, this.getSidePoint(side, sideIndex));\n            nailIndex++;\n        }\n    }\n    getNailCount() {\n        const { sides: sides, sideNails: sideNails, centerRadius: centerRadius } = this.config;\n        const renderCenterNail = centerRadius == null || centerRadius === 0;\n        return sides * sideNails - (renderCenterNail ? sides - 1 : 0);\n    }\n    // In this pattern, strings are connected in a \"merry-go-round\" way, around the star.\n    // With even sides count, the strings go around the star once, while with odd sides count, each round goes twice around the star.\n    // The threading is: star at the center (or centerRadius, if > 0), then next side at the edge (outtermost nail) or the size param which represents the count of nails to use,\n    // then back to the center for the next side,   // until all sides have been connected both center and edge (for odd-side-count stars) or until all sides have been\n    // connected (for odd-side-count), then move up one nail from the center and start another round.\n    *drawStrings(renderer, { size: size } = {}) {\n        const { sideNails: sideNailsConfig, sides: sides } = this.config;\n        const { sidesConnectionCount: sidesConnectionCount, linesPerRound: linesPerRound } = this.calc;\n        const sideNails = size ? Math.max(1, Math.min(Math.floor(size), sideNailsConfig)) : sideNailsConfig;\n        const minNailIndex = Math.max(0, sideNails - sidesConnectionCount);\n        let alternate = false;\n        const rounds = sides % 2 ? Math.ceil(Math.min(sideNails, sidesConnectionCount) / 2) : sideNails - minNailIndex;\n        let prevPointIndex = minNailIndex;\n        let prevPoint = this.getSidePoint(0, prevPointIndex);\n        for(let round = 0; round < rounds; round++){\n            const isLastRound = round === rounds - 1;\n            let side = 0;\n            for(let i = 0; i < linesPerRound; i++){\n                side = (side + 1) % sides;\n                alternate = !alternate;\n                prevPointIndex = alternate ? sideNails - round - 1 : round + minNailIndex;\n                const nextPoint = this.getSidePoint(side, prevPointIndex);\n                renderer.renderLine(prevPoint, nextPoint);\n                prevPoint = nextPoint;\n                yield;\n                if (isLastRound && i === sides - 1 && sides % 2 && sideNails % 2) break;\n            }\n            if (!isLastRound) {\n                prevPointIndex = alternate ? prevPointIndex - 1 : prevPointIndex + 1;\n                const nextPoint = this.getSidePoint(0, prevPointIndex);\n                renderer.renderLine(prevPoint, nextPoint);\n                prevPoint = nextPoint;\n            }\n        }\n    }\n    getStepCount(size) {\n        return $a643183efb8a0ce0$export$2e2bcd8739ae039.getStepCount(this.config, {\n            size: size\n        });\n    }\n    static getStepCount({ sides: sides, sideNails: sideNailsConfig, maxCurveSize: maxCurveSize = 1 }, { size: size } = {}) {\n        const sidesConnectionCount = Math.floor(Math.min(1, maxCurveSize) * sideNailsConfig);\n        const sideNails = size ? Math.min(Math.floor(size), sideNailsConfig) : sideNailsConfig;\n        const minNailIndex = Math.max(0, sideNails - sidesConnectionCount);\n        const rounds = sides % 2 ? Math.ceil(Math.min(sideNails, sidesConnectionCount) / 2) : sideNails - minNailIndex;\n        const linesPerRound = sides % 2 ? sides * 2 : sides;\n        const isOdd = sides % 2 && sideNails % 2;\n        return rounds * linesPerRound - (isOdd ? sides : 0);\n    }\n    getBoundingRect() {\n        const { radius: radius, sides: sides, rotation: rotation, sideNails: sideNails } = this.config;\n        const polygon = new (0, $cf574edfbef72605$export$2e2bcd8739ae039)({\n            size: [\n                radius * 2,\n                radius * 2\n            ],\n            sides: sides,\n            nailsPerSide: sideNails,\n            margin: 0,\n            rotation: rotation\n        });\n        return polygon.getBoundingRect();\n    }\n    getAspectRatio() {\n        return (0, $b683a3137b30eaa9$export$d2646d47608819e2)(this.getBoundingRect());\n    }\n    static nailsConfig = Object.freeze({\n        key: 'sideNails',\n        label: 'Nails per side',\n        defaultValue: 40,\n        type: 'range',\n        attr: {\n            min: 1,\n            max: 200,\n            step: 1\n        },\n        isStructural: true\n    });\n    static sidesConfig = Object.freeze({\n        key: 'sides',\n        label: 'Sides',\n        defaultValue: 3,\n        type: 'range',\n        attr: {\n            min: 3,\n            max: 40,\n            step: 1\n        },\n        isStructural: true\n    });\n    static maxCurveSize = {\n        key: 'maxCurveSize',\n        label: 'Max curve size',\n        description: 'The maximum number of connections used to create a curve between two sides.',\n        defaultValue: 1,\n        type: 'range',\n        displayValue: ({ maxCurveSize: maxCurveSize, sideNails: sideNails })=>Math.floor(maxCurveSize * sideNails),\n        attr: {\n            min: 0,\n            max: 1,\n            step: ({ sideNails: sideNails })=>1 / sideNails\n        },\n        isStructural: true\n    };\n    static centerRadiusConfig = {\n        key: 'centerRadius',\n        label: 'Center radius',\n        defaultValue: 0,\n        type: 'range',\n        attr: {\n            min: 0,\n            max: ({ sideNails: sideNails })=>(sideNails - 1) / sideNails,\n            step: 0.01\n        },\n        displayValue: ({ centerRadius: centerRadius })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(centerRadius),\n        isStructural: true\n    };\n    static rotationConfig = {\n        key: 'rotation',\n        label: 'Rotation',\n        defaultValue: 0,\n        type: 'range',\n        attr: {\n            min: 0,\n            max: 1,\n            step: 0.01,\n            snap: '0.5'\n        },\n        displayValue: ({ rotation: rotation, sides: sides })=>(0, $96d8651f67c6b219$export$b5632b5e53e50dc)(rotation / sides),\n        isStructural: true,\n        affectsStepCount: false\n    };\n    static StarConfig = [\n        $a643183efb8a0ce0$export$2e2bcd8739ae039.nailsConfig,\n        $a643183efb8a0ce0$export$2e2bcd8739ae039.sidesConfig,\n        $a643183efb8a0ce0$export$2e2bcd8739ae039.centerRadiusConfig,\n        $a643183efb8a0ce0$export$2e2bcd8739ae039.maxCurveSize,\n        $a643183efb8a0ce0$export$2e2bcd8739ae039.rotationConfig\n    ];\n}\n\n\n\nclass $ca4a2eb6736370e4$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'star';\n    name = 'Star';\n    id = 'star';\n    link = 'https://www.etsy.com/listing/557818258/string-art-meditation-geometric-yoga?epik=dj0yJnU9Mm1hYmZKdks1eTc3bVY2TkVhS2p2Qlg0N2dyVWJxaTEmcD0wJm49MGlWSXE1SVJ2Vm0xZ0xtaGhITDBWQSZ0PUFBQUFBR0Zwd2lj';\n    controls = [\n        {\n            key: 'sides',\n            label: 'Sides',\n            defaultValue: 3,\n            type: 'range',\n            attr: {\n                min: 3,\n                max: 20,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'sideNails',\n            label: 'Nails per side',\n            defaultValue: 40,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 200,\n                step: 1\n            },\n            isStructural: true\n        },\n        (0, $a643183efb8a0ce0$export$2e2bcd8739ae039).centerRadiusConfig,\n        {\n            key: 'ringSize',\n            label: 'Outer ring size',\n            defaultValue: 0.1,\n            type: 'range',\n            attr: {\n                min: 0,\n                max: 0.5,\n                step: ({ sideNails: sideNails, sides: sides })=>1 / (sideNails * sides)\n            },\n            displayValue: ({ sideNails: sideNails, sides: sides, ringSize: ringSize })=>Math.floor(ringSize * sideNails * sides),\n            affectsNails: false\n        },\n        (0, $b103c63dc979d40c$export$2d97e2da46663803)((0, $06de6887437e6fa7$export$2e2bcd8739ae039).rotationConfig, 'snap'),\n        (0, $06de6887437e6fa7$export$2e2bcd8739ae039).distortionConfig,\n        {\n            key: 'renderStar',\n            label: 'Show star',\n            type: 'checkbox',\n            defaultValue: true,\n            affectsNails: false,\n            isStructural: true\n        },\n        {\n            key: 'colorGroup',\n            label: 'Color',\n            type: 'group',\n            children: [\n                {\n                    key: 'isSingleColor',\n                    label: 'Is single color',\n                    type: 'checkbox',\n                    defaultValue: false,\n                    affectsNails: false,\n                    affectsStepCount: false\n                },\n                {\n                    key: 'singleColor',\n                    label: 'Color',\n                    defaultValue: '#2ec0ff',\n                    type: 'color',\n                    affectsNails: false,\n                    affectsStepCount: false,\n                    show: ({ isSingleColor: isSingleColor })=>isSingleColor\n                },\n                {\n                    key: 'innerColor',\n                    label: 'Star color',\n                    defaultValue: '#2ec0ff',\n                    type: 'color',\n                    affectsNails: false,\n                    affectsStepCount: false,\n                    show: ({ isSingleColor: isSingleColor, renderStar: renderStar })=>!isSingleColor && renderStar\n                },\n                {\n                    key: 'outerColor',\n                    label: 'Outter color',\n                    defaultValue: '#2a82c6',\n                    type: 'color',\n                    affectsNails: false,\n                    affectsStepCount: false,\n                    show: ({ isSingleColor: isSingleColor })=>!isSingleColor\n                },\n                {\n                    key: 'ringColor',\n                    label: 'Ring color',\n                    defaultValue: '#2ec0ff',\n                    type: 'color',\n                    affectsNails: false,\n                    affectsStepCount: false,\n                    show: ({ isSingleColor: isSingleColor })=>!isSingleColor\n                }\n            ]\n        }\n    ];\n    getCalc({ size: size }) {\n        const { sides: sides, rotation: rotation, distortion: distortion, sideNails: sideNails, margin: margin = 0 } = this.config;\n        const circleConfig = {\n            size: size,\n            n: sides * (sideNails - 1),\n            margin: margin,\n            rotation: rotation ? rotation / sides : 0,\n            distortion: distortion\n        };\n        const circle = new (0, $06de6887437e6fa7$export$2e2bcd8739ae039)(circleConfig);\n        const starConfig = {\n            ...this.config,\n            radius: circle.radius,\n            size: size\n        };\n        return {\n            circle: circle,\n            star: new (0, $a643183efb8a0ce0$export$2e2bcd8739ae039)(starConfig)\n        };\n    }\n    getAspectRatio(options) {\n        const { circle: circle, star: star } = this.getCalc(options);\n        const circleRect = circle.getBoundingRect();\n        const starRect = star.getBoundingRect();\n        const width = Math.max(circleRect.width, starRect.width);\n        const height = Math.max(circleRect.height, starRect.height);\n        return width / height;\n    }\n    getArcPoint({ side: side, sideIndex: sideIndex }) {\n        return this.calc.circle.getPoint(side * (this.config.sideNails - 1) + sideIndex);\n    }\n    *drawStar(renderer) {\n        const { innerColor: innerColor, isSingleColor: isSingleColor } = this.config;\n        if (!isSingleColor) renderer.setColor(innerColor);\n        yield* this.calc.star.drawStrings(renderer);\n    }\n    *drawCircle(renderer) {\n        const { outerColor: outerColor, sides: sides, sideNails: sideNails, isSingleColor: isSingleColor } = this.config;\n        const { star: star } = this.calc;\n        if (!isSingleColor) renderer.setColor(outerColor);\n        let alternate = false;\n        let isStar = false;\n        const rounds = sides % 2 ? Math.ceil(sideNails / 2) : sideNails - 1;\n        let side = 0;\n        const linesPerRound = sides % 2 ? sides * 4 : sides * 2;\n        renderer.setStartingPoint(star.getSidePoint(0, 0));\n        for(let round = 0; round < rounds; round++){\n            const isLastRound = round === rounds - 1;\n            const linesThisRound = sides % 2 && (round === 0 || isLastRound && sideNails % 2) ? linesPerRound - 2 * sides : linesPerRound;\n            for(let i = 0; i < linesThisRound; i++){\n                const pointPosition = {\n                    side: side,\n                    sideIndex: alternate ? sideNails - round - 1 : round\n                };\n                const nextPoint = isStar ? star.getSidePoint(pointPosition.side, pointPosition.sideIndex) : this.getArcPoint(pointPosition);\n                renderer.lineTo(nextPoint);\n                yield;\n                isStar = !isStar;\n                if (isStar) {\n                    side = (side + 1) % sides;\n                    alternate = !alternate;\n                }\n            }\n            if (!isLastRound) {\n                renderer.lineTo(star.getSidePoint(0, round + 1));\n                yield;\n                isStar = false;\n                alternate = false;\n            }\n        }\n        renderer.endLayer();\n    }\n    *drawStrings(renderer) {\n        const { ringSize: ringSize, ringColor: ringColor, isSingleColor: isSingleColor, singleColor: singleColor, renderStar: renderStar = true } = this.config;\n        if (isSingleColor) renderer.setColor(singleColor);\n        yield* this.drawCircle(renderer);\n        if (ringSize !== 0) yield* this.calc.circle.drawRing(renderer, {\n            ringSize: ringSize,\n            color: isSingleColor ? null : ringColor\n        });\n        if (renderStar) yield* this.drawStar(renderer);\n    }\n    drawNails(nails) {\n        this.calc.circle.drawNails(nails);\n        this.calc.star.drawNails(nails, {\n            getUniqueKey: (k)=>this.calc.circle.config.n + k\n        });\n    }\n    getStepCount(options) {\n        const { ringSize: ringSize, sides: sides, sideNails: sideNails, renderStar: renderStar } = this.config;\n        const calc = this.getCalc(options);\n        const ringCount = ringSize ? calc.circle.getRingStepCount() : 0;\n        const circleRounds = sides % 2 ? Math.ceil(sideNails / 2) : sideNails - 1;\n        const circleLinesPerRound = sides % 2 ? sides * 4 : sides * 2;\n        const circleStepsToRemove = sides % 2 ? sides * 2 + (sideNails % 2 ? sides * 2 : 0) : 0;\n        const circleCount = circleRounds * (circleLinesPerRound + 1) - circleStepsToRemove - 1;\n        const starCount = renderStar ? (0, $a643183efb8a0ce0$export$2e2bcd8739ae039).getStepCount(this.config) : 0;\n        return circleCount + ringCount + starCount;\n    }\n    getNailCount() {\n        const { sides: sides, sideNails: sideNails, centerRadius: centerRadius } = this.config;\n        const circleNails = sides * (sideNails - 1);\n        return sides * (sideNails - 1) + circleNails - (centerRadius ? 0 : sides - 1);\n    }\n    thumbnailConfig = ({ sideNails: sideNails })=>({\n            sideNails: Math.min(sideNails, 18)\n        });\n    testStepCountConfig = [\n        {\n            sides: 3,\n            sideNails: 4,\n            ringSize: 0,\n            renderStar: false\n        },\n        {\n            sides: 3,\n            sideNails: 11,\n            ringSize: 0,\n            renderStar: false\n        },\n        {\n            sides: 4,\n            sideNails: 11,\n            ringSize: 0,\n            renderStar: false\n        },\n        {\n            sides: 4,\n            sideNails: 10,\n            ringSize: 0,\n            renderStar: false\n        }\n    ];\n}\n\n\n\n\n\nconst $8db9d587e082a0d9$var$LAYER_DEFAULTS = [\n    {\n        size: 0.25,\n        end: 1,\n        color: '#a94fb0'\n    },\n    {\n        size: 0.125,\n        end: 0.888,\n        color: '#ec6ad0'\n    },\n    {\n        size: 0,\n        end: 0.826,\n        color: '#f08ad5',\n        reverse: true\n    }\n];\nclass $8db9d587e082a0d9$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'assymetry';\n    name = 'Assymetry';\n    id = 'assymetry';\n    link = 'https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for';\n    controls = [\n        (0, $06de6887437e6fa7$export$2e2bcd8739ae039).nailsConfig,\n        (0, $06de6887437e6fa7$export$2e2bcd8739ae039).rotationConfig,\n        (0, $06de6887437e6fa7$export$2e2bcd8739ae039).distortionConfig,\n        {\n            key: 'layers',\n            label: 'Layers',\n            type: 'group',\n            // @ts-expect-error: dynamic key is safe because we know the keys match Layers\n            children: $8db9d587e082a0d9$var$LAYER_DEFAULTS.map(({ size: size, end: end, color: color, reverse: reverse }, i)=>{\n                const layer = i + 1;\n                return {\n                    key: `layer${layer}`,\n                    label: `Layer ${layer}`,\n                    type: 'group',\n                    children: [\n                        {\n                            key: `show${layer}`,\n                            label: 'Enable',\n                            defaultValue: true,\n                            type: 'checkbox',\n                            isStructural: true\n                        },\n                        {\n                            key: `size${layer}`,\n                            label: 'Size',\n                            defaultValue: size,\n                            type: 'range',\n                            attr: {\n                                min: 0,\n                                max: 0.5,\n                                step: ({ n: n })=>1 / n\n                            },\n                            displayValue: (config)=>Math.round(config.n * config[`size${layer}`]),\n                            show: (config)=>config[`show${layer}`],\n                            isStructural: true\n                        },\n                        {\n                            key: `end${layer}`,\n                            label: 'End Position',\n                            defaultValue: end,\n                            type: 'range',\n                            attr: {\n                                min: 0,\n                                max: 1,\n                                step: ({ n: n })=>1 / n\n                            },\n                            displayValue: (config)=>Math.round(config.n * config[`end${layer}`]),\n                            show: (config)=>config[`show${layer}`],\n                            affectsNails: false,\n                            isStructural: true\n                        },\n                        {\n                            key: `color${layer}`,\n                            label: 'Color',\n                            defaultValue: color,\n                            type: 'color',\n                            show: (config)=>config[`show${layer}`],\n                            affectsNails: false,\n                            isStructural: true\n                        },\n                        {\n                            key: `reverse${layer}`,\n                            label: 'Reverse',\n                            defaultValue: reverse === true,\n                            type: 'checkbox',\n                            show: (config)=>config[`show${layer}`],\n                            affectsNails: false,\n                            isStructural: true\n                        }\n                    ]\n                };\n            })\n        }\n    ];\n    getAspectRatio() {\n        const calc = this.calc ?? this.getCalc({\n            size: [\n                100,\n                100\n            ]\n        });\n        return calc.circle.getAspectRatio();\n    }\n    getCalc({ size: size }) {\n        const { rotation: rotation, n: n, margin: margin = 0, distortion: distortion } = this.config;\n        const circleConfig = {\n            size: size,\n            n: n,\n            margin: margin,\n            rotation: rotation - 0.25,\n            distortion: distortion\n        };\n        const circle = new (0, $06de6887437e6fa7$export$2e2bcd8739ae039)(circleConfig);\n        const circleDistanceBetweenPoints = (0, $e2b746416d2bf62b$export$f4644083ce95e7e3) * circle.radius / n;\n        const lineSize = circle.radius;\n        const lineNailCount = Math.round(lineSize / circleDistanceBetweenPoints);\n        const lineSpacing = lineSize / lineNailCount;\n        const firstCirclePoint = circle.getPoint(0);\n        const totalNailCount = lineNailCount + n;\n        const totalIndexCount = totalNailCount + lineNailCount;\n        const layers = new Array(3).fill(null).map((_, i)=>getLayer.call(this, i + 1)).filter(({ enable: enable })=>enable);\n        return {\n            circle: circle,\n            lineSpacing: lineSpacing,\n            lineNailCount: lineNailCount,\n            firstCirclePoint: firstCirclePoint,\n            layers: layers,\n            totalNailCount: totalNailCount,\n            totalIndexCount: totalIndexCount\n        };\n        function getLayer(layerIndex) {\n            const size = Math.round(n * this.config['size' + layerIndex]) + lineNailCount;\n            return {\n                size: size,\n                endIndex: Math.round(this.config['end' + layerIndex] * (totalNailCount + lineNailCount)) - size,\n                color: this.config['color' + layerIndex],\n                enable: this.config['show' + layerIndex],\n                isReverse: this.config['reverse' + layerIndex]\n            };\n        }\n    }\n    /**\n   * Returns the position of a point on the line\n   */ getPoint(index) {\n        if (index < this.calc.lineNailCount || index > this.calc.totalNailCount) {\n            const linePosition = index < this.calc.lineNailCount ? this.calc.lineNailCount - index : index - this.calc.totalNailCount;\n            const indexLength = linePosition * this.calc.lineSpacing;\n            return [\n                this.calc.firstCirclePoint[0] - indexLength * Math.sin(this.calc.circle.rotationAngle),\n                this.calc.firstCirclePoint[1] - indexLength * Math.cos(this.calc.circle.rotationAngle)\n            ];\n        } else {\n            const circleIndex = index - this.calc.lineNailCount;\n            return this.calc.circle.getPoint(circleIndex);\n        }\n    }\n    *drawCircle(renderer, { endIndex: endIndex, color: color, isReverse: isReverse, size: size }) {\n        let prevPoint;\n        let prevPointIndex;\n        let isPrevSide = false;\n        renderer.setColor(color);\n        const self = this;\n        const advance = isReverse ? -1 : 1;\n        for(let index = 0; index <= endIndex; index++){\n            if (prevPoint) {\n                renderer.renderLine(prevPoint, this.getPoint(prevPointIndex + advance));\n                yield;\n            }\n            const startPoint = prevPoint ? this.getPoint(prevPointIndex + advance) : this.getPoint(getPointIndex(index));\n            prevPointIndex = getPointIndex(isPrevSide ? index : index + size);\n            prevPoint = this.getPoint(prevPointIndex);\n            renderer.renderLine(startPoint, prevPoint);\n            yield;\n            isPrevSide = !isPrevSide;\n        }\n        function getPointIndex(index) {\n            return isReverse ? self.calc.totalIndexCount - index : index;\n        }\n    }\n    *drawStrings(renderer) {\n        for (const layer of this.calc.layers)yield* this.drawCircle(renderer, layer);\n    }\n    drawNails(nails) {\n        for(let i = 0; i < this.calc.lineNailCount; i++)nails.addNail(i, this.getPoint(i));\n        this.calc.circle.drawNails(nails, {\n            getUniqueKey: (k)=>this.calc.lineNailCount + k\n        });\n    }\n    getStepCount(options) {\n        const { layers: layers } = this.getCalc(options);\n        return layers.reduce((stepCount, layer)=>stepCount + layer.endIndex * 2 + 1, 0);\n    }\n    getNailCount(size) {\n        const calc = this.getCalc({\n            size: size\n        });\n        return calc.circle.config.n + calc.lineNailCount;\n    }\n    thumbnailConfig = ({ n: n })=>({\n            n: Math.min(n, 50)\n        });\n}\n\n\n\n\n\n\nconst $1530a0f3e43122ac$var$rotationConfig = {\n    label: 'Rotation',\n    defaultValue: 0,\n    type: 'range',\n    attr: {\n        min: 0,\n        max: 1 + 1 / 360,\n        step: 1 / 360\n    },\n    isStructural: true,\n    affectsStepCount: false\n};\nfunction $1530a0f3e43122ac$var$getCircleConfig(i) {\n    const show = (config)=>config[`show${i}`];\n    return {\n        key: `layer${i}`,\n        label: `Layer ${i}`,\n        type: 'group',\n        children: [\n            {\n                key: `show${i}`,\n                label: 'Enable',\n                defaultValue: true,\n                type: 'checkbox',\n                isStructural: true\n            },\n            {\n                key: `n${i}`,\n                label: 'Nails count',\n                type: 'range',\n                attr: {\n                    min: 1,\n                    max: 300,\n                    step: 1\n                },\n                show: show,\n                isStructural: true\n            },\n            {\n                key: `radius${i}`,\n                label: 'Radius',\n                type: 'range',\n                attr: {\n                    min: 0.01,\n                    max: 1,\n                    step: 0.01\n                },\n                show: show,\n                isStructural: true\n            },\n            {\n                key: `x${i}`,\n                label: 'Position X',\n                type: 'range',\n                attr: {\n                    min: 0,\n                    max: 1,\n                    step: 0.01\n                },\n                show: show,\n                isStructural: true\n            },\n            {\n                key: `y${i}`,\n                label: 'Position Y',\n                type: 'range',\n                attr: {\n                    min: 0,\n                    max: 1,\n                    step: 0.01\n                },\n                show: show,\n                isStructural: true\n            },\n            {\n                ...$1530a0f3e43122ac$var$rotationConfig,\n                key: `rotation${i}`,\n                displayValue: ({ rotation1: rotation1 })=>(0, $96d8651f67c6b219$export$b5632b5e53e50dc)(rotation1),\n                show: show\n            },\n            {\n                key: `reverse${i}`,\n                label: 'Reverse',\n                type: 'checkbox',\n                isStructural: true,\n                show: show\n            }\n        ]\n    };\n}\nclass $1530a0f3e43122ac$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'freestyle';\n    name = 'Freestyle';\n    id = 'freestyle';\n    link = 'https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for';\n    controls = [\n        {\n            key: 'color',\n            label: 'Color',\n            defaultValue: '#ec6ad0',\n            type: 'color',\n            affectsNails: false,\n            affectsStepCount: false\n        },\n        {\n            key: 'layers',\n            label: 'Layers',\n            type: 'group',\n            // @ts-ignore\n            children: (0, $c190f550efa69733$export$7f1ebd623f131021)(3, (i)=>$1530a0f3e43122ac$var$getCircleConfig(i + 1))\n        }\n    ];\n    defaultValues = {\n        n1: 80,\n        n2: 80,\n        n3: 80,\n        radius1: 0.5,\n        radius2: 0.5,\n        radius3: 0.5,\n        x1: 0.5,\n        x2: 0,\n        x3: 1,\n        y1: 0,\n        y2: 1,\n        y3: 1,\n        reverse1: false,\n        reverse2: false,\n        reverse3: false\n    };\n    getAspectRatio({ size: size }) {\n        // TODO: Move the aspect ratio of this pattern to a config, then remove the options param from StringArt.getAspectRatio.\n        return size[0] / size[1];\n    }\n    getCalc({ size: size }) {\n        const { margin: margin = 0 } = this.config;\n        const maxRadius = Math.min(...size.map((v)=>v - 2 * margin)) / 2;\n        const layers = (0, $c190f550efa69733$export$7f1ebd623f131021)(3, (i)=>getLayer.call(this, i + 1)).filter(({ enable: enable })=>enable);\n        return {\n            layers: layers,\n            roundsCount: Math.max(...layers.map((l)=>l.circle.config.n))\n        };\n        function getLayer(layerIndex) {\n            const prop = (prop)=>this.config[prop + layerIndex];\n            const props = {\n                enable: prop('show'),\n                isReverse: prop('reverse'),\n                position: [\n                    prop('x'),\n                    prop('y')\n                ],\n                radius: maxRadius * prop('radius'),\n                rotation: prop('rotation')\n            };\n            const circle = new (0, $06de6887437e6fa7$export$2e2bcd8739ae039)({\n                radius: props.radius,\n                size: size,\n                center: props.position.map((v, i)=>props.radius + margin + (size[i] - (props.radius + margin) * 2) * v),\n                n: prop('n'),\n                rotation: props.rotation,\n                reverse: props.isReverse\n            });\n            return {\n                circle: circle,\n                ...props\n            };\n        }\n    }\n    getPoint(layer, index) {\n        return layer.circle.getPoint(index);\n    }\n    *drawStrings(renderer) {\n        const { color: color } = this.config;\n        renderer.setColor(color);\n        let prevCirclePoint;\n        for(let i = 0; i < this.calc.roundsCount; i++)for(let layerIndex = 0; layerIndex < this.calc.layers.length; layerIndex++){\n            const layer = this.calc.layers[layerIndex];\n            const startPoint = prevCirclePoint ?? this.getPoint(layer, i);\n            const positions = [];\n            if (layerIndex === 0 && i) positions.push(this.getPoint(layer, i));\n            let nextLayerIndex = layerIndex + 1;\n            if (nextLayerIndex === this.calc.layers.length) nextLayerIndex = 0;\n            prevCirclePoint = this.getPoint(this.calc.layers[nextLayerIndex], i);\n            renderer.renderLine(startPoint, prevCirclePoint);\n            yield;\n        }\n    }\n    drawNails(nails) {\n        this.calc.layers.forEach(({ circle: circle }, i)=>circle.drawNails(nails, {\n                getUniqueKey: (k)=>1e3 * i + k\n            }));\n    }\n    getStepCount(options) {\n        const { layers: layers, roundsCount: roundsCount } = this.getCalc(options);\n        return layers.length * roundsCount;\n    }\n    getNailsCount() {\n        const { n1: n1, n2: n2, n3: n3 } = this.config;\n        return n1 + n2 + n3;\n    }\n    thumbnailConfig = ({ n1: n1, n2: n2, n3: n3 })=>({\n            n1: Math.min(n1, 40),\n            n2: Math.min(n2, 40),\n            n3: Math.min(n3, 40)\n        });\n}\n\n\n\n\n\nconst $3f55ac726d5ebe61$var$COLOR_CONFIG = (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n    defaults: {\n        isMultiColor: true,\n        color: '#ff0000',\n        multicolorRange: 1,\n        multicolorStart: 0,\n        multicolorByLightness: true,\n        minLightness: 20,\n        maxLightness: 50\n    },\n    exclude: [\n        'colorCount'\n    ]\n});\nclass $3f55ac726d5ebe61$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'polygon';\n    name = 'Polygon';\n    id = 'polygon';\n    controls = [\n        {\n            key: 'sides',\n            label: 'Sides',\n            defaultValue: 5,\n            type: 'range',\n            attr: {\n                min: 3,\n                max: 10,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'n',\n            label: 'Nails per side',\n            defaultValue: 60,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 100,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'bezier',\n            label: 'Bezier',\n            defaultValue: 2,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 4,\n                step: 1\n            },\n            show: ({ sides: sides })=>sides > 4,\n            affectsNails: false,\n            affectsStepCount: false\n        },\n        (0, $cf574edfbef72605$export$2e2bcd8739ae039).rotationConfig,\n        $3f55ac726d5ebe61$var$COLOR_CONFIG\n    ];\n    defaultValues = {\n        nailsColor: '#5c5c5c',\n        nailRadius: 1\n    };\n    color;\n    colorMap;\n    getCalc({ size: size }) {\n        const { n: n, rotation: rotation, sides: sides, margin: margin } = this.config;\n        const polygonConfig = {\n            sides: sides,\n            rotation: rotation / (sides * 2),\n            margin: margin,\n            size: size,\n            nailsPerSide: n,\n            fitSize: true\n        };\n        return {\n            polygon: new (0, $cf574edfbef72605$export$2e2bcd8739ae039)(polygonConfig)\n        };\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        const { sides: sides, isMultiColor: isMultiColor } = this.config;\n        this.color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)({\n            ...this.config,\n            isMultiColor: isMultiColor,\n            colorCount: sides\n        });\n        if (isMultiColor) this.colorMap = this.color.getColorMap({\n            stepCount: this.getStepCount(),\n            colorCount: sides\n        });\n        else this.colorMap = null;\n    }\n    getAspectRatio(options) {\n        const { polygon: polygon } = this.getCalc(options);\n        return polygon.getAspectRatio();\n    }\n    *drawStrings(renderer) {\n        const { sides: sides, bezier: bezier } = this.config;\n        const limitedBezier = Math.min(bezier, Math.ceil(sides / 2) - 1);\n        let step = 0;\n        renderer.setColor(this.color.getColor(0));\n        for(let side = 0; side < sides; side++){\n            const nextSide = (side + limitedBezier) % sides;\n            if (this.colorMap) renderer.setColor(this.colorMap.get(step));\n            for(let index = 0; index < this.config.n; index++){\n                renderer.renderLine(this.calc.polygon.getSidePoint({\n                    side: side,\n                    index: index\n                }), this.calc.polygon.getSidePoint({\n                    side: nextSide,\n                    index: index\n                }));\n                yield;\n                step++;\n            }\n        }\n    }\n    getStepCount() {\n        const { sides: sides, n: n } = this.config;\n        return sides * n;\n    }\n    drawNails(nails) {\n        this.calc.polygon.drawNails(nails);\n    }\n    thumbnailConfig = ({ n: n })=>({\n            n: Math.min(n, 20)\n        });\n}\n\n\n\n\n\n\n\nconst $7e0f39c01d255ee0$var$COLOR_CONFIG = (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n    defaults: {\n        isMultiColor: true,\n        color: '#29f1ff',\n        multicolorRange: 132,\n        multicolorStart: 53,\n        multicolorByLightness: false,\n        minLightness: 30,\n        maxLightness: 70\n    },\n    exclude: [\n        'colorCount'\n    ]\n});\nclass $7e0f39c01d255ee0$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'flower';\n    name = 'Flower';\n    id = 'flower';\n    link = 'https://www.sqrt.ch/Buch/fadenmodell4_100.svg';\n    controls = [\n        {\n            key: 'sides',\n            label: 'Sides',\n            defaultValue: 4,\n            type: 'range',\n            attr: {\n                min: 3,\n                max: 20,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'n',\n            label: 'Nails per side',\n            defaultValue: 60,\n            type: 'range',\n            attr: {\n                min: 2,\n                max: 100,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'layers',\n            label: 'Layers',\n            defaultValue: 2,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 10,\n                step: 1\n            },\n            isStructural: true\n        },\n        (0, $cf574edfbef72605$export$2e2bcd8739ae039).rotationConfig,\n        $7e0f39c01d255ee0$var$COLOR_CONFIG\n    ];\n    defaultValues = {\n        nailsColor: '#29f1ff',\n        nailRadius: 1,\n        stringWidth: 0.5\n    };\n    color;\n    getCalc({ size: size }) {\n        const { n: n, rotation: rotation, sides: sides, layers: layers, margin: margin } = this.config;\n        const layerAngleShift = 1 / (sides * layers);\n        const polygons = (0, $c190f550efa69733$export$7f1ebd623f131021)(layers, (i)=>{\n            const polygonConfig = {\n                sides: sides,\n                rotation: rotation / sides + i * layerAngleShift,\n                margin: margin,\n                size: size,\n                nailsPerSide: n,\n                radiusNailsCountSameAsSides: true\n            };\n            return new (0, $cf574edfbef72605$export$2e2bcd8739ae039)(polygonConfig);\n        });\n        return {\n            polygons: polygons\n        };\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        const { layers: layers, isMultiColor: isMultiColor } = this.config;\n        this.color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)({\n            ...this.config,\n            isMultiColor: isMultiColor,\n            colorCount: layers\n        });\n    }\n    getAspectRatio() {\n        const calc = this.calc ?? this.getCalc({\n            size: [\n                100,\n                100\n            ]\n        });\n        const boundingRect = (0, $b683a3137b30eaa9$export$1d3cc206d049790e)(...calc.polygons.map((p)=>p.getBoundingRect()));\n        return (0, $b683a3137b30eaa9$export$d2646d47608819e2)(boundingRect);\n    }\n    *drawStrings(renderer) {\n        const { sides: sides, layers: layers, n: n } = this.config;\n        let step = 0;\n        for(let layer = 0; layer < layers; layer++){\n            renderer.setColor(this.color.getColor(layer));\n            const polygon = this.calc.polygons[layer];\n            for(let side = 0; side < sides; side++){\n                const leftSide = (side + 1) % sides;\n                for(let index = 0; index < n; index++){\n                    const centerIndexes = [\n                        index,\n                        this.config.n - index - 1\n                    ];\n                    renderer.renderLine(polygon.getCenterPoint({\n                        side: side,\n                        index: centerIndexes[0]\n                    }), polygon.getSidePoint({\n                        side: side,\n                        index: index\n                    }));\n                    yield;\n                    renderer.lineTo(polygon.getCenterPoint({\n                        side: leftSide,\n                        index: centerIndexes[1]\n                    }));\n                    yield;\n                    step++;\n                }\n            }\n        }\n    }\n    drawNails(nails) {\n        const layerNailCount = this.config.layers > 1 ? this.calc.polygons[1].getNailsCount({\n            drawCenter: true,\n            drawCenterNail: false\n        }) : null;\n        this.calc.polygons.forEach((polygon, i)=>polygon.drawNails(nails, {\n                drawCenter: true,\n                drawCenterNail: i === 0,\n                getUniqueKey: i ? (k)=>i * layerNailCount + 1 + k : undefined\n            }));\n    }\n    getStepCount() {\n        const { sides: sides, n: n, layers: layers } = this.config;\n        return sides * n * 2 * layers;\n    }\n    getNailCount(size) {\n        const { layers: layers } = this.config;\n        const calc = this.calc ?? this.getCalc({\n            size: size\n        });\n        const polygon = calc.polygons[0];\n        return layers * polygon.getNailsCount({\n            drawCenter: true,\n            drawCenterNail: false\n        }) + 1;\n    }\n    thumbnailConfig = ({ n: n })=>({\n            n: Math.min(n, 20)\n        });\n    testStepCountConfig = [\n        {\n            sides: 3,\n            n: 2,\n            layers: 1\n        }\n    ];\n}\n\n\n\n\n\n\n\n\n\nconst $5498d6506310c764$var$COLOR_CONFIG = (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n    defaults: {\n        isMultiColor: true,\n        color: '#ffffff',\n        multicolorRange: 102,\n        multicolorStart: 239,\n        multicolorByLightness: false,\n        minLightness: 30,\n        maxLightness: 70,\n        colorCount: 4\n    },\n    exclude: [\n        'repeatColors',\n        'mirrorColors'\n    ]\n});\nclass $5498d6506310c764$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'maurer_rose';\n    name = 'Maurer Rose';\n    id = 'maurer_rose';\n    link = 'https://blog.glitch.land/en/posts/maurer-rose/';\n    linkText = 'Learn';\n    controls = [\n        {\n            key: 'n',\n            label: 'N',\n            defaultValue: 4,\n            type: 'range',\n            attr: {\n                min: 2,\n                max: 12,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'maxSteps',\n            label: 'Max steps',\n            defaultValue: 512,\n            type: 'range',\n            attr: {\n                min: 3,\n                max: 720,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'angle',\n            label: 'Angle',\n            defaultValue: 341,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 720,\n                step: 1\n            },\n            displayValue: ({ angle: angle })=>`${angle}\\xb0`,\n            isStructural: true\n        },\n        (0, $b103c63dc979d40c$export$2d97e2da46663803)((0, $06de6887437e6fa7$export$2e2bcd8739ae039).rotationConfig, 'snap'),\n        $5498d6506310c764$var$COLOR_CONFIG\n    ];\n    points;\n    color;\n    colorMap;\n    resetStructure() {\n        super.resetStructure();\n        if (this.points) this.points.clear();\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        const { isMultiColor: isMultiColor, colorCount: colorCount } = this.config;\n        if (!this.points) this.points = new Map();\n        if (!this.stepCount) this.stepCount = this.getStepCount();\n        this.color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)({\n            ...this.config,\n            isMultiColor: isMultiColor,\n            colorCount: colorCount\n        });\n        if (isMultiColor) this.colorMap = this.color.getColorMap({\n            stepCount: this.stepCount,\n            colorCount: colorCount\n        });\n        else this.colorMap = null;\n    }\n    getAspectRatio({ size: size }) {\n        const { n: n, rotation: rotation, margin: margin } = this.config;\n        // Use a Polygon and getBoundingRect to calculate the aspectRatio\n        const polygon = new (0, $cf574edfbef72605$export$2e2bcd8739ae039)({\n            size: size,\n            sides: n % 2 ? n : n * 2,\n            nailsPerSide: 10,\n            margin: margin,\n            rotation: rotation,\n            center: (0, $b683a3137b30eaa9$export$c91255cadecfe081)(size)\n        });\n        return polygon.getAspectRatio();\n    }\n    getCalc({ size: size }) {\n        const { angle: angle, rotation: rotation, maxSteps: maxSteps, margin: margin } = this.config;\n        return {\n            angleRadians: (0, $e2b746416d2bf62b$export$f4644083ce95e7e3) * angle / maxSteps,\n            radius: Math.min(...size) / 2 - margin,\n            currentSize: (0, $b683a3137b30eaa9$export$c566af9defc62c6)(size, (v)=>v - margin * 2),\n            rotationAngle: -Math.PI * 2 * rotation,\n            center: (0, $b683a3137b30eaa9$export$c91255cadecfe081)(size)\n        };\n    }\n    getPoint(index) {\n        const { rotationAngle: rotationAngle, angleRadians: angleRadians, radius: radius, center: center } = this.calc;\n        if (this.points.has(index)) return this.points.get(index);\n        const k = index * angleRadians;\n        const r = radius * Math.sin(this.config.n * k);\n        const point = [\n            center[0] - r * Math.cos(k - rotationAngle),\n            center[1] - r * Math.sin(k - rotationAngle)\n        ];\n        this.points.set(index, point);\n        return point;\n    }\n    *generatePoints() {\n        const count = this.stepCount;\n        for(let i = 0; i < count + 1; i++)yield {\n            point: this.getPoint(i),\n            index: i\n        };\n    }\n    *drawStrings(renderer) {\n        const points = this.generatePoints();\n        let prevPoint;\n        renderer.setColor(this.color.getColor(0));\n        for (const { point: point, index: index } of points){\n            if (!prevPoint) {\n                prevPoint = point;\n                continue;\n            }\n            if (this.colorMap) {\n                const stepColor = this.colorMap.get(index);\n                if (stepColor) renderer.setColor(stepColor);\n            }\n            renderer.renderLine(prevPoint, point);\n            prevPoint = point;\n            yield;\n        }\n    }\n    getStepCount() {\n        if (this.stepCount) return this.stepCount;\n        const { maxSteps: maxSteps, angle: angle, n: n } = this.config;\n        const angleGcd = (0, $e2b746416d2bf62b$export$f81847884871263e)(maxSteps, angle);\n        let steps = maxSteps / angleGcd;\n        if (!(steps % 2) && n % 2) steps /= 2;\n        return Math.round(steps);\n    }\n    drawNails(nails) {\n        const points = this.generatePoints();\n        for (const { point: point, index: index } of points)nails.addNail(index, point);\n    }\n}\n\n\n\n\n\n\n\n\n\n\n\nconst $7a74ed27f7260395$var$COLOR_CONFIG = (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n    defaults: {\n        isMultiColor: true,\n        color: '#29f1ff',\n        multicolorRange: 30,\n        multicolorStart: 25,\n        multicolorByLightness: true,\n        minLightness: 40,\n        maxLightness: 95,\n        colorCount: 3,\n        repeatColors: true,\n        saturation: 83,\n        reverseColors: true\n    },\n    customControls: [\n        {\n            key: 'colorPerLevel',\n            label: 'Color per level',\n            defaultValue: true,\n            type: 'checkbox',\n            affectsNails: false\n        }\n    ]\n});\nconst $7a74ed27f7260395$var$ANGLE = -(0, $e2b746416d2bf62b$export$f4644083ce95e7e3) / 6; // The angle of a equilateral triangle;\nconst $7a74ed27f7260395$var$SIDE_ANGLES = new Array(6).fill(null).map((_, i)=>Math.PI / 2 + $7a74ed27f7260395$var$ANGLE * i);\nclass $7a74ed27f7260395$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'flower_of_life';\n    name = 'Flower of Life';\n    id = 'flower_of_life';\n    link = 'https://www.reddit.com/r/psychedelicartwork/comments/mk97gi/rainbow_flower_of_life_uv_reactive_string_art/';\n    controls = [\n        {\n            key: 'levels',\n            label: 'Levels',\n            defaultValue: 3,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 10,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'density',\n            label: 'Density',\n            defaultValue: 10,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 50,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'globalRotation',\n            label: 'Rotation',\n            defaultValue: 0,\n            type: 'range',\n            attr: {\n                min: 0,\n                max: 30,\n                step: 1\n            },\n            displayValue: ({ globalRotation: globalRotation })=>`${globalRotation}\\xb0`,\n            isStructural: true,\n            affectsStepCount: false\n        },\n        {\n            key: 'fillGroup',\n            label: 'Fill',\n            type: 'group',\n            children: [\n                {\n                    key: 'fill',\n                    label: 'Show fill',\n                    defaultValue: true,\n                    type: 'checkbox',\n                    isStructural: true,\n                    affectsNails: false\n                },\n                {\n                    key: 'fillColor',\n                    label: 'Fill color',\n                    defaultValue: '#292e29',\n                    type: 'color',\n                    show: ({ fill: fill })=>fill,\n                    affectsNails: false\n                }\n            ]\n        },\n        {\n            key: 'ringGroup',\n            label: 'Ring',\n            type: 'group',\n            children: [\n                {\n                    key: 'renderRing',\n                    label: 'Show outer ring',\n                    type: 'checkbox',\n                    defaultValue: true,\n                    isStructural: true\n                },\n                {\n                    key: 'ringNailCount',\n                    label: 'Ring nail count',\n                    defaultValue: 144,\n                    type: 'range',\n                    attr: {\n                        min: 3,\n                        max: 360,\n                        step: 1\n                    },\n                    show: ({ renderRing: renderRing })=>renderRing,\n                    isStructural: true\n                },\n                {\n                    key: 'ringSize',\n                    label: 'Outer ring size',\n                    defaultValue: 0.23,\n                    type: 'range',\n                    attr: {\n                        min: 0,\n                        max: 0.5,\n                        step: 0.01\n                    },\n                    show: ({ renderRing: renderRing })=>renderRing,\n                    displayValue: ({ ringSize: ringSize })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(ringSize),\n                    isStructural: true\n                },\n                {\n                    key: 'ringPadding',\n                    label: 'Ring padding',\n                    defaultValue: 0.06,\n                    type: 'range',\n                    attr: {\n                        min: 0,\n                        max: 0.5,\n                        step: 0.01\n                    },\n                    show: ({ renderRing: renderRing })=>renderRing,\n                    isStructural: true,\n                    displayValue: ({ ringPadding: ringPadding })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(ringPadding)\n                },\n                {\n                    key: 'ringColor',\n                    label: 'Ring color',\n                    defaultValue: '#e8b564',\n                    type: 'color',\n                    show: ({ renderRing: renderRing })=>renderRing,\n                    affectsNails: false\n                }\n            ]\n        },\n        {\n            key: 'renderTriangles',\n            label: 'Show triangles',\n            defaultValue: true,\n            type: 'checkbox',\n            isStructural: true,\n            affectsNails: false\n        },\n        {\n            key: 'renderCaps',\n            label: 'Show caps',\n            defaultValue: true,\n            type: 'checkbox',\n            show: ({ renderTriangles: renderTriangles })=>renderTriangles,\n            isStructural: true\n        },\n        $7a74ed27f7260395$var$COLOR_CONFIG\n    ];\n    defaultValues = {\n        nailsColor: '#474747'\n    };\n    color;\n    colorMap;\n    getCalc(options) {\n        const { size: size } = options;\n        const { levels: levels, density: density, margin: margin, globalRotation: globalRotation, renderCaps: renderCaps, renderRing: renderRing, ringNailCount: ringNailCount, ringSize: ringSize, ringPadding: ringPadding } = this.config;\n        const globalRotationRadians = globalRotation * Math.PI / 180 + Math.PI / 6;\n        const radius = renderRing ? Math.min(...size.map((v)=>v / 2 - margin)) : null;\n        const ringDistance = renderRing ? Math.floor(ringSize * ringNailCount / 2) : 0; // The number of nails to count for strings in the outer ring\n        const ringWidth = renderRing ? radius * (1 - Math.cos((0, $e2b746416d2bf62b$export$f4644083ce95e7e3) * (ringDistance / ringNailCount) / 2)) : 0;\n        const polygon = new (0, $cf574edfbef72605$export$2e2bcd8739ae039)({\n            sides: 6,\n            size: size,\n            margin: margin + ringWidth + (renderRing && ringSize ? ringPadding * radius : 0),\n            rotation: globalRotationRadians,\n            fitSize: false,\n            nailsPerSide: 2\n        });\n        const edgeSize = polygon.sideSize / levels;\n        const nailsLength = edgeSize / (2 * Math.cos(Math.PI / 6));\n        const ringCircle = renderRing && ringSize ? new (0, $06de6887437e6fa7$export$2e2bcd8739ae039)({\n            size: size,\n            n: ringNailCount,\n            margin: margin,\n            rotation: globalRotation\n        }) : null;\n        const countPerLevelSide = new Array(levels + (renderCaps ? 1 : 0)).fill(null).map((_, level)=>level * 2 + 1);\n        const calc = {\n            edgeSize: edgeSize,\n            triangleHeight: edgeSize * Math.sqrt(3) / 2,\n            nailsLength: nailsLength,\n            triangleCenterDistance: edgeSize / 2,\n            nailDistance: nailsLength / density,\n            triangleCount: 6 * levels ** 2,\n            countPerLevelSide: countPerLevelSide,\n            globalRotationRadians: globalRotationRadians,\n            radius: radius,\n            ringCircle: ringCircle,\n            center: (0, $b683a3137b30eaa9$export$c91255cadecfe081)(size)\n        };\n        return {\n            ...calc,\n            ...this.#getPoints(calc)\n        };\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        const { isMultiColor: isMultiColor, levels: levels, colorPerLevel: colorPerLevel, colorCount: colorCount, renderRing: renderRing, ringSize: ringSize, ringNailCount: ringNailCount, ...config } = this.config;\n        if (!this.stepCount) this.stepCount = this.getStepCount(options);\n        const realColorCount = isMultiColor ? colorPerLevel ? levels : Math.min(colorCount, levels) : 1;\n        this.color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)({\n            ...config,\n            isMultiColor: isMultiColor,\n            colorCount: realColorCount\n        });\n        if (isMultiColor) this.colorMap = this.color.getColorMap({\n            stepCount: realColorCount,\n            colorCount: realColorCount\n        });\n        else this.colorMap = null;\n    }\n    getAspectRatio() {\n        return 1;\n    }\n    #getTrianglePoints(calc, { center: center, rotation: rotation, isCapLevel: isCapLevel, triangleIndexInSide: triangleIndexInSide, withPoint: withPoint }) {\n        let missingSide;\n        if (isCapLevel) {\n            const triangleIndex = (triangleIndexInSide + 2) % 3;\n            missingSide = this.#getNextIndexInTriangle(triangleIndex);\n        }\n        // For each side of the triangle, the first point is the center of the triangle:\n        const trianglePoints = new Array(3).fill(null).map((_, i)=>i === missingSide ? [] : [\n                center\n            ]);\n        withPoint(0, 0, center);\n        for(let side = 0; side < 3; side++){\n            if (isCapLevel && side === missingSide) continue;\n            const sideAngle = rotation + side * ((0, $e2b746416d2bf62b$export$f4644083ce95e7e3) / 3);\n            const triangleSidePoints = trianglePoints[side];\n            const cosSideAngle = Math.cos(sideAngle);\n            const sinSideAngle = Math.sin(sideAngle);\n            for(let n = 1; n <= this.config.density; n++){\n                const nNailDistance = n * calc.nailDistance;\n                const point = [\n                    center[0] + nNailDistance * cosSideAngle,\n                    center[1] + nNailDistance * sinSideAngle\n                ];\n                triangleSidePoints.push(point);\n                withPoint(side, n, point);\n            }\n        }\n        return trianglePoints;\n    }\n    #getPoints(calc) {\n        const { levels: levels, renderCaps: renderCaps } = this.config;\n        const largeDistance = calc.nailsLength;\n        const smallDistance = calc.triangleHeight - largeDistance;\n        const nailsGroup = new (0, $d8b2fd23c47cc34c$export$2e2bcd8739ae039)();\n        const levelsCount = renderCaps ? levels + 1 : levels;\n        for(let level = 0; level < levelsCount; level++){\n            const isCapLevel = renderCaps && level === levels;\n            const levelSideTriangleCount = calc.countPerLevelSide[level];\n            // Caching distances to avoid repeated calculations for each side:\n            const levelPositions = (0, $c190f550efa69733$export$7f1ebd623f131021)(levelSideTriangleCount, (n)=>{\n                const isFlipped = n % 2 === 0;\n                const trianglePosition = [\n                    calc.triangleCenterDistance * (n - level),\n                    level * calc.triangleHeight + (isFlipped ? largeDistance : smallDistance)\n                ];\n                return {\n                    rotation: Math.atan(trianglePosition[0] / trianglePosition[1]),\n                    distanceFromCenter: Math.hypot(trianglePosition[0], trianglePosition[1])\n                };\n            });\n            let triangleIndexInLevel = 0;\n            for(let side = 0; side < 6; side++){\n                const sideRotation = $7a74ed27f7260395$var$SIDE_ANGLES[side];\n                for(let n = 0; n < levelSideTriangleCount; n++){\n                    if (isCapLevel && n % 2 === 0) {\n                        // Cap triangles are only odd indexes\n                        triangleIndexInLevel++;\n                        continue;\n                    }\n                    const { distanceFromCenter: distanceFromCenter, rotation: rotation } = levelPositions[n];\n                    const triangleCenterAngle = sideRotation - rotation - calc.globalRotationRadians;\n                    const rotatedTrianglePosition = [\n                        calc.center[0] + distanceFromCenter * Math.cos(triangleCenterAngle),\n                        calc.center[1] - distanceFromCenter * Math.sin(triangleCenterAngle)\n                    ];\n                    this.#getTrianglePoints(calc, {\n                        center: rotatedTrianglePosition,\n                        rotation: sideRotation + side * (0, $e2b746416d2bf62b$export$f4644083ce95e7e3) / 3 - n * $7a74ed27f7260395$var$ANGLE + calc.globalRotationRadians,\n                        isCapLevel: isCapLevel,\n                        triangleIndexInSide: n,\n                        withPoint: (side, index, point)=>{\n                            nailsGroup.addNail(this.#getPointKey(level, triangleIndexInLevel, side, index), point);\n                        }\n                    });\n                    triangleIndexInLevel++;\n                }\n            }\n        }\n        return {\n            nailsGroup: nailsGroup\n        };\n    }\n    *generateTriangleStrings(renderer, { level: level, indexInSide: indexInSide, triangleIndex: triangleIndex, isCapLevel: isCapLevel }) {\n        renderer.setColor(this.color.getColor(level));\n        const { density: density } = this.config;\n        const initialSide = isCapLevel ? this.#getNextIndexInTriangle(indexInSide % 3) : 0;\n        const lastSide = isCapLevel ? initialSide : 2;\n        const lastIndex = isCapLevel ? density : density - 1;\n        for(let side = initialSide; side <= lastSide; side++){\n            const nextSide = this.#getNextIndexInTriangle(side, 1);\n            let prevPoint = this.calc.nailsGroup.getNailCoordinates(this.#getPointKey(level, triangleIndex, 0, 0));\n            for(let n = 0; n <= lastIndex; n++){\n                const isNextSide = n % 2 === 0;\n                const nextSidePoint = isNextSide ? density - n : n;\n                const targetSide = isNextSide ? nextSide : side;\n                const targetPoint = this.calc.nailsGroup.getNailCoordinates(this.#getPointKey(level, triangleIndex, targetSide, nextSidePoint));\n                renderer.renderLine(prevPoint, targetPoint);\n                yield;\n                if (n < density) {\n                    prevPoint = this.calc.nailsGroup.getNailCoordinates(this.#getPointKey(level, triangleIndex, targetSide, isNextSide ? nextSidePoint - 1 : nextSidePoint + 1));\n                    renderer.renderLine(targetPoint, prevPoint);\n                    yield;\n                }\n            }\n        }\n    }\n    *generateStringsBetweenTriangles(renderer, { triangle1Index: triangle1Index, triangle2Index: triangle2Index, triangle1Level: triangle1Level, triangle2Level: triangle2Level, triangleIndexInSide: triangleIndexInSide, isNextLevel: isNextLevel }) {\n        const { density: density, fillColor: fillColor } = this.config;\n        const levelSideCount = this.calc.countPerLevelSide[triangle1Level];\n        const angleShift = triangle1Index % levelSideCount % 3;\n        renderer.setColor(fillColor);\n        const isLastTriangleInSide = triangleIndexInSide === levelSideCount - 1;\n        const firstSide = angleShift;\n        const sideIndex = isNextLevel ? [\n            this.#getNextIndexInTriangle(angleShift),\n            this.#getNextIndexInTriangle(angleShift, -1)\n        ] : [\n            firstSide,\n            this.#getNextIndexInTriangle(firstSide, triangleIndexInSide % 2 ? 1 : -1)\n        ];\n        for(let s = 0; s < 2; s++){\n            const order = generateOrderInSide.call(this, s);\n            for (const { pointIndex: pointIndex, triangle1Side: triangle1Side, triangle2Side: triangle2Side } of order){\n                renderer.renderLine(this.calc.nailsGroup.getNailCoordinates(this.#getPointKey(triangle1Level, triangle1Index, triangle1Side, pointIndex)), this.calc.nailsGroup.getNailCoordinates(this.#getPointKey(triangle2Level, triangle2Index, triangle2Side, pointIndex)));\n                yield;\n            }\n        }\n        function* generateOrderInSide(side) {\n            const triangle1Side = sideIndex[side];\n            const triangle2Side = getNextTriangleSide.call(this);\n            const last = side ? density : density - 1;\n            if (side === 0) for(let n = 0; n <= last; n++)yield {\n                pointIndex: density - n,\n                triangle1Side: triangle1Side,\n                triangle2Side: triangle2Side\n            };\n            else for(let n = last; n >= 1; n--)yield {\n                pointIndex: density - n,\n                triangle1Side: triangle1Side,\n                triangle2Side: triangle2Side\n            };\n            function getNextTriangleSide() {\n                if (isNextLevel) return this.#getNextIndexInTriangle(triangle1Side);\n                else {\n                    if (side === 0 && isLastTriangleInSide) return 1;\n                    else {\n                        if (side === 1 && isLastTriangleInSide) return 0;\n                        else return this.#getNextIndexInTriangle(triangle1Side, 1);\n                    }\n                }\n            }\n        }\n    }\n    #getNextIndexInTriangle(index, direction = 1) {\n        const result = index + direction;\n        if (result < 0) return 2;\n        if (result > 2) return 0;\n        return result;\n    }\n    *drawStrings(renderer) {\n        const { fill: fill, renderTriangles: renderTriangles, renderCaps: renderCaps, levels: levels, renderRing: renderRing, ringSize: ringSize, ringColor: ringColor } = this.config;\n        const levelsCount = renderCaps ? levels + 1 : levels;\n        for(let levelIndex = 0; levelIndex < levelsCount; levelIndex++){\n            const isCapLevel = levelIndex === levels;\n            const levelTriangleCount = 6 * (levelIndex * 2 + 1);\n            const lastIndexInLevel = levelTriangleCount - 1;\n            for(let triangleIndex = 0; triangleIndex < levelTriangleCount; triangleIndex++){\n                const levelSideCount = this.calc.countPerLevelSide[levelIndex];\n                const triangleIndexInSide = triangleIndex % levelSideCount;\n                if (fill && !isCapLevel) {\n                    if (triangleIndex === 0) yield* this.generateStringsBetweenTriangles(renderer, {\n                        triangle1Index: lastIndexInLevel,\n                        triangle2Index: triangleIndex,\n                        triangle1Level: levelIndex,\n                        triangle2Level: levelIndex,\n                        triangleIndexInSide: lastIndexInLevel % levelSideCount\n                    });\n                    if (triangleIndex !== lastIndexInLevel) yield* this.generateStringsBetweenTriangles(renderer, {\n                        triangle1Index: triangleIndex,\n                        triangle2Index: triangleIndex + 1,\n                        triangle1Level: levelIndex,\n                        triangle2Level: levelIndex,\n                        triangleIndexInSide: triangleIndexInSide\n                    });\n                    if (triangleIndexInSide % 2 === 0 && (renderCaps && renderTriangles || levelIndex < levels - 1)) {\n                        const side = Math.floor(triangleIndex / levelSideCount);\n                        const nextLevelSideCount = this.calc.countPerLevelSide[levelIndex + 1];\n                        const nextLevelTriangleIndex = side * nextLevelSideCount + triangleIndexInSide + 1;\n                        yield* this.generateStringsBetweenTriangles(renderer, {\n                            triangle1Index: triangleIndex,\n                            triangle2Index: nextLevelTriangleIndex,\n                            triangle1Level: levelIndex,\n                            triangle2Level: levelIndex + 1,\n                            triangleIndexInSide: triangleIndexInSide,\n                            isNextLevel: true\n                        });\n                    }\n                }\n                if (renderTriangles && (!isCapLevel || triangleIndexInSide % 2)) yield* this.generateTriangleStrings(renderer, {\n                    level: levelIndex,\n                    indexInSide: triangleIndexInSide,\n                    triangleIndex: triangleIndex,\n                    isCapLevel: isCapLevel\n                });\n            }\n        }\n        if (renderRing && ringSize) yield* this.calc.ringCircle.drawRing(renderer, {\n            ringSize: ringSize / 2,\n            color: ringColor\n        });\n    }\n    getStepCount(options) {\n        if (this.stepCount) return this.stepCount;\n        const calc = this.calc ?? this.getCalc(options);\n        const { density: density, renderTriangles: renderTriangles, renderCaps: renderCaps, levels: levels, fill: fill } = this.config;\n        const { triangleCount: triangleCount, ringCircle: ringCircle } = calc;\n        const capCount = renderTriangles && renderCaps ? levels * 6 : 0;\n        // First we count how many fills there are. The calculation is like this:\n        // For each level, there's a fill between each triangle\n        // Also, for each level, there are (level - 1) * 6 fills, where the level is zero-based (the first level is 0)\n        // Finally, if there are caps, each cap has a fill\n        let fillCount = 0;\n        if (fill) {\n            const getTriangleCountForLevel = (level)=>6 * (level * 2 + 1);\n            for(let level = 0; level < levels; level++){\n                const levelTrianglecount = getTriangleCountForLevel(level);\n                fillCount += levelTrianglecount + level * 6;\n            }\n            fillCount += capCount;\n        }\n        const fillStepCount = fillCount * density * 2;\n        const capSteps = capCount * (2 * density + 1);\n        return (renderTriangles ? triangleCount * density * 6 : 0) + capSteps + fillStepCount + (ringCircle ? ringCircle.getRingStepCount() : 0);\n    }\n    getNailCount() {\n        return this.#getTrianglesNailsCount() + (this.config.renderRing ? this.config.ringNailCount : 0);\n    }\n    #getTrianglesNailsCount() {\n        const { levels: levels, renderCaps: renderCaps, density: density } = this.config;\n        const triangleCount = 6 * levels ** 2;\n        const capsCount = renderCaps ? levels * 6 : 0;\n        // jointsCount is the number of joints that are shared by multiple triangles, not counting the center joint\n        const jointsCount = levels * (levels + 1) / 2 * 6 + 1;\n        const nailsPerTriangleWithoutJoints = (density - 1) * 3 + 1;\n        const capsNailCount = capsCount * ((density - 1) * 2 + 1);\n        return triangleCount * nailsPerTriangleWithoutJoints + jointsCount + capsNailCount;\n    }\n    drawNails(nails) {\n        nails.addGroup(this.calc.nailsGroup);\n        if (this.calc.ringCircle) this.calc.ringCircle.drawNails(nails);\n    }\n    #getPointKey(level, triangle, side, index) {\n        return index ? 1e6 * level + 1e3 * triangle + side * 1e2 + index : 1e6 * level + 1e3 * triangle;\n    }\n    thumbnailConfig = ({ density: density })=>({\n            density: Math.min(density, 3)\n        });\n}\n\n\n\n\n\nconst $cfcb4d6877bfaba2$var$spreadModes = {\n    evenly: {\n        f: (layerIndex, { ringSize: ringSize, layers: layers, n: n })=>{\n            const firstLayerDistance = Math.floor(n * ringSize);\n            return Math.floor((layers - layerIndex) * firstLayerDistance / layers);\n        },\n        name: 'Evenly'\n    },\n    distance: {\n        f: (layerIndex, { n: n, ringSize: ringSize, layerDistance: layerDistance })=>{\n            const firstLayerDistance = Math.floor(n * ringSize);\n            if (layerIndex > 0) return firstLayerDistance - layerIndex * layerDistance;\n            return firstLayerDistance;\n        },\n        name: 'Specific distance'\n    }\n};\nconst $cfcb4d6877bfaba2$var$COLOR_CONFIG = (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n    defaults: {\n        isMultiColor: true,\n        color: '#ff0000',\n        multicolorRange: 133,\n        multicolorStart: 239,\n        multicolorByLightness: false,\n        minLightness: 30,\n        maxLightness: 70,\n        colorCount: 4\n    },\n    customControls: [\n        {\n            key: 'colorPerLayer',\n            label: 'Color per layer',\n            defaultValue: true,\n            type: 'checkbox',\n            affectsNails: false\n        }\n    ]\n});\nclass $cfcb4d6877bfaba2$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'comet';\n    name = 'Comet';\n    id = 'comet';\n    controls = [\n        (0, $06de6887437e6fa7$export$2e2bcd8739ae039).nailsConfig,\n        {\n            key: 'layers',\n            label: 'Layers',\n            defaultValue: 5,\n            type: 'range',\n            attr: {\n                min: 1,\n                max: 20,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'ringSize',\n            label: 'First layer size',\n            description: 'Nail count from the top center nail to the first connected nail in the first layer',\n            defaultValue: 0.3,\n            type: 'range',\n            attr: {\n                min: 0,\n                max: 1,\n                step: 0.01\n            },\n            displayValue: ({ ringSize: ringSize, n: n })=>Math.floor(n * ringSize),\n            isStructural: true,\n            affectsNails: false\n        },\n        {\n            key: 'layerSpread',\n            label: 'Layer Spread',\n            type: 'select',\n            defaultValue: 'distance',\n            options: Object.entries($cfcb4d6877bfaba2$var$spreadModes).map(([key, { name: name }])=>({\n                    value: key,\n                    label: name\n                })),\n            isStructural: true,\n            affectsNails: false\n        },\n        {\n            key: 'layerDistance',\n            label: 'Layer Distance',\n            type: 'range',\n            attr: {\n                min: 1,\n                max: ({ n: n, layers: layers })=>Math.floor(n / 2 / layers),\n                step: 1\n            },\n            defaultValue: 1,\n            isStructural: true,\n            show: ({ layerSpread: layerSpread })=>layerSpread !== 'evenly',\n            affectsNails: false\n        },\n        (0, $06de6887437e6fa7$export$2e2bcd8739ae039).rotationConfig,\n        (0, $06de6887437e6fa7$export$2e2bcd8739ae039).distortionConfig,\n        (0, $06de6887437e6fa7$export$2e2bcd8739ae039).displacementConfig,\n        $cfcb4d6877bfaba2$var$COLOR_CONFIG\n    ];\n    defaultValues = {\n        n: 51,\n        layers: 11,\n        colorPerLayer: true,\n        multicolorRange: 203,\n        multicolorStart: 137,\n        ringSize: 0.47,\n        rotation: 0.25,\n        distortion: 0.38,\n        displacementFunc: 'fastInOut',\n        displacementMag: 1.8,\n        displacementFastArea: 0.43,\n        layerSpread: 'distance',\n        layerDistance: 1\n    };\n    color;\n    getCalc(options) {\n        const circleConfig = {\n            size: options.size,\n            n: this.config.n,\n            margin: this.config.margin,\n            rotation: this.config.rotation,\n            distortion: this.config.distortion,\n            displacementFunc: this.config.displacementFunc,\n            displacementMag: this.config.displacementMag,\n            displacementFastArea: this.config.displacementFastArea\n        };\n        return {\n            circle: new (0, $06de6887437e6fa7$export$2e2bcd8739ae039)(circleConfig)\n        };\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        if (!this.stepCount) this.stepCount = this.getStepCount();\n        const { isMultiColor: isMultiColor, colorCount: colorCount, layers: layers, colorPerLayer: colorPerLayer } = this.config;\n        const realColorCount = isMultiColor ? colorPerLayer ? layers : Math.min(colorCount, layers) : 1;\n        this.color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)({\n            ...this.config,\n            isMultiColor: isMultiColor,\n            colorCount: realColorCount\n        });\n    }\n    getAspectRatio(calcOptions) {\n        const calc = this.getCalc(calcOptions);\n        return calc.circle.getAspectRatio();\n    }\n    getLayerRingDistance(layerIndex) {\n        const spread = $cfcb4d6877bfaba2$var$spreadModes[this.config.layerSpread];\n        if (!spread) throw new Error(`Invalid spread mode, \"${this.config.layerSpread}\"!`);\n        return spread.f(layerIndex, this.config);\n    }\n    getLayerRingStepCount(layerIndex) {\n        const layerRingDistance = this.getLayerRingDistance(layerIndex);\n        return (this.config.n - layerRingDistance + 1) * 2 - 1;\n    }\n    *drawLayer(renderer, layerIndex = 0) {\n        const { n: n } = this.config;\n        const ringDistance = this.getLayerRingDistance(layerIndex);\n        const stepCount = n - ringDistance + 1;\n        let prevPoint = this.calc.circle.getPoint(0);\n        let prevPointIndex = 0;\n        renderer.setColor(this.color.getColor(layerIndex));\n        for(let i = 0; i < n - ringDistance + 1; i++){\n            const pointIndex = i + ringDistance;\n            const point = this.calc.circle.getPoint(pointIndex);\n            renderer.renderLine(prevPoint, point);\n            yield;\n            if (i !== stepCount - 1) {\n                prevPointIndex = i + 1;\n                prevPoint = this.calc.circle.getPoint(prevPointIndex);\n                renderer.renderLine(point, prevPoint);\n                yield;\n            }\n        }\n    }\n    *drawStrings(renderer) {\n        for(let layer = 0; layer < this.config.layers; layer++)yield* this.drawLayer(renderer, layer);\n    }\n    getStepCount() {\n        if (this.stepCount) return this.stepCount;\n        const { layers: layers } = this.config;\n        return new Array(layers).fill(0).reduce((totalStepCount, _, layerIndex)=>totalStepCount + this.getLayerRingStepCount(layerIndex), 0);\n    }\n    getNailCount() {\n        return this.config.n;\n    }\n    drawNails(nails) {\n        this.calc.circle.drawNails(nails);\n    }\n    thumbnailConfig = ({ n: n, layers: layers })=>({\n            n: Math.min(n, n % 2 ? 29 : 28),\n            layers: Math.min(layers, 8)\n        });\n}\n\n\n\n\n\n\n\n\n\n\n\nclass $47fd6f35b394300f$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'sun';\n    name = 'Sun';\n    id = 'sun';\n    controls = [\n        {\n            key: 'starGroup',\n            label: 'Star',\n            type: 'group',\n            children: [\n                ...(0, $b103c63dc979d40c$export$c4f94c8b3850a5a9)([\n                    ...(0, $a643183efb8a0ce0$export$2e2bcd8739ae039).StarConfig,\n                    (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n                        defaults: {\n                            isMultiColor: true,\n                            multicolorRange: 1,\n                            multicolorStart: 237,\n                            color: '#ffffff',\n                            saturation: 40,\n                            multicolorByLightness: true,\n                            minLightness: 20,\n                            maxLightness: 97\n                        },\n                        exclude: [\n                            'colorCount'\n                        ]\n                    })\n                ], 'sides', [\n                    {\n                        key: 'layers',\n                        label: 'Layers',\n                        defaultValue: 4,\n                        type: 'range',\n                        attr: {\n                            min: 1,\n                            max: 20,\n                            step: 1\n                        },\n                        isStructural: true\n                    },\n                    {\n                        key: 'layerSpread',\n                        label: 'Layer spread',\n                        defaultValue: 0.1625,\n                        type: 'range',\n                        displayValue: ({ layerSpread: layerSpread })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(layerSpread),\n                        attr: {\n                            min: 0.01,\n                            max: 1,\n                            step: 0.02\n                        },\n                        show: ({ layers: layers })=>layers !== 1,\n                        isStructural: true\n                    },\n                    {\n                        key: 'starRadius',\n                        label: 'Star Radius',\n                        defaultValue: 1,\n                        type: 'range',\n                        displayValue: ({ starRadius: starRadius })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(starRadius),\n                        attr: {\n                            min: 0.2,\n                            max: 1,\n                            step: 0.01\n                        },\n                        isStructural: true,\n                        affectsStepCount: false\n                    }\n                ])\n            ]\n        },\n        {\n            key: 'backdrop',\n            label: 'Backdrop',\n            type: 'group',\n            children: [\n                {\n                    key: 'backdropSize',\n                    label: 'Backdrop size',\n                    defaultValue: 0.5,\n                    type: 'range',\n                    displayValue: ({ backdropSize: backdropSize })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(backdropSize),\n                    attr: {\n                        min: 0,\n                        max: 1,\n                        step: ({ sideNails: sideNails })=>1 / sideNails\n                    },\n                    isStructural: true\n                },\n                {\n                    key: 'backdropRadius',\n                    label: 'Backdrop radius',\n                    defaultValue: 1,\n                    type: 'range',\n                    displayValue: ({ backdropRadius: backdropRadius })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(backdropRadius),\n                    attr: {\n                        min: 0,\n                        max: 1,\n                        step: 0.01\n                    },\n                    isStructural: true,\n                    affectsStepCount: false\n                },\n                {\n                    key: 'backdropShift',\n                    label: 'Backdrop shift',\n                    defaultValue: 0,\n                    type: 'range',\n                    displayValue: ({ backdropShift: backdropShift })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(backdropShift),\n                    attr: {\n                        min: 0,\n                        max: 1,\n                        step: ({ sideNails: sideNails, backdropSize: backdropSize })=>(1 / (sideNails * (1 - backdropSize))).toFixed(3)\n                    },\n                    isStructural: true,\n                    affectsStepCount: false,\n                    affectsNails: false\n                },\n                {\n                    key: 'backdropSkip',\n                    label: 'Backdrop skip',\n                    description: \"If yes, connections in the backdrop are from the backdrop's nail to the second-nearest side, not the ones near it\",\n                    defaultValue: false,\n                    type: 'checkbox',\n                    isStructural: true,\n                    affectsStepCount: false,\n                    show: ({ sides: sides })=>sides > 3\n                },\n                (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n                    defaults: {\n                        isMultiColor: true,\n                        multicolorRange: 20,\n                        multicolorStart: 0,\n                        color: '#ffffff',\n                        saturation: 57,\n                        multicolorByLightness: true,\n                        minLightness: 20,\n                        maxLightness: 40\n                    },\n                    propMapper: ({ key: key, show: show })=>{\n                        const newKey = 'backdrop' + key[0].toUpperCase() + key.slice(1);\n                        const control = {\n                            key: 'backdrop' + key[0].toUpperCase() + key.slice(1),\n                            show: show ? ({ backdropIsMultiColor: backdropIsMultiColor })=>key === 'color' ? !backdropIsMultiColor : backdropIsMultiColor : null\n                        };\n                        if (key === 'multicolorRange') control.attr = {\n                            start: ({ backdropMulticolorStart: backdropMulticolorStart })=>backdropMulticolorStart,\n                            type: 'range'\n                        };\n                        return control;\n                    },\n                    groupLabel: 'Backdrop color',\n                    maxColorCount: 2\n                })\n            ]\n        }\n    ];\n    getCommonControls() {\n        return (0, $b103c63dc979d40c$export$c4f94c8b3850a5a9)(super.getCommonControls(), 'nailsColor', [\n            {\n                key: 'backdropNailsColor',\n                label: 'Backdrop nails color',\n                type: 'color',\n                defaultValue: '#ffffff',\n                show: ({ showNails: showNails })=>showNails,\n                affectsStrings: false\n            },\n            {\n                key: 'backdropNailsRadius',\n                label: 'Backdrop nails radius',\n                type: 'range',\n                defaultValue: 1.5,\n                attr: {\n                    min: 0.5,\n                    max: 5,\n                    step: 0.25\n                },\n                show: ({ showNails: showNails })=>showNails,\n                affectsStrings: false\n            }\n        ]);\n    }\n    #color;\n    #backdropColor;\n    defaultValues = {\n        sideNails: 50,\n        sides: 16,\n        layers: 4,\n        layerSpread: 0.77,\n        backdropSize: 0.26,\n        backdropRadius: 0.9,\n        backdropShift: 0.59,\n        backdropColorCount: 2,\n        centerRadius: 0.2,\n        maxCurveSize: 0.64,\n        rotation: 0.5,\n        saturation: 73,\n        multicolorStart: 206,\n        multicolorRange: 1,\n        multicolorByLightness: true,\n        minLightness: 35,\n        maxLightness: 100,\n        nailsColor: '#000000',\n        backdropNailsColor: '#ffffff',\n        backdropNailsRadius: 2.275\n    };\n    getCalc({ size: size }) {\n        const { margin: margin = 0, sideNails: sideNails, backdropRadius: backdropRadiusConfig = 1, backdropSize: backdropSize, rotation: rotation, sides: sides, starRadius: starRadiusConfig = 1 } = this.config;\n        const center = (0, $b683a3137b30eaa9$export$c91255cadecfe081)(size);\n        const radius = Math.min(...center) - margin;\n        const starRadius = backdropSize && starRadiusConfig < backdropRadiusConfig ? radius * starRadiusConfig / backdropRadiusConfig : radius;\n        const backdropRadius = backdropRadiusConfig < starRadiusConfig ? radius * backdropRadiusConfig / starRadiusConfig : radius;\n        const starConfig = {\n            ...this.config,\n            radius: starRadius,\n            size: size\n        };\n        const circleConfig = {\n            size: size,\n            n: sides,\n            rotation: -1 / sides / 2 + (rotation ? rotation / sides : 0),\n            radius: backdropRadius\n        };\n        return {\n            backdropNails: Math.floor(sideNails * backdropSize),\n            star: new (0, $a643183efb8a0ce0$export$2e2bcd8739ae039)(starConfig),\n            circle: new (0, $06de6887437e6fa7$export$2e2bcd8739ae039)(circleConfig)\n        };\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        const { layers: layers, backdropColorCount: backdropColorCount } = this.config;\n        this.#color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)({\n            ...this.config,\n            colorCount: layers\n        });\n        // @ts-ignore this is fine for now, until the color config is managed in a single control\n        this.#backdropColor = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)({\n            ...(0, $c29d66861308df7e$export$781522908e4e76a1)(this.config, (key)=>{\n                const match = key.match(/^backdrop(\\w)(.+)/);\n                return match ? match[1].toLowerCase() + match[2] : key;\n            }),\n            colorCount: backdropColorCount\n        });\n    }\n    getAspectRatio(options) {\n        const calc = this.getCalc(options);\n        const boundingRect = (0, $b683a3137b30eaa9$export$1d3cc206d049790e)(calc.circle.getBoundingRect(), calc.star.getBoundingRect());\n        return (0, $b683a3137b30eaa9$export$d2646d47608819e2)(boundingRect);\n    }\n    *drawStar(renderer, size) {\n        yield* this.calc.star.drawStrings(renderer, {\n            size: size\n        });\n    }\n    *generateLayers(renderer) {\n        const { layers: layers } = this.config;\n        for(let layer = 0; layer < layers; layer++){\n            const color = this.#color.getColor(layer);\n            renderer.setColor(color);\n            const layerSize = this.#getLayerSize(layer);\n            yield* this.drawStar(renderer, layerSize);\n        }\n    }\n    *drawBackdrop(renderer) {\n        // For each side, add a nail between two star sides, at the specified backdropRadius.\n        // For the backdrop size, connect the nail to the number of points in the star for the two sides near the backdrop nail\n        const { backdropNails: backdropNails, circle: circle, star: star } = this.calc;\n        const { sides: sides, backdropShift: backdropShift, sideNails: sideNails, backdropSkip: backdropSkip } = this.config;\n        const shouldSkip = backdropSkip && sides > 3;\n        let prevPoint;\n        let currentSide = 0;\n        const shift = Math.floor(backdropShift * (sideNails - backdropNails));\n        let currentSideIndex = shift + backdropNails - 1;\n        for(let side = 0; side < sides; side++){\n            renderer.setColor(this.#backdropColor.getColor(side % 2 ? 0 : 1));\n            const backdropPoint = circle.getPoint(shouldSkip ? (side + 1) % sides : side);\n            let alternate = false;\n            const direction = side % 2 ? 1 : -1; // 1 if backdrop threading starts at the bottom and goes up, -1 if it goes down\n            prevPoint = star.getSidePoint(side, currentSideIndex);\n            for(let i = 0; i < backdropNails; i++){\n                renderer.renderLine(prevPoint, backdropPoint);\n                yield;\n                currentSide = (alternate ? side : side + (shouldSkip ? 3 : 1)) % sides;\n                prevPoint = star.getSidePoint(currentSide, currentSideIndex);\n                renderer.renderLine(backdropPoint, prevPoint);\n                yield;\n                if (i < backdropNails - 1) {\n                    alternate = !alternate;\n                    currentSideIndex += direction;\n                    const nextPoint = star.getSidePoint(currentSide, currentSideIndex);\n                    renderer.renderLine(prevPoint, nextPoint);\n                    prevPoint = nextPoint;\n                }\n            }\n        }\n    }\n    *drawStrings(renderer) {\n        yield* this.drawBackdrop(renderer);\n        yield* this.generateLayers(renderer);\n    }\n    drawNails(nails) {\n        const { backdropSize: backdropSize, backdropNailsColor: backdropNailsColor, backdropNailsRadius: backdropNailsRadius } = this.config;\n        this.calc.star.drawNails(nails);\n        if (backdropSize) {\n            const backdropNailsGroup = new (0, $d8b2fd23c47cc34c$export$2e2bcd8739ae039)({\n                color: backdropNailsColor,\n                radius: backdropNailsRadius\n            });\n            this.calc.circle.drawNails(backdropNailsGroup);\n            nails.addGroup(backdropNailsGroup);\n        }\n    }\n    #getLayerSize(layer) {\n        const { layers: layers, layerSpread: layerSpread, sideNails: sideNails } = this.config;\n        return Math.max(1, sideNails - layer * Math.max(1, Math.floor(sideNails / layers * layerSpread)));\n    }\n    getStepCount(options) {\n        const { layers: layers, sides: sides } = this.config;\n        const { backdropNails: backdropNails } = this.getCalc(options);\n        const backdropStepCount = sides * backdropNails * 2;\n        let stepCount = backdropStepCount;\n        for(let layer = 0; layer < layers; layer++){\n            const layerSize = this.#getLayerSize(layer);\n            stepCount += (0, $a643183efb8a0ce0$export$2e2bcd8739ae039).getStepCount(this.config, {\n                size: layerSize\n            });\n        }\n        return stepCount;\n    }\n    thumbnailConfig = ({ sideNails: sideNails, backdropNailsRadius: backdropNailsRadius })=>({\n            sideNails: Math.min(sideNails, 10),\n            backdropNailsRadius: Math.min(backdropNailsRadius, 0.5)\n        });\n}\n\n\n\n\n\n\n\n\n\n\nclass $54d330e2d674b207$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'lotus';\n    name = 'Lotus';\n    id = 'lotus';\n    controls = [\n        {\n            key: 'sides',\n            label: 'Sides',\n            description: 'How many petals there are in the Lotus',\n            type: 'range',\n            defaultValue: 18,\n            attr: {\n                min: 5,\n                max: 64,\n                step: 1\n            },\n            isStructural: true\n        },\n        {\n            key: 'density',\n            label: 'Density',\n            type: 'range',\n            defaultValue: 15,\n            attr: {\n                min: 1,\n                max: 30,\n                step: 1\n            },\n            isStructural: true\n        },\n        (0, $b103c63dc979d40c$export$2d97e2da46663803)((0, $06de6887437e6fa7$export$2e2bcd8739ae039).rotationConfig, 'snap'),\n        {\n            key: 'removeSections',\n            label: 'Remove sections',\n            type: 'range',\n            attr: {\n                min: 0,\n                max: 1,\n                step: ({ sides: sides, renderCenter: renderCenter })=>1 / $54d330e2d674b207$var$getSectionCountToRemove(sides, renderCenter)\n            },\n            defaultValue: 4 / 7,\n            displayValue: ({ removeSections: removeSections, sides: sides, renderCenter: renderCenter })=>Math.round(removeSections * $54d330e2d674b207$var$getSectionCountToRemove(sides, renderCenter)),\n            isStructural: true\n        },\n        {\n            key: 'renderCenter',\n            label: 'Render center',\n            type: 'checkbox',\n            defaultValue: true,\n            isStructural: true\n        },\n        {\n            key: 'centerRadius',\n            label: 'Center radius',\n            type: 'range',\n            defaultValue: 1,\n            attr: {\n                min: 0,\n                max: 1,\n                step: 0.01\n            },\n            displayValue: ({ centerRadius: centerRadius })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(centerRadius),\n            show: ({ renderCenter: renderCenter })=>renderCenter,\n            isStructural: true,\n            affectsStepCount: false\n        },\n        {\n            key: 'renderCenterNails',\n            label: 'Render center nails',\n            type: 'checkbox',\n            defaultValue: false,\n            isStructural: true,\n            show: ({ renderCenter: renderCenter })=>renderCenter\n        },\n        (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n            defaults: {\n                isMultiColor: true,\n                multicolorStart: 20,\n                multicolorRange: 26,\n                multicolorByLightness: true,\n                minLightness: 32,\n                maxLightness: 85,\n                saturation: 100,\n                colorCount: 6,\n                mirrorColors: true\n            },\n            customControls: [\n                {\n                    key: 'radialColor',\n                    label: 'Radial color',\n                    defaultValue: false,\n                    type: 'checkbox',\n                    affectsNails: false,\n                    affectsStepCount: false\n                }\n            ],\n            maxColorCount: 32\n        })\n    ];\n    defaultValues = {\n        nailsColor: '#a08346'\n    };\n    #color;\n    getCalc({ size: size }) {\n        const { sides: sides, density: density, margin: margin, rotation: rotation, removeSections: removeSections, centerRadius: centerRadiusPercent, renderCenter: renderCenter } = this.config;\n        const d = 0.5; // The helper circle's center is right between the pattern center and the edge\n        const center = (0, $b683a3137b30eaa9$export$c91255cadecfe081)(size);\n        let radius = Math.min(...size) * d / 2;\n        const sideAngle = (0, $e2b746416d2bf62b$export$f4644083ce95e7e3) / sides;\n        const densityNailCount = density * sides;\n        const baseCircleConfig = {\n            n: densityNailCount,\n            center: [\n                0,\n                0\n            ],\n            size: [\n                0,\n                0\n            ],\n            radius: 0,\n            rotation: 0\n        };\n        let petalSectionsToRemove = 0;\n        if (removeSections) {\n            const maxPetalSectionsToRemove = $54d330e2d674b207$var$getSectionCountToRemove(sides, renderCenter);\n            petalSectionsToRemove = Math.min(maxPetalSectionsToRemove, Math.round(removeSections * maxPetalSectionsToRemove));\n            const angleStart = sideAngle * petalSectionsToRemove;\n            // Since we removed sections and now the pattern is smaller than the canvas size, we fit the remaining shape to fit on canvas\n            // this is done by:\n            // 1. Calculating the new outer edge of the shape, after removing sections\n            // 2. Increase the size of the circles that create petals by the inverse ratio of the new to original size\n            // 3. Since the circles are now larger, increase the number of nails in the circles by the size ratio, to maintain density.\n            const topSectionHeight = 2 * radius * Math.sin((Math.PI - angleStart) / 2);\n            const fitAspectRatio = (2 * radius - margin) / topSectionHeight;\n            baseCircleConfig.n = removeSectionsNailCount(fixNailsCount(densityNailCount * fitAspectRatio), petalSectionsToRemove);\n            radius *= fitAspectRatio;\n            Object.assign(baseCircleConfig, {\n                angleStart: angleStart,\n                angleEnd: (0, $e2b746416d2bf62b$export$f4644083ce95e7e3) - angleStart\n            });\n        }\n        Object.assign(baseCircleConfig, {\n            size: [\n                radius - margin / 2,\n                radius - margin / 2\n            ],\n            radius: radius - margin / 2\n        });\n        // Draw circles around the center point. For this, create a helper Circle, so its points can be used as centers for the lotus circles:\n        const helperCircle = new (0, $06de6887437e6fa7$export$2e2bcd8739ae039)({\n            n: sides,\n            size: size.map((v)=>v * d - margin),\n            center: center,\n            radius: radius - margin / 2,\n            rotation: rotation\n        });\n        const circles = (0, $c190f550efa69733$export$7f1ebd623f131021)(sides, (i)=>new (0, $06de6887437e6fa7$export$2e2bcd8739ae039)({\n                ...baseCircleConfig,\n                center: helperCircle.getPoint(i),\n                rotation: rotation - i / sides\n            }));\n        const calc = {\n            circles: circles,\n            circleNailsCount: baseCircleConfig.n,\n            sideAngle: sideAngle,\n            sections: $54d330e2d674b207$var$getSectionsCount(sides),\n            removedSections: petalSectionsToRemove,\n            nailsPerSection: Math.floor(baseCircleConfig.n / (sides - 2 * petalSectionsToRemove)),\n            nailsPerCircle: baseCircleConfig.n,\n            center: center\n        };\n        if (renderCenter && centerRadiusPercent) {\n            // If a center radius value larger than 0 is configured, the inner section's connect point isn't the center of the pattern,\n            // but points around it, so we create a circle to function as points for the inner section patches to connect to.\n            const lastSection = calc.sections - 1 - calc.removedSections;\n            const maxCenterRadiusPoint = circles[0].getPoint(lastSection * calc.nailsPerSection);\n            const maxCenterRadius = Math.floor((0, $e2b746416d2bf62b$export$27796bb1a51212b7)(helperCircle.center, maxCenterRadiusPoint));\n            const centerCircleRadius = centerRadiusPercent * maxCenterRadius;\n            calc.centerCircle = new (0, $06de6887437e6fa7$export$2e2bcd8739ae039)({\n                n: sides,\n                center: helperCircle.center,\n                size: [\n                    centerCircleRadius,\n                    centerCircleRadius\n                ],\n                radius: centerCircleRadius,\n                rotation: rotation + -Math.ceil((sides - 4) / 2) / 2 / sides\n            });\n        }\n        return calc;\n        function fixNailsCount(nailsCount) {\n            return Math.max(sides, nailsCount - nailsCount % sides);\n        }\n        function removeSectionsNailCount(fullCircleNailCount, sectionsToRemove) {\n            return Math.round(fullCircleNailCount * (1 - 2 * sectionsToRemove / sides) + 1);\n        }\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        let colorCount = this.config.radialColor ? this.calc.sections - this.calc.removedSections - 1 : this.config.colorCount;\n        if (!this.config.renderCenter && this.config.radialColor) colorCount--;\n        this.#color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)({\n            ...this.config,\n            colorCount: colorCount\n        });\n    }\n    getAspectRatio(options) {\n        const calc = this.getCalc(options);\n        const boundingRect = (0, $b683a3137b30eaa9$export$1d3cc206d049790e)(...calc.circles.map((c)=>c.getBoundingRect()));\n        return (0, $b683a3137b30eaa9$export$d2646d47608819e2)(boundingRect);\n    }\n    #getPatchColor(circleIndex, section) {\n        const { radialColor: radialColor } = this.config;\n        const { removedSections: removedSections } = this.calc;\n        return this.#color.getColor(radialColor ? section - removedSections : circleIndex);\n    }\n    *#drawPatch(renderer, circleIndex, section) {\n        const { sides: sides } = this.config;\n        const { circles: circles, sections: sections, nailsPerSection: nailsPerSection, nailsPerCircle: nailsPerCircle, removedSections: removedSections } = this.calc;\n        const color = this.#getPatchColor(circleIndex, section);\n        const circle = circles[circleIndex];\n        renderer.setColor(color);\n        const prevCircle = this.calc.circles[circleIndex === 0 ? sides - 1 : circleIndex - 1];\n        if (section === 0) {\n            // For first section (outtermost): connectPoint is `prevCircle[sideAngle * 2]\n            const connectPoint = prevCircle.getPoint(nailsPerSection * 2);\n            for(let i = nailsPerCircle - nailsPerSection; i < nailsPerCircle; i++){\n                renderer.renderLine(circle.getPoint(i), connectPoint);\n                yield;\n            }\n            for(let i = 0; i <= nailsPerSection; i++){\n                renderer.renderLine(circle.getPoint(i), connectPoint);\n                yield;\n            }\n        } else {\n            // For middle sections, connectPoint is `circleIndex - 1`, (sideAngle * section + 1). Connect circleIndex[section] and `circleIndex + section`[section]\n            const isLastSection = section === sections - 2;\n            const connectPoint = isLastSection && this.calc.centerCircle ? this.calc.centerCircle.getPoint(circleIndex) : prevCircle.getPoint(nailsPerSection * (section + 2 - removedSections) - (sides % 2 && section === sections - 2 ? nailsPerSection / 2 : 0));\n            const firstCircle = circles[(circleIndex + section) % sides];\n            const firstCircleStart = nailsPerCircle - (section + 1 - removedSections) * nailsPerSection - (removedSections ? 1 : 0);\n            for(let i = 0; i <= nailsPerSection; i++){\n                renderer.renderLine(firstCircle.getPoint(firstCircleStart + i), connectPoint);\n                yield;\n            }\n            const startIndex = (section - removedSections) * nailsPerSection + 1;\n            for(let i = startIndex; i < startIndex + nailsPerSection; i++){\n                renderer.renderLine(circle.getPoint(i), connectPoint);\n                yield;\n            }\n        }\n    }\n    *drawStrings(renderer) {\n        for (const { side: side, section: section } of this.#generatePatches())yield* this.#drawPatch(renderer, side, section);\n    }\n    *#generatePatches() {\n        const { radialColor: radialColor, sides: sides, renderCenter: renderCenter } = this.config;\n        const { sections: sections, removedSections: removedSections } = this.calc;\n        const lastSection = sections - (renderCenter ? 1 : 2);\n        if (radialColor) {\n            for(let section = removedSections; section < lastSection; section++)for(let side = 0; side < sides; side++)yield {\n                side: side,\n                section: section\n            };\n        } else {\n            for(let side = 0; side < sides; side++)for(let section = removedSections; section < lastSection; section++)yield {\n                side: side,\n                section: section\n            };\n        }\n    }\n    drawNails(nails) {\n        const { renderCenter: renderCenter, renderCenterNails: renderCenterNails } = this.config;\n        const { circles: circles, centerCircle: centerCircle, nailsPerCircle: nailsPerCircle } = this.calc;\n        if (renderCenter) {\n            if (centerCircle) centerCircle.drawNails(nails);\n            else nails.addNail('C', this.calc.center);\n        }\n        circles.forEach((circle, i)=>{\n            const circleIndexStart = centerCircle.config.n + nailsPerCircle * i;\n            circle.drawNails(nails, {\n                getUniqueKey: (k)=>circleIndexStart + k,\n                excludedNailRanges: renderCenterNails ? null : this.#getCenterExcludedNails()\n            });\n        });\n    }\n    #getCenterExcludedNails() {\n        const { renderCenter: renderCenter } = this.config;\n        const { sections: sections, nailsPerSection: nailsPerSection, nailsPerCircle: nailsPerCircle, removedSections: removedSections } = this.calc;\n        const innerSectionNailsStart = (sections - 1 - removedSections - (renderCenter ? 0 : 1)) * nailsPerSection + 1;\n        const innerSectionNailsEnd = nailsPerCircle - innerSectionNailsStart;\n        return [\n            [\n                innerSectionNailsStart,\n                innerSectionNailsEnd\n            ]\n        ];\n    }\n    getStepCount(options) {\n        const { nailsPerSection: nailsPerSection, sections: sections, removedSections: removedSections } = this.getCalc(options);\n        const { sides: sides } = this.config;\n        const patchCount = 2 * nailsPerSection + 1;\n        const sideStepCount = patchCount * (sections - removedSections - 1);\n        return sides * sideStepCount;\n    }\n    thumbnailConfig = ({ density: density })=>({\n            density: Math.min(density, 5)\n        });\n}\nfunction $54d330e2d674b207$var$getSectionsCount(sides) {\n    return sides % 2 ? Math.ceil(sides / 2) : sides / 2;\n}\nfunction $54d330e2d674b207$var$getSectionCountToRemove(sides, renderCenter) {\n    return $54d330e2d674b207$var$getSectionsCount(sides) - (renderCenter ? 2 : 3);\n}\n\n\n\n\n\n\n\n\nconst $e483398e368102d0$var$COLOR_CONFIG = (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n    defaults: {\n        isMultiColor: true,\n        colorCount: 7,\n        color: '#ffbb29',\n        multicolorRange: 21,\n        multicolorStart: 32,\n        multicolorByLightness: true,\n        minLightness: 36,\n        maxLightness: 98\n    }\n});\nfunction $e483398e368102d0$var$getShapeControlsGroup(label, shapeIndex) {\n    return {\n        key: `shape${shapeIndex}`,\n        label: label,\n        type: 'group',\n        // @ts-ignore\n        children: [\n            {\n                key: `shape${shapeIndex}Type`,\n                label: 'Type',\n                type: 'select',\n                defaultValue: 'circle',\n                options: [\n                    {\n                        value: 'circle',\n                        label: 'Circle'\n                    },\n                    {\n                        value: 'polygon',\n                        label: 'Polygon'\n                    }\n                ],\n                isStructural: true\n            },\n            shapeIndex === 2 ? {\n                key: `shape${shapeIndex}Size`,\n                label: 'Size',\n                type: 'range',\n                attr: {\n                    min: 0.1,\n                    max: 1,\n                    step: 0.01\n                },\n                defaultValue: 1,\n                displayValue: (config)=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(config[`shape${shapeIndex}Size`]),\n                isStructural: true,\n                affectsStepCount: false\n            } : undefined,\n            {\n                key: `shape${shapeIndex}Sides`,\n                label: 'Sides',\n                type: 'range',\n                attr: {\n                    min: 3,\n                    max: 24,\n                    step: 1\n                },\n                defaultValue: 7,\n                isStructural: true,\n                show: (config)=>config[`shape${shapeIndex}Type`] === 'polygon'\n            },\n            {\n                ...(0, $06de6887437e6fa7$export$2e2bcd8739ae039).distortionConfig,\n                key: `shape${shapeIndex}Distortion`,\n                show: (config)=>config[`shape${shapeIndex}Type`] === 'circle'\n            },\n            shapeIndex === 2 ? {\n                key: 'identicalNailCount',\n                label: 'Nail count as outer shape',\n                type: 'checkbox',\n                defaultValue: false,\n                isStructural: true\n            } : null,\n            {\n                key: `shape${shapeIndex}NailCount`,\n                label: 'Nail count',\n                type: 'range',\n                attr: {\n                    min: 3,\n                    max: 400,\n                    step: 1\n                },\n                defaultValue: 100,\n                isStructural: true,\n                show: ({ identicalNailCount: identicalNailCount })=>shapeIndex === 1 || !identicalNailCount\n            },\n            {\n                key: `shape${shapeIndex}Rotation`,\n                label: 'Rotation',\n                type: 'range',\n                attr: {\n                    min: 0,\n                    max: 1,\n                    step: 0.0027\n                },\n                defaultValue: 0,\n                displayValue: (config)=>(0, $96d8651f67c6b219$export$b5632b5e53e50dc)(config[`shape${shapeIndex}Rotation`]),\n                isStructural: true\n            }\n        ].filter(Boolean)\n    };\n}\nclass $e483398e368102d0$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'dance_of_planets';\n    name = 'Dance of Planets';\n    id = 'dance_of_planets';\n    controls = [\n        $e483398e368102d0$var$getShapeControlsGroup('Outer shape', 1),\n        $e483398e368102d0$var$getShapeControlsGroup('Inner shape', 2),\n        {\n            type: 'range',\n            key: 'rounds',\n            label: 'Rounds',\n            attr: {\n                min: 1,\n                max: 30,\n                step: 1\n            },\n            defaultValue: 1,\n            affectsNails: false\n        },\n        {\n            key: 'reverse',\n            type: 'checkbox',\n            label: 'Reverse order',\n            description: 'If on, while the first shape advances in one direction, the second shape advances in the opposite direction',\n            defaultValue: false,\n            isStructural: false,\n            affectsNails: false\n        },\n        $e483398e368102d0$var$COLOR_CONFIG\n    ];\n    defaultValues = {\n        shape1Type: 'circle',\n        shape1NailCount: 150,\n        shape1Rotation: 0,\n        shape2Type: 'circle',\n        shape2Size: 0.8,\n        shape2NailCount: 117,\n        shape2Distortion: -0.12,\n        shape2Rotation: 0.216,\n        rounds: 2,\n        multicolorRange: 132,\n        multicolorStart: 198,\n        isMultiColor: true,\n        multicolorByLightness: false,\n        colorCount: 2\n    };\n    color;\n    colorMap;\n    getCalc({ size: size }) {\n        const { margin: margin } = this.config;\n        const center = (0, $b683a3137b30eaa9$export$c91255cadecfe081)(size);\n        function getShape({ type: type, diameter: diameter = 1, nailCount: nailCount, sides: sides, rotation: rotation = 0, distortion: distortion }) {\n            if (type === 'circle') return new (0, $06de6887437e6fa7$export$2e2bcd8739ae039)({\n                size: (0, $b683a3137b30eaa9$export$c566af9defc62c6)(size, (v)=>v * diameter),\n                n: Math.round(nailCount),\n                radius: Math.min(...size) * diameter / 2,\n                center: center,\n                margin: margin,\n                reverse: true,\n                rotation: rotation,\n                distortion: distortion\n            });\n            else {\n                sides = sides ?? 3;\n                nailCount = Math.max(nailCount, sides);\n                return new (0, $cf574edfbef72605$export$2e2bcd8739ae039)({\n                    size: (0, $b683a3137b30eaa9$export$c566af9defc62c6)(size, (v)=>v * diameter),\n                    sides: sides ?? 3,\n                    nailsPerSide: Math.round(nailCount / sides),\n                    center: center,\n                    margin: margin,\n                    rotation: rotation\n                });\n            }\n        }\n        let shape1NailCount = this.#getShapeNailCount(this.config.shape1Type, this.config.shape1NailCount, this.config.shape1Sides);\n        let shape2NailCount = this.config.identicalNailCount ? shape1NailCount : this.config.shape2NailCount;\n        shape2NailCount = this.#getShapeNailCount(this.config.shape2Type, shape2NailCount, this.config.shape2Sides);\n        return {\n            shape1: getShape({\n                type: this.config.shape1Type,\n                nailCount: shape1NailCount,\n                sides: this.config.shape1Sides,\n                rotation: this.config.shape1Rotation,\n                distortion: this.config.shape1Distortion\n            }),\n            shape2: getShape({\n                type: this.config.shape2Type,\n                diameter: this.config.shape2Size,\n                nailCount: shape2NailCount,\n                sides: this.config.shape2Sides,\n                rotation: this.config.shape2Rotation,\n                distortion: this.config.shape2Distortion\n            }),\n            shape1NailCount: shape1NailCount,\n            shape2NailCount: shape2NailCount\n        };\n    }\n    #getShapeNailCount(shapeType, nailCount, sides) {\n        if (shapeType === 'circle') return nailCount;\n        return nailCount <= sides ? sides : nailCount - nailCount % sides;\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        const { colorCount: colorCount } = this.config;\n        this.color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)(this.config);\n        if (colorCount) this.colorMap = this.color.getColorMap({\n            stepCount: this.#getConnectionCount(),\n            colorCount: colorCount\n        });\n    }\n    getAspectRatio() {\n        const { shape1: shape1, shape2: shape2 } = this.calc ?? this.getCalc({\n            size: [\n                100,\n                100\n            ]\n        });\n        const rect1 = shape1.getBoundingRect();\n        const rect2 = shape2.getBoundingRect();\n        return Math.max(rect1.width, rect2.width) / Math.max(rect1.height, rect2.height);\n    }\n    #getConnectionCount() {\n        const { shape1NailCount: shape1NailCount, shape2NailCount: shape2NailCount } = this.calc;\n        const greaterNailCount = Math.max(shape1NailCount, shape2NailCount);\n        return greaterNailCount * this.config.rounds;\n    }\n    *drawStrings(renderer) {\n        const { shape1: shape1, shape2: shape2, shape1NailCount: shape1NailCount, shape2NailCount: shape2NailCount } = this.calc;\n        const { reverse: reverse } = this.config;\n        const steps = this.#getConnectionCount();\n        renderer.setColor('#ffffff');\n        renderer.setStartingPoint(shape1.getPoint(0));\n        let toShape2 = true;\n        const getShape2Index = reverse ? (step)=>shape2NailCount - (step % shape2NailCount || shape2NailCount) : (step)=>step % shape2NailCount;\n        for(let step = 0; step < steps; step++){\n            const stepColor = this.colorMap.get(step);\n            if (stepColor) renderer.setColor(stepColor);\n            renderer.lineTo(toShape2 ? shape2.getPoint(getShape2Index(step)) : shape1.getPoint(step % shape1NailCount));\n            yield;\n            if (step !== steps - 1) {\n                renderer.lineTo(toShape2 ? shape2.getPoint(getShape2Index(step + 1)) : shape1.getPoint((step + 1) % shape1NailCount));\n                yield;\n                toShape2 = !toShape2;\n            }\n        }\n    }\n    getStepCount(options) {\n        if (!this.calc) this.calc = this.getCalc(options);\n        return this.#getConnectionCount() * 2 - 1;\n    }\n    getNailCount(size) {\n        const calc = this.getCalc({\n            size: size\n        });\n        return calc.shape1NailCount + calc.shape2NailCount;\n    }\n    drawNails(nails) {\n        this.calc.shape1.drawNails(nails);\n        this.calc.shape2.drawNails(nails, {\n            getUniqueKey: (k)=>k + this.config.shape1NailCount\n        });\n    }\n    thumbnailConfig = (config)=>{\n        const MAX_NAIL_COUNT = 80;\n        // the nail count of either shape shouldn't exceed the MAX_NAIL_COUNT,\n        // but the ratio between the two counts needs to be preserved, so the pattern in the thumbnail looks similar\n        let shape1NailCount = this.#getShapeNailCount(config.shape1Type, config.shape1NailCount, config.shape1Sides);\n        let shape2NailCount = config.identicalNailCount ? shape1NailCount : config.shape2NailCount;\n        if (shape1NailCount <= MAX_NAIL_COUNT && shape2NailCount <= MAX_NAIL_COUNT) return {};\n        const ratio = shape1NailCount / shape2NailCount;\n        if (ratio >= 1) {\n            // shape1 has a larger or equal nail count than shape2\n            shape1NailCount = MAX_NAIL_COUNT;\n            shape2NailCount = MAX_NAIL_COUNT / ratio;\n        } else {\n            shape2NailCount = MAX_NAIL_COUNT;\n            shape1NailCount = MAX_NAIL_COUNT * ratio;\n        }\n        return {\n            shape1NailCount: shape1NailCount,\n            shape2NailCount: shape2NailCount\n        };\n    };\n}\n\n\n\n\n\n\n\nclass $281c51d967a471db$export$17d680238e50603e {\n    config;\n    from;\n    to;\n    /**\n   * distance between from and to, [x,y]\n   */ distance;\n    spaces;\n    constructor(config){\n        if (config.n < 1) throw new Error(`Can't create a Line with n less than 1.`);\n        this.config = config;\n        const { rotation: rotation, from: from, to: to, n: n } = config;\n        if (rotation) {\n            const rotationAngle = -(0, $e2b746416d2bf62b$export$f4644083ce95e7e3) * rotation;\n            const rotationCenter = this.#getRotationCenterCoordinates();\n            this.from = this.#rotatePoint(from, rotationCenter, rotationAngle);\n            this.to = this.#rotatePoint(to, rotationCenter, rotationAngle);\n        } else {\n            this.from = config.from;\n            this.to = config.to;\n        }\n        this.distance = [\n            this.to[0] - this.from[0],\n            this.to[1] - this.from[1]\n        ];\n        this.spaces = n - 1;\n    }\n    #getRotationCenterCoordinates() {\n        const { from: from, to: to, rotationCenter: rotationCenter } = this.config;\n        if (!rotationCenter || rotationCenter === 'center') return [\n            from[0] + (to[0] - from[0]) / 2,\n            from[1] + (to[1] - from[1]) / 2\n        ];\n        else switch(rotationCenter){\n            case 'from':\n                return from;\n            case 'to':\n                return to;\n            default:\n                return rotationCenter;\n        }\n    }\n    #rotatePoint(point, rotationCenter, rotationAngle) {\n        const xDist = point[0] - rotationCenter[0];\n        const yDist = point[1] - rotationCenter[1];\n        const pointDistanceToCenter = Math.hypot(xDist, yDist);\n        if (!pointDistanceToCenter) return point;\n        const startingAngle = Math.asin(xDist / pointDistanceToCenter) + (yDist < 0 ? Math.PI : 0);\n        return [\n            rotationCenter[0] + Math.sin(startingAngle + rotationAngle) * pointDistanceToCenter,\n            rotationCenter[1] + Math.cos(startingAngle + rotationAngle) * pointDistanceToCenter\n        ];\n    }\n    getPoint(index) {\n        const { from: from } = this;\n        return (0, $b683a3137b30eaa9$export$c566af9defc62c6)(from, (v, i)=>v + this.distance[i] * index / this.spaces);\n    }\n    drawNails(nails, { getUniqueKey: getUniqueKey } = {}) {\n        for(let i = 0; i < this.config.n; i++)nails.addNail(getUniqueKey?.(i) ?? i, this.getPoint(i));\n    }\n    getBoundingRect() {\n        const { from: from, to: to } = this;\n        return {\n            width: Math.abs(this.distance[0]),\n            height: Math.abs(this.distance[1]),\n            top: Math.min(to[1], from[1]),\n            bottom: Math.max(to[1], from[1]),\n            left: Math.min(from[0], to[0]),\n            right: Math.max(from[0], to[0])\n        };\n    }\n    getAspectRatio() {\n        const { width: width, height: height } = this.getBoundingRect();\n        return width / height;\n    }\n}\n\n\nfunction $840f8587212e5f96$export$8c6413e26c58b77c(...shapes) {\n    if (!shapes.length) return {\n        top: 0,\n        bottom: 0,\n        left: 0,\n        right: 0,\n        width: 0,\n        height: 0\n    };\n    const firstShapeRect = shapes[0].getBoundingRect();\n    if (shapes.length === 1) return firstShapeRect;\n    const rect = shapes.slice(1).reduce((rect, shape)=>{\n        const shapeBoundingRect = shape.getBoundingRect();\n        return {\n            top: Math.min(rect.top, shapeBoundingRect.top),\n            bottom: Math.max(rect.bottom, shapeBoundingRect.bottom),\n            left: Math.min(rect.left, shapeBoundingRect.left),\n            right: Math.max(rect.right, shapeBoundingRect.right),\n            width: 0,\n            height: 0\n        };\n    }, firstShapeRect);\n    Object.assign(rect, {\n        width: rect.right - rect.left,\n        height: rect.bottom - rect.top\n    });\n    return rect;\n}\n\n\n\n\n\nfunction $5671f58b0d6a3653$var$getOtherOrientationLabel(orientation) {\n    return orientation === 'h' ? 'vertical' : 'horizontal';\n}\nfunction $5671f58b0d6a3653$var$getOrientationLabel(orientation) {\n    return orientation === 'h' ? 'horizontal' : 'vertical';\n}\nclass $5671f58b0d6a3653$export$2e2bcd8739ae039 extends (0, $ed62eab3f3d51c1d$export$2e2bcd8739ae039) {\n    static type = 'crosses';\n    name = 'Crosses';\n    id = 'crosses';\n    controls = [\n        {\n            type: 'range',\n            key: 'n',\n            label: 'Nails per side',\n            attr: {\n                min: 2,\n                max: 100,\n                step: 1\n            },\n            defaultValue: 25,\n            isStructural: true\n        },\n        {\n            key: 'orientation',\n            type: 'select',\n            label: 'Orientation',\n            defaultValue: 'v',\n            options: [\n                {\n                    value: 'v',\n                    label: \"\\u2195 Vertical\"\n                },\n                {\n                    value: 'h',\n                    label: \"\\u2194 Horizontal\"\n                }\n            ],\n            affectsStepCount: false,\n            isStructural: true\n        },\n        {\n            key: 'sidesRotation',\n            type: 'range',\n            label: 'Sides rotation',\n            attr: {\n                min: -0.25,\n                max: 0.25,\n                step: 0.005,\n                snap: '0'\n            },\n            displayValue: ({ sidesRotation: sidesRotation })=>(0, $96d8651f67c6b219$export$b5632b5e53e50dc)(sidesRotation),\n            defaultValue: 0,\n            affectsStepCount: false,\n            isStructural: true\n        },\n        {\n            key: 'fineControl',\n            type: 'checkbox',\n            label: 'Fine control',\n            defaultValue: false,\n            affectsStepCount: false,\n            isStructural: true\n        },\n        {\n            key: 'lockGap',\n            type: 'checkbox',\n            label: 'Lock horizontal/vertical gap',\n            defaultValue: true,\n            isStructural: true,\n            affectsStepCount: false,\n            show: ({ fineControl: fineControl })=>!fineControl\n        },\n        {\n            key: 'lengthGap',\n            type: 'range',\n            label: ({ orientation: orientation, lockGap: lockGap })=>lockGap ? 'Gap' : `${(0, $96d8651f67c6b219$export$9a00dee1beb8f576)($5671f58b0d6a3653$var$getOrientationLabel(orientation))} gap`,\n            attr: {\n                min: 0,\n                max: 1,\n                step: 0.01\n            },\n            displayValue: ({ lengthGap: lengthGap })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(lengthGap),\n            defaultValue: 0.27,\n            affectsStepCount: false,\n            isStructural: true,\n            show: ({ fineControl: fineControl })=>!fineControl\n        },\n        {\n            key: 'widthGap',\n            type: 'range',\n            label: ({ orientation: orientation })=>`${(0, $96d8651f67c6b219$export$9a00dee1beb8f576)($5671f58b0d6a3653$var$getOtherOrientationLabel(orientation))} gap`,\n            attr: {\n                min: 0,\n                max: 5,\n                step: 0.01\n            },\n            displayValue: ({ widthGap: widthGap })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(widthGap),\n            defaultValue: 0.43,\n            affectsStepCount: false,\n            isStructural: true,\n            show: ({ lockGap: lockGap, fineControl: fineControl })=>!fineControl && !lockGap\n        },\n        {\n            key: 'center',\n            type: 'group',\n            label: \"Center \\u25C8\",\n            show: ({ fineControl: fineControl })=>fineControl,\n            children: [\n                {\n                    key: 'centerLengthSpread',\n                    type: 'range',\n                    label: ({ orientation: orientation })=>`Center ${$5671f58b0d6a3653$var$getOrientationLabel(orientation)} spread`,\n                    attr: {\n                        min: 0.2,\n                        max: 5,\n                        step: 0.01,\n                        snap: '1'\n                    },\n                    displayValue: ({ centerLengthSpread: centerLengthSpread })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(centerLengthSpread),\n                    defaultValue: 1,\n                    affectsStepCount: false,\n                    isStructural: true\n                },\n                {\n                    key: 'centerLengthGap',\n                    type: 'range',\n                    label: ({ orientation: orientation })=>`Center ${$5671f58b0d6a3653$var$getOrientationLabel(orientation)} gap`,\n                    attr: {\n                        min: 0,\n                        max: 5,\n                        step: 0.01\n                    },\n                    displayValue: ({ centerLengthGap: centerLengthGap })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(centerLengthGap),\n                    defaultValue: 0,\n                    affectsStepCount: false,\n                    isStructural: true\n                },\n                {\n                    key: 'symmetricCenter',\n                    type: 'checkbox',\n                    label: ({ orientation: orientation })=>`Symmetric ${$5671f58b0d6a3653$var$getOtherOrientationLabel(orientation)} center`,\n                    defaultValue: true,\n                    affectsStepCount: false,\n                    isStructural: true\n                },\n                {\n                    key: 'centerSpread',\n                    type: 'range',\n                    label: ({ orientation: orientation })=>`Center ${$5671f58b0d6a3653$var$getOtherOrientationLabel(orientation)} spread`,\n                    attr: {\n                        min: 0.2,\n                        max: 5,\n                        step: 0.01,\n                        snap: '1'\n                    },\n                    displayValue: ({ centerSpread: centerSpread })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(centerSpread),\n                    defaultValue: 1,\n                    affectsStepCount: false,\n                    isStructural: true,\n                    show: ({ symmetricCenter: symmetricCenter })=>symmetricCenter\n                },\n                {\n                    key: 'centerWidthGap',\n                    type: 'range',\n                    label: ({ orientation: orientation })=>`Center ${$5671f58b0d6a3653$var$getOtherOrientationLabel(orientation)} gap`,\n                    attr: {\n                        min: 0,\n                        max: 5,\n                        step: 0.01\n                    },\n                    displayValue: ({ centerWidthGap: centerWidthGap })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(centerWidthGap),\n                    defaultValue: 0,\n                    affectsStepCount: false,\n                    isStructural: true,\n                    show: ({ symmetricCenter: symmetricCenter })=>symmetricCenter\n                },\n                {\n                    key: 'centerStartSpread',\n                    type: 'range',\n                    label: ({ orientation: orientation })=>`Center ${orientation === 'v' ? 'left' : 'up'} spread`,\n                    attr: {\n                        min: 0.2,\n                        max: 5,\n                        step: 0.01,\n                        snap: '1'\n                    },\n                    displayValue: ({ centerStartSpread: centerStartSpread })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(centerStartSpread),\n                    defaultValue: 1,\n                    affectsStepCount: false,\n                    isStructural: true,\n                    show: ({ symmetricCenter: symmetricCenter })=>!symmetricCenter\n                },\n                {\n                    key: 'centerStartGap',\n                    type: 'range',\n                    label: ({ orientation: orientation })=>`Center ${orientation === 'v' ? 'left' : 'up'} gap`,\n                    attr: {\n                        min: 0,\n                        max: 5,\n                        step: 0.01\n                    },\n                    displayValue: ({ centerStartGap: centerStartGap })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(centerStartGap),\n                    defaultValue: 0,\n                    affectsStepCount: false,\n                    isStructural: true,\n                    show: ({ symmetricCenter: symmetricCenter })=>!symmetricCenter\n                },\n                {\n                    key: 'centerEndSpread',\n                    type: 'range',\n                    label: ({ orientation: orientation })=>`Center ${orientation === 'v' ? 'right' : 'down'} spread`,\n                    attr: {\n                        min: 0.2,\n                        max: 5,\n                        step: 0.01,\n                        snap: '1'\n                    },\n                    displayValue: ({ centerEndSpread: centerEndSpread })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(centerEndSpread),\n                    defaultValue: 1,\n                    affectsStepCount: false,\n                    isStructural: true,\n                    show: ({ symmetricCenter: symmetricCenter })=>!symmetricCenter\n                },\n                {\n                    key: 'centerEndGap',\n                    type: 'range',\n                    label: ({ orientation: orientation })=>`Center ${orientation === 'v' ? 'right' : 'down'} gap`,\n                    attr: {\n                        min: 0,\n                        max: 5,\n                        step: 0.01\n                    },\n                    displayValue: ({ centerEndGap: centerEndGap })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(centerEndGap),\n                    defaultValue: 0,\n                    affectsStepCount: false,\n                    isStructural: true,\n                    show: ({ symmetricCenter: symmetricCenter })=>!symmetricCenter\n                }\n            ]\n        },\n        {\n            key: 'edges',\n            label: \"Edges \\u25C5 \\u25BB\",\n            type: 'group',\n            show: ({ fineControl: fineControl })=>fineControl,\n            children: [\n                {\n                    key: 'edgesSpread',\n                    type: 'range',\n                    label: ({ orientation: orientation })=>`Edges ${$5671f58b0d6a3653$var$getOrientationLabel(orientation)} spread`,\n                    attr: {\n                        min: 0.2,\n                        max: 5,\n                        step: 0.01,\n                        snap: '1'\n                    },\n                    displayValue: ({ edgesSpread: edgesSpread })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(edgesSpread),\n                    defaultValue: 1,\n                    affectsStepCount: false,\n                    isStructural: true\n                },\n                {\n                    key: 'edgesGap',\n                    type: 'range',\n                    label: ({ orientation: orientation })=>`Edges ${$5671f58b0d6a3653$var$getOrientationLabel(orientation)} gap`,\n                    attr: {\n                        min: 0,\n                        max: 1,\n                        step: 0.01,\n                        snap: '1'\n                    },\n                    displayValue: ({ edgesGap: edgesGap })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(edgesGap),\n                    defaultValue: 0,\n                    affectsStepCount: false,\n                    isStructural: true\n                },\n                {\n                    key: 'edgesWidthSpread',\n                    type: 'range',\n                    label: ({ orientation: orientation })=>`Edges ${$5671f58b0d6a3653$var$getOtherOrientationLabel(orientation)} spread`,\n                    attr: {\n                        min: 0.2,\n                        max: 5,\n                        step: 0.01,\n                        snap: '1'\n                    },\n                    displayValue: ({ edgesWidthSpread: edgesWidthSpread })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(edgesWidthSpread),\n                    defaultValue: 1,\n                    affectsStepCount: false,\n                    isStructural: true\n                },\n                {\n                    key: 'edgesWidthGap',\n                    type: 'range',\n                    label: ({ orientation: orientation })=>`Edges ${$5671f58b0d6a3653$var$getOtherOrientationLabel(orientation)} gap`,\n                    attr: {\n                        min: 0,\n                        max: 1,\n                        step: 0.01,\n                        snap: '1'\n                    },\n                    displayValue: ({ edgesWidthGap: edgesWidthGap })=>(0, $96d8651f67c6b219$export$f481ea230fad194b)(edgesWidthGap),\n                    defaultValue: 0,\n                    affectsStepCount: false,\n                    isStructural: true\n                }\n            ]\n        },\n        (0, $44d9dab6555abf73$export$2e2bcd8739ae039).getConfig({\n            defaults: {\n                isMultiColor: true,\n                colorCount: 2,\n                color: '#ffffff',\n                multicolorRange: 1,\n                multicolorStart: 1,\n                multicolorByLightness: true,\n                minLightness: 40,\n                maxLightness: 100,\n                reverseColors: true\n            },\n            customControls: [\n                {\n                    key: 'setCenterColor',\n                    label: 'Manually set center color',\n                    defaultValue: false,\n                    type: 'checkbox',\n                    affectsNails: false,\n                    affectsStepCount: false\n                },\n                {\n                    key: 'centerColor',\n                    type: 'color',\n                    label: 'Center color',\n                    defaultValue: '#ffd500',\n                    show: ({ setCenterColor: setCenterColor })=>setCenterColor,\n                    affectsNails: false,\n                    affectsStepCount: false\n                }\n            ],\n            exclude: [\n                'repeatColors'\n            ],\n            maxColorCount: 2\n        })\n    ];\n    color;\n    getCalc({ size: size }) {\n        const { n: n, orientation: orientation, margin: margin, lengthGap: verticalGapPercent, widthGap: widthGap, lockGap: lockGap, fineControl: fineControl, centerWidthGap: centerWidthGap, centerSpread: centerSpread, symmetricCenter: symmetricCenter, centerLengthGap: centerLengthGapPercent, centerLengthSpread: centerLengthSpreadPercent, centerStartGap: centerStartGap, centerStartSpread: centerStartSpread, centerEndGap: centerEndGap, centerEndSpread: centerEndSpread, edgesGap: edgesGap, edgesSpread: edgesSpread, edgesWidthGap: edgesWidthGap, edgesWidthSpread: edgesWidthSpread, sidesRotation: sidesRotation } = this.config;\n        const center = (0, $b683a3137b30eaa9$export$c91255cadecfe081)(size);\n        const isVertical = orientation === 'v';\n        let height = (isVertical ? size[1] : size[0]) - 2 * margin;\n        const maxVerticalGap = height * 0.8 / 3;\n        let centerLengthGap = (fineControl ? centerLengthGapPercent : verticalGapPercent) * maxVerticalGap;\n        let sideLengthGap = fineControl ? (height * 0.8 - verticalGapPercent * maxVerticalGap) * edgesGap / 2 : verticalGapPercent * maxVerticalGap;\n        const centerLengthSpread = fineControl ? centerLengthSpreadPercent : 1;\n        // lineLength is for the two center vertical lines\n        let lineLength = (height - (centerLengthGap + 2 * sideLengthGap)) / (2 * (fineControl ? centerLengthSpread : 1) + 2 * (fineControl ? edgesSpread : 1));\n        let widthShift = 0;\n        // sideLineLength are the two vertical lines at the edges - top and bottom\n        let sideLineLength = fineControl ? lineLength * edgesSpread : lineLength;\n        const orientationDimensionIndex = isVertical ? 0 : 1;\n        function getBoundingRect() {\n            const getSides = (widthGap, sideLength, overrides)=>{\n                return [\n                    center[orientationDimensionIndex] - (overrides?.gap1 ?? widthGap) * lineLength - (overrides?.length1 ?? sideLength) + widthShift,\n                    center[orientationDimensionIndex] + (overrides?.gap2 ?? widthGap) * lineLength + (overrides?.length2 ?? sideLength) + widthShift\n                ];\n            };\n            const edges = fineControl ? null : getSides(lockGap ? verticalGapPercent : widthGap, lineLength);\n            const [centerStart, centerEnd] = fineControl ? getSides(centerWidthGap, centerSpread * lineLength, symmetricCenter ? undefined : {\n                gap1: centerStartGap,\n                gap2: centerEndGap,\n                length1: centerStartSpread * lineLength,\n                length2: centerEndSpread * lineLength\n            }) : edges;\n            const [edgesWidthStart, edgesWidthEnd] = fineControl ? getSides(edgesWidthGap, edgesWidthSpread * lineLength) : edges;\n            const [rotatedEdgesWidthStart, rotatedEdgesWidthEnd] = getSides(edgesWidthGap, Math.cos(sidesRotation * (0, $e2b746416d2bf62b$export$f4644083ce95e7e3)) * (fineControl ? edgesWidthSpread : 1) * lineLength);\n            const length = 2 * (sideLineLength + lineLength * centerLengthSpread + sideLengthGap) + centerLengthGap;\n            const lengthStart = center[isVertical ? 1 : 0] - length / 2;\n            const distanceToFirstEdge = centerLengthGap / 2 + lineLength * centerLengthSpread + sideLengthGap / 2 + Math.sin(sidesRotation * (0, $e2b746416d2bf62b$export$f4644083ce95e7e3)) * lineLength * edgesWidthSpread;\n            const [rotatedEdgesLegthStart, rotatedEdgesLengthEnd] = [\n                center[isVertical ? 1 : 0] - distanceToFirstEdge,\n                center[isVertical ? 1 : 0] + distanceToFirstEdge\n            ];\n            const widthStart = Math.min(rotatedEdgesWidthStart, centerStart);\n            const widthEnd = Math.max(rotatedEdgesWidthEnd, centerEnd);\n            const heightStart = Math.min(lengthStart, rotatedEdgesLegthStart);\n            const heightEnd = Math.max(lengthStart + length, rotatedEdgesLengthEnd);\n            return {\n                lengthStart: lengthStart,\n                edgesWidthStart: edgesWidthStart,\n                edgesWidthEnd: edgesWidthEnd,\n                centerStart: centerStart,\n                centerEnd: centerEnd,\n                width: widthEnd - widthStart,\n                widthStart: widthStart,\n                widthEnd: widthEnd,\n                heightStart: heightStart,\n                height: heightEnd - heightStart\n            };\n        }\n        let boundingRect = getBoundingRect();\n        const sizeWithoutMargins = size.map((v)=>v - 2 * margin);\n        const sizeWidth = sizeWithoutMargins[orientationDimensionIndex];\n        const sizeHeight = sizeWithoutMargins[isVertical ? 1 : 0];\n        const sizeRatio = Math.min(sizeWidth / boundingRect.width, sizeHeight / boundingRect.height);\n        const centeredWidthStart = center[orientationDimensionIndex] - boundingRect.width / 2;\n        let shouldRefreshBoundingRect = false;\n        const newWidthShift = Math.trunc(centeredWidthStart) - Math.trunc(boundingRect.widthStart);\n        if (newWidthShift !== widthShift) {\n            widthShift = newWidthShift;\n            shouldRefreshBoundingRect = true;\n        }\n        if (sizeRatio < 1) {\n            height *= sizeRatio;\n            centerLengthGap *= sizeRatio;\n            lineLength *= sizeRatio;\n            widthShift *= sizeRatio;\n            sideLineLength *= sizeRatio;\n            shouldRefreshBoundingRect = true;\n            sideLengthGap *= sizeRatio;\n        }\n        if (shouldRefreshBoundingRect) boundingRect = getBoundingRect();\n        const { lengthStart: lengthStart, width: width } = boundingRect;\n        function getVerticalPosition(index) {\n            let lineStart = lengthStart;\n            if (index === 0) return {\n                vertical: lineStart,\n                horizontal: -1,\n                length: sideLineLength\n            };\n            lineStart += sideLengthGap + sideLineLength;\n            if (index === 1) return {\n                vertical: lineStart,\n                horizontal: lineStart - sideLengthGap / 2,\n                length: lineLength * centerLengthSpread\n            };\n            lineStart += lineLength * centerLengthSpread + centerLengthGap;\n            if (index === 2) return {\n                vertical: lineStart,\n                horizontal: lineStart - centerLengthGap / 2,\n                length: lineLength * centerLengthSpread\n            };\n            lineStart += lineLength * centerLengthSpread + sideLengthGap;\n            return {\n                vertical: lineStart,\n                horizontal: lineStart - sideLengthGap / 2,\n                length: sideLineLength\n            };\n        }\n        const verticalPositions = (0, $c190f550efa69733$export$7f1ebd623f131021)(4, getVerticalPosition);\n        const verticalCenter = (isVertical ? center[0] : center[1]) + widthShift;\n        function getVerticalLine(index) {\n            const { vertical: vertical, length: length } = verticalPositions[index];\n            const from = [\n                verticalCenter,\n                vertical\n            ];\n            const to = [\n                verticalCenter,\n                vertical + length\n            ];\n            if (!isVertical) {\n                from.reverse();\n                to.reverse();\n            }\n            return new (0, $281c51d967a471db$export$17d680238e50603e)({\n                from: from,\n                to: to,\n                n: n\n            });\n        }\n        const verticalLines = (0, $c190f550efa69733$export$7f1ebd623f131021)(4, getVerticalLine);\n        const getRowLineRotationConfig = (row, index)=>{\n            if (!sidesRotation || row === 1) return null;\n            let rotation = sidesRotation;\n            if (!isVertical) rotation *= -1;\n            if (index === 1 && row === 0 || index === 0 && row === 2) rotation *= -1;\n            return {\n                rotation: rotation,\n                rotationCenter: 'to'\n            };\n        };\n        function getHorizontalLineLength(row, index) {\n            if (!fineControl) return lineLength;\n            if (row === 1) {\n                if (symmetricCenter) return lineLength * centerSpread;\n                return lineLength * (index === 0 ? centerStartSpread : centerEndSpread);\n            }\n            return lineLength * edgesWidthSpread;\n        }\n        const horizontalLines = (0, $c190f550efa69733$export$7f1ebd623f131021)(3, (row)=>{\n            const horizontalStart = row === 1 ? boundingRect.centerStart : boundingRect.edgesWidthStart;\n            const horizontalEnd = row === 1 ? boundingRect.centerEnd : boundingRect.edgesWidthEnd;\n            const rowTop = verticalPositions[row + 1].horizontal;\n            // In case of fine control and non-symmetric center, the center width lines (potentially) have different sizes\n            const startLength = getHorizontalLineLength(row, 0);\n            const endLength = getHorizontalLineLength(row, 1);\n            return [\n                new (0, $281c51d967a471db$export$17d680238e50603e)({\n                    ...getRowLineRotationConfig(row, 0),\n                    ...isVertical ? {\n                        from: [\n                            horizontalStart,\n                            rowTop\n                        ],\n                        to: [\n                            horizontalStart + startLength,\n                            rowTop\n                        ],\n                        n: n\n                    } : {\n                        from: [\n                            rowTop,\n                            horizontalStart\n                        ],\n                        to: [\n                            rowTop,\n                            horizontalStart + startLength\n                        ],\n                        n: n\n                    }\n                }),\n                new (0, $281c51d967a471db$export$17d680238e50603e)({\n                    ...getRowLineRotationConfig(row, 1),\n                    ...isVertical ? {\n                        from: [\n                            horizontalEnd,\n                            rowTop\n                        ],\n                        to: [\n                            horizontalEnd - endLength,\n                            rowTop\n                        ],\n                        n: n\n                    } : {\n                        from: [\n                            rowTop,\n                            horizontalEnd\n                        ],\n                        to: [\n                            rowTop,\n                            horizontalEnd - endLength\n                        ],\n                        n: n\n                    }\n                })\n            ];\n        });\n        return {\n            verticalLines: verticalLines,\n            horizontalLines: horizontalLines,\n            width: width,\n            height: height\n        };\n    }\n    setUpDraw(options) {\n        super.setUpDraw(options);\n        this.color = new (0, $44d9dab6555abf73$export$2e2bcd8739ae039)(this.config);\n    }\n    getAspectRatio() {\n        const { verticalLines: verticalLines, horizontalLines: horizontalLines } = this.calc ?? this.getCalc({\n            size: [\n                100,\n                100\n            ]\n        });\n        const boundingRect = (0, $840f8587212e5f96$export$8c6413e26c58b77c)(...verticalLines.concat(horizontalLines.flat()));\n        return boundingRect.width / boundingRect.height;\n    }\n    *connectLines(renderer, { verticalLine: verticalLine, row: row, isReverse: isReverse = false, color: color }) {\n        const { n: n } = this.config;\n        const horizontalLines = this.calc.horizontalLines[row];\n        renderer.setColor(color);\n        renderer.setStartingPoint(horizontalLines[0].getPoint(0));\n        let alternate = false;\n        let currentLine;\n        for(let i = 0; i < n; i++){\n            if (currentLine) {\n                renderer.lineTo(currentLine.getPoint(i));\n                yield;\n            }\n            renderer.lineTo(verticalLine.getPoint(isReverse ? i : n - 1 - i));\n            yield;\n            currentLine = horizontalLines[alternate ? 0 : 1];\n            renderer.lineTo(currentLine.getPoint(i));\n            yield;\n            alternate = !alternate;\n        }\n    }\n    *drawStrings(renderer) {\n        const { verticalLines: verticalLines } = this.calc;\n        const { setCenterColor: setCenterColor, centerColor: centerColor, isMultiColor: isMultiColor } = this.config;\n        const connections = [\n            [\n                0,\n                0\n            ],\n            [\n                0,\n                1\n            ],\n            [\n                1,\n                0\n            ],\n            [\n                1,\n                1\n            ],\n            [\n                3,\n                2\n            ],\n            [\n                3,\n                1\n            ],\n            [\n                2,\n                1\n            ],\n            [\n                2,\n                2\n            ],\n            [\n                1,\n                2\n            ],\n            [\n                2,\n                0\n            ]\n        ];\n        for (const [verticalIndex, horizontalRow] of connections){\n            const isReverse = horizontalRow < verticalIndex;\n            let color;\n            if (setCenterColor) {\n                const isCenter = (verticalIndex === 1 || verticalIndex === 2) && horizontalRow === 1;\n                if (isCenter) color = centerColor;\n            }\n            if (!color) color = this.color.getColor(horizontalRow > verticalIndex || verticalIndex - horizontalRow > 1 ? 1 : 0);\n            yield* this.connectLines(renderer, {\n                verticalLine: verticalLines[verticalIndex],\n                row: horizontalRow,\n                isReverse: isReverse,\n                color: color\n            });\n        }\n    }\n    getStepCount() {\n        const { n: n } = this.config;\n        return 10 * (3 * n - 1);\n    }\n    getNailCount() {\n        return this.config.n * 10;\n    }\n    drawNails(nails) {\n        this.calc.verticalLines.forEach((line, i)=>line.drawNails(nails, {\n                getUniqueKey: (k)=>1e3 * (i + i) + k\n            }));\n        this.calc.horizontalLines.forEach(([startLine, endLine], row)=>{\n            startLine.drawNails(nails, {\n                getUniqueKey: (k)=>(row + 1) * 1e4 + k\n            });\n            endLine.drawNails(nails, {\n                getUniqueKey: (k)=>(row + 1) * 1e5 + k\n            });\n        });\n    }\n    thumbnailConfig = (config)=>({\n            n: Math.min(10, config.n)\n        });\n}\n\n\nconst $3eff4f8917d513a6$var$patternTypes = [\n    (0, $ca4a2eb6736370e4$export$2e2bcd8739ae039),\n    (0, $8db9d587e082a0d9$export$2e2bcd8739ae039),\n    (0, $ad2ceb60c48a58dd$export$2e2bcd8739ae039),\n    (0, $44064e6908c034c2$export$2e2bcd8739ae039),\n    (0, $63660c6a2fc9a003$export$2e2bcd8739ae039),\n    (0, $33e9badd1f194d7c$export$2e2bcd8739ae039),\n    (0, $aa2c32cdcace5ae2$export$2e2bcd8739ae039),\n    (0, $1530a0f3e43122ac$export$2e2bcd8739ae039),\n    (0, $3f55ac726d5ebe61$export$2e2bcd8739ae039),\n    (0, $7e0f39c01d255ee0$export$2e2bcd8739ae039),\n    (0, $5498d6506310c764$export$2e2bcd8739ae039),\n    (0, $7a74ed27f7260395$export$2e2bcd8739ae039),\n    (0, $cfcb4d6877bfaba2$export$2e2bcd8739ae039),\n    (0, $47fd6f35b394300f$export$2e2bcd8739ae039),\n    (0, $54d330e2d674b207$export$2e2bcd8739ae039),\n    (0, $e483398e368102d0$export$2e2bcd8739ae039),\n    (0, $5671f58b0d6a3653$export$2e2bcd8739ae039)\n];\nvar $3eff4f8917d513a6$export$2e2bcd8739ae039 = $3eff4f8917d513a6$var$patternTypes;\n\n\n\nfunction $92270d8b7d92e411$export$15be7981f451f84d(type) {\n    let Pattern = (0, $3eff4f8917d513a6$export$2e2bcd8739ae039).find(({ type: _type })=>_type === type);\n    if (!Pattern) throw new Error(`Unknown pattern type, \"${type}\"!`);\n    // @ts-ignore\n    return new Pattern();\n}\nfunction $92270d8b7d92e411$export$1b06808e3c79c7e0() {\n    // @ts-ignore\n    const patterns = (0, $3eff4f8917d513a6$export$2e2bcd8739ae039).map((PatternType)=>new PatternType());\n    return patterns;\n}\nfunction $92270d8b7d92e411$export$ebb1a6b9e8c15cc2(patternId) {\n    let pattern = (0, $3eff4f8917d513a6$export$2e2bcd8739ae039).find(({ type: type })=>type === patternId);\n    if (pattern) // @ts-ignore\n    return new pattern();\n    else return (0, $00643d12b3a54506$export$2e2bcd8739ae039).getPatternByID(patternId);\n}\n\n\nconst $00643d12b3a54506$var$APP_DATA_STORAGE_KEY = 'string_art_app_data';\nclass $00643d12b3a54506$export$2e2bcd8739ae039 extends (0, $00df09d341073864$export$2e2bcd8739ae039) {\n    elements;\n    currentPattern;\n    constructor(){\n        super();\n        this.elements = {\n            saveDialog: document.querySelector('#save_dialog')\n        };\n        document.querySelector('#pattern_menu').addEventListener('select', (e)=>{\n            // @ts-ignore\n            switch(e.detail.value){\n                case 'save_as':\n                    this.#showSaveAsDialog();\n                    break;\n                case 'delete':\n                    this.deletePattern();\n                    break;\n                case 'save':\n                    this.saveCurrentPattern();\n                    break;\n                case 'rename':\n                    this.renameCurrentPattern();\n                    break;\n            }\n        });\n        document.querySelector('#save_btn').addEventListener('click', ()=>{\n            if (this.currentPattern.isTemplate) this.#showSaveAsDialog();\n            else this.saveCurrentPattern();\n        });\n    }\n    #showSaveAsDialog() {\n        const nextId = this.#getNextAvailableId();\n        const defaultName = (0, $2509ceef6c629a64$export$e2de15bbd9edf9c6)().name ?? `Pattern #${nextId}`;\n        (0, $174f2c93f6348ee5$export$195ba6d62321b933)({\n            title: 'Save pattern',\n            description: 'Name this pattern:',\n            submit: 'Save',\n            value: defaultName\n        }).then((patternName)=>{\n            this.saveNewPattern({\n                type: this.currentPattern.type,\n                config: this.currentPattern.config,\n                name: patternName == null || patternName === '' ? defaultName : patternName\n            });\n        }, ()=>{});\n    }\n    setPattern(pattern) {\n        this.currentPattern = pattern;\n    }\n    static patternDataToStringArt({ type: type, ...patternData }) {\n        const pattern = (0, $92270d8b7d92e411$export$15be7981f451f84d)(type);\n        Object.assign(pattern, patternData);\n        pattern.markConfigAsDefault();\n        return pattern;\n    }\n    static getSavedPatterns() {\n        const { patterns: patterns } = this.loadAppData();\n        return patterns.map(this.patternDataToStringArt);\n    }\n    static getPatternByID(patternId) {\n        const patternData = this.loadPatternDataById(patternId);\n        return patternData ? this.patternDataToStringArt(patternData) : null;\n    }\n    static loadPatternDataById(patternId) {\n        const { patterns: patterns } = this.loadAppData();\n        return patterns.find(({ id: id })=>id === patternId);\n    }\n    #getNextAvailableId() {\n        const appData = $00643d12b3a54506$export$2e2bcd8739ae039.loadAppData();\n        const lastId = appData?.patterns?.length ? Number(appData.patterns[appData.patterns.length - 1].id) : 0;\n        const nextId = isNaN(lastId) ? 1 : lastId + 1;\n        return String(nextId);\n    }\n    saveNewPattern(patternData) {\n        const appData = $00643d12b3a54506$export$2e2bcd8739ae039.loadAppData();\n        const nextId = this.#getNextAvailableId();\n        const newPatternData = {\n            ...patternData,\n            id: nextId\n        };\n        appData.patterns.push(newPatternData);\n        $00643d12b3a54506$export$2e2bcd8739ae039.saveAppData(appData);\n        this.emit('newPattern', {\n            pattern: $00643d12b3a54506$export$2e2bcd8739ae039.patternDataToStringArt(newPatternData)\n        });\n        return newPatternData;\n    }\n    savePattern(patternData) {\n        const appData = $00643d12b3a54506$export$2e2bcd8739ae039.loadAppData();\n        const patternIndex = appData.patterns.findIndex(({ id: id })=>id === this.currentPattern.id);\n        if (patternIndex !== -1) {\n            appData.patterns[patternIndex] = patternData;\n            $00643d12b3a54506$export$2e2bcd8739ae039.saveAppData(appData);\n            this.emit('save', {\n                pattern: $00643d12b3a54506$export$2e2bcd8739ae039.patternDataToStringArt(patternData)\n            });\n        }\n    }\n    saveCurrentPattern() {\n        const newPatternData = {\n            id: this.currentPattern.id,\n            name: this.currentPattern.name,\n            type: this.currentPattern.type,\n            config: this.currentPattern.config\n        };\n        this.savePattern(newPatternData);\n        return newPatternData;\n    }\n    renameCurrentPattern() {\n        (0, $174f2c93f6348ee5$export$195ba6d62321b933)({\n            title: 'Rename',\n            description: 'Name this pattern:',\n            submit: 'Save',\n            value: this.currentPattern.name\n        }).then((newPatternName)=>{\n            if (newPatternName !== this.currentPattern.name) {\n                const patternData = $00643d12b3a54506$export$2e2bcd8739ae039.loadPatternDataById(this.currentPattern.id);\n                patternData.name = newPatternName;\n                this.savePattern(patternData);\n            }\n            this.currentPattern.name = newPatternName;\n        });\n    }\n    deletePattern() {\n        (0, $174f2c93f6348ee5$export$715f9d76bb8c1fea)({\n            title: 'Delete pattern',\n            description: 'Are you sure you wish to delete this pattern?',\n            submit: 'Delete',\n            type: 'error'\n        }).then(()=>{\n            const appData = $00643d12b3a54506$export$2e2bcd8739ae039.loadAppData();\n            const patternIndex = appData.patterns.findIndex(({ id: id })=>id === this.currentPattern.id);\n            if (patternIndex === -1) throw new Error(`Can't delete pattern with ID \"${this.currentPattern.id}\", it's not found!`);\n            const patternData = appData.patterns.splice(patternIndex, 1)[0];\n            $00643d12b3a54506$export$2e2bcd8739ae039.saveAppData(appData);\n            const pattern = $00643d12b3a54506$export$2e2bcd8739ae039.patternDataToStringArt(patternData);\n            pattern.resetDefaultConfig();\n            this.emit('deletePattern', {\n                pattern: pattern\n            });\n        }, ()=>{});\n    }\n    static savePatternDownloadData(patternId, data) {\n        const appData = $00643d12b3a54506$export$2e2bcd8739ae039.loadAppData();\n        if (!appData.downloadData) appData.downloadData = {};\n        appData.downloadData[patternId] = data;\n        this.saveAppData(appData);\n    }\n    static getPatternDownloadData(patternId) {\n        const appData = $00643d12b3a54506$export$2e2bcd8739ae039.loadAppData();\n        return appData.downloadData?.[patternId];\n    }\n    static loadAppData() {\n        const rawData = localStorage.getItem($00643d12b3a54506$var$APP_DATA_STORAGE_KEY);\n        try {\n            return rawData ? JSON.parse(rawData) : {\n                patterns: [],\n                downloadData: {}\n            };\n        } catch (error) {\n            throw new Error('App data is corrupted, failed to load it. ' + error.message);\n        }\n    }\n    static saveAppData(appData) {\n        localStorage.setItem($00643d12b3a54506$var$APP_DATA_STORAGE_KEY, JSON.stringify(appData));\n    }\n}\n\n\n\n\nconst $8a4d6517fbd25a59$var$THUMBNAIL_WIDTH_PX = '100px';\nconst $8a4d6517fbd25a59$var$MINIMIZED_CLASS = 'minimized';\nclass $8a4d6517fbd25a59$export$45b50bca1da1e9b3 extends (0, $00df09d341073864$export$2e2bcd8739ae039) {\n    elements = {\n        root: document.querySelector('#pattern_select_panel'),\n        thumbnails: document.querySelector('#thumbnails'),\n        toggleBtn: document.querySelector('#pattern_select_btn'),\n        dropdown: document.querySelector('#pattern_select_dropdown'),\n        patternName: document.querySelector('#pattern_name')\n    };\n    pattern;\n    thumbnailsRendered = false;\n    _onClickOutside;\n    constructor(persistance){\n        super();\n        this.elements.toggleBtn.addEventListener('click', ()=>this.toggle());\n        persistance.addEventListener('newPattern', ({ pattern: pattern })=>{\n            if (this.isOpen) this.createThumbnails();\n            else this.thumbnailsRendered = false;\n            this.setCurrentPattern(pattern);\n            this.emit('select', {\n                patternId: pattern.id\n            });\n        });\n        persistance.addEventListener('save', ({ pattern: pattern })=>{\n            if (this.isOpen) this.createThumbnails();\n            else this.thumbnailsRendered = false;\n            this.setCurrentPattern(pattern);\n        });\n        persistance.addEventListener('deletePattern', ({ pattern: pattern })=>{\n            if (this.isOpen) {\n                const thumbnail = this.elements.thumbnails.querySelector(`[data-pattern=\"${pattern.id}\"]`);\n                thumbnail.remove();\n            } else this.thumbnailsRendered = false;\n        });\n        this.elements.thumbnails.addEventListener('click', (e)=>{\n            e.preventDefault();\n            e.stopPropagation();\n            const link = e.target instanceof HTMLElement && e.target.closest('[data-pattern]');\n            if (!link) return false;\n            this.emit('select', {\n                patternId: link.dataset.pattern\n            });\n        });\n    }\n    get isOpen() {\n        return !this.elements.root.classList.contains($8a4d6517fbd25a59$var$MINIMIZED_CLASS);\n    }\n    toggle() {\n        if (!this.isOpen) this.open();\n        else if (this.pattern) this.close();\n    }\n    open() {\n        if (!this.isOpen) {\n            this.elements.root.classList.remove($8a4d6517fbd25a59$var$MINIMIZED_CLASS);\n            if (!this.thumbnailsRendered) {\n                this.createThumbnails();\n                this.thumbnailsRendered = true;\n            }\n            this._onClickOutside = (e)=>{\n                if (e.target instanceof HTMLElement && !e.target.closest('#pattern_select_panel')) this.toggle();\n            };\n            document.body.addEventListener('mousedown', this._onClickOutside);\n        }\n    }\n    close() {\n        if (this.isOpen) {\n            this.elements.root.classList.add($8a4d6517fbd25a59$var$MINIMIZED_CLASS);\n            document.body.removeEventListener('mousedown', this._onClickOutside);\n            this._onClickOutside = null;\n        }\n    }\n    setCurrentPattern(pattern) {\n        this.pattern = pattern;\n        this.elements.patternName.innerText = pattern?.name ?? 'Choose a pattern';\n    }\n    #createThumbnailsSection(title, patterns) {\n        const section = document.createElement('section');\n        const sectionTitle = document.createElement('h3');\n        sectionTitle.className = 'pattern_select_thumbnails_title';\n        sectionTitle.innerText = title;\n        section.appendChild(sectionTitle);\n        const thumbnailsList = document.createElement('ul');\n        thumbnailsList.className = 'pattern_select_thumbnails';\n        section.appendChild(thumbnailsList);\n        const thumbnailsFragment = document.createDocumentFragment();\n        const patternThumbnails = {};\n        patterns.forEach((pattern)=>{\n            const patternLink = document.createElement('a');\n            patternLink.style.width = patternLink.style.height = $8a4d6517fbd25a59$var$THUMBNAIL_WIDTH_PX;\n            patternThumbnails[pattern.id] = patternLink;\n            const thumbnailConfig = pattern.thumbnailConfig;\n            pattern.assignConfig({\n                margin: 1,\n                enableBackground: !pattern.config.darkMode || pattern.config.customBackgroundColor,\n                nailRadius: 0.5,\n                ...thumbnailConfig instanceof Function ? thumbnailConfig(pattern.config) : thumbnailConfig\n            });\n            const li = document.createElement('li');\n            thumbnailsFragment.appendChild(li);\n            patternLink.href = `?pattern=${pattern.id}`;\n            patternLink.setAttribute('data-pattern', pattern.id);\n            patternLink.title = pattern.name;\n            li.appendChild(patternLink);\n        });\n        thumbnailsList.appendChild(thumbnailsFragment);\n        this.elements.thumbnails.appendChild(section);\n        patterns.forEach((pattern)=>{\n            const renderer = new (0, $2f2e0bbe9a3a6970$export$2e2bcd8739ae039)(patternThumbnails[pattern.id], {\n                updateOnResize: false\n            });\n            renderer.setSize([\n                100,\n                100\n            ]);\n            pattern.draw(renderer);\n        });\n    }\n    createThumbnails() {\n        this.elements.thumbnails.innerHTML = '';\n        const savedPatterns = (0, $00643d12b3a54506$export$2e2bcd8739ae039).getSavedPatterns();\n        if (savedPatterns.length) this.#createThumbnailsSection('My Patterns', (0, $00643d12b3a54506$export$2e2bcd8739ae039).getSavedPatterns());\n        const patterns = (0, $92270d8b7d92e411$export$1b06808e3c79c7e0)();\n        this.#createThumbnailsSection('Built-in patterns', patterns);\n    }\n}\n\n\n\n\n\nconst $0649237e9259f2a7$var$SVG_NS = 'http://www.w3.org/2000/svg';\nclass $0649237e9259f2a7$export$2e2bcd8739ae039 extends (0, $66d8ae1974721b90$export$2e2bcd8739ae039) {\n    svg;\n    backgroundGroup;\n    background = null;\n    linesGroup;\n    nailsGroup;\n    nailsCirclesGroup;\n    nailsTextGroup;\n    currentColor = null;\n    lineWidth = 1;\n    currentLineGroup = null;\n    constructor(parentElement){\n        super(parentElement);\n        this.svg = document.createElementNS($0649237e9259f2a7$var$SVG_NS, 'svg');\n        this.svg.style.setProperty('display', 'block');\n        this.backgroundGroup = document.createElementNS($0649237e9259f2a7$var$SVG_NS, 'g');\n        this.backgroundGroup.setAttribute('data-id', 'background');\n        this.linesGroup = document.createElementNS($0649237e9259f2a7$var$SVG_NS, 'g');\n        this.linesGroup.setAttribute('data-id', 'lines');\n        this.nailsGroup = document.createElementNS($0649237e9259f2a7$var$SVG_NS, 'g');\n        this.nailsGroup.setAttribute('data-id', 'nails');\n        this.nailsCirclesGroup = document.createElementNS($0649237e9259f2a7$var$SVG_NS, 'g');\n        this.nailsCirclesGroup.setAttribute('data-id', 'nailsCircles');\n        this.nailsTextGroup = document.createElementNS($0649237e9259f2a7$var$SVG_NS, 'g');\n        this.nailsTextGroup.setAttribute('data-id', 'nailsText');\n        this.nailsGroup.appendChild(this.nailsCirclesGroup);\n        this.nailsGroup.appendChild(this.nailsTextGroup);\n        this.svg.appendChild(this.backgroundGroup);\n        this.svg.appendChild(this.linesGroup);\n        this.svg.appendChild(this.nailsGroup);\n        this.svg.setAttribute('xmlns', $0649237e9259f2a7$var$SVG_NS);\n        parentElement.appendChild(this.svg);\n    }\n    get element() {\n        return this.svg;\n    }\n    resetSize() {\n        super.resetSize();\n        this.svg.style.removeProperty('width');\n        this.svg.style.removeProperty('height');\n        const newDimensions = this.getSize().map(Math.trunc);\n        const [width, height] = newDimensions;\n        this.svg.setAttributeNS($0649237e9259f2a7$var$SVG_NS, 'viewBox', `0 0 ${width} ${height}`);\n        this.svg.setAttributeNS($0649237e9259f2a7$var$SVG_NS, 'width', String(width));\n        this.svg.setAttributeNS($0649237e9259f2a7$var$SVG_NS, 'height', String(height));\n        this.svg.style.width = width + 'px';\n        this.svg.style.height = height + 'px';\n        if (!this.currentSize || !(0, $b683a3137b30eaa9$export$b81d802eaada750f)(newDimensions, this.currentSize)) {\n            this.currentSize = newDimensions;\n            this.emit('sizeChange', {\n                size: newDimensions\n            });\n        }\n        return newDimensions;\n    }\n    resetNails() {\n        this.nailsCirclesGroup.innerHTML = '';\n        this.nailsTextGroup.innerHTML = '';\n    }\n    resetStrings() {\n        this.linesGroup.innerHTML = '';\n        this.currentColor = null;\n        this.lineWidth = null;\n    }\n    setColor(color) {\n        if (color !== this.currentColor) {\n            this.currentLineGroup = document.createElementNS($0649237e9259f2a7$var$SVG_NS, 'g');\n            this.currentLineGroup.setAttribute('stroke', color);\n            this.currentLineGroup.setAttribute('stroke-width', String(this.lineWidth));\n            this.linesGroup.appendChild(this.currentLineGroup);\n            this.currentColor = color;\n        }\n    }\n    setLineWidth(width) {\n        this.lineWidth = width ?? '1';\n        this.linesGroup.setAttributeNS($0649237e9259f2a7$var$SVG_NS, 'stroke-width', String(width ?? 1));\n        this.linesGroup.childNodes.forEach((group)=>{\n            if (group instanceof SVGGElement) group.setAttributeNS($0649237e9259f2a7$var$SVG_NS, 'stroke-width', String(width ?? 1));\n        });\n    }\n    setBackground(color) {\n        if (color) {\n            if (!this.background) {\n                this.background = document.createElementNS($0649237e9259f2a7$var$SVG_NS, 'rect');\n                this.background.setAttribute('width', '100%');\n                this.background.setAttribute('height', '100%');\n                this.backgroundGroup.appendChild(this.background);\n            }\n            this.background.setAttribute('fill', color);\n        } else {\n            this.background = null;\n            this.backgroundGroup.innerHTML = '';\n        }\n    }\n    getSize() {\n        return [\n            this.svg.clientWidth,\n            this.svg.clientHeight\n        ];\n    }\n    setSize(size) {\n        if (!size) return this.resetSize();\n        if (this.fixedSize) {\n            console.warn(`Trying to set size for Renderer to [${size.join(', ')}], but size is fixed to [${this.fixedSize.join(', ')}].`);\n            return this.fixedSize;\n        }\n        this.svg.removeAttributeNS($0649237e9259f2a7$var$SVG_NS, 'width');\n        this.svg.removeAttributeNS($0649237e9259f2a7$var$SVG_NS, 'height');\n        this.svg.style.width = `${size[0]}px`;\n        this.svg.style.height = `${size[1]}px`;\n        const realSize = size.map(Math.trunc);\n        const [width, height] = realSize;\n        this.svg.setAttributeNS($0649237e9259f2a7$var$SVG_NS, 'viewBox', `0 0 ${width} ${height}`);\n        this.svg.setAttributeNS($0649237e9259f2a7$var$SVG_NS, 'width', String(width));\n        this.svg.setAttributeNS($0649237e9259f2a7$var$SVG_NS, 'height', String(height));\n        if (!this.currentSize || !(0, $b683a3137b30eaa9$export$b81d802eaada750f)(realSize, this.currentSize)) {\n            this.currentSize = realSize;\n            this.emit('sizeChange', {\n                size: realSize\n            });\n        }\n        return realSize;\n    }\n    renderLine(from, to) {\n        this.lastStringCoordinates = from;\n        this.lineTo(to);\n    }\n    lineTo(to) {\n        if (!this.lastStringCoordinates) throw new Error(\"no last string coordinates, can't lineTo\");\n        const line = document.createElementNS($0649237e9259f2a7$var$SVG_NS, 'line');\n        line.setAttribute('x1', String(Math.trunc(this.lastStringCoordinates[0])));\n        line.setAttribute('y1', String(Math.trunc(this.lastStringCoordinates[1])));\n        line.setAttribute('x2', String(Math.trunc(to[0])));\n        line.setAttribute('y2', String(Math.trunc(to[1])));\n        this.currentLineGroup.appendChild(line);\n        this.lastStringCoordinates = to;\n    }\n    clearInstructions() {\n    // TODO: Implement this\n    }\n    renderInstructions(from, to) {\n    // TODO: Implement this\n    }\n    renderInstructionsForLastLine() {\n    // TODO: Implement this\n    }\n    hideInstructions() {\n    // TODO: Implement this\n    }\n    showInstructions() {\n    // TODO: Implement this\n    }\n    renderNails(nails, { color: color, fontSize: fontSize, radius: radius, renderNumbers: renderNumbers, margin: margin = 0, numbersStart: numbersStart = 1 }) {\n        const centerX = this.getSize()[0] / 2;\n        //this.nailsCirclesGroup.innerHTML = this.nailsTextGroup.innerHTML = '';\n        const circlesFragment = document.createDocumentFragment();\n        const textFragment = document.createDocumentFragment();\n        const nailNumberOffset = radius + margin;\n        this.nailsTextGroup.style.fontSize = String(fontSize);\n        let number = numbersStart;\n        for (let [x, y] of nails){\n            const circle = document.createElementNS($0649237e9259f2a7$var$SVG_NS, 'circle');\n            circle.setAttribute('cx', String(x));\n            circle.setAttribute('cy', String(y));\n            circle.setAttribute('r', String(radius));\n            circlesFragment.appendChild(circle);\n            if (renderNumbers && number != null) {\n                const isRightAlign = x < centerX;\n                const numberPosition = [\n                    isRightAlign ? x - nailNumberOffset : x + nailNumberOffset,\n                    y\n                ];\n                const textEl = document.createElementNS($0649237e9259f2a7$var$SVG_NS, 'text');\n                textEl.innerHTML = String(number);\n                textEl.setAttribute('x', String(numberPosition[0]));\n                textEl.setAttribute('y', String(numberPosition[1]));\n                if (isRightAlign) textEl.setAttribute('text-anchor', 'end');\n                textFragment.appendChild(textEl);\n            }\n            number++;\n        }\n        this.nailsCirclesGroup.appendChild(circlesFragment);\n        this.nailsTextGroup.appendChild(textFragment);\n        if (color != null) {\n            this.nailsCirclesGroup.setAttribute('fill', color);\n            this.nailsTextGroup.setAttribute('fill', color);\n        }\n    }\n    clear() {\n        this.linesGroup.innerHTML = '';\n        this.nailsGroup.innerHTML = '';\n    }\n    toDataURL() {\n        return '';\n    }\n}\n\n\nasync function $38bb4a85553a6bfc$export$ed80d9de1d9df928(input) {\n    try {\n        navigator.share(await $38bb4a85553a6bfc$var$getShareData(input));\n    } catch (error) {\n        alert('Error: ' + error.message);\n    }\n}\nasync function $38bb4a85553a6bfc$export$4fa6f570da04f7cc() {\n    if (!navigator.share) return false;\n    const canvas = document.createElement('canvas');\n    canvas.width = 1;\n    canvas.height = 1;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = 'black';\n    ctx.fillRect(0, 0, 1, 1);\n    const dataURL = canvas.toDataURL();\n    const shareData = await $38bb4a85553a6bfc$var$dataURLToShareData(dataURL, 'test', 'test.jpg');\n    return navigator.canShare(shareData);\n}\nasync function $38bb4a85553a6bfc$var$dataURLToShareData(dataURL, text, filename, url) {\n    const blob = await (await fetch(dataURL)).blob();\n    const files = [\n        new File([\n            blob\n        ], filename, {\n            type: blob.type,\n            lastModified: new Date().getTime()\n        })\n    ];\n    return {\n        url: url ?? window.location.href,\n        files: files,\n        title: document.title,\n        text: text\n    };\n}\nasync function $38bb4a85553a6bfc$var$getShareData({ renderer: renderer, pattern: pattern }) {\n    const dataUrl = renderer.toDataURL();\n    return $38bb4a85553a6bfc$var$dataURLToShareData(dataUrl, 'String Art Studio - ' + pattern.name, pattern.name + '.jpg', (0, $2509ceef6c629a64$export$87dcc7060093bbda)(pattern, {\n        renderer: renderer instanceof (0, $0649237e9259f2a7$export$2e2bcd8739ae039) ? 'svg' : 'canvas',\n        patternAsTemplate: true\n    }));\n}\n\n\nconst $718de5d870731526$var$swFilename = 'service-worker.js';\nasync function $718de5d870731526$export$d594efb518b3cec4() {\n    if (!navigator.serviceWorker || document.location.hostname === '127.0.0.1') return;\n    try {\n        const registration = await navigator.serviceWorker.register($718de5d870731526$var$swFilename);\n        registration.onupdatefound = ()=>{\n            const installingWorker = registration.installing;\n            if (installingWorker == null) return;\n            installingWorker.onstatechange = ()=>{\n                if (installingWorker.state === 'installed') {\n                    if (navigator.serviceWorker.controller) console.log(\"New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA.\");\n                    else console.log('Content is cached for offline use.');\n                }\n            };\n        };\n    } catch (error) {\n        console.error('Error during service worker registration:', error);\n    }\n}\n\n\n\n\n\n\nvar $2deec1a9c1aeca88$exports = {};\n$2deec1a9c1aeca88$exports = \".hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}#inputs,#readonly{white-space:nowrap}#readonly{font-size:14px}input{width:70px}#connector.linked{display:inline-block;transform:rotate(45deg)}\";\n\n\nconst $f0492547ffa27fa1$var$sheet = new CSSStyleSheet();\n$f0492547ffa27fa1$var$sheet.replaceSync(String($2deec1a9c1aeca88$exports));\nconst $f0492547ffa27fa1$var$DIMENSIONS = [\n    'width',\n    'height'\n];\nclass $f0492547ffa27fa1$export$2e2bcd8739ae039 extends HTMLElement {\n    static formAssociated = true;\n    internals;\n    #dimensions;\n    #inputsElement;\n    #readonlyElement;\n    #aspectRatio;\n    #isReadonly = false;\n    floatingPoints;\n    #connectorElement;\n    constructor(){\n        super();\n        const shadow = this.attachShadow({\n            mode: 'open',\n            delegatesFocus: true\n        });\n        shadow.adoptedStyleSheets = [\n            $f0492547ffa27fa1$var$sheet\n        ];\n        this.shadowRoot.innerHTML = `\n      <span id=\"inputs\">\n        <input\n          type=\"number\"\n          id=\"width\"\n          maxlength=\"3\"\n          min=\"1\"\n          class=\"dialog-input size-input\"\n          name=\"width\"\n        />\n        <span id=\"connector\">&times;</span>\n        <input\n          type=\"number\"\n          id=\"height\"\n          maxlength=\"3\"\n          min=\"1\"\n          class=\"dialog-input size-input\"\n          name=\"height\"\n        />\n      </span>\n      <span id=\"readonly\" hidden></span>\n    `;\n        this.#dimensions = {\n            width: {\n                element: shadow.querySelector('#width'),\n                value: 0,\n                max: null,\n                defaultValue: null\n            },\n            height: {\n                element: shadow.querySelector('#height'),\n                value: 0,\n                max: null,\n                defaultValue: null\n            }\n        };\n        this.#connectorElement = shadow.querySelector('#connector');\n        this.#inputsElement = shadow.querySelector('#inputs');\n        this.#readonlyElement = shadow.querySelector('#readonly');\n        this.internals = this.attachInternals();\n    }\n    static get observedAttributes() {\n        return [\n            'width',\n            'height',\n            'aspect-ratio',\n            'max-width',\n            'max-height',\n            'readonly',\n            'default-width',\n            'default-height',\n            'floating-points'\n        ];\n    }\n    get inputs() {\n        return [\n            this.#dimensions.width.element,\n            this.#dimensions.height.element\n        ];\n    }\n    get width() {\n        return this.#dimensions.width.value;\n    }\n    set width(value) {\n        this.setDimensionValue('width', value, {\n            updateOtherDimensionOnce: true\n        });\n    }\n    get height() {\n        return this.#dimensions.height.value;\n    }\n    set height(value) {\n        this.setDimensionValue('height', value, {\n            updateOtherDimensionOnce: true\n        });\n    }\n    get value() {\n        return [\n            this.width,\n            this.height\n        ];\n    }\n    set value(value) {\n        if (typeof value === 'string') {\n            const match = value.match(/^(\\d+(?:\\.\\d+)?),\\s?(\\d+(?:\\.\\d+)?)$/);\n            if (match) {\n                this.width = Number(match[1]);\n                this.height = Number(match[2]);\n            }\n        } else {\n            this.width = value[0];\n            this.height = value[1];\n        }\n    }\n    get maxWidth() {\n        return this.#dimensions.width.max;\n    }\n    get maxHeight() {\n        return this.#dimensions.height.max;\n    }\n    set maxWidth(value) {\n        this.setMaxDimensionValue('width', value);\n    }\n    set maxHeight(value) {\n        this.setMaxDimensionValue('height', value);\n    }\n    get isReadonly() {\n        return this.#isReadonly;\n    }\n    set isReadonly(value) {\n        if (this.#isReadonly = value && value !== 'false') {\n            (0, $8d5cef8e7fea78a8$export$fe8985bb6374093c)(this.#inputsElement);\n            (0, $8d5cef8e7fea78a8$export$f823a0c1cf7adf68)(this.#readonlyElement);\n        } else {\n            (0, $8d5cef8e7fea78a8$export$f823a0c1cf7adf68)(this.#inputsElement);\n            (0, $8d5cef8e7fea78a8$export$fe8985bb6374093c)(this.#readonlyElement);\n        }\n    }\n    #setReadonlyText() {\n        this.#readonlyElement.innerHTML = `${this.width} &times; ${this.height}`;\n    }\n    applyAspectRatio(targetDimension, value) {\n        if (!this.#aspectRatio) return value;\n        return targetDimension === 'width' ? value * this.#aspectRatio : value / this.#aspectRatio;\n    }\n    getOtherDimension(dimension) {\n        return dimension === 'width' ? 'height' : 'width';\n    }\n    get aspectRatio() {\n        return this.#aspectRatio;\n    }\n    set aspectRatio(value) {\n        this.#aspectRatio = value ? Number(value) : null;\n        if (isNaN(this.#aspectRatio)) this.#aspectRatio = null;\n        if (this.#aspectRatio) {\n            if (!this.#connectorElement.classList.contains('linked')) this.#connectorElement.classList.add('linked');\n            this.#connectorElement.innerHTML = \"\\uD83D\\uDD17\";\n        } else {\n            this.#connectorElement.classList.remove('linked');\n            this.#connectorElement.innerHTML = '&times;';\n        }\n    }\n    setMaxDimensionValue(dimension, value, updateOtherDimension = true) {\n        const props = this.#dimensions[dimension];\n        value = Number(value);\n        let normalizedValue = value;\n        if (this.floatingPoints != null) normalizedValue = value.toFixedPrecision(this.floatingPoints);\n        if (normalizedValue === props.max) return;\n        props.max = isNaN(normalizedValue) ? null : normalizedValue;\n        if (props.max) {\n            if (props.value && props.value > normalizedValue) this[dimension] = normalizedValue;\n            props.element.setAttribute('max', String(props.max));\n        } else props.element.removeAttribute('max');\n        if (updateOtherDimension && this.#aspectRatio) {\n            const otherDimension = this.getOtherDimension(dimension);\n            const otherDimensionMaxValue = this.applyAspectRatio(otherDimension, value);\n            if (!this.#dimensions[otherDimension].max || otherDimensionMaxValue < this.#dimensions[otherDimension].max) this.setMaxDimensionValue(otherDimension, otherDimensionMaxValue, false);\n        }\n    }\n    setMaxDimensions(dimensions) {\n        this.setMaxDimensionValue('width', dimensions[0], false);\n        this.setMaxDimensionValue('height', dimensions[1], false);\n    }\n    setDimensionValue(dimension, value, { updateOtherDimension: updateOtherDimension = true, updateOtherDimensionOnce: updateOtherDimensionOnce = false } = {}) {\n        const props = this.#dimensions[dimension];\n        let normalizedValue = value;\n        if (this.floatingPoints != null) normalizedValue = value.toFixedPrecision(this.floatingPoints);\n        if (normalizedValue === this[dimension]) return;\n        if (isNaN(normalizedValue)) console.warn('Attempting to set a NaN value to DimensionsInput width.');\n        else {\n            if (props.max) normalizedValue = Math.min(normalizedValue, props.max);\n            props.value = normalizedValue;\n            props.element.value = String(this.floatingPoints != null ? normalizedValue.toFixedPrecision(this.floatingPoints) : normalizedValue);\n            if (updateOtherDimension && this.#aspectRatio) {\n                const otherDimension = this.getOtherDimension(dimension);\n                this.setDimensionValue(otherDimension, this.applyAspectRatio(otherDimension, normalizedValue), {\n                    updateOtherDimension: updateOtherDimensionOnce\n                });\n            }\n            this.#setReadonlyText();\n        }\n        this.#updateFormValue();\n    }\n    attributeChangedCallback(name, oldVal, newVal) {\n        if (name === 'aspect-ratio') this.aspectRatio = newVal;\n        else if (name === 'max-width') this.maxWidth = newVal;\n        else if (name === 'max-height') this.maxHeight = newVal;\n        else if (name === 'floating-points') this.setFloatingPoints(Number(newVal));\n        else if (name === 'readonly') this.isReadonly = newVal;\n    }\n    connectedCallback() {\n        this.shadowRoot.addEventListener('input', (e)=>this.#handleInput(e));\n        this.shadowRoot.addEventListener('focusin', (e)=>{\n            if (e.target instanceof HTMLInputElement) e.target.select();\n        });\n        this.#syncAttributes();\n    }\n    #handleInput(e) {\n        if (e.target instanceof HTMLInputElement) {\n            const value = Number(e.target.value);\n            for (const dimension of $f0492547ffa27fa1$var$DIMENSIONS)if (e.target === this.#dimensions[dimension].element) {\n                this[dimension] = value;\n                this.dispatchEvent(new CustomEvent('dimensionchange', {\n                    detail: {\n                        value: this.value,\n                        dimension: dimension,\n                        width: this.width,\n                        height: this.height\n                    }\n                }));\n                break;\n            }\n            this.#updateFormValue();\n        }\n    }\n    #updateFormValue() {\n        this.internals.setFormValue(String(this.value.join(',')));\n    }\n    #syncAttributes() {\n        for (const dimension of $f0492547ffa27fa1$var$DIMENSIONS){\n            const props = this.#dimensions[dimension];\n            if (this.hasAttribute('default-' + dimension)) {\n                const value = Number(this.getAttribute('default-' + dimension));\n                props.defaultValue = isNaN(value) ? 0 : value;\n                props.element.placeholder = String(value);\n            }\n            this.setMaxDimensionValue(dimension, this.getAttribute('max-' + dimension));\n            if (this.hasAttribute(dimension)) {\n                const value = Number(this.getAttribute(dimension));\n                this[dimension] = isNaN(value) ? props.defaultValue : value;\n            }\n        }\n        this.aspectRatio = this.getAttribute('aspect-ratio');\n        this.isReadonly = this.getAttribute('readonly');\n        if (this.hasAttribute('floating-points')) {\n            const value = Number(this.getAttribute('floating-points'));\n            this.setFloatingPoints(isNaN(value) ? null : value);\n        }\n    }\n    setFloatingPoints(value) {\n        if (value != null && !isNaN(value)) {\n            this.floatingPoints = value;\n            this.inputs.forEach((input)=>input.setAttribute('step', String(1 / 10 ** this.floatingPoints)));\n            $f0492547ffa27fa1$var$DIMENSIONS.forEach((dimension)=>{\n                if (this[dimension]) this[dimension] = this[dimension].toFixedPrecision(value);\n            });\n        } else {\n            this.floatingPoints = null;\n            this.inputs.forEach((input)=>input.removeAttribute('step'));\n        }\n    }\n}\ncustomElements.define('dimensions-input', $f0492547ffa27fa1$export$2e2bcd8739ae039);\n\n\n\nclass $f4729f31dd8a035c$export$e44a253a59704894 extends HTMLElement {\n    button;\n    #buttonStyle;\n    constructor(){\n        super();\n        this.attachShadow({\n            mode: 'open'\n        });\n        this.shadowRoot.innerHTML = `\n      <style>\n        :host {\n          display: inline-block;\n          position: relative;\n        }\n\n        button {\n          display: block;\n          padding: 10px 15px;\n          background: transparent;\n          color: white;\n          border: none;\n          cursor: pointer;\n          font: inherit;\n        }\n\n        button:hover {\n          background: #444;\n        }\n\n        button:focus {\n          background: rgba(255,255,255,.2)\n        }\n        ul {\n          display: none;\n          position: absolute;\n          top: 100%;\n          right: 0;\n          min-width: 120px;\n          background: var(--color-dialog-background);\n          border: var(--border-dialog);\n          margin: 0;\n          padding: 0;\n          list-style: none;\n          z-index: 1000;\n          box-shadow: 1px 1px 10px rgba(0,0,0,.7)\n        }\n\n        :host(.open) ul {\n          display: block;\n        }\n      </style>\n\n      <button aria-haspopup=\"true\" aria-expanded=\"false\">\n        <slot name=\"label\">Menu</slot>\n      </button>\n      <ul role=\"menu\">\n        <slot></slot>\n      </ul>\n    `;\n    }\n    connectedCallback() {\n        this.button = this.shadowRoot.querySelector('button');\n        this.button.addEventListener('click', ()=>this.toggle());\n        if (this.#buttonStyle) this.button.style = this.#buttonStyle;\n        document.addEventListener('click', (e)=>{\n            if (!this.contains(e.target) && !this.shadowRoot.contains(e.target)) this.close();\n        });\n        this.button.addEventListener('keydown', (e)=>{\n            if (e.key === 'Escape') {\n                this.close();\n                this.button.focus();\n            }\n        });\n        // Listen for selection from child items\n        this.addEventListener('item-selected', (e)=>{\n            const customEvent = e;\n            this.dispatchEvent(new CustomEvent('select', {\n                detail: {\n                    value: customEvent.detail.value\n                },\n                bubbles: true,\n                composed: true\n            }));\n            this.close();\n        });\n    }\n    static get observedAttributes() {\n        return [\n            'button-style'\n        ];\n    }\n    attributeChangedCallback(name, oldVal, newVal) {\n        if (name === 'button-style') {\n            if (this.button) this.button.style = newVal;\n            else this.#buttonStyle = newVal;\n        }\n    }\n    toggle() {\n        const isOpen = this.classList.toggle('open');\n        this.button.setAttribute('aria-expanded', String(isOpen));\n    }\n    close() {\n        this.classList.remove('open');\n        this.button.setAttribute('aria-expanded', 'false');\n    }\n}\ncustomElements.define('dropdown-menu', $f4729f31dd8a035c$export$e44a253a59704894);\n\n\nclass $0096ec60fce19dcf$var$DropdownMenuItem extends HTMLElement {\n    static get observedAttributes() {\n        return [\n            'value'\n        ];\n    }\n    value = '';\n    constructor(){\n        super();\n        this.attachShadow({\n            mode: 'open'\n        });\n        this.shadowRoot.innerHTML = `\n      <style>\n        li {\n          list-style: none;\n          padding: 12px 40px 12px 20px;\n          color: White;\n          text-decoration: none;\n          white-space: nowrap;\n          background: transparent;\n          cursor: pointer;\n        }\n        li:hover {\n          background: rgba(255,255,255,.1);\n        }\n        span:not(:empty) {\n          float: left; \n          margin-right: .5em;\n          position: relative;\n          left: -4px;\n          top: 1px;\n        }\n      </style>\n      <li role=\"menuitem\">\n        <span id=\"icon\"><slot name=\"icon\"></span>\n        <slot></slot>\n      </li>\n    `;\n    }\n    connectedCallback() {\n        const item = this.shadowRoot.querySelector('li');\n        item.addEventListener('click', (e)=>{\n            e.preventDefault();\n            this.dispatchEvent(new CustomEvent('item-selected', {\n                detail: {\n                    value: this.value\n                },\n                bubbles: true,\n                composed: true\n            }));\n        });\n    }\n    attributeChangedCallback(name, _oldValue, newValue) {\n        if (name === 'value') this.value = newValue;\n    }\n}\ncustomElements.define('dropdown-menu-item', $0096ec60fce19dcf$var$DropdownMenuItem);\n\n\nvar $eb971f7ae22dc5e1$exports = {};\n$eb971f7ae22dc5e1$exports = \".hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}@font-face{font-family:string_art_studio;src:url(string_art_studio.09832b61.ttf)format(\\\"truetype\\\"),url(string_art_studio.ca3bae77.woff)format(\\\"woff\\\"),url(string_art_studio.3d53e5dd.svg#string_art_studio)format(\\\"svg\\\");font-weight:400;font-style:normal;font-display:block}i{speak:never;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;line-height:1;font-family:string_art_studio!important}.icon-thread:before{content:\\\"\\\"}.icon-rotate:before{content:\\\"\\\"}.icon-pencil:before{content:\\\"\\\"}.icon-plus:before{content:\\\"\\\"}.icon-trash:before{content:\\\"\\\"}.icon-diskette_b:before{content:\\\"\\\"}.icon-diskette:before{content:\\\"\\\"}.icon-menu:before{content:\\\"\\\"}.icon-arrow_left:before{content:\\\"\\\"}.icon-arrow_right:before{content:\\\"\\\"}.icon-caret_down:before{content:\\\"\\\"}.icon-download:before{content:\\\"\\\"}.icon-fullscreen:before{content:\\\"\\\"}.icon-hamburger:before{content:\\\"\\\"}.icon-options:before{content:\\\"\\\"}.icon-pause:before{content:\\\"\\\"}.icon-play:before{content:\\\"\\\"}.icon-refresh:before{content:\\\"\\\"}.icon-share:before{content:\\\"\\\"}.icon-thumbnails:before{content:\\\"\\\"}.icon-x:before{content:\\\"\\\"}[hidden]{display:none!important}dialog{background:var(--color-dialog-background);color:#fff;border:var(--border-dialog);box-sizing:border-box;width:400px;max-width:calc(100vw - 20px);margin:0;padding:0;position:fixed;top:100px;left:50%;transform:translate(-50%);box-shadow:0 0 10px #000c}dialog[open]{flex-direction:column;display:flex}#dialog_wrapper{box-sizing:border-box;width:100%;max-height:calc(100vh - 20px);padding:1em;overflow:auto}dialog.centered{top:50%;transform:translate(-50%)translateY(-50%)}dialog::backdrop{background:#000000b3}.dialog-title{color:var(--color-accent);text-shadow:1px 1px 1px #000;margin-top:0;font-size:1.4em;font-weight:400}dialog.error .dialog-title{color:var(--color-error)}.dialog-menu{text-align:end;flex-direction:row;justify-content:end;align-items:center;margin-bottom:0;display:flex}.dialog-menu button{color:#fff;cursor:pointer;background:0 0;border:none;border-radius:4px;margin-inline-start:.5em;padding:8px 16px;font-size:1em}.dialog-menu button.btn-submit{background:var(--color-input)}dialog.error .dialog-menu button.btn-submit{background:var(--color-error)}.dialog-menu button.btn-submit:hover{background:var(--color-input-active)}.dialog-menu .btn-cancel{opacity:.5}.dialog-menu .btn-cancel:hover,.dialog-menu .btn-cancel:focus{opacity:1}.dialog-menu button>i{vertical-align:middle;margin-inline-end:4px;display:inline-block;transform:translateY(-2px)}#dialog_contents{display:flex}#dialog_context_menu{z-index:2;position:absolute;top:0;right:0}\";\n\n\nconst $34a1caf943752901$var$sheet = new CSSStyleSheet();\n$34a1caf943752901$var$sheet.replaceSync(String($eb971f7ae22dc5e1$exports));\nclass $34a1caf943752901$export$2e2bcd8739ae039 extends HTMLElement {\n    dialog;\n    input;\n    static get observedAttributes() {\n        return [\n            'dialog-title',\n            'description',\n            'value',\n            'submit',\n            'cancel',\n            'type',\n            'submit-icon'\n        ];\n    }\n    constructor(){\n        super();\n        const shadow = this.attachShadow({\n            mode: 'open'\n        });\n        shadow.adoptedStyleSheets = [\n            $34a1caf943752901$var$sheet\n        ];\n        this.shadowRoot.innerHTML = `\n      <confirm-dialog>\n        <input\n            type=\"text\"\n            class=\"dialog-input dialog-input-tall\"\n            name=\"patternName\"\n            required\n          />\n      </confirm-dialog>\n    `;\n        this.dialog = shadow.querySelector('confirm-dialog');\n        this.input = shadow.querySelector('input');\n        this.input.addEventListener('keypress', (e)=>{\n            if (e.code === 'Enter') this.dialog.submit();\n        });\n    }\n    connectedCallback() {\n        this.syncAttributes();\n    }\n    attributeChangedCallback() {\n        this.syncAttributes();\n    }\n    syncAttributes() {\n        $34a1caf943752901$export$2e2bcd8739ae039.observedAttributes.filter((attr)=>attr !== 'value').forEach((attr)=>{\n            if (this.hasAttribute(attr)) this.dialog.setAttribute(attr, this.getAttribute(attr));\n            else this.dialog.removeAttribute(attr);\n        });\n        if (this.hasAttribute('value')) this.input.value = this.getAttribute('value') || '';\n    }\n    /**\n   * Opens the dialog, optionally with an initial value.\n   */ show(initialValue) {\n        if (initialValue !== undefined) this.input.value = initialValue;\n        else if (this.hasAttribute('value')) this.input.value = this.getAttribute('value') || '';\n        this.input.select();\n        return this.dialog.show().then(()=>this.input.value);\n    }\n    /**\n   * Gets the value entered by the user if submitted,\n   * or null if canceled.\n   */ getValue() {\n        return this.input.value;\n    }\n}\ncustomElements.define('input-dialog', $34a1caf943752901$export$2e2bcd8739ae039);\n\n\nvar $7a37a3caedf4d681$exports = {};\n$7a37a3caedf4d681$exports = \".hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}@font-face{font-family:string_art_studio;src:url(string_art_studio.09832b61.ttf)format(\\\"truetype\\\"),url(string_art_studio.ca3bae77.woff)format(\\\"woff\\\"),url(string_art_studio.3d53e5dd.svg#string_art_studio)format(\\\"svg\\\");font-weight:400;font-style:normal;font-display:block}i{speak:never;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;line-height:1;font-family:string_art_studio!important}.icon-thread:before{content:\\\"\\\"}.icon-rotate:before{content:\\\"\\\"}.icon-pencil:before{content:\\\"\\\"}.icon-plus:before{content:\\\"\\\"}.icon-trash:before{content:\\\"\\\"}.icon-diskette_b:before{content:\\\"\\\"}.icon-diskette:before{content:\\\"\\\"}.icon-menu:before{content:\\\"\\\"}.icon-arrow_left:before{content:\\\"\\\"}.icon-arrow_right:before{content:\\\"\\\"}.icon-caret_down:before{content:\\\"\\\"}.icon-download:before{content:\\\"\\\"}.icon-fullscreen:before{content:\\\"\\\"}.icon-hamburger:before{content:\\\"\\\"}.icon-options:before{content:\\\"\\\"}.icon-pause:before{content:\\\"\\\"}.icon-play:before{content:\\\"\\\"}.icon-refresh:before{content:\\\"\\\"}.icon-share:before{content:\\\"\\\"}.icon-thumbnails:before{content:\\\"\\\"}.icon-x:before{content:\\\"\\\"}[hidden]{display:none!important}dialog{background:var(--color-dialog-background);color:#fff;border:var(--border-dialog);box-sizing:border-box;width:400px;max-width:calc(100vw - 20px);margin:0;padding:0;position:fixed;top:100px;left:50%;transform:translate(-50%);box-shadow:0 0 10px #000c}dialog[open]{flex-direction:column;display:flex}#dialog_wrapper{box-sizing:border-box;width:100%;max-height:calc(100vh - 20px);padding:1em;overflow:auto}dialog.centered{top:50%;transform:translate(-50%)translateY(-50%)}dialog::backdrop{background:#000000b3}.dialog-title{color:var(--color-accent);text-shadow:1px 1px 1px #000;margin-top:0;font-size:1.4em;font-weight:400}dialog.error .dialog-title{color:var(--color-error)}.dialog-menu{text-align:end;flex-direction:row;justify-content:end;align-items:center;margin-bottom:0;display:flex}.dialog-menu button{color:#fff;cursor:pointer;background:0 0;border:none;border-radius:4px;margin-inline-start:.5em;padding:8px 16px;font-size:1em}.dialog-menu button.btn-submit{background:var(--color-input)}dialog.error .dialog-menu button.btn-submit{background:var(--color-error)}.dialog-menu button.btn-submit:hover{background:var(--color-input-active)}.dialog-menu .btn-cancel{opacity:.5}.dialog-menu .btn-cancel:hover,.dialog-menu .btn-cancel:focus{opacity:1}.dialog-menu button>i{vertical-align:middle;margin-inline-end:4px;display:inline-block;transform:translateY(-2px)}#dialog_contents{display:flex}#dialog_context_menu{z-index:2;position:absolute;top:0;right:0}\";\n\n\nvar $08ec3d656de31381$exports = {};\n$08ec3d656de31381$exports = \"<dialog>\\n  <div id=dialog_wrapper>\\n    <div id=dialog_context_menu>\\n      <slot name=context-menu></slot>\\n    </div>\\n    <form method=dialog>\\n      <h2 class=dialog-title></h2>\\n      <p class=dialog-desc></p>\\n      <div id=dialog_contents>\\n        <slot></slot>\\n      </div>\\n      <menu class=dialog-menu>\\n        <button type=button class=btn-cancel>Cancel</button>\\n        <button value=confirm class=btn-submit>\\n          <i id=submit_icon class=icon hidden></i>\\n          <span id=submit_text></span>\\n        </button>\\n      </menu>\\n    </form>\\n  </div>\\n</dialog>\\n\";\n\n\n\nconst $1b7158181746ebe4$var$sheet = new CSSStyleSheet();\n$1b7158181746ebe4$var$sheet.replaceSync(String($7a37a3caedf4d681$exports));\nclass $1b7158181746ebe4$export$2e2bcd8739ae039 extends HTMLElement {\n    dialog;\n    cancelBtn;\n    submitBtn;\n    titleEl;\n    descEl;\n    submitText;\n    submitIcon;\n    static get observedAttributes() {\n        return [\n            'dialog-title',\n            'description',\n            'submit',\n            'cancel',\n            'type',\n            'centered',\n            'submit-icon',\n            'width'\n        ];\n    }\n    constructor(){\n        super();\n        const shadow = this.attachShadow({\n            mode: 'open'\n        });\n        shadow.adoptedStyleSheets = [\n            $1b7158181746ebe4$var$sheet\n        ];\n        this.shadowRoot.innerHTML = String($08ec3d656de31381$exports);\n        this.dialog = shadow.querySelector('dialog');\n        this.cancelBtn = shadow.querySelector('.btn-cancel');\n        this.submitBtn = shadow.querySelector('.btn-submit');\n        this.titleEl = shadow.querySelector('.dialog-title');\n        this.descEl = shadow.querySelector('.dialog-desc');\n        this.submitText = shadow.querySelector('#submit_text');\n        this.submitIcon = shadow.querySelector('#submit_icon');\n    }\n    connectedCallback() {\n        this.cancelBtn.addEventListener('click', ()=>{\n            this.dialog.returnValue = '';\n            this.dialog.close();\n        });\n        // Initialize attributes on first connect\n        this.syncAttributes();\n    }\n    attributeChangedCallback() {\n        this.syncAttributes();\n    }\n    syncAttributes() {\n        if (this.hasAttribute('dialog-title')) this.titleEl.textContent = this.getAttribute('dialog-title');\n        if (this.hasAttribute('description')) this.descEl.textContent = this.getAttribute('description');\n        this.submitText.textContent = this.getAttribute('submit') || 'Submit';\n        this.cancelBtn.textContent = this.getAttribute('cancel') || 'Cancel';\n        if (this.hasAttribute('type') && this.getAttribute('type') === 'error') this.dialog.classList.add('error');\n        else this.dialog.classList.remove('error');\n        if (this.hasAttribute('centered') && this.getAttribute('centered') !== 'false') this.dialog.classList.add('centered');\n        else this.dialog.classList.remove('centered');\n        if (this.hasAttribute('submit-icon')) {\n            this.submitIcon.className = 'icon-' + this.getAttribute('submit-icon');\n            (0, $8d5cef8e7fea78a8$export$f823a0c1cf7adf68)(this.submitIcon);\n        } else (0, $8d5cef8e7fea78a8$export$fe8985bb6374093c)(this.submitIcon);\n        if (this.hasAttribute('width')) {\n            const value = this.getAttribute('width');\n            const isPx = /^\\d+$/.test(value);\n            this.dialog.style.setProperty('width', isPx ? `${value}px` : value);\n        } else this.dialog.style.removeProperty('width');\n    }\n    /**\n   * Opens the dialog, optionally with an initial value.\n   */ show(onShow) {\n        this.dialog.showModal();\n        onShow?.();\n        return new Promise((resolve, reject)=>{\n            const handleClose = ()=>{\n                this.dialog.removeEventListener('close', handleClose);\n                if (this.dialog.returnValue === 'confirm') resolve();\n                else reject();\n            };\n            this.dialog.addEventListener('close', handleClose);\n        });\n    }\n    submit() {\n        this.submitBtn.click();\n    }\n}\ncustomElements.define('confirm-dialog', $1b7158181746ebe4$export$2e2bcd8739ae039);\n\n\nvar $0346d3bbf80d0cab$exports = {};\n$0346d3bbf80d0cab$exports = \".hidden{display:none}fieldset{border:none;margin:0 0 1.3em;padding:0}section:not(:last-child){margin-bottom:1em}fieldset:last-child{margin-bottom:0}fieldset>section{margin-top:.3em}.dialog-input{border:solid 1px var(--color-input);color:#fff;box-sizing:border-box;background:0 0;border-radius:4px;outline:none;height:32px!important;padding:4px 8px!important}.dialog-input-small{width:50px}.dialog-input-tall{width:100%;font-size:1.1em;height:50px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-input option{color:#000;background-color:#fff}.row{flex-direction:row;align-items:center;display:flex}.dialog-lesser-select{color:#fffc;cursor:pointer;background:0 0;border:none;border-bottom:1px dotted #ffffff80;height:32px!important;padding:0!important}.dialog-lesser-select option{color:#000}.radio-list{border:solid 1px var(--color-input);box-sizing:border-box;border-radius:4px;align-items:center;width:fit-content;height:32px;padding:4px 8px;display:flex}.radio-list input[type=radio]{margin:0 4px 0 0}input[type=radio]+label{margin-bottom:0;display:inline-block}input[type=radio]+label:not(:last-child){margin-inline-end:1.5em}@font-face{font-family:string_art_studio;src:url(string_art_studio.09832b61.ttf)format(\\\"truetype\\\"),url(string_art_studio.ca3bae77.woff)format(\\\"woff\\\"),url(string_art_studio.3d53e5dd.svg#string_art_studio)format(\\\"svg\\\");font-weight:400;font-style:normal;font-display:block}i{speak:never;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;line-height:1;font-family:string_art_studio!important}.icon-thread:before{content:\\\"\\\"}.icon-rotate:before{content:\\\"\\\"}.icon-pencil:before{content:\\\"\\\"}.icon-plus:before{content:\\\"\\\"}.icon-trash:before{content:\\\"\\\"}.icon-diskette_b:before{content:\\\"\\\"}.icon-diskette:before{content:\\\"\\\"}.icon-menu:before{content:\\\"\\\"}.icon-arrow_left:before{content:\\\"\\\"}.icon-arrow_right:before{content:\\\"\\\"}.icon-caret_down:before{content:\\\"\\\"}.icon-download:before{content:\\\"\\\"}.icon-fullscreen:before{content:\\\"\\\"}.icon-hamburger:before{content:\\\"\\\"}.icon-options:before{content:\\\"\\\"}.icon-pause:before{content:\\\"\\\"}.icon-play:before{content:\\\"\\\"}.icon-refresh:before{content:\\\"\\\"}.icon-share:before{content:\\\"\\\"}.icon-thumbnails:before{content:\\\"\\\"}.icon-x:before{content:\\\"\\\"}#buttons{grid-area:\\\"controls\\\";border-right:var(--border-light);background:var(--color-header);z-index:3;padding:0 var(--horizontal-padding);justify-content:space-evenly;align-items:center;display:flex;position:relative;box-shadow:0 -2px 6px #0000004d}#buttons .btn{margin:0}.btn{color:#fff;cursor:pointer;background:#0375fb;border:none;border-radius:15px;width:100%;height:30px;margin-bottom:8px}.btn:hover{background:#3592ff}.btn_subdued{color:#000;background:#c5c5c5}.btn_subdued:hover{color:#000;background:#efefef}.circular_btn{width:var(--controls-height);height:var(--controls-height);cursor:pointer;color:var(--color-text);background:0 0;border:none;justify-content:center;align-items:center;font-size:28px;display:flex}.circular_btn:hover{color:var(--color-text);background:#0000004d}.circular_btn img{width:18px;height:18px}.circular_btn.active{background:radial-gradient(circle at 50% 100%,#5205e7,#220c1b);padding:0;box-shadow:inset 0 4px 6px #0009}.circular_btn.active i{transform:scale(.95)}#buttons_dialogs{z-index:2;height:calc(100vh - var(--controls-height) - var(--select-height));width:100%;position:absolute;bottom:100%;overflow:hidden}.buttons_dialog{--buttons-dialog-border-radius:10px;bottom:var(--controls-height);z-index:1;background:var(--color-buttons-dialog);width:var(--sidebar-width);padding:var(--vertical-padding)var(--horizontal-padding);padding-top:calc(2*var(--buttons-dialog-border-radius));border-top:var(--border-light);transition:transform .2s ease-out;position:fixed;transform:translateY(100%);box-shadow:0 -2px 7px #000000b3}.buttons_dialog.open{transform:translateY(0)}.btn-icon{color:#fff;cursor:pointer;background:0 0;border:none;align-items:center;font-size:22px;display:flex}.menu_btn{background:var(--color-accent);height:48px;color:var(--color-text);border-radius:24px;align-items:center;padding:0 32px 0 24px;font-weight:500;text-decoration:none;display:inline-flex;font-size:1.1em!important}@media only screen and (width<=600px){.menu_btn{justify-content:center;width:auto;display:flex}}.menu_btn:hover{background:var(--color-accent-hover);color:var(--color-text);text-decoration:none}.menu_btn img{margin-inline-end:8px}.icon_btn{color:#fffc;cursor:pointer;background:0 0;border:none;border-radius:4px;padding:4px 6px;font-size:14px}.icon_btn:hover{color:#fff}.icon_btn>i{position:relative;top:1px}#wrapper{width:100%;display:block}form{grid-area:form;overflow:auto}#preview{margin-top:1em}#canvas{--checkers1:#fff;--checkers2:#bbb;box-sizing:border-box;background:conic-gradient(var(--checkers2)25%,var(--checkers1)0 50%,var(--checkers2)0 75%,var(--checkers1)0);background-size:40px 40px;outline:1px solid #666;width:100%;height:300px;margin-top:4px;position:relative;box-shadow:inset 0 1px 5px #0000}canvas{width:100%;height:100%;position:absolute;top:0;left:0}@media only screen and (width<=600px){#canvas{max-height:250px}}@media only screen and (width>=601px){#wrapper{grid-template:\\\"preview form\\\"1fr/200px 1fr;gap:1em;display:grid}#preview{grid-area:preview;margin-top:0}}section{margin-bottom:1px}label:not(.icon_btn){margin-bottom:4px;display:block}input[type=checkbox]:checked+.icon_btn{color:#fff;background:#ffffff1a}\";\n\n\nvar $7daf604df182e360$exports = {};\n$7daf604df182e360$exports = \"<confirm-dialog dialog-title=\\\"Download image\\\" submit=Download submit-icon=download centered width=640>\\n  <div id=wrapper>\\n    <form>\\n      <fieldset>\\n        <label for=type>Type</label>\\n        <div class=radio-list>\\n          <input type=radio name=type id=type_all value=all checked>\\n          <label for=type_all>Image</label>\\n          <input type=radio name=type id=type_nails_map value=nails_map>\\n          <label for=type_nails_map>Nails map </label>\\n        </div>\\n      </fieldset>\\n      <label for=size>Image size</label>\\n      <section>\\n        <div style=flex:0>\\n          <select id=size class=dialog-input style=width:auto name=size></select>\\n        </div>\\n        <div style=white-space:nowrap;flex:1;margin-top:.5em>\\n          <div id=width_and_height>\\n            <dimensions-input id=image_dimensions name=image_dimensions></dimensions-input>\\n            <select class=\\\"dialog-lesser-select unit-select\\\" name=unit>\\n              <option value=cm>cm</option>\\n              <option value=inch>inch</option>\\n              <option value=px>px</option>\\n            </select>\\n            <input type=checkbox id=rotate_image name=rotate_image hidden>\\n            <label id=rotate_btn class=icon_btn title=Rotate type=button for=rotate_image>\\n              <i class=icon-rotate></i>\\n            </label>\\n          </div>\\n        </div>\\n      </section>\\n      <section>\\n        <label for=pattern_size>Pattern size</label>\\n        <dimensions-input id=pattern_size name=pattern_dimensions></dimensions-input>\\n        <select class=\\\"dialog-lesser-select unit-select\\\" name=unit>\\n          <option value=cm>cm</option>\\n          <option value=inch>inch</option>\\n          <option value=px>px</option>\\n        </select>\\n      </section>\\n      <section>\\n        <label for=margin>Margin</label>\\n        <input type=number id=margin value=0 style=width:70px min=0 step=1 class=\\\"dialog-input size-input\\\" name=margin>\\n        <select class=\\\"dialog-lesser-select unit-select\\\" name=unit>\\n          <option value=cm>cm</option>\\n          <option value=inch>inch</option>\\n          <option value=px>px</option>\\n        </select>\\n      </section>\\n      <div style=margin-top:1.5em>\\n        <expandable-panel legend=\\\"More options\\\" minimized>\\n          <fieldset class=dialog-checkbox hidden id=render_numbers_block>\\n            <string-art-checkbox id=render_numbers label=\\\"Show nail numbers\\\" name=render_numbers data-updates-preview>\\n          </string-art-checkbox></fieldset>\\n\\n          <fieldset id=dpi_block>\\n            <label for=dpi>Print resolution</label>\\n            <select id=dpi value=300 class=dialog-input style=width:80px name=dpi>\\n              <option value=72>72</option>\\n              <option value=150>150</option>\\n              <option value=200>200</option>\\n              <option value=300 selected>300</option>\\n              <option value=360>360</option>\\n              <option value=600>600</option>\\n              <option value=720>720</option>\\n              <option value=1200>1200</option>\\n              <option value=2400>2400</option>\\n              <option value=2880>2880</option>\\n            </select>\\n            <label for=dpi style=display:inline>DPI</label>\\n          </fieldset>\\n          <fieldset>\\n            <section>\\n              <label for=format>Image type</label>\\n              <select id=format class=dialog-input name=format data-updates-preview>\\n                <option value=png>PNG</option>\\n                <option value=jpeg>JPEG</option>\\n                <option value=webp>WEBP</option>\\n                <option value=svg>SVG</option>\\n              </select>\\n            </section>\\n            <section id=transparent_background_block>\\n              <string-art-checkbox id=transparent_background label=\\\"Transparent background\\\" name=transparent_background data-updates-preview>\\n            </string-art-checkbox></section>\\n          </fieldset>\\n        </expandable-panel>\\n      </div>\\n    </form>\\n    <div id=preview>\\n      Preview\\n      <article id=canvas></article>\\n    </div>\\n  </div>\\n</confirm-dialog>\\n\";\n\n\n\n\nconst $37ffe584ad149ed5$var$UNITS_LOCALSTORAGE_KEY = 'units';\nclass $37ffe584ad149ed5$var$Preferences extends (0, $00df09d341073864$export$2e2bcd8739ae039) {\n    #userPreferredUnits;\n    getUserPreferredUnits() {\n        if (!this.#userPreferredUnits) this.#userPreferredUnits = localStorage.getItem($37ffe584ad149ed5$var$UNITS_LOCALSTORAGE_KEY) === 'inch' ? 'inch' : 'cm';\n        return this.#userPreferredUnits;\n    }\n    setUserPreferredUnits(units) {\n        if (this.#userPreferredUnits !== units) {\n            this.#userPreferredUnits = units;\n            localStorage.setItem($37ffe584ad149ed5$var$UNITS_LOCALSTORAGE_KEY, units);\n            this.emit('unitsChange', units);\n        }\n    }\n}\nconst $37ffe584ad149ed5$var$preferences = new $37ffe584ad149ed5$var$Preferences();\nvar $37ffe584ad149ed5$export$2e2bcd8739ae039 = $37ffe584ad149ed5$var$preferences;\n\n\n\n\n\nfunction $b7266296a7c0118e$export$bb3b75778e3e272({ data: data, filename: filename }) {\n    const dataUrl = URL.createObjectURL(data);\n    const downloadLink = document.createElement('a');\n    downloadLink.href = dataUrl;\n    downloadLink.download = filename;\n    document.body.appendChild(downloadLink);\n    downloadLink.click();\n    document.body.removeChild(downloadLink);\n    URL.revokeObjectURL(dataUrl);\n}\nasync function $b7266296a7c0118e$export$ef63c67b3e1358f7(pattern, { type: type, ...options }) {\n    const overridingConfig = $b7266296a7c0118e$export$a4f48c82401c4(options);\n    if (overridingConfig) {\n        pattern = pattern.copy();\n        pattern.assignConfig(overridingConfig);\n    }\n    if (options.units) options = {\n        ...options,\n        size: (0, $b683a3137b30eaa9$export$2e7f3602dd2acd76)(options.size, options.units, 'px', options.dpi)\n    };\n    const downloadData = type === 'svg' ? $b7266296a7c0118e$var$patternToSVGDownloadData(pattern, options) : await $b7266296a7c0118e$var$patternToImageDownloadData(pattern, options);\n    $b7266296a7c0118e$export$bb3b75778e3e272(downloadData);\n}\nfunction $b7266296a7c0118e$export$a4f48c82401c4(options) {\n    const config = {};\n    if (options.margin) config.margin = (0, $b683a3137b30eaa9$export$6625f4a88a935670)(options.margin, options.units ?? 'px', 'px', options.dpi);\n    if (options.isNailsMap) Object.assign(config, {\n        darkMode: false,\n        showNails: true,\n        showNailNumbers: options.includeNailNumbers,\n        showStrings: false,\n        nailsColor: '#000000',\n        backgroundColor: '#ffffff'\n    });\n    if (options.enableBackground != null) Object.assign(config, {\n        enableBackground: options.enableBackground\n    });\n    return Object.keys(config).length === 0 ? null : config;\n}\nasync function $b7266296a7c0118e$var$patternToImageDownloadData(pattern, { size: size, filename: filename, imageType: imageType }) {\n    const parentElement = document.createElement('article');\n    const renderer = new (0, $2f2e0bbe9a3a6970$export$2e2bcd8739ae039)(parentElement, {\n        updateOnResize: false\n    });\n    renderer.disablePixelRatio();\n    renderer.setFixedSize(size);\n    pattern.draw(renderer);\n    return {\n        data: await renderer.toBlob(imageType),\n        filename: `${filename ?? pattern.name}.${imageType ?? 'png'}`\n    };\n}\nfunction $b7266296a7c0118e$var$patternToSVGDownloadData(pattern, { size: size, filename: filename }) {\n    const parentEl = document.createElement('article');\n    parentEl.style.width = size[0] + 'px';\n    parentEl.style.height = size[1] + 'px';\n    document.body.appendChild(parentEl);\n    const renderer = new (0, $0649237e9259f2a7$export$2e2bcd8739ae039)(parentEl);\n    renderer.setFixedSize(size);\n    pattern.draw(renderer);\n    const svgData = renderer.svg.outerHTML;\n    const svgBlob = new Blob([\n        svgData\n    ], {\n        type: 'image/svg+xml;charset=utf-8'\n    });\n    return {\n        data: svgBlob,\n        filename: filename ?? pattern.name + '.svg'\n    };\n}\n\n\n\n\nconst $9ecbf20527c60613$var$DEFAULT_DIMENSIONS = [\n    10,\n    10\n];\nconst $9ecbf20527c60613$export$1ddaf6ceff5ce8d6 = [\n    {\n        id: 'fit',\n        name: 'Fit pattern',\n        dimensions: ({ customDimensions: customDimensions, patternAspectRatio: patternAspectRatio })=>{\n            let dimensions = customDimensions;\n            if (!dimensions) {\n                const SMALL_SCREEN_DIMENSION = Math.min(screen.width, screen.height);\n                const dpr = window.devicePixelRatio ?? 1;\n                dimensions = (0, $b683a3137b30eaa9$export$c566af9defc62c6)([\n                    SMALL_SCREEN_DIMENSION,\n                    SMALL_SCREEN_DIMENSION\n                ], (v)=>v * dpr);\n            }\n            const customDimensionsFitPattern = [\n                dimensions[0],\n                dimensions[0] / patternAspectRatio\n            ];\n            return (0, $b683a3137b30eaa9$export$18c295d7a6a8189d)(customDimensionsFitPattern, dimensions);\n        },\n        units: [\n            'px',\n            'cm',\n            'inch'\n        ],\n        defaultUnits: 'px',\n        defaultMargin: 20,\n        allowSizeEdit: true,\n        aspectRatio: ({ patternAspectRatio: patternAspectRatio })=>patternAspectRatio\n    },\n    {\n        id: 'screen',\n        name: 'Screen size',\n        dimensions: ()=>{\n            const dpr = window.devicePixelRatio ?? 1;\n            return [\n                window.screen.width,\n                window.screen.height\n            ].map((v)=>Math.floor(v * dpr));\n        },\n        units: [\n            'px'\n        ],\n        defaultMargin: 10,\n        allowRotate: true\n    },\n    ...(0, $b683a3137b30eaa9$export$e8dd885a22676074).map((size)=>({\n            ...size,\n            units: [\n                'cm',\n                'inch'\n            ],\n            inUnits: 'cm',\n            defaultMargin: 1,\n            allowRotate: true\n        })),\n    {\n        id: 'custom',\n        name: \"Custom size\\u2026\",\n        dimensions: ({ customDimensions: customDimensions, currentDimensions: currentDimensions })=>currentDimensions ?? customDimensions ?? $9ecbf20527c60613$var$DEFAULT_DIMENSIONS,\n        allowSizeEdit: true,\n        allowRotate: true\n    }\n];\nfunction $9ecbf20527c60613$export$1c29b97c038fa375(id) {\n    return $9ecbf20527c60613$export$1ddaf6ceff5ce8d6.find(({ id: sizeId })=>sizeId === id);\n}\n\n\n\n\nconst $00eb9133a5a9a95d$var$sheet = new CSSStyleSheet();\n$00eb9133a5a9a95d$var$sheet.replaceSync(String($0346d3bbf80d0cab$exports));\nconst $00eb9133a5a9a95d$var$DEFAULT_DPI = 300;\nconst $00eb9133a5a9a95d$var$IMAGE_TYPES_WITH_TRANSPARENT_BACKGROUND = [\n    'png',\n    'svg',\n    'webp'\n];\nclass $00eb9133a5a9a95d$export$2e2bcd8739ae039 extends HTMLElement {\n    dialog;\n    elements;\n    units;\n    customDimensions;\n    dimensions;\n    margin;\n    patternAspectRatio = 1;\n    currentSize;\n    currentPattern;\n    unitFloatingPointsPrecision = 0;\n    constructor(){\n        super();\n        const shadow = this.attachShadow({\n            mode: 'open'\n        });\n        shadow.adoptedStyleSheets = [\n            $00eb9133a5a9a95d$var$sheet\n        ];\n        this.shadowRoot.innerHTML = String($7daf604df182e360$exports);\n        this.dialog = shadow.querySelector('confirm-dialog');\n        this.elements = {\n            size: shadow.querySelector('#size'),\n            form: shadow.querySelector('form'),\n            unitSelect: shadow.querySelectorAll('.unit-select'),\n            dpi: shadow.querySelector('#dpi'),\n            dpiBlock: shadow.querySelector('#dpi_block'),\n            renderNumbersBlock: shadow.querySelector('#render_numbers_block'),\n            patternDimensions: shadow.querySelector('#pattern_size'),\n            imageDimensions: shadow.querySelector('#image_dimensions'),\n            margin: shadow.querySelector('#margin'),\n            canvas: shadow.querySelector('#canvas'),\n            transparentBackground: shadow.querySelector('#transparent_background'),\n            rotateBtn: shadow.querySelector('#rotate_btn')\n        };\n        this.#setSizes();\n        this.setSize((0, $9ecbf20527c60613$export$1ddaf6ceff5ce8d6)[0].id);\n        (0, $37ffe584ad149ed5$export$2e2bcd8739ae039).addEventListener('unitsChange', (units)=>{\n            if (this.units !== 'px') this.setUnits(units);\n        });\n        shadow.addEventListener('focusin', (e)=>{\n            if (e.target instanceof HTMLInputElement && (e.target.type === 'text' || e.target.type === 'number')) e.target.select();\n        });\n        shadow.addEventListener('change', (e)=>{\n            if (e.target instanceof HTMLSelectElement && e.target.classList.contains('unit-select')) this.setUnits(e.target.value);\n            if (e.target === this.elements.size) this.setSize(this.elements.size.value);\n            if (e.target instanceof HTMLInputElement && e.target.type === 'radio' && e.target.name === 'type') {\n                const selectedType = this.elements.form.querySelector('input[name=\"type\"]:checked')?.value;\n                this.setType(selectedType);\n            }\n            if (e.target instanceof HTMLElement && e.target.dataset.updatesPreview != null) this.updatePreview();\n            if (e.target instanceof HTMLSelectElement && e.target.id === 'format') this.setImageType(e.target.value);\n        });\n        this.elements.margin.addEventListener('input', (e)=>{\n            const value = Number(e.target.value);\n            this.setMargin(isNaN(value) ? 0 : value);\n        });\n        this.elements.imageDimensions.addEventListener('dimensionchange', ({ detail: { dimension: dimension, value: dimensions, ...size } })=>{\n            const value = size[dimension];\n            if (this.customDimensions) {\n                this.customDimensions = dimensions;\n                this.setDimensions(dimensions);\n                this.elements.patternDimensions.setMaxDimensions(dimensions);\n                this.elements.patternDimensions[dimension] = value - this.margin * 2;\n            }\n            this.updatePreview();\n        });\n        this.elements.patternDimensions.addEventListener('dimensionchange', ({ detail: { dimension: dimension, value: dimensions, ...size } })=>{\n            const value = size[dimension];\n            if (this.dimensions) this.setMargin(this.dimensions[dimension === 'width' ? 0 : 1] - value, {\n                updatePatternDimensions: false\n            });\n        });\n        this.elements.rotateBtn.addEventListener('click', ()=>this.rotateImage());\n    }\n    setType(type, updatePreview = true) {\n        this.shadowRoot.querySelector(`#type_${type}`).checked = true;\n        this.#toggleNailNumbers(type === 'nails_map');\n        const transparentBackgroundBlock = this.shadowRoot.querySelector('#transparent_background_block');\n        if (type === 'nails_map') (0, $8d5cef8e7fea78a8$export$fe8985bb6374093c)(transparentBackgroundBlock);\n        else (0, $8d5cef8e7fea78a8$export$f823a0c1cf7adf68)(transparentBackgroundBlock);\n        if (updatePreview) this.updatePreview();\n    }\n    setImageType(imageType) {\n        this.shadowRoot.querySelector('#format').value = imageType;\n        (0, $8d5cef8e7fea78a8$export$1a3b688c8bc0de17)(this.elements.transparentBackground, !$00eb9133a5a9a95d$var$IMAGE_TYPES_WITH_TRANSPARENT_BACKGROUND.includes(imageType));\n    }\n    getFormValues() {\n        const data = new FormData(this.elements.form);\n        return Object.fromEntries(data.entries());\n    }\n    get isTransparentBackground() {\n        const formValues = this.getFormValues();\n        return formValues.type !== 'nails_map' && $00eb9133a5a9a95d$var$IMAGE_TYPES_WITH_TRANSPARENT_BACKGROUND.includes(String(formValues.format)) && formValues.transparent_background === 'on';\n    }\n    #setSizes() {\n        this.elements.size.innerHTML = (0, $9ecbf20527c60613$export$1ddaf6ceff5ce8d6).map(({ id: id, name: name })=>`<option value=\"${id}\">${name ?? id}</option>`).join('\\n');\n    }\n    #toggleNailNumbers(show) {\n        (0, $8d5cef8e7fea78a8$export$1a3b688c8bc0de17)(this.elements.renderNumbersBlock, !show);\n    }\n    get dpi() {\n        return Number(this.elements.dpi.value ?? $00eb9133a5a9a95d$var$DEFAULT_DPI);\n    }\n    rotateImage() {\n        this.setDimensions(this.#swapDimensions(this.dimensions));\n    }\n    setUnits(units, updatePreview = true) {\n        if (units === this.units) return;\n        const prevUnits = this.units;\n        this.units = units;\n        this.elements.unitSelect.forEach((unitSelect)=>{\n            unitSelect.value = units;\n        });\n        this.unitFloatingPointsPrecision = units === 'px' ? 0 : 1;\n        if (units === 'cm' || units === 'inch') {\n            (0, $37ffe584ad149ed5$export$2e2bcd8739ae039).setUserPreferredUnits(units);\n            (0, $8d5cef8e7fea78a8$export$f823a0c1cf7adf68)(this.elements.dpiBlock);\n        } else (0, $8d5cef8e7fea78a8$export$fe8985bb6374093c)(this.elements.dpiBlock);\n        this.elements.patternDimensions.setFloatingPoints(this.unitFloatingPointsPrecision);\n        this.elements.imageDimensions.setFloatingPoints(this.unitFloatingPointsPrecision);\n        // If changing from length unit to px or vice-versa, need to convert dimensions\n        if (prevUnits) {\n            if (this.dimensions) this.dimensions = (0, $b683a3137b30eaa9$export$2e7f3602dd2acd76)(this.dimensions, prevUnits, units, this.dpi);\n            if (this.margin) this.setMargin((0, $b683a3137b30eaa9$export$6625f4a88a935670)(this.margin, prevUnits, units, this.dpi));\n        }\n        if (this.dimensions) this.setDimensions(this.dimensions, updatePreview);\n    }\n    getMarginMax() {\n        if (this.dimensions) return Math.min(this.dimensions[0] / 2.1, this.dimensions[1] / 2.1);\n        return null;\n    }\n    setMargin(margin, { updatePatternDimensions: updatePatternDimensions = true, updatePreview: updatePreview = true } = {}) {\n        margin = Math.max(margin, 0);\n        if (this.dimensions) margin = Math.min(margin, this.getMarginMax());\n        if (margin === this.margin) return;\n        this.margin = margin ?? 0;\n        this.elements.margin.value = String(margin.toFixedPrecision(this.unitFloatingPointsPrecision) ?? 0);\n        if (updatePatternDimensions && this.dimensions) this.updatePatternDimensions();\n        if (updatePreview) this.updatePreview();\n    }\n    setSize(id, updatePreview = true) {\n        const size = (0, $9ecbf20527c60613$export$1c29b97c038fa375)(id);\n        this.currentSize = size;\n        const { units: units, dimensions: sizeDimensions, aspectRatio: aspectRatio, allowSizeEdit: allowSizeEdit, defaultUnits: defaultUnits, inUnits: inUnits, defaultMargin: defaultMargin = 0, allowRotate: allowRotate } = size;\n        this.elements.imageDimensions.aspectRatio = aspectRatio instanceof Function ? aspectRatio({\n            patternAspectRatio: this.patternAspectRatio\n        }) : aspectRatio;\n        let dimensions = sizeDimensions instanceof Function ? sizeDimensions({\n            customDimensions: this.customDimensions,\n            currentDimensions: this.dimensions,\n            patternAspectRatio: this.patternAspectRatio\n        }) : sizeDimensions;\n        if (allowSizeEdit) {\n            this.elements.imageDimensions.isReadonly = false;\n            this.customDimensions = dimensions;\n        } else this.elements.imageDimensions.isReadonly = true;\n        (0, $8d5cef8e7fea78a8$export$1a3b688c8bc0de17)(this.elements.rotateBtn, !allowRotate);\n        const isPixelsOnly = units && units.length === 1 && units[0] === 'px';\n        this.togglePixels(!units || units.includes('px'));\n        this.setPixelsOnly(isPixelsOnly);\n        const newUnits = defaultUnits ?? (isPixelsOnly ? 'px' : units && !units.includes(this.units) ? (0, $37ffe584ad149ed5$export$2e2bcd8739ae039).getUserPreferredUnits() : this.units);\n        this.setUnits(newUnits);\n        if (inUnits && inUnits !== newUnits) dimensions = (0, $b683a3137b30eaa9$export$c566af9defc62c6)((0, $b683a3137b30eaa9$export$2e7f3602dd2acd76)(dimensions, inUnits, newUnits, this.dpi), (v)=>v.toFixedPrecision(1));\n        if (defaultMargin) this.setMargin(defaultMargin);\n        this.setDimensions(dimensions, updatePreview);\n        if (updatePreview) this.updatePreview();\n        this.elements.size.value = id;\n    }\n    togglePixels(showPixels) {\n        this.elements.unitSelect.forEach((el)=>{\n            const pixelsOption = el.querySelector('[value=\"px\"]');\n            (0, $8d5cef8e7fea78a8$export$1a3b688c8bc0de17)(pixelsOption, !showPixels);\n        });\n    }\n    #getDimensionsBySizeId(id) {\n        const { dimensions: dimensions } = (0, $9ecbf20527c60613$export$1c29b97c038fa375)(id);\n        return dimensions instanceof Function ? dimensions({\n            customDimensions: this.customDimensions,\n            currentDimensions: this.dimensions,\n            patternAspectRatio: this.patternAspectRatio\n        }) : dimensions;\n    }\n    setPixelsOnly(isPixelsOnly) {\n        if (isPixelsOnly) this.togglePixels(true);\n        this.elements.unitSelect.forEach((el)=>{\n            if (isPixelsOnly) el.setAttribute('disabled', 'disabled');\n            else el.removeAttribute('disabled');\n            const nonPixelOptions = el.querySelectorAll(':not([value=\"px\"])');\n            nonPixelOptions.forEach((option)=>(0, $8d5cef8e7fea78a8$export$1a3b688c8bc0de17)(option, isPixelsOnly));\n        });\n    }\n    setDimensions(dimensions, updatePreview = true) {\n        this.dimensions = dimensions;\n        this.elements.imageDimensions.width = dimensions[0];\n        this.elements.imageDimensions.height = dimensions[1];\n        this.elements.canvas.style.removeProperty('width');\n        this.elements.canvas.style.removeProperty('height');\n        this.elements.margin.setAttribute('max', String(this.getMarginMax()));\n        this.updatePatternDimensions();\n        if (updatePreview) this.updatePreview();\n    }\n    updatePatternDimensions() {\n        const patternDimensions = this.#getPatternDimensions();\n        this.elements.patternDimensions.maxWidth = this.dimensions[0];\n        this.elements.patternDimensions.maxHeight = this.dimensions[1];\n        this.elements.patternDimensions.width = patternDimensions[0];\n        this.elements.patternDimensions.height = patternDimensions[1];\n    }\n    #getPatternDimensions() {\n        const width = this.dimensions[0] - this.margin * 2;\n        const patternAvailableDimensions = (0, $b683a3137b30eaa9$export$c566af9defc62c6)(this.dimensions, (v)=>v - this.margin * 2);\n        if (!this.patternAspectRatio || isNaN(this.patternAspectRatio)) return patternAvailableDimensions;\n        const patternDimensions = [\n            width,\n            width / this.patternAspectRatio\n        ];\n        return (0, $b683a3137b30eaa9$export$18c295d7a6a8189d)(patternDimensions, (0, $b683a3137b30eaa9$export$c566af9defc62c6)(this.dimensions, (v)=>v - this.margin * 2));\n    }\n    #swapDimensions(dimensions) {\n        return [\n            dimensions[1],\n            dimensions[0]\n        ];\n    }\n    /**\n   * Opens the dialog, optionally with an initial value.\n   */ async show(pattern) {\n        this.currentPattern = pattern;\n        this.patternAspectRatio = pattern.getAspectRatio({\n            size: this.dimensions\n        });\n        this.elements.patternDimensions.setAttribute('aspect-ratio', String(this.patternAspectRatio));\n        this.setSize(this.currentSize.id);\n        return this.dialog.show(()=>{\n            const savedDownloadOptions = (0, $00643d12b3a54506$export$2e2bcd8739ae039).getPatternDownloadData(pattern.id);\n            this.setDownloadOptionsToForm(savedDownloadOptions);\n        }).then(async ()=>{\n            const values = this.getFormValues();\n            const downloadOptions = this.#formValuesToDownloadOptions(values, pattern);\n            (0, $00643d12b3a54506$export$2e2bcd8739ae039).savePatternDownloadData(pattern.id, downloadOptions);\n            await (0, $b7266296a7c0118e$export$ef63c67b3e1358f7)(pattern, downloadOptions);\n        });\n    }\n    #formValuesToDownloadOptions(values, pattern) {\n        const isNailsMap = values.type === 'nails_map';\n        let dimensions = this.#getDimensionsBySizeId(values.size);\n        if (values.rotate_image) dimensions = this.#swapDimensions(dimensions);\n        const options = {\n            size: dimensions,\n            type: values.format === 'svg' ? 'svg' : 'canvas',\n            imageType: values.format === 'svg' ? null : values.format,\n            isNailsMap: isNailsMap,\n            units: values.unit ?? 'px',\n            dpi: Number(values.dpi),\n            margin: Number(values.margin),\n            includeNailNumbers: isNailsMap && values.render_numbers === 'on',\n            filename: isNailsMap ? `${pattern.name} - nail map` : pattern.name,\n            enableBackground: !this.isTransparentBackground,\n            sizeId: String(values.size),\n            isRotated: !!values.rotate_image\n        };\n        return options;\n    }\n    /**\n   * Used when loading saved download options, to populate the form and internals\n   * @param downloadOptions\n   */ setDownloadOptionsToForm(downloadOptions) {\n        if (!downloadOptions) {\n            const size = (0, $9ecbf20527c60613$export$1ddaf6ceff5ce8d6)[0];\n            downloadOptions = {\n                size: size.dimensions instanceof Function ? size.dimensions({\n                    patternAspectRatio: this.patternAspectRatio\n                }) : size.dimensions,\n                sizeId: size.id,\n                margin: size.defaultMargin,\n                units: size.defaultUnits,\n                enableBackground: true\n            };\n        }\n        this.setType(downloadOptions.isNailsMap ? 'nails_map' : 'all', false);\n        this.#toggleNailNumbers(downloadOptions.isNailsMap);\n        this.shadowRoot.querySelector('#render_numbers').value = downloadOptions.includeNailNumbers === true;\n        const sizeId = downloadOptions.sizeId ?? 'custom';\n        this.setSize(sizeId, false);\n        const isRotated = downloadOptions.isRotated === true;\n        this.shadowRoot.querySelector('#rotate_image').checked = isRotated;\n        if (isRotated) this.rotateImage();\n        if (downloadOptions.units != null) this.setUnits(downloadOptions.units, false);\n        this.setMargin(downloadOptions.margin ?? 0, {\n            updatePreview: false\n        });\n        // const { size } = downloadOptions;\n        // if (getDownloadImageSizeById(sizeId).allowSizeEdit) {\n        //   this.customDimensions = size;\n        //   this.setDimensions(size, false);\n        // }\n        this.elements.dpi.value = String(downloadOptions.dpi ?? $00eb9133a5a9a95d$var$DEFAULT_DPI);\n        this.setImageType(downloadOptions.imageType ?? 'png');\n        this.shadowRoot.querySelector('#transparent_background').value = !downloadOptions.enableBackground;\n        this.updatePreview();\n    }\n    updatePreview() {\n        if (!this.currentPattern || !this.elements.canvas.clientWidth) return;\n        this.elements.canvas.innerHTML = '';\n        if (this.elements.canvas.clientWidth) {\n            const pxDimensions = (0, $b683a3137b30eaa9$export$18c295d7a6a8189d)((0, $b683a3137b30eaa9$export$2e7f3602dd2acd76)(this.dimensions, this.units, 'px', this.dpi), [\n                this.elements.canvas.clientWidth || 200,\n                this.elements.canvas.clientHeight || 300\n            ]);\n            this.elements.canvas.style.width = pxDimensions[0] + 'px';\n            this.elements.canvas.style.height = pxDimensions[1] + 'px';\n        }\n        const renderer = new (0, $2f2e0bbe9a3a6970$export$2e2bcd8739ae039)(this.elements.canvas, {\n            updateOnResize: false\n        });\n        const previewSize = [\n            this.elements.canvas.clientWidth || 200,\n            this.elements.canvas.clientHeight || 300\n        ];\n        renderer.setFixedSize(previewSize);\n        const previewPattern = this.currentPattern.copy();\n        const values = this.getFormValues();\n        previewPattern.assignConfig(values.type === 'nails_map' ? {\n            darkMode: false,\n            showNails: true,\n            showNailNumbers: values.render_numbers === 'on',\n            showStrings: false,\n            nailsColor: '#000000',\n            backgroundColor: '#ffffff',\n            enableBackground: true\n        } : {\n            enableBackground: !this.isTransparentBackground,\n            showNailNumbers: false,\n            showStrings: true\n        });\n        const previewSizeRatio = previewSize[0] / this.dimensions[0];\n        previewPattern.assignConfig({\n            margin: Math.floor(this.margin * previewSizeRatio),\n            nailRadius: Math.max(0.5, this.currentPattern.config.nailRadius * previewSizeRatio)\n        });\n        previewPattern.draw(renderer, {\n            precision: 1\n        });\n    }\n}\ncustomElements.define('download-dialog', $00eb9133a5a9a95d$export$2e2bcd8739ae039);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nclass $a244379bf8b3b658$var$Routing extends (0, $00df09d341073864$export$2e2bcd8739ae039) {\n    #popStateListener;\n    #currentRenderer = 'canvas';\n    constructor(){\n        super();\n        const onPopState = this.#popStateListener = ({ state: state })=>{\n            this.#updateFromState(state ?? {});\n        };\n        window.addEventListener('popstate', onPopState);\n    }\n    #updateFromState(state) {\n        const { pattern: patternId, name: patternName, config: config, renderer: renderer = 'canvas' } = state;\n        const actualRenderer = renderer === 'svg' ? 'svg' : 'canvas';\n        if (actualRenderer !== this.#currentRenderer) {\n            this.#currentRenderer = actualRenderer;\n            this.emit('renderer', actualRenderer);\n        }\n        if (patternId) {\n            const pattern = (0, $92270d8b7d92e411$export$ebb1a6b9e8c15cc2)(patternId);\n            if (pattern) {\n                if (patternName) pattern.name = patternName;\n                if (config) // @ts-ignore\n                pattern.setConfig((0, $d8f8628a77747326$export$39ef19ebad6081a3)(pattern, config));\n                this.emit('pattern', {\n                    pattern: pattern,\n                    renderer: actualRenderer\n                });\n            } else throw new Error(`Unknown pattern with ID \"${patternId}\".`);\n        } else this.emit('main', null);\n    }\n    init() {\n        if (history.state?.patternId) this.#updateFromState(history.state);\n        else {\n            const queryParams = (0, $2509ceef6c629a64$export$e2de15bbd9edf9c6)();\n            this.#updateFromState(queryParams);\n        }\n    }\n    destroy() {\n        window.removeEventListener('popstate', this.#popStateListener);\n    }\n    navigateToMain() {\n        history.pushState({\n            patternId: null\n        }, 'String Art Studio', './');\n        this.emit('main', null);\n    }\n    navigateToPattern(pattern, { renderer: renderer = 'canvas', replaceState: replaceState = false } = {}) {\n        const configQuery = pattern.isDefaultConfig ? undefined : (0, $d8f8628a77747326$export$fa8157df3262779b)(pattern);\n        const setHistoryState = (replaceState ? history.replaceState : history.pushState).bind(history);\n        setHistoryState({\n            pattern: pattern.id,\n            config: configQuery,\n            renderer: renderer,\n            name: pattern.name\n        }, pattern.name, (0, $2509ceef6c629a64$export$87dcc7060093bbda)(pattern, {\n            renderer: renderer,\n            patternAsTemplate: false\n        }));\n        if (!replaceState) this.emit('pattern', {\n            pattern: pattern,\n            renderer: renderer\n        });\n    }\n}\nconst $a244379bf8b3b658$var$routing = new $a244379bf8b3b658$var$Routing();\nvar $a244379bf8b3b658$export$2e2bcd8739ae039 = $a244379bf8b3b658$var$routing;\n\n\n\nclass $1e47030bd2e0e155$export$2e2bcd8739ae039 extends (0, $00df09d341073864$export$2e2bcd8739ae039) {\n    element;\n    renderer;\n    pattern;\n    rendererType;\n    cancelDraw;\n    constructor(rendererType = 'canvas'){\n        super();\n        this.rendererType = rendererType;\n        this.element = document.querySelector('#canvas_panel');\n        this.element.addEventListener('wheel', ({ deltaY: deltaY })=>{\n            const direction = -deltaY / Math.abs(deltaY); // Up is 1, down is -1\n            this.emit('positionChange', {\n                changeBy: direction\n            });\n        }, {\n            passive: true\n        });\n        (0, $5082caf0e2beae35$export$2e2bcd8739ae039).addEventListener('showInstructionsChange', ({ showInstructions: showInstructions })=>{\n            this.#withRenderer();\n            if (showInstructions) this.renderer.showInstructions();\n            else this.renderer.hideInstructions();\n        });\n        (0, $a244379bf8b3b658$export$2e2bcd8739ae039).addEventListener('renderer', (rendererType)=>{\n            this.rendererType = rendererType;\n            this.renderer = null;\n        });\n    // Cancelling this for the moment, as it creates problems on mobile, when doing back with gestures:\n    // this.#setTapEvents();\n    }\n    get position() {\n        return this.pattern?.position ?? -1;\n    }\n    get size() {\n        return [\n            this.element.clientWidth,\n            this.element.clientHeight\n        ];\n    }\n    setSize(size) {\n        this.#withRenderer();\n        if (size) {\n            if (!this.element.classList.contains('overflow')) this.element.classList.add('overflow');\n            this.renderer.setFixedSize(size);\n        } else {\n            this.element.classList.remove('overflow');\n            this.renderer.resetSize();\n        }\n    }\n    setRenderer(renderer) {\n        this.renderer = renderer;\n        renderer.addEventListener('sizeChange', ({ size: size })=>this.#updateOnSizeChange(size));\n    }\n    setPattern(pattern) {\n        this.pattern = pattern;\n        if (!pattern && this.renderer) this.renderer.clear();\n    }\n    #updateOnSizeChange(size) {\n        if (size[0] && size[1]) this.pattern?.draw(this.renderer, {\n            sizeChanged: true,\n            precision: 1\n        });\n    }\n    /**\n   * Sets up click and touch events for the viewer\n   */ #setTapEvents() {\n        let timeout;\n        this.element.addEventListener('pointerdown', ()=>{\n            this.emit('click', null);\n            const cancelTouch = ()=>{\n                clearTimeout(timeout);\n                this.element.removeEventListener('pointerup', cancelTouch);\n            };\n            timeout = setTimeout(()=>{\n                this.element.removeEventListener('pointerup', cancelTouch);\n                this.emit('touchStart', null);\n                const end = ()=>{\n                    this.emit('touchEnd', null);\n                    this.element.removeEventListener('pointerup', end);\n                };\n                this.element.addEventListener('pointerup', end);\n            }, 200);\n            this.element.addEventListener('pointerup', cancelTouch);\n        });\n    }\n    update(options) {\n        (0, $5082caf0e2beae35$export$2e2bcd8739ae039).showInstructions = false;\n        this.#withRenderer();\n        this.pattern?.draw(this.renderer, {\n            ...options,\n            precision: 1\n        });\n    }\n    goto(position) {\n        this.#withRenderer();\n        this.pattern.goto(this.renderer, position, {\n            showInstructions: (0, $5082caf0e2beae35$export$2e2bcd8739ae039).showInstructions\n        });\n    }\n    next() {\n        return {\n            done: this.pattern.drawNext().done\n        };\n    }\n    getStepCount() {\n        this.#withRenderer();\n        return this.pattern.getStepCount({\n            size: this.renderer.getSize()\n        });\n    }\n    #withRenderer() {\n        if (!this.renderer) {\n            const RendererType = this.rendererType === 'svg' ? (0, $0649237e9259f2a7$export$2e2bcd8739ae039) : (0, $2f2e0bbe9a3a6970$export$2e2bcd8739ae039);\n            this.setRenderer(new RendererType(this.element));\n        }\n    }\n}\n\n\n\n\n\n\n\nconst $fc3e3d346052d3b6$var$DEFAULT_TARGET_SIZE_CM = [\n    30,\n    30\n];\nconst $fc3e3d346052d3b6$var$DEFAULT_SIZES_CM = [\n    20,\n    30,\n    40,\n    50,\n    60,\n    70,\n    80,\n    90,\n    100\n];\nlet $fc3e3d346052d3b6$var$controller;\nclass $fc3e3d346052d3b6$var$Info {\n    elements;\n    targetSizeCm = $fc3e3d346052d3b6$var$DEFAULT_TARGET_SIZE_CM;\n    pattern;\n    lastSize;\n    patternMargin;\n    patternNailRadius;\n    constructor(){\n        this.elements = {\n            infoPanel: document.querySelector('#info_panel'),\n            nailsCount: document.querySelector('#nails_count'),\n            threadsTotalLength: document.querySelector('#threads_total_length'),\n            threadsPerColor: document.querySelector('#threads_per_color'),\n            closestDistanceBetweenNails: document.querySelector('#closest_distance_between_nails'),\n            dimensions: document.querySelector('#info_dimensions'),\n            dimensionsSelect: document.querySelector('#info_dimensions_select')\n        };\n        this.elements.dimensions.addEventListener('dimensionchange', ({ detail: { value: dimensions } })=>{\n            this.targetSizeCm = dimensions;\n            if (this.pattern) this.update();\n        });\n        this.elements.dimensionsSelect.addEventListener('change', (e)=>{\n            const value = Number(this.elements.dimensionsSelect.value);\n            this.targetSizeCm = [\n                value,\n                value\n            ];\n            this.update();\n        });\n    }\n    #setAvailableDimensions() {\n        const aspectRatio = this.pattern.getAspectRatio({\n            size: [\n                100,\n                100\n            ]\n        });\n        const sizes = $fc3e3d346052d3b6$var$DEFAULT_SIZES_CM.map((v)=>aspectRatio >= 1 ? [\n                v,\n                Math.round(v / aspectRatio)\n            ] : [\n                Math.round(v * aspectRatio),\n                v\n            ]);\n        this.elements.dimensionsSelect.innerHTML = sizes.map((size, i)=>`<option value=\"${$fc3e3d346052d3b6$var$DEFAULT_SIZES_CM[i]}\">${size.join('x')} cm`).join('\\n');\n        this.elements.dimensionsSelect.value = this.targetSizeCm[0].toString();\n    }\n    setPattern(pattern, size) {\n        this.pattern = pattern.copy();\n        this.lastSize = size;\n        this.patternMargin = pattern.config.margin;\n        this.patternNailRadius = pattern.config.nailRadius;\n        this.update();\n        this.#setAvailableDimensions();\n    }\n    async update() {\n        if (!this.pattern) throw new Error(\"Can't update info - no pattern.\");\n        $fc3e3d346052d3b6$var$controller?.abort();\n        const fittedSize = (0, $b683a3137b30eaa9$export$18c295d7a6a8189d)(this.lastSize, this.targetSizeCm);\n        const sizeRatio = Math.min(fittedSize[0] / this.lastSize[0], fittedSize[1] / this.lastSize[1]);\n        this.pattern.assignConfig({\n            margin: this.patternMargin * sizeRatio,\n            nailRadius: this.patternNailRadius * sizeRatio\n        });\n        this.elements.dimensions.value = this.targetSizeCm;\n        $fc3e3d346052d3b6$var$controller = new TaskController({\n            priority: 'background'\n        });\n        const { nailsCount: nailsCount, threadsLength: threadsLength, closestDistanceBetweenNails: closestDistanceBetweenNails } = await scheduler.postTask(()=>this.getInfo(this.targetSizeCm), {\n            signal: $fc3e3d346052d3b6$var$controller.signal\n        });\n        this.elements.nailsCount.textContent = nailsCount.toLocaleString();\n        this.elements.threadsTotalLength.textContent = String(this.#threadLengthToDistance(threadsLength.total));\n        this.elements.closestDistanceBetweenNails.textContent = String(this.#threadLengthToDistance(closestDistanceBetweenNails));\n        this.elements.threadsPerColor.innerHTML = '';\n        const maxColorLength = Math.max(...threadsLength.perColor.map(({ length: length })=>length));\n        [\n            ...threadsLength.perColor\n        ].sort((a, b)=>b.length - a.length).forEach(({ color: color, length: length })=>{\n            const colorEl = document.createElement('li');\n            const colorValueEl = document.createElement('div');\n            colorEl.appendChild(colorValueEl);\n            colorValueEl.style.background = color;\n            colorValueEl.className = 'info__thread_color_value';\n            colorValueEl.style.width = `max(calc(${100 * length / maxColorLength}% - 70px), 6px)`;\n            const colorValueDisplay = document.createElement('span');\n            colorValueDisplay.innerText = this.#threadLengthToDistance(length);\n            colorValueDisplay.className = 'info__thread_color_value_text';\n            colorEl.appendChild(colorValueDisplay);\n            this.elements.threadsPerColor.appendChild(colorEl);\n        });\n    }\n    /**\n   *\n   * @param length Converts a pixel length unit to physical distance units\n   */ #threadLengthToDistance(length, ratio = 1) {\n        return (0, $b683a3137b30eaa9$export$deca72617c96d902)(length * ratio, 'cm');\n    }\n    getInfo(size) {\n        const renderer = new (0, $fa5e071b86283164$export$f14c78f74247c3d)(size);\n        this.pattern.draw(renderer, {\n            sizeChanged: true,\n            redrawStrings: true,\n            redrawNails: true\n        });\n        return renderer.getInfo();\n    }\n}\nconst $fc3e3d346052d3b6$var$info = new $fc3e3d346052d3b6$var$Info();\nvar $fc3e3d346052d3b6$export$2e2bcd8739ae039 = $fc3e3d346052d3b6$var$info;\n\n\n!function() {\n    var t = [\n        \"user-blocking\",\n        \"user-visible\",\n        \"background\"\n    ];\n    class i {\n        constructor(){\n            this.t = new MessageChannel, this.i = this.t.port2, this.l = {}, this.o = 1, this.t.port1.onmessage = (t)=>this.h(t);\n        }\n        u(t) {\n            var i = this.o++;\n            return this.l[i] = t, this.i.postMessage(i), i;\n        }\n        p(t) {\n            delete this.l[t];\n        }\n        h(t) {\n            var i = t.data;\n            if (i in this.l) {\n                var r = this.l[i];\n                delete this.l[i], r();\n            }\n        }\n    }\n    function r() {\n        return r.v || (r.v = new i), r.v;\n    }\n    class s {\n        constructor(t, i, r){\n            void 0 === r && (r = 0), this.k = t, this.T = null, this.C = null, this.m = !1, this._(i, r);\n        }\n        isIdleCallback() {\n            return 0 === this.T;\n        }\n        I() {\n            return 2 === this.T;\n        }\n        cancel() {\n            if (!this.m) switch(this.m = !0, this.T){\n                case 0:\n                    cancelIdleCallback(this.C);\n                    break;\n                case 1:\n                    clearTimeout(this.C);\n                    break;\n                case 2:\n                    r().p(this.C);\n                    break;\n                default:\n                    throw new TypeError(\"Unknown CallbackType\");\n            }\n        }\n        _(i, s) {\n            if (s && s > 0) return this.T = 1, void (this.C = setTimeout(()=>{\n                this.P();\n            }, s));\n            if (!t.includes(i)) throw new TypeError(\"Invalid task priority : \" + i);\n            return \"background\" === i && \"function\" == typeof requestIdleCallback ? (this.T = 0, void (this.C = requestIdleCallback(()=>{\n                this.P();\n            }))) : \"function\" == typeof MessageChannel ? (this.T = 2, void (this.C = r().u(()=>{\n                this.P();\n            }))) : (this.T = 1, void (this.C = setTimeout(()=>{\n                this.P();\n            })));\n        }\n        P() {\n            this.m || this.k();\n        }\n    }\n    var e = 0;\n    class n {\n        constructor(){\n            this.j = null, this.M = null;\n        }\n        isEmpty() {\n            return null == this.j;\n        }\n        push(t) {\n            if (\"object\" != typeof t) throw new TypeError(\"Task must be an Object\");\n            t.A = e++, this.isEmpty() ? (t.N = null, this.j = t) : (t.N = this.M, this.M.O = t), t.O = null, this.M = t;\n        }\n        takeNextTask() {\n            if (this.isEmpty()) return null;\n            var t = this.j;\n            return this.q(t), t;\n        }\n        merge(t, i) {\n            if (\"function\" != typeof i) throw new TypeError(\"Must provide a selector function.\");\n            if (null == t) throw new Error(\"sourceQueue cannot be null\");\n            for(var r = this.j, s = null, e = t.j; e;){\n                var n = e;\n                if (e = e.O, i(n)) {\n                    for(t.q(n); r && r.A < n.A;)s = r, r = r.O;\n                    this.D(n, s), s = n;\n                }\n            }\n        }\n        D(t, i) {\n            if (i != this.M) {\n                var r = i ? i.O : this.j;\n                t.O = r, r.N = t, t.N = i, null != i ? i.O = t : this.j = t;\n            } else this.push(t);\n        }\n        q(t) {\n            if (null == t) throw new Error(\"Expected task to be non-null\");\n            t === this.j && (this.j = t.O), t === this.M && (this.M = this.M.N), t.O && (t.O.N = t.N), t.N && (t.N.O = t.O);\n        }\n    }\n    class l extends Event {\n        constructor(i, r){\n            if (!r || !t.includes(r.previousPriority)) throw new TypeError(\"Invalid task priority: '\" + r.previousPriority + \"'\");\n            super(i), this.previousPriority = r.previousPriority;\n        }\n    }\n    class o extends AbortController {\n        constructor(i){\n            if (void 0 === i && (i = {}), super(), null == i && (i = {}), \"object\" != typeof i) throw new TypeError(\"'init' is not an object\");\n            var r, s, e = void 0 === i.priority ? \"user-visible\" : i.priority;\n            if (!t.includes(e)) throw new TypeError(\"Invalid task priority: '\" + e + \"'\");\n            this.H = e, this.R = !1, s = (r = this).signal, Object.defineProperties(s, {\n                priority: {\n                    get: function() {\n                        return r.H;\n                    },\n                    enumerable: !0\n                },\n                onprioritychange: {\n                    value: null,\n                    writable: !0,\n                    enumerable: !0\n                }\n            }), s.addEventListener(\"prioritychange\", (t)=>{\n                s.onprioritychange && s.onprioritychange(t);\n            });\n        }\n        setPriority(i) {\n            if (!t.includes(i)) throw new TypeError(\"Invalid task priority: \" + i);\n            if (this.R) throw new DOMException(\"\", \"NotAllowedError\");\n            if (this.signal.priority !== i) {\n                this.R = !0;\n                var r = this.H;\n                this.H = i;\n                var s = new l(\"prioritychange\", {\n                    previousPriority: r\n                });\n                this.signal.dispatchEvent(s), this.R = !1;\n            }\n        }\n    }\n    void 0 === self.scheduler ? (self.scheduler = new class {\n        constructor(){\n            this.S = {}, t.forEach((t)=>{\n                this.S[t] = [\n                    new n,\n                    new n\n                ];\n            }), this.U = null, this.W = new WeakMap;\n        }\n        yield() {\n            return this.B(()=>{}, {\n                priority: \"user-visible\"\n            }, !0);\n        }\n        postTask(t, i) {\n            return this.B(t, i, !1);\n        }\n        B(i, r, s) {\n            if (void 0 !== (r = Object.assign({}, r)).signal) {\n                if (null === r.signal || !(\"aborted\" in r.signal) || \"function\" != typeof r.signal.addEventListener) return Promise.reject(new TypeError(\"'signal' is not a valid 'AbortSignal'\"));\n                if (r.signal && r.signal.priority && !t.includes(r.signal.priority)) return Promise.reject(new TypeError(\"Invalid task priority: '\" + r.signal.priority + \"'\"));\n            }\n            if (void 0 !== r.priority && (null === r.priority || !t.includes(r.priority))) return Promise.reject(new TypeError(\"Invalid task priority: '\" + r.priority + \"'\"));\n            if (void 0 === r.delay && (r.delay = 0), r.delay = Number(r.delay), r.delay < 0) return Promise.reject(new TypeError(\"'delay' must be a positive number.\"));\n            var e = {\n                callback: i,\n                options: r,\n                resolve: null,\n                reject: null,\n                hostCallback: null,\n                abortCallback: null,\n                onTaskCompleted: function() {\n                    this.options.signal && this.abortCallback && (this.options.signal.removeEventListener(\"abort\", this.abortCallback), this.abortCallback = null);\n                },\n                onTaskAborted: function() {\n                    this.hostCallback && (this.hostCallback.cancel(), this.hostCallback = null), this.options.signal.removeEventListener(\"abort\", this.abortCallback), this.abortCallback = null, this.reject(this.options.signal.reason);\n                },\n                isAborted: function() {\n                    return this.options.signal && this.options.signal.aborted;\n                },\n                isContinuation: s\n            }, n = new Promise((t, i)=>{\n                e.resolve = t, e.reject = i;\n            });\n            return this._(e), n;\n        }\n        _(t) {\n            var i = t.options.signal;\n            if (i) {\n                if (i.aborted) return void t.reject(i.reason);\n                t.abortCallback = ()=>{\n                    t.onTaskAborted();\n                }, i.addEventListener(\"abort\", t.abortCallback);\n            }\n            t.options.delay > 0 ? t.hostCallback = new s(()=>{\n                t.hostCallback = null, this.F(t);\n            }, null, t.options.delay) : (this.G(t), this.J());\n        }\n        F(t) {\n            this.G(t), this.U && (this.U.cancel(), this.U = null), this.K();\n        }\n        L(t) {\n            var i = this.W.get(t);\n            if (void 0 === i) throw new Error(\"Attempting to change priority on an unregistered signal\");\n            if (i !== t.priority) {\n                for(var r = 0; r < 2; r++)this.S[t.priority][r].merge(this.S[i][r], (i)=>i.options.signal === t);\n                this.W.set(t, t.priority);\n            }\n        }\n        K() {\n            this.U = null, this.V(), this.J();\n        }\n        J() {\n            var { priority: t } = this.X();\n            null != t && (\"background\" !== t && this.U && this.U.isIdleCallback() && (this.U.cancel(), this.U = null), this.U || (this.U = new s(()=>{\n                this.K();\n            }, t, 0)));\n        }\n        G(i) {\n            var r;\n            if (!t.includes(r = i.options.priority ? i.options.priority : i.options.signal && i.options.signal.priority ? i.options.signal.priority : \"user-visible\")) throw new TypeError(\"Invalid task priority: \" + r);\n            if (i.options.signal && i.options.signal.priority) {\n                var s = i.options.signal;\n                this.W.has(s) || (s.addEventListener(\"prioritychange\", ()=>{\n                    this.L(s);\n                }), this.W.set(s, s.priority));\n            }\n            this.S[r][i.isContinuation ? 0 : 1].push(i);\n        }\n        V() {\n            var t = null;\n            do {\n                var { priority: i, type: r } = this.X();\n                if (null == i) return;\n                t = this.S[i][r].takeNextTask();\n            }while (t.isAborted());\n            try {\n                var s = t.callback();\n                t.resolve(s);\n            } catch (i) {\n                t.reject(i);\n            } finally{\n                t.onTaskCompleted();\n            }\n        }\n        X() {\n            for(var i = 0; i < t.length; i++)for(var r = t[i], s = 0; s < 2; s++)if (!this.S[r][s].isEmpty()) return {\n                priority: r,\n                type: s\n            };\n            return {\n                priority: null,\n                type: 0\n            };\n        }\n    }, self.TaskController = o, self.TaskPriorityChangeEvent = l) : self.scheduler.yield || (self.scheduler.yield = function() {\n        return self.scheduler.postTask(()=>{}, {\n            priority: \"user-blocking\"\n        });\n    });\n}();\n\n\nwindow.addEventListener('error', function(event) {\n    alert('Error:\\n' + event.message + '\\n\\nStack:\\n' + event.error.stack);\n});\nwindow.addEventListener('load', $1ccc8d3c866b7484$var$main);\nasync function $1ccc8d3c866b7484$var$main() {\n    const elements = {\n        main: document.querySelector('main'),\n        downloadBtn: document.querySelector('#download_btn'),\n        resetBtn: document.querySelector('#controls_reset_btn'),\n        shareBtn: document.querySelector('#share_btn'),\n        playerBtn: document.querySelector('#player_btn'),\n        infoBtn: document.querySelector('#info_btn'),\n        buttons: document.querySelector('#buttons'),\n        instructionsLink: document.querySelector('#pattern_select_dropdown_instructions')\n    };\n    const persistance = new (0, $00643d12b3a54506$export$2e2bcd8739ae039)();\n    const thumbnails = new (0, $8a4d6517fbd25a59$export$45b50bca1da1e9b3)(persistance);\n    let controls;\n    let currentPattern;\n    let showInfo = false;\n    const viewer = new (0, $1e47030bd2e0e155$export$2e2bcd8739ae039)();\n    const player = new (0, $f003126099aabc1e$export$2e2bcd8739ae039)(document.querySelector('#player'), viewer);\n    await (0, $718de5d870731526$export$d594efb518b3cec4)();\n    document.body.querySelectorAll('.pattern_only').forEach((0, $8d5cef8e7fea78a8$export$fe8985bb6374093c));\n    const showShare = await (0, $38bb4a85553a6bfc$export$4fa6f570da04f7cc)();\n    if (showShare) (0, $8d5cef8e7fea78a8$export$f823a0c1cf7adf68)(elements.shareBtn);\n    elements.downloadBtn.addEventListener('click', ()=>{\n        const downloadDialog = document.querySelector('#download_dialog');\n        downloadDialog.show(viewer.pattern);\n    });\n    elements.resetBtn.addEventListener('click', reset);\n    elements.shareBtn.addEventListener('click', async ()=>await (0, $38bb4a85553a6bfc$export$ed80d9de1d9df928)({\n            renderer: viewer.renderer,\n            pattern: viewer.pattern\n        }));\n    elements.instructionsLink.addEventListener('click', (e)=>{\n        e.preventDefault();\n        (0, $a244379bf8b3b658$export$2e2bcd8739ae039).navigateToMain();\n    });\n    thumbnails.addEventListener('select', ({ patternId: patternId })=>{\n        const pattern = (0, $92270d8b7d92e411$export$ebb1a6b9e8c15cc2)(patternId);\n        (0, $a244379bf8b3b658$export$2e2bcd8739ae039).navigateToPattern(pattern);\n    });\n    document.body.addEventListener('click', (e)=>{\n        const toggleBtn = e.target instanceof HTMLElement && e.target.closest('[data-toggle-for]');\n        if (toggleBtn instanceof HTMLElement && toggleBtn) {\n            const dialogId = toggleBtn.dataset.toggleFor;\n            deactivateTabs([\n                dialogId\n            ]);\n            toggleBtn.classList.toggle('active');\n            const toggledElement = document.querySelector('#' + dialogId);\n            if (toggledElement) {\n                toggledElement.classList.toggle('open');\n                document.body.classList.toggle('dialog_' + dialogId);\n                currentPattern && viewer.update();\n            }\n            if (dialogId === 'info') {\n                showInfo = toggleBtn.classList.contains('active');\n                if (showInfo) (0, $fc3e3d346052d3b6$export$2e2bcd8739ae039).setPattern(currentPattern, viewer.size);\n            }\n        }\n    });\n    persistance.addEventListener('deletePattern', ({ pattern: pattern })=>{\n        const templatePattern = (0, $92270d8b7d92e411$export$ebb1a6b9e8c15cc2)(pattern.type);\n        if (templatePattern) {\n            templatePattern.config = pattern.config;\n            (0, $a244379bf8b3b658$export$2e2bcd8739ae039).navigateToPattern(templatePattern);\n        }\n    });\n    persistance.addEventListener('save', ({ pattern: pattern })=>{\n        (0, $a244379bf8b3b658$export$2e2bcd8739ae039).navigateToPattern(pattern);\n    });\n    (0, $8d5cef8e7fea78a8$export$f823a0c1cf7adf68)(document.querySelector('main'));\n    initRouting();\n    function initRouting() {\n        (0, $a244379bf8b3b658$export$2e2bcd8739ae039).addEventListener('pattern', ({ pattern: pattern, renderer: renderer })=>{\n            selectPattern(pattern);\n            viewer.setPattern(pattern);\n            thumbnails.close();\n        });\n        (0, $a244379bf8b3b658$export$2e2bcd8739ae039).addEventListener('main', ()=>{\n            thumbnails.open();\n            unselectPattern();\n        });\n        (0, $a244379bf8b3b658$export$2e2bcd8739ae039).init();\n    }\n    function deactivateTabs(exclude) {\n        document.querySelectorAll('#buttons [data-toggle-for].active').forEach((btn)=>{\n            if (btn instanceof HTMLElement && !exclude?.includes(btn.getAttribute('data-toggle-for'))) btn.click();\n        });\n    }\n    function reset() {\n        (0, $174f2c93f6348ee5$export$715f9d76bb8c1fea)({\n            title: 'Reset options',\n            description: currentPattern.isTemplate ? 'Are you sure you wish to reset options to defaults?' : 'Are you sure you wish to reset to the latest saved options?',\n            submit: 'Reset'\n        }).then(()=>{\n            const pattern = (0, $92270d8b7d92e411$export$ebb1a6b9e8c15cc2)(currentPattern.id);\n            (0, $a244379bf8b3b658$export$2e2bcd8739ae039).navigateToPattern(pattern);\n        }, ()=>{});\n    }\n    function onInputsChange({ control: control }) {\n        if (control.affectsStepCount !== false) player.update(viewer.getStepCount());\n        (0, $a244379bf8b3b658$export$2e2bcd8739ae039).navigateToPattern(currentPattern, {\n            renderer: viewer.renderer instanceof (0, $0649237e9259f2a7$export$2e2bcd8739ae039) ? 'svg' : undefined,\n            replaceState: true\n        });\n        setIsDefaultConfig();\n        if (showInfo) (0, $fc3e3d346052d3b6$export$2e2bcd8739ae039).setPattern(currentPattern, viewer.size);\n    }\n    function setIsDefaultConfig() {\n        elements.main.dataset.isDefaultConfig = String(currentPattern.isDefaultConfig);\n    }\n    function selectPattern(pattern) {\n        currentPattern = pattern;\n        viewer.setPattern(pattern);\n        controls?.destroy();\n        persistance.setPattern(currentPattern);\n        controls = new (0, $da037f8140467741$export$2e2bcd8739ae039)(pattern.configControls, pattern.config);\n        controls.addEventListener('input', ({ control: control, value: value })=>{\n            if (currentPattern) {\n                currentPattern.setConfigValue(control.key, value);\n                controls.config = currentPattern.config;\n                viewer.update({\n                    redrawNails: control.affectsNails !== false,\n                    redrawStrings: control.affectsStrings !== false,\n                    enableScheduler: true\n                });\n            }\n        });\n        controls.addEventListener('change', onInputsChange);\n        thumbnails.setCurrentPattern(pattern);\n        document.title = `${pattern.name} - String Art Studio`;\n        document.body.setAttribute('data-pattern', pattern.id);\n        document.body.querySelectorAll('.pattern_only').forEach((0, $8d5cef8e7fea78a8$export$f823a0c1cf7adf68));\n        viewer.update();\n        player.update(viewer.getStepCount(), {\n            draw: false\n        });\n        if (showInfo) (0, $fc3e3d346052d3b6$export$2e2bcd8739ae039).setPattern(pattern, viewer.size);\n        elements.main.dataset.isTemplate = String(currentPattern.isTemplate);\n        setIsDefaultConfig();\n    }\n    function unselectPattern() {\n        currentPattern = null;\n        viewer.setPattern(null);\n        thumbnails.setCurrentPattern(null);\n        controls && controls.destroy();\n        document.body.querySelectorAll('.pattern_only').forEach((0, $8d5cef8e7fea78a8$export$fe8985bb6374093c));\n        document.body.removeAttribute('data-pattern');\n    }\n}\n\n\n//# sourceMappingURL=string_art.875037c1.js.map\n","import Player from './editor/Player';\nimport EditorControls, {\n  ControlValueChangeEventData,\n} from './editor/EditorControls';\nimport { Thumbnails } from './thumbnails/Thumbnails';\nimport { isShareSupported, share } from './share';\nimport { initServiceWorker } from './pwa';\nimport SVGRenderer from './infra/renderers/SVGRenderer';\nimport './components/components';\nimport Persistance from './Persistance';\nimport StringArt from './infra/StringArt';\nimport { confirm } from './helpers/dialogs';\nimport Viewer from './viewer/Viewer';\nimport type DownloadDialog from './components/dialogs/download_dialog/DownloadDialog';\nimport { findPatternById } from './helpers/pattern_utils';\nimport routing from './routing';\nimport { hide, unHide } from './helpers/dom_utils';\nimport info from './Info';\nimport 'scheduler-polyfill';\n\nwindow.addEventListener('error', function (event) {\n  alert('Error:\\n' + event.message + '\\n\\nStack:\\n' + event.error.stack);\n});\n\nwindow.addEventListener('load', main);\n\nasync function main() {\n  const elements = {\n    main: document.querySelector('main'),\n    downloadBtn: document.querySelector('#download_btn'),\n    resetBtn: document.querySelector('#controls_reset_btn'),\n    shareBtn: document.querySelector('#share_btn'),\n    playerBtn: document.querySelector('#player_btn'),\n    infoBtn: document.querySelector('#info_btn'),\n    buttons: document.querySelector('#buttons'),\n    instructionsLink: document.querySelector(\n      '#pattern_select_dropdown_instructions'\n    ),\n  };\n\n  const persistance = new Persistance();\n  const thumbnails = new Thumbnails(persistance);\n\n  let controls: EditorControls<any>;\n\n  let currentPattern: Pattern;\n  let showInfo = false;\n\n  const viewer = new Viewer();\n  const player = new Player(document.querySelector('#player'), viewer);\n\n  await initServiceWorker();\n\n  document.body.querySelectorAll('.pattern_only').forEach(hide);\n\n  type Pattern = StringArt<any>;\n\n  const showShare = await isShareSupported();\n  if (showShare) {\n    unHide(elements.shareBtn);\n  }\n\n  elements.downloadBtn.addEventListener('click', () => {\n    const downloadDialog = document.querySelector(\n      '#download_dialog'\n    ) as DownloadDialog;\n    downloadDialog!.show(viewer.pattern);\n  });\n\n  elements.resetBtn.addEventListener('click', reset);\n  elements.shareBtn.addEventListener(\n    'click',\n    async () =>\n      await share({\n        renderer: viewer.renderer,\n        pattern: viewer.pattern,\n      })\n  );\n\n  elements.instructionsLink.addEventListener('click', e => {\n    e.preventDefault();\n    routing.navigateToMain();\n  });\n\n  thumbnails.addEventListener('select', ({ patternId }) => {\n    const pattern = findPatternById(patternId);\n    routing.navigateToPattern(pattern);\n  });\n\n  document.body.addEventListener('click', e => {\n    const toggleBtn =\n      e.target instanceof HTMLElement && e.target.closest('[data-toggle-for]');\n    if (toggleBtn instanceof HTMLElement && toggleBtn) {\n      const dialogId = toggleBtn.dataset.toggleFor;\n\n      deactivateTabs([dialogId]);\n      toggleBtn.classList.toggle('active');\n\n      const toggledElement = document.querySelector('#' + dialogId);\n      if (toggledElement) {\n        toggledElement.classList.toggle('open');\n        document.body.classList.toggle('dialog_' + dialogId);\n        currentPattern && viewer.update();\n      }\n\n      if (dialogId === 'info') {\n        showInfo = toggleBtn.classList.contains('active');\n        if (showInfo) {\n          info.setPattern(currentPattern, viewer.size);\n        }\n      }\n    }\n  });\n\n  persistance.addEventListener('deletePattern', ({ pattern }) => {\n    const templatePattern = findPatternById(pattern.type);\n    if (templatePattern) {\n      templatePattern.config = pattern.config;\n      routing.navigateToPattern(templatePattern);\n    }\n  });\n\n  persistance.addEventListener('save', ({ pattern }) => {\n    routing.navigateToPattern(pattern);\n  });\n\n  unHide(document.querySelector('main'));\n  initRouting();\n\n  function initRouting() {\n    routing.addEventListener('pattern', ({ pattern, renderer }) => {\n      selectPattern(pattern);\n      viewer.setPattern(pattern);\n      thumbnails.close();\n    });\n\n    routing.addEventListener('main', () => {\n      thumbnails.open();\n      unselectPattern();\n    });\n\n    routing.init();\n  }\n\n  function deactivateTabs(exclude?: string[]) {\n    document\n      .querySelectorAll('#buttons [data-toggle-for].active')\n      .forEach(btn => {\n        if (\n          btn instanceof HTMLElement &&\n          !exclude?.includes(btn.getAttribute('data-toggle-for'))\n        ) {\n          btn.click();\n        }\n      });\n  }\n\n  function reset() {\n    confirm({\n      title: 'Reset options',\n      description: currentPattern.isTemplate\n        ? 'Are you sure you wish to reset options to defaults?'\n        : 'Are you sure you wish to reset to the latest saved options?',\n      submit: 'Reset',\n    }).then(\n      () => {\n        const pattern = findPatternById(currentPattern.id);\n        routing.navigateToPattern(pattern);\n      },\n      () => {}\n    );\n  }\n\n  function onInputsChange({ control }: ControlValueChangeEventData<any, any>) {\n    if (control.affectsStepCount !== false) {\n      player.update(viewer.getStepCount());\n    }\n    routing.navigateToPattern(currentPattern, {\n      renderer: viewer.renderer instanceof SVGRenderer ? 'svg' : undefined,\n      replaceState: true,\n    });\n\n    setIsDefaultConfig();\n    if (showInfo) {\n      info.setPattern(currentPattern, viewer.size);\n    }\n  }\n\n  function setIsDefaultConfig() {\n    elements.main.dataset.isDefaultConfig = String(\n      currentPattern.isDefaultConfig\n    );\n  }\n\n  function selectPattern(pattern: Pattern) {\n    currentPattern = pattern;\n\n    viewer.setPattern(pattern);\n    controls?.destroy();\n\n    persistance.setPattern(currentPattern);\n    controls = new EditorControls<any>(pattern.configControls, pattern.config);\n    controls.addEventListener('input', ({ control, value }) => {\n      if (currentPattern) {\n        currentPattern.setConfigValue(control.key, value);\n        controls.config = currentPattern.config;\n        viewer.update({\n          redrawNails: control.affectsNails !== false,\n          redrawStrings: control.affectsStrings !== false,\n          enableScheduler: true,\n        });\n      }\n    });\n    controls.addEventListener('change', onInputsChange);\n\n    thumbnails.setCurrentPattern(pattern);\n    document.title = `${pattern.name} - String Art Studio`;\n    document.body.setAttribute('data-pattern', pattern.id);\n\n    document.body.querySelectorAll('.pattern_only').forEach(unHide);\n    viewer.update();\n\n    player.update(viewer.getStepCount(), { draw: false });\n    if (showInfo) {\n      info.setPattern(pattern, viewer.size);\n    }\n\n    elements.main.dataset.isTemplate = String(currentPattern.isTemplate);\n    setIsDefaultConfig();\n  }\n\n  function unselectPattern() {\n    currentPattern = null;\n    viewer.setPattern(null);\n    thumbnails.setCurrentPattern(null);\n    controls && controls.destroy();\n    document.body.querySelectorAll('.pattern_only').forEach(hide);\n    document.body.removeAttribute('data-pattern');\n  }\n}\n","import Viewer from '../viewer/Viewer';\nimport viewOptions from '../viewer/ViewOptions';\n\nconst SLOW_PLAY_SPEED = 200;\n\n/**\n * Represents the navigation that controls the StringArt when playing\n */\nexport default class Player {\n  viewer: Viewer;\n  elements: {\n    player: HTMLElement;\n    step: HTMLSpanElement;\n    playerPosition: HTMLInputElement;\n    playBtn: HTMLButtonElement;\n    pauseBtn: HTMLButtonElement;\n    text: HTMLDivElement;\n  };\n  stepCount: number;\n  #isPlaying: boolean;\n  #cancelNextPlayStep: Function;\n  #cancelHideInstruction: Function;\n\n  constructor(parentEl: HTMLElement, viewer: Viewer) {\n    this.viewer = viewer;\n    this.elements = {\n      player: parentEl,\n      step: parentEl.querySelector('#step'),\n      //stepInstructions: parentEl.querySelector('#step_instructions'),\n      playerPosition: parentEl.querySelector(\n        '#player_position'\n      ) as HTMLInputElement,\n      playBtn: parentEl.querySelector('#play_btn'),\n      pauseBtn: parentEl.querySelector('#pause_btn'),\n      text: parentEl.querySelector('#player_text'),\n    };\n    this.stepCount = 0;\n    this.#isPlaying = false;\n\n    this.elements.playerPosition.addEventListener('input', ({ target }) => {\n      if ('value' in target) {\n        this.goto(+target.value);\n      }\n    });\n\n    this.elements.playBtn.addEventListener('click', () => {\n      this.play({ restartIfAtEnd: true });\n    });\n\n    this.elements.pauseBtn.addEventListener('click', () => {\n      this.pause();\n    });\n\n    viewer.addEventListener('positionChange', ({ changeBy }) =>\n      this.advance(changeBy)\n    );\n\n    viewer.addEventListener('click', () =>\n      this.#isPlaying ? this.pause() : this.advance()\n    );\n    viewer.addEventListener('touchStart', () =>\n      this.play({ speed: SLOW_PLAY_SPEED })\n    );\n    viewer.addEventListener('touchEnd', () => this.pause());\n\n    viewOptions.addEventListener(\n      'showInstructionsChange',\n      ({ showInstructions }) => {\n        if (showInstructions) {\n          this.#cancelHideInstruction?.();\n        }\n      }\n    );\n  }\n\n  updateStatus(isPlaying: boolean) {\n    if (this.#isPlaying !== isPlaying) {\n      this.elements.player.classList.toggle('playing');\n      this.#isPlaying = isPlaying;\n    }\n  }\n\n  update(stepCount: number, { draw = true } = {}) {\n    this.stepCount = stepCount;\n    this.elements.playerPosition.setAttribute('max', String(this.stepCount));\n    this.elements.step.innerText = `${this.stepCount}/${this.stepCount}`;\n    this.elements.text.style.removeProperty('width');\n    this.elements.text.style.width =\n      (this.elements.text.clientWidth || 70) + 'px';\n    viewOptions.showInstructions = false;\n    this.goto(this.stepCount, {\n      updateStringArt: draw,\n      showInstructions: false,\n    });\n  }\n\n  updatePosition(position: number) {\n    this.elements.step.innerText = `${position}/${this.stepCount}`;\n    this.elements.playerPosition.value = String(position);\n  }\n\n  goto(\n    position: number,\n    { updateStringArt = true, showInstructions = true } = {}\n  ) {\n    if (position > this.stepCount || position < 1) {\n      return;\n    }\n\n    this.#cancelHideInstruction?.();\n    this.pause();\n    this.updatePosition(position);\n    if (showInstructions) {\n      viewOptions.showInstructions = true;\n    }\n    if (updateStringArt) {\n      this.viewer.goto(position);\n    }\n\n    if (\n      viewOptions.instructionsMode === 'auto' &&\n      position === this.stepCount &&\n      viewOptions.showInstructions\n    ) {\n      const hideIntructionsTimeout = setTimeout(() => {\n        viewOptions.showInstructions = false;\n      }, 1000);\n      this.#cancelHideInstruction = () => clearTimeout(hideIntructionsTimeout);\n    }\n  }\n\n  advance(value = 1) {\n    this.goto(\n      Math.max(\n        1,\n        Math.min(\n          this.stepCount,\n          Number(this.elements.playerPosition.value) + value\n        )\n      )\n    );\n  }\n\n  setInstructions(instructions) {\n    // this.elements.stepInstructions.innerText = instructions;\n  }\n\n  play({\n    restartIfAtEnd = false,\n    speed,\n  }: {\n    restartIfAtEnd?: boolean;\n    /**\n     * speed is the time between steps when playing, in milliseconds. If not specified, steps are as fast as possible, using `requestAnimationFrame`.\n     */\n    speed?: number;\n  } = {}) {\n    const isAtEnd = this.viewer.position === this.stepCount;\n\n    if (isAtEnd && !restartIfAtEnd) {\n      return;\n    }\n\n    this.updateStatus(true);\n    this.#cancelNextPlayStep?.();\n\n    viewOptions.showInstructions = false;\n    // if (\n    //   viewOptions.instructionsMode === 'auto' ||\n    //   viewOptions.instructionsMode === 'show'\n    // ) {\n    //   viewOptions.showInstructions = true;\n    // }\n\n    if (isAtEnd) {\n      this.viewer.goto(0);\n    }\n\n    const step = () => {\n      if (!this.viewer.next().done) {\n        if (speed) {\n          const stepTimeout = setTimeout(step, speed);\n          this.#cancelNextPlayStep = () => clearTimeout(stepTimeout);\n        } else {\n          const stepRafId = requestAnimationFrame(step);\n          this.#cancelNextPlayStep = () => cancelAnimationFrame(stepRafId);\n        }\n      } else {\n        this.updateStatus(false);\n      }\n      this.updatePosition(this.viewer.position);\n    };\n    step();\n  }\n\n  pause() {\n    this.#cancelNextPlayStep?.();\n    this.updateStatus(false);\n  }\n\n  toggle() {\n    if (this.#isPlaying) {\n      this.pause();\n    } else {\n      this.play();\n    }\n  }\n}\n","import EventBus from '../helpers/EventBus';\n\nexport type InstructionsViewMode = 'auto' | 'show' | 'hide';\n\nclass ViewOptions extends EventBus<{\n  instructionsModeChange: InstructionsViewMode;\n  showInstructionsChange: { showInstructions: boolean };\n}> {\n  #showInstructions = false;\n  #instructionsMode: InstructionsViewMode = 'auto';\n\n  get instructionsMode(): InstructionsViewMode {\n    return this.#instructionsMode;\n  }\n\n  set instructionsMode(mode: InstructionsViewMode) {\n    if (mode !== this.#instructionsMode) {\n      this.#instructionsMode = mode;\n      this.emit('instructionsModeChange', mode);\n    }\n  }\n\n  get showInstructions(): boolean {\n    return this.#showInstructions;\n  }\n\n  set showInstructions(showInstructions: boolean) {\n    if (showInstructions !== this.#showInstructions) {\n      this.#showInstructions = showInstructions;\n      this.emit('showInstructionsChange', { showInstructions });\n    }\n  }\n}\n\nconst viewOptions = new ViewOptions();\nexport default viewOptions;\n","export default class EventBus<TEvents extends Record<string, any>> {\n  #eventHandlers: {\n    [K in keyof TEvents]: Array<(payload: TEvents[K]) => void>;\n  } = {} as any;\n\n  /**\n   * Adds an event handler for the specified event\n   * @param event\n   * @param handler\n   * @returns A function that can be called to remove the event handler\n   */\n  addEventListener<K extends keyof TEvents>(\n    event: K,\n    handler: (payload: TEvents[K]) => void\n  ): Function {\n    const handlers = (this.#eventHandlers[event] ??= []);\n    if (!handlers.includes(handler)) {\n      handlers.push(handler);\n    }\n\n    return () => {\n      const handlerIndex = handlers.indexOf(handler);\n      if (handlerIndex !== -1) {\n        handlers.splice(handlerIndex, 1);\n      }\n    };\n  }\n\n  removeEventListener<K extends keyof TEvents>(\n    event: K,\n    handler: (payload: TEvents[K]) => void\n  ) {\n    const handlers = this.#eventHandlers[event];\n    if (!handlers) return;\n\n    const index = handlers.indexOf(handler);\n    if (index !== -1) {\n      handlers.splice(index, 1);\n    }\n  }\n\n  protected emit<K extends keyof TEvents>(event: K, payload: TEvents[K]) {\n    this.#eventHandlers[event]?.forEach(handler => handler(payload));\n  }\n}\n","import { ExpandablePanel } from '../components/expandable_panel/ExpandablePanel';\nimport StringArtCheckbox from '../components/inputs/StringArtCheckbox';\nimport StringArtHueInput from '../components/inputs/StringArtHueInput';\nimport StringArtRangeInput from '../components/inputs/StringArtRangeInput';\nimport { toggleHide, unHide } from '../helpers/dom_utils';\nimport EventBus from '../helpers/EventBus';\nimport type {\n  Config,\n  ConfigValueOrFunction,\n  ControlConfig,\n  ControlsConfig,\n  ControlType,\n  PrimitiveValue,\n} from '../types/config.types';\n\nconst elements = {\n  controls: document.querySelector('#controls') as HTMLElement,\n  controlsPanel: document.querySelector('#controls_panel') as HTMLElement,\n  sidebarForm: document.querySelector('#sidebar_form') as HTMLElement,\n};\n\nconst STATE_LOCAL_STORAGE_KEY = 'controls_state';\nconst RANGE_SCROLL_LOCK_TIMEOUT = 120;\n\nlet inputTimeout: number;\n\ninterface EditorState {\n  groups: {\n    [groupId: string]: boolean;\n  };\n}\n\ntype ControlInputElement = (\n  | HTMLInputElement\n  | StringArtRangeInput\n  | StringArtHueInput\n  | StringArtCheckbox\n  | HTMLSelectElement\n) & {\n  updateTimeout?: number;\n};\n\ninterface Control<TConfig> {\n  config: ControlConfig<TConfig>;\n  input: ControlInputElement;\n  element: HTMLElement;\n  displayValueElement: HTMLSpanElement;\n  label?: HTMLLabelElement;\n}\n\nexport type ControlValueChangeEventData<\n  TConfig extends Config,\n  TControl extends keyof TConfig = keyof TConfig\n> = {\n  control: ControlConfig<TConfig>;\n  value: TConfig[TControl];\n  originalEvent: Event;\n};\n\nexport default class EditorControls<TConfig extends Config> extends EventBus<{\n  input: ControlValueChangeEventData<TConfig>;\n  change: ControlValueChangeEventData<TConfig>;\n}> {\n  config: Config<TConfig>;\n  controlsConfig: ControlsConfig<TConfig>;\n  state: EditorState;\n  controlElements: Partial<Record<keyof TConfig, Control<TConfig>>> = {};\n\n  #postponeRangeInput: boolean = false;\n  #postponeRangeInputTimeout: number;\n  #wrappedOnInput;\n  #wrappedOnTouchStart;\n  #wrappedOnTouchEnd;\n  #wrappedOnRangeScroll;\n  #currentInputRange: StringArtRangeInput | StringArtHueInput;\n  #currentInputRangeValue: number;\n  #rangeLockTimeout: number;\n  #lockRange: boolean = false;\n  #boundToggleFieldset;\n\n  constructor(\n    controlsConfig: ControlsConfig<TConfig>,\n    config: Config<TConfig>\n  ) {\n    super();\n\n    this.config = config;\n    this.controlsConfig = controlsConfig;\n    this.state = this._getState() ?? { groups: {} };\n\n    this.#wrappedOnInput = this.#onInput.bind(this);\n    elements.controls.addEventListener('input', this.#wrappedOnInput);\n    this.#wrappedOnTouchStart = this.#onTouchStart.bind(this);\n    elements.controls.addEventListener(\n      'touchstart',\n      this.#wrappedOnTouchStart,\n      { passive: true }\n    );\n    elements.controls.addEventListener('mousedown', this.#onMouseDown);\n    this.#boundToggleFieldset = this.#toggleFieldset.bind(this);\n    elements.sidebarForm.addEventListener('click', this.#boundToggleFieldset);\n    elements.sidebarForm.addEventListener(\n      'keydown',\n      this.#toggleFieldSetOnEnter\n    );\n    this.controlElements = {};\n    this.renderControls();\n\n    const menu = document.querySelector('#controls_menu');\n    const controlsPanel = document.querySelector('#controls_panel');\n    menu.addEventListener('click', e => {\n      if (e.target instanceof HTMLElement) {\n        const href = e.target\n          .closest('.controls_menu_item')\n          ?.getAttribute('href');\n        e.preventDefault();\n        if (href) {\n          if (href === '#controls_top') {\n            controlsPanel.scrollTo({\n              top: 0,\n              behavior: 'smooth',\n            });\n          } else {\n            const menuTarget = document.querySelector(href);\n            if (menuTarget instanceof ExpandablePanel) {\n              menuTarget.open();\n              menuTarget.scrollIntoView({\n                behavior: 'smooth',\n              });\n            }\n          }\n        }\n      }\n    });\n  }\n\n  destroy() {\n    elements.controls.removeEventListener('input', this.#wrappedOnInput);\n    elements.sidebarForm.removeEventListener(\n      'click',\n      this.#boundToggleFieldset\n    );\n    elements.sidebarForm.removeEventListener(\n      'keydown',\n      this.#toggleFieldSetOnEnter\n    );\n    elements.controls.removeEventListener(\n      'touchstart',\n      this.#wrappedOnTouchStart\n    );\n    elements.controls.removeEventListener('mousedown', this.#onMouseDown);\n    elements.controls.innerHTML = '';\n  }\n\n  #toggleFieldset(this: EditorControls<TConfig>, e) {\n    if (e.target.nodeName === 'LEGEND') {\n      e.target.parentElement.classList.toggle('minimized');\n      const groupId = e.target.parentElement.dataset.group;\n      this.state = {\n        ...this.state,\n        groups: {\n          ...this.state.groups,\n          [groupId]: !e.target.parentElement.classList.contains('minimized'),\n        },\n      };\n      this._updateState(this.state);\n    }\n  }\n\n  #toggleFieldSetOnEnter(e) {\n    if (e.target.nodeName === 'LEGEND' && e.key === 'Enter') {\n      this.#toggleFieldset(e);\n    }\n  }\n\n  #onMouseDown() {\n    // Clearing selection when starting to click in the controls, do avoid a buggy behavior,\n    // when if a control's display value was selected (can happen by mistake), the drag of range input doesn't work.\n    const selection = window.getSelection();\n    if (selection) {\n      selection.removeAllRanges();\n    }\n  }\n\n  /**\n   * Needed for range inputs, to avoid changing the value when the user drags to\n   * scroll and accidentally touches a range input when intending to scroll.\n   * @param {Event} e\n   */\n  #onTouchStart(e: TouchEvent) {\n    if (isRangeInput(e.target)) {\n      this.#postponeRangeInput = true;\n      this.#currentInputRange = e.target;\n      this.#currentInputRangeValue = e.target.value;\n      this.#rangeLockTimeout = window.setTimeout(() => {\n        this.#postponeRangeInput = false;\n      }, RANGE_SCROLL_LOCK_TIMEOUT);\n      this.#wrappedOnTouchEnd = this.#onTouchEnd.bind(this);\n      document.body.addEventListener('touchend', this.#wrappedOnTouchEnd, {\n        passive: true,\n      });\n      this.#wrappedOnRangeScroll = this.#onRangeScroll.bind(this);\n      elements.controlsPanel.addEventListener(\n        'scroll',\n        this.#wrappedOnRangeScroll\n      );\n    }\n  }\n\n  #onTouchEnd(this: EditorControls<TConfig>) {\n    document.body.removeEventListener('touchend', this.#wrappedOnTouchEnd);\n    elements.controlsPanel.removeEventListener(\n      'scroll',\n      this.#wrappedOnRangeScroll\n    );\n\n    if (this.#lockRange) {\n      this.#lockRange = false;\n      if (this.#currentInputRange) {\n        this.#currentInputRange.value = this.#currentInputRangeValue;\n      }\n    }\n\n    this.#currentInputRange = this.#currentInputRangeValue = null;\n  }\n\n  #onRangeScroll(this: EditorControls<TConfig>) {\n    this.#lockRange = true;\n  }\n\n  #onInput(e: InputEvent) {\n    clearTimeout(inputTimeout);\n    clearTimeout(this.#postponeRangeInputTimeout);\n\n    if (this.#postponeRangeInput && isRangeInput(e.target)) {\n      e.preventDefault();\n      this.#postponeRangeInputTimeout = window.setTimeout(() => {\n        this.#onInput(e);\n      }, RANGE_SCROLL_LOCK_TIMEOUT);\n      return false;\n    }\n    if (this.#lockRange) {\n      e.preventDefault();\n      return false;\n    }\n\n    if (\n      e.target instanceof HTMLInputElement ||\n      e.target instanceof StringArtCheckbox ||\n      isRangeInput(e.target) ||\n      e.target instanceof HTMLSelectElement\n    ) {\n      this.updateInput({\n        inputElement: e.target,\n        originalEvent: e,\n        deferChange: true,\n      });\n    }\n  }\n\n  updateControlDisplayValue(controlKey: keyof TConfig) {\n    const { config, displayValueElement, input } = this.controlElements[\n      controlKey\n    ] as Control<TConfig>;\n    if (displayValueElement) {\n      const formattedValue = config.displayValue\n        ? config.displayValue(this.config)\n        : input.value;\n      displayValueElement.innerText = String(formattedValue);\n    }\n  }\n\n  updateInput({\n    inputElement,\n    originalEvent,\n    deferChange = true,\n  }: {\n    inputElement: ControlInputElement;\n    originalEvent?: InputEvent;\n    deferChange?: boolean;\n  }) {\n    const controlKey = inputElement.id.replace(/^config_/, '') as keyof TConfig;\n    const inputValue = getInputValue(\n      inputElement\n    ) as TConfig[typeof controlKey];\n\n    if (this.config[controlKey] === inputValue) {\n      return;\n    }\n\n    const eventData: ControlValueChangeEventData<TConfig> = {\n      control: this.controlElements[controlKey].config,\n      value: inputValue,\n      originalEvent,\n    };\n\n    this.emit('input', eventData);\n\n    const triggerChange = () => {\n      this.emit('change', eventData);\n      this.updateControlsVisibility();\n      this.updateControlsLabels();\n    };\n\n    this.updateControlsAttributes();\n    this.updateControlDisplayValue(controlKey);\n\n    if (deferChange) {\n      inputTimeout = window.setTimeout(triggerChange, 100);\n    } else {\n      triggerChange();\n    }\n  }\n\n  _getState(): EditorState | null {\n    const state = localStorage.getItem(STATE_LOCAL_STORAGE_KEY);\n    if (state) {\n      try {\n        return JSON.parse(state);\n      } catch (e) {\n        return null;\n      }\n    }\n\n    return null;\n  }\n\n  _updateState(newState) {\n    if (newState) {\n      localStorage.setItem(STATE_LOCAL_STORAGE_KEY, JSON.stringify(newState));\n    } else {\n      localStorage.removeItem(STATE_LOCAL_STORAGE_KEY);\n    }\n  }\n\n  updateControlsAttributes(controlsConfig?: ControlsConfig<TConfig>) {\n    if (!controlsConfig) {\n      controlsConfig = this.controlsConfig;\n    }\n    controlsConfig.forEach(control => {\n      if (control.type === 'group') {\n        this.updateControlsAttributes(control.children);\n      } else if (control.attr) {\n        const functionAttrs = Object.entries(control.attr).filter(\n          ([_, value]) => value instanceof Function\n        );\n        if (functionAttrs.length) {\n          const inputEl = this.controlElements[control.key].input;\n          if (inputEl) {\n            functionAttrs.forEach(([name, attributeValueFn]) => {\n              const newAttrValue = this.getConfigValue(\n                attributeValueFn,\n                this.config\n              );\n              if (newAttrValue != inputEl.getAttribute(name)) {\n                inputEl.setAttribute(name, String(newAttrValue));\n                // If the min or max of the input changed and they're not within the new min/max, update the value of the input\n                if (\n                  (name === 'min' && inputEl.value < newAttrValue) ||\n                  (name === 'max' && inputEl.value > newAttrValue)\n                ) {\n                  inputEl.value = String(newAttrValue);\n                  clearTimeout(inputEl.updateTimeout);\n                  inputEl.updateTimeout = window.setTimeout(() => {\n                    this.updateInput({ inputElement: inputEl });\n                  }, 100);\n                } else {\n                  this.updateControlDisplayValue(control.key);\n                }\n              }\n            });\n          }\n        }\n      }\n    });\n  }\n\n  updateControlsLabels(controlsConfig?: ControlsConfig<TConfig>) {\n    (controlsConfig ?? this.controlsConfig).forEach(control => {\n      if (control.label instanceof Function) {\n        const { label: labelEl, element } = this.controlElements[control.key];\n\n        const labelText = control.label(this.config);\n        if (control.type === 'checkbox') {\n          element.setAttribute('label', labelText);\n        } else if (control.type === 'group') {\n          element.setAttribute('legend', labelText);\n        } else if (labelEl) {\n          labelEl.innerText = labelText;\n        }\n      }\n\n      if (control.type === 'group') {\n        this.updateControlsLabels(control.children);\n      }\n    });\n  }\n\n  updateControlsVisibility(controlsConfig?: ControlsConfig<TConfig>) {\n    (controlsConfig ?? this.controlsConfig).forEach(control => {\n      if (control.show) {\n        const shouldShowControl = control.show(this.config);\n        const controlEl = this.controlElements[control.key].element;\n        if (controlEl) {\n          toggleHide(controlEl, !shouldShowControl);\n        }\n      }\n\n      if (control.isDisabled) {\n        const shouldDisableControl = control.isDisabled(this.config);\n        const inputEl = this.controlElements[control.key].input;\n        if (inputEl) {\n          if (shouldDisableControl) {\n            inputEl.setAttribute('disabled', 'disabled');\n          } else {\n            inputEl.removeAttribute('disabled');\n          }\n        }\n      }\n\n      if (control.children) {\n        this.updateControlsVisibility(control.children);\n      }\n    });\n  }\n\n  renderControls(\n    containerEl: HTMLElement | undefined = elements.controls,\n    _controlsConfig?: ControlsConfig<TConfig>,\n    indexStart?: number\n  ) {\n    const controlsConfig = _controlsConfig ?? this.controlsConfig;\n    containerEl.innerHTML = '';\n    const controlsFragment = document.createDocumentFragment();\n    indexStart = indexStart ?? 1;\n\n    controlsConfig.forEach((controlConfig, controlIndex) => {\n      const controlId = `config_${String(controlConfig.key)}`;\n\n      let controlEl: HTMLElement;\n      let inputEl: ControlInputElement;\n      let displayValueElement: HTMLSpanElement;\n      let label: HTMLLabelElement;\n\n      if (controlConfig.type === 'group') {\n        controlEl = document.createElement('expandable-panel');\n        controlEl.setAttribute(\n          'legend',\n          this.getConfigValue(controlConfig.label, this.config)\n        );\n        controlEl.setAttribute('data-group', String(controlConfig.key));\n        controlEl.className = 'control control_group';\n        if (controlConfig.defaultValue === 'minimized') {\n          controlEl.setAttribute('minimized', 'minimized');\n          this.state.groups[String(controlConfig.key)] = false;\n        }\n        this.renderControls(controlEl, controlConfig.children);\n      } else {\n        controlEl = document.createElement('div');\n        controlEl.className = 'control';\n\n        if (controlConfig.type !== 'checkbox') {\n          label = document.createElement('label');\n          label.innerHTML = this.getConfigValue(\n            controlConfig.label,\n            this.config\n          );\n          label.setAttribute('for', controlId);\n        }\n\n        inputEl = document.createElement(\n          getElementTagNameForControlType(controlConfig.type)\n        ) as ControlInputElement;\n        if (isRangeInput(inputEl)) {\n          inputEl.classList.add('range-input');\n        }\n        inputEl.setAttribute('tabindex', String(controlIndex));\n        const inputValue =\n          this.config[controlConfig.key] ??\n          this.getConfigValue(controlConfig.defaultValue, this.config);\n\n        if (controlConfig.type === 'select') {\n          const selectOptions = document.createDocumentFragment();\n          controlConfig.options.forEach(_option => {\n            const { value, label } =\n              typeof _option === 'string'\n                ? { value: _option, label: _option }\n                : _option;\n            const optionEl = document.createElement('option');\n            optionEl.setAttribute('value', value);\n            optionEl.innerText = label;\n            selectOptions.appendChild(optionEl);\n          });\n          inputEl.appendChild(selectOptions);\n          (inputEl as HTMLSelectElement).value = String(inputValue);\n          controlEl.appendChild(label);\n          controlEl.appendChild(inputEl);\n        } else {\n          if (controlConfig.type !== 'range') {\n            inputEl.setAttribute('type', controlConfig.type);\n          }\n\n          if (controlConfig.type === 'checkbox') {\n            (inputEl as StringArtCheckbox).checked = !!inputValue;\n            inputEl.setAttribute(\n              'label',\n              this.getConfigValue(controlConfig.label, this.config)\n            );\n            controlEl.appendChild(inputEl);\n          } else {\n            controlEl.appendChild(label);\n            controlEl.appendChild(inputEl);\n            setTimeout(() => {\n              inputEl.value = String(inputValue);\n            });\n            displayValueElement = document.createElement('span');\n            displayValueElement.id = `config_${String(\n              controlConfig.key\n            )}_value`;\n            displayValueElement.innerText = String(\n              controlConfig.displayValue\n                ? controlConfig.displayValue(this.config)\n                : inputValue\n            );\n            displayValueElement.className = 'control_input_value';\n            controlEl.appendChild(displayValueElement);\n          }\n        }\n\n        if (controlConfig.attr) {\n          Object.entries(controlConfig.attr).forEach(([attr, value]) => {\n            const realValue = this.getConfigValue(value, this.config);\n            inputEl.setAttribute(attr, String(realValue));\n          });\n        }\n\n        inputEl.id = controlId;\n      }\n\n      this.controlElements[controlConfig.key] = {\n        config: controlConfig,\n        displayValueElement,\n        input: inputEl,\n        element: controlEl,\n        label,\n      };\n      controlEl.id = `control_${String(controlConfig.key)}`;\n      controlsFragment.appendChild(controlEl);\n    });\n\n    containerEl.appendChild(controlsFragment);\n    this.updateGroupsState();\n    requestAnimationFrame(() => this.updateControlsVisibility());\n  }\n\n  updateGroupsState() {\n    const groups = elements.sidebarForm.querySelectorAll('[data-group]');\n    groups.forEach(groupEl => {\n      if (groupEl instanceof HTMLFieldSetElement) {\n        const groupId = groupEl.dataset.group;\n        const groupState = this.state.groups[groupId];\n        if (typeof groupState === 'boolean') {\n          if (groupState) {\n            groupEl.classList.remove('minimized');\n          } else {\n            groupEl.classList.add('minimized');\n          }\n        }\n      }\n    });\n  }\n\n  getConfigValue<T = PrimitiveValue>(\n    valueOrFn: ConfigValueOrFunction<TConfig, T>,\n    config: Config<TConfig>\n  ): T {\n    if (valueOrFn instanceof Function) {\n      return valueOrFn(config);\n    }\n\n    return valueOrFn;\n  }\n}\n\nfunction getInputValue(inputElement: EventTarget) {\n  if (isRangeInput(inputElement)) {\n    return Number(inputElement.value);\n  }\n\n  if (inputElement instanceof HTMLInputElement) {\n    const type = inputElement.type;\n\n    switch (type) {\n      case 'range':\n        return parseFloat(inputElement.value);\n      case 'hue':\n        return inputElement.value;\n      case 'checkbox':\n        return inputElement.checked;\n      case 'number':\n        return parseFloat(inputElement.value);\n      default:\n        return inputElement.value;\n    }\n  } else if (inputElement instanceof StringArtCheckbox) {\n    return inputElement.checked;\n  } else if (inputElement instanceof HTMLSelectElement) {\n    return inputElement.value;\n  }\n}\n\nfunction getElementTagNameForControlType(controlType: ControlType): string {\n  switch (controlType) {\n    case 'select':\n      return 'select';\n    case 'range':\n      return 'string-art-range-input';\n    case 'hue':\n      return 'string-art-hue-input';\n    case 'checkbox':\n      return 'string-art-checkbox';\n    default:\n      return 'input';\n  }\n}\n\nfunction isRangeInput(\n  element: EventTarget\n): element is StringArtRangeInput | StringArtHueInput {\n  return (\n    element instanceof StringArtRangeInput ||\n    element instanceof StringArtHueInput\n  );\n}\n","import * as styles from 'bundle-text:./ExpandablePanel.css';\n\nconst sheet = new CSSStyleSheet();\nsheet.replaceSync(String(styles));\n\nexport class ExpandablePanel extends HTMLElement {\n  #legend: HTMLLegendElement;\n  #fieldset: HTMLFieldSetElement;\n\n  constructor() {\n    super();\n    const shadow = this.attachShadow({ mode: 'open' });\n\n    shadow.adoptedStyleSheets = [sheet];\n\n    this.shadowRoot!.innerHTML = `\n      <fieldset>\n        <legend></legend>\n        <div>\n            <slot></slot>\n        </div>\n      </fieldset>\n      `;\n    this.#legend = shadow.querySelector('legend');\n    this.#fieldset = shadow.querySelector('fieldset');\n\n    this.#legend.addEventListener('click', () => this.toggle());\n  }\n\n  static get observedAttributes() {\n    return ['legend', 'minimized'];\n  }\n\n  connectedCallback() {\n    this.syncAttributes();\n  }\n\n  attributeChangedCallback() {\n    this.syncAttributes();\n  }\n\n  syncAttributes() {\n    if (this.hasAttribute('legend')) {\n      this.#legend.textContent = this.getAttribute('legend');\n    } else {\n      this.#fieldset.classList.remove('minimized');\n      this.#legend.textContent = '';\n    }\n\n    if (this.hasAttribute('minimized')) {\n      this.#fieldset.classList.add('minimized');\n    } else {\n      this.#fieldset.classList.remove('minimized');\n    }\n  }\n\n  private toggle(): void {\n    this.#fieldset.classList.toggle('minimized');\n  }\n\n  open(): void {\n    this.#fieldset.classList.remove('minimized');\n  }\n\n  close(): void {\n    this.#fieldset.classList.add('minimized');\n  }\n}\n\ncustomElements.define('expandable-panel', ExpandablePanel);\n","module.exports = \"e635f914135e1199\";","import * as styles from 'bundle-text:./StringArtCheckbox.css';\n\nconst sheet = new CSSStyleSheet();\nsheet.replaceSync(String(styles));\n\nexport default class StringArtCheckbox extends HTMLElement {\n  static formAssociated = true;\n  internals: ElementInternals;\n  #checked: boolean;\n  disabled = false;\n\n  #label: HTMLLabelElement;\n  #input: HTMLInputElement;\n\n  constructor() {\n    super();\n    const shadow = this.attachShadow({ mode: 'open', delegatesFocus: true });\n\n    shadow.adoptedStyleSheets = [sheet];\n    this.shadowRoot.innerHTML = `\n          <span>\n            <input id=\"checkbox\" type=\"checkbox\">\n            <label for=\"checkbox\"></label>\n          </span>\n        `;\n\n    this.#input = shadow.querySelector('input');\n    this.#label = shadow.querySelector('label');\n    this.internals = this.attachInternals();\n  }\n\n  static get observedAttributes() {\n    return ['checked', 'label', 'disabled', 'name'];\n  }\n\n  attributeChangedCallback() {\n    this.syncAttributes();\n  }\n\n  get checked(): boolean {\n    return this.#checked;\n  }\n\n  set checked(v: boolean) {\n    if ((this.#checked = v)) {\n      this.#input.checked = true;\n    } else {\n      this.#input.checked = false;\n    }\n\n    this.internals.setFormValue(this.#checked ? 'on' : null);\n  }\n\n  get value(): boolean {\n    return this.checked;\n  }\n\n  set value(v: boolean) {\n    this.checked = v;\n  }\n\n  connectedCallback() {\n    this.syncAttributes();\n\n    this.#input.addEventListener('input', () => {\n      this.#checked = this.#input.checked;\n\n      this.internals.setFormValue(this.#checked ? 'on' : null);\n\n      this.dispatchEvent(\n        new CustomEvent('input', {\n          detail: { checked: this.#checked },\n        })\n      );\n\n      this.dispatchEvent(\n        new CustomEvent('change', {\n          detail: { checked: this.#checked },\n          bubbles: true,\n        })\n      );\n    });\n\n    this.internals.setFormValue(this.#checked ? 'on' : null);\n    this.tabIndex = 0;\n  }\n\n  private syncAttributes() {\n    if (this.hasAttribute('label')) {\n      this.#label.textContent = this.hasAttribute('label')\n        ? this.getAttribute('label')\n        : '';\n    }\n\n    if (this.hasAttribute('checked')) {\n      this.checked = true;\n    }\n\n    if (this.hasAttribute('disabled')) {\n      this.disabled = true;\n    }\n\n    if (this.hasAttribute('name')) {\n      this.internals.setFormValue(this.#checked ? 'on' : null);\n    }\n  }\n\n  focus() {\n    this.#input.focus();\n  }\n\n  blur() {\n    this.#input.blur();\n  }\n}\n\ncustomElements.define('string-art-checkbox', StringArtCheckbox);\n","module.exports = \"7730fff780baa9e1\";","import StringArtRangeInput from './infra/StringArtRangeInput';\n\nconst DEFAULT_THUMB_COLOR = 'white';\nconst FULL_GAMUT_GRADIENT =\n  'linear-gradient(to right in hsl longer hue, hsl(1 100 50), hsl(360 100 50))';\n\nexport default class StringArtHueInput extends HTMLElement {\n  static formAssociated = true;\n  internals: ElementInternals;\n\n  start: number = 1; // hue to start with\n  colorThumb: boolean = false;\n  reverse: boolean = false;\n  type: 'hue' | 'range' = 'hue';\n\n  #input: StringArtRangeInput = null;\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open', delegatesFocus: true });\n\n    this.shadowRoot.innerHTML = `\n        <string-art-range-input min=\"1\" max=\"360\" step=\"1\" />\n    `;\n\n    this.#input = this.shadowRoot.querySelector('string-art-range-input');\n    this.internals = this.attachInternals();\n  }\n\n  static get observedAttributes() {\n    return ['start', 'colorthumb', 'value', 'reverse', 'type'];\n  }\n\n  attributeChangedCallback(name: string, oldVal: string, newVal: string) {\n    if (name === 'value') {\n      this.value = newVal;\n    }\n\n    if (name === 'start') {\n      this.start = parseInt(newVal, 10);\n      this.#setBackground();\n    }\n\n    if (name === 'reverse') {\n      this.reverse = !!newVal;\n      this.#setBackground();\n    }\n\n    if (name === 'colorthumb') {\n      this.colorThumb = !!newVal;\n      this.#setThumbColor();\n      // Update color thumb\n    }\n\n    if (name === 'type') {\n      this.type = newVal === 'range' ? 'range' : 'hue';\n      this.#setBackground();\n    }\n  }\n\n  get value(): number {\n    return this.#input.value;\n  }\n\n  set value(v: number | string) {\n    this.#input.value = v;\n    this.#setBackground();\n\n    if (this.colorThumb) {\n      this.#setThumbColor();\n    }\n  }\n\n  connectedCallback() {\n    if (this.hasAttribute('value')) {\n      this.value = parseInt(this.getAttribute('value'));\n    }\n\n    if (this.hasAttribute('colorthumb')) {\n      this.colorThumb = true;\n    }\n    this.#setThumbColor();\n\n    this.#input.addEventListener('input', e => this.#handleInput(e));\n  }\n\n  #handleInput(e: Event) {\n    const value = this.value;\n\n    this.internals.setFormValue(String(value));\n\n    this.dispatchEvent(\n      new CustomEvent('input', {\n        detail: { value },\n      })\n    );\n\n    this.#setBackground();\n    this.#setThumbColor();\n  }\n  disconnectedCallback() {\n    // Destroy EditorControls here\n  }\n\n  focus() {}\n\n  blur() {}\n\n  #setBackground(): void {\n    const background =\n      this.type === 'range'\n        ? `linear-gradient(to ${this.reverse ? 'left' : 'right'} in hsl ${\n            this.value >= 180 ? 'longer' : 'shorter'\n          } hue, hsl(${this.start} 100 50), hsl(${\n            // Fixes a bug in Chrome, that for a 180 deg hue gradient, it always goes in reverse\n            this.start + (this.value === 180 ? 181 : this.value)\n          } 100 50))`\n        : FULL_GAMUT_GRADIENT;\n\n    this.#input.setAttribute('background', background);\n  }\n\n  #setThumbColor(): void {\n    const thumbColor = this.colorThumb\n      ? `hsl(${this.value}deg 100 50)`\n      : DEFAULT_THUMB_COLOR;\n\n    this.#input.setAttribute('thumbcolor', thumbColor);\n  }\n}\n\ncustomElements.define('string-art-hue-input', StringArtHueInput);\n","const DEFAULT_SNAP_DISTANCE = 0.05;\nconst THUMB_RADIUS = 8;\nconst TICK_WIDTH = 2;\nconst TICK_COLOR = 'rgba(0,0,0,.2)';\nconst FAR_VALUES_DISTANCE = 0.2; // values are considered far from each other if they are at least a fifth of the width of the input apart\n\nexport default class StringArtRangeInput extends HTMLElement {\n  static formAssociated = true;\n  internals: ElementInternals;\n\n  min: number;\n  max: number;\n\n  #input: HTMLInputElement = null;\n  #backgroundStyle: HTMLStyleElement = null;\n  #snap: number = DEFAULT_SNAP_DISTANCE;\n  #prevValue: number = null;\n  #prevSnapValue: number = null;\n  #tickValues: Array<number> = null;\n  #snapDistance: number = null;\n  #background: string = null;\n  #thumbColor: string = null;\n  #snapDisabledTick: number = null;\n  #resizeObserver: ResizeObserver;\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open', delegatesFocus: true });\n\n    this.shadowRoot.innerHTML = `\n          <style>\n            input[type=\"range\"] {\n              width: 100%;\n              appearance: none;\n              -webkit-appearance: none; /* remove iOS default */\n              background: transparent;\n              border: none;\n              margin: 2px;\n              cursor: pointer;\n            }\n\n            input[type=\"range\"]::-webkit-slider-thumb {\n              appearance: none;\n              -webkit-appearance: none;\n              width: ${THUMB_RADIUS * 2}px;\n              height: ${THUMB_RADIUS * 2}px;\n              border-radius: 50%;\n              background: var(--color-input);\n              cursor: pointer;\n              border: none;\n              margin-top: -4px;\n              z-index: 10;\n              box-shadow: 0 0 5px rgba(0,0,0,.5)\n            }\n\n            input[type=\"range\"]::-webkit-slider-thumb:hover {\n              background: var(--color-input-hover);\n            }\n              \n            input[type=\"range\"]:active::-webkit-slider-thumb {\n              background: var(--color-input-active);\n            }\n\n            input[type=\"range\"]::-webkit-slider-runnable-track {\n              height: 8px;\n              border-radius: 4px;\n              margin: 0;\n            }\n          </style>\n          <style id=\"background\"></style>\n          <input type=\"range\">\n        `;\n\n    this.#input = this.shadowRoot.querySelector('input[type=\"range\"]');\n    this.#backgroundStyle = this.shadowRoot.querySelector('#background');\n    this.#snap = DEFAULT_SNAP_DISTANCE;\n    this.#prevSnapValue = null;\n\n    this.internals = this.attachInternals();\n  }\n\n  static get observedAttributes() {\n    return ['min', 'max', 'value', 'step', 'snap', 'background', 'thumbcolor'];\n  }\n\n  attributeChangedCallback(name, oldVal, newVal) {\n    if (name === 'snap') {\n      this.#tickValues = this.getTickValues();\n    } else if (this.#input) {\n      this.#input[name] = newVal;\n    }\n\n    if (name === 'min' || name === 'max') {\n      this[name] = Number(newVal);\n    }\n\n    let value: number;\n    if (name === 'value') {\n      value = Number(newVal);\n    }\n\n    if (name === 'background') {\n      this.#background = newVal;\n    }\n\n    if (name === 'thumbcolor') {\n      this.#thumbColor = newVal;\n    }\n\n    if (this.min != null && this.max != null) {\n      if (this.min > this.max) {\n        this.max = this.min;\n        this.#input.max = String(this.min);\n      }\n\n      this.#snapDistance =\n        (this.max - this.min) * this.#snap || DEFAULT_SNAP_DISTANCE;\n\n      if (this.#tickValues && this.value != null) {\n        const snappedValue = this.getClosestTick(value);\n        if (snappedValue != null) {\n          this.#prevSnapValue = snappedValue;\n        }\n      }\n    }\n\n    this.#setStyle();\n  }\n\n  get value(): number {\n    return Number(this.#input.value);\n  }\n\n  set value(v: string | number) {\n    this.#input.value = String(v);\n    this.#setStyle();\n  }\n\n  connectedCallback() {\n    ['min', 'max', 'value', 'step'].forEach(attr => {\n      if (this.hasAttribute(attr)) {\n        this.#input[attr] = this.getAttribute(attr);\n      }\n    });\n\n    this.#tickValues = this.getTickValues();\n    this.#resizeObserver = new ResizeObserver(entries => {\n      for (let entry of entries) {\n        const width = entry.contentRect.width;\n        this.#setStyle();\n      }\n    });\n    this.#resizeObserver.observe(this.#input);\n\n    this.#input.addEventListener('input', () => this.handleInput());\n    this.#input.addEventListener('keydown', e => this.handleKeydown(e));\n    this.#input.addEventListener(\n      'change',\n      () => (this.#snapDisabledTick = null)\n    );\n\n    this.tabIndex = 0;\n  }\n\n  disconnectedCallback() {\n    this.#resizeObserver.unobserve(this);\n  }\n\n  getTickValues() {\n    const ticks = this.getAttribute('snap');\n    const ticksMatch = ticks?.match(/\\d+(\\.\\d+)?/g);\n    if (!ticksMatch) return [];\n    return ticksMatch\n      .map(Number)\n      .filter(n => !isNaN(n))\n      .sort();\n  }\n\n  #shouldAvoidSnap(newValue, closestTick) {\n    if (closestTick == null) {\n      closestTick = this.getClosestTick(newValue);\n    }\n\n    if (closestTick == null) {\n      return true;\n    }\n\n    // If moving away from the snap value, don't snap:\n    const distanceFromTick = Math.abs(newValue - closestTick);\n\n    if (\n      distanceFromTick >= this.#snapDistance / 2 &&\n      distanceFromTick > Math.abs(this.#prevValue - closestTick)\n    ) {\n      return true;\n    }\n\n    return false;\n  }\n\n  // Checks whether two values are far apart,\n  #areValuesFar(value1: number, value2: number): boolean {\n    const distance = Math.abs(value1 - value2) / (this.max - this.min);\n    return distance >= FAR_VALUES_DISTANCE;\n  }\n\n  focus() {\n    this.#input.focus();\n  }\n\n  blur() {\n    this.#input.blur();\n  }\n\n  handleInput() {\n    const value = Number(this.#input.value);\n    const closestTick = this.getClosestTick(value);\n\n    this.internals.setFormValue(this.#input.value);\n\n    if (\n      closestTick != null &&\n      this.#snapDisabledTick !== closestTick &&\n      this.#shouldAvoidSnap(value, closestTick)\n    ) {\n      this.#snapDisabledTick = closestTick;\n    }\n\n    if (closestTick !== this.#snapDisabledTick) {\n      if (closestTick !== null) {\n        this.#input.value = String(closestTick);\n        if (closestTick !== this.#prevSnapValue) {\n          this.#vibrate();\n          this.#prevSnapValue = closestTick;\n        }\n      } else if (this.#prevSnapValue != null) {\n        this.#prevSnapValue = null;\n      }\n    }\n\n    if (\n      this.#snapDisabledTick != null &&\n      closestTick == null &&\n      this.#areValuesFar(value, this.#snapDisabledTick)\n    ) {\n      this.#snapDisabledTick = null;\n    }\n\n    this.#setStyle();\n    this.#prevValue = value;\n\n    this.dispatchEvent(\n      new CustomEvent('input', {\n        detail: { value: this.#input.value },\n      })\n    );\n  }\n\n  handleKeydown(event: KeyboardEvent) {\n    event.preventDefault();\n    const step = Number(this.#input.step || 1);\n    const value = Number(this.#input.value);\n\n    let newValue;\n\n    if (event.key === 'ArrowLeft') {\n      newValue = Math.max(this.min, value - step);\n    } else if (event.key === 'ArrowRight') {\n      newValue = Math.min(this.max, value + step);\n    } else if (event.key === 'ArrowUp') {\n      const next = this.#tickValues.find(t => t > value);\n      if (next !== undefined) {\n        newValue = next;\n      } else if (value !== this.max) {\n        // no next tick found, go to max\n        newValue = this.max;\n      }\n    } else if (event.key === 'ArrowDown') {\n      const reversed = [...this.#tickValues].reverse();\n      const prev = reversed.find(t => t < value);\n      if (prev !== undefined) {\n        newValue = prev;\n      } else if (value !== this.min) {\n        newValue = this.min;\n      }\n    }\n\n    if (newValue != null) {\n      this.value = newValue;\n      this.#prevValue = newValue;\n      // emit event and prevent default for arrow keys\n      this.dispatchEvent(\n        new CustomEvent('input', {\n          detail: { value: newValue },\n          bubbles: true,\n          composed: true,\n        })\n      );\n    }\n\n    return false;\n  }\n\n  getClosestTick(value: number): number {\n    if (!this.#tickValues || this.#tickValues.length === 0) return null;\n\n    for (const tickValue of this.#tickValues) {\n      const distance = Math.abs(value - tickValue);\n      if (distance <= this.#snapDistance) {\n        return tickValue;\n      }\n    }\n\n    return null;\n  }\n\n  #vibrate() {\n    if ('vibrate' in navigator) {\n      navigator.vibrate(10);\n    }\n  }\n\n  #setStyle() {\n    const inputWidth = this.#input.clientWidth;\n    if (!inputWidth) {\n      return;\n    }\n\n    const valueInRange = this.value - this.min;\n    const range = this.max - this.min;\n    const availableWidth = inputWidth - 2 * THUMB_RADIUS;\n    const valueWidth = THUMB_RADIUS + (availableWidth * valueInRange) / range;\n\n    // The center of the thumb of the range input doesn't reach 0 and 100%, so the actual range to display leaves out the thumb's radius on the left and right.\n    // Due to this, the ticks are placed in the constricted range of [THUMB_RADIUS::inputWidth - 2 * THUMB_RADIUS]\n    const tickPositions = this.#tickValues\n      ?.filter(v => v !== this.min && v !== this.max)\n      .map(\n        v =>\n          THUMB_RADIUS +\n          (availableWidth * (v - this.min)) / range -\n          TICK_WIDTH / 2\n      );\n\n    const tickPositionsInGradient = tickPositions\n      ?.map(\n        p =>\n          `transparent ${p}px, ${TICK_COLOR} ${p}px, ${TICK_COLOR} ${\n            p + TICK_WIDTH\n          }px, transparent ${p + TICK_WIDTH}px`\n      )\n      .join(', ');\n    const ticksBackground = tickPositions?.length\n      ? `linear-gradient(to right, ${tickPositionsInGradient}), `\n      : null;\n\n    const styles = [\n      `input[type=\"range\"]::-webkit-slider-runnable-track {\n        background: ${ticksBackground ? ticksBackground : ''}${\n        this.#background ??\n        `linear-gradient(to right, var(--color-input) ${valueWidth}px, #ddd ${valueWidth}px)`\n      };\n      }${\n        this.#background\n          ? ''\n          : `\n       input[type=\"range\"]:hover::-webkit-slider-runnable-track {\n        background: ${\n          ticksBackground ? ticksBackground : ''\n        }linear-gradient(to right, var(--color-input-hover) ${valueWidth}px, #ddd ${valueWidth}px);\n      }\n        input[type=\"range\"]:active::-webkit-slider-runnable-track {\n        background: ${\n          ticksBackground ? ticksBackground : ''\n        }linear-gradient(to right, var(--color-input-active) ${valueWidth}px, #ddd ${valueWidth}px);\n      }`\n      }`,\n    ];\n\n    if (this.#thumbColor != null) {\n      styles.push(\n        `input[type=\"range\"]::-webkit-slider-thumb { background: ${\n          this.#thumbColor\n        } !important}`\n      );\n    }\n    this.#backgroundStyle.innerHTML = styles.join('\\n');\n  }\n}\n\ncustomElements.define('string-art-range-input', StringArtRangeInput);\n","export function unHide(element: Element) {\n  element.removeAttribute('hidden');\n}\n\nexport function hide(element: Element) {\n  element.setAttribute('hidden', 'hidden');\n}\n\nexport function toggleHide(element: Element, isHidden?: boolean) {\n  if (isHidden != null) {\n    isHidden ? hide(element) : unHide(element);\n  } else {\n    if (element.hasAttribute('hidden')) {\n      unHide(element);\n    } else {\n      hide(element);\n    }\n  }\n}\n","import CanvasRenderer from '../infra/renderers/CanvasRenderer';\nimport type StringArt from '../infra/StringArt';\nimport Persistance from '../Persistance';\nimport EventBus from '../helpers/EventBus';\nimport { getAllPatternsTypes } from '../helpers/pattern_utils';\n\nconst THUMBNAIL_WIDTH_PX = '100px';\nconst MINIMIZED_CLASS = 'minimized';\n\nexport class Thumbnails extends EventBus<{ select: { patternId: string } }> {\n  elements: Record<string, HTMLElement> = {\n    root: document.querySelector('#pattern_select_panel'),\n    thumbnails: document.querySelector('#thumbnails'),\n    toggleBtn: document.querySelector('#pattern_select_btn'),\n    dropdown: document.querySelector('#pattern_select_dropdown'),\n    patternName: document.querySelector('#pattern_name'),\n  };\n\n  pattern: StringArt<any>;\n  thumbnailsRendered = false;\n  _onClickOutside: (e: MouseEvent) => void;\n\n  constructor(persistance: Persistance) {\n    super();\n\n    this.elements.toggleBtn.addEventListener('click', () => this.toggle());\n\n    persistance.addEventListener('newPattern', ({ pattern }) => {\n      if (this.isOpen) {\n        this.createThumbnails();\n      } else {\n        this.thumbnailsRendered = false;\n      }\n\n      this.setCurrentPattern(pattern);\n      this.emit('select', { patternId: pattern.id });\n    });\n\n    persistance.addEventListener('save', ({ pattern }) => {\n      if (this.isOpen) {\n        this.createThumbnails();\n      } else {\n        this.thumbnailsRendered = false;\n      }\n\n      this.setCurrentPattern(pattern);\n    });\n\n    persistance.addEventListener('deletePattern', ({ pattern }) => {\n      if (this.isOpen) {\n        const thumbnail = this.elements.thumbnails.querySelector(\n          `[data-pattern=\"${pattern.id}\"]`\n        );\n        thumbnail.remove();\n      } else {\n        this.thumbnailsRendered = false;\n      }\n    });\n\n    this.elements.thumbnails.addEventListener('click', e => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const link =\n        e.target instanceof HTMLElement &&\n        (e.target.closest('[data-pattern]') as HTMLElement);\n\n      if (!link) {\n        return false;\n      }\n\n      this.emit('select', { patternId: link.dataset.pattern });\n    });\n  }\n\n  get isOpen(): boolean {\n    return !this.elements.root.classList.contains(MINIMIZED_CLASS);\n  }\n\n  toggle() {\n    if (!this.isOpen) {\n      this.open();\n    } else if (this.pattern) {\n      this.close();\n    }\n  }\n\n  open() {\n    if (!this.isOpen) {\n      this.elements.root.classList.remove(MINIMIZED_CLASS);\n      if (!this.thumbnailsRendered) {\n        this.createThumbnails();\n        this.thumbnailsRendered = true;\n      }\n\n      this._onClickOutside = e => {\n        if (\n          e.target instanceof HTMLElement &&\n          !e.target.closest('#pattern_select_panel')\n        ) {\n          this.toggle();\n        }\n      };\n\n      document.body.addEventListener('mousedown', this._onClickOutside);\n    }\n  }\n\n  close() {\n    if (this.isOpen) {\n      this.elements.root.classList.add(MINIMIZED_CLASS);\n      document.body.removeEventListener('mousedown', this._onClickOutside);\n      this._onClickOutside = null;\n    }\n  }\n\n  setCurrentPattern(pattern: StringArt<any>) {\n    this.pattern = pattern;\n    this.elements.patternName.innerText = pattern?.name ?? 'Choose a pattern';\n  }\n\n  #createThumbnailsSection(title: string, patterns: StringArt[]): void {\n    const section = document.createElement('section');\n\n    const sectionTitle = document.createElement('h3');\n    sectionTitle.className = 'pattern_select_thumbnails_title';\n    sectionTitle.innerText = title;\n    section.appendChild(sectionTitle);\n\n    const thumbnailsList = document.createElement('ul');\n    thumbnailsList.className = 'pattern_select_thumbnails';\n    section.appendChild(thumbnailsList);\n\n    const thumbnailsFragment = document.createDocumentFragment();\n    const patternThumbnails: Record<string, HTMLElement> = {};\n\n    patterns.forEach(pattern => {\n      const patternLink = document.createElement('a');\n\n      patternLink.style.width = patternLink.style.height = THUMBNAIL_WIDTH_PX;\n      patternThumbnails[pattern.id] = patternLink;\n\n      const thumbnailConfig = pattern.thumbnailConfig;\n\n      pattern.assignConfig({\n        margin: 1,\n        enableBackground:\n          !pattern.config.darkMode || pattern.config.customBackgroundColor,\n        nailRadius: 0.5,\n        ...(thumbnailConfig instanceof Function\n          ? thumbnailConfig(pattern.config)\n          : thumbnailConfig),\n      });\n\n      const li = document.createElement('li');\n      thumbnailsFragment.appendChild(li);\n\n      patternLink.href = `?pattern=${pattern.id}`;\n      patternLink.setAttribute('data-pattern', pattern.id);\n      patternLink.title = pattern.name;\n      li.appendChild(patternLink);\n    });\n\n    thumbnailsList.appendChild(thumbnailsFragment);\n\n    this.elements.thumbnails.appendChild(section);\n\n    patterns.forEach(pattern => {\n      const renderer = new CanvasRenderer(patternThumbnails[pattern.id], {\n        updateOnResize: false,\n      });\n      renderer.setSize([100, 100]);\n      pattern.draw(renderer);\n    });\n  }\n\n  createThumbnails() {\n    this.elements.thumbnails.innerHTML = '';\n\n    const savedPatterns = Persistance.getSavedPatterns();\n    if (savedPatterns.length) {\n      this.#createThumbnailsSection(\n        'My Patterns',\n        Persistance.getSavedPatterns()\n      );\n    }\n    const patterns = getAllPatternsTypes();\n    this.#createThumbnailsSection('Built-in patterns', patterns);\n  }\n}\n","import Renderer, { RendererOptions } from './Renderer';\nimport { PI2 } from '../../helpers/math_utils';\nimport type { Coordinates, Dimensions } from '../../types/general.types';\nimport type { Nail, NailsRenderOptions } from '../../types/stringart.types';\nimport { ColorValue } from '../../helpers/color/color.types';\nimport { areDimensionsEqual } from '../../helpers/size_utils';\nimport { hide, unHide } from '../../helpers/dom_utils';\nimport NailsGroup from '../nails/NailsGroup';\n\nlet lastId = 0;\nconst INSTRUCTIONS_NAIL_RADIUS = 4;\n\nexport default class CanvasRenderer extends Renderer {\n  #background: ColorValue | null;\n  #currentColor: ColorValue;\n\n  #layers: Record<\n    'strings' | 'nails' | 'instructions',\n    { canvas: HTMLCanvasElement; ctx: CanvasRenderingContext2D }\n  >;\n\n  #instructions: HTMLDivElement;\n  #cancelInstructionsHide: Function;\n\n  constructor(parentElement: HTMLElement, options?: RendererOptions) {\n    super(parentElement, options);\n\n    const stringsCanvas = document.createElement('canvas');\n    const nailsCanvas = document.createElement('canvas');\n    const instructionsCanvas = document.createElement('canvas');\n\n    stringsCanvas.setAttribute('data-id', String(lastId++));\n    this.#layers = {\n      strings: {\n        canvas: stringsCanvas,\n        ctx: stringsCanvas.getContext('2d'),\n      },\n      nails: {\n        canvas: nailsCanvas,\n        ctx: nailsCanvas.getContext('2d'),\n      },\n      instructions: {\n        canvas: instructionsCanvas,\n        ctx: instructionsCanvas.getContext('2d'),\n      },\n    };\n\n    stringsCanvas.id = 'CanvasRenderer__strings';\n    nailsCanvas.id = 'CanvasRenderer__nails';\n    instructionsCanvas.id = 'CanvasRenderer_instructions';\n\n    this.instructionsCtx.lineWidth = 4;\n    this.instructionsCtx.strokeStyle = 'Red';\n\n    this.canvases.forEach(canvas => {\n      canvas.classList.add('CanvasRenderer__canvas');\n      parentElement.appendChild(canvas);\n      canvas.style.position = 'absolute';\n      canvas.style.top = '0';\n      canvas.style.left = '0';\n      canvas.style.width = '100%';\n      canvas.style.height = '100%';\n    });\n\n    this.enablePixelRatio();\n    this.ctxs.forEach(ctx => (ctx.globalCompositeOperation = 'source-over'));\n    this.addEventListener('devicePixelRatioChange', () => {\n      this.setSize([\n        this.stringsCanvas.clientWidth,\n        this.stringsCanvas.clientHeight,\n      ]);\n    });\n\n    this.resetSize(false);\n  }\n\n  get element() {\n    return this.#layers.strings.canvas;\n  }\n\n  get canvases(): HTMLCanvasElement[] {\n    return [\n      this.#layers.strings.canvas,\n      this.#layers.nails.canvas,\n      this.#layers.instructions.canvas,\n    ];\n  }\n\n  get ctxs(): CanvasRenderingContext2D[] {\n    return [\n      this.#layers.strings.ctx,\n      this.#layers.nails.ctx,\n      this.#layers.instructions.ctx,\n    ];\n  }\n\n  get stringsCtx(): CanvasRenderingContext2D {\n    return this.#layers.strings.ctx;\n  }\n\n  get nailsCtx(): CanvasRenderingContext2D {\n    return this.#layers.nails.ctx;\n  }\n\n  get stringsCanvas(): HTMLCanvasElement {\n    return this.#layers.strings.canvas;\n  }\n\n  get instructionsCanvas(): HTMLCanvasElement {\n    return this.#layers.instructions.canvas;\n  }\n\n  get instructionsCtx(): CanvasRenderingContext2D {\n    return this.#layers.instructions.ctx;\n  }\n\n  resetSize(notifyOnChange = true): Dimensions {\n    super.resetSize();\n\n    this.canvases.forEach(canvas => {\n      canvas.removeAttribute('width');\n      canvas.removeAttribute('height');\n      canvas.style.removeProperty('width');\n      canvas.style.removeProperty('height');\n    });\n\n    const newSize = this.getSize();\n    this.canvases.forEach(canvas => {\n      canvas.setAttribute('width', String(newSize[0]));\n      canvas.setAttribute('height', String(newSize[1]));\n    });\n\n    if (!this.currentSize || !areDimensionsEqual(newSize, this.currentSize)) {\n      this.currentSize = newSize;\n      if (notifyOnChange) {\n        this.emit('sizeChange', { size: newSize });\n      }\n    }\n\n    return newSize;\n  }\n\n  setSize(size?: Dimensions | null): Dimensions {\n    if (!size) {\n      return this.resetSize();\n    }\n\n    if (this.fixedSize) {\n      console.warn(\n        `Trying to set size for Renderer to [${size.join(\n          ', '\n        )}], but size is fixed to [${this.fixedSize.join(', ')}].`\n      );\n      return this.fixedSize;\n    }\n\n    const realSize = size.map(v => v * this.pixelRatio) as Dimensions;\n    this.canvases.forEach(canvas => {\n      canvas.setAttribute('width', String(realSize[0]));\n      canvas.setAttribute('height', String(realSize[1]));\n      canvas.style.setProperty('width', `${size[0]}px`);\n      canvas.style.setProperty('height', `${size[1]}px`);\n    });\n\n    if (!this.currentSize || !areDimensionsEqual(realSize, this.currentSize)) {\n      this.currentSize = realSize;\n\n      this.emit('sizeChange', { size: realSize });\n    }\n\n    return realSize;\n  }\n\n  resetStrings(): void {\n    this.stringsCtx.clearRect(0, 0, ...this.getSize());\n  }\n\n  /**\n   * Clears the stringsCanvas and resets the width and height\n   */\n  resetNails() {\n    this.#layers.nails.ctx.clearRect(0, 0, ...this.getSize());\n  }\n\n  setColor(color: ColorValue) {\n    this.#currentColor = color;\n    this.stringsCtx.strokeStyle = color;\n  }\n\n  setLineWidth(width: number) {\n    this.stringsCtx.lineWidth = width;\n  }\n\n  setBackground(color: ColorValue | null) {\n    if ((this.#background = color)) {\n      this.parentElement.style.background = color;\n      if (this.#instructions) {\n        this.#instructions.style.background = color;\n      }\n    } else {\n      this.parentElement.style.removeProperty('background');\n      if (this.#instructions) {\n        this.#instructions.style.background = 'black';\n      }\n    }\n  }\n\n  #setBackgroundOnCanvas(context: CanvasRenderingContext2D, color: ColorValue) {\n    context.globalCompositeOperation = 'destination-over';\n    context.fillStyle = color;\n    context.fillRect(0, 0, ...this.getSize());\n    context.globalCompositeOperation = 'source-over';\n  }\n\n  getLogicalSize(): Dimensions {\n    return (\n      this.fixedSize ??\n      ([\n        this.stringsCanvas.clientWidth,\n        this.stringsCanvas.clientHeight,\n      ] as Dimensions)\n    );\n  }\n\n  getSize(): Dimensions {\n    return this.getLogicalSize().map(v => v * this.pixelRatio) as Dimensions;\n  }\n\n  renderLine(from: Coordinates, to: Coordinates) {\n    this.lastStringCoordinates = from;\n    this.lineTo(to);\n  }\n\n  lineTo(to: Coordinates) {\n    if (!this.lastStringCoordinates) {\n      throw new Error(\"no last string coordinates, can't lineTo\");\n    }\n\n    this.stringsCtx.beginPath();\n    this.stringsCtx.moveTo(...this.lastStringCoordinates);\n    this.stringsCtx.lineTo(...to);\n    this.stringsCtx.stroke();\n    this.lastLine = [this.lastStringCoordinates, to];\n    this.lastStringCoordinates = to;\n  }\n\n  renderNails(\n    nails: Iterable<Coordinates>,\n    {\n      color,\n      fontSize,\n      radius,\n      renderNumbers,\n      margin = 0,\n      numbersStart = 1,\n    }: NailsRenderOptions\n  ) {\n    const centerX = this.stringsCanvas.width / 2;\n\n    this.nailsCtx.globalCompositeOperation = 'source-over';\n    this.nailsCtx.beginPath();\n    this.nailsCtx.fillStyle = color;\n    this.nailsCtx.textBaseline = 'middle';\n    this.nailsCtx.font = `${fontSize}px sans-serif`;\n    const nailNumberOffset = radius + margin;\n\n    let number = numbersStart;\n    for (let [x, y] of nails) {\n      this.nailsCtx.moveTo(x + radius, y);\n      this.nailsCtx.arc(x, y, radius, 0, PI2);\n      if (renderNumbers && number != null) {\n        const isRightAlign = x < centerX;\n\n        const numberPosition: Coordinates = [\n          isRightAlign ? x - nailNumberOffset : x + nailNumberOffset,\n          y,\n        ];\n\n        this.nailsCtx.textAlign = isRightAlign ? 'right' : 'left';\n        this.nailsCtx.fillText(String(number), ...numberPosition);\n      }\n      number++;\n    }\n\n    this.nailsCtx.fill();\n  }\n\n  showInstructions(): void {\n    this.#cancelInstructionsHide?.();\n\n    if (!this.#instructions) {\n      this.#instructions = document.createElement('div');\n      this.#instructions.id = 'CanvasRenderer__instructions';\n\n      const instructionsOverlay = document.createElement('div');\n      instructionsOverlay.id = 'CanvasRenderer__instructions_overlay';\n      instructionsOverlay.style = `background: ${\n        this.parentElement.style.background ?? 'black'\n      }; position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.5`;\n      this.#instructions.appendChild(instructionsOverlay);\n      this.#instructions.appendChild(this.instructionsCanvas);\n      this.parentElement.appendChild(this.#instructions);\n    } else {\n      unHide(this.#instructions);\n    }\n  }\n\n  hideInstructions(): void {\n    if (this.#instructions) {\n      let opacity = 1;\n      const fadeOut = () => {\n        opacity -= 0.02;\n        this.#instructions.style.opacity = String(opacity);\n        if (opacity > 0) {\n          const raf = requestAnimationFrame(fadeOut);\n          this.#cancelInstructionsHide = () => {\n            cancelAnimationFrame(raf);\n            this.#instructions.style.removeProperty('opacity');\n          };\n        } else {\n          hide(this.#instructions);\n          this.clearInstructions();\n          this.#instructions.style.removeProperty('opacity');\n        }\n      };\n\n      fadeOut();\n    }\n  }\n\n  renderInstructions(from: Coordinates, to: Coordinates) {\n    this.showInstructions();\n\n    const strokeColor = 'white';\n    const fillColor = this.#currentColor ?? 'red';\n\n    this.clearInstructions();\n    this.instructionsCtx.clearRect(0, 0, ...this.getSize());\n    this.instructionsCtx.beginPath();\n    this.instructionsCtx.lineWidth = 3;\n\n    let prevPosition = from;\n    this.#drawArrow(prevPosition, to, { strokeColor, fillColor });\n    prevPosition = to;\n\n    this.instructionsCtx.stroke();\n\n    this.instructionsCtx.beginPath();\n    [from, to].forEach(([x, y]) => {\n      this.instructionsCtx.moveTo(x + INSTRUCTIONS_NAIL_RADIUS, y);\n      this.instructionsCtx.arc(x, y, INSTRUCTIONS_NAIL_RADIUS, 0, PI2);\n    });\n    this.instructionsCtx.strokeStyle = strokeColor;\n    this.instructionsCtx.stroke();\n    this.instructionsCtx.fillStyle = fillColor;\n    this.instructionsCtx.fill();\n    this.hasInstructions = true;\n  }\n\n  clearInstructions(): void {\n    if (this.hasInstructions) {\n      this.instructionsCtx.clearRect(0, 0, ...this.getSize());\n      this.hasInstructions = false;\n    }\n  }\n\n  #drawArrow(\n    from: Coordinates,\n    to: Coordinates,\n    { strokeColor = 'white', fillColor = 'red' }\n  ) {\n    const arrowHeadSize = 15;\n\n    const ctx = this.instructionsCtx;\n\n    // Calculate angle of the line\n    const angle = Math.atan2(to[1] - from[1], to[0] - from[0]);\n\n    ctx.save(); // Save the current canvas state\n    ctx.strokeStyle = strokeColor;\n    ctx.fillStyle = fillColor; // For filling the arrowhead\n\n    // Draw the main line\n    ctx.beginPath();\n    ctx.moveTo(from[0], from[1]);\n    ctx.lineTo(to[0], to[1]);\n    ctx.stroke();\n\n    const arrowPos = [\n      from[0] + (to[0] - from[0]) / 2,\n      from[1] + (to[1] - from[1]) / 2,\n    ];\n\n    // Draw the arrowhead\n    ctx.beginPath();\n    ctx.moveTo(arrowPos[0], arrowPos[1]);\n    ctx.lineTo(\n      arrowPos[0] - arrowHeadSize * Math.cos(angle - Math.PI / 6),\n      arrowPos[1] - arrowHeadSize * Math.sin(angle - Math.PI / 6)\n    );\n    ctx.lineTo(\n      arrowPos[0] - arrowHeadSize * Math.cos(angle + Math.PI / 6),\n      arrowPos[1] - arrowHeadSize * Math.sin(angle + Math.PI / 6)\n    );\n    ctx.closePath(); // Connects the last point to the first, closing the triangle\n    ctx.fill(); // Fills the arrowhead\n\n    ctx.restore(); // Restore the canvas state\n  }\n\n  clear() {\n    this.ctxs.forEach(ctx => ctx.clearRect(0, 0, ...this.getSize()));\n  }\n\n  toDataURL(): string {\n    return this.getComposite().toDataURL();\n  }\n\n  async toBlob(\n    type: 'jpeg' | 'png' | 'webp' = 'png',\n    quality = 1\n  ): Promise<Blob> {\n    return new Promise<Blob>((resolve, reject) => {\n      this.getComposite().toBlob(\n        blob => (blob ? resolve(blob) : reject()),\n        `image/${type}`,\n        Math.max(0, Math.min(quality, 1))\n      );\n    });\n  }\n\n  getComposite(): HTMLCanvasElement {\n    const compositeCanvas = document.createElement('canvas');\n    compositeCanvas.width = this.stringsCanvas.width;\n    compositeCanvas.height = this.stringsCanvas.height;\n    const ctx = compositeCanvas.getContext('2d');\n    if (this.#background) {\n      this.#setBackgroundOnCanvas(ctx, this.#background);\n    }\n    this.canvases\n      .filter(canvas => canvas !== this.instructionsCanvas)\n      .forEach(c => ctx.drawImage(c, 0, 0));\n    return compositeCanvas;\n  }\n}\n","import { ColorValue } from '../../helpers/color/color.types';\nimport EventBus from '../../helpers/EventBus';\nimport type { Coordinates, Dimensions } from '../../types/general.types';\nimport type { Nail, NailsRenderOptions } from '../../types/stringart.types';\nimport NailsGroup from '../nails/NailsGroup';\n\nexport type RendererResetOptions = Partial<{\n  resetStrings: boolean;\n  resetNails: boolean;\n  resetSize: boolean;\n}>;\n\nexport type RendererOptions = Partial<{\n  updateOnResize: boolean;\n}>;\n\nexport interface LayerOptions {\n  startPosition?: Coordinates;\n  color?: ColorValue;\n  layerName?: string;\n}\n\nconst DEFAULT_OPTIONS: RendererOptions = {\n  updateOnResize: true,\n};\n\nexport default abstract class Renderer extends EventBus<{\n  devicePixelRatioChange: { devicePixelRatio: number };\n  sizeChange: { size: Dimensions };\n}> {\n  parentElement: HTMLElement;\n  color?: ColorValue;\n  size: Dimensions;\n  fixedSize: Dimensions | null;\n  pixelRatio = 1;\n  options: RendererOptions;\n\n  #isResizeFirstTime = true;\n\n  /**\n   * The current dimensions of the renderer. Should be fixed for device pixel ratio, if used by the renderer!\n   */\n  protected currentSize: Dimensions | null;\n  protected lastLine: [Coordinates, Coordinates];\n  protected lastStringCoordinates: Coordinates;\n  protected hasInstructions: boolean = false;\n  protected currentLayerOptions: LayerOptions;\n\n  #removeDevicePixelListener: Function;\n  #removeOnResizeListener: typeof ResizeObserver.prototype.disconnect;\n\n  constructor(parentElement: HTMLElement, options?: RendererOptions) {\n    super();\n    this.options = options ?? DEFAULT_OPTIONS;\n\n    const { updateOnResize = true } = this.options;\n\n    this.parentElement = parentElement;\n    if (updateOnResize) {\n      this.#setOnResize();\n    }\n  }\n\n  #setOnResize() {\n    const resizeObserver = new ResizeObserver(entries => {\n      for (const entry of entries) {\n        if (!this.#isResizeFirstTime) {\n          if (!this.fixedSize) {\n            this.setSize([entry.contentRect.width, entry.contentRect.height]);\n          }\n        }\n        this.#isResizeFirstTime = false;\n      }\n    });\n    this.#removeOnResizeListener = () => resizeObserver.disconnect();\n    resizeObserver.observe(this.parentElement);\n  }\n\n  destroy(): void {\n    if (this.parentElement) {\n      this.parentElement.innerHTML = '';\n    }\n    this.#removeDevicePixelListener?.();\n    this.#removeOnResizeListener?.();\n  }\n\n  get element(): Element {\n    throw new Error('element getter not implemented!');\n  }\n\n  setColor(color: ColorValue) {\n    this.color = color;\n  }\n\n  abstract resetStrings(): void;\n  abstract resetNails(): void;\n  resetSize(): void {\n    this.fixedSize = null;\n  }\n\n  abstract setLineWidth(width: number): void;\n  abstract renderLine(from: Coordinates, to: Coordinates): void;\n  abstract lineTo(to: Coordinates): void;\n  abstract renderNails(\n    nails: Iterable<Coordinates>,\n    options: NailsRenderOptions\n  ): void;\n  abstract renderInstructions(from: Coordinates, to: Coordinates): void;\n  abstract clearInstructions(): void;\n  abstract clear(): void;\n  abstract toDataURL(): string;\n  abstract setSize(size?: Dimensions | null): Dimensions;\n  abstract setBackground(color: ColorValue): void;\n  abstract showInstructions(): void;\n  abstract hideInstructions(): void;\n\n  getSize(): Dimensions {\n    const { width, height } = this.parentElement.getBoundingClientRect();\n    return [width, height];\n  }\n\n  /**\n   * Returns the CSS pixel space dimensions of the renderer (as opposed to the device pixels, which uses device pixel ratio)\n   * @returns\n   */\n  getLogicalSize(): Dimensions {\n    return this.getSize();\n  }\n\n  setStartingPoint(coordinates: Coordinates) {\n    this.lastStringCoordinates = coordinates;\n  }\n\n  startLayer(options: LayerOptions) {\n    this.currentLayerOptions = options;\n    if (options.color) {\n      this.setColor(options.color);\n    }\n  }\n\n  endLayer() {\n    this.currentLayerOptions = null;\n  }\n\n  /**\n   * Sets a fixed size for the renderer, which doesn't get updates on resize changes\n   * A fixed size can be cancelled with `resetSize` or setSize(null).\n   */\n  setFixedSize(size: Dimensions): void {\n    // First setting to null because the `setSize` method won't override an existing fixedSize\n    this.fixedSize = null;\n    this.setSize(size);\n    this.fixedSize = size;\n  }\n\n  enablePixelRatio() {\n    const dpr = window.devicePixelRatio || 1;\n    this.pixelRatio = dpr;\n\n    if (this.options.updateOnResize !== false) {\n      const updatePixelRatio = () => {\n        this.#removeDevicePixelListener?.();\n        const mqString = `(resolution: ${dpr}dppx)`;\n        const media = matchMedia(mqString);\n        media.addEventListener('change', updatePixelRatio);\n        this.#removeDevicePixelListener = () => {\n          media.removeEventListener('change', updatePixelRatio);\n        };\n\n        this.pixelRatio = window.devicePixelRatio;\n        this.emit('devicePixelRatioChange', {\n          devicePixelRatio: this.pixelRatio,\n        });\n      };\n\n      updatePixelRatio();\n    }\n  }\n\n  disablePixelRatio() {\n    this.pixelRatio = 1;\n    this.#removeDevicePixelListener?.();\n  }\n\n  renderInstructionsForLastLine(): void {\n    this.renderInstructions(...this.lastLine);\n  }\n}\n","import { Coordinates } from '../types/general.types';\n\n/**\n * Returns the greatest common divisor of two integers\n * https://en.wikipedia.org/wiki/Euclidean_algorithm\n * @param {number} int1\n * @param {number} int2\n * @returns number\n */\nexport function gcd(int1: number, int2: number): number {\n  if (!int2) return int1;\n\n  return gcd(int2, int1 % int2);\n}\n\nexport const PI2 = Math.PI * 2;\n\nexport function distortionToAspectRatio(distortion: number): [number, number] {\n  return distortion < 0\n    ? [1 - Math.abs(distortion), 1]\n    : [1 / (1 - distortion), 1];\n}\n\nexport function getDistanceBetweenCoordinates(\n  from: Coordinates,\n  to: Coordinates\n): number {\n  return Math.hypot(to[0] - from[0], to[1] - from[1]);\n}\n\nexport function roundNumber(v: number, decimalPoints: number): number {\n  const pow10 = Math.pow(10, decimalPoints);\n  return Math.round(v * pow10) / pow10;\n}\n\nconst SMALLEST_DISTANCE = Math.pow(10, -8);\n/**\n * Returns the shortest distance between any two points, that isn't 0\n * @param points\n * @returns\n */\nexport function getClosestDistance(points: Coordinates[]): number {\n  if (points.length < 2) return Infinity;\n\n  const ptsByX = [...points].sort((a, b) => a[0] - b[0]);\n  const ptsByY = [...points].sort((a, b) => a[1] - b[1]);\n\n  // If two points are closest than SMALLEST_DISTANCE, it's considered that they're on the same place and the same, the distance isn't used\n  const recurse = (px: Coordinates[], py: Coordinates[]): number => {\n    const n = px.length;\n    if (n <= 3) {\n      let min = Infinity;\n      for (let i = 0; i < n; i++) {\n        for (let j = i + 1; j < n; j++) {\n          const pointsDist = getDistanceBetweenCoordinates(px[i], px[j]);\n          if (pointsDist >= SMALLEST_DISTANCE) {\n            min = Math.min(min, pointsDist);\n          }\n        }\n      }\n      return min;\n    }\n\n    const mid = Math.floor(n / 2);\n    const midX = px[mid][0];\n    const leftX = px.slice(0, mid);\n    const rightX = px.slice(mid);\n\n    const leftY: Coordinates[] = [];\n    const rightY: Coordinates[] = [];\n    for (const p of py) {\n      (p[0] <= midX ? leftY : rightY).push(p);\n    }\n\n    const dLeft = recurse(leftX, leftY);\n    const dRight = recurse(rightX, rightY);\n    let d = Math.min(dLeft, dRight);\n\n    // Build strip around mid line\n    const strip = py.filter(p => Math.abs(p[0] - midX) < d);\n\n    // Check up to 7 points ahead for each in strip\n    for (let i = 0; i < strip.length; i++) {\n      for (\n        let j = i + 1;\n        j < strip.length && strip[j][1] - strip[i][1] < d;\n        j++\n      ) {\n        const stripDist = getDistanceBetweenCoordinates(strip[i], strip[j]);\n        if (stripDist >= SMALLEST_DISTANCE) {\n          d = Math.min(d, stripDist);\n        }\n      }\n    }\n\n    return d;\n  };\n\n  return recurse(ptsByX, ptsByY);\n}\n","import {\n  BoundingRect,\n  Coordinates,\n  Dimensions,\n  MetricLengthUnits,\n  SizeUnit,\n} from '../types/general.types';\nimport { roundNumber } from './math_utils';\n\nexport interface StandardSize {\n  id: string;\n  name?: string;\n  dimensions: Dimensions;\n}\n\nconst INCH_TO_CM = 2.54;\n\nObject.defineProperty(Number.prototype, 'toFixedPrecision', {\n  value: function (this: number, fractionDigits: number): number {\n    const factor = Math.pow(10, fractionDigits);\n    return Math.round(this * factor) / factor;\n  },\n  writable: true,\n  configurable: true,\n  enumerable: false, // Recommended for prototype extensions\n});\n\nexport function areDimensionsEqual(d1: Dimensions, d2: Dimensions): boolean {\n  return d1[0] === d2[0] && d1[1] === d2[1];\n}\n\nexport function cmToPixels(cm: number, dpi = 300): number {\n  return Math.floor((cm / INCH_TO_CM) * dpi);\n}\n\nexport function cmToInch(cm: number): number {\n  return cm / INCH_TO_CM;\n}\n\nexport function inchToPixel(inch: number, dpi: number): number {\n  return inch * dpi;\n}\n\nexport function cmToPixel(cm: number, dpi: number): number {\n  return inchToPixel(cmToInch(cm), dpi);\n}\n\nexport function inchToCm(inch: number): number {\n  return inch * INCH_TO_CM;\n}\n\nexport function pixelsToInch(pixels: number, dpi: number): number {\n  return pixels / dpi;\n}\n\nexport function pixelsToCm(pixels: number, dpi: number): number {\n  return inchToCm(pixelsToInch(pixels, dpi));\n}\n\nexport function cmDimensionsToInch(dimensions: Dimensions): Dimensions {\n  return dimensions.map(cmToInch) as Dimensions;\n}\n\nexport function inchDimensionsToCm(dimensions: Dimensions): Dimensions {\n  return dimensions.map(inchToCm) as Dimensions;\n}\n\nconst LENGTH_UNITS: ReadonlySet<string> = new Set(['cm', 'inch']);\n\nexport function mapDimensions(\n  dimensions: Dimensions,\n  mapper: (dimension: number, index?: number) => number\n): Dimensions {\n  return dimensions.map(mapper) as Dimensions;\n}\n\nexport function lengthConvert(\n  value: number,\n  from: SizeUnit,\n  to: SizeUnit,\n  dpi?: number\n): number {\n  if (from === to) {\n    return value;\n  }\n\n  if (LENGTH_UNITS.has(from) !== LENGTH_UNITS.has(to) && !dpi) {\n    throw new Error(`Can't convert from ${from} to ${to} without DPI!`);\n  }\n\n  switch (from) {\n    case 'cm':\n      switch (to) {\n        case 'inch':\n          return cmToInch(value);\n        case 'px':\n          return cmToPixel(value, dpi);\n      }\n    case 'inch':\n      switch (to) {\n        case 'cm':\n          return inchToCm(value);\n        case 'px':\n          return inchToPixel(value, dpi);\n      }\n    case 'px':\n      switch (to) {\n        case 'cm':\n          return pixelsToCm(value, dpi);\n        case 'inch':\n          return pixelsToInch(value, dpi);\n      }\n  }\n}\n\nexport function sizeConvert(\n  dimensions: Dimensions,\n  from: SizeUnit,\n  to: SizeUnit,\n  dpi?: number\n): Dimensions {\n  return mapDimensions(dimensions, v => lengthConvert(v, from, to, dpi));\n}\n\nexport const STANDARD_SIZES_CM: ReadonlyArray<StandardSize> = [\n  {\n    id: 'A4',\n    dimensions: [21, 29.7],\n  },\n  {\n    id: 'A3',\n    dimensions: [29.7, 42],\n  },\n  {\n    id: 'A2',\n    dimensions: [42, 59.4],\n  },\n  {\n    id: 'A1',\n    dimensions: [59.4, 84.1],\n  },\n];\n\n/**\n *\n * @param boundingRects Given multiple BoundingRects, returns a single BoundingRect that is like one ret bounding all rects\n */\nexport function combineBoundingRects(\n  ...boundingRects: BoundingRect[]\n): BoundingRect {\n  return boundingRects.reduce(\n    (box: BoundingRect, boundingRect: BoundingRect) => {\n      const newBox = {\n        ...box,\n        left: !box.left\n          ? boundingRect.left\n          : Math.min(box.left, boundingRect.left),\n        right: !box.right\n          ? boundingRect.right\n          : Math.max(box.right, boundingRect.right),\n        top: !box.top ? boundingRect.top : Math.min(box.top, boundingRect.top),\n        bottom: !boundingRect.bottom\n          ? box.bottom\n          : Math.max(box.bottom, boundingRect.bottom),\n      };\n\n      Object.assign(newBox, {\n        width: newBox.right - newBox.left,\n        height: newBox.bottom - newBox.top,\n      });\n\n      return newBox;\n    },\n    { left: 0, right: 0, top: 0, bottom: 0, width: 0, height: 0 }\n  );\n}\n\nexport function getBoundingRectForCoordinates(\n  coordinates: ReadonlyArray<Coordinates>\n): BoundingRect {\n  if (coordinates.length === 0) {\n    throw new Error(\"Can't get bounding rect, no coordinates specified.\");\n  }\n\n  if (coordinates.length === 1) {\n    return {\n      top: coordinates[0][1],\n      bottom: coordinates[0][1],\n      left: coordinates[0][0],\n      right: coordinates[0][0],\n      width: 0,\n      height: 0,\n    };\n  }\n  const sides = coordinates.reduce(\n    (box, point) => ({\n      top: Math.min(box.top, point[1]),\n      bottom: Math.max(box.bottom, point[1]),\n      left: Math.min(box.left, point[0]),\n      right: Math.max(box.right, point[0]),\n    }),\n    {\n      top: Infinity,\n      left: Infinity,\n      bottom: -Infinity,\n      right: -Infinity,\n    }\n  );\n\n  return {\n    ...sides,\n    width: sides.right - sides.left,\n    height: sides.bottom - sides.top,\n  };\n}\n\nexport function getBoundingRectAspectRatio(boundingRect: BoundingRect): number {\n  return boundingRect.width / boundingRect.height;\n}\n\n/**\n * Fits the first size inside size2\n * @param {[number, number]} size1\n * @param {[number, number]} size2\n */\nexport function fitInside(size1: Dimensions, size2: Dimensions): Dimensions {\n  const ratio = Math.min(size2[0] / size1[0], size2[1] / size1[1]);\n  return mapDimensions(size1, v => v * ratio);\n}\n\n/**\n * Returns the center coordinates of a plane, given its dimensions\n * @param size\n * @returns\n */\nexport function getCenter(size: Dimensions): Coordinates {\n  return mapDimensions(size, v => v / 2);\n}\n\nconst METRIC_UNITS = {\n  m: 1,\n  cm: 0.01,\n  mm: 0.001,\n};\n\nexport function prettifyLength(\n  length: number,\n  sourceUnits: MetricLengthUnits,\n  decimalPoints = 1\n): string {\n  const meters = length * METRIC_UNITS[sourceUnits];\n\n  if (meters >= 1) {\n    return roundNumber(meters, decimalPoints).toLocaleString() + ' m';\n  } else if (meters < 0.01) {\n    return roundNumber(meters * 1000, decimalPoints).toLocaleString() + ' mm';\n  } else {\n    return roundNumber(meters * 100, decimalPoints).toLocaleString() + ' cm';\n  }\n}\n","import EventBus from './helpers/EventBus';\nimport patternTypes from './pattern_types';\nimport StringArt, { Pattern } from './infra/StringArt';\nimport { AppData, PatternData } from './types/persistance.types';\nimport type InputDialog from './components/dialogs/InputDialog';\nimport { confirm, prompt } from './helpers/dialogs';\nimport { getQueryParams } from './helpers/url_utils';\nimport { ID } from './types/stringart.types';\nimport { DownloadPatternOptions } from './download/Download';\nimport { createPatternInstance } from './helpers/pattern_utils';\n\nconst APP_DATA_STORAGE_KEY = 'string_art_app_data';\n\nexport default class Persistance extends EventBus<{\n  newPattern: { pattern: StringArt<any> };\n  deletePattern: { pattern: StringArt<any> };\n  save: { pattern: StringArt<any> };\n}> {\n  elements: {\n    saveDialog: InputDialog;\n  };\n\n  currentPattern: StringArt<any>;\n\n  constructor() {\n    super();\n\n    this.elements = {\n      saveDialog: document.querySelector('#save_dialog'),\n    };\n\n    document.querySelector('#pattern_menu').addEventListener('select', e => {\n      // @ts-ignore\n      switch (e.detail.value) {\n        case 'save_as':\n          this.#showSaveAsDialog();\n          break;\n        case 'delete':\n          this.deletePattern();\n          break;\n        case 'save':\n          this.saveCurrentPattern();\n          break;\n        case 'rename':\n          this.renameCurrentPattern();\n          break;\n      }\n    });\n\n    document.querySelector('#save_btn').addEventListener('click', () => {\n      if (this.currentPattern.isTemplate) {\n        this.#showSaveAsDialog();\n      } else {\n        this.saveCurrentPattern();\n      }\n    });\n  }\n\n  #showSaveAsDialog() {\n    const nextId = this.#getNextAvailableId();\n    const defaultName = getQueryParams().name ?? `Pattern #${nextId}`;\n\n    prompt({\n      title: 'Save pattern',\n      description: 'Name this pattern:',\n      submit: 'Save',\n      value: defaultName,\n    }).then(\n      patternName => {\n        this.saveNewPattern({\n          type: this.currentPattern.type,\n          config: this.currentPattern.config,\n          name:\n            patternName == null || patternName === ''\n              ? defaultName\n              : patternName,\n        });\n      },\n      () => {}\n    );\n  }\n\n  setPattern(pattern: StringArt<any>) {\n    this.currentPattern = pattern;\n  }\n\n  static patternDataToStringArt({\n    type,\n    ...patternData\n  }: PatternData): StringArt<any> {\n    const pattern = createPatternInstance(type);\n    Object.assign(pattern, patternData);\n    pattern.markConfigAsDefault();\n\n    return pattern;\n  }\n\n  static getSavedPatterns(): StringArt<any>[] {\n    const { patterns } = this.loadAppData();\n    return patterns.map(this.patternDataToStringArt);\n  }\n\n  static getPatternByID(patternId: string): StringArt<any> | null {\n    const patternData = this.loadPatternDataById(patternId);\n    return patternData ? this.patternDataToStringArt(patternData) : null;\n  }\n\n  static loadPatternDataById(patternId: string): PatternData | null {\n    const { patterns } = this.loadAppData();\n    return patterns.find(({ id }) => id === patternId);\n  }\n\n  #getNextAvailableId(): string {\n    const appData = Persistance.loadAppData();\n    const lastId = appData?.patterns?.length\n      ? Number(appData.patterns[appData.patterns.length - 1].id)\n      : 0;\n    const nextId = isNaN(lastId) ? 1 : lastId + 1;\n    return String(nextId);\n  }\n\n  saveNewPattern(patternData: Omit<PatternData, 'id'>): PatternData {\n    const appData = Persistance.loadAppData();\n    const nextId = this.#getNextAvailableId();\n\n    const newPatternData: PatternData = {\n      ...patternData,\n      id: nextId,\n    };\n\n    appData.patterns.push(newPatternData);\n    Persistance.saveAppData(appData);\n\n    this.emit('newPattern', {\n      pattern: Persistance.patternDataToStringArt(newPatternData),\n    });\n\n    return newPatternData;\n  }\n\n  savePattern(patternData: PatternData) {\n    const appData = Persistance.loadAppData();\n\n    const patternIndex = appData.patterns.findIndex(\n      ({ id }) => id === this.currentPattern.id\n    );\n    if (patternIndex !== -1) {\n      appData.patterns[patternIndex] = patternData;\n      Persistance.saveAppData(appData);\n\n      this.emit('save', {\n        pattern: Persistance.patternDataToStringArt(patternData),\n      });\n    }\n  }\n\n  saveCurrentPattern() {\n    const newPatternData: PatternData = {\n      id: this.currentPattern.id,\n      name: this.currentPattern.name,\n      type: this.currentPattern.type,\n      config: this.currentPattern.config,\n    };\n\n    this.savePattern(newPatternData);\n    return newPatternData;\n  }\n\n  renameCurrentPattern() {\n    prompt({\n      title: 'Rename',\n      description: 'Name this pattern:',\n      submit: 'Save',\n      value: this.currentPattern.name,\n    }).then(newPatternName => {\n      if (newPatternName !== this.currentPattern.name) {\n        const patternData = Persistance.loadPatternDataById(\n          this.currentPattern.id\n        );\n        patternData.name = newPatternName;\n        this.savePattern(patternData);\n      }\n\n      this.currentPattern.name = newPatternName;\n    });\n  }\n\n  deletePattern() {\n    confirm({\n      title: 'Delete pattern',\n      description: 'Are you sure you wish to delete this pattern?',\n      submit: 'Delete',\n      type: 'error',\n    }).then(\n      () => {\n        const appData = Persistance.loadAppData();\n        const patternIndex = appData.patterns.findIndex(\n          ({ id }) => id === this.currentPattern.id\n        );\n        if (patternIndex === -1) {\n          throw new Error(\n            `Can't delete pattern with ID \"${this.currentPattern.id}\", it's not found!`\n          );\n        }\n\n        const patternData = appData.patterns.splice(patternIndex, 1)[0];\n        Persistance.saveAppData(appData);\n\n        const pattern = Persistance.patternDataToStringArt(patternData);\n        pattern.resetDefaultConfig();\n\n        this.emit('deletePattern', {\n          pattern,\n        });\n      },\n      () => {}\n    );\n  }\n\n  static savePatternDownloadData(patternId: ID, data: DownloadPatternOptions) {\n    const appData = Persistance.loadAppData();\n    if (!appData.downloadData) {\n      appData.downloadData = {};\n    }\n    appData.downloadData[patternId] = data;\n    this.saveAppData(appData);\n  }\n\n  static getPatternDownloadData(patternId: ID): DownloadPatternOptions | null {\n    const appData = Persistance.loadAppData();\n    return appData.downloadData?.[patternId];\n  }\n\n  static loadAppData(): AppData {\n    const rawData = localStorage.getItem(APP_DATA_STORAGE_KEY);\n    try {\n      return rawData ? JSON.parse(rawData) : { patterns: [], downloadData: {} };\n    } catch (error) {\n      throw new Error(\n        'App data is corrupted, failed to load it. ' + error.message\n      );\n    }\n  }\n\n  static saveAppData(appData: AppData): void {\n    localStorage.setItem(APP_DATA_STORAGE_KEY, JSON.stringify(appData));\n  }\n}\n","import type InputDialog from '../components/dialogs/InputDialog';\nimport type ConfirmDialog from '../components/dialogs/ConfirmDialog';\nimport type { ConfirmDialogType } from '../components/dialogs/ConfirmDialog';\n\nexport interface ConfirmOptions {\n  title: string;\n  description?: string;\n  submit?: string;\n  submitIcon?: string;\n  cancel?: string;\n  type?: ConfirmDialogType;\n}\nexport type PromptOptions = ConfirmOptions & {\n  value?: string;\n};\n\nconst promptDialogId = 'prompt_dialog';\nexport function prompt({ value, ...options }: PromptOptions): Promise<string> {\n  let dialog: InputDialog = document.querySelector(`#${promptDialogId}`);\n  if (!dialog) {\n    dialog = document.createElement('input-dialog') as InputDialog;\n    dialog.id = promptDialogId;\n    document.body.appendChild(dialog);\n  }\n\n  ['title', 'description', 'submit', 'cancel', 'type', 'submitIcon'].forEach(\n    attr => {\n      if (options[attr] != null && options[attr] !== '') {\n        dialog.setAttribute(getAttributeForProp(attr), options[attr]);\n      } else {\n        dialog.removeAttribute(attr);\n      }\n    }\n  );\n\n  return dialog.show(value);\n\n  function getAttributeForProp(prop: string): string {\n    switch (prop) {\n      case 'title':\n        return 'dialog-title';\n      case 'submitIcon':\n        return 'submit-icon';\n      default:\n        return prop;\n    }\n  }\n}\n\nconst CONFIRM_DIALOG_ID = 'confirm_dialog';\n\nexport function confirm(options: ConfirmOptions): Promise<void> {\n  let dialog: ConfirmDialog = document.querySelector(`#${CONFIRM_DIALOG_ID}`);\n  if (!dialog) {\n    dialog = document.createElement('confirm-dialog') as ConfirmDialog;\n    dialog.id = CONFIRM_DIALOG_ID;\n    document.body.appendChild(dialog);\n  }\n\n  ['title', 'description', 'submit', 'cancel', 'type'].forEach(attr => {\n    if (options[attr] != null && options[attr] !== '') {\n      dialog.setAttribute(\n        attr === 'title' ? 'dialog-title' : attr,\n        options[attr]\n      );\n    } else {\n      dialog.removeAttribute(attr);\n    }\n  });\n\n  return dialog.show();\n}\n","import { serializeConfig } from '../Serialize';\nimport type StringArt from '../infra/StringArt';\nimport { RendererType } from '../types/stringart.types';\n\nexport function getPatternURL(\n  pattern: StringArt<any>,\n  {\n    renderer,\n    patternAsTemplate = false,\n  }: {\n    renderer?: RendererType;\n    patternAsTemplate?: boolean;\n  } = {}\n): string {\n  const configQuery = pattern.isDefaultConfig\n    ? undefined\n    : serializeConfig(pattern);\n\n  return `?pattern=${!patternAsTemplate ? pattern.id : pattern.type}${\n    configQuery ? `&config=${encodeURIComponent(configQuery)}` : ''\n  }${renderer === 'svg' ? '&renderer=svg' : ''}`;\n}\n\nexport interface StringArtQueryParams {\n  pattern?: string;\n  config?: string;\n  name?: string;\n  renderer?: RendererType;\n}\n\nexport function getQueryParams(): StringArtQueryParams {\n  const queryParams = new URLSearchParams(document.location.search);\n  return {\n    pattern: queryParams.get('pattern'),\n    config: queryParams.get('config'),\n    name: queryParams.get('name'),\n    renderer: queryParams.get('renderer') === 'svg' ? 'svg' : null,\n  };\n}\n","import StringArt from './infra/StringArt';\n\nconst MAX_FLOAT_DECIMALS = 6;\n\nexport function serializeConfig(pattern: StringArt<any>): string {\n  const { defaultConfig, config } = pattern;\n\n  const nonDefaultConfigValues = Object.entries(config).map(([key, value]) => {\n    if (value === defaultConfig[key]) {\n      return null;\n    }\n\n    if (typeof value === 'boolean') {\n      return `!${value ? 1 : 0}`;\n    }\n\n    if (typeof value === 'number') {\n      return parseFloat(value.toFixed(MAX_FLOAT_DECIMALS));\n    }\n\n    return value;\n  });\n\n  while (nonDefaultConfigValues[nonDefaultConfigValues.length - 1] === null) {\n    nonDefaultConfigValues.pop();\n  }\n\n  if (!nonDefaultConfigValues.length) {\n    return '';\n  }\n\n  const serializedConfigValues = nonDefaultConfigValues\n    .join('_')\n    .replace(/\\_{2,}/g, match => '~' + match.length + '_');\n  return serializedConfigValues;\n}\n\nconst numberRegExp = /^\\-?\\d+(\\.\\d+)?$/;\nconst booleanRegExp = /^(?:!)([01])$/;\n\nexport function deserializeConfig<TConfig>(\n  pattern: StringArt<TConfig>,\n  serializedCofig: string\n): TConfig {\n  const serializedConfigValues = serializedCofig\n    .replace(/(?:~)(\\d+)(?:_)/g, (_, commaCount) =>\n      new Array(+commaCount).fill('_').join('')\n    )\n    .split('_')\n    .map(v => {\n      if (v === '') {\n        return null;\n      }\n\n      if (numberRegExp.test(v)) {\n        return parseFloat(v);\n      }\n\n      const booleanMatch = v.match(booleanRegExp);\n      if (booleanMatch) {\n        return booleanMatch[1] === '1';\n      }\n\n      return v;\n    });\n\n  const configKeys = Object.keys(pattern.defaultConfig);\n\n  return serializedConfigValues.reduce((config, serializedValue, i) => {\n    if (serializedValue !== null) {\n      const key = configKeys[i];\n      return { ...config, [key]: serializedValue };\n    }\n\n    return config;\n  }, {} as TConfig);\n}\n","import patternTypes from '../pattern_types';\nimport Persistance from '../Persistance';\nimport StringArt from '../infra/StringArt';\n\nexport function createPatternInstance(type: string): StringArt {\n  let Pattern = patternTypes.find(({ type: _type }) => _type === type);\n  if (!Pattern) {\n    throw new Error(`Unknown pattern type, \"${type}\"!`);\n  }\n\n  // @ts-ignore\n  return new Pattern();\n}\n\n/**\n *\n * @returns Returns an instance of each pattern type, with default configs\n */\nexport function getAllPatternsTypes(): StringArt[] {\n  // @ts-ignore\n  const patterns: StringArt[] = patternTypes.map(\n    PatternType => new PatternType()\n  );\n  return patterns;\n}\n\n/**\n * Finds a pattern with the given ID, can be a template or a saved pattern\n */\nexport function findPatternById(patternId: string): StringArt | null {\n  let pattern = patternTypes.find(({ type }) => type === patternId);\n\n  if (pattern) {\n    // @ts-ignore\n    return new pattern();\n  } else {\n    return Persistance.getPatternByID(patternId);\n  }\n}\n","import Spiral from './string_art_types/Spiral';\nimport Spirals from './string_art_types/Spirals';\nimport Wave from './string_art_types/Wave';\nimport Eye from './string_art_types/Eye';\nimport Mandala from './string_art_types/Mandala';\nimport Star from './string_art_types/Star';\nimport Assymetry from './string_art_types/Assymetry';\nimport Freestyle from './string_art_types/Freestyle';\nimport PolygonPattern from './string_art_types/PolygonPattern';\nimport Flower from './string_art_types/Flower';\nimport MaurerRose from './string_art_types/MaurerRose';\nimport FlowerOfLife from './string_art_types/FlowerOfLife';\nimport Comet from './string_art_types/Comet';\nimport Sun from './string_art_types/Sun';\nimport Lotus from './string_art_types/Lotus';\nimport DanceOfPlanets from './string_art_types/DanceOfPlanets';\nimport Crosses from './string_art_types/Crosses';\n\nconst patternTypes = [\n  Star,\n  Assymetry,\n  Mandala,\n  Spiral,\n  Spirals,\n  Wave,\n  Eye,\n  Freestyle,\n  PolygonPattern,\n  Flower,\n  MaurerRose,\n  FlowerOfLife,\n  Comet,\n  Sun,\n  Lotus,\n  DanceOfPlanets,\n  Crosses,\n];\n\nexport default patternTypes;\n","import Color from '../helpers/color/Color';\nimport StringArt from '../infra/StringArt';\nimport Circle from '../shapes/Circle';\nimport { ControlsConfig } from '../types/config.types';\nimport {\n  ColorConfig,\n  ColorMap,\n  ColorValue,\n} from '../helpers/color/color.types';\nimport Renderer from '../infra/renderers/Renderer';\nimport { CalcOptions } from '../types/stringart.types';\nimport { withoutAttribute } from '../helpers/config_utils';\nimport INails from '../infra/nails/INails';\n\nconst COLOR_CONFIG = Color.getConfig({\n  defaults: {\n    isMultiColor: true,\n    colorCount: 7,\n    color: '#ffbb29',\n    multicolorRange: 21,\n    multicolorStart: 32,\n    multicolorByLightness: true,\n    minLightness: 36,\n    maxLightness: 98,\n  },\n});\n\ninterface SpiralConfig extends ColorConfig {\n  n: number;\n  repetition: number;\n  innerLength: number;\n  rotation: number;\n  distortion: number;\n}\n\ntype TCalc = {\n  circle: Circle;\n  realRepetition: number;\n};\n\nexport default class Spiral extends StringArt<SpiralConfig, TCalc> {\n  static type = 'spiral';\n\n  id = 'spiral';\n  name = 'Spiral';\n  link =\n    'https://www.etsy.com/il-en/listing/840974781/boho-wall-decor-artwork-spiral-round';\n  controls: ControlsConfig<SpiralConfig> = [\n    {\n      ...Circle.nailsConfig,\n      defaultValue: 200,\n    },\n    {\n      key: 'repetition',\n      label: 'Repetition',\n      defaultValue: 5,\n      type: 'range',\n      attr: { min: 1, max: 20, step: 1 },\n      affectsNails: false,\n      isStructural: true,\n    },\n    {\n      key: 'innerLength',\n      label: 'Spiral thickness',\n      defaultValue: 0.5,\n      type: 'range',\n      attr: {\n        min: ({ n }) => 1 / n,\n        max: 1,\n        step: ({ n }) => 1 / n,\n      },\n      displayValue: ({ n, innerLength }) => Math.round(n * innerLength),\n      affectsNails: false,\n    },\n    {\n      ...withoutAttribute(Circle.rotationConfig, 'snap'),\n      defaultValue: 0.75,\n    },\n    Circle.distortionConfig,\n    COLOR_CONFIG,\n  ];\n\n  #color: Color;\n  #colorMap: ColorMap;\n\n  getCalc({ size }: CalcOptions): TCalc {\n    const { n, rotation, margin, repetition, distortion } = this.config;\n\n    const circleConfig = {\n      size,\n      n,\n      margin,\n      rotation,\n      distortion,\n    };\n\n    return {\n      circle: new Circle(circleConfig),\n      realRepetition: repetition * 2 - 1,\n    };\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n    const { colorCount } = this.config;\n\n    this.#color = new Color({\n      ...this.config,\n      colorCount: colorCount,\n    });\n\n    if (colorCount) {\n      this.#colorMap = this.#color.getColorMap({\n        stepCount: this.getStepCount(),\n        colorCount,\n      });\n    }\n  }\n\n  getAspectRatio(options: CalcOptions): number {\n    const { circle } = this.getCalc(options);\n    return circle.getAspectRatio();\n  }\n\n  *drawSpiral(\n    renderer: Renderer,\n    {\n      shift = 0,\n      color = '#ffffff',\n    }: { shift?: number; color?: ColorValue } = {}\n  ): Generator<void> {\n    const { innerLength, n } = this.config;\n\n    let currentInnerLength = Math.round(innerLength * n);\n    let repetitionCount = 0;\n    renderer.setColor(color);\n    let prevPointIndex = shift;\n    let prevPoint = this.calc.circle.getPoint(prevPointIndex);\n    let isPrevPoint = false;\n\n    for (let i = 0; currentInnerLength > 0; i++) {\n      if (this.#colorMap) {\n        const stepColor = this.#colorMap.get(i);\n        if (stepColor) {\n          renderer.setColor(stepColor);\n        }\n      }\n\n      prevPointIndex = isPrevPoint\n        ? prevPointIndex - currentInnerLength + 1\n        : prevPointIndex + currentInnerLength;\n\n      if (repetitionCount === this.calc.realRepetition) {\n        currentInnerLength--;\n        repetitionCount = 0;\n        prevPointIndex++;\n      } else {\n        repetitionCount++;\n      }\n\n      const nextPoint = this.calc.circle.getPoint(prevPointIndex);\n\n      renderer.renderLine(prevPoint, nextPoint);\n      prevPoint = nextPoint;\n\n      yield;\n      isPrevPoint = !isPrevPoint;\n    }\n  }\n\n  *drawStrings(renderer: Renderer): Generator<void> {\n    yield* this.drawSpiral(renderer, {\n      color: this.#color.getColor(0),\n    });\n  }\n\n  getStepCount(): number {\n    const { innerLength, repetition, n } = this.config;\n    return Math.round(n * (innerLength * 2) * repetition);\n  }\n\n  drawNails(nails: INails) {\n    this.calc.circle.drawNails(nails);\n  }\n\n  thumbnailConfig = ({ n }) => ({\n    n: Math.min(n, 60),\n  });\n}\n","import { ControlConfig, ControlsConfig } from '../../types/config.types';\nimport { copyConfig, mapControls } from '../config_utils';\nimport { ColorConfig, ColorMap, ColorValue } from './color.types';\nimport COLOR_CONTROLS from './color_controls';\n\nexport default class Color {\n  config: ColorConfig;\n  multiColorStep: number;\n  multiColorLightnessStep: number;\n  colors: Array<ColorValue>;\n\n  constructor(config: ColorConfig) {\n    this.config = config;\n\n    const {\n      multicolorRange,\n      colorCount,\n      multicolorByLightness,\n      minLightness = 0,\n      maxLightness = 100,\n      multicolorStart,\n      darkMode,\n      saturation,\n      reverseColors,\n      repeatColors,\n      mirrorColors,\n      isMultiColor,\n    } = config;\n\n    if (isMultiColor) {\n      this.multiColorStep = multicolorRange / Math.max(1, colorCount - 1);\n      this.multiColorLightnessStep = multicolorByLightness\n        ? (maxLightness - minLightness) / (Math.max(colorCount, 2) - 1)\n        : 1;\n\n      this.colors = new Array(colorCount).fill(null).map((_, colorIndex) => {\n        const lightness = multicolorByLightness\n          ? minLightness + this.multiColorLightnessStep * colorIndex\n          : darkMode\n          ? 50\n          : 40;\n        return `hsl(${\n          multicolorStart + colorIndex * this.multiColorStep\n        }, ${saturation}%, ${lightness}%)`;\n      });\n\n      if (repeatColors && mirrorColors) {\n        const [_firstColor, ...restColors] = this.colors;\n        restColors.pop();\n        this.colors = [...this.colors, ...restColors.reverse()];\n      }\n\n      if (reverseColors) {\n        this.colors.reverse();\n      }\n    }\n  }\n\n  /**\n   * Returns the color to be used in the provided layer index. If no multiColor is used, will use the 'color' config property.\n   * @param {number} colorIndex\n   * @returns string\n   */\n  getColor(colorIndex: number): ColorValue {\n    const { isMultiColor, colorCount, color, repeatColors } = this.config;\n\n    if (!isMultiColor) {\n      return color;\n    }\n\n    if (colorIndex >= colorCount) {\n      colorIndex = repeatColors\n        ? colorIndex % this.colors.length\n        : this.colors.length - 1;\n    }\n\n    return this.colors[colorIndex];\n  }\n\n  /**\n   * Returns the color with the opposite hue to the color at this index\n   */\n  static getOppositeColor(hslColor: ColorValue): ColorValue {\n    const hslMatch = hslColor.match(\n      /^hsl\\((\\d+)(?:deg)?(?:,?\\s?)(\\d+%?)(?:,?\\s?)(\\d+%?)\\)$/\n    );\n    if (hslMatch) {\n      const oppositeHue = (Number(hslMatch[1]) + 180) % 360;\n      return `hsl(${oppositeHue}, ${hslMatch[2]}, ${hslMatch[3]})`;\n    }\n\n    return null;\n  }\n\n  getColorMap({\n    stepCount,\n    colorCount,\n  }: {\n    stepCount: number;\n    colorCount: number;\n  }): ColorMap {\n    if (!colorCount) {\n      throw new Error(\"Can't get color map, no colorCount provided!\");\n    }\n    const stepsPerColor = Math.floor(stepCount / colorCount);\n    const colorMap = new Map();\n    for (let i = 0; i < colorCount; i++) {\n      colorMap.set(i * stepsPerColor, this.getColor(i));\n    }\n    return colorMap;\n  }\n\n  static getConfig<TCustomConfig = {}>({\n    include,\n    exclude,\n    defaults = {},\n    customControls,\n    propMapper,\n    groupLabel,\n    maxColorCount,\n  }: Partial<{\n    include: Array<keyof ColorConfig>;\n    exclude: Array<keyof ColorConfig>;\n    defaults: Partial<ColorConfig>;\n    customControls: ControlsConfig<TCustomConfig>;\n    propMapper: (\n      control: ControlConfig<ColorConfig>\n    ) => Partial<ControlConfig<ColorConfig>>;\n    groupLabel: string;\n    maxColorCount: number;\n  }>): ControlConfig<ColorConfig & TCustomConfig> {\n    const controls = mapControls(getControls(), propMapper);\n\n    return {\n      key: 'colorGroup',\n      label: groupLabel ?? 'Color',\n      type: 'group',\n      children: [...(customControls ?? []), ...controls],\n    };\n\n    function getControls(\n      controlsConfig?: ControlsConfig<ColorConfig>\n    ): ControlsConfig<ColorConfig> {\n      return (controlsConfig ?? copyConfig(COLOR_CONTROLS))\n        .filter(\n          ({ key }) =>\n            (!exclude || !exclude.includes(key)) &&\n            (!include || include.includes(key))\n        )\n        .map(control => {\n          const finalControl = {\n            ...control,\n            defaultValue: defaults[control.key] ?? control.defaultValue,\n          };\n\n          if (control.type === 'group') {\n            finalControl.children = getControls(control.children);\n          }\n\n          if (control.key === 'colorCount' && maxColorCount) {\n            finalControl.attr.max = maxColorCount;\n          }\n\n          return Object.freeze(finalControl);\n        });\n    }\n  }\n}\n","import type {\n  Config,\n  ControlConfig,\n  ControlsConfig,\n} from '../types/config.types';\n\ninterface ControlConfigNode<T> {\n  control: ControlConfig<T>;\n  parent: ControlConfigNode<T> | null;\n  index: number;\n}\n\nexport function* traverseConfig<T>(\n  controlsConfig: ControlsConfig<T>,\n  parent?: ControlConfigNode<T>\n): Generator<{\n  control: ControlConfig<T>;\n  parent: ControlConfigNode<T> | null;\n  index: number;\n}> {\n  let index = 0;\n\n  for (const control of controlsConfig) {\n    yield { control, index, parent };\n    if (control.children) {\n      yield* traverseConfig(control.children, { control, parent, index });\n    }\n    index++;\n  }\n}\n\nfunction findControlConfigNode<T>(\n  controlsConfig: ControlsConfig<T>,\n  findFn: (control: ControlConfig<T>) => any\n): ControlConfigNode<T> | null {\n  for (const node of traverseConfig(controlsConfig)) {\n    if (findFn(node.control)) {\n      return node;\n    }\n  }\n\n  return null;\n}\n\nfunction getControlConfigNodeByKey<T>(\n  controlsConfig: ControlsConfig<T>,\n  controlKey: string\n): ControlConfigNode<T> | null {\n  return findControlConfigNode(controlsConfig, ({ key }) => key === controlKey);\n}\n\nexport function withoutAttribute<T>(\n  controlConfig: ControlConfig<T>,\n  attributeName: string\n): ControlConfig<T> {\n  const attr = controlConfig.attr;\n  if (!attr) {\n    return controlConfig;\n  }\n\n  const attrCopy = { ...attr };\n  delete attrCopy[attributeName];\n  return {\n    ...controlConfig,\n    attr: attrCopy,\n  };\n}\n\n/**\n * Deep copy of a ControlsConfig\n * @param controlsConfig\n * @returns\n */\nexport function copyConfig<T>(\n  controlsConfig: ControlsConfig<T>\n): ControlsConfig<T> {\n  return controlsConfig.map(control => {\n    const copy = { ...control };\n    if (control.children) {\n      copy.children = copyConfig(control.children);\n    }\n    if (control.attr) {\n      copy.attr = { ...control.attr };\n    }\n\n    return copy;\n  });\n}\n\n/**\n * Gets the index path to a node with the given key. The path includes the index of controls in the 'children' prop of a group.\n * @returns\n */\nexport function getControlPath(\n  controlsConfig: ControlsConfig,\n  controlKey: string\n): Array<number> {\n  const controlNode = getControlConfigNodeByKey(controlsConfig, controlKey);\n  if (controlNode) {\n    const path = [controlNode.index];\n    let parentNode = controlNode.parent;\n    while (parentNode) {\n      path.unshift(parentNode.index);\n      parentNode = parentNode.parent;\n    }\n    return path;\n  }\n\n  return null;\n}\n\n// If the key to add after is found, returns a copy of the controls config (all the tree) with the added config\nexport function insertAfter<T>(\n  controlsConfig: ControlsConfig<T>,\n  insertAfterKey: string,\n  controlsConfigToInsert: ControlsConfig<T>\n) {\n  const configCopy = copyConfig(controlsConfig);\n  const nodeToAddAfter = getControlConfigNodeByKey(configCopy, insertAfterKey);\n\n  if (nodeToAddAfter) {\n    const { index, parent } = nodeToAddAfter;\n    let list = parent?.control.children ?? configCopy;\n    list.splice(index + 1, 0, ...controlsConfigToInsert);\n    return configCopy;\n  }\n\n  return controlsConfig;\n}\n\n/**\n * Maps the array of control configs to change properties using the mapper\n * @param {*} controlsConfig\n * @param {*} controlPropMapper\n * @returns\n */\nexport function mapControls<T>(\n  controlsConfig: ControlsConfig<T>,\n  controlPropMapper: (control: ControlConfig<T>) => Partial<ControlConfig<T>>\n): ControlsConfig<T> {\n  return controlPropMapper\n    ? controlsConfig.map(control => {\n        if (control.children) {\n          control = {\n            ...control,\n            children: mapControls(control.children, controlPropMapper),\n          };\n        }\n\n        return {\n          ...control,\n          ...controlPropMapper(control),\n        };\n      })\n    : controlsConfig;\n}\n\n/**\n * Returns config values for all controls\n * @param configControls\n * @returns\n */\nexport function getConfigDefaultValues<T>(\n  configControls: ControlsConfig<T>\n): Config<T> {\n  const defaultValues = {} as Config<T>;\n  for (const {\n    control: { key, defaultValue },\n  } of traverseConfig(configControls)) {\n    if (!(defaultValue instanceof Function)) {\n      // @ts-ignore\n      defaultValues[key] = defaultValue;\n    }\n  }\n\n  return defaultValues;\n}\n\n/**\n * Returns an object whose properties are the keys of all controls in the config, with corresponding controls as values.\n * @param configControls\n * @returns\n */\nexport function getControlsIndex<T>(\n  configControls: ControlsConfig<T>\n): Record<keyof T, ControlConfig<T>> {\n  const configIndex = {} as Record<keyof T, ControlConfig<T>>;\n  for (const { control } of traverseConfig(configControls)) {\n    configIndex[control.key] = control;\n  }\n\n  return configIndex;\n}\n","import { ControlsConfig } from '../../types/config.types';\nimport { ColorConfig } from './color.types';\n\nconst COLOR_CONTROLS: ControlsConfig<ColorConfig> = [\n  {\n    key: 'isMultiColor',\n    label: 'Use multiple colors',\n    defaultValue: false,\n    type: 'checkbox',\n    affectsNails: false,\n    affectsStepCount: false,\n  },\n  {\n    key: 'colorCount',\n    label: 'Colors count',\n    defaultValue: 7,\n    type: 'range',\n    attr: {\n      min: 1,\n      max: 20,\n      step: 1,\n    },\n    show: ({ isMultiColor }) => isMultiColor,\n    affectsNails: false,\n    affectsStepCount: false,\n  },\n  {\n    key: 'color',\n    label: 'String color',\n    defaultValue: '#ff4d00',\n    type: 'color',\n    show: ({ isMultiColor }) => !isMultiColor,\n    affectsNails: false,\n    affectsStepCount: false,\n  },\n  {\n    key: 'multicolorStart',\n    label: 'Multicolor start',\n    defaultValue: 1,\n    type: 'hue',\n    attr: {\n      colorthumb: true,\n    },\n    show: ({ isMultiColor }) => isMultiColor,\n    affectsNails: false,\n    affectsStepCount: false,\n  },\n  {\n    key: 'multicolorRange',\n    label: 'Multicolor range',\n    defaultValue: 360,\n    type: 'hue',\n    attr: {\n      start: ({ multicolorStart }) => multicolorStart,\n      type: 'range',\n    },\n    show: ({ isMultiColor }) => isMultiColor,\n    affectsNails: false,\n    affectsStepCount: false,\n  },\n  {\n    key: 'saturation',\n    label: 'Saturation',\n    defaultValue: 100,\n    type: 'range',\n    attr: {\n      min: 0,\n      max: 100,\n      step: 1,\n    },\n    show: ({ isMultiColor }) => isMultiColor,\n    affectsNails: false,\n    affectsStepCount: false,\n  },\n  {\n    key: 'lightness',\n    label: 'Lightness',\n    type: 'group',\n    defaultValue: 'minimized',\n    show: ({ isMultiColor }) => isMultiColor,\n    children: [\n      {\n        key: 'multicolorByLightness',\n        label: 'Multi lightness',\n        defaultValue: false,\n        type: 'checkbox',\n        show: ({ isMultiColor }) => isMultiColor,\n        affectsNails: false,\n        affectsStepCount: false,\n      },\n      {\n        key: 'minLightness',\n        label: 'Minimum lightness',\n        defaultValue: 0,\n        type: 'range',\n        attr: {\n          min: 0,\n          max: 100,\n          step: 1,\n          snap: '50',\n          thumbcolor: ({ minLightness }) => `hsl(0 0 ${minLightness})`,\n          background: 'linear-gradient(to right, black, white)',\n        },\n        show: ({ multicolorByLightness, isMultiColor }) =>\n          multicolorByLightness && isMultiColor,\n        affectsNails: false,\n        affectsStepCount: false,\n      },\n      {\n        key: 'maxLightness',\n        label: 'Maximum lightness',\n        defaultValue: 100,\n        type: 'range',\n        attr: {\n          min: 0,\n          max: 100,\n          step: 1,\n          snap: '50',\n          thumbcolor: ({ maxLightness }) => `hsl(0 0 ${maxLightness})`,\n          background: 'linear-gradient(to right, black, white)',\n        },\n        show: ({ multicolorByLightness, isMultiColor }) =>\n          multicolorByLightness && isMultiColor,\n        affectsNails: false,\n        affectsStepCount: false,\n      },\n    ],\n  },\n  {\n    key: 'colorOrderGroup',\n    type: 'group',\n    label: 'Order',\n    defaultValue: 'minimized',\n    show: ({ isMultiColor }) => isMultiColor,\n    children: [\n      {\n        key: 'reverseColors',\n        label: 'Reverse colors order',\n        defaultValue: false,\n        type: 'checkbox',\n        show: ({ isMultiColor }) => isMultiColor,\n        affectsNails: false,\n        affectsStepCount: false,\n      },\n      {\n        key: 'repeatColors',\n        label: 'Repeat colors',\n        defaultValue: true,\n        type: 'checkbox',\n        show: ({ isMultiColor }) => isMultiColor,\n        affectsNails: false,\n        affectsStepCount: false,\n      },\n      {\n        key: 'mirrorColors',\n        label: 'Mirror Colors',\n        defaultValue: false,\n        type: 'checkbox',\n        show: ({ isMultiColor, repeatColors }) => isMultiColor && repeatColors,\n        affectsNails: false,\n        affectsStepCount: false,\n      },\n    ],\n  },\n];\n\nexport default COLOR_CONTROLS;\n","import {\n  getConfigDefaultValues,\n  getControlsIndex,\n} from '../helpers/config_utils';\nimport EventBus from '../helpers/EventBus';\nimport { compareObjects } from '../helpers/object_utils';\nimport Nails from './nails/Nails';\nimport { MeasureRenderer, ThreadsLength } from './renderers/MeasureRenderer';\nimport Renderer from './renderers/Renderer';\nimport type {\n  CommonConfig,\n  Config,\n  ControlConfig,\n  ControlsConfig,\n  PrimitiveValue,\n} from '../types/config.types';\nimport { Dimensions } from '../types/general.types';\nimport { CalcOptions } from '../types/stringart.types';\nimport INails from './nails/INails';\n\nconst COLORS = {\n  dark: '#0e0e0e',\n  light: '#ffffff',\n};\n\nexport type Pattern<TConfig = Record<string, PrimitiveValue>> = new (\n  renderer?: Renderer\n) => StringArt<TConfig>;\n\nexport interface DrawOptions {\n  redrawNails?: boolean;\n  redrawStrings?: boolean;\n  sizeChanged?: boolean;\n  enableScheduler?: boolean;\n  precision?: number;\n}\n\nconst COMMON_CONFIG_CONTROLS: ControlsConfig = [\n  {\n    key: 'strings',\n    label: 'Strings',\n    type: 'group',\n    defaultValue: 'minimized',\n    children: [\n      {\n        key: 'showStrings',\n        label: 'Show strings',\n        defaultValue: true,\n        type: 'checkbox',\n        isDisabled: ({ showNails }) => !showNails,\n        affectsNails: false,\n      },\n      {\n        key: 'stringWidth',\n        label: 'String width',\n        defaultValue: 1,\n        type: 'range',\n        attr: { min: 0.2, max: 4, step: 0.1, snap: '1' },\n        show: ({ showStrings }) => showStrings,\n        affectsNails: false,\n      },\n    ],\n  },\n  {\n    key: 'nails',\n    label: 'Nails',\n    type: 'group',\n    defaultValue: 'minimized',\n    children: [\n      {\n        key: 'showNails',\n        label: 'Show nails',\n        defaultValue: true,\n        type: 'checkbox',\n        isDisabled: ({ showStrings }) => !showStrings,\n        affectsStrings: false,\n      },\n      {\n        key: 'showNailNumbers',\n        label: 'Show nail numbers',\n        defaultValue: false,\n        type: 'checkbox',\n        show: ({ showNails }) => showNails,\n        affectsStrings: false,\n      },\n      {\n        key: 'nailNumbersFontSize',\n        label: 'Nail numbers font size',\n        defaultValue: 10,\n        type: 'range',\n        attr: { min: 6, max: 24, step: 0.5 },\n        displayValue: ({ nailNumbersFontSize }) => `${nailNumbersFontSize}px`,\n        show: ({ showNails, showNailNumbers }) => showNails && showNailNumbers,\n        affectsStrings: false,\n      },\n      {\n        key: 'margin',\n        label: 'Margin',\n        defaultValue: 20,\n        type: 'number',\n        attr: { min: 0, max: 500, step: 1 },\n        displayValue: ({ margin }) => `${margin}px`,\n        isStructural: true,\n      },\n      {\n        key: 'nailRadius',\n        label: 'Nail size',\n        defaultValue: 1.5,\n        type: 'range',\n        attr: { min: 0.5, max: 5, step: 0.25, snap: '1.5' },\n        show: ({ showNails }) => showNails,\n        affectsStrings: false,\n      },\n      {\n        key: 'nailsColor',\n        label: 'Nails color',\n        defaultValue: '#ffffff',\n        type: 'color',\n        show: ({ showNails }) => showNails,\n        affectsStrings: false,\n      },\n    ],\n  },\n  {\n    key: 'background',\n    label: 'Background',\n    type: 'group',\n    defaultValue: 'minimized',\n    children: [\n      {\n        key: 'darkMode',\n        label: 'Dark mode',\n        defaultValue: true,\n        type: 'checkbox',\n        affectsNails: false,\n        affectsStrings: false,\n      },\n      {\n        key: 'customBackgroundColor',\n        label: 'Custom background color',\n        defaultValue: false,\n        type: 'checkbox',\n        affectsNails: false,\n        affectsStrings: false,\n      },\n      {\n        key: 'backgroundColor',\n        label: 'Background color',\n        defaultValue: COLORS.dark,\n        type: 'color',\n        show: ({ customBackgroundColor }) => customBackgroundColor,\n        affectsNails: false,\n        affectsStrings: false,\n      },\n    ],\n  },\n];\n\nabstract class StringArt<\n  TConfig = Record<string, PrimitiveValue>,\n  TCalc = Record<string, any>\n> extends EventBus<{\n  drawdone: void;\n}> {\n  controls: ControlsConfig<TConfig> = [];\n  defaultValues: Partial<Config<TConfig>> = {};\n  stepCount: number | null = null;\n  size: Dimensions = null;\n  position: number = 0;\n  stringsIterator: Iterator<void>;\n\n  id: string;\n  name: string;\n  link: string;\n  linkText: string;\n\n  protected calc: TCalc;\n\n  #config: Config<TConfig>;\n  #controlsIndex: Record<keyof TConfig, ControlConfig<TConfig>>;\n  #defaultConfig: Config<TConfig> | null;\n  #controller: TaskController;\n\n  constructor() {\n    super();\n  }\n\n  abstract drawNails(nails: INails): void;\n  abstract drawStrings(renderer: Renderer): Generator<void>;\n  abstract getStepCount(options: CalcOptions): number;\n  abstract getAspectRatio(options: CalcOptions): number;\n\n  getNailCount(size: Dimensions): number {\n    const renderer = new MeasureRenderer(size);\n    this.draw(renderer);\n    return renderer.nailCount;\n  }\n\n  getThreadLengths(size: Dimensions): ThreadsLength {\n    const renderer = new MeasureRenderer(size);\n    this.draw(renderer);\n    return renderer.threadsLength;\n  }\n\n  thumbnailConfig:\n    | Partial<Config<TConfig>>\n    | ((config: Config<TConfig>) => Partial<Config<TConfig>>);\n  /**\n   * Set testStepCountConfig to automatically test that the step count is correct for the given configurations\n   */\n  testStepCountConfig: Partial<Config<TConfig>>[];\n\n  static type: string;\n\n  getCommonControls(): ControlsConfig<Partial<CommonConfig>> {\n    return COMMON_CONFIG_CONTROLS;\n  }\n\n  get configControls(): ControlsConfig<TConfig> {\n    return (this.controls ?? []).concat(this.getCommonControls());\n  }\n\n  get controlsIndex(): Record<keyof TConfig, ControlConfig<TConfig>> {\n    if (!this.#controlsIndex) {\n      this.#controlsIndex = getControlsIndex<TConfig>(this.configControls);\n    }\n\n    return this.#controlsIndex;\n  }\n\n  get type(): string {\n    return (this.constructor as typeof StringArt).type;\n  }\n\n  /**\n   * A pattern is considered a template if the id is the same as the type. These are built-in patterns.\n   */\n  get isTemplate(): boolean {\n    return this.type === this.id;\n  }\n\n  get defaultConfig(): Config<TConfig> {\n    if (!this.#defaultConfig) {\n      this.#defaultConfig = Object.freeze(\n        Object.assign(\n          getConfigDefaultValues(this.configControls),\n          this.defaultValues\n        ) as Config<TConfig>\n      );\n    }\n\n    return this.#defaultConfig;\n  }\n\n  get config(): Config<TConfig> {\n    return this.#config ?? this.defaultConfig;\n  }\n\n  set config(value: Partial<Config<TConfig>>) {\n    this.#config = Object.assign({}, this.defaultConfig, value);\n  }\n\n  get isDefaultConfig(): boolean {\n    return compareObjects(this.config, this.#defaultConfig);\n  }\n\n  /**\n   * Marks the current config as default. Useful for saved patterns\n   */\n  markConfigAsDefault() {\n    this.#defaultConfig = this.config;\n  }\n\n  resetDefaultConfig() {\n    this.#defaultConfig = null;\n  }\n\n  /**\n   * Assigns the partial config to the current configuration of the StringArt\n   * @param config\n   */\n  assignConfig(config: Partial<Config<TConfig>>) {\n    this.#config = Object.assign({}, this.config, config);\n  }\n\n  /**\n   * Sets the config of the StringArt and updates using `onConfigChange`\n   * @param config\n   */\n  setConfig(config: Config<TConfig>) {\n    const currentConfig = this.config;\n    this.config = config;\n    if (this.onConfigChange) {\n      const changedControlKeys = Object.keys(currentConfig).filter(\n        key => config[key] !== currentConfig[key]\n      );\n\n      this.onConfigChange(\n        changedControlKeys.map(key => ({\n          control: this.controlsIndex[key],\n          value: config[key],\n        }))\n      );\n    }\n  }\n\n  /**\n   * Child classes can define this method to clear any structural cache when config values for `isStructural=true` controls change.\n   */\n  resetStructure() {\n    this.calc = null;\n  }\n\n  /**\n   * Base method for getCalc\n   * @param options\n   * @returns\n   */\n  getCalc(options: CalcOptions): TCalc {\n    return {} as TCalc;\n  }\n\n  onConfigChange(\n    controls: ReadonlyArray<{\n      control: ControlConfig<TConfig>;\n      value: PrimitiveValue | null;\n    }>\n  ) {\n    if (controls.some(({ control }) => control.isStructural)) {\n      this.resetStructure();\n      if (\n        this.stepCount != null &&\n        controls.some(({ control }) => control.affectsStepCount !== false)\n      ) {\n        this.stepCount = null;\n      }\n    }\n  }\n\n  onResize() {\n    this.resetStructure();\n  }\n\n  setConfigValue(controlKey: keyof TConfig, value: PrimitiveValue) {\n    if (this.#config && this.#config[controlKey] === value) {\n      return;\n    }\n\n    this.#config = Object.freeze({\n      ...(this.#config ?? this.defaultConfig),\n      [controlKey]: value,\n    });\n\n    if (this.onConfigChange) {\n      this.onConfigChange(\n        [{ control: this.controlsIndex[controlKey], value }].filter(\n          ({ control }) => !!control\n        )\n      );\n    }\n  }\n\n  setUpDraw(options?: CalcOptions) {\n    if (!this.calc) {\n      this.calc = this.getCalc(options);\n    }\n  }\n\n  afterDraw() {\n    this.emit('drawdone', null);\n  }\n\n  /**\n   * Sets up the pattern for rendering, by:\n   * 1. Clearing strings and nails from the renderer (if required for any of them)\n   * 2. Creates the Nails object\n   * 3. Sets the strings line width\n   * 4. Calls the pattern's `setUpDraw` method.\n   * @param renderer\n   * @param param1\n   */\n  initDraw(\n    renderer: Renderer,\n    { redrawNails = true, redrawStrings = true, sizeChanged }: DrawOptions = {}\n  ) {\n    if (sizeChanged) {\n      this.resetStructure();\n    }\n\n    if (redrawStrings) {\n      renderer.resetStrings();\n    }\n\n    if (redrawNails) {\n      renderer.resetNails();\n    }\n\n    renderer.clearInstructions();\n    renderer.setLineWidth(this.config.stringWidth);\n\n    const size = renderer.getSize();\n    this.setUpDraw({ size });\n  }\n\n  draw(\n    renderer: Renderer,\n    options: { position?: number } & DrawOptions = {}\n  ): () => void {\n    if (!options.enableScheduler) {\n      this.#draw(renderer, options);\n      return () => {};\n    }\n\n    if (this.#controller && !this.#controller.signal.aborted) {\n      this.#controller.abort('Redraw');\n    }\n\n    this.#controller = new TaskController({ priority: 'background' });\n    scheduler\n      .postTask(() => this.#draw(renderer, options), {\n        signal: this.#controller.signal,\n      })\n      .catch(reason => {\n        // The controller was aborted\n      });\n\n    return () => {\n      this.#controller?.abort('Cancelled');\n    };\n  }\n\n  /**\n   * Draws the string art on the renderer\n   */\n  #draw(\n    renderer: Renderer,\n    {\n      position,\n      precision,\n      ...drawOptions\n    }: { position?: number } & DrawOptions = {}\n  ): () => void {\n    this.initDraw(renderer, drawOptions);\n\n    const {\n      showNails,\n      darkMode,\n      backgroundColor,\n      customBackgroundColor,\n      enableBackground,\n    } = this.config;\n\n    renderer.setBackground(\n      enableBackground !== false\n        ? customBackgroundColor\n          ? backgroundColor\n          : darkMode\n          ? COLORS.dark\n          : COLORS.light\n        : null\n    );\n\n    if (showNails && drawOptions.redrawNails !== false) {\n      const nails = new Nails({\n        color: this.config.nailsColor,\n        fontSize: this.config.nailNumbersFontSize,\n        radius: this.config.nailRadius,\n        renderNumbers: this.config.showNailNumbers,\n      });\n\n      this.drawNails(nails);\n      nails.draw(renderer, { precision });\n    }\n\n    if (drawOptions.redrawStrings !== false && this.config.showStrings) {\n      this.stringsIterator = this.drawStrings(renderer);\n      this.position = 0;\n\n      while (\n        !this.drawNext().done &&\n        (position == null || this.position < position)\n      );\n    }\n\n    return () => {\n      this.#controller?.abort('Cancelled');\n    };\n  }\n\n  goto(renderer: Renderer, position: number, { showInstructions = true } = {}) {\n    if (position === this.position) {\n      return;\n    }\n\n    if (this.stringsIterator && position > this.position) {\n      while (!this.drawNext().done && this.position < position);\n    } else {\n      this.draw(renderer, {\n        position,\n        redrawNails: false,\n      });\n    }\n\n    if (showInstructions) {\n      renderer.renderInstructionsForLastLine();\n    }\n  }\n\n  /**\n   *\n   * @returns Advance the strings iterator by one. If the iterator is done, calls this.afterDraw().\n   */\n  drawNext() {\n    const result = this.stringsIterator.next();\n\n    if (result.done) {\n      this.afterDraw();\n    } else {\n      this.position++;\n    }\n\n    return result;\n  }\n\n  copy(overrideConfig?: Partial<TConfig>): StringArt<TConfig> {\n    // @ts-ignore\n    const patternCopy = new this.constructor();\n    patternCopy.config = { ...this.config, overrideConfig };\n    return patternCopy;\n  }\n}\n\nexport default StringArt;\n","/**\n * Returns true if the two objects have the same values. Deep compares the objects.\n */\nexport function compareObjects(\n  obj1: Object,\n  obj2: Object,\n  /**\n   * An array of keys to compare. If not specified, all keys are compared.\n   */\n  props?: ReadonlyArray<string>\n): boolean {\n  if (obj1 === obj2) {\n    return true;\n  }\n\n  if (typeof obj1 === 'object' && typeof obj2 === 'object') {\n    if ((obj1 === null) !== (obj2 === null)) {\n      return false;\n    }\n\n    if (obj1 instanceof Array && obj2 instanceof Array) {\n      if (obj1.length !== obj2.length) {\n        return false;\n      }\n\n      for (let i = 0; i < obj1.length; i++) {\n        if (!compareObjects(obj1[i], obj2[i])) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    if (!props) {\n      props = Object.keys(obj1);\n      if (props.length !== Object.keys(obj2).length) {\n        return false;\n      }\n    }\n\n    if (props && props.some(p => !compareObjects(obj1[p], obj2[p]))) {\n      return false;\n    }\n\n    return true;\n  }\n\n  return obj1 === obj2;\n}\n\n/**\n * Maps the keys of an object. The mapped accepts the original key and the value of that property\n * @returns\n */\nexport function mapKeys<T extends Record<string, any>, K extends string>(\n  obj: T,\n  mapper: (key: keyof T, value: T[keyof T]) => K\n): Record<K, T[keyof T]> {\n  const mappedObj = {} as Record<K, any>;\n  Object.entries(obj).forEach(\n    ([key, value]) => (mappedObj[mapper(key, value)] = value)\n  );\n  return mappedObj;\n}\n","import type Renderer from '../renderers/Renderer';\nimport { NailsRenderOptions } from '../../types/stringart.types';\nimport NailsGroup from './NailsGroup';\nimport { Coordinates } from '../../types/general.types';\nimport INails from './INails';\n\nexport default class Nails implements INails {\n  #nailGroups: NailsGroup[];\n  #defaultNailsGroup: NailsGroup;\n\n  constructor(public options: NailsRenderOptions) {\n    this.#nailGroups = [new NailsGroup(options)];\n    this.#defaultNailsGroup = this.#nailGroups[0];\n  }\n\n  addNail(key: string | number, coordinates: Coordinates) {\n    this.#defaultNailsGroup.addNail(key, coordinates);\n  }\n\n  addGroup(nailsGroup: NailsGroup) {\n    //nails.forEach(nail => this.#addNailToSets(nail));\n    this.#nailGroups.push(nailsGroup);\n  }\n\n  draw(renderer: Renderer, { precision }: { precision?: number } = {}) {\n    let numbersStart = 1;\n    this.#nailGroups.forEach(group => {\n      renderer.renderNails(group.getUniqueCoordinates(precision), {\n        ...this.options,\n        ...group.options,\n        numbersStart,\n      });\n\n      numbersStart += group.length;\n    });\n  }\n}\n","import { Coordinates } from '../../types/general.types';\nimport { NailsRenderOptions } from '../../types/stringart.types';\nimport INails from './INails';\n\nexport default class NailsGroup implements INails {\n  #nails: Map<string | number, Coordinates>;\n\n  constructor(public options?: Partial<NailsRenderOptions>) {\n    this.#nails = new Map();\n  }\n\n  get length(): number {\n    return this.#nails.size;\n  }\n\n  get coordinates(): Iterable<Coordinates> {\n    return this.#nails.values();\n  }\n\n  addNail(key: string | number, coordinates: Coordinates) {\n    if (this.#nails.has(key)) {\n      console.warn(\n        `Attempting to add a nail to NailsGroup, with already existing key, [${key}].`\n      );\n    }\n    this.#nails.set(key, coordinates);\n  }\n\n  addGroup(nailsGroup: NailsGroup): void {\n    throw new Error('Adding sub groups not implemented yet.');\n  }\n\n  getNailCoordinates(key: string | number): Coordinates {\n    return this.#nails.get(key);\n  }\n\n  *getUniqueCoordinates(precision = 1000): Generator<Coordinates> {\n    const addedCoordinates = new Set<number>();\n    for (const point of this.coordinates) {\n      const hash =\n        1e5 * Math.round(point[0] * precision) +\n        Math.round(point[1] * precision);\n      if (!addedCoordinates.has(hash)) {\n        yield point;\n        addedCoordinates.add(hash);\n      }\n    }\n  }\n\n  forEach(\n    callback: (coordinates: Coordinates, number: string | number) => void\n  ): void {\n    this.#nails.forEach((coordinates, number) => callback(coordinates, number));\n  }\n}\n","import { ColorValue } from '../../helpers/color/color.types';\nimport {\n  getClosestDistance,\n  getDistanceBetweenCoordinates,\n  PI2,\n} from '../../helpers/math_utils';\nimport { Coordinates, Dimensions } from '../../types/general.types';\nimport { PatternInfo } from '../../types/info.types';\nimport { NailsRenderOptions } from '../../types/stringart.types';\nimport { TestRenderer } from './TestRenderer';\n\nexport type ThreadsLength = {\n  total: number;\n  perColor: ReadonlyArray<{ color: ColorValue; length: number }>;\n};\n\nconst DEFAULT_NAIL_RADIUS = 1.5;\n\nexport class MeasureRenderer extends TestRenderer {\n  #threadsLength = 0;\n  #nailCount = 0;\n  #lastPoint: Coordinates;\n  #currentColor: ColorValue;\n  #threadsLengthPerColor: Map<ColorValue, number>;\n  #nailCoords: Coordinates[];\n  #nailThreadLength: number;\n\n  constructor(size: Dimensions) {\n    super(size);\n    this.#threadsLengthPerColor = new Map();\n    this.#nailCoords = [];\n    this.#nailThreadLength = this.#getNailThreadLength(DEFAULT_NAIL_RADIUS);\n  }\n\n  get threadsLength(): ThreadsLength {\n    return {\n      total: Math.round(this.#threadsLength),\n      perColor: Array.from(this.#threadsLengthPerColor.entries()).map(\n        ([color, length]) => ({ color, length })\n      ),\n    };\n  }\n\n  get nailCount(): number {\n    return this.#nailCount;\n  }\n\n  resetStrings(): void {\n    this.#threadsLength = 0;\n    this.#threadsLengthPerColor = new Map();\n  }\n\n  renderLine(from: Coordinates, to: Coordinates): void {\n    const lineLength =\n      getDistanceBetweenCoordinates(from, to) + this.#nailThreadLength;\n    this.#threadsLength += lineLength;\n    this.#threadsLengthPerColor.set(\n      this.#currentColor,\n      this.#threadsLengthPerColor.get(this.#currentColor) + lineLength\n    );\n    this.#lastPoint = to;\n  }\n\n  resetNails(): void {\n    this.#nailCount = 0;\n    this.#nailCoords.length = 0;\n  }\n\n  renderNails(nails: Iterable<Coordinates>, { radius }: NailsRenderOptions) {\n    for (let nail of nails) {\n      this.#nailCount++;\n      this.#nailCoords.push(nail);\n    }\n    this.#nailThreadLength = this.#getNailThreadLength(radius);\n  }\n\n  setStartingPoint(coordinates: Coordinates): void {\n    this.#lastPoint = coordinates;\n  }\n\n  setColor(color: ColorValue): void {\n    this.#currentColor = color;\n    if (!this.#threadsLengthPerColor.has(color)) {\n      this.#threadsLengthPerColor.set(color, 0);\n    }\n  }\n\n  lineTo(to: Coordinates): void {\n    if (!this.#lastPoint) {\n      throw new Error(\"no last string coordinates, can't lineTo\");\n    }\n\n    this.renderLine(this.#lastPoint, to);\n  }\n\n  getInfo(): PatternInfo {\n    return {\n      nailsCount: this.#nailCount,\n      threadsLength: this.threadsLength,\n      closestDistanceBetweenNails: getClosestDistance(this.#nailCoords),\n    };\n  }\n\n  #getNailThreadLength(nailRadius: number): number {\n    // Assuming two rounds around each nail, to be on the safe side when measuring total thread length\n    return PI2 * nailRadius * 2;\n  }\n}\n","import { ColorValue } from '../../helpers/color/color.types';\nimport Renderer from './Renderer';\nimport {\n  Coordinates,\n  Dimensions,\n  LineCoordinates,\n} from '../../types/general.types';\nimport { NailsRenderOptions } from '../../types/stringart.types';\n\nexport class TestRenderer extends Renderer {\n  strings: LineCoordinates[] = [];\n  nails: Coordinates[] = [];\n  lineWidth = 1;\n  size: Dimensions = [0, 0];\n  background: ColorValue;\n\n  constructor(size: Dimensions) {\n    super(null, { updateOnResize: false });\n    this.size = size;\n  }\n\n  resetStrings(): void {\n    this.strings.length = 0;\n  }\n  resetNails() {\n    this.nails.length = 0;\n  }\n\n  setLineWidth(width: number) {\n    this.lineWidth = width;\n  }\n\n  renderLine(from: Coordinates, to: Coordinates) {\n    this.strings.push([from, to]);\n  }\n\n  renderInstructions(from: Coordinates, to: Coordinates): void {}\n  clearInstructions(): void {}\n  lineTo(to: Coordinates) {\n    this.strings.push([[0, 0], to]);\n  }\n\n  renderNails(nails: Iterable<Coordinates>, options: NailsRenderOptions) {\n    for (let nail of nails) {\n      this.nails.push(nail);\n    }\n  }\n\n  clear() {\n    this.resetStrings();\n    this.resetNails();\n  }\n\n  toDataURL() {\n    return '';\n  }\n\n  getSize(): Dimensions {\n    return this.size;\n  }\n  setSize(size?: Dimensions | null): Dimensions {\n    return (this.size = size);\n  }\n\n  setBackground(color: ColorValue): void {\n    this.background = color;\n  }\n\n  showInstructions(): void {}\n\n  hideInstructions(): void {}\n}\n","import Renderer from '../infra/renderers/Renderer';\nimport { ControlConfig, GroupValue } from '../types/config.types';\nimport { BoundingRect, Coordinates, Dimensions } from '../types/general.types';\nimport { ColorValue } from '../helpers/color/color.types';\nimport easing from '../helpers/easing';\nimport { distortionToAspectRatio, PI2 } from '../helpers/math_utils';\nimport { compareObjects } from '../helpers/object_utils';\nimport Polygon from './Polygon';\nimport { fitInside, getCenter } from '../helpers/size_utils';\nimport type Shape from './Shape';\nimport { formatFractionAsAngle } from '../helpers/string_utils';\nimport INails from '../infra/nails/INails';\nimport { ShapeNailsOptions } from './Shape';\n\nexport interface CircleConfig {\n  n: number;\n  size: Dimensions;\n  margin?: number;\n  rotation?: number;\n  center?: Coordinates;\n  radius?: number;\n  reverse?: boolean;\n  distortion?: number;\n  displacement?: GroupValue;\n  displacementFunc?: keyof typeof easing;\n  displacementMag?: number;\n  displacementFastArea?: number;\n  /**\n   * The angle at which to start rendering the circle (in radians)\n   */\n  angleStart?: number;\n  /**\n   * The angle at which to end rendering the circle (in radians)\n   */\n  angleEnd?: number;\n}\n\nexport type CircleNailsOptions = ShapeNailsOptions & {\n  /**\n   * Ranges of nails to exclude from the circle\n   */\n  excludedNailRanges?: ReadonlyArray<[number, number]>;\n};\n\nexport default class Circle implements Shape {\n  points: Map<number, Coordinates>;\n  easingFunction: Function;\n  config: CircleConfig;\n  center: Coordinates;\n  xyRadius: Dimensions;\n  rotationAngle: number = 0;\n  indexAngle: number;\n  isReverse: boolean = false;\n  radius: number;\n  arc: number = PI2;\n  isPartialArc: boolean = false;\n  excludedNailIndexes: ReadonlySet<number>;\n\n  constructor(config: CircleConfig) {\n    this.setConfig(config);\n  }\n\n  getPoint(index: number): Coordinates {\n    const realIndex = this.#getNailIndex(index);\n\n    if (this.points.has(index)) {\n      return this.points.get(index);\n    }\n\n    const angle =\n      this.easingFunction(\n        realIndex / (this.config.n - (this.isPartialArc ? 1 : 0))\n      ) *\n        this.arc +\n      this.rotationAngle +\n      (this.config.angleStart ?? 0);\n\n    const point: Coordinates = [\n      this.center[0] + Math.sin(angle) * this.xyRadius[0],\n      this.center[1] + Math.cos(angle) * this.xyRadius[1],\n    ];\n\n    this.points.set(index, point);\n    return point;\n  }\n\n  #getNailIndex(index = 0): number {\n    return (this.isReverse ? this.config.n - 1 - index : index) % this.config.n;\n  }\n\n  getAspectRatio(): number {\n    if (!this.config.distortion) {\n      return 1;\n    }\n\n    const aspectRatio = distortionToAspectRatio(this.config.distortion);\n    return aspectRatio[0] / aspectRatio[1];\n  }\n\n  /**\n   * The bounding rect of the Circle is not just [diameter, diameter], because a 3 nail circle is a triangle, for example,\n   * in which case the bounding rect won't take that fill rect. Using a Polygon instead, which is more precise.\n   */\n  getBoundingRect(): BoundingRect {\n    const { n, rotation } = this.config;\n\n    if (n < 16) {\n      const polygon = new Polygon({\n        sides: n,\n        rotation,\n        size: [this.radius * 2, this.radius * 2],\n        nailsPerSide: 1,\n        center: this.center,\n      });\n\n      return polygon.getBoundingRect();\n    }\n\n    return {\n      top: this.center[1] - this.xyRadius[1],\n      left: this.center[0] - this.xyRadius[0],\n      right: this.center[0] + this.xyRadius[0],\n      bottom: this.center[1] + this.xyRadius[1],\n      width: this.xyRadius[0] * 2,\n      height: this.xyRadius[1] * 2,\n    };\n  }\n\n  setConfig(config: CircleConfig): void {\n    if (!compareObjects(config, this.config)) {\n      const {\n        n,\n        size,\n        margin = 0,\n        rotation = 0,\n        center: configCenter,\n        radius,\n        reverse = false,\n        angleStart,\n        angleEnd,\n      } = config;\n      const center = configCenter ?? getCenter(size);\n      const clampedRadius = Math.max(\n        1,\n        (radius ?? Math.min(...getCenter(size))) - margin\n      );\n\n      let xyRadius = [clampedRadius, clampedRadius];\n\n      if (config.distortion) {\n        const aspectRatio = distortionToAspectRatio(config.distortion);\n        const distortedBox = aspectRatio.map(\n          v => clampedRadius * v\n        ) as Dimensions;\n        xyRadius = fitInside(\n          distortedBox,\n          size.map(v => Math.max(0, v / 2 - margin)) as Dimensions\n        );\n      }\n\n      // Normally, the whole circle is rendered, but if angleStart and angleEnd are configured and valid, and arc between them is rendered:\n      this.isPartialArc = angleStart && angleEnd && angleEnd > angleStart;\n      const arc = this.isPartialArc ? angleEnd - angleStart : PI2;\n\n      const props = {\n        center,\n        radius: clampedRadius,\n        xyRadius,\n        indexAngle: arc / (this.isPartialArc ? n - 1 : n),\n        rotationAngle: -PI2 * rotation,\n        isReverse: reverse,\n        arc,\n      };\n\n      const easingFunction = config.displacementFunc\n        ? easing[config.displacementFunc]\n        : easing.linear;\n      const easingParams = [];\n      // @ts-ignore\n      if (easingFunction.requirePower) {\n        easingParams.push(config.displacementMag);\n      }\n      // @ts-ignore\n      if (easingFunction.requireFastArea) {\n        easingParams.push(config.displacementFastArea);\n      }\n      const easingFunctionWithParams = easingParams.length\n        ? easingFunction.bind(null, ...easingParams)\n        : easingFunction;\n\n      this.easingFunction = easingFunctionWithParams;\n      this.config = config;\n      Object.assign(this, props);\n      if (this.points) {\n        this.points.clear();\n      } else {\n        this.points = new Map();\n      }\n    }\n  }\n\n  /**\n   * Given a Nails instance, uses it to draw the nails of this Circle\n   * @param {Nails} nails\n   * @param {{nailsNumberStart?: number, getNumber?: Function}} param1\n   */\n  drawNails(\n    nails: INails,\n    { excludedNailRanges, getUniqueKey }: CircleNailsOptions = {}\n  ): void {\n    const { n } = this.config;\n\n    let excludedNailIndexes: Set<number>;\n    if (excludedNailRanges) {\n      excludedNailIndexes = new Set<number>();\n      excludedNailRanges.forEach(([start, end]) => {\n        const max = Math.min(end, n);\n        for (let i = Math.max(0, start); i <= max; i++) {\n          excludedNailIndexes.add(i);\n        }\n      });\n    }\n\n    for (let i = 0; i < this.config.n; i++) {\n      if (!excludedNailIndexes?.has(i)) {\n        nails.addNail(getUniqueKey?.(i) ?? i, this.getPoint(i));\n      }\n    }\n  }\n\n  *drawRing(\n    renderer: Renderer,\n    { ringSize, color }: { ringSize: number; color?: ColorValue }\n  ): Generator<void> {\n    const { n } = this.config;\n    const ringDistance = Math.floor(ringSize * n);\n\n    let prevPoint: Coordinates;\n    let prevPointIndex = 0;\n    let isPrevSide = false;\n    if (color) {\n      renderer.setColor(color);\n    }\n\n    for (let i = 0; i < n; i++) {\n      if (!prevPoint) {\n        prevPoint = this.getPoint(0);\n      }\n\n      const startPoint = prevPoint;\n      const positions: Array<Coordinates> = [];\n      prevPointIndex = isPrevSide ? i : prevPointIndex + ringDistance;\n      prevPoint = this.getPoint(prevPointIndex);\n      positions.push(prevPoint);\n\n      renderer.renderLine(startPoint, prevPoint);\n      yield;\n\n      if (i < n - 1) {\n        prevPointIndex++;\n        const nextPoint = this.getPoint(prevPointIndex);\n        renderer.renderLine(prevPoint, nextPoint);\n        yield;\n        prevPoint = nextPoint;\n        positions.push(prevPoint);\n      }\n\n      isPrevSide = !isPrevSide;\n    }\n  }\n\n  getRingStepCount(): number {\n    return this.config.n * 2 - 1;\n  }\n\n  static rotationConfig: ControlConfig<{ rotation?: number }> = {\n    key: 'rotation',\n    label: 'Rotation',\n    defaultValue: 0,\n    type: 'range',\n    attr: {\n      min: 0,\n      max: 1 + 1 / 360,\n      step: 1 / 360,\n      snap: '0.25, 0.5, 0.75',\n    },\n    displayValue: ({ rotation }) => formatFractionAsAngle(rotation),\n    isStructural: true,\n    affectsStepCount: false,\n  };\n\n  static nailsConfig = Object.freeze({\n    key: 'n',\n    label: 'Number of nails',\n    defaultValue: 144,\n    type: 'range',\n    attr: {\n      min: 3,\n      max: 300,\n      step: 1,\n    },\n    isStructural: true,\n  });\n\n  static displacementConfig: ControlConfig<CircleConfig> = {\n    key: 'displacement',\n    label: 'Displacement',\n    type: 'group',\n    children: [\n      {\n        key: 'displacementFunc',\n        label: 'Displacement function',\n        defaultValue: 'linear',\n        type: 'select',\n        options: Object.keys(easing),\n        isStructural: true,\n        affectsStepCount: false,\n      },\n      {\n        key: 'displacementMag',\n        label: 'Displacement magnitude',\n        defaultValue: 3,\n        type: 'range',\n        attr: {\n          min: 0,\n          max: 10,\n          step: 0.1,\n        },\n        // @ts-ignore\n        show: ({ displacementFunc }) => easing[displacementFunc].requirePower,\n        isStructural: true,\n        affectsStepCount: false,\n      },\n      {\n        key: 'displacementFastArea',\n        label: 'Displacement fast area',\n        defaultValue: 0.4,\n        type: 'range',\n        attr: {\n          min: 0,\n          max: 0.5,\n          step: 0.01,\n        },\n        show: ({ displacementFunc }) =>\n          // @ts-ignore\n          easing[displacementFunc].requireFastArea,\n        isStructural: true,\n        affectsStepCount: false,\n      },\n    ],\n  };\n\n  static distortionConfig: ControlConfig<{ distortion?: number }> = {\n    key: 'distortion',\n    label: 'Distortion',\n    defaultValue: 0,\n    type: 'range',\n    attr: {\n      min: -0.99,\n      max: 0.99,\n      step: 0.01,\n      snap: '0',\n    },\n    isStructural: true,\n    affectsStepCount: false,\n  };\n}\n","const easing = {\n  linear: x => x,\n  inOutCirc(x: number): number {\n    return x < 0.5\n      ? (1 - Math.sqrt(1 - Math.pow(2 * x, 2))) / 2\n      : (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2;\n  },\n  easeOutQuint(x: number): number {\n    return 1 - Math.pow(1 - x, 5);\n  },\n  easeOutCubic(x: number): number {\n    return 1 - Math.pow(1 - x, 4);\n  },\n  fastSlowFast(t: number): number {\n    // Clamp t to [0,1] just to be safe\n    t = Math.max(0, Math.min(1, t));\n    // Custom easing formula: accelerates, slows in middle, then accelerates again\n    return 0.5 * (1 - Math.cos(Math.PI * t)) ** 1.5;\n  },\n  fastInOutSquare(x: number): number {\n    return x <= 0.5\n      ? (1 - Math.pow(1 - x * 2, 2)) / 2\n      : 0.5 + Math.pow(x * 2 - 1, 2) / 2;\n  },\n  fastInOutCubic(x: number): number {\n    return x <= 0.5\n      ? (1 - Math.pow(1 - x * 2, 3)) / 2\n      : 0.5 + Math.pow(x * 2 - 1, 3) / 2;\n  },\n  fastInOutQuint(x: number): number {\n    return x <= 0.5\n      ? (1 - Math.pow(1 - x * 2, 5)) / 2\n      : 0.5 + Math.pow(x * 2 - 1, 5) / 2;\n  },\n  fastInOut(pow: number, x: number): number {\n    return x <= 0.5\n      ? (1 - Math.pow(1 - x * 2, pow)) / 2\n      : 0.5 + Math.pow(x * 2 - 1, pow) / 2;\n  },\n  fastInOutFixed(pow: number, fastArea: number, x: number): number {\n    if (x > fastArea && x < 1 - fastArea) {\n      const y1 = (1 - Math.pow(1 - fastArea * 2, pow)) / 2;\n      const y2 = 0.5 + Math.pow((1 - fastArea) * 2 - 1, pow) / 2;\n\n      return y1 + ((x - fastArea) * (y2 - y1)) / (1 - 2 * fastArea);\n    }\n    return x <= fastArea\n      ? (1 - Math.pow(1 - x * 2, pow)) / 2\n      : 0.5 + Math.pow(x * 2 - 1, pow) / 2;\n  },\n  easeOutFixed(pow: number, fixedAreaSize: number, x: number): number {\n    const fixedAreaStart = 1 - fixedAreaSize;\n\n    if (x < fixedAreaStart || fixedAreaSize === 0) {\n      return 1 - Math.pow(1 - x, pow);\n    }\n\n    const fixedAreaResultStart = 1 - Math.pow(1 - fixedAreaStart, pow);\n    return (\n      fixedAreaResultStart +\n      ((1 - fixedAreaResultStart) * (x - fixedAreaStart)) / fixedAreaSize\n    );\n  },\n};\n\n// @ts-ignore\neasing.fastInOut.requirePower = true;\n// @ts-ignore\neasing.fastInOutFixed.requirePower = true;\n// @ts-ignore\neasing.fastInOutFixed.requireFastArea = true;\n// @ts-ignore\neasing.easeOutFixed.requirePower = true;\n// @ts-ignore\neasing.easeOutFixed.requireFastArea = true;\nexport default easing;\n","import { ControlConfig } from '../types/config.types';\nimport { BoundingRect, Coordinates, Dimensions } from '../types/general.types';\nimport { PI2 } from '../helpers/math_utils';\nimport { compareObjects } from '../helpers/object_utils';\nimport { getBoundingRectAspectRatio, getCenter } from '../helpers/size_utils';\nimport type Shape from './Shape';\nimport { formatFractionAsAngle } from '../helpers/string_utils';\nimport { createArray } from '../helpers/array_utils';\nimport INails from '../infra/nails/INails';\nimport { ShapeNailsOptions } from './Shape';\n\nexport interface PolygonConfig {\n  size: Dimensions;\n  sides: number;\n  fitSize?: boolean;\n  nailsPerSide: number;\n  margin?: number;\n  rotation?: number;\n  center?: Coordinates;\n  radiusNailsCountSameAsSides?: boolean;\n  radius?: number;\n}\n\ninterface Side {\n  cos: number;\n  sin: number;\n  center: {\n    cos: number;\n    sin: number;\n  };\n}\n\ntype PolygonNailsOptions = ShapeNailsOptions & {\n  drawCenter?: boolean;\n  drawSides?: boolean;\n  drawCenterNail?: boolean;\n};\n\ninterface TCalc {\n  center: Coordinates;\n  radius: number;\n  sideSize: number;\n  start: Coordinates;\n  nailsDistance: number;\n  radiusNailsCount: number;\n  radiusNailsDistance: number;\n  sides: ReadonlyArray<Side>;\n  sideAngle: number;\n}\n\nexport default class Polygon implements Shape {\n  config: PolygonConfig;\n  #points: Map<string, Coordinates>;\n  #calc: TCalc;\n\n  constructor(config: PolygonConfig) {\n    this.setConfig(config);\n  }\n\n  setConfig(config: PolygonConfig) {\n    if (!compareObjects(config, this.config)) {\n      this.config = config;\n\n      if (this.#points) {\n        this.#points.clear();\n      } else {\n        this.#points = new Map();\n      }\n\n      this.#calc = this.#getCalc();\n\n      if (config.fitSize) {\n        const sizeAndCenter = this.#getSizeAndCenter();\n        this.#points.clear();\n        this.#calc = { ...this.#getCalc(), ...sizeAndCenter };\n      }\n    }\n  }\n\n  #getSizeAndCenter(): {\n    size: Dimensions;\n    center: Coordinates;\n  } {\n    const { size: configSize, margin } = this.config;\n\n    const boundingRect = this.getBoundingRect();\n    const scale = Math.min(\n      (configSize[0] - 2 * margin) / boundingRect.width,\n      (configSize[1] - 2 * margin) / boundingRect.height\n    );\n\n    const size = configSize.map(v => v * scale) as Dimensions;\n    const center = [\n      this.#calc.center[0] -\n        (scale * (boundingRect.left - configSize[0] + boundingRect.right)) / 2,\n      this.#calc.center[1] -\n        (scale * (boundingRect.top - configSize[1] + boundingRect.bottom)) / 2,\n    ] as Coordinates;\n\n    return { size, center };\n  }\n\n  #getCalc(): TCalc {\n    const {\n      size,\n      rotation = 0,\n      sides: sideCount,\n      center: configCenter,\n      margin = 0,\n      nailsPerSide,\n      radiusNailsCountSameAsSides = false,\n      radius: radiusConfig,\n    } = this.config;\n\n    const sideAngle = PI2 / sideCount;\n\n    const sides: ReadonlyArray<Side> = createArray(sideCount, i => {\n      const angle = sideAngle * i + PI2 * rotation;\n      const radiusAngle = -sideAngle * (i - 0.5) - PI2 * rotation;\n\n      return {\n        cos: Math.cos(angle),\n        sin: Math.sin(angle),\n        center: {\n          cos: Math.cos(radiusAngle),\n          sin: Math.sin(radiusAngle),\n        },\n      };\n    });\n\n    const center = configCenter ?? getCenter(size);\n\n    const radius = radiusConfig ?? Math.min(...size) / 2 - margin;\n    const sideSize = 2 * radius * Math.sin(sideAngle / 2);\n    const start: Coordinates = [\n      radius * Math.sin(sideAngle / 2),\n      radius * Math.cos(sideAngle / 2),\n    ];\n    const nailsDistance = sideSize / (nailsPerSide - 1);\n    const radiusNailsCount = radiusNailsCountSameAsSides\n      ? nailsPerSide\n      : Math.max(2, Math.floor(radius / nailsDistance));\n    const radiusNailsDistance = radius / (radiusNailsCount - 1);\n\n    return {\n      center,\n      radius,\n      sideSize,\n      start,\n      nailsDistance,\n      radiusNailsCount,\n      radiusNailsDistance,\n      sides,\n      sideAngle,\n    };\n  }\n\n  get radiusNailsCount(): number {\n    return this.#calc.radiusNailsCount;\n  }\n\n  get sideSize(): number {\n    return this.#calc.sideSize;\n  }\n\n  getPoint(index: number): Coordinates {\n    const { nailsPerSide } = this.config;\n\n    const position = index / nailsPerSide;\n    const side = Math.floor(position);\n    const sideIndex = index % nailsPerSide;\n\n    return this.getSidePoint({ side, index: sideIndex });\n  }\n\n  getSidePoint({ side, index }: { side: number; index: number }): Coordinates {\n    const pointsMapIndex = [side, index].join('_');\n\n    if (this.#points.has(pointsMapIndex)) {\n      return this.#points.get(pointsMapIndex);\n    }\n\n    const startX = this.#calc.start[0] - index * this.#calc.nailsDistance;\n    const { cos, sin } = this.#calc.sides[side];\n\n    const point = [\n      cos * startX - sin * this.#calc.start[1] + this.#calc.center[0],\n      sin * startX + cos * this.#calc.start[1] + this.#calc.center[1],\n    ] as Coordinates;\n\n    this.#points.set(pointsMapIndex, point);\n    return point;\n  }\n\n  getCenterPoint({ side, index }): Coordinates {\n    if (index < 0) {\n      throw new Error(`Can't get polygon center point for index = (${index}).`);\n    }\n\n    if (side < 0) {\n      throw new Error(`Can't get polygon center point for side = (${index}).`);\n    }\n    const radius = index * this.#calc.radiusNailsDistance;\n    const { sin, cos } = this.#calc.sides[side].center;\n\n    return [\n      this.#calc.center[0] + sin * radius,\n      this.#calc.center[1] + cos * radius,\n    ];\n  }\n\n  getBoundingRect(): BoundingRect {\n    const points = createArray(this.config.sides, side =>\n      this.getSidePoint({ side, index: 0 })\n    );\n    const firstPoint = points[0];\n\n    const boundingRect = points.slice(1).reduce(\n      (boundingRect, [x, y]) => ({\n        left: Math.min(boundingRect.left, x),\n        right: Math.max(boundingRect.right, x),\n        top: Math.min(boundingRect.top, y),\n        bottom: Math.max(boundingRect.bottom, y),\n      }),\n      {\n        left: firstPoint[0],\n        right: firstPoint[0],\n        top: firstPoint[1],\n        bottom: firstPoint[1],\n      }\n    );\n\n    return {\n      ...boundingRect,\n      height: boundingRect.bottom - boundingRect.top,\n      width: boundingRect.right - boundingRect.left,\n    };\n  }\n\n  getAspectRatio(): number {\n    return getBoundingRectAspectRatio(this.getBoundingRect());\n  }\n\n  drawNails(\n    nails: INails,\n    {\n      drawCenter = false,\n      drawSides = true,\n      drawCenterNail = true,\n      getUniqueKey,\n    }: PolygonNailsOptions = {}\n  ) {\n    const { nailsPerSide } = this.config;\n\n    let nailIndex = 0;\n    if (drawCenter && drawCenterNail) {\n      nails.addNail(nailIndex, this.getCenterPoint({ side: 0, index: 0 }));\n      nailIndex++;\n    }\n\n    for (let side = 0; side < this.config.sides; side++) {\n      if (drawSides) {\n        for (let index = 0; index < nailsPerSide - 1; index++) {\n          nails.addNail(\n            getUniqueKey?.(nailIndex) ?? nailIndex,\n            this.getSidePoint({ side, index })\n          );\n          nailIndex++;\n        }\n      }\n\n      if (drawCenter) {\n        for (let index = 1; index < this.#calc.radiusNailsCount - 1; index++) {\n          nails.addNail(\n            getUniqueKey?.(nailIndex) ?? nailIndex,\n            this.getCenterPoint({ side, index })\n          );\n          nailIndex++;\n        }\n      }\n    }\n  }\n\n  getNailsCount({\n    drawCenter = false,\n    drawSides = true,\n    drawCenterNail = true,\n  }: PolygonNailsOptions = {}): number {\n    const nailsPerSide =\n      (drawSides ? this.config.nailsPerSide - 1 : 0) +\n      (drawCenter ? this.#calc.radiusNailsCount - 2 : 0);\n\n    return (\n      this.config.sides * nailsPerSide + (drawCenter && drawCenterNail ? 1 : 0)\n    );\n  }\n\n  static rotationConfig: ControlConfig<{ rotation: number; sides: number }> = {\n    key: 'rotation',\n    label: 'Rotation',\n    defaultValue: 0,\n    type: 'range',\n    attr: {\n      min: 0,\n      max: 1,\n      step: 0.02,\n    },\n    displayValue: ({ rotation, sides }) =>\n      formatFractionAsAngle(rotation / (2 * sides)),\n    isStructural: true,\n    affectsStepCount: false,\n  };\n}\n","export function formatFractionAsPercent(value: number): string {\n  return `${Math.round(value * 100)}%`;\n}\n\nexport function formatFractionAsAngle(value: number): string {\n  return `${Math.round((value ?? 0) * 360)}`;\n}\n\nexport function capitalize(value: string): string {\n  return value[0].toLocaleUpperCase() + value.slice(1);\n}\n","export function createArray<T>(\n  size: number,\n  mapper: (index: number) => T\n): T[] {\n  return new Array(size).fill(null).map((_, i) => mapper(i));\n}\n","import StringArt from '../infra/StringArt';\nimport Circle from '../shapes/Circle';\nimport Color from '../helpers/color/Color';\nimport { ColorConfig, ColorMap } from '../helpers/color/color.types';\nimport { PI2 } from '../helpers/math_utils';\nimport Renderer from '../infra/renderers/Renderer';\nimport { ControlsConfig } from '../types/config.types';\nimport { Coordinates } from '../types/general.types';\nimport { CalcOptions } from '../types/stringart.types';\nimport Nails from '../infra/nails/Nails';\nimport { getCenter } from '../helpers/size_utils';\nimport { createArray } from '../helpers/array_utils';\nimport { formatFractionAsAngle } from '../helpers/string_utils';\nimport easing from '../helpers/easing';\nimport NailsGroup from '../infra/nails/NailsGroup';\nimport INails from '../infra/nails/INails';\n\ninterface SpiralsConfig extends ColorConfig {\n  // radiusIncrease: number;\n  angleStep: number;\n  angle: number;\n  nSpirals: number;\n  rotation: number;\n  nailsPerSpiral: number;\n  radiusEasing: number;\n  angleEasing: number;\n}\n\ninterface TCalc {\n  spiralRotations: number[];\n  rotationAngle: number;\n  center: Coordinates;\n  angle: number;\n  radius: number;\n}\n\nclass Spirals extends StringArt<SpiralsConfig, TCalc> {\n  static type = 'spirals';\n\n  name = 'Spirals';\n  id = 'spirals';\n  link =\n    'https://www.etsy.com/il-en/listing/974865185/3d-string-art-spiral-mandala-wall?ref=shop_home_active_10&frs=1';\n  controls: ControlsConfig<SpiralsConfig> = [\n    {\n      key: 'nSpirals',\n      label: 'Number of spirals',\n      defaultValue: 3,\n      type: 'range',\n      attr: { min: 2, max: 20, step: 1 },\n      isStructural: true,\n    },\n    {\n      key: 'nailsPerSpiral',\n      label: 'Nails per spiral',\n      type: 'range',\n      defaultValue: 80,\n      attr: {\n        min: 3,\n        max: 300,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    {\n      key: 'angle',\n      label: 'Angle',\n      type: 'range',\n      defaultValue: 0.52,\n      attr: {\n        min: 0,\n        max: 2,\n        step: 0.026,\n      },\n      displayValue: ({ angle }) => formatFractionAsAngle(angle),\n      isStructural: true,\n      affectsStepCount: false,\n    },\n    {\n      key: 'radiusEasing',\n      label: 'Radius easing',\n      defaultValue: 1.8,\n      type: 'range',\n      attr: { min: 1, max: 10, step: 0.1 },\n      isStructural: true,\n      affectsStepCount: false,\n    },\n    {\n      key: 'angleEasing',\n      label: 'Angle easing',\n      defaultValue: 1.3,\n      type: 'range',\n      attr: { min: 1, max: 10, step: 0.1 },\n      isStructural: true,\n      affectsStepCount: false,\n    },\n    {\n      ...Circle.rotationConfig,\n      defaultValue: 65 / 360,\n    },\n    Color.getConfig({\n      defaults: {\n        isMultiColor: true,\n        colorCount: 4,\n        color: '#00d5ff',\n        multicolorRange: 1,\n        multicolorStart: 190,\n        multicolorByLightness: true,\n        minLightness: 50,\n        maxLightness: 88,\n        reverseColors: true,\n      },\n    }),\n  ];\n\n  color: Color;\n  colorMap: ColorMap;\n\n  getCalc({ size }: CalcOptions): TCalc {\n    const { nSpirals, rotation, margin, angle } = this.config;\n    const maxRadius = Math.min(...size) / 2 - margin;\n\n    return {\n      spiralRotations: createArray(nSpirals, i => (i * PI2) / nSpirals),\n      rotationAngle: -PI2 * rotation,\n      angle: angle * PI2,\n      center: getCenter(size),\n      radius: maxRadius,\n    };\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n\n    const { colorCount } = this.config;\n\n    this.color = new Color(this.config);\n    this.colorMap = this.color.getColorMap({\n      stepCount: this.getStepCount(),\n      colorCount,\n    });\n  }\n\n  /**\n   * TODO: The aspect ratio isn't really 1, but it's hard to calculate. Will tackle it in the future\n   */\n  getAspectRatio(): number {\n    return 1;\n  }\n\n  *generatePoints(): Generator<Coordinates> {\n    const { nSpirals, nailsPerSpiral } = this.config;\n    for (let i = 1; i < nailsPerSpiral; i++) {\n      for (let s = 0; s < nSpirals; s++) {\n        yield this.getPoint(s, i);\n      }\n    }\n  }\n\n  getPoint(spiralIndex: number, index: number): Coordinates {\n    const { center, radius: maxRadius, angle: totalAngle } = this.calc;\n    const { nailsPerSpiral, radiusEasing, angleEasing } = this.config;\n    const position = index / (nailsPerSpiral - 1);\n\n    const angle =\n      this.calc.rotationAngle +\n      easing.easeOutFixed(angleEasing, 0, position) * totalAngle +\n      this.calc.spiralRotations[spiralIndex];\n    const radius = easing.easeOutFixed(radiusEasing, 0, position) * maxRadius;\n\n    return [\n      center[0] + radius * Math.sin(angle),\n      center[1] + radius * Math.cos(angle),\n    ];\n  }\n\n  *drawStrings(renderer: Renderer): Generator<void> {\n    const points = this.generatePoints();\n    let index = 0;\n    renderer.setColor(this.color.getColor(0));\n    renderer.setStartingPoint(this.calc.center);\n\n    for (const point of points) {\n      if (this.colorMap) {\n        const stepColor = this.colorMap.get(index);\n        if (stepColor) {\n          renderer.setColor(stepColor);\n        }\n      }\n\n      renderer.lineTo(point);\n      yield;\n\n      index++;\n    }\n  }\n\n  getStepCount(): number {\n    const { nSpirals, nailsPerSpiral } = this.config;\n    return (nailsPerSpiral - 1) * nSpirals;\n  }\n\n  drawNails(nails: INails) {\n    const points = this.generatePoints();\n    let i = 0;\n    for (const point of points) {\n      nails.addNail(i, point);\n      i++;\n    }\n  }\n\n  getNailCount(): number {\n    const { nSpirals, nailsPerSpiral } = this.config;\n    return nSpirals * (nailsPerSpiral - 1);\n  }\n\n  thumbnailConfig = ({ nailsPerSpiral }) => ({\n    nailsPerSpiral: Math.min(30, nailsPerSpiral),\n  });\n}\n\nexport default Spirals;\n","import Color from '../helpers/color/Color';\nimport Circle from '../shapes/Circle';\nimport Mandala, { MandalaCalc, MandalaConfig } from './Mandala';\nimport { ControlsConfig } from '../types/config.types';\nimport { formatFractionAsPercent } from '../helpers/string_utils';\nimport { withoutAttribute } from '../helpers/config_utils';\nimport Renderer from '../infra/renderers/Renderer';\nimport { CalcOptions } from '../types/stringart.types';\n\nexport interface WaveConfig {\n  layerSpread: number;\n}\n\nexport default class Wave extends Mandala<WaveConfig> {\n  static type = 'wave';\n\n  id = 'wave';\n  name = 'Wave';\n  link =\n    'https://www.etsy.com/il-en/listing/943140543/personalized-gift-string-art-mandala?ref=sim_rv-5&pro=1';\n  controls: ControlsConfig<MandalaConfig & WaveConfig> = [\n    {\n      ...Circle.nailsConfig,\n      defaultValue: 200,\n    },\n    {\n      key: 'layerFill',\n      label: 'Layer fill',\n      defaultValue: 0.5,\n      type: 'range',\n      attr: {\n        min: ({ n }) => 1 / n,\n        max: 1,\n        step: ({ n }) => 1 / n,\n      },\n      displayValue: ({ layerFill }) => formatFractionAsPercent(layerFill),\n      affectsNails: false,\n      isStructural: true,\n    },\n    withoutAttribute(Circle.rotationConfig, 'snap'),\n    Circle.distortionConfig,\n    {\n      key: 'layers',\n      label: 'Layers',\n      defaultValue: 11,\n      type: 'range',\n      attr: { min: 1, max: 20, step: 1 },\n    },\n    {\n      key: 'layerSpread',\n      label: 'Layer spread',\n      defaultValue: 15 / 200,\n      type: 'range',\n      attr: {\n        min: 0,\n        max: 1,\n        step: ({ n }) => 1 / n,\n      },\n      displayValue: ({ layerSpread, n }) => Math.round(layerSpread * n),\n      affectsNails: false,\n      isStructural: true,\n    },\n    {\n      key: 'reverse',\n      label: 'Reverse',\n      defaultValue: true,\n      type: 'checkbox',\n      isStructural: true,\n    },\n    Color.getConfig({\n      defaults: {\n        isMultiColor: true,\n        multicolorRange: 196,\n        multicolorStart: 273,\n        color: '#ffffff',\n        multicolorByLightness: true,\n        minLightness: 10,\n        maxLightness: 90,\n      },\n      exclude: ['colorCount'],\n    }),\n  ];\n\n  defaultValues = {\n    base: 2,\n    rotation: 176 / 360,\n  };\n\n  getCalc(options: CalcOptions): MandalaCalc {\n    const { n, layerSpread } = this.config;\n\n    return {\n      ...super.getCalc(options),\n      layerShift: Math.round(n * layerSpread),\n    };\n  }\n\n  *drawStrings(renderer: Renderer) {\n    const { layers } = this.config;\n\n    for (let layer = 0; layer < layers; layer++) {\n      yield* this.drawLayer(renderer, layer);\n    }\n  }\n}\n","import Color from '../helpers/color/Color';\nimport StringArt from '../infra/StringArt';\nimport Circle, { CircleConfig } from '../shapes/Circle';\nimport { ColorConfig } from '../helpers/color/color.types';\nimport { ControlsConfig } from '../types/config.types';\nimport Renderer from '../infra/renderers/Renderer';\nimport { CalcOptions } from '../types/stringart.types';\nimport INails from '../infra/nails/INails';\n\nexport interface MandalaConfig extends ColorConfig {\n  n: number;\n  base: number;\n  layers: number;\n  rotation: number;\n  distortion: number;\n  layerFill?: number;\n  reverse?: boolean;\n}\n\nexport interface MandalaCalc {\n  n: number;\n  stringsPerLayer: number;\n  layerShift: number;\n  circle: Circle;\n}\n\nexport default class Mandala<TCustomConfig = void> extends StringArt<\n  MandalaConfig & TCustomConfig,\n  MandalaCalc\n> {\n  static type = 'mandala';\n\n  name = 'Mandala';\n  id = 'mandala';\n  link = 'https://www.youtube.com/watch?v=qhbuKbxJsk8';\n  linkText = 'Learn';\n  controls: ControlsConfig<MandalaConfig & TCustomConfig> = [\n    {\n      key: 'n',\n      label: 'Number of nails',\n      defaultValue: 180,\n      type: 'range',\n      attr: { min: 3, max: 240, step: 1 },\n      isStructural: true,\n    },\n    {\n      key: 'base',\n      label: 'Multiplication',\n      defaultValue: 2,\n      type: 'range',\n      attr: { min: 2, max: 99, step: 1 },\n      affectsNails: false,\n    },\n    {\n      key: 'layers',\n      label: 'Layers',\n      defaultValue: 7,\n      type: 'range',\n      attr: { min: 1, max: 20, step: 1 },\n      isStructural: true,\n    },\n    Circle.rotationConfig,\n    Circle.distortionConfig,\n    Color.getConfig({\n      defaults: {\n        isMultiColor: true,\n        multicolorRange: 165,\n        multicolorStart: 256,\n        color: '#ff4d00',\n      },\n      exclude: ['colorCount'],\n    }),\n  ];\n\n  color: Color;\n\n  get n() {\n    return this.calc.n;\n  }\n\n  getCalc({ size }: CalcOptions): MandalaCalc {\n    const {\n      n: nConfig,\n      layers,\n      layerFill,\n      rotation,\n      distortion,\n      margin,\n      reverse,\n    } = this.config;\n    const extraNails = nConfig % layers;\n    const n = nConfig - extraNails; // The number of nails should be a multiple of the layers, so the strings are exactly on the nails.\n\n    const circleConfig: CircleConfig = {\n      size,\n      n,\n      margin,\n      rotation,\n      distortion,\n      reverse,\n    };\n\n    return {\n      n,\n      stringsPerLayer: layerFill ? Math.floor(n * layerFill) : n,\n      layerShift: Math.floor(n / layers),\n      circle: new Circle(circleConfig),\n    };\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n\n    const { layers } = this.config;\n\n    this.color = new Color({\n      ...this.config,\n      colorCount: layers,\n    });\n  }\n\n  getAspectRatio(options: CalcOptions): number {\n    const calc = this.getCalc(options);\n    return calc.circle.getAspectRatio();\n  }\n\n  *drawLayer(renderer: Renderer, layerIndex: number): Generator<void> {\n    const { reverse, base } = this.config;\n    const { n, layerShift, stringsPerLayer } = this.calc;\n\n    const shift = layerShift * layerIndex * (reverse ? 1 : -1);\n    const color = this.color.getColor(layerIndex);\n    renderer.setColor(color);\n\n    let point = this.calc.circle.getPoint(shift);\n\n    for (let i = 1; i <= stringsPerLayer; i++) {\n      const startPoint = point;\n      point = this.calc.circle.getPoint(i + shift);\n      const toIndex = (i * base) % n;\n      renderer.renderLine(startPoint, point);\n\n      yield;\n\n      renderer.renderLine(point, this.calc.circle.getPoint(toIndex + shift));\n      yield;\n    }\n  }\n\n  *drawStrings(renderer: Renderer): Generator<void> {\n    const { layers } = this.config;\n\n    for (let layer = 0; layer < layers; layer++) {\n      yield* this.drawLayer(renderer, layer);\n    }\n  }\n\n  drawNails(nails: INails) {\n    this.calc.circle.drawNails(nails);\n  }\n\n  getStepCount(options: CalcOptions): number {\n    const { layers, layerFill } = this.config;\n    const { n } = this.getCalc(options);\n    const stringsPerLayer = layerFill ? Math.floor(n * layerFill) : n;\n    return (layers ?? 1) * stringsPerLayer * 2;\n  }\n\n  getNailCount(): number {\n    const { n: nConfig, layers } = this.config;\n\n    const extraNails = nConfig % layers;\n    return nConfig - extraNails;\n  }\n\n  // @ts-ignore\n  thumbnailConfig = ({ n }) => ({\n    n: Math.min(n, 70),\n  });\n}\n","import { createArray } from '../helpers/array_utils';\nimport Color from '../helpers/color/Color';\nimport { ColorConfig, ColorValue } from '../helpers/color/color.types';\nimport { getCenter } from '../helpers/size_utils';\nimport INails from '../infra/nails/INails';\nimport Renderer from '../infra/renderers/Renderer';\nimport StringArt from '../infra/StringArt';\nimport { Config, ControlsConfig } from '../types/config.types';\nimport { Coordinates, Dimensions } from '../types/general.types';\nimport { CalcOptions } from '../types/stringart.types';\n\ntype Side = 'left' | 'bottom' | 'right' | 'top';\nconst SIDES: [Side, Side, Side, Side] = ['left', 'bottom', 'right', 'top'];\nconst SIDES_ORDER: [Side, Side, Side, Side] = [\n  'left',\n  'bottom',\n  'right',\n  'top',\n];\n\nconst SIDES_ROTATION = {\n  left: 0,\n  bottom: Math.PI / 2,\n  right: Math.PI,\n  top: Math.PI * 1.5,\n};\n\ninterface EyeConfig extends ColorConfig {\n  n: number;\n  layers: number;\n  angle: number;\n  colorPerLayer: boolean;\n}\n\ninterface Layer {\n  layerAngle: number;\n  layerSize: number;\n  layerStart: Coordinates;\n  layerSideNailCount: number;\n}\ninterface TCalc {\n  maxSize: number;\n  nailSpacing: number;\n  layerAngle: number;\n  layers: ReadonlyArray<Layer>;\n  center: Coordinates;\n}\n\nclass Eye extends StringArt<EyeConfig, TCalc> {\n  static type = 'eye';\n\n  name = 'Eye';\n  id = 'eye';\n  link =\n    'https://www.etsy.com/listing/489853161/rose-of-space-string-art-sacred-geometry?ga_order=most_relevant&ga_search_type=all&ga_view_type=gallery&ga_search_query=string+art&ref=sr_gallery_1&epik=dj0yJnU9WXNpM1BDTnNkLVBtcWdCa3AxN1J5QUZRY1FlbkJ5Z18mcD0wJm49ZXdJb2JXZmVpNVVwN1NKQ3lXMy10ZyZ0PUFBQUFBR0ZuUzZv';\n  controls: ControlsConfig<EyeConfig> = [\n    {\n      key: 'n',\n      label: 'Number of nails per side',\n      defaultValue: 82,\n      type: 'range',\n      attr: { min: 2, max: 200, step: 1 },\n      isStructural: true,\n    },\n    {\n      key: 'layers',\n      label: 'Layers',\n      defaultValue: 13,\n      type: 'range',\n      attr: { min: 1, max: 20, step: 1 },\n      isStructural: true,\n    },\n    {\n      key: 'angle',\n      label: 'Layer angle',\n      defaultValue: 30,\n      displayValue: ({ angle }) => `${angle}`,\n      type: 'range',\n      attr: { min: 0, max: 45, step: 1 },\n      isStructural: true,\n    },\n    Color.getConfig({\n      defaults: {\n        isMultiColor: true,\n        color: '#ffffff',\n        multicolorRange: 107,\n        multicolorStart: 226,\n        multicolorByLightness: false,\n        minLightness: 40,\n        maxLightness: 50,\n        colorCount: 2,\n      },\n      customControls: [\n        {\n          key: 'colorPerLayer',\n          label: 'Color per layer',\n          defaultValue: false,\n          type: 'checkbox',\n          show: ({ isMultiColor }) => isMultiColor,\n          affectsNails: false,\n        },\n      ],\n      exclude: ['colorCount', 'repeatColors'],\n    }),\n  ];\n\n  defaultValues: Partial<Config<EyeConfig>> = {\n    nailsColor: '#000000',\n  };\n\n  color: Color;\n\n  getCalc({ size }: CalcOptions): TCalc {\n    const { n, angle, layers, margin } = this.config;\n    const center = getCenter(size);\n\n    const maxSize = Math.min(...size) - 2 * margin;\n    const nailSpacing = maxSize / (n - 1);\n    const layerAngle = (angle * Math.PI) / 180;\n\n    const getLayerProps = (layerIndex: number): Layer => {\n      const layerSize =\n        maxSize /\n        Math.pow(Math.cos(layerAngle) + Math.sin(layerAngle), layerIndex);\n      const layerStart: Coordinates = [\n        center[0] - layerSize / 2,\n        center[1] - layerSize / 2,\n      ];\n      const layerSideNailCount = Math.floor(layerSize / nailSpacing);\n\n      return {\n        layerAngle: layerAngle * layerIndex,\n        layerSize,\n        layerStart,\n        layerSideNailCount,\n      };\n    };\n\n    return {\n      maxSize,\n      nailSpacing,\n      layerAngle,\n      layers: createArray(layers, layerIndex => getLayerProps(layerIndex)),\n      center,\n    };\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n    this.color = new Color({\n      ...this.config,\n      repeatColors: true,\n      colorCount: 2,\n    });\n  }\n\n  getAspectRatio(): number {\n    return 1;\n  }\n\n  // Sides: top, right, bottom, left\n  getPoint({\n    index,\n    angle,\n    layerStart,\n    rotation,\n  }: {\n    index: number;\n    angle: number;\n    layerStart: Coordinates;\n    rotation: number;\n  }): Coordinates {\n    const theta = angle + rotation;\n\n    const point: Coordinates = [\n      layerStart[0],\n      layerStart[1] + this.calc.nailSpacing * index,\n    ];\n\n    const pivot = this.calc.center;\n\n    const cosAngle = Math.cos(theta);\n    const sinAngle = Math.sin(theta);\n\n    return [\n      cosAngle * (point[0] - pivot[0]) -\n        sinAngle * (point[1] - pivot[1]) +\n        pivot[0],\n      sinAngle * (point[0] - pivot[0]) +\n        cosAngle * (point[1] - pivot[1]) +\n        pivot[1],\n    ];\n  }\n\n  *drawSide(\n    renderer: Renderer,\n    {\n      side,\n      color = '#ffffff',\n      angle,\n      size,\n      layerStart,\n      layerSideNailCount,\n    }: {\n      side: Side;\n      color: ColorValue;\n      angle: number;\n      size: number;\n      layerStart: Coordinates;\n      layerSideNailCount: number;\n    }\n  ): Generator<void> {\n    const sideIndex = SIDES.indexOf(side);\n    const nextSide = SIDES[sideIndex === SIDES.length - 1 ? 0 : sideIndex + 1];\n    const rotation = SIDES_ROTATION[side];\n    const nextSideRotation = SIDES_ROTATION[nextSide];\n\n    const sideProps = { layerSideNailCount, size, layerStart, angle };\n    renderer.setColor(color);\n\n    for (let i = 0; i <= layerSideNailCount; i++) {\n      renderer.renderLine(\n        this.getPoint({ index: i, rotation, ...sideProps }),\n        this.getPoint({\n          index: i,\n          rotation: nextSideRotation,\n          ...sideProps,\n        })\n      );\n\n      yield;\n    }\n  }\n\n  *drawLayer(renderer: Renderer, layerIndex: number): Generator<void> {\n    const { colorPerLayer } = this.config;\n\n    const { layerAngle, layerSize, layerStart, layerSideNailCount } =\n      this.calc.layers[layerIndex];\n\n    for (let i = 0; i < SIDES.length; i++) {\n      yield* this.drawSide(renderer, {\n        color: this.color.getColor(colorPerLayer ? layerIndex : i),\n        side: SIDES_ORDER[i],\n        angle: layerAngle,\n        size: layerSize,\n        layerStart,\n        layerSideNailCount,\n      });\n    }\n  }\n\n  *drawStrings(renderer: Renderer) {\n    const { layers } = this.config;\n    for (let layer = layers - 1; layer >= 0; layer--) {\n      yield* this.drawLayer(renderer, layer);\n    }\n  }\n\n  getStepCount({ size }: CalcOptions) {\n    let count = 0;\n    const { layers, angle, n, margin } = this.config;\n    const layerAngle = (angle * Math.PI) / 180;\n    const maxSize = Math.min(...size) - 2 * margin;\n    const nailSpacing = maxSize / (n - 1);\n\n    for (let layer = 0; layer < layers; layer++) {\n      const layerSize =\n        maxSize / Math.pow(Math.cos(layerAngle) + Math.sin(layerAngle), layer);\n      count += 4 * (Math.floor(layerSize / nailSpacing) + 1);\n    }\n\n    return count;\n  }\n\n  // getNailCount(size: Dimensions): number {\n  //   return this.#getNailCount(this.calc ?? this.getCalc({ size }));\n  // }\n\n  // #getNailCount({ layers }: TCalc): number {\n  //   return layers.reduce(\n  //     (nailCount: number, layer) =>\n  //       nailCount + (layer.layerSideNailCount + 1) * SIDES.length,\n  //     0\n  //   );\n  // }\n  drawNails(nails: INails) {\n    const { layers } = this.config;\n\n    let nailIndex = 0;\n    for (let layer = layers - 1; layer >= 0; layer--) {\n      const {\n        layerAngle: angle,\n        layerSize: size,\n        layerStart,\n        layerSideNailCount,\n      } = this.calc.layers[layer];\n\n      for (let s = 0; s < SIDES.length; s++) {\n        const sideOrder = SIDES_ORDER[s];\n        const rotation = SIDES_ROTATION[sideOrder];\n\n        for (let i = 0; i <= layerSideNailCount; i++) {\n          const sideProps = { layerSideNailCount, size, layerStart, angle };\n          nails.addNail(\n            this.#getPointKey(layer, s, i),\n            this.getPoint({\n              index: i,\n              rotation,\n              ...sideProps,\n            })\n          );\n          nailIndex++;\n        }\n      }\n    }\n  }\n\n  #getPointKey(layer: number, side: number, index: number): string {\n    return `${layer}_${side}_${index}`;\n  }\n\n  thumbnailConfig = ({ n, layers }) => ({\n    n: Math.min(n, 25),\n    layers: Math.min(layers, 7),\n  });\n}\n\nexport default Eye;\n","import StringArt from '../infra/StringArt';\nimport Circle, { CircleConfig } from '../shapes/Circle';\nimport StarShape, { StarShapeConfig } from '../shapes/StarShape';\nimport { ColorValue } from '../helpers/color/color.types';\nimport { withoutAttribute } from '../helpers/config_utils';\nimport Renderer from '../infra/renderers/Renderer';\nimport { ControlsConfig, GroupValue } from '../types/config.types';\nimport { Coordinates } from '../types/general.types';\nimport { CalcOptions } from '../types/stringart.types';\nimport INails from '../infra/nails/INails';\n\ninterface StarConfig {\n  sides: number;\n  sideNails: number;\n  centerRadius: number;\n  ringSize: number;\n  rotation: number;\n  distortion: number;\n  innerColor: ColorValue;\n  outerColor: ColorValue;\n  ringColor: ColorValue;\n  colorGroup: GroupValue;\n  isSingleColor: boolean;\n  singleColor: ColorValue;\n  renderStar: boolean;\n}\n\ntype TCalc = {\n  circle: Circle;\n  star: StarShape;\n};\n\nexport default class Star extends StringArt<StarConfig, TCalc> {\n  static type = 'star';\n\n  name = 'Star';\n  id = 'star';\n  link =\n    'https://www.etsy.com/listing/557818258/string-art-meditation-geometric-yoga?epik=dj0yJnU9Mm1hYmZKdks1eTc3bVY2TkVhS2p2Qlg0N2dyVWJxaTEmcD0wJm49MGlWSXE1SVJ2Vm0xZ0xtaGhITDBWQSZ0PUFBQUFBR0Zwd2lj';\n  controls: ControlsConfig<StarConfig> = [\n    {\n      key: 'sides',\n      label: 'Sides',\n      defaultValue: 3,\n      type: 'range',\n      attr: { min: 3, max: 20, step: 1 },\n      isStructural: true,\n    },\n    {\n      key: 'sideNails',\n      label: 'Nails per side',\n      defaultValue: 40,\n      type: 'range',\n      attr: { min: 1, max: 200, step: 1 },\n      isStructural: true,\n    },\n    StarShape.centerRadiusConfig,\n    {\n      key: 'ringSize',\n      label: 'Outer ring size',\n      defaultValue: 0.1,\n      type: 'range',\n      attr: {\n        min: 0,\n        max: 0.5,\n        step: ({ sideNails, sides }) => 1 / (sideNails * sides),\n      },\n      displayValue: ({ sideNails, sides, ringSize }) =>\n        Math.floor(ringSize * sideNails * sides),\n      affectsNails: false,\n    },\n    withoutAttribute<StarConfig>(Circle.rotationConfig, 'snap'),\n    Circle.distortionConfig,\n    {\n      key: 'renderStar',\n      label: 'Show star',\n      type: 'checkbox',\n      defaultValue: true,\n      affectsNails: false,\n      isStructural: true,\n    },\n    {\n      key: 'colorGroup',\n      label: 'Color',\n      type: 'group',\n      children: [\n        {\n          key: 'isSingleColor',\n          label: 'Is single color',\n          type: 'checkbox',\n          defaultValue: false,\n          affectsNails: false,\n          affectsStepCount: false,\n        },\n        {\n          key: 'singleColor',\n          label: 'Color',\n          defaultValue: '#2ec0ff',\n          type: 'color',\n          affectsNails: false,\n          affectsStepCount: false,\n          show: ({ isSingleColor }) => isSingleColor,\n        },\n        {\n          key: 'innerColor',\n          label: 'Star color',\n          defaultValue: '#2ec0ff',\n          type: 'color',\n          affectsNails: false,\n          affectsStepCount: false,\n          show: ({ isSingleColor, renderStar }) => !isSingleColor && renderStar,\n        },\n        {\n          key: 'outerColor',\n          label: 'Outter color',\n          defaultValue: '#2a82c6',\n          type: 'color',\n          affectsNails: false,\n          affectsStepCount: false,\n          show: ({ isSingleColor }) => !isSingleColor,\n        },\n        {\n          key: 'ringColor',\n          label: 'Ring color',\n          defaultValue: '#2ec0ff',\n          type: 'color',\n          affectsNails: false,\n          affectsStepCount: false,\n          show: ({ isSingleColor }) => !isSingleColor,\n        },\n      ],\n    },\n  ];\n\n  getCalc({ size }: CalcOptions): TCalc {\n    const { sides, rotation, distortion, sideNails, margin = 0 } = this.config;\n    const circleConfig: CircleConfig = {\n      size: size,\n      n: sides * (sideNails - 1),\n      margin,\n      rotation: rotation ? rotation / sides : 0,\n      distortion,\n    };\n\n    const circle = new Circle(circleConfig);\n\n    const starConfig: StarShapeConfig = {\n      ...this.config,\n      radius: circle.radius,\n      size,\n    };\n\n    return {\n      circle,\n      star: new StarShape(starConfig),\n    };\n  }\n\n  getAspectRatio(options: CalcOptions): number {\n    const { circle, star } = this.getCalc(options);\n    const circleRect = circle.getBoundingRect();\n    const starRect = star.getBoundingRect();\n    const width = Math.max(circleRect.width, starRect.width);\n    const height = Math.max(circleRect.height, starRect.height);\n\n    return width / height;\n  }\n\n  getArcPoint({\n    side,\n    sideIndex,\n  }: {\n    side: number;\n    sideIndex: number;\n  }): Coordinates {\n    return this.calc.circle.getPoint(\n      side * (this.config.sideNails - 1) + sideIndex\n    );\n  }\n\n  *drawStar(renderer: Renderer): Generator<void> {\n    const { innerColor, isSingleColor } = this.config;\n\n    if (!isSingleColor) {\n      renderer.setColor(innerColor);\n    }\n    yield* this.calc.star.drawStrings(renderer);\n  }\n\n  *drawCircle(renderer: Renderer): Generator<void> {\n    const { outerColor, sides, sideNails, isSingleColor } = this.config;\n    const { star } = this.calc;\n\n    if (!isSingleColor) {\n      renderer.setColor(outerColor);\n    }\n    let alternate = false;\n    let isStar = false;\n\n    const rounds = sides % 2 ? Math.ceil(sideNails / 2) : sideNails - 1;\n    let side = 0;\n    const linesPerRound = sides % 2 ? sides * 4 : sides * 2;\n\n    renderer.setStartingPoint(star.getSidePoint(0, 0));\n\n    for (let round = 0; round < rounds; round++) {\n      const isLastRound = round === rounds - 1;\n\n      const linesThisRound =\n        sides % 2 && (round === 0 || (isLastRound && sideNails % 2))\n          ? linesPerRound - 2 * sides\n          : linesPerRound;\n\n      for (let i = 0; i < linesThisRound; i++) {\n        const pointPosition = {\n          side,\n          sideIndex: alternate ? sideNails - round - 1 : round,\n        };\n\n        const nextPoint = isStar\n          ? star.getSidePoint(pointPosition.side, pointPosition.sideIndex)\n          : this.getArcPoint(pointPosition);\n\n        renderer.lineTo(nextPoint);\n\n        yield;\n        isStar = !isStar;\n\n        if (isStar) {\n          side = (side + 1) % sides;\n          alternate = !alternate;\n        }\n      }\n      if (!isLastRound) {\n        renderer.lineTo(star.getSidePoint(0, round + 1));\n        yield;\n        isStar = false;\n        alternate = false;\n      }\n    }\n\n    renderer.endLayer();\n  }\n\n  *drawStrings(renderer: Renderer): Generator<void> {\n    const {\n      ringSize,\n      ringColor,\n      isSingleColor,\n      singleColor,\n      renderStar = true,\n    } = this.config;\n    if (isSingleColor) {\n      renderer.setColor(singleColor);\n    }\n\n    yield* this.drawCircle(renderer);\n\n    if (ringSize !== 0) {\n      yield* this.calc.circle.drawRing(renderer, {\n        ringSize,\n        color: isSingleColor ? null : ringColor,\n      });\n    }\n    if (renderStar) {\n      yield* this.drawStar(renderer);\n    }\n  }\n\n  drawNails(nails: INails): void {\n    this.calc.circle.drawNails(nails);\n    this.calc.star.drawNails(nails, {\n      getUniqueKey: k => this.calc.circle.config.n + k,\n    });\n  }\n\n  getStepCount(options: CalcOptions): number {\n    const { ringSize, sides, sideNails, renderStar } = this.config;\n\n    const calc = this.getCalc(options);\n    const ringCount = ringSize ? calc.circle.getRingStepCount() : 0;\n    const circleRounds = sides % 2 ? Math.ceil(sideNails / 2) : sideNails - 1;\n    const circleLinesPerRound = sides % 2 ? sides * 4 : sides * 2;\n    const circleStepsToRemove =\n      sides % 2 ? sides * 2 + (sideNails % 2 ? sides * 2 : 0) : 0;\n    const circleCount =\n      circleRounds * (circleLinesPerRound + 1) - circleStepsToRemove - 1;\n    const starCount = renderStar ? StarShape.getStepCount(this.config) : 0;\n    return circleCount + ringCount + starCount;\n  }\n\n  getNailCount(): number {\n    const { sides, sideNails, centerRadius } = this.config;\n    const circleNails = sides * (sideNails - 1);\n    return (\n      sides * (sideNails - 1) + circleNails - (centerRadius ? 0 : sides - 1)\n    );\n  }\n\n  thumbnailConfig = ({ sideNails }) => ({\n    sideNails: Math.min(sideNails, 18),\n  });\n\n  testStepCountConfig: Partial<StarConfig>[] = [\n    {\n      sides: 3,\n      sideNails: 4,\n      ringSize: 0,\n      renderStar: false,\n    },\n    {\n      sides: 3,\n      sideNails: 11,\n      ringSize: 0,\n      renderStar: false,\n    },\n    {\n      sides: 4,\n      sideNails: 11,\n      ringSize: 0,\n      renderStar: false,\n    },\n    {\n      sides: 4,\n      sideNails: 10,\n      ringSize: 0,\n      renderStar: false,\n    },\n  ];\n}\n","import Renderer from '../infra/renderers/Renderer';\nimport { ControlConfig, ControlsConfig } from '../types/config.types';\nimport { BoundingRect, Coordinates, Dimensions } from '../types/general.types';\nimport { compareObjects } from '../helpers/object_utils';\nimport Polygon from './Polygon';\nimport {\n  formatFractionAsAngle,\n  formatFractionAsPercent,\n} from '../helpers/string_utils';\nimport type Shape from './Shape';\nimport { getBoundingRectAspectRatio, getCenter } from '../helpers/size_utils';\nimport INails from '../infra/nails/INails';\nimport { ShapeNailsOptions } from './Shape';\n\nexport interface StarShapeConfig {\n  sideNails: number;\n  sides: number;\n  maxCurveSize?: number;\n  centerRadius?: number;\n  rotation?: number;\n  center?: Coordinates;\n  size?: Dimensions;\n  radius?: number;\n  sidesCenterRadiusShift?: number[];\n}\n\nexport default class StarShape implements Shape {\n  config: StarShapeConfig;\n  center: Coordinates;\n  calc: ReturnType<typeof StarShape.getCalc>;\n\n  constructor(config: StarShapeConfig) {\n    this.setConfig(config);\n  }\n\n  static getCalc({\n    radius,\n    sides,\n    sideNails,\n    rotation,\n    centerRadius: centerRadiusFraction = 0,\n    maxCurveSize = 1,\n    sidesCenterRadiusShift,\n  }: StarShapeConfig) {\n    const centerRadius = radius * centerRadiusFraction;\n    const nailSpacing = (radius - centerRadius) / (sideNails - 1); // The distance between nails on the same side, in px\n    const sidesAngle = (Math.PI * 2) / sides; // The angle, in radians, between each side\n    const rotationAngle = rotation ? (-Math.PI * 2 * rotation) / sides : 0;\n\n    return {\n      sideAngle: sidesAngle,\n      nailSpacing,\n      centerRadius,\n      linesPerRound: sides % 2 ? sides * 2 : sides,\n      sidesConnectionCount: Math.floor(Math.min(1, maxCurveSize) * sideNails),\n      sideSize: radius - centerRadius,\n      sides: new Array(sides).fill(null).map((_, side) => {\n        const sideAngle = side * sidesAngle + rotationAngle;\n\n        return {\n          sinSideAngle: Math.sin(sideAngle),\n          cosSideAngle: Math.cos(sideAngle),\n        };\n      }),\n      sidesCenterRadius: sidesCenterRadiusShift\n        ? sidesCenterRadiusShift.map(v => centerRadius * v)\n        : null,\n    };\n  }\n\n  getPoint(index: number): Coordinates {\n    const position = index / this.config.sideNails;\n    const side = Math.floor(position);\n    const sideIndex = index % this.config.sideNails;\n\n    return this.getSidePoint(side, sideIndex);\n  }\n\n  getSidePoint(side = 0, index = 0): Coordinates {\n    const radius =\n      this.calc.centerRadius +\n      index * this.calc.nailSpacing -\n      (this.calc.sidesCenterRadius?.[side] ?? 0);\n    const { sinSideAngle, cosSideAngle } = this.calc.sides[side];\n\n    return [\n      this.center[0] + sinSideAngle * radius,\n      this.center[1] + cosSideAngle * radius,\n    ];\n  }\n\n  setConfig(config: StarShapeConfig) {\n    if (\n      compareObjects(config, this.config, [\n        'radius',\n        'sides',\n        'sideNails',\n        'rotation',\n        'center',\n        'size',\n        'centerRadius',\n        'maxCurveSize',\n      ])\n    ) {\n      return;\n    }\n\n    if (!config.center && !config.size) {\n      throw new Error(\n        'StarShape requires a config value for either center or size.'\n      );\n    }\n\n    const center = config.center ?? getCenter(config.size);\n\n    this.config = config;\n    this.center = center;\n    this.calc = StarShape.getCalc(config);\n  }\n\n  /**\n   * Given a Nails instance, uses it to draw the nails of this Circle\n   */\n  drawNails(\n    nails: INails,\n    {\n      reverseOrder,\n      getUniqueKey,\n    }: // excludeSides,\n    ShapeNailsOptions &\n      Partial<{\n        reverseOrder?: boolean;\n      }> = {}\n  ): void {\n    const { sides, sideNails, centerRadius } = this.config;\n    const renderCenterNail = centerRadius == null || centerRadius === 0;\n    let nailIndex = 0;\n    if (renderCenterNail) {\n      nails.addNail(\n        getUniqueKey?.(nailIndex) ?? nailIndex,\n        this.getSidePoint(0, 0)\n      );\n      nailIndex++;\n    }\n\n    for (let side = 0; side < sides; side++) {\n      for (let i = renderCenterNail ? 1 : 0; i < sideNails; i++) {\n        const sideIndex = reverseOrder ? sideNails - i : i;\n        nails.addNail(\n          getUniqueKey?.(nailIndex) ?? nailIndex,\n          this.getSidePoint(side, sideIndex)\n        );\n        nailIndex++;\n      }\n    }\n  }\n\n  getNailCount(): number {\n    const { sides, sideNails, centerRadius } = this.config;\n    const renderCenterNail = centerRadius == null || centerRadius === 0;\n\n    return sides * sideNails - (renderCenterNail ? sides - 1 : 0);\n  }\n\n  // In this pattern, strings are connected in a \"merry-go-round\" way, around the star.\n  // With even sides count, the strings go around the star once, while with odd sides count, each round goes twice around the star.\n  // The threading is: star at the center (or centerRadius, if > 0), then next side at the edge (outtermost nail) or the size param which represents the count of nails to use,\n  // then back to the center for the next side,   // until all sides have been connected both center and edge (for odd-side-count stars) or until all sides have been\n  // connected (for odd-side-count), then move up one nail from the center and start another round.\n  *drawStrings(\n    renderer: Renderer,\n    { size }: { size?: number } = {}\n  ): Generator<void> {\n    const { sideNails: sideNailsConfig, sides } = this.config;\n    const { sidesConnectionCount, linesPerRound } = this.calc;\n\n    const sideNails = size\n      ? Math.max(1, Math.min(Math.floor(size), sideNailsConfig))\n      : sideNailsConfig;\n\n    const minNailIndex = Math.max(0, sideNails - sidesConnectionCount);\n\n    let alternate = false;\n\n    const rounds =\n      sides % 2\n        ? Math.ceil(Math.min(sideNails, sidesConnectionCount) / 2)\n        : sideNails - minNailIndex;\n\n    let prevPointIndex = minNailIndex;\n    let prevPoint = this.getSidePoint(0, prevPointIndex);\n\n    for (let round = 0; round < rounds; round++) {\n      const isLastRound = round === rounds - 1;\n      let side = 0;\n\n      for (let i = 0; i < linesPerRound; i++) {\n        side = (side + 1) % sides;\n        alternate = !alternate;\n        prevPointIndex = alternate\n          ? sideNails - round - 1\n          : round + minNailIndex;\n        const nextPoint = this.getSidePoint(side, prevPointIndex);\n        renderer.renderLine(prevPoint, nextPoint);\n        prevPoint = nextPoint;\n        yield;\n\n        if (isLastRound && i === sides - 1 && sides % 2 && sideNails % 2) {\n          break;\n        }\n      }\n\n      if (!isLastRound) {\n        prevPointIndex = alternate ? prevPointIndex - 1 : prevPointIndex + 1;\n        const nextPoint = this.getSidePoint(0, prevPointIndex);\n        renderer.renderLine(prevPoint, nextPoint);\n        prevPoint = nextPoint;\n      }\n    }\n  }\n\n  getStepCount(size?: number) {\n    return StarShape.getStepCount(this.config, { size });\n  }\n\n  static getStepCount(\n    {\n      sides,\n      sideNails: sideNailsConfig,\n      maxCurveSize = 1,\n    }: Partial<StarShapeConfig>,\n    { size }: { size?: number } = {}\n  ) {\n    const sidesConnectionCount = Math.floor(\n      Math.min(1, maxCurveSize) * sideNailsConfig\n    );\n    const sideNails = size\n      ? Math.min(Math.floor(size), sideNailsConfig)\n      : sideNailsConfig;\n    const minNailIndex = Math.max(0, sideNails - sidesConnectionCount);\n\n    const rounds =\n      sides % 2\n        ? Math.ceil(Math.min(sideNails, sidesConnectionCount) / 2)\n        : sideNails - minNailIndex;\n\n    const linesPerRound = sides % 2 ? sides * 2 : sides;\n    const isOdd = sides % 2 && sideNails % 2;\n    return rounds * linesPerRound - (isOdd ? sides : 0);\n  }\n\n  getBoundingRect(): BoundingRect {\n    const { radius, sides, rotation, sideNails } = this.config;\n    const polygon = new Polygon({\n      size: [radius * 2, radius * 2],\n      sides,\n      nailsPerSide: sideNails,\n      margin: 0,\n      rotation,\n    });\n\n    return polygon.getBoundingRect();\n  }\n\n  getAspectRatio(): number {\n    return getBoundingRectAspectRatio(this.getBoundingRect());\n  }\n\n  static nailsConfig: ControlConfig<StarShapeConfig> = Object.freeze({\n    key: 'sideNails',\n    label: 'Nails per side',\n    defaultValue: 40,\n    type: 'range',\n    attr: { min: 1, max: 200, step: 1 },\n    isStructural: true,\n  });\n\n  static sidesConfig: ControlConfig<StarShapeConfig> = Object.freeze({\n    key: 'sides',\n    label: 'Sides',\n    defaultValue: 3,\n    type: 'range',\n    attr: { min: 3, max: 40, step: 1 },\n    isStructural: true,\n  });\n\n  static maxCurveSize: ControlConfig<StarShapeConfig> = {\n    key: 'maxCurveSize',\n    label: 'Max curve size',\n    description:\n      'The maximum number of connections used to create a curve between two sides.',\n    defaultValue: 1,\n    type: 'range',\n    displayValue: ({ maxCurveSize, sideNails }) =>\n      Math.floor(maxCurveSize * sideNails),\n    attr: {\n      min: 0,\n      max: 1,\n      step: ({ sideNails }) => 1 / sideNails,\n    },\n    isStructural: true,\n  };\n\n  static centerRadiusConfig: ControlConfig<StarShapeConfig> = {\n    key: 'centerRadius',\n    label: 'Center radius',\n    defaultValue: 0,\n    type: 'range',\n    attr: {\n      min: 0,\n      max: ({ sideNails }) => (sideNails - 1) / sideNails,\n      step: 0.01,\n    },\n    displayValue: ({ centerRadius }) => formatFractionAsPercent(centerRadius),\n    isStructural: true,\n  };\n\n  static rotationConfig: ControlConfig<StarShapeConfig> = {\n    key: 'rotation',\n    label: 'Rotation',\n    defaultValue: 0,\n    type: 'range',\n    attr: {\n      min: 0,\n      max: 1,\n      step: 0.01,\n      snap: '0.5',\n    },\n    displayValue: ({ rotation, sides }) =>\n      formatFractionAsAngle(rotation / sides),\n    isStructural: true,\n    affectsStepCount: false,\n  };\n\n  static StarConfig: ControlsConfig<StarShapeConfig> = [\n    StarShape.nailsConfig,\n    StarShape.sidesConfig,\n    StarShape.centerRadiusConfig,\n    StarShape.maxCurveSize,\n    StarShape.rotationConfig,\n  ];\n}\n","import StringArt from '../infra/StringArt';\nimport Circle, { CircleConfig } from '../shapes/Circle';\nimport Renderer from '../infra/renderers/Renderer';\nimport { ControlsConfig, GroupValue } from '../types/config.types';\nimport { Coordinates, Dimensions } from '../types/general.types';\nimport { CalcOptions } from '../types/stringart.types';\nimport Nails from '../infra/nails/Nails';\nimport { PI2 } from '../helpers/math_utils';\nimport { formatFractionAsPercent } from '../helpers/string_utils';\nimport NailsGroup from '../infra/nails/NailsGroup';\nimport INails from '../infra/nails/INails';\n\nconst LAYER_DEFAULTS = [\n  { size: 0.25, end: 1, color: '#a94fb0' },\n  { size: 0.125, end: 0.888, color: '#ec6ad0' },\n  { size: 0, end: 0.826, color: '#f08ad5', reverse: true },\n];\n\ninterface AssymetryConfig extends CircleConfig {\n  layers: GroupValue;\n  layer1: GroupValue;\n  show1: boolean;\n  size1: number;\n  end1: number;\n  color1: number;\n  reverse1: number;\n\n  layer2: GroupValue;\n  show2: boolean;\n  size2: number;\n  end2: number;\n  color2: number;\n  reverse2: number;\n\n  layer3: GroupValue;\n  show3: boolean;\n  size3: number;\n  end3: number;\n  color3: number;\n  reverse3: number;\n\n  distortion: number;\n}\n\ninterface Layer {\n  enable: boolean;\n  size: number;\n  endIndex: number;\n  color: number;\n  isReverse: number;\n}\n\ninterface TCalc {\n  circle: Circle;\n  lineSpacing: number;\n  lineNailCount: number;\n  firstCirclePoint: Coordinates;\n  layers: ReadonlyArray<Layer>;\n  totalNailCount: number;\n  totalIndexCount: number;\n}\n\nexport default class Assymetry extends StringArt<AssymetryConfig, TCalc> {\n  static type = 'assymetry';\n\n  name = 'Assymetry';\n  id = 'assymetry';\n  link =\n    'https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for';\n  controls: ControlsConfig<AssymetryConfig> = [\n    Circle.nailsConfig,\n    Circle.rotationConfig,\n    Circle.distortionConfig,\n    {\n      key: 'layers',\n      label: 'Layers',\n      type: 'group',\n      // @ts-expect-error: dynamic key is safe because we know the keys match Layers\n      children: LAYER_DEFAULTS.map(({ size, end, color, reverse }, i) => {\n        const layer = i + 1;\n        return {\n          key: `layer${layer}`,\n          label: `Layer ${layer}`,\n          type: 'group',\n          children: [\n            {\n              key: `show${layer}`,\n              label: 'Enable',\n              defaultValue: true,\n              type: 'checkbox',\n              isStructural: true,\n            },\n            {\n              key: `size${layer}`,\n              label: 'Size',\n              defaultValue: size,\n              type: 'range',\n              attr: {\n                min: 0,\n                max: 0.5,\n                step: ({ n }) => 1 / n,\n              },\n              displayValue: config =>\n                Math.round(config.n * config[`size${layer}`]),\n              show: config => config[`show${layer}`],\n              isStructural: true,\n            },\n            {\n              key: `end${layer}`,\n              label: 'End Position',\n              defaultValue: end,\n              type: 'range',\n              attr: {\n                min: 0,\n                max: 1,\n                step: ({ n }) => 1 / n,\n              },\n              displayValue: config =>\n                Math.round(config.n * config[`end${layer}`]),\n              show: config => config[`show${layer}`],\n              affectsNails: false,\n              isStructural: true,\n            },\n            {\n              key: `color${layer}`,\n              label: 'Color',\n              defaultValue: color,\n              type: 'color',\n              show: config => config[`show${layer}`],\n              affectsNails: false,\n              isStructural: true,\n            },\n            {\n              key: `reverse${layer}`,\n              label: 'Reverse',\n              defaultValue: reverse === true,\n              type: 'checkbox',\n              show: config => config[`show${layer}`],\n              affectsNails: false,\n              isStructural: true,\n            },\n          ],\n        };\n      }),\n    },\n  ];\n\n  getAspectRatio(): number {\n    const calc = this.calc ?? this.getCalc({ size: [100, 100] });\n    return calc.circle.getAspectRatio();\n  }\n\n  getCalc({ size }: CalcOptions) {\n    const { rotation, n, margin = 0, distortion } = this.config;\n\n    const circleConfig: CircleConfig = {\n      size,\n      n,\n      margin,\n      rotation: rotation - 0.25,\n      distortion,\n    };\n\n    const circle = new Circle(circleConfig);\n\n    const circleDistanceBetweenPoints = (PI2 * circle.radius) / n;\n\n    const lineSize = circle.radius;\n    const lineNailCount = Math.round(lineSize / circleDistanceBetweenPoints);\n    const lineSpacing = lineSize / lineNailCount;\n    const firstCirclePoint = circle.getPoint(0);\n    const totalNailCount = lineNailCount + n;\n    const totalIndexCount = totalNailCount + lineNailCount;\n    const layers = new Array(3)\n      .fill(null)\n      .map((_, i) => getLayer.call(this, i + 1))\n      .filter(({ enable }) => enable);\n\n    return {\n      circle,\n      lineSpacing,\n      lineNailCount,\n      firstCirclePoint,\n      layers,\n      totalNailCount,\n      totalIndexCount,\n    };\n\n    function getLayer(layerIndex: number): Layer {\n      const size =\n        Math.round(n * this.config['size' + layerIndex]) + lineNailCount;\n      return {\n        size,\n        endIndex:\n          Math.round(\n            this.config['end' + layerIndex] * (totalNailCount + lineNailCount)\n          ) - size,\n        color: this.config['color' + layerIndex],\n        enable: this.config['show' + layerIndex],\n        isReverse: this.config['reverse' + layerIndex],\n      };\n    }\n  }\n\n  /**\n   * Returns the position of a point on the line\n   */\n  getPoint(index: number): Coordinates {\n    if (index < this.calc.lineNailCount || index > this.calc.totalNailCount) {\n      const linePosition =\n        index < this.calc.lineNailCount\n          ? this.calc.lineNailCount - index\n          : index - this.calc.totalNailCount;\n\n      const indexLength = linePosition * this.calc.lineSpacing;\n      return [\n        this.calc.firstCirclePoint[0] -\n          indexLength * Math.sin(this.calc.circle.rotationAngle),\n        this.calc.firstCirclePoint[1] -\n          indexLength * Math.cos(this.calc.circle.rotationAngle),\n      ];\n    } else {\n      const circleIndex = index - this.calc.lineNailCount;\n      return this.calc.circle.getPoint(circleIndex);\n    }\n  }\n\n  *drawCircle(\n    renderer: Renderer,\n    { endIndex, color, isReverse, size }\n  ): Generator<void> {\n    let prevPoint: Coordinates;\n    let prevPointIndex: number;\n    let isPrevSide = false;\n    renderer.setColor(color);\n    const self = this;\n    const advance = isReverse ? -1 : 1;\n\n    for (let index = 0; index <= endIndex; index++) {\n      if (prevPoint) {\n        renderer.renderLine(prevPoint, this.getPoint(prevPointIndex + advance));\n        yield;\n      }\n\n      const startPoint = prevPoint\n        ? this.getPoint(prevPointIndex + advance)\n        : this.getPoint(getPointIndex(index));\n      prevPointIndex = getPointIndex(isPrevSide ? index : index + size);\n      prevPoint = this.getPoint(prevPointIndex);\n\n      renderer.renderLine(startPoint, prevPoint);\n\n      yield;\n\n      isPrevSide = !isPrevSide;\n    }\n\n    function getPointIndex(index: number): number {\n      return isReverse ? self.calc.totalIndexCount - index : index;\n    }\n  }\n\n  *drawStrings(renderer: Renderer) {\n    for (const layer of this.calc.layers) {\n      yield* this.drawCircle(renderer, layer);\n    }\n  }\n\n  drawNails(nails: INails) {\n    for (let i = 0; i < this.calc.lineNailCount; i++) {\n      nails.addNail(i, this.getPoint(i));\n    }\n    this.calc.circle.drawNails(nails, {\n      getUniqueKey: k => this.calc.lineNailCount + k,\n    });\n  }\n\n  getStepCount(options: CalcOptions): number {\n    const { layers } = this.getCalc(options);\n    return layers.reduce(\n      (stepCount, layer) => stepCount + layer.endIndex * 2 + 1,\n      0\n    );\n  }\n\n  getNailCount(size: Dimensions): number {\n    const calc = this.getCalc({\n      size,\n    });\n    return calc.circle.config.n + calc.lineNailCount;\n  }\n\n  thumbnailConfig = ({ n }) => ({ n: Math.min(n, 50) });\n}\n","import StringArt from '../infra/StringArt';\nimport Circle from '../shapes/Circle';\nimport { ColorValue } from '../helpers/color/color.types';\nimport Renderer from '../infra/renderers/Renderer';\nimport {\n  ControlConfig,\n  ControlsConfig,\n  ControlType,\n  GroupValue,\n} from '../types/config.types';\nimport { Coordinates } from '../types/general.types';\nimport { CalcOptions } from '../types/stringart.types';\nimport { formatFractionAsAngle } from '../helpers/string_utils';\nimport INails from '../infra/nails/INails';\nimport { createArray } from '../helpers/array_utils';\n\ninterface FreestyleConfig {\n  color: ColorValue;\n  layers: GroupValue;\n\n  layer1: GroupValue;\n  show1: boolean;\n  radius1: number;\n  x1: number;\n  y1: number;\n  rotation1: number;\n  reverse1: boolean;\n  n1: number;\n\n  layer2: GroupValue;\n  show2: boolean;\n  radius2: number;\n  x2: number;\n  y2: number;\n  rotation2: number;\n  reverse2: boolean;\n  n2: number;\n\n  layer3: GroupValue;\n  show3: boolean;\n  radius3: number;\n  x3: number;\n  y3: number;\n  rotation3: number;\n  reverse3: boolean;\n  n3: number;\n}\n\nconst rotationConfig = {\n  label: 'Rotation',\n  defaultValue: 0,\n  type: 'range' as ControlType,\n  attr: {\n    min: 0,\n    max: 1 + 1 / 360,\n    step: 1 / 360,\n  },\n  isStructural: true,\n  affectsStepCount: false,\n};\n\ninterface Layer {\n  circle: Circle;\n  enable: boolean;\n  isReverse: boolean;\n  position: Coordinates;\n  radius: number;\n  rotation: number;\n}\n\ninterface TCalc {\n  layers: ReadonlyArray<Layer>;\n  roundsCount: number;\n}\n\nfunction getCircleConfig(i: number) {\n  const show = (config: FreestyleConfig) => config[`show${i}`];\n\n  return {\n    key: `layer${i}`,\n    label: `Layer ${i}`,\n    type: 'group',\n    children: [\n      {\n        key: `show${i}`,\n        label: 'Enable',\n        defaultValue: true,\n        type: 'checkbox',\n        isStructural: true,\n      },\n      {\n        key: `n${i}`,\n        label: 'Nails count',\n        type: 'range',\n        attr: { min: 1, max: 300, step: 1 },\n        show,\n        isStructural: true,\n      },\n      {\n        key: `radius${i}`,\n        label: 'Radius',\n        type: 'range',\n        attr: { min: 0.01, max: 1, step: 0.01 },\n        show,\n        isStructural: true,\n      },\n      {\n        key: `x${i}`,\n        label: 'Position X',\n        type: 'range',\n        attr: { min: 0, max: 1, step: 0.01 },\n        show,\n        isStructural: true,\n      },\n      {\n        key: `y${i}`,\n        label: 'Position Y',\n        type: 'range',\n        attr: { min: 0, max: 1, step: 0.01 },\n        show,\n        isStructural: true,\n      },\n      {\n        ...rotationConfig,\n        key: `rotation${i}`,\n        displayValue: ({ rotation1 }) => formatFractionAsAngle(rotation1),\n        show,\n      },\n      {\n        key: `reverse${i}`,\n        label: 'Reverse',\n        type: 'checkbox',\n        isStructural: true,\n        show,\n      },\n    ],\n  };\n}\n\nexport default class Freestyle extends StringArt<FreestyleConfig, TCalc> {\n  static type = 'freestyle';\n\n  name = 'Freestyle';\n  id = 'freestyle';\n  link =\n    'https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for';\n  controls: ControlsConfig<FreestyleConfig> = [\n    {\n      key: 'color',\n      label: 'Color',\n      defaultValue: '#ec6ad0',\n      type: 'color',\n      affectsNails: false,\n      affectsStepCount: false,\n    },\n    {\n      key: 'layers',\n      label: 'Layers',\n      type: 'group',\n      // @ts-ignore\n      children: createArray(3, i => getCircleConfig(i + 1)),\n    },\n  ];\n\n  defaultValues: Partial<FreestyleConfig> = {\n    n1: 80,\n    n2: 80,\n    n3: 80,\n    radius1: 0.5,\n    radius2: 0.5,\n    radius3: 0.5,\n    x1: 0.5,\n    x2: 0,\n    x3: 1,\n    y1: 0,\n    y2: 1,\n    y3: 1,\n    reverse1: false,\n    reverse2: false,\n    reverse3: false,\n  };\n\n  getAspectRatio({ size }: CalcOptions): number {\n    // TODO: Move the aspect ratio of this pattern to a config, then remove the options param from StringArt.getAspectRatio.\n    return size[0] / size[1];\n  }\n\n  getCalc({ size }: CalcOptions): TCalc {\n    const { margin = 0 } = this.config;\n\n    const maxRadius = Math.min(...size.map(v => v - 2 * margin)) / 2;\n    const layers = createArray(3, i => getLayer.call(this, i + 1)).filter(\n      ({ enable }) => enable\n    );\n\n    return {\n      layers,\n      roundsCount: Math.max(...layers.map(l => l.circle.config.n)),\n    };\n\n    function getLayer(layerIndex: number): Layer {\n      const prop = (prop: string) => this.config[prop + layerIndex];\n\n      const props = {\n        enable: prop('show'),\n        isReverse: prop('reverse'),\n        position: [prop('x'), prop('y')] as Coordinates,\n        radius: maxRadius * prop('radius'),\n        rotation: prop('rotation'),\n      };\n\n      const circle = new Circle({\n        radius: props.radius,\n        size,\n        center: props.position.map(\n          (v, i) =>\n            props.radius + margin + (size[i] - (props.radius + margin) * 2) * v\n        ) as Coordinates,\n        n: prop('n'),\n        rotation: props.rotation,\n        reverse: props.isReverse,\n      });\n\n      return {\n        circle,\n        ...props,\n      };\n    }\n  }\n\n  getPoint(layer: Layer, index: number): Coordinates {\n    return layer.circle.getPoint(index);\n  }\n\n  *drawStrings(renderer: Renderer): Generator<void> {\n    const { color } = this.config;\n\n    renderer.setColor(color);\n    let prevCirclePoint: Coordinates;\n\n    for (let i = 0; i < this.calc.roundsCount; i++) {\n      for (\n        let layerIndex = 0;\n        layerIndex < this.calc.layers.length;\n        layerIndex++\n      ) {\n        const layer = this.calc.layers[layerIndex];\n        const startPoint = prevCirclePoint ?? this.getPoint(layer, i);\n\n        const positions: Coordinates[] = [];\n        if (layerIndex === 0 && i) {\n          positions.push(this.getPoint(layer, i));\n        }\n\n        let nextLayerIndex = layerIndex + 1;\n        if (nextLayerIndex === this.calc.layers.length) {\n          nextLayerIndex = 0;\n        }\n\n        prevCirclePoint = this.getPoint(this.calc.layers[nextLayerIndex], i);\n\n        renderer.renderLine(startPoint, prevCirclePoint);\n        yield;\n      }\n    }\n  }\n\n  drawNails(nails: INails) {\n    this.calc.layers.forEach(({ circle }, i) =>\n      circle.drawNails(nails, { getUniqueKey: k => 1e3 * i + k })\n    );\n  }\n\n  getStepCount(options: CalcOptions) {\n    const { layers, roundsCount } = this.getCalc(options);\n    return layers.length * roundsCount;\n  }\n\n  getNailsCount(): number {\n    const { n1, n2, n3 } = this.config;\n    return n1 + n2 + n3;\n  }\n\n  thumbnailConfig = ({ n1, n2, n3 }) => ({\n    n1: Math.min(n1, 40),\n    n2: Math.min(n2, 40),\n    n3: Math.min(n3, 40),\n  });\n}\n","import StringArt from '../infra/StringArt';\nimport Polygon, { PolygonConfig } from '../shapes/Polygon';\nimport Color from '../helpers/color/Color';\nimport { ColorConfig, ColorMap } from '../helpers/color/color.types';\nimport Renderer from '../infra/renderers/Renderer';\nimport { ControlsConfig } from '../types/config.types';\nimport { CalcOptions } from '../types/stringart.types';\nimport INails from '../infra/nails/INails';\n\ninterface PolygonPatternConfig extends ColorConfig {\n  sides: number;\n  n: number;\n  bezier: number;\n  rotation: number;\n}\n\ninterface TCalc {\n  polygon: Polygon;\n}\n\nconst COLOR_CONFIG = Color.getConfig({\n  defaults: {\n    isMultiColor: true,\n    color: '#ff0000',\n    multicolorRange: 1,\n    multicolorStart: 0,\n    multicolorByLightness: true,\n    minLightness: 20,\n    maxLightness: 50,\n  },\n  exclude: ['colorCount'],\n});\n\nexport default class PolygonPattern extends StringArt<\n  PolygonPatternConfig,\n  TCalc\n> {\n  static type = 'polygon';\n\n  name = 'Polygon';\n  id = 'polygon';\n  controls: ControlsConfig<PolygonPatternConfig> = [\n    {\n      key: 'sides',\n      label: 'Sides',\n      defaultValue: 5,\n      type: 'range',\n      attr: {\n        min: 3,\n        max: 10,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    {\n      key: 'n',\n      label: 'Nails per side',\n      defaultValue: 60,\n      type: 'range',\n      attr: {\n        min: 1,\n        max: 100,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    {\n      key: 'bezier',\n      label: 'Bezier',\n      defaultValue: 2,\n      type: 'range',\n      attr: {\n        min: 1,\n        max: 4,\n        step: 1,\n      },\n      show: ({ sides }) => sides > 4,\n      affectsNails: false,\n      affectsStepCount: false,\n    },\n    Polygon.rotationConfig,\n    COLOR_CONFIG,\n  ];\n\n  defaultValues = {\n    nailsColor: '#5c5c5c',\n    nailRadius: 1,\n  };\n\n  color: Color;\n  colorMap: ColorMap;\n\n  getCalc({ size }: CalcOptions): TCalc {\n    const { n, rotation, sides, margin } = this.config;\n\n    const polygonConfig: PolygonConfig = {\n      sides,\n      rotation: rotation / (sides * 2),\n      margin,\n      size,\n      nailsPerSide: n,\n      fitSize: true,\n    };\n\n    return {\n      polygon: new Polygon(polygonConfig),\n    };\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n    const { sides, isMultiColor } = this.config;\n\n    this.color = new Color({\n      ...this.config,\n      isMultiColor,\n      colorCount: sides,\n    });\n\n    if (isMultiColor) {\n      this.colorMap = this.color.getColorMap({\n        stepCount: this.getStepCount(),\n        colorCount: sides,\n      });\n    } else {\n      this.colorMap = null;\n    }\n  }\n\n  getAspectRatio(options: CalcOptions): number {\n    const { polygon } = this.getCalc(options);\n    return polygon.getAspectRatio();\n  }\n\n  *drawStrings(renderer: Renderer) {\n    const { sides, bezier } = this.config;\n    const limitedBezier = Math.min(bezier, Math.ceil(sides / 2) - 1);\n\n    let step = 0;\n    renderer.setColor(this.color.getColor(0));\n\n    for (let side = 0; side < sides; side++) {\n      const nextSide = (side + limitedBezier) % sides;\n\n      if (this.colorMap) {\n        renderer.setColor(this.colorMap.get(step));\n      }\n      for (let index = 0; index < this.config.n; index++) {\n        renderer.renderLine(\n          this.calc.polygon.getSidePoint({ side, index }),\n          this.calc.polygon.getSidePoint({ side: nextSide, index })\n        );\n\n        yield;\n        step++;\n      }\n    }\n  }\n\n  getStepCount() {\n    const { sides, n } = this.config;\n    return sides * n;\n  }\n\n  drawNails(nails: INails) {\n    this.calc.polygon.drawNails(nails);\n  }\n\n  thumbnailConfig = ({ n }) => ({\n    n: Math.min(n, 20),\n  });\n}\n","import StringArt from '../infra/StringArt';\nimport Polygon from '../shapes/Polygon';\nimport Color from '../helpers/color/Color';\nimport { ColorConfig } from '../helpers/color/color.types';\nimport {\n  combineBoundingRects,\n  getBoundingRectAspectRatio,\n} from '../helpers/size_utils';\nimport Renderer from '../infra/renderers/Renderer';\nimport { ControlsConfig } from '../types/config.types';\nimport { CalcOptions } from '../types/stringart.types';\nimport { Dimensions } from '../types/general.types';\nimport { createArray } from '../helpers/array_utils';\nimport INails from '../infra/nails/INails';\n\nexport interface FlowerConfig extends ColorConfig {\n  sides: number;\n  n: number;\n  layers: number;\n  rotation: number;\n}\n\nconst COLOR_CONFIG = Color.getConfig({\n  defaults: {\n    isMultiColor: true,\n    color: '#29f1ff',\n    multicolorRange: 132,\n    multicolorStart: 53,\n    multicolorByLightness: false,\n    minLightness: 30,\n    maxLightness: 70,\n  },\n  exclude: ['colorCount'],\n});\n\ntype TCalc = {\n  polygons: ReadonlyArray<Polygon>;\n};\n\nexport default class Flower extends StringArt<FlowerConfig, TCalc> {\n  static type = 'flower';\n\n  name = 'Flower';\n  id = 'flower';\n  link = 'https://www.sqrt.ch/Buch/fadenmodell4_100.svg';\n  controls: ControlsConfig<FlowerConfig> = [\n    {\n      key: 'sides',\n      label: 'Sides',\n      defaultValue: 4,\n      type: 'range',\n      attr: {\n        min: 3,\n        max: 20,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    {\n      key: 'n',\n      label: 'Nails per side',\n      defaultValue: 60,\n      type: 'range',\n      attr: {\n        min: 2,\n        max: 100,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    {\n      key: 'layers',\n      label: 'Layers',\n      defaultValue: 2,\n      type: 'range',\n      attr: {\n        min: 1,\n        max: 10,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    Polygon.rotationConfig,\n    COLOR_CONFIG,\n  ];\n\n  defaultValues = {\n    nailsColor: '#29f1ff',\n    nailRadius: 1,\n    stringWidth: 0.5,\n  };\n\n  color: Color;\n\n  getCalc({ size }: CalcOptions): TCalc {\n    const { n, rotation, sides, layers, margin } = this.config;\n\n    const layerAngleShift = 1 / (sides * layers);\n\n    const polygons = createArray(layers, i => {\n      const polygonConfig = {\n        sides,\n        rotation: rotation / sides + i * layerAngleShift,\n        margin,\n        size,\n        nailsPerSide: n,\n        radiusNailsCountSameAsSides: true,\n      };\n\n      return new Polygon(polygonConfig);\n    });\n\n    return { polygons };\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n    const { layers, isMultiColor } = this.config;\n\n    this.color = new Color({\n      ...this.config,\n      isMultiColor,\n      colorCount: layers,\n    });\n  }\n\n  getAspectRatio(): number {\n    const calc = this.calc ?? this.getCalc({ size: [100, 100] });\n    const boundingRect = combineBoundingRects(\n      ...calc.polygons.map(p => p.getBoundingRect())\n    );\n    return getBoundingRectAspectRatio(boundingRect);\n  }\n\n  *drawStrings(renderer: Renderer) {\n    const { sides, layers, n } = this.config;\n\n    let step = 0;\n\n    for (let layer = 0; layer < layers; layer++) {\n      renderer.setColor(this.color.getColor(layer));\n      const polygon = this.calc.polygons[layer];\n\n      for (let side = 0; side < sides; side++) {\n        const leftSide = (side + 1) % sides;\n\n        for (let index = 0; index < n; index++) {\n          const centerIndexes = [index, this.config.n - index - 1];\n\n          renderer.renderLine(\n            polygon.getCenterPoint({\n              side: side,\n              index: centerIndexes[0],\n            }),\n            polygon.getSidePoint({ side, index })\n          );\n\n          yield;\n\n          renderer.lineTo(\n            polygon.getCenterPoint({\n              side: leftSide,\n              index: centerIndexes[1],\n            })\n          );\n\n          yield;\n          step++;\n        }\n      }\n    }\n  }\n\n  drawNails(nails: INails) {\n    const layerNailCount =\n      this.config.layers > 1\n        ? this.calc.polygons[1].getNailsCount({\n            drawCenter: true,\n            drawCenterNail: false,\n          })\n        : null;\n\n    this.calc.polygons.forEach((polygon, i) =>\n      polygon.drawNails(nails, {\n        drawCenter: true,\n        drawCenterNail: i === 0,\n        getUniqueKey: i ? k => i * layerNailCount + 1 + k : undefined,\n      })\n    );\n  }\n\n  getStepCount(): number {\n    const { sides, n, layers } = this.config;\n    return sides * n * 2 * layers;\n  }\n\n  getNailCount(size: Dimensions): number {\n    const { layers } = this.config;\n    const calc = this.calc ?? this.getCalc({ size });\n    const polygon = calc.polygons[0];\n\n    return (\n      layers *\n        polygon.getNailsCount({ drawCenter: true, drawCenterNail: false }) +\n      1\n    );\n  }\n\n  thumbnailConfig = ({ n }) => ({\n    n: Math.min(n, 20),\n  });\n\n  testStepCountConfig = [\n    {\n      sides: 3,\n      n: 2,\n      layers: 1,\n    },\n  ];\n}\n","import StringArt from '../infra/StringArt';\nimport Circle from '../shapes/Circle';\nimport Polygon from '../shapes/Polygon';\nimport Color from '../helpers/color/Color';\nimport { ColorConfig, ColorMap } from '../helpers/color/color.types';\nimport { withoutAttribute } from '../helpers/config_utils';\nimport { gcd, PI2 } from '../helpers/math_utils';\nimport { getCenter, mapDimensions } from '../helpers/size_utils';\nimport Renderer from '../infra/renderers/Renderer';\nimport { ControlsConfig } from '../types/config.types';\nimport { Coordinates, Dimensions } from '../types/general.types';\nimport { CalcOptions } from '../types/stringart.types';\nimport Nails from '../infra/nails/Nails';\nimport NailsGroup from '../infra/nails/NailsGroup';\nimport INails from '../infra/nails/INails';\n\nexport interface MaurerRoseConfig extends ColorConfig {\n  n: number;\n  maxSteps: number;\n  angle: number;\n  rotation: number;\n}\n\nconst COLOR_CONFIG = Color.getConfig({\n  defaults: {\n    isMultiColor: true,\n    color: '#ffffff',\n    multicolorRange: 102,\n    multicolorStart: 239,\n    multicolorByLightness: false,\n    minLightness: 30,\n    maxLightness: 70,\n    colorCount: 4,\n  },\n  exclude: ['repeatColors', 'mirrorColors'],\n});\n\ninterface TCalc {\n  angleRadians: number;\n  radius: number;\n  currentSize: Dimensions;\n  rotationAngle: number;\n  center: Coordinates;\n}\n\nexport default class MaurerRose extends StringArt<MaurerRoseConfig, TCalc> {\n  static type = 'maurer_rose';\n\n  name = 'Maurer Rose';\n  id = 'maurer_rose';\n  link = 'https://blog.glitch.land/en/posts/maurer-rose/';\n  linkText = 'Learn';\n  controls: ControlsConfig<MaurerRoseConfig> = [\n    {\n      key: 'n',\n      label: 'N',\n      defaultValue: 4,\n      type: 'range',\n      attr: {\n        min: 2,\n        max: 12,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    {\n      key: 'maxSteps',\n      label: 'Max steps',\n      defaultValue: 512,\n      type: 'range',\n      attr: {\n        min: 3,\n        max: 720,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    {\n      key: 'angle',\n      label: 'Angle',\n      defaultValue: 341,\n      type: 'range',\n      attr: {\n        min: 1,\n        max: 720,\n        step: 1,\n      },\n      displayValue: ({ angle }) => `${angle}`,\n      isStructural: true,\n    },\n    withoutAttribute(Circle.rotationConfig, 'snap'),\n    COLOR_CONFIG,\n  ];\n\n  points: Map<number, Coordinates>;\n  color: Color;\n  colorMap: ColorMap;\n\n  resetStructure() {\n    super.resetStructure();\n\n    if (this.points) {\n      this.points.clear();\n    }\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n    const { isMultiColor, colorCount } = this.config;\n\n    if (!this.points) {\n      this.points = new Map();\n    }\n\n    if (!this.stepCount) {\n      this.stepCount = this.getStepCount();\n    }\n\n    this.color = new Color({\n      ...this.config,\n      isMultiColor,\n      colorCount,\n    });\n\n    if (isMultiColor) {\n      this.colorMap = this.color.getColorMap({\n        stepCount: this.stepCount,\n        colorCount,\n      });\n    } else {\n      this.colorMap = null;\n    }\n  }\n\n  getAspectRatio({ size }: CalcOptions): number {\n    const { n, rotation, margin } = this.config;\n\n    // Use a Polygon and getBoundingRect to calculate the aspectRatio\n    const polygon = new Polygon({\n      size,\n      sides: n % 2 ? n : n * 2,\n      nailsPerSide: 10,\n      margin,\n      rotation,\n      center: getCenter(size),\n    });\n\n    return polygon.getAspectRatio();\n  }\n\n  getCalc({ size }: CalcOptions): TCalc {\n    const { angle, rotation, maxSteps, margin } = this.config;\n\n    return {\n      angleRadians: (PI2 * angle) / maxSteps,\n      radius: Math.min(...size) / 2 - margin,\n      currentSize: mapDimensions(size, v => v - margin * 2),\n      rotationAngle: -Math.PI * 2 * rotation,\n      center: getCenter(size),\n    };\n  }\n\n  getPoint(index: number): Coordinates {\n    const { rotationAngle, angleRadians, radius, center } = this.calc;\n\n    if (this.points.has(index)) {\n      return this.points.get(index);\n    }\n\n    const k = index * angleRadians;\n    const r = radius * Math.sin(this.config.n * k);\n\n    const point = [\n      center[0] - r * Math.cos(k - rotationAngle),\n      center[1] - r * Math.sin(k - rotationAngle),\n    ] as Coordinates;\n    this.points.set(index, point);\n    return point;\n  }\n\n  *generatePoints(): Generator<{ point: Coordinates; index: number }> {\n    const count = this.stepCount;\n\n    for (let i = 0; i < count + 1; i++) {\n      yield { point: this.getPoint(i), index: i };\n    }\n  }\n\n  *drawStrings(renderer: Renderer): Generator<void> {\n    const points = this.generatePoints();\n\n    let prevPoint: Coordinates;\n    renderer.setColor(this.color.getColor(0));\n\n    for (const { point, index } of points) {\n      if (!prevPoint) {\n        prevPoint = point;\n        continue;\n      }\n\n      if (this.colorMap) {\n        const stepColor = this.colorMap.get(index);\n        if (stepColor) {\n          renderer.setColor(stepColor);\n        }\n      }\n\n      renderer.renderLine(prevPoint, point);\n      prevPoint = point;\n\n      yield;\n    }\n  }\n\n  getStepCount(): number {\n    if (this.stepCount) {\n      return this.stepCount;\n    }\n\n    const { maxSteps, angle, n } = this.config;\n    const angleGcd = gcd(maxSteps, angle);\n\n    let steps = maxSteps / angleGcd;\n    if (!(steps % 2) && n % 2) {\n      steps /= 2;\n    }\n    return Math.round(steps);\n  }\n\n  drawNails(nails: INails) {\n    const points = this.generatePoints();\n    for (const { point, index } of points) {\n      nails.addNail(index, point);\n    }\n  }\n}\n","import { PI2 } from '../helpers/math_utils';\nimport StringArt from '../infra/StringArt';\nimport Color from '../helpers/color/Color';\nimport Polygon from '../shapes/Polygon';\nimport Circle from '../shapes/Circle';\nimport { formatFractionAsPercent } from '../helpers/string_utils';\nimport {\n  ColorConfig,\n  ColorMap,\n  ColorValue,\n} from '../helpers/color/color.types';\nimport { ControlsConfig, GroupValue } from '../types/config.types';\nimport { Coordinates } from '../types/general.types';\nimport Renderer from '../infra/renderers/Renderer';\nimport { CalcOptions } from '../types/stringart.types';\nimport { getCenter } from '../helpers/size_utils';\nimport { createArray } from '../helpers/array_utils';\nimport INails from '../infra/nails/INails';\nimport NailsGroup from '../infra/nails/NailsGroup';\n\ninterface FlowerOfLifeConfig extends ColorConfig {\n  levels: number;\n  density: number;\n  globalRotation: number;\n  fillGroup: GroupValue;\n  fill: boolean;\n  fillColor: ColorValue;\n  ringGroup: GroupValue;\n  renderRing: boolean;\n  ringSize: number;\n  ringNailCount: number;\n  ringPadding: number;\n  ringColor: ColorValue;\n  renderTriangles: boolean;\n  renderCaps: boolean;\n  colorPerLevel: boolean;\n}\n\ninterface TCalc {\n  edgeSize: number;\n  triangleHeight: number;\n  nailsLength: number;\n  triangleCenterDistance: number;\n  nailDistance: number;\n  triangleCount: number;\n  countPerLevelSide: number[];\n  globalRotationRadians: number;\n  radius: number;\n  ringCircle: Circle;\n  center: Coordinates;\n  nailsGroup: NailsGroup;\n}\n\nconst COLOR_CONFIG = Color.getConfig({\n  defaults: {\n    isMultiColor: true,\n    color: '#29f1ff',\n    multicolorRange: 30,\n    multicolorStart: 25,\n    multicolorByLightness: true,\n    minLightness: 40,\n    maxLightness: 95,\n    colorCount: 3,\n    repeatColors: true,\n    saturation: 83,\n    reverseColors: true,\n  },\n  customControls: [\n    {\n      key: 'colorPerLevel',\n      label: 'Color per level',\n      defaultValue: true,\n      type: 'checkbox',\n      affectsNails: false,\n    },\n  ],\n});\n\nconst ANGLE = -PI2 / 6; // The angle of a equilateral triangle;\nconst SIDE_ANGLES = new Array(6)\n  .fill(null)\n  .map((_, i) => Math.PI / 2 + ANGLE * i);\n\nexport default class FlowerOfLife extends StringArt<FlowerOfLifeConfig, TCalc> {\n  static type = 'flower_of_life';\n\n  name = 'Flower of Life';\n  id = 'flower_of_life';\n  link =\n    'https://www.reddit.com/r/psychedelicartwork/comments/mk97gi/rainbow_flower_of_life_uv_reactive_string_art/';\n  controls: ControlsConfig<FlowerOfLifeConfig> = [\n    {\n      key: 'levels',\n      label: 'Levels',\n      defaultValue: 3,\n      type: 'range',\n      attr: {\n        min: 1,\n        max: 10,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    {\n      key: 'density',\n      label: 'Density',\n      defaultValue: 10,\n      type: 'range',\n      attr: {\n        min: 1,\n\n        max: 50,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    {\n      key: 'globalRotation',\n      label: 'Rotation',\n      defaultValue: 0,\n      type: 'range',\n      attr: {\n        min: 0,\n        max: 30,\n        step: 1,\n      },\n      displayValue: ({ globalRotation }) => `${globalRotation}`,\n      isStructural: true,\n      affectsStepCount: false,\n    },\n    {\n      key: 'fillGroup',\n      label: 'Fill',\n      type: 'group',\n      children: [\n        {\n          key: 'fill',\n          label: 'Show fill',\n          defaultValue: true,\n          type: 'checkbox',\n          isStructural: true,\n          affectsNails: false,\n        },\n        {\n          key: 'fillColor',\n          label: 'Fill color',\n          defaultValue: '#292e29',\n          type: 'color',\n          show: ({ fill }) => fill,\n          affectsNails: false,\n        },\n      ],\n    },\n    {\n      key: 'ringGroup',\n      label: 'Ring',\n      type: 'group',\n      children: [\n        {\n          key: 'renderRing',\n          label: 'Show outer ring',\n          type: 'checkbox',\n          defaultValue: true,\n          isStructural: true,\n        },\n        {\n          key: 'ringNailCount',\n          label: 'Ring nail count',\n          defaultValue: 144,\n          type: 'range',\n          attr: {\n            min: 3,\n            max: 360,\n            step: 1,\n          },\n          show: ({ renderRing }) => renderRing,\n          isStructural: true,\n        },\n        {\n          key: 'ringSize',\n          label: 'Outer ring size',\n          defaultValue: 0.23,\n          type: 'range',\n          attr: {\n            min: 0,\n            max: 0.5,\n            step: 0.01,\n          },\n          show: ({ renderRing }) => renderRing,\n          displayValue: ({ ringSize }) => formatFractionAsPercent(ringSize),\n          isStructural: true,\n        },\n        {\n          key: 'ringPadding',\n          label: 'Ring padding',\n          defaultValue: 0.06,\n          type: 'range',\n          attr: {\n            min: 0,\n            max: 0.5,\n            step: 0.01,\n          },\n          show: ({ renderRing }) => renderRing,\n          isStructural: true,\n          displayValue: ({ ringPadding }) =>\n            formatFractionAsPercent(ringPadding),\n        },\n        {\n          key: 'ringColor',\n          label: 'Ring color',\n          defaultValue: '#e8b564',\n          type: 'color',\n          show: ({ renderRing }) => renderRing,\n          affectsNails: false,\n        },\n      ],\n    },\n    {\n      key: 'renderTriangles',\n      label: 'Show triangles',\n      defaultValue: true,\n      type: 'checkbox',\n      isStructural: true,\n      affectsNails: false,\n    },\n    {\n      key: 'renderCaps',\n      label: 'Show caps',\n      defaultValue: true,\n      type: 'checkbox',\n      show: ({ renderTriangles }) => renderTriangles,\n      isStructural: true,\n    },\n    COLOR_CONFIG,\n  ];\n\n  defaultValues = {\n    nailsColor: '#474747',\n  };\n\n  color: Color;\n  colorMap: ColorMap;\n\n  getCalc(options: CalcOptions): TCalc {\n    const { size } = options;\n    const {\n      levels,\n      density,\n      margin,\n      globalRotation,\n      renderCaps,\n      renderRing,\n      ringNailCount,\n      ringSize,\n      ringPadding,\n    } = this.config;\n    const globalRotationRadians =\n      (globalRotation * Math.PI) / 180 + Math.PI / 6;\n\n    const radius = renderRing\n      ? Math.min(...size.map(v => v / 2 - margin))\n      : null;\n    const ringDistance = renderRing\n      ? Math.floor((ringSize * ringNailCount) / 2)\n      : 0; // The number of nails to count for strings in the outer ring\n    const ringWidth = renderRing\n      ? radius * (1 - Math.cos((PI2 * (ringDistance / ringNailCount)) / 2))\n      : 0;\n\n    const polygon = new Polygon({\n      sides: 6,\n      size,\n      margin:\n        margin +\n        ringWidth +\n        (renderRing && ringSize ? ringPadding * radius : 0),\n      rotation: globalRotationRadians,\n      fitSize: false,\n      nailsPerSide: 2,\n    });\n\n    const edgeSize = polygon.sideSize / levels;\n    const nailsLength = edgeSize / (2 * Math.cos(Math.PI / 6));\n\n    const ringCircle =\n      renderRing && ringSize\n        ? new Circle({\n            size,\n            n: ringNailCount,\n            margin: margin,\n            rotation: globalRotation,\n          })\n        : null;\n\n    const countPerLevelSide = new Array(levels + (renderCaps ? 1 : 0))\n      .fill(null)\n      .map((_, level) => level * 2 + 1);\n\n    const calc = {\n      edgeSize,\n      triangleHeight: (edgeSize * Math.sqrt(3)) / 2,\n      nailsLength,\n      triangleCenterDistance: edgeSize / 2,\n      nailDistance: nailsLength / density,\n      triangleCount: 6 * levels ** 2,\n      countPerLevelSide,\n      globalRotationRadians,\n      radius,\n      ringCircle,\n      center: getCenter(size),\n    };\n\n    return {\n      ...calc,\n      ...this.#getPoints(calc),\n    };\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n\n    const {\n      isMultiColor,\n      levels,\n      colorPerLevel,\n      colorCount,\n      renderRing,\n      ringSize,\n      ringNailCount,\n      ...config\n    } = this.config;\n\n    if (!this.stepCount) {\n      this.stepCount = this.getStepCount(options);\n    }\n\n    const realColorCount = isMultiColor\n      ? colorPerLevel\n        ? levels\n        : Math.min(colorCount, levels)\n      : 1;\n\n    this.color = new Color({\n      ...config,\n      isMultiColor,\n      colorCount: realColorCount,\n    });\n\n    if (isMultiColor) {\n      this.colorMap = this.color.getColorMap({\n        stepCount: realColorCount,\n        colorCount: realColorCount,\n      });\n    } else {\n      this.colorMap = null;\n    }\n  }\n\n  getAspectRatio(): number {\n    return 1;\n  }\n\n  #getTrianglePoints(\n    calc: Omit<TCalc, 'nailsGroup'>,\n    {\n      center,\n      rotation,\n      isCapLevel,\n      triangleIndexInSide,\n      withPoint,\n    }: {\n      center: Coordinates;\n      rotation: number;\n      isCapLevel: boolean;\n      triangleIndexInSide: number;\n      withPoint: (side: number, index: number, point: Coordinates) => void;\n    }\n  ): Coordinates[][] {\n    let missingSide: number;\n    if (isCapLevel) {\n      const triangleIndex = (triangleIndexInSide + 2) % 3;\n      missingSide = this.#getNextIndexInTriangle(triangleIndex);\n    }\n\n    // For each side of the triangle, the first point is the center of the triangle:\n    const trianglePoints = new Array(3)\n      .fill(null)\n      .map((_, i) => (i === missingSide ? [] : [center]));\n\n    withPoint(0, 0, center);\n    for (let side = 0; side < 3; side++) {\n      if (isCapLevel && side === missingSide) {\n        continue;\n      }\n      const sideAngle = rotation + side * (PI2 / 3);\n      const triangleSidePoints = trianglePoints[side];\n\n      const cosSideAngle = Math.cos(sideAngle);\n      const sinSideAngle = Math.sin(sideAngle);\n\n      for (let n = 1; n <= this.config.density; n++) {\n        const nNailDistance = n * calc.nailDistance;\n\n        const point: Coordinates = [\n          center[0] + nNailDistance * cosSideAngle,\n          center[1] + nNailDistance * sinSideAngle,\n        ];\n        triangleSidePoints.push(point);\n        withPoint(side, n, point);\n      }\n    }\n\n    return trianglePoints;\n  }\n\n  #getPoints(calc: Omit<TCalc, 'nailsGroup'>): {\n    nailsGroup: NailsGroup;\n  } {\n    const { levels, renderCaps } = this.config;\n\n    const largeDistance = calc.nailsLength;\n    const smallDistance = calc.triangleHeight - largeDistance;\n    const nailsGroup = new NailsGroup();\n    const levelsCount = renderCaps ? levels + 1 : levels;\n\n    for (let level = 0; level < levelsCount; level++) {\n      const isCapLevel = renderCaps && level === levels;\n\n      const levelSideTriangleCount = calc.countPerLevelSide[level];\n\n      // Caching distances to avoid repeated calculations for each side:\n      const levelPositions = createArray(levelSideTriangleCount, n => {\n        const isFlipped = n % 2 === 0;\n        const trianglePosition = [\n          calc.triangleCenterDistance * (n - level),\n          level * calc.triangleHeight +\n            (isFlipped ? largeDistance : smallDistance),\n        ];\n\n        return {\n          rotation: Math.atan(trianglePosition[0] / trianglePosition[1]),\n          distanceFromCenter: Math.hypot(\n            trianglePosition[0],\n            trianglePosition[1]\n          ),\n        };\n      });\n\n      let triangleIndexInLevel = 0;\n\n      for (let side = 0; side < 6; side++) {\n        const sideRotation = SIDE_ANGLES[side];\n\n        for (let n = 0; n < levelSideTriangleCount; n++) {\n          if (isCapLevel && n % 2 === 0) {\n            // Cap triangles are only odd indexes\n            triangleIndexInLevel++;\n            continue;\n          }\n\n          const { distanceFromCenter, rotation } = levelPositions[n];\n\n          const triangleCenterAngle =\n            sideRotation - rotation - calc.globalRotationRadians;\n\n          const rotatedTrianglePosition = [\n            calc.center[0] + distanceFromCenter * Math.cos(triangleCenterAngle),\n            calc.center[1] - distanceFromCenter * Math.sin(triangleCenterAngle),\n          ] as Coordinates;\n\n          this.#getTrianglePoints(calc, {\n            center: rotatedTrianglePosition,\n            rotation:\n              sideRotation +\n              (side * PI2) / 3 -\n              n * ANGLE +\n              calc.globalRotationRadians,\n            isCapLevel,\n            triangleIndexInSide: n,\n            withPoint: (side, index, point) => {\n              nailsGroup.addNail(\n                this.#getPointKey(level, triangleIndexInLevel, side, index),\n                point\n              );\n            },\n          });\n\n          triangleIndexInLevel++;\n        }\n      }\n    }\n\n    return { nailsGroup };\n  }\n\n  *generateTriangleStrings(\n    renderer: Renderer,\n    {\n      level,\n      indexInSide,\n      triangleIndex,\n      isCapLevel,\n    }: {\n      level: number;\n      triangleIndex: number;\n      indexInSide: number;\n      isCapLevel: boolean;\n    }\n  ): Generator<void> {\n    renderer.setColor(this.color.getColor(level));\n    const { density } = this.config;\n\n    const initialSide = isCapLevel\n      ? this.#getNextIndexInTriangle(indexInSide % 3)\n      : 0;\n    const lastSide = isCapLevel ? initialSide : 2;\n    const lastIndex = isCapLevel ? density : density - 1;\n\n    for (let side = initialSide; side <= lastSide; side++) {\n      const nextSide = this.#getNextIndexInTriangle(side, 1);\n      let prevPoint = this.calc.nailsGroup.getNailCoordinates(\n        this.#getPointKey(level, triangleIndex, 0, 0)\n      );\n\n      for (let n = 0; n <= lastIndex; n++) {\n        const isNextSide = n % 2 === 0;\n\n        const nextSidePoint = isNextSide ? density - n : n;\n        const targetSide = isNextSide ? nextSide : side;\n        const targetPoint = this.calc.nailsGroup.getNailCoordinates(\n          this.#getPointKey(level, triangleIndex, targetSide, nextSidePoint)\n        );\n\n        renderer.renderLine(prevPoint, targetPoint);\n        yield;\n\n        if (n < density) {\n          prevPoint = this.calc.nailsGroup.getNailCoordinates(\n            this.#getPointKey(\n              level,\n              triangleIndex,\n              targetSide,\n              isNextSide ? nextSidePoint - 1 : nextSidePoint + 1\n            )\n          );\n          renderer.renderLine(targetPoint, prevPoint);\n          yield;\n        }\n      }\n    }\n  }\n\n  *generateStringsBetweenTriangles(\n    renderer: Renderer,\n    {\n      triangle1Index,\n      triangle2Index,\n      triangle1Level,\n      triangle2Level,\n      triangleIndexInSide,\n      isNextLevel,\n    }: {\n      triangle1Index: number;\n      triangle2Index: number;\n      triangle1Level: number;\n      triangle2Level: number;\n      triangleIndexInSide: number;\n      isNextLevel?: boolean;\n    }\n  ): Generator<void> {\n    const { density, fillColor } = this.config;\n    const levelSideCount = this.calc.countPerLevelSide[triangle1Level];\n    const angleShift = (triangle1Index % levelSideCount) % 3;\n\n    renderer.setColor(fillColor);\n\n    const isLastTriangleInSide = triangleIndexInSide === levelSideCount - 1;\n    const firstSide = angleShift;\n\n    const sideIndex: [number, number] = isNextLevel\n      ? [\n          this.#getNextIndexInTriangle(angleShift),\n          this.#getNextIndexInTriangle(angleShift, -1),\n        ]\n      : [\n          firstSide,\n          this.#getNextIndexInTriangle(\n            firstSide,\n            triangleIndexInSide % 2 ? 1 : -1\n          ),\n        ];\n\n    for (let s = 0; s < 2; s++) {\n      const order = generateOrderInSide.call(this, s);\n\n      for (const { pointIndex, triangle1Side, triangle2Side } of order) {\n        renderer.renderLine(\n          this.calc.nailsGroup.getNailCoordinates(\n            this.#getPointKey(\n              triangle1Level,\n              triangle1Index,\n              triangle1Side,\n              pointIndex\n            )\n          ),\n          this.calc.nailsGroup.getNailCoordinates(\n            this.#getPointKey(\n              triangle2Level,\n              triangle2Index,\n              triangle2Side,\n              pointIndex\n            )\n          )\n        );\n\n        yield;\n      }\n    }\n\n    function* generateOrderInSide(side: number): Generator<{\n      pointIndex: number;\n      triangle1Side: number;\n      triangle2Side: number;\n    }> {\n      const triangle1Side = sideIndex[side];\n      const triangle2Side = getNextTriangleSide.call(this);\n\n      const last = side ? density : density - 1;\n\n      if (side === 0) {\n        for (let n = 0; n <= last; n++) {\n          yield { pointIndex: density - n, triangle1Side, triangle2Side };\n        }\n      } else {\n        for (let n = last; n >= 1; n--) {\n          yield { pointIndex: density - n, triangle1Side, triangle2Side };\n        }\n      }\n\n      function getNextTriangleSide() {\n        if (isNextLevel) {\n          return this.#getNextIndexInTriangle(triangle1Side);\n        } else {\n          if (side === 0 && isLastTriangleInSide) {\n            return 1;\n          } else {\n            if (side === 1 && isLastTriangleInSide) {\n              return 0;\n            } else {\n              return this.#getNextIndexInTriangle(triangle1Side, 1);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  #getNextIndexInTriangle(index: number, direction: 1 | -1 = 1): number {\n    const result = index + direction;\n\n    if (result < 0) {\n      return 2;\n    }\n    if (result > 2) {\n      return 0;\n    }\n    return result;\n  }\n\n  *drawStrings(renderer: Renderer): Generator<void> {\n    const {\n      fill,\n      renderTriangles,\n      renderCaps,\n      levels,\n      renderRing,\n      ringSize,\n      ringColor,\n    } = this.config;\n\n    const levelsCount = renderCaps ? levels + 1 : levels;\n\n    for (let levelIndex = 0; levelIndex < levelsCount; levelIndex++) {\n      const isCapLevel = levelIndex === levels;\n\n      const levelTriangleCount = 6 * (levelIndex * 2 + 1);\n      const lastIndexInLevel = levelTriangleCount - 1;\n\n      for (\n        let triangleIndex = 0;\n        triangleIndex < levelTriangleCount;\n        triangleIndex++\n      ) {\n        const levelSideCount = this.calc.countPerLevelSide[levelIndex];\n        const triangleIndexInSide = triangleIndex % levelSideCount;\n\n        if (fill && !isCapLevel) {\n          if (triangleIndex === 0) {\n            yield* this.generateStringsBetweenTriangles(renderer, {\n              triangle1Index: lastIndexInLevel,\n              triangle2Index: triangleIndex,\n              triangle1Level: levelIndex,\n              triangle2Level: levelIndex,\n              triangleIndexInSide: lastIndexInLevel % levelSideCount,\n            });\n          }\n          if (triangleIndex !== lastIndexInLevel) {\n            yield* this.generateStringsBetweenTriangles(renderer, {\n              triangle1Index: triangleIndex,\n              triangle2Index: triangleIndex + 1,\n              triangle1Level: levelIndex,\n              triangle2Level: levelIndex,\n              triangleIndexInSide,\n            });\n          }\n\n          if (\n            triangleIndexInSide % 2 === 0 &&\n            ((renderCaps && renderTriangles) || levelIndex < levels - 1)\n          ) {\n            const side = Math.floor(triangleIndex / levelSideCount);\n            const nextLevelSideCount =\n              this.calc.countPerLevelSide[levelIndex + 1];\n            const nextLevelTriangleIndex =\n              side * nextLevelSideCount + triangleIndexInSide + 1;\n\n            yield* this.generateStringsBetweenTriangles(renderer, {\n              triangle1Index: triangleIndex,\n              triangle2Index: nextLevelTriangleIndex,\n              triangle1Level: levelIndex,\n              triangle2Level: levelIndex + 1,\n              triangleIndexInSide,\n              isNextLevel: true,\n            });\n          }\n        }\n\n        if (renderTriangles && (!isCapLevel || triangleIndexInSide % 2)) {\n          yield* this.generateTriangleStrings(renderer, {\n            level: levelIndex,\n            indexInSide: triangleIndexInSide,\n            triangleIndex,\n            isCapLevel,\n          });\n        }\n      }\n    }\n\n    if (renderRing && ringSize) {\n      yield* this.calc.ringCircle.drawRing(renderer, {\n        ringSize: ringSize / 2,\n        color: ringColor,\n      });\n    }\n  }\n\n  getStepCount(options: CalcOptions): number {\n    if (this.stepCount) {\n      return this.stepCount;\n    }\n\n    const calc = this.calc ?? this.getCalc(options);\n\n    const { density, renderTriangles, renderCaps, levels, fill } = this.config;\n    const { triangleCount, ringCircle } = calc;\n\n    const capCount = renderTriangles && renderCaps ? levels * 6 : 0;\n\n    // First we count how many fills there are. The calculation is like this:\n    // For each level, there's a fill between each triangle\n    // Also, for each level, there are (level - 1) * 6 fills, where the level is zero-based (the first level is 0)\n    // Finally, if there are caps, each cap has a fill\n    let fillCount = 0;\n    if (fill) {\n      const getTriangleCountForLevel = (level: number) => 6 * (level * 2 + 1);\n\n      for (let level = 0; level < levels; level++) {\n        const levelTrianglecount = getTriangleCountForLevel(level);\n        fillCount += levelTrianglecount + level * 6;\n      }\n\n      fillCount += capCount;\n    }\n\n    const fillStepCount = fillCount * density * 2;\n    const capSteps = capCount * (2 * density + 1);\n\n    return (\n      (renderTriangles ? triangleCount * density * 6 : 0) +\n      capSteps +\n      fillStepCount +\n      (ringCircle ? ringCircle.getRingStepCount() : 0)\n    );\n  }\n\n  getNailCount(): number {\n    return (\n      this.#getTrianglesNailsCount() +\n      (this.config.renderRing ? this.config.ringNailCount : 0)\n    );\n  }\n\n  #getTrianglesNailsCount(): number {\n    const { levels, renderCaps, density } = this.config;\n\n    const triangleCount = 6 * levels ** 2;\n    const capsCount = renderCaps ? levels * 6 : 0;\n    // jointsCount is the number of joints that are shared by multiple triangles, not counting the center joint\n    const jointsCount = ((levels * (levels + 1)) / 2) * 6 + 1;\n    const nailsPerTriangleWithoutJoints = (density - 1) * 3 + 1;\n    const capsNailCount = capsCount * ((density - 1) * 2 + 1);\n    return (\n      triangleCount * nailsPerTriangleWithoutJoints +\n      jointsCount +\n      capsNailCount\n    );\n  }\n\n  drawNails(nails: INails) {\n    nails.addGroup(this.calc.nailsGroup);\n\n    if (this.calc.ringCircle) {\n      this.calc.ringCircle.drawNails(nails);\n    }\n  }\n\n  #getPointKey(\n    level: number,\n    triangle: number,\n    side: number,\n    index: number\n  ): string | number {\n    return index\n      ? 1e6 * level + 1e3 * triangle + side * 1e2 + index\n      : 1e6 * level + 1e3 * triangle;\n  }\n\n  thumbnailConfig = ({ density }) => ({\n    density: Math.min(density, 3),\n  });\n}\n","import StringArt from '../infra/StringArt';\nimport Circle, { CircleConfig } from '../shapes/Circle';\nimport Color from '../helpers/color/Color';\nimport { ColorConfig } from '../helpers/color/color.types';\nimport Renderer from '../infra/renderers/Renderer';\nimport { ControlsConfig } from '../types/config.types';\nimport { CalcOptions } from '../types/stringart.types';\nimport INails from '../infra/nails/INails';\n\ntype SpreadModeType = 'evenly' | 'distance';\n\ninterface CometConfig extends CircleConfig, ColorConfig {\n  layers: number;\n  ringSize: number;\n  layerSpread: SpreadModeType;\n  layerDistance: number;\n  colorPerLayer: boolean;\n}\n\ninterface SpreadMode {\n  f: (layerIndex: number, config: CometConfig) => number;\n  name: string;\n}\n\nconst spreadModes: Record<SpreadModeType, SpreadMode> = {\n  evenly: {\n    f: (layerIndex, { ringSize, layers, n }) => {\n      const firstLayerDistance = Math.floor(n * ringSize);\n      return Math.floor(((layers - layerIndex) * firstLayerDistance) / layers);\n    },\n    name: 'Evenly',\n  },\n  distance: {\n    f: (layerIndex, { n, ringSize, layerDistance }) => {\n      const firstLayerDistance = Math.floor(n * ringSize);\n\n      if (layerIndex > 0) {\n        return firstLayerDistance - layerIndex * layerDistance;\n      }\n\n      return firstLayerDistance;\n    },\n    name: 'Specific distance',\n  },\n};\n\nconst COLOR_CONFIG = Color.getConfig({\n  defaults: {\n    isMultiColor: true,\n    color: '#ff0000',\n    multicolorRange: 133,\n    multicolorStart: 239,\n    multicolorByLightness: false,\n    minLightness: 30,\n    maxLightness: 70,\n    colorCount: 4,\n  },\n  customControls: [\n    {\n      key: 'colorPerLayer',\n      label: 'Color per layer',\n      defaultValue: true,\n      type: 'checkbox',\n      affectsNails: false,\n    },\n  ],\n});\n\ntype TCalc = {\n  circle: Circle;\n};\n\nexport default class Comet extends StringArt<CometConfig, TCalc> {\n  static type = 'comet';\n\n  name = 'Comet';\n  id = 'comet';\n  controls: ControlsConfig<CometConfig> = [\n    Circle.nailsConfig,\n    {\n      key: 'layers',\n      label: 'Layers',\n      defaultValue: 5,\n      type: 'range',\n      attr: {\n        min: 1,\n        max: 20,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    {\n      key: 'ringSize',\n      label: 'First layer size',\n      description:\n        'Nail count from the top center nail to the first connected nail in the first layer',\n      defaultValue: 0.3,\n      type: 'range',\n      attr: {\n        min: 0,\n        max: 1,\n        step: 0.01,\n      },\n      displayValue: ({ ringSize, n }) => Math.floor(n * ringSize),\n      isStructural: true,\n      affectsNails: false,\n    },\n    {\n      key: 'layerSpread',\n      label: 'Layer Spread',\n      type: 'select',\n      defaultValue: 'distance',\n      options: Object.entries(spreadModes).map(([key, { name }]) => ({\n        value: key,\n        label: name,\n      })),\n      isStructural: true,\n      affectsNails: false,\n    },\n    {\n      key: 'layerDistance',\n      label: 'Layer Distance',\n      type: 'range',\n      attr: {\n        min: 1,\n        max: ({ n, layers }) => Math.floor(n / 2 / layers),\n        step: 1,\n      },\n      defaultValue: 1,\n      isStructural: true,\n      show: ({ layerSpread }) => layerSpread !== 'evenly',\n      affectsNails: false,\n    },\n    Circle.rotationConfig,\n    Circle.distortionConfig,\n    Circle.displacementConfig,\n    COLOR_CONFIG,\n  ];\n\n  defaultValues: Partial<CometConfig> = {\n    n: 51,\n    layers: 11,\n    colorPerLayer: true,\n    multicolorRange: 203,\n    multicolorStart: 137,\n    ringSize: 0.47,\n    rotation: 90 / 360,\n    distortion: 0.38,\n    displacementFunc: 'fastInOut',\n    displacementMag: 1.8,\n    displacementFastArea: 0.43,\n    layerSpread: 'distance',\n    layerDistance: 1,\n  };\n\n  color: Color;\n\n  getCalc(options: CalcOptions): TCalc {\n    const circleConfig = {\n      size: options.size,\n      n: this.config.n,\n      margin: this.config.margin,\n      rotation: this.config.rotation,\n      distortion: this.config.distortion,\n      displacementFunc: this.config.displacementFunc,\n      displacementMag: this.config.displacementMag,\n      displacementFastArea: this.config.displacementFastArea,\n    };\n\n    return {\n      circle: new Circle(circleConfig),\n    };\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n\n    if (!this.stepCount) {\n      this.stepCount = this.getStepCount();\n    }\n\n    const { isMultiColor, colorCount, layers, colorPerLayer } = this.config;\n    const realColorCount = isMultiColor\n      ? colorPerLayer\n        ? layers\n        : Math.min(colorCount, layers)\n      : 1;\n\n    this.color = new Color({\n      ...this.config,\n      isMultiColor,\n      colorCount: realColorCount,\n    });\n  }\n\n  getAspectRatio(calcOptions: CalcOptions): number {\n    const calc = this.getCalc(calcOptions);\n    return calc.circle.getAspectRatio();\n  }\n\n  getLayerRingDistance(layerIndex: number): number {\n    const spread = spreadModes[this.config.layerSpread];\n    if (!spread) {\n      throw new Error(`Invalid spread mode, \"${this.config.layerSpread}\"!`);\n    }\n\n    return spread.f(layerIndex, this.config);\n  }\n\n  getLayerRingStepCount(layerIndex: number): number {\n    const layerRingDistance = this.getLayerRingDistance(layerIndex);\n    return (this.config.n - layerRingDistance + 1) * 2 - 1;\n  }\n\n  *drawLayer(renderer: Renderer, layerIndex = 0): Generator<void> {\n    const { n } = this.config;\n    const ringDistance = this.getLayerRingDistance(layerIndex);\n    const stepCount = n - ringDistance + 1;\n\n    let prevPoint = this.calc.circle.getPoint(0);\n    let prevPointIndex = 0;\n    renderer.setColor(this.color.getColor(layerIndex));\n\n    for (let i = 0; i < n - ringDistance + 1; i++) {\n      const pointIndex = i + ringDistance;\n      const point = this.calc.circle.getPoint(pointIndex);\n\n      renderer.renderLine(prevPoint, point);\n      yield;\n\n      if (i !== stepCount - 1) {\n        prevPointIndex = i + 1;\n        prevPoint = this.calc.circle.getPoint(prevPointIndex);\n\n        renderer.renderLine(point, prevPoint);\n\n        yield;\n      }\n    }\n  }\n\n  *drawStrings(renderer: Renderer) {\n    for (let layer = 0; layer < this.config.layers; layer++) {\n      yield* this.drawLayer(renderer, layer);\n    }\n  }\n\n  getStepCount(): number {\n    if (this.stepCount) {\n      return this.stepCount;\n    }\n\n    const { layers } = this.config;\n    return new Array(layers)\n      .fill(0)\n      .reduce(\n        (totalStepCount, _, layerIndex) =>\n          totalStepCount + this.getLayerRingStepCount(layerIndex),\n        0\n      );\n  }\n\n  getNailCount(): number {\n    return this.config.n;\n  }\n\n  drawNails(nails: INails) {\n    this.calc.circle.drawNails(nails);\n  }\n\n  thumbnailConfig = ({ n, layers }) => ({\n    n: Math.min(n, n % 2 ? 29 : 28),\n    layers: Math.min(layers, 8),\n  });\n}\n","import StringArt from '../infra/StringArt';\nimport Circle, { CircleConfig } from '../shapes/Circle';\nimport Color from '../helpers/color/Color';\nimport StarShape, { StarShapeConfig } from '../shapes/StarShape';\nimport { insertAfter } from '../helpers/config_utils';\nimport { mapKeys } from '../helpers/object_utils';\nimport { formatFractionAsPercent } from '../helpers/string_utils';\nimport type {\n  ControlConfig,\n  ControlsConfig,\n  GroupValue,\n} from '../types/config.types';\nimport { ColorConfig, ColorValue } from '../helpers/color/color.types';\nimport { Coordinates } from '../types/general.types';\nimport Renderer from '../infra/renderers/Renderer';\nimport { CalcOptions } from '../types/stringart.types';\nimport {\n  combineBoundingRects,\n  getBoundingRectAspectRatio,\n  getCenter,\n} from '../helpers/size_utils';\nimport NailsGroup from '../infra/nails/NailsGroup';\nimport INails from '../infra/nails/INails';\n\ninterface SunConfig extends StarShapeConfig, ColorConfig {\n  layers: number;\n  layerSpread: number;\n  starRadius: number;\n  backdrop: GroupValue;\n  backdropColorCount: number;\n  backdropNailsRadius: number;\n  backdropSize: number;\n  backdropRadius: number;\n  backdropShift: number;\n  backdropSkip: boolean;\n  backdropNailsColor: ColorValue;\n  backdropIsMultiColor: boolean;\n  starGroup: GroupValue;\n}\n\ninterface TCalc {\n  backdropNails: number;\n  star: StarShape;\n  circle: Circle;\n}\n\nexport default class Sun extends StringArt<SunConfig, TCalc> {\n  static type = 'sun';\n\n  name = 'Sun';\n  id = 'sun';\n  controls: ControlsConfig<SunConfig> = [\n    {\n      key: 'starGroup',\n      label: 'Star',\n      type: 'group',\n      children: [\n        ...insertAfter<SunConfig>(\n          [\n            ...StarShape.StarConfig,\n            Color.getConfig({\n              defaults: {\n                isMultiColor: true,\n                multicolorRange: 1,\n                multicolorStart: 237,\n                color: '#ffffff',\n                saturation: 40,\n                multicolorByLightness: true,\n                minLightness: 20,\n                maxLightness: 97,\n              },\n              exclude: ['colorCount'],\n            }),\n          ],\n          'sides',\n          [\n            {\n              key: 'layers',\n              label: 'Layers',\n              defaultValue: 4,\n              type: 'range',\n              attr: {\n                min: 1,\n                max: 20,\n                step: 1,\n              },\n              isStructural: true,\n            },\n            {\n              key: 'layerSpread',\n              label: 'Layer spread',\n              defaultValue: 0.1625,\n              type: 'range',\n              displayValue: ({ layerSpread }) =>\n                formatFractionAsPercent(layerSpread),\n              attr: {\n                min: 0.01,\n                max: 1,\n                step: 0.02,\n              },\n              show: ({ layers }) => layers !== 1,\n              isStructural: true,\n            },\n            {\n              key: 'starRadius',\n              label: 'Star Radius',\n              defaultValue: 1,\n              type: 'range',\n              displayValue: ({ starRadius }) =>\n                formatFractionAsPercent(starRadius),\n              attr: {\n                min: 0.2,\n                max: 1,\n                step: 0.01,\n              },\n              isStructural: true,\n              affectsStepCount: false,\n            },\n          ]\n        ),\n      ],\n    },\n    {\n      key: 'backdrop',\n      label: 'Backdrop',\n      type: 'group',\n      children: [\n        {\n          key: 'backdropSize',\n          label: 'Backdrop size',\n          defaultValue: 0.5,\n          type: 'range',\n          displayValue: ({ backdropSize }) =>\n            formatFractionAsPercent(backdropSize),\n          attr: {\n            min: 0,\n            max: 1,\n            step: ({ sideNails }) => 1 / sideNails,\n          },\n          isStructural: true,\n        },\n        {\n          key: 'backdropRadius',\n          label: 'Backdrop radius',\n          defaultValue: 1,\n          type: 'range',\n          displayValue: ({ backdropRadius }) =>\n            formatFractionAsPercent(backdropRadius),\n          attr: {\n            min: 0,\n            max: 1,\n            step: 0.01,\n          },\n          isStructural: true,\n          affectsStepCount: false,\n        },\n        {\n          key: 'backdropShift',\n          label: 'Backdrop shift',\n          defaultValue: 0,\n          type: 'range',\n          displayValue: ({ backdropShift }) =>\n            formatFractionAsPercent(backdropShift),\n          attr: {\n            min: 0,\n            max: 1,\n            step: ({ sideNails, backdropSize }) =>\n              (1 / (sideNails * (1 - backdropSize))).toFixed(3),\n          },\n          isStructural: true,\n          affectsStepCount: false,\n          affectsNails: false,\n        },\n        {\n          key: 'backdropSkip',\n          label: 'Backdrop skip',\n          description:\n            \"If yes, connections in the backdrop are from the backdrop's nail to the second-nearest side, not the ones near it\",\n          defaultValue: false,\n          type: 'checkbox',\n          isStructural: true,\n          affectsStepCount: false,\n          show: ({ sides }) => sides > 3,\n        },\n        Color.getConfig<SunConfig>({\n          defaults: {\n            isMultiColor: true,\n            multicolorRange: 20,\n            multicolorStart: 0,\n            color: '#ffffff',\n            saturation: 57,\n            multicolorByLightness: true,\n            minLightness: 20,\n            maxLightness: 40,\n          },\n          propMapper: ({ key, show }) => {\n            const newKey = 'backdrop' + key[0].toUpperCase() + key.slice(1);\n            const control: Partial<ControlConfig<any>> = {\n              key: 'backdrop' + key[0].toUpperCase() + key.slice(1),\n              show: show\n                ? ({ backdropIsMultiColor }) =>\n                    key === 'color'\n                      ? !backdropIsMultiColor\n                      : backdropIsMultiColor\n                : null,\n            };\n\n            if (key === 'multicolorRange') {\n              control.attr = {\n                start: ({ backdropMulticolorStart }) => backdropMulticolorStart,\n                type: 'range',\n              };\n            }\n            return control;\n          },\n          groupLabel: 'Backdrop color',\n          maxColorCount: 2,\n        }),\n      ],\n    },\n  ];\n\n  getCommonControls(): ControlsConfig<Partial<SunConfig>> {\n    return insertAfter<Partial<SunConfig>>(\n      super.getCommonControls(),\n      'nailsColor',\n      [\n        {\n          key: 'backdropNailsColor',\n          label: 'Backdrop nails color',\n          type: 'color',\n          defaultValue: '#ffffff',\n          show: ({ showNails }) => showNails,\n          affectsStrings: false,\n        },\n        {\n          key: 'backdropNailsRadius',\n          label: 'Backdrop nails radius',\n          type: 'range',\n          defaultValue: 1.5,\n          attr: { min: 0.5, max: 5, step: 0.25 },\n          show: ({ showNails }) => showNails,\n          affectsStrings: false,\n        },\n      ]\n    );\n  }\n\n  #color: Color;\n  #backdropColor: Color;\n\n  defaultValues = {\n    sideNails: 50,\n    sides: 16,\n    layers: 4,\n    layerSpread: 0.77,\n    backdropSize: 0.26,\n    backdropRadius: 0.9,\n    backdropShift: 0.59,\n    backdropColorCount: 2,\n    centerRadius: 0.2,\n    maxCurveSize: 32 / 50,\n    rotation: 0.5,\n    saturation: 73,\n    multicolorStart: 206,\n    multicolorRange: 1,\n    multicolorByLightness: true,\n    minLightness: 35,\n    maxLightness: 100,\n    nailsColor: '#000000',\n    backdropNailsColor: '#ffffff',\n    backdropNailsRadius: 2.275,\n  };\n\n  getCalc({ size }: CalcOptions): TCalc {\n    const {\n      margin = 0,\n      sideNails,\n      backdropRadius: backdropRadiusConfig = 1,\n      backdropSize,\n      rotation,\n      sides,\n      starRadius: starRadiusConfig = 1,\n    } = this.config;\n    const center = getCenter(size);\n    const radius = Math.min(...center) - margin;\n    const starRadius =\n      backdropSize && starRadiusConfig < backdropRadiusConfig\n        ? (radius * starRadiusConfig) / backdropRadiusConfig\n        : radius;\n    const backdropRadius =\n      backdropRadiusConfig < starRadiusConfig\n        ? (radius * backdropRadiusConfig) / starRadiusConfig\n        : radius;\n\n    const starConfig: StarShapeConfig = {\n      ...this.config,\n      radius: starRadius,\n      size,\n    };\n\n    const circleConfig: CircleConfig = {\n      size,\n      n: sides,\n      rotation: -1 / sides / 2 + (rotation ? rotation / sides : 0),\n      radius: backdropRadius,\n    };\n\n    return {\n      backdropNails: Math.floor(sideNails * backdropSize),\n      star: new StarShape(starConfig),\n      circle: new Circle(circleConfig),\n    };\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n\n    const { layers, backdropColorCount } = this.config;\n\n    this.#color = new Color({\n      ...this.config,\n      colorCount: layers,\n    });\n\n    // @ts-ignore this is fine for now, until the color config is managed in a single control\n    this.#backdropColor = new Color({\n      ...mapKeys(this.config, key => {\n        const match = key.match(/^backdrop(\\w)(.+)/);\n        return match ? match[1].toLowerCase() + match[2] : key;\n      }),\n      colorCount: backdropColorCount,\n    });\n  }\n\n  getAspectRatio(options: CalcOptions): number {\n    const calc = this.getCalc(options);\n    const boundingRect = combineBoundingRects(\n      calc.circle.getBoundingRect(),\n      calc.star.getBoundingRect()\n    );\n    return getBoundingRectAspectRatio(boundingRect);\n  }\n\n  *drawStar(renderer: Renderer, size?: number): Generator<void> {\n    yield* this.calc.star.drawStrings(renderer, { size });\n  }\n\n  *generateLayers(renderer: Renderer): Generator<void> {\n    const { layers } = this.config;\n\n    for (let layer = 0; layer < layers; layer++) {\n      const color = this.#color.getColor(layer);\n      renderer.setColor(color);\n\n      const layerSize = this.#getLayerSize(layer);\n      yield* this.drawStar(renderer, layerSize);\n    }\n  }\n\n  *drawBackdrop(renderer: Renderer): Generator<void> {\n    // For each side, add a nail between two star sides, at the specified backdropRadius.\n    // For the backdrop size, connect the nail to the number of points in the star for the two sides near the backdrop nail\n\n    const { backdropNails, circle, star } = this.calc;\n    const { sides, backdropShift, sideNails, backdropSkip } = this.config;\n\n    const shouldSkip = backdropSkip && sides > 3;\n    let prevPoint: Coordinates;\n    let currentSide = 0;\n    const shift = Math.floor(backdropShift * (sideNails - backdropNails));\n\n    let currentSideIndex = shift + backdropNails - 1;\n\n    for (let side = 0; side < sides; side++) {\n      renderer.setColor(this.#backdropColor.getColor(side % 2 ? 0 : 1));\n      const backdropPoint = circle.getPoint(\n        shouldSkip ? (side + 1) % sides : side\n      );\n      let alternate = false;\n      const direction = side % 2 ? 1 : -1; // 1 if backdrop threading starts at the bottom and goes up, -1 if it goes down\n      prevPoint = star.getSidePoint(side, currentSideIndex);\n\n      for (let i = 0; i < backdropNails; i++) {\n        renderer.renderLine(prevPoint, backdropPoint);\n        yield;\n\n        currentSide = (alternate ? side : side + (shouldSkip ? 3 : 1)) % sides;\n        prevPoint = star.getSidePoint(currentSide, currentSideIndex);\n        renderer.renderLine(backdropPoint, prevPoint);\n        yield;\n\n        if (i < backdropNails - 1) {\n          alternate = !alternate;\n          currentSideIndex += direction;\n          const nextPoint = star.getSidePoint(currentSide, currentSideIndex);\n          renderer.renderLine(prevPoint, nextPoint);\n          prevPoint = nextPoint;\n        }\n      }\n    }\n  }\n\n  *drawStrings(renderer: Renderer) {\n    yield* this.drawBackdrop(renderer);\n    yield* this.generateLayers(renderer);\n  }\n\n  drawNails(nails: INails) {\n    const { backdropSize, backdropNailsColor, backdropNailsRadius } =\n      this.config;\n\n    this.calc.star.drawNails(nails);\n    if (backdropSize) {\n      const backdropNailsGroup = new NailsGroup({\n        color: backdropNailsColor,\n        radius: backdropNailsRadius,\n      });\n\n      this.calc.circle.drawNails(backdropNailsGroup);\n      nails.addGroup(backdropNailsGroup);\n    }\n  }\n\n  #getLayerSize(layer: number): number {\n    const { layers, layerSpread, sideNails } = this.config;\n    return Math.max(\n      1,\n      sideNails -\n        layer * Math.max(1, Math.floor((sideNails / layers) * layerSpread))\n    );\n  }\n\n  getStepCount(options: CalcOptions) {\n    const { layers, sides } = this.config;\n    const { backdropNails } = this.getCalc(options);\n\n    const backdropStepCount = sides * backdropNails * 2;\n\n    let stepCount = backdropStepCount;\n    for (let layer = 0; layer < layers; layer++) {\n      const layerSize = this.#getLayerSize(layer);\n      stepCount += StarShape.getStepCount(this.config, { size: layerSize });\n    }\n\n    return stepCount;\n  }\n\n  thumbnailConfig = ({ sideNails, backdropNailsRadius }) => ({\n    sideNails: Math.min(sideNails, 10),\n    backdropNailsRadius: Math.min(backdropNailsRadius, 0.5),\n  });\n}\n","import StringArt from '../infra/StringArt';\nimport Circle, { CircleConfig } from '../shapes/Circle';\nimport Color from '../helpers/color/Color';\nimport type { ControlsConfig } from '../types/config.types';\nimport { ColorConfig, ColorValue } from '../helpers/color/color.types';\nimport { Coordinates, Dimensions } from '../types/general.types';\nimport { withoutAttribute } from '../helpers/config_utils';\nimport { getDistanceBetweenCoordinates, PI2 } from '../helpers/math_utils';\nimport { formatFractionAsPercent } from '../helpers/string_utils';\nimport Renderer from '../infra/renderers/Renderer';\nimport { CalcOptions } from '../types/stringart.types';\nimport {\n  combineBoundingRects,\n  getBoundingRectAspectRatio,\n  getCenter,\n} from '../helpers/size_utils';\nimport { createArray } from '../helpers/array_utils';\nimport INails from '../infra/nails/INails';\n\ninterface LotusConfig extends ColorConfig {\n  sides: number;\n  density: number;\n  rotation: number;\n  removeSections: number;\n  renderCenter: boolean;\n  renderCenterNails: boolean;\n  radialColor: boolean;\n  centerRadius: number;\n}\n\ninterface TCalc {\n  circles: ReadonlyArray<Circle>;\n  circleNailsCount: number;\n  sideAngle: number;\n  sections: number;\n  nailsPerSection: number;\n  nailsPerCircle: number;\n  removedSections: number;\n  centerCircle?: Circle;\n  center: Coordinates;\n}\n\nexport default class Lotus extends StringArt<LotusConfig, TCalc> {\n  static type = 'lotus';\n\n  name = 'Lotus';\n  id = 'lotus';\n  controls: ControlsConfig<LotusConfig> = [\n    {\n      key: 'sides',\n      label: 'Sides',\n      description: 'How many petals there are in the Lotus',\n      type: 'range',\n      defaultValue: 18,\n      attr: {\n        min: 5,\n        max: 64,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    {\n      key: 'density',\n      label: 'Density',\n      type: 'range',\n      defaultValue: 15,\n      attr: {\n        min: 1,\n        max: 30,\n        step: 1,\n      },\n      isStructural: true,\n    },\n    withoutAttribute(Circle.rotationConfig, 'snap'),\n    {\n      key: 'removeSections',\n      label: 'Remove sections',\n      type: 'range',\n      attr: {\n        min: 0,\n        max: 1,\n        step: ({ sides, renderCenter }) =>\n          1 / getSectionCountToRemove(sides, renderCenter),\n      },\n      defaultValue: 4 / 7,\n      displayValue: ({ removeSections, sides, renderCenter }) =>\n        Math.round(\n          removeSections * getSectionCountToRemove(sides, renderCenter)\n        ),\n      isStructural: true,\n    },\n    {\n      key: 'renderCenter',\n      label: 'Render center',\n      type: 'checkbox',\n      defaultValue: true,\n      isStructural: true,\n    },\n    {\n      key: 'centerRadius',\n      label: 'Center radius',\n      type: 'range',\n      defaultValue: 1,\n      attr: {\n        min: 0,\n        max: 1,\n        step: 0.01,\n      },\n      displayValue: ({ centerRadius }) => formatFractionAsPercent(centerRadius),\n      show: ({ renderCenter }) => renderCenter,\n      isStructural: true,\n      affectsStepCount: false,\n    },\n    {\n      key: 'renderCenterNails',\n      label: 'Render center nails',\n      type: 'checkbox',\n      defaultValue: false,\n      isStructural: true,\n      show: ({ renderCenter }) => renderCenter,\n    },\n    Color.getConfig({\n      defaults: {\n        isMultiColor: true,\n        multicolorStart: 20,\n        multicolorRange: 26,\n        multicolorByLightness: true,\n        minLightness: 32,\n        maxLightness: 85,\n        saturation: 100,\n        colorCount: 6,\n        mirrorColors: true,\n      },\n      customControls: [\n        {\n          key: 'radialColor',\n          label: 'Radial color',\n          defaultValue: false,\n          type: 'checkbox',\n          affectsNails: false,\n          affectsStepCount: false,\n        },\n      ],\n      maxColorCount: 32,\n    }),\n  ];\n\n  defaultValues = {\n    nailsColor: '#a08346',\n  };\n\n  #color: Color;\n\n  getCalc({ size }: CalcOptions): TCalc {\n    const {\n      sides,\n      density,\n      margin,\n      rotation,\n      removeSections,\n      centerRadius: centerRadiusPercent,\n      renderCenter,\n    } = this.config;\n    const d = 0.5; // The helper circle's center is right between the pattern center and the edge\n    const center = getCenter(size);\n    let radius = (Math.min(...size) * d) / 2;\n\n    const sideAngle = PI2 / sides;\n    const densityNailCount = density * sides;\n    const baseCircleConfig: CircleConfig = {\n      n: densityNailCount,\n      center: [0, 0],\n      size: [0, 0],\n      radius: 0,\n      rotation: 0,\n    };\n\n    let petalSectionsToRemove = 0;\n\n    if (removeSections) {\n      const maxPetalSectionsToRemove = getSectionCountToRemove(\n        sides,\n        renderCenter\n      );\n      petalSectionsToRemove = Math.min(\n        maxPetalSectionsToRemove,\n        Math.round(removeSections * maxPetalSectionsToRemove)\n      );\n\n      const angleStart = sideAngle * petalSectionsToRemove;\n\n      // Since we removed sections and now the pattern is smaller than the canvas size, we fit the remaining shape to fit on canvas\n      // this is done by:\n      // 1. Calculating the new outer edge of the shape, after removing sections\n      // 2. Increase the size of the circles that create petals by the inverse ratio of the new to original size\n      // 3. Since the circles are now larger, increase the number of nails in the circles by the size ratio, to maintain density.\n      const topSectionHeight =\n        2 * radius * Math.sin((Math.PI - angleStart) / 2);\n      const fitAspectRatio = (2 * radius - margin) / topSectionHeight;\n      baseCircleConfig.n = removeSectionsNailCount(\n        fixNailsCount(densityNailCount * fitAspectRatio),\n        petalSectionsToRemove\n      );\n      radius *= fitAspectRatio;\n\n      Object.assign(baseCircleConfig, {\n        angleStart,\n        angleEnd: PI2 - angleStart,\n      });\n    }\n\n    Object.assign(baseCircleConfig, {\n      size: [radius - margin / 2, radius - margin / 2],\n      radius: radius - margin / 2,\n    });\n\n    // Draw circles around the center point. For this, create a helper Circle, so its points can be used as centers for the lotus circles:\n    const helperCircle = new Circle({\n      n: sides,\n      size: size.map(v => v * d - margin) as Dimensions,\n      center,\n      radius: radius - margin / 2,\n      rotation,\n    });\n\n    const circles = createArray(\n      sides,\n      i =>\n        new Circle({\n          ...baseCircleConfig,\n          center: helperCircle.getPoint(i),\n          rotation: rotation - i / sides,\n        })\n    );\n\n    const calc: TCalc = {\n      circles,\n      circleNailsCount: baseCircleConfig.n,\n      sideAngle,\n      sections: getSectionsCount(sides),\n      removedSections: petalSectionsToRemove,\n      nailsPerSection: Math.floor(\n        baseCircleConfig.n / (sides - 2 * petalSectionsToRemove)\n      ),\n      nailsPerCircle: baseCircleConfig.n,\n      center,\n    };\n\n    if (renderCenter && centerRadiusPercent) {\n      // If a center radius value larger than 0 is configured, the inner section's connect point isn't the center of the pattern,\n      // but points around it, so we create a circle to function as points for the inner section patches to connect to.\n      const lastSection = calc.sections - 1 - calc.removedSections;\n      const maxCenterRadiusPoint = circles[0].getPoint(\n        lastSection * calc.nailsPerSection\n      );\n      const maxCenterRadius = Math.floor(\n        getDistanceBetweenCoordinates(helperCircle.center, maxCenterRadiusPoint)\n      );\n      const centerCircleRadius = centerRadiusPercent * maxCenterRadius;\n      calc.centerCircle = new Circle({\n        n: sides,\n        center: helperCircle.center,\n        size: [centerCircleRadius, centerCircleRadius],\n        radius: centerCircleRadius,\n        rotation: rotation + -Math.ceil((sides - 4) / 2) / 2 / sides,\n      });\n    }\n\n    return calc;\n\n    function fixNailsCount(nailsCount: number): number {\n      return Math.max(sides, nailsCount - (nailsCount % sides));\n    }\n\n    function removeSectionsNailCount(\n      fullCircleNailCount: number,\n      sectionsToRemove: number\n    ): number {\n      return Math.round(\n        fullCircleNailCount * (1 - (2 * sectionsToRemove) / sides) + 1\n      );\n    }\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n\n    let colorCount = this.config.radialColor\n      ? this.calc.sections - this.calc.removedSections - 1\n      : this.config.colorCount;\n\n    if (!this.config.renderCenter && this.config.radialColor) {\n      colorCount--;\n    }\n\n    this.#color = new Color({\n      ...this.config,\n      colorCount,\n    });\n  }\n\n  getAspectRatio(options: CalcOptions): number {\n    const calc = this.getCalc(options);\n    const boundingRect = combineBoundingRects(\n      ...calc.circles.map(c => c.getBoundingRect())\n    );\n    return getBoundingRectAspectRatio(boundingRect);\n  }\n\n  #getPatchColor(circleIndex: number, section: number): ColorValue {\n    const { radialColor } = this.config;\n    const { removedSections } = this.calc;\n\n    return this.#color.getColor(\n      radialColor ? section - removedSections : circleIndex\n    );\n  }\n\n  *#drawPatch(\n    renderer: Renderer,\n    circleIndex: number,\n    section: number\n  ): Generator<void> {\n    const { sides } = this.config;\n    const {\n      circles,\n      sections,\n      nailsPerSection,\n      nailsPerCircle,\n      removedSections,\n    } = this.calc;\n\n    const color = this.#getPatchColor(circleIndex, section);\n    const circle = circles[circleIndex];\n\n    renderer.setColor(color);\n\n    const prevCircle =\n      this.calc.circles[circleIndex === 0 ? sides - 1 : circleIndex - 1];\n\n    if (section === 0) {\n      // For first section (outtermost): connectPoint is `prevCircle[sideAngle * 2]\n      const connectPoint: Coordinates = prevCircle.getPoint(\n        nailsPerSection * 2\n      );\n      for (let i = nailsPerCircle - nailsPerSection; i < nailsPerCircle; i++) {\n        renderer.renderLine(circle.getPoint(i), connectPoint);\n        yield;\n      }\n      for (let i = 0; i <= nailsPerSection; i++) {\n        renderer.renderLine(circle.getPoint(i), connectPoint);\n        yield;\n      }\n    } else {\n      // For middle sections, connectPoint is `circleIndex - 1`, (sideAngle * section + 1). Connect circleIndex[section] and `circleIndex + section`[section]\n\n      const isLastSection = section === sections - 2;\n      const connectPoint: Coordinates =\n        isLastSection && this.calc.centerCircle\n          ? this.calc.centerCircle.getPoint(circleIndex)\n          : prevCircle.getPoint(\n              nailsPerSection * (section + 2 - removedSections) -\n                (sides % 2 && section === sections - 2\n                  ? nailsPerSection / 2\n                  : 0)\n            );\n      const firstCircle = circles[(circleIndex + section) % sides];\n      const firstCircleStart =\n        nailsPerCircle -\n        (section + 1 - removedSections) * nailsPerSection -\n        (removedSections ? 1 : 0);\n\n      for (let i = 0; i <= nailsPerSection; i++) {\n        renderer.renderLine(\n          firstCircle.getPoint(firstCircleStart + i),\n          connectPoint\n        );\n        yield;\n      }\n\n      const startIndex = (section - removedSections) * nailsPerSection + 1;\n      for (let i = startIndex; i < startIndex + nailsPerSection; i++) {\n        renderer.renderLine(circle.getPoint(i), connectPoint);\n        yield;\n      }\n    }\n  }\n\n  *drawStrings(renderer: Renderer): Generator<void> {\n    for (const { side, section } of this.#generatePatches()) {\n      yield* this.#drawPatch(renderer, side, section);\n    }\n  }\n\n  *#generatePatches(): Generator<{ side: number; section: number }> {\n    const { radialColor, sides, renderCenter } = this.config;\n    const { sections, removedSections } = this.calc;\n\n    const lastSection = sections - (renderCenter ? 1 : 2);\n\n    if (radialColor) {\n      for (let section = removedSections; section < lastSection; section++) {\n        for (let side = 0; side < sides; side++) {\n          yield { side, section };\n        }\n      }\n    } else {\n      for (let side = 0; side < sides; side++) {\n        for (let section = removedSections; section < lastSection; section++) {\n          yield { side, section };\n        }\n      }\n    }\n  }\n\n  drawNails(nails: INails) {\n    const { renderCenter, renderCenterNails } = this.config;\n    const { circles, centerCircle, nailsPerCircle } = this.calc;\n\n    if (renderCenter) {\n      if (centerCircle) {\n        centerCircle.drawNails(nails);\n      } else {\n        nails.addNail('C', this.calc.center);\n      }\n    }\n\n    circles.forEach((circle, i) => {\n      const circleIndexStart = centerCircle.config.n + nailsPerCircle * i;\n      circle.drawNails(nails, {\n        getUniqueKey: k => circleIndexStart + k,\n        excludedNailRanges: renderCenterNails\n          ? null\n          : this.#getCenterExcludedNails(),\n      });\n    });\n  }\n\n  #getCenterExcludedNails(): [[number, number]] {\n    const { renderCenter } = this.config;\n    const { sections, nailsPerSection, nailsPerCircle, removedSections } =\n      this.calc;\n\n    const innerSectionNailsStart =\n      (sections - 1 - removedSections - (renderCenter ? 0 : 1)) *\n        nailsPerSection +\n      1;\n    const innerSectionNailsEnd = nailsPerCircle - innerSectionNailsStart;\n\n    return [[innerSectionNailsStart, innerSectionNailsEnd]];\n  }\n\n  getStepCount(options: CalcOptions) {\n    const { nailsPerSection, sections, removedSections } =\n      this.getCalc(options);\n    const { sides } = this.config;\n\n    const patchCount = 2 * nailsPerSection + 1;\n    const sideStepCount = patchCount * (sections - removedSections - 1);\n\n    return sides * sideStepCount;\n  }\n\n  thumbnailConfig = ({ density }) => ({\n    density: Math.min(density, 5),\n  });\n}\n\nfunction getSectionsCount(sides: number): number {\n  return sides % 2 ? Math.ceil(sides / 2) : sides / 2;\n}\n\nfunction getSectionCountToRemove(sides: number, renderCenter: boolean): number {\n  return getSectionsCount(sides) - (renderCenter ? 2 : 3);\n}\n","import StringArt from '../infra/StringArt';\nimport Circle from '../shapes/Circle';\nimport Color from '../helpers/color/Color';\nimport { ColorConfig, ColorMap } from '../helpers/color/color.types';\nimport Renderer from '../infra/renderers/Renderer';\nimport {\n  ControlConfig,\n  ControlsConfig,\n  GroupValue,\n} from '../types/config.types';\nimport { CalcOptions } from '../types/stringart.types';\nimport type Shape from '../shapes/Shape';\nimport { getCenter, mapDimensions } from '../helpers/size_utils';\nimport Polygon from '../shapes/Polygon';\nimport {\n  formatFractionAsAngle,\n  formatFractionAsPercent,\n} from '../helpers/string_utils';\nimport { Dimensions } from '../types/general.types';\nimport INails from '../infra/nails/INails';\n\ntype ShapeType = 'circle' | 'polygon';\n\ninterface DanceOfPlanetsConfig extends ColorConfig {\n  rounds: number;\n  reverse: boolean;\n\n  shape1: GroupValue;\n  shape1Type: ShapeType;\n  shape1NailCount: number;\n  shape1Sides: number;\n  shape1Rotation: number;\n  shape1Distortion: number;\n\n  shape2: GroupValue;\n  shape2Type: ShapeType;\n  shape2Size: number;\n  shape2NailCount: number;\n  shape2Sides: number;\n  shape2Rotation: number;\n  identicalNailCount: boolean;\n  shape2Distortion: number;\n}\n\ntype TCalc = {\n  shape1: Shape;\n  shape2: Shape;\n  shape1NailCount: number;\n  shape2NailCount: number;\n};\n\nconst COLOR_CONFIG = Color.getConfig({\n  defaults: {\n    isMultiColor: true,\n    colorCount: 7,\n    color: '#ffbb29',\n    multicolorRange: 21,\n    multicolorStart: 32,\n    multicolorByLightness: true,\n    minLightness: 36,\n    maxLightness: 98,\n  },\n});\n\nfunction getShapeControlsGroup(\n  label: string,\n  shapeIndex: 1 | 2\n): ControlConfig<Partial<DanceOfPlanetsConfig>> {\n  return {\n    key: `shape${shapeIndex}`,\n    label,\n    type: 'group',\n    // @ts-ignore\n    children: [\n      {\n        key: `shape${shapeIndex}Type`,\n        label: 'Type',\n        type: 'select',\n        defaultValue: 'circle',\n        options: [\n          { value: 'circle', label: 'Circle' },\n          { value: 'polygon', label: 'Polygon' },\n        ],\n        isStructural: true,\n      },\n      shapeIndex === 2\n        ? {\n            key: `shape${shapeIndex}Size`,\n            label: 'Size',\n            type: 'range',\n            attr: {\n              min: 0.1,\n              max: 1,\n              step: 0.01,\n            },\n            defaultValue: 1,\n            displayValue: (config: Partial<DanceOfPlanetsConfig>) =>\n              formatFractionAsPercent(config[`shape${shapeIndex}Size`]),\n            isStructural: true,\n            affectsStepCount: false,\n          }\n        : undefined,\n      {\n        key: `shape${shapeIndex}Sides`,\n        label: 'Sides',\n        type: 'range',\n        attr: {\n          min: 3,\n          max: 24,\n          step: 1,\n        },\n        defaultValue: 7,\n        isStructural: true,\n        show: (config: Partial<DanceOfPlanetsConfig>) =>\n          config[`shape${shapeIndex}Type`] === 'polygon',\n      },\n      {\n        ...Circle.distortionConfig,\n        key: `shape${shapeIndex}Distortion`,\n        show: (config: Partial<DanceOfPlanetsConfig>) =>\n          config[`shape${shapeIndex}Type`] === 'circle',\n      },\n      shapeIndex === 2\n        ? {\n            key: 'identicalNailCount',\n            label: 'Nail count as outer shape',\n            type: 'checkbox',\n            defaultValue: false,\n            isStructural: true,\n          }\n        : null,\n      {\n        key: `shape${shapeIndex}NailCount`,\n        label: 'Nail count',\n        type: 'range',\n        attr: {\n          min: 3,\n          max: 400,\n          step: 1,\n        },\n        defaultValue: 100,\n        isStructural: true,\n        show: ({ identicalNailCount }) =>\n          shapeIndex === 1 || !identicalNailCount,\n      },\n      {\n        key: `shape${shapeIndex}Rotation`,\n        label: 'Rotation',\n        type: 'range',\n        attr: {\n          min: 0,\n          max: 1,\n          step: 0.0027,\n        },\n        defaultValue: 0,\n        displayValue: (config: Partial<DanceOfPlanetsConfig>) =>\n          formatFractionAsAngle(config[`shape${shapeIndex}Rotation`]),\n        isStructural: true,\n      },\n    ].filter(Boolean),\n  };\n}\n\nexport default class DanceOfPlanets extends StringArt<\n  DanceOfPlanetsConfig,\n  TCalc\n> {\n  static type = 'dance_of_planets';\n\n  name = 'Dance of Planets';\n  id = 'dance_of_planets';\n  controls: ControlsConfig<DanceOfPlanetsConfig> = [\n    getShapeControlsGroup('Outer shape', 1),\n    getShapeControlsGroup('Inner shape', 2),\n    {\n      type: 'range',\n      key: 'rounds',\n      label: 'Rounds',\n      attr: {\n        min: 1,\n        max: 30,\n        step: 1,\n      },\n      defaultValue: 1,\n      affectsNails: false,\n    },\n    {\n      key: 'reverse',\n      type: 'checkbox',\n      label: 'Reverse order',\n      description:\n        'If on, while the first shape advances in one direction, the second shape advances in the opposite direction',\n      defaultValue: false,\n      isStructural: false,\n      affectsNails: false,\n    },\n    COLOR_CONFIG,\n  ];\n\n  defaultValues: Partial<DanceOfPlanetsConfig> = {\n    shape1Type: 'circle',\n    shape1NailCount: 150,\n    shape1Rotation: 0,\n    shape2Type: 'circle',\n    shape2Size: 0.8,\n    shape2NailCount: 117,\n    shape2Distortion: -0.12,\n    shape2Rotation: 0.216,\n    rounds: 2,\n    multicolorRange: 132,\n    multicolorStart: 198,\n    isMultiColor: true,\n    multicolorByLightness: false,\n    colorCount: 2,\n  };\n\n  color: Color;\n  colorMap: ColorMap;\n\n  getCalc({ size }: CalcOptions): TCalc {\n    const { margin } = this.config;\n    const center = getCenter(size);\n\n    function getShape({\n      type,\n      diameter = 1,\n      nailCount,\n      sides,\n      rotation = 0,\n      distortion,\n    }: {\n      type: ShapeType;\n      diameter?: number;\n      nailCount: number;\n      sides?: number;\n      rotation?: number;\n      distortion?: number;\n    }): Shape {\n      if (type === 'circle') {\n        return new Circle({\n          size: mapDimensions(size, v => v * diameter),\n          n: Math.round(nailCount),\n          radius: (Math.min(...size) * diameter) / 2,\n          center,\n          margin,\n          reverse: true,\n          rotation,\n          distortion,\n        });\n      } else {\n        sides = sides ?? 3;\n        nailCount = Math.max(nailCount, sides);\n\n        return new Polygon({\n          size: mapDimensions(size, v => v * diameter),\n          sides: sides ?? 3,\n          nailsPerSide: Math.round(nailCount / sides),\n          center,\n          margin,\n          rotation,\n        });\n      }\n    }\n\n    let shape1NailCount = this.#getShapeNailCount(\n      this.config.shape1Type,\n      this.config.shape1NailCount,\n      this.config.shape1Sides\n    );\n\n    let shape2NailCount = this.config.identicalNailCount\n      ? shape1NailCount\n      : this.config.shape2NailCount;\n\n    shape2NailCount = this.#getShapeNailCount(\n      this.config.shape2Type,\n      shape2NailCount,\n      this.config.shape2Sides\n    );\n    return {\n      shape1: getShape({\n        type: this.config.shape1Type,\n        nailCount: shape1NailCount,\n        sides: this.config.shape1Sides,\n        rotation: this.config.shape1Rotation,\n        distortion: this.config.shape1Distortion,\n      }),\n      shape2: getShape({\n        type: this.config.shape2Type,\n        diameter: this.config.shape2Size,\n        nailCount: shape2NailCount,\n        sides: this.config.shape2Sides,\n        rotation: this.config.shape2Rotation,\n        distortion: this.config.shape2Distortion,\n      }),\n      shape1NailCount,\n      shape2NailCount,\n    };\n  }\n\n  #getShapeNailCount(\n    shapeType: ShapeType,\n    nailCount: number,\n    sides: number\n  ): number {\n    if (shapeType === 'circle') {\n      return nailCount;\n    }\n\n    return nailCount <= sides ? sides : nailCount - (nailCount % sides);\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n    const { colorCount } = this.config;\n\n    this.color = new Color(this.config);\n\n    if (colorCount) {\n      this.colorMap = this.color.getColorMap({\n        stepCount: this.#getConnectionCount(),\n        colorCount,\n      });\n    }\n  }\n\n  getAspectRatio(): number {\n    const { shape1, shape2 } = this.calc ?? this.getCalc({ size: [100, 100] });\n    const rect1 = shape1.getBoundingRect();\n    const rect2 = shape2.getBoundingRect();\n\n    return (\n      Math.max(rect1.width, rect2.width) / Math.max(rect1.height, rect2.height)\n    );\n  }\n\n  #getConnectionCount(): number {\n    const { shape1NailCount, shape2NailCount } = this.calc;\n    const greaterNailCount = Math.max(shape1NailCount, shape2NailCount);\n\n    return greaterNailCount * this.config.rounds;\n  }\n\n  *drawStrings(renderer: Renderer) {\n    const { shape1, shape2, shape1NailCount, shape2NailCount } = this.calc;\n    const { reverse } = this.config;\n\n    const steps = this.#getConnectionCount();\n\n    renderer.setColor('#ffffff');\n    renderer.setStartingPoint(shape1.getPoint(0));\n\n    let toShape2 = true;\n\n    const getShape2Index = reverse\n      ? (step: number) =>\n          shape2NailCount - (step % shape2NailCount || shape2NailCount)\n      : (step: number) => step % shape2NailCount;\n\n    for (let step = 0; step < steps; step++) {\n      const stepColor = this.colorMap.get(step);\n      if (stepColor) {\n        renderer.setColor(stepColor);\n      }\n\n      renderer.lineTo(\n        toShape2\n          ? shape2.getPoint(getShape2Index(step))\n          : shape1.getPoint(step % shape1NailCount)\n      );\n      yield;\n\n      if (step !== steps - 1) {\n        renderer.lineTo(\n          toShape2\n            ? shape2.getPoint(getShape2Index(step + 1))\n            : shape1.getPoint((step + 1) % shape1NailCount)\n        );\n        yield;\n\n        toShape2 = !toShape2;\n      }\n    }\n  }\n\n  getStepCount(options: CalcOptions): number {\n    if (!this.calc) {\n      this.calc = this.getCalc(options);\n    }\n\n    return this.#getConnectionCount() * 2 - 1;\n  }\n\n  getNailCount(size: Dimensions): number {\n    const calc = this.getCalc({\n      size,\n    });\n    return calc.shape1NailCount + calc.shape2NailCount;\n  }\n\n  drawNails(nails: INails) {\n    this.calc.shape1.drawNails(nails);\n    this.calc.shape2.drawNails(nails, {\n      getUniqueKey: k => k + this.config.shape1NailCount,\n    });\n  }\n\n  thumbnailConfig = (\n    config: DanceOfPlanetsConfig\n  ): Partial<DanceOfPlanetsConfig> => {\n    const MAX_NAIL_COUNT = 80;\n    // the nail count of either shape shouldn't exceed the MAX_NAIL_COUNT,\n    // but the ratio between the two counts needs to be preserved, so the pattern in the thumbnail looks similar\n\n    let shape1NailCount = this.#getShapeNailCount(\n      config.shape1Type,\n      config.shape1NailCount,\n      config.shape1Sides\n    );\n\n    let shape2NailCount = config.identicalNailCount\n      ? shape1NailCount\n      : config.shape2NailCount;\n\n    if (\n      shape1NailCount <= MAX_NAIL_COUNT &&\n      shape2NailCount <= MAX_NAIL_COUNT\n    ) {\n      return {};\n    }\n\n    const ratio = shape1NailCount / shape2NailCount;\n\n    if (ratio >= 1) {\n      // shape1 has a larger or equal nail count than shape2\n      shape1NailCount = MAX_NAIL_COUNT;\n      shape2NailCount = MAX_NAIL_COUNT / ratio;\n    } else {\n      shape2NailCount = MAX_NAIL_COUNT;\n      shape1NailCount = MAX_NAIL_COUNT * ratio;\n    }\n\n    return { shape1NailCount, shape2NailCount };\n  };\n}\n","import StringArt from '../infra/StringArt';\nimport Color from '../helpers/color/Color';\nimport { ColorConfig, ColorValue } from '../helpers/color/color.types';\nimport Renderer from '../infra/renderers/Renderer';\nimport { ControlsConfig, GroupValue } from '../types/config.types';\nimport { CalcOptions } from '../types/stringart.types';\nimport {\n  capitalize,\n  formatFractionAsAngle,\n  formatFractionAsPercent,\n} from '../helpers/string_utils';\nimport { Line, LineConfig } from '../shapes/Line';\nimport { Coordinates } from '../types/general.types';\nimport { getShapesBoundingRect } from '../helpers/shape_utils';\nimport { createArray } from '../helpers/array_utils';\nimport { PI2 } from '../helpers/math_utils';\nimport { getCenter } from '../helpers/size_utils';\nimport INails from '../infra/nails/INails';\n\ntype CrossesOrientation = 'v' | 'h';\n\ninterface CrossesConfig extends ColorConfig {\n  n: number;\n  orientation: CrossesOrientation;\n  lengthGap: number;\n  lockGap: boolean;\n  widthGap?: number;\n  fineControl: boolean;\n  center: GroupValue;\n  centerWidthGap?: number;\n  centerSpread?: number;\n  centerLengthSpread: number;\n  centerLengthGap: number;\n  symmetricCenter: boolean;\n  centerStartSpread: number;\n  centerEndSpread: number;\n  centerStartGap: number;\n  centerEndGap: number;\n  setCenterColor: boolean;\n  centerColor: ColorValue;\n  edges: GroupValue;\n  edgesGap: number;\n  edgesSpread: number;\n  edgesWidthGap: number;\n  edgesWidthSpread: number;\n  sidesRotation: number;\n}\n\ntype TCalc = {\n  verticalLines: Line[];\n  horizontalLines: Line[][];\n  width: number;\n  height: number;\n};\n\nfunction getOtherOrientationLabel(\n  orientation: CrossesOrientation\n): 'horizontal' | 'vertical' {\n  return orientation === 'h' ? 'vertical' : 'horizontal';\n}\n\nfunction getOrientationLabel(\n  orientation: CrossesOrientation\n): 'horizontal' | 'vertical' {\n  return orientation === 'h' ? 'horizontal' : 'vertical';\n}\n\nexport default class Crosses extends StringArt<CrossesConfig, TCalc> {\n  static type = 'crosses';\n\n  name = 'Crosses';\n  id = 'crosses';\n  controls: ControlsConfig<CrossesConfig> = [\n    {\n      type: 'range',\n      key: 'n',\n      label: 'Nails per side',\n      attr: {\n        min: 2,\n        max: 100,\n        step: 1,\n      },\n      defaultValue: 25,\n      isStructural: true,\n    },\n    {\n      key: 'orientation',\n      type: 'select',\n      label: 'Orientation',\n      defaultValue: 'v',\n      options: [\n        { value: 'v', label: ' Vertical' },\n        { value: 'h', label: ' Horizontal' },\n      ],\n      affectsStepCount: false,\n      isStructural: true,\n    },\n    {\n      key: 'sidesRotation',\n      type: 'range',\n      label: 'Sides rotation',\n      attr: {\n        min: -0.25,\n        max: 0.25,\n        step: 0.005,\n        snap: '0',\n      },\n      displayValue: ({ sidesRotation }) => formatFractionAsAngle(sidesRotation),\n      defaultValue: 0,\n      affectsStepCount: false,\n      isStructural: true,\n    },\n    {\n      key: 'fineControl',\n      type: 'checkbox',\n      label: 'Fine control',\n      defaultValue: false,\n      affectsStepCount: false,\n      isStructural: true,\n    },\n    {\n      key: 'lockGap',\n      type: 'checkbox',\n      label: 'Lock horizontal/vertical gap',\n      defaultValue: true,\n      isStructural: true,\n      affectsStepCount: false,\n      show: ({ fineControl }) => !fineControl,\n    },\n    {\n      key: 'lengthGap',\n      type: 'range',\n      label: ({ orientation, lockGap }) =>\n        lockGap ? 'Gap' : `${capitalize(getOrientationLabel(orientation))} gap`,\n      attr: {\n        min: 0,\n        max: 1,\n        step: 0.01,\n      },\n      displayValue: ({ lengthGap }) => formatFractionAsPercent(lengthGap),\n      defaultValue: 0.27,\n      affectsStepCount: false,\n      isStructural: true,\n      show: ({ fineControl }) => !fineControl,\n    },\n    {\n      key: 'widthGap',\n      type: 'range',\n      label: ({ orientation }) =>\n        `${capitalize(getOtherOrientationLabel(orientation))} gap`,\n      attr: {\n        min: 0,\n        max: 5,\n        step: 0.01,\n      },\n      displayValue: ({ widthGap }) => formatFractionAsPercent(widthGap),\n      defaultValue: 0.43,\n      affectsStepCount: false,\n      isStructural: true,\n      show: ({ lockGap, fineControl }) => !fineControl && !lockGap,\n    },\n    {\n      key: 'center',\n      type: 'group',\n      label: 'Center ',\n      show: ({ fineControl }) => fineControl,\n      children: [\n        {\n          key: 'centerLengthSpread',\n          type: 'range',\n          label: ({ orientation }) =>\n            `Center ${getOrientationLabel(orientation)} spread`,\n          attr: {\n            min: 0.2,\n            max: 5,\n            step: 0.01,\n            snap: '1',\n          },\n          displayValue: ({ centerLengthSpread }) =>\n            formatFractionAsPercent(centerLengthSpread),\n          defaultValue: 1,\n          affectsStepCount: false,\n          isStructural: true,\n        },\n        {\n          key: 'centerLengthGap',\n          type: 'range',\n          label: ({ orientation }) =>\n            `Center ${getOrientationLabel(orientation)} gap`,\n          attr: {\n            min: 0,\n            max: 5,\n            step: 0.01,\n          },\n          displayValue: ({ centerLengthGap }) =>\n            formatFractionAsPercent(centerLengthGap),\n          defaultValue: 0,\n          affectsStepCount: false,\n          isStructural: true,\n        },\n        {\n          key: 'symmetricCenter',\n          type: 'checkbox',\n          label: ({ orientation }) =>\n            `Symmetric ${getOtherOrientationLabel(orientation)} center`,\n          defaultValue: true,\n          affectsStepCount: false,\n          isStructural: true,\n        },\n        {\n          key: 'centerSpread',\n          type: 'range',\n          label: ({ orientation }) =>\n            `Center ${getOtherOrientationLabel(orientation)} spread`,\n          attr: {\n            min: 0.2,\n            max: 5,\n            step: 0.01,\n            snap: '1',\n          },\n          displayValue: ({ centerSpread }) =>\n            formatFractionAsPercent(centerSpread),\n          defaultValue: 1,\n          affectsStepCount: false,\n          isStructural: true,\n          show: ({ symmetricCenter }) => symmetricCenter,\n        },\n        {\n          key: 'centerWidthGap',\n          type: 'range',\n          label: ({ orientation }) =>\n            `Center ${getOtherOrientationLabel(orientation)} gap`,\n          attr: {\n            min: 0,\n            max: 5,\n            step: 0.01,\n          },\n          displayValue: ({ centerWidthGap }) =>\n            formatFractionAsPercent(centerWidthGap),\n          defaultValue: 0,\n          affectsStepCount: false,\n          isStructural: true,\n          show: ({ symmetricCenter }) => symmetricCenter,\n        },\n        {\n          key: 'centerStartSpread',\n          type: 'range',\n          label: ({ orientation }) =>\n            `Center ${orientation === 'v' ? 'left' : 'up'} spread`,\n          attr: {\n            min: 0.2,\n            max: 5,\n            step: 0.01,\n            snap: '1',\n          },\n          displayValue: ({ centerStartSpread }) =>\n            formatFractionAsPercent(centerStartSpread),\n          defaultValue: 1,\n          affectsStepCount: false,\n          isStructural: true,\n          show: ({ symmetricCenter }) => !symmetricCenter,\n        },\n        {\n          key: 'centerStartGap',\n          type: 'range',\n          label: ({ orientation }) =>\n            `Center ${orientation === 'v' ? 'left' : 'up'} gap`,\n          attr: {\n            min: 0,\n            max: 5,\n            step: 0.01,\n          },\n          displayValue: ({ centerStartGap }) =>\n            formatFractionAsPercent(centerStartGap),\n          defaultValue: 0,\n          affectsStepCount: false,\n          isStructural: true,\n          show: ({ symmetricCenter }) => !symmetricCenter,\n        },\n        {\n          key: 'centerEndSpread',\n          type: 'range',\n          label: ({ orientation }) =>\n            `Center ${orientation === 'v' ? 'right' : 'down'} spread`,\n          attr: {\n            min: 0.2,\n            max: 5,\n            step: 0.01,\n            snap: '1',\n          },\n          displayValue: ({ centerEndSpread }) =>\n            formatFractionAsPercent(centerEndSpread),\n          defaultValue: 1,\n          affectsStepCount: false,\n          isStructural: true,\n          show: ({ symmetricCenter }) => !symmetricCenter,\n        },\n        {\n          key: 'centerEndGap',\n          type: 'range',\n          label: ({ orientation }) =>\n            `Center ${orientation === 'v' ? 'right' : 'down'} gap`,\n          attr: {\n            min: 0,\n            max: 5,\n            step: 0.01,\n          },\n          displayValue: ({ centerEndGap }) =>\n            formatFractionAsPercent(centerEndGap),\n          defaultValue: 0,\n          affectsStepCount: false,\n          isStructural: true,\n          show: ({ symmetricCenter }) => !symmetricCenter,\n        },\n      ],\n    },\n    {\n      key: 'edges',\n      label: 'Edges  ',\n      type: 'group',\n      show: ({ fineControl }) => fineControl,\n      children: [\n        {\n          key: 'edgesSpread',\n          type: 'range',\n          label: ({ orientation }) =>\n            `Edges ${getOrientationLabel(orientation)} spread`,\n          attr: {\n            min: 0.2,\n            max: 5,\n            step: 0.01,\n            snap: '1',\n          },\n          displayValue: ({ edgesSpread }) =>\n            formatFractionAsPercent(edgesSpread),\n          defaultValue: 1,\n          affectsStepCount: false,\n          isStructural: true,\n        },\n        {\n          key: 'edgesGap',\n          type: 'range',\n          label: ({ orientation }) =>\n            `Edges ${getOrientationLabel(orientation)} gap`,\n          attr: {\n            min: 0,\n            max: 1,\n            step: 0.01,\n            snap: '1',\n          },\n          displayValue: ({ edgesGap }) => formatFractionAsPercent(edgesGap),\n          defaultValue: 0,\n          affectsStepCount: false,\n          isStructural: true,\n        },\n        {\n          key: 'edgesWidthSpread',\n          type: 'range',\n          label: ({ orientation }) =>\n            `Edges ${getOtherOrientationLabel(orientation)} spread`,\n          attr: {\n            min: 0.2,\n            max: 5,\n            step: 0.01,\n            snap: '1',\n          },\n          displayValue: ({ edgesWidthSpread }) =>\n            formatFractionAsPercent(edgesWidthSpread),\n          defaultValue: 1,\n          affectsStepCount: false,\n          isStructural: true,\n        },\n        {\n          key: 'edgesWidthGap',\n          type: 'range',\n          label: ({ orientation }) =>\n            `Edges ${getOtherOrientationLabel(orientation)} gap`,\n          attr: {\n            min: 0,\n            max: 1,\n            step: 0.01,\n            snap: '1',\n          },\n          displayValue: ({ edgesWidthGap }) =>\n            formatFractionAsPercent(edgesWidthGap),\n          defaultValue: 0,\n          affectsStepCount: false,\n          isStructural: true,\n        },\n      ],\n    },\n    Color.getConfig({\n      defaults: {\n        isMultiColor: true,\n        colorCount: 2,\n        color: '#ffffff',\n        multicolorRange: 1,\n        multicolorStart: 1,\n        multicolorByLightness: true,\n        minLightness: 40,\n        maxLightness: 100,\n        reverseColors: true,\n      },\n      customControls: [\n        {\n          key: 'setCenterColor',\n          label: 'Manually set center color',\n          defaultValue: false,\n          type: 'checkbox',\n          affectsNails: false,\n          affectsStepCount: false,\n        },\n        {\n          key: 'centerColor',\n          type: 'color',\n          label: 'Center color',\n          defaultValue: '#ffd500',\n          show: ({ setCenterColor }) => setCenterColor,\n          affectsNails: false,\n          affectsStepCount: false,\n        },\n      ],\n      exclude: ['repeatColors'],\n      maxColorCount: 2,\n    }),\n  ];\n\n  color: Color;\n\n  getCalc({ size }: CalcOptions): TCalc {\n    const {\n      n,\n      orientation,\n      margin,\n      lengthGap: verticalGapPercent,\n      widthGap,\n      lockGap,\n      fineControl,\n      centerWidthGap,\n      centerSpread,\n      symmetricCenter,\n      centerLengthGap: centerLengthGapPercent,\n      centerLengthSpread: centerLengthSpreadPercent,\n      centerStartGap,\n      centerStartSpread,\n      centerEndGap,\n      centerEndSpread,\n      edgesGap,\n      edgesSpread,\n      edgesWidthGap,\n      edgesWidthSpread,\n      sidesRotation,\n    } = this.config;\n    const center = getCenter(size);\n\n    const isVertical = orientation === 'v';\n    let height = (isVertical ? size[1] : size[0]) - 2 * margin;\n    const maxVerticalGap = (height * 0.8) / 3;\n    let centerLengthGap =\n      (fineControl ? centerLengthGapPercent : verticalGapPercent) *\n      maxVerticalGap;\n    let sideLengthGap = fineControl\n      ? ((height * 0.8 - verticalGapPercent * maxVerticalGap) * edgesGap) / 2\n      : verticalGapPercent * maxVerticalGap;\n    const centerLengthSpread = fineControl ? centerLengthSpreadPercent : 1;\n    // lineLength is for the two center vertical lines\n    let lineLength =\n      (height - (centerLengthGap + 2 * sideLengthGap)) /\n      (2 * (fineControl ? centerLengthSpread : 1) +\n        2 * (fineControl ? edgesSpread : 1));\n\n    let widthShift = 0;\n\n    // sideLineLength are the two vertical lines at the edges - top and bottom\n    let sideLineLength = fineControl ? lineLength * edgesSpread : lineLength;\n\n    const orientationDimensionIndex = isVertical ? 0 : 1;\n\n    function getBoundingRect(): {\n      lengthStart: number;\n      edgesWidthStart: number;\n      edgesWidthEnd: number;\n      width: number;\n      centerStart: number;\n      centerEnd: number;\n      widthStart: number;\n      widthEnd: number;\n      height: number;\n      heightStart: number;\n    } {\n      const getSides = (\n        widthGap: number,\n        sideLength: number,\n        overrides?: Partial<{\n          gap1: number;\n          gap2: number;\n          length1: number;\n          length2: number;\n        }>\n      ): [number, number] => {\n        return [\n          center[orientationDimensionIndex] -\n            (overrides?.gap1 ?? widthGap) * lineLength -\n            (overrides?.length1 ?? sideLength) +\n            widthShift,\n          center[orientationDimensionIndex] +\n            (overrides?.gap2 ?? widthGap) * lineLength +\n            (overrides?.length2 ?? sideLength) +\n            widthShift,\n        ];\n      };\n      const edges = fineControl\n        ? null\n        : getSides(lockGap ? verticalGapPercent : widthGap, lineLength);\n\n      const [centerStart, centerEnd] = fineControl\n        ? getSides(\n            centerWidthGap,\n            centerSpread * lineLength,\n            symmetricCenter\n              ? undefined\n              : {\n                  gap1: centerStartGap,\n                  gap2: centerEndGap,\n                  length1: centerStartSpread * lineLength,\n                  length2: centerEndSpread * lineLength,\n                }\n          )\n        : edges;\n\n      const [edgesWidthStart, edgesWidthEnd] = fineControl\n        ? getSides(edgesWidthGap, edgesWidthSpread * lineLength)\n        : edges;\n\n      const [rotatedEdgesWidthStart, rotatedEdgesWidthEnd] = getSides(\n        edgesWidthGap,\n        Math.cos(sidesRotation * PI2) *\n          (fineControl ? edgesWidthSpread : 1) *\n          lineLength\n      );\n\n      const length =\n        2 * (sideLineLength + lineLength * centerLengthSpread + sideLengthGap) +\n        centerLengthGap;\n\n      const lengthStart = center[isVertical ? 1 : 0] - length / 2;\n\n      const distanceToFirstEdge =\n        centerLengthGap / 2 +\n        lineLength * centerLengthSpread +\n        sideLengthGap / 2 +\n        Math.sin(sidesRotation * PI2) * lineLength * edgesWidthSpread;\n\n      const [rotatedEdgesLegthStart, rotatedEdgesLengthEnd] = [\n        center[isVertical ? 1 : 0] - distanceToFirstEdge,\n        center[isVertical ? 1 : 0] + distanceToFirstEdge,\n      ];\n\n      const widthStart = Math.min(rotatedEdgesWidthStart, centerStart);\n      const widthEnd = Math.max(rotatedEdgesWidthEnd, centerEnd);\n\n      const heightStart = Math.min(lengthStart, rotatedEdgesLegthStart);\n      const heightEnd = Math.max(lengthStart + length, rotatedEdgesLengthEnd);\n\n      return {\n        lengthStart,\n        edgesWidthStart,\n        edgesWidthEnd,\n        centerStart,\n        centerEnd,\n        width: widthEnd - widthStart,\n        widthStart,\n        widthEnd,\n        heightStart,\n        height: heightEnd - heightStart,\n      };\n    }\n\n    let boundingRect = getBoundingRect();\n\n    const sizeWithoutMargins = size.map(v => v - 2 * margin);\n    const sizeWidth = sizeWithoutMargins[orientationDimensionIndex];\n    const sizeHeight = sizeWithoutMargins[isVertical ? 1 : 0];\n\n    const sizeRatio = Math.min(\n      sizeWidth / boundingRect.width,\n      sizeHeight / boundingRect.height\n    );\n\n    const centeredWidthStart =\n      center[orientationDimensionIndex] - boundingRect.width / 2;\n    let shouldRefreshBoundingRect = false;\n    const newWidthShift =\n      Math.trunc(centeredWidthStart) - Math.trunc(boundingRect.widthStart);\n    if (newWidthShift !== widthShift) {\n      widthShift = newWidthShift;\n      shouldRefreshBoundingRect = true;\n    }\n\n    if (sizeRatio < 1) {\n      height *= sizeRatio;\n      centerLengthGap *= sizeRatio;\n      lineLength *= sizeRatio;\n      widthShift *= sizeRatio;\n      sideLineLength *= sizeRatio;\n      shouldRefreshBoundingRect = true;\n      sideLengthGap *= sizeRatio;\n    }\n\n    if (shouldRefreshBoundingRect) {\n      boundingRect = getBoundingRect();\n    }\n\n    const { lengthStart, width } = boundingRect;\n\n    function getVerticalPosition(index: number): {\n      horizontal: number;\n      vertical: number;\n      length: number;\n    } {\n      let lineStart = lengthStart;\n      if (index === 0) {\n        return { vertical: lineStart, horizontal: -1, length: sideLineLength };\n      }\n\n      lineStart += sideLengthGap + sideLineLength;\n      if (index === 1) {\n        return {\n          vertical: lineStart,\n          horizontal: lineStart - sideLengthGap / 2,\n          length: lineLength * centerLengthSpread,\n        };\n      }\n\n      lineStart += lineLength * centerLengthSpread + centerLengthGap;\n      if (index === 2) {\n        return {\n          vertical: lineStart,\n          horizontal: lineStart - centerLengthGap / 2,\n          length: lineLength * centerLengthSpread,\n        };\n      }\n\n      lineStart += lineLength * centerLengthSpread + sideLengthGap;\n      return {\n        vertical: lineStart,\n        horizontal: lineStart - sideLengthGap / 2,\n        length: sideLineLength,\n      };\n    }\n\n    const verticalPositions = createArray(4, getVerticalPosition);\n    const verticalCenter = (isVertical ? center[0] : center[1]) + widthShift;\n\n    function getVerticalLine(index: number): Line {\n      const { vertical, length } = verticalPositions[index];\n\n      const from: Coordinates = [verticalCenter, vertical];\n      const to: Coordinates = [verticalCenter, vertical + length];\n\n      if (!isVertical) {\n        from.reverse();\n        to.reverse();\n      }\n\n      return new Line({ from, to, n });\n    }\n\n    const verticalLines = createArray(4, getVerticalLine);\n\n    const getRowLineRotationConfig = (\n      row: number,\n      index: 0 | 1\n    ): Partial<LineConfig> | null => {\n      if (!sidesRotation || row === 1) {\n        return null;\n      }\n\n      let rotation = sidesRotation;\n      if (!isVertical) {\n        rotation *= -1;\n      }\n\n      if ((index === 1 && row === 0) || (index === 0 && row === 2)) {\n        rotation *= -1;\n      }\n      return {\n        rotation,\n        rotationCenter: 'to',\n      };\n    };\n\n    function getHorizontalLineLength(row: number, index: number): number {\n      if (!fineControl) {\n        return lineLength;\n      }\n\n      if (row === 1) {\n        if (symmetricCenter) {\n          return lineLength * centerSpread;\n        }\n\n        return lineLength * (index === 0 ? centerStartSpread : centerEndSpread);\n      }\n\n      return lineLength * edgesWidthSpread;\n    }\n\n    const horizontalLines = createArray(3, row => {\n      const horizontalStart =\n        row === 1 ? boundingRect.centerStart : boundingRect.edgesWidthStart;\n      const horizontalEnd =\n        row === 1 ? boundingRect.centerEnd : boundingRect.edgesWidthEnd;\n\n      const rowTop = verticalPositions[row + 1].horizontal;\n\n      // In case of fine control and non-symmetric center, the center width lines (potentially) have different sizes\n      const startLength = getHorizontalLineLength(row, 0);\n      const endLength = getHorizontalLineLength(row, 1);\n\n      return [\n        new Line({\n          ...getRowLineRotationConfig(row, 0),\n          ...(isVertical\n            ? {\n                from: [horizontalStart, rowTop],\n                to: [horizontalStart + startLength, rowTop],\n                n,\n              }\n            : {\n                from: [rowTop, horizontalStart],\n                to: [rowTop, horizontalStart + startLength],\n                n,\n              }),\n        }),\n        new Line({\n          ...getRowLineRotationConfig(row, 1),\n          ...(isVertical\n            ? {\n                from: [horizontalEnd, rowTop],\n                to: [horizontalEnd - endLength, rowTop],\n                n,\n              }\n            : {\n                from: [rowTop, horizontalEnd],\n                to: [rowTop, horizontalEnd - endLength],\n                n,\n              }),\n        }),\n      ];\n    });\n    return {\n      verticalLines,\n      horizontalLines,\n      width,\n      height,\n    };\n  }\n\n  setUpDraw(options: CalcOptions) {\n    super.setUpDraw(options);\n\n    this.color = new Color(this.config);\n  }\n\n  getAspectRatio(): number {\n    const { verticalLines, horizontalLines } =\n      this.calc ?? this.getCalc({ size: [100, 100] });\n    const boundingRect = getShapesBoundingRect(\n      ...verticalLines.concat(horizontalLines.flat())\n    );\n    return boundingRect.width / boundingRect.height;\n  }\n\n  private *connectLines(\n    renderer: Renderer,\n    {\n      verticalLine,\n      row,\n      isReverse = false,\n      color,\n    }: {\n      verticalLine: Line;\n      row: number;\n      isReverse?: boolean;\n      color: ColorValue;\n    }\n  ): Generator<void> {\n    const { n } = this.config;\n    const horizontalLines = this.calc.horizontalLines[row];\n\n    renderer.setColor(color);\n    renderer.setStartingPoint(horizontalLines[0].getPoint(0));\n\n    let alternate = false;\n    let currentLine: Line;\n\n    for (let i = 0; i < n; i++) {\n      if (currentLine) {\n        renderer.lineTo(currentLine.getPoint(i));\n        yield;\n      }\n      renderer.lineTo(verticalLine.getPoint(isReverse ? i : n - 1 - i));\n      yield;\n\n      currentLine = horizontalLines[alternate ? 0 : 1];\n      renderer.lineTo(currentLine.getPoint(i));\n      yield;\n\n      alternate = !alternate;\n    }\n  }\n\n  *drawStrings(renderer: Renderer) {\n    const { verticalLines } = this.calc;\n    const { setCenterColor, centerColor, isMultiColor } = this.config;\n\n    const connections = [\n      [0, 0],\n      [0, 1],\n      [1, 0],\n      [1, 1],\n      [3, 2],\n      [3, 1],\n      [2, 1],\n      [2, 2],\n      [1, 2],\n      [2, 0],\n    ];\n\n    for (const [verticalIndex, horizontalRow] of connections) {\n      const isReverse = horizontalRow < verticalIndex;\n      let color: ColorValue;\n      if (setCenterColor) {\n        const isCenter =\n          (verticalIndex === 1 || verticalIndex === 2) && horizontalRow === 1;\n        if (isCenter) {\n          color = centerColor;\n        }\n      }\n      if (!color) {\n        color = this.color.getColor(\n          horizontalRow > verticalIndex || verticalIndex - horizontalRow > 1\n            ? 1\n            : 0\n        );\n      }\n\n      yield* this.connectLines(renderer, {\n        verticalLine: verticalLines[verticalIndex],\n        row: horizontalRow,\n        isReverse,\n        color,\n      });\n    }\n  }\n\n  getStepCount(): number {\n    const { n } = this.config;\n    return 10 * (3 * n - 1);\n  }\n\n  getNailCount(): number {\n    return this.config.n * 10;\n  }\n\n  drawNails(nails: INails) {\n    this.calc.verticalLines.forEach((line, i) =>\n      line.drawNails(nails, { getUniqueKey: k => 1e3 * (i + i) + k })\n    );\n\n    this.calc.horizontalLines.forEach(([startLine, endLine], row) => {\n      startLine.drawNails(nails, { getUniqueKey: k => (row + 1) * 1e4 + k });\n      endLine.drawNails(nails, { getUniqueKey: k => (row + 1) * 1e5 + k });\n    });\n  }\n\n  thumbnailConfig = (config: CrossesConfig) => ({\n    n: Math.min(10, config.n),\n  });\n}\n","import { PI2 } from '../helpers/math_utils';\nimport { mapDimensions } from '../helpers/size_utils';\nimport INails from '../infra/nails/INails';\nimport { BoundingRect, Coordinates } from '../types/general.types';\nimport type Shape from './Shape';\nimport { ShapeNailsOptions } from './Shape';\n\ntype LinePosition = 'center' | 'from' | 'to';\n\nexport interface LineConfig {\n  from: Coordinates;\n  to: Coordinates;\n  n: number;\n  rotation?: number;\n  rotationCenter?: Coordinates | LinePosition;\n}\n\nexport class Line implements Shape {\n  config: LineConfig;\n  from: Coordinates;\n  to: Coordinates;\n  /**\n   * distance between from and to, [x,y]\n   */\n  distance: [number, number];\n  spaces: number;\n\n  constructor(config: LineConfig) {\n    if (config.n < 1) {\n      throw new Error(`Can't create a Line with n less than 1.`);\n    }\n\n    this.config = config;\n\n    const { rotation, from, to, n } = config;\n\n    if (rotation) {\n      const rotationAngle = -PI2 * rotation;\n      const rotationCenter = this.#getRotationCenterCoordinates();\n\n      this.from = this.#rotatePoint(from, rotationCenter, rotationAngle);\n      this.to = this.#rotatePoint(to, rotationCenter, rotationAngle);\n    } else {\n      this.from = config.from;\n      this.to = config.to;\n    }\n\n    this.distance = [this.to[0] - this.from[0], this.to[1] - this.from[1]];\n    this.spaces = n - 1;\n  }\n\n  #getRotationCenterCoordinates(): Coordinates {\n    const { from, to, rotationCenter } = this.config;\n    if (!rotationCenter || rotationCenter === 'center') {\n      return [from[0] + (to[0] - from[0]) / 2, from[1] + (to[1] - from[1]) / 2];\n    } else {\n      switch (rotationCenter) {\n        case 'from':\n          return from;\n        case 'to':\n          return to;\n        default:\n          return rotationCenter;\n      }\n    }\n  }\n\n  #rotatePoint(\n    point: Coordinates,\n    rotationCenter: Coordinates,\n    rotationAngle: number\n  ): Coordinates {\n    const xDist = point[0] - rotationCenter[0];\n    const yDist = point[1] - rotationCenter[1];\n\n    const pointDistanceToCenter = Math.hypot(xDist, yDist);\n\n    if (!pointDistanceToCenter) {\n      return point;\n    }\n\n    const startingAngle =\n      Math.asin(xDist / pointDistanceToCenter) + (yDist < 0 ? Math.PI : 0);\n\n    return [\n      rotationCenter[0] +\n        Math.sin(startingAngle + rotationAngle) * pointDistanceToCenter,\n      rotationCenter[1] +\n        Math.cos(startingAngle + rotationAngle) * pointDistanceToCenter,\n    ];\n  }\n\n  getPoint(index: number): Coordinates {\n    const { from } = this;\n\n    return mapDimensions(\n      from,\n      (v, i) => v + (this.distance[i] * index) / this.spaces\n    );\n  }\n\n  drawNails(nails: INails, { getUniqueKey }: ShapeNailsOptions = {}): void {\n    for (let i = 0; i < this.config.n; i++) {\n      nails.addNail(getUniqueKey?.(i) ?? i, this.getPoint(i));\n    }\n  }\n\n  getBoundingRect(): BoundingRect {\n    const { from, to } = this;\n\n    return {\n      width: Math.abs(this.distance[0]),\n      height: Math.abs(this.distance[1]),\n      top: Math.min(to[1], from[1]),\n      bottom: Math.max(to[1], from[1]),\n      left: Math.min(from[0], to[0]),\n      right: Math.max(from[0], to[0]),\n    };\n  }\n\n  getAspectRatio(): number {\n    const { width, height } = this.getBoundingRect();\n    return width / height;\n  }\n}\n","import type Shape from '../shapes/Shape';\nimport { BoundingRect } from '../types/general.types';\n\n/**\n * Returns the bounding rect for all the shapes together\n * @param shapes\n * @returns\n */\nexport function getShapesBoundingRect(...shapes: Shape[]): BoundingRect {\n  if (!shapes.length) {\n    return {\n      top: 0,\n      bottom: 0,\n      left: 0,\n      right: 0,\n      width: 0,\n      height: 0,\n    };\n  }\n\n  const firstShapeRect = shapes[0].getBoundingRect();\n\n  if (shapes.length === 1) {\n    return firstShapeRect;\n  }\n\n  const rect = shapes.slice(1).reduce((rect: BoundingRect, shape: Shape) => {\n    const shapeBoundingRect = shape.getBoundingRect();\n\n    return {\n      top: Math.min(rect.top, shapeBoundingRect.top),\n      bottom: Math.max(rect.bottom, shapeBoundingRect.bottom),\n      left: Math.min(rect.left, shapeBoundingRect.left),\n      right: Math.max(rect.right, shapeBoundingRect.right),\n      width: 0,\n      height: 0,\n    };\n  }, firstShapeRect);\n\n  Object.assign(rect, {\n    width: rect.right - rect.left,\n    height: rect.bottom - rect.top,\n  });\n\n  return rect;\n}\n","import { getPatternURL } from './helpers/url_utils';\nimport type Renderer from './infra/renderers/Renderer';\nimport SVGRenderer from './infra/renderers/SVGRenderer';\nimport type StringArt from './infra/StringArt';\n\nexport interface ShareInput {\n  renderer: Renderer;\n  pattern: StringArt<any>;\n}\n\nexport async function share(input: ShareInput) {\n  try {\n    navigator.share(await getShareData(input));\n  } catch (error) {\n    alert('Error: ' + error.message);\n  }\n}\n\nexport async function isShareSupported() {\n  if (!navigator.share) {\n    return false;\n  }\n\n  const canvas = document.createElement('canvas');\n  canvas.width = 1;\n  canvas.height = 1;\n\n  const ctx = canvas.getContext('2d');\n  ctx.fillStyle = 'black';\n  ctx.fillRect(0, 0, 1, 1);\n\n  const dataURL = canvas.toDataURL();\n\n  const shareData = await dataURLToShareData(dataURL, 'test', 'test.jpg');\n  return navigator.canShare(shareData);\n}\n\nasync function dataURLToShareData(\n  dataURL: string,\n  text: string,\n  filename: string,\n  url?: string\n): Promise<ShareData> {\n  const blob = await (await fetch(dataURL)).blob();\n  const files = [\n    new File([blob], filename, {\n      type: blob.type,\n      lastModified: new Date().getTime(),\n    }),\n  ];\n  return {\n    url: url ?? window.location.href,\n    files,\n    title: document.title,\n    text,\n  };\n}\n\nasync function getShareData({\n  renderer,\n  pattern,\n}: ShareInput): Promise<ShareData> {\n  const dataUrl = renderer.toDataURL();\n  return dataURLToShareData(\n    dataUrl,\n    'String Art Studio - ' + pattern.name,\n    pattern.name + '.jpg',\n    getPatternURL(pattern, {\n      renderer: renderer instanceof SVGRenderer ? 'svg' : 'canvas',\n      patternAsTemplate: true,\n    })\n  );\n}\n","import Renderer from './Renderer';\nimport type { Coordinates, Dimensions } from '../../types/general.types';\nimport { ColorValue } from '../../helpers/color/color.types';\nimport { Nail, NailsRenderOptions } from '../../types/stringart.types';\nimport { areDimensionsEqual } from '../../helpers/size_utils';\n\nconst SVG_NS = 'http://www.w3.org/2000/svg';\n\nexport default class SVGRenderer extends Renderer {\n  svg: SVGElement;\n  backgroundGroup: SVGGElement;\n  background: SVGRectElement = null;\n  linesGroup: SVGGElement;\n  nailsGroup: SVGGElement;\n  nailsCirclesGroup: SVGGElement;\n  nailsTextGroup: SVGGElement;\n  currentColor: ColorValue | null = null;\n  lineWidth: number | string = 1;\n  currentLineGroup: SVGGElement = null;\n\n  constructor(parentElement: HTMLElement) {\n    super(parentElement);\n\n    this.svg = document.createElementNS(SVG_NS, 'svg');\n    this.svg.style.setProperty('display', 'block');\n    this.backgroundGroup = document.createElementNS(SVG_NS, 'g');\n    this.backgroundGroup.setAttribute('data-id', 'background');\n    this.linesGroup = document.createElementNS(SVG_NS, 'g');\n    this.linesGroup.setAttribute('data-id', 'lines');\n    this.nailsGroup = document.createElementNS(SVG_NS, 'g');\n    this.nailsGroup.setAttribute('data-id', 'nails');\n\n    this.nailsCirclesGroup = document.createElementNS(SVG_NS, 'g');\n    this.nailsCirclesGroup.setAttribute('data-id', 'nailsCircles');\n\n    this.nailsTextGroup = document.createElementNS(SVG_NS, 'g');\n    this.nailsTextGroup.setAttribute('data-id', 'nailsText');\n\n    this.nailsGroup.appendChild(this.nailsCirclesGroup);\n    this.nailsGroup.appendChild(this.nailsTextGroup);\n\n    this.svg.appendChild(this.backgroundGroup);\n    this.svg.appendChild(this.linesGroup);\n    this.svg.appendChild(this.nailsGroup);\n\n    this.svg.setAttribute('xmlns', SVG_NS);\n\n    parentElement.appendChild(this.svg);\n  }\n\n  get element(): SVGElement {\n    return this.svg;\n  }\n\n  resetSize(): Dimensions {\n    super.resetSize();\n\n    this.svg.style.removeProperty('width');\n    this.svg.style.removeProperty('height');\n\n    const newDimensions = this.getSize().map(Math.trunc) as Dimensions;\n    const [width, height] = newDimensions;\n    this.svg.setAttributeNS(SVG_NS, 'viewBox', `0 0 ${width} ${height}`);\n    this.svg.setAttributeNS(SVG_NS, 'width', String(width));\n    this.svg.setAttributeNS(SVG_NS, 'height', String(height));\n    this.svg.style.width = width + 'px';\n    this.svg.style.height = height + 'px';\n\n    if (\n      !this.currentSize ||\n      !areDimensionsEqual(newDimensions, this.currentSize)\n    ) {\n      this.currentSize = newDimensions;\n      this.emit('sizeChange', { size: newDimensions });\n    }\n\n    return newDimensions;\n  }\n\n  resetNails() {\n    this.nailsCirclesGroup.innerHTML = '';\n    this.nailsTextGroup.innerHTML = '';\n  }\n\n  resetStrings() {\n    this.linesGroup.innerHTML = '';\n    this.currentColor = null;\n    this.lineWidth = null;\n  }\n\n  setColor(color: ColorValue) {\n    if (color !== this.currentColor) {\n      this.currentLineGroup = document.createElementNS(SVG_NS, 'g');\n      this.currentLineGroup.setAttribute('stroke', color);\n      this.currentLineGroup.setAttribute(\n        'stroke-width',\n        String(this.lineWidth)\n      );\n      this.linesGroup.appendChild(this.currentLineGroup);\n      this.currentColor = color;\n    }\n  }\n\n  setLineWidth(width?: number) {\n    this.lineWidth = width ?? '1';\n    this.linesGroup.setAttributeNS(SVG_NS, 'stroke-width', String(width ?? 1));\n    this.linesGroup.childNodes.forEach(group => {\n      if (group instanceof SVGGElement) {\n        group.setAttributeNS(SVG_NS, 'stroke-width', String(width ?? 1));\n      }\n    });\n  }\n\n  setBackground(color: ColorValue) {\n    if (color) {\n      if (!this.background) {\n        this.background = document.createElementNS(SVG_NS, 'rect');\n        this.background.setAttribute('width', '100%');\n        this.background.setAttribute('height', '100%');\n        this.backgroundGroup.appendChild(this.background);\n      }\n\n      this.background.setAttribute('fill', color);\n    } else {\n      this.background = null;\n      this.backgroundGroup.innerHTML = '';\n    }\n  }\n\n  getSize(): Dimensions {\n    return [this.svg.clientWidth, this.svg.clientHeight];\n  }\n\n  setSize(size: Dimensions | null) {\n    if (!size) {\n      return this.resetSize();\n    }\n\n    if (this.fixedSize) {\n      console.warn(\n        `Trying to set size for Renderer to [${size.join(\n          ', '\n        )}], but size is fixed to [${this.fixedSize.join(', ')}].`\n      );\n      return this.fixedSize;\n    }\n\n    this.svg.removeAttributeNS(SVG_NS, 'width');\n    this.svg.removeAttributeNS(SVG_NS, 'height');\n\n    this.svg.style.width = `${size[0]}px`;\n    this.svg.style.height = `${size[1]}px`;\n\n    const realSize = size.map(Math.trunc) as Dimensions;\n    const [width, height] = realSize;\n\n    this.svg.setAttributeNS(SVG_NS, 'viewBox', `0 0 ${width} ${height}`);\n    this.svg.setAttributeNS(SVG_NS, 'width', String(width));\n    this.svg.setAttributeNS(SVG_NS, 'height', String(height));\n\n    if (!this.currentSize || !areDimensionsEqual(realSize, this.currentSize)) {\n      this.currentSize = realSize;\n      this.emit('sizeChange', { size: realSize });\n    }\n\n    return realSize;\n  }\n\n  renderLine(from: Coordinates, to: Coordinates): void {\n    this.lastStringCoordinates = from;\n    this.lineTo(to);\n  }\n\n  lineTo(to: Coordinates) {\n    if (!this.lastStringCoordinates) {\n      throw new Error(\"no last string coordinates, can't lineTo\");\n    }\n\n    const line = document.createElementNS(SVG_NS, 'line');\n    line.setAttribute('x1', String(Math.trunc(this.lastStringCoordinates[0])));\n    line.setAttribute('y1', String(Math.trunc(this.lastStringCoordinates[1])));\n    line.setAttribute('x2', String(Math.trunc(to[0])));\n    line.setAttribute('y2', String(Math.trunc(to[1])));\n\n    this.currentLineGroup.appendChild(line);\n\n    this.lastStringCoordinates = to;\n  }\n\n  clearInstructions(): void {\n    // TODO: Implement this\n  }\n\n  renderInstructions(from: Coordinates, to: Coordinates): void {\n    // TODO: Implement this\n  }\n\n  renderInstructionsForLastLine(): void {\n    // TODO: Implement this\n  }\n\n  hideInstructions(): void {\n    // TODO: Implement this\n  }\n\n  showInstructions(): void {\n    // TODO: Implement this\n  }\n\n  renderNails(\n    nails: Iterable<Coordinates>,\n    {\n      color,\n      fontSize,\n      radius,\n      renderNumbers,\n      margin = 0,\n      numbersStart = 1,\n    }: NailsRenderOptions\n  ) {\n    const centerX = this.getSize()[0] / 2;\n    //this.nailsCirclesGroup.innerHTML = this.nailsTextGroup.innerHTML = '';\n    const circlesFragment = document.createDocumentFragment();\n    const textFragment = document.createDocumentFragment();\n\n    const nailNumberOffset = radius + margin;\n\n    this.nailsTextGroup.style.fontSize = String(fontSize);\n    let number = numbersStart;\n\n    for (let [x, y] of nails) {\n      const circle = document.createElementNS(SVG_NS, 'circle');\n      circle.setAttribute('cx', String(x));\n      circle.setAttribute('cy', String(y));\n      circle.setAttribute('r', String(radius));\n      circlesFragment.appendChild(circle);\n\n      if (renderNumbers && number != null) {\n        const isRightAlign = x < centerX;\n\n        const numberPosition = [\n          isRightAlign ? x - nailNumberOffset : x + nailNumberOffset,\n          y,\n        ];\n\n        const textEl = document.createElementNS(SVG_NS, 'text');\n        textEl.innerHTML = String(number);\n        textEl.setAttribute('x', String(numberPosition[0]));\n        textEl.setAttribute('y', String(numberPosition[1]));\n        if (isRightAlign) {\n          textEl.setAttribute('text-anchor', 'end');\n        }\n        textFragment.appendChild(textEl);\n      }\n      number++;\n    }\n\n    this.nailsCirclesGroup.appendChild(circlesFragment);\n    this.nailsTextGroup.appendChild(textFragment);\n\n    if (color != null) {\n      this.nailsCirclesGroup.setAttribute('fill', color);\n      this.nailsTextGroup.setAttribute('fill', color);\n    }\n  }\n\n  clear() {\n    this.linesGroup.innerHTML = '';\n    this.nailsGroup.innerHTML = '';\n  }\n\n  toDataURL() {\n    return '';\n  }\n}\n","const swFilename = 'service-worker.js';\n\nexport async function initServiceWorker() {\n  if (!navigator.serviceWorker || document.location.hostname === '127.0.0.1') {\n    return;\n  }\n\n  try {\n    const registration = await navigator.serviceWorker.register(swFilename);\n    registration.onupdatefound = () => {\n      const installingWorker = registration.installing;\n      if (installingWorker == null) {\n        return;\n      }\n      installingWorker.onstatechange = () => {\n        if (installingWorker.state === 'installed') {\n          if (navigator.serviceWorker.controller) {\n            console.log(\n              'New content is available and will be used when all ' +\n                'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n            );\n          } else {\n            console.log('Content is cached for offline use.');\n          }\n        }\n      };\n    };\n  } catch (error) {\n    console.error('Error during service worker registration:', error);\n  }\n}\n","import './inputs/StringArtRangeInput';\nimport './inputs/StringArtHueInput';\nimport './inputs/DimensionsInput';\nimport './inputs/StringArtCheckbox';\nimport './DropdownMenu';\nimport './DropdownMenuItem';\nimport './dialogs/InputDialog';\nimport './dialogs/ConfirmDialog';\nimport './dialogs/download_dialog/DownloadDialog';\nimport './expandable_panel/ExpandablePanel';\n","import { hide, unHide } from '../../helpers/dom_utils';\nimport { Dimension, Dimensions } from '../../types/general.types';\nimport * as styles from 'bundle-text:./DimensionsInput.css';\n\nconst sheet = new CSSStyleSheet();\nsheet.replaceSync(String(styles));\n\ninterface DimensionProps {\n  element: HTMLInputElement;\n  value: number;\n  max: number | null;\n  defaultValue: number | null;\n}\n\nconst DIMENSIONS: ReadonlyArray<Dimension> = ['width', 'height'];\n\nexport default class DimensionsInput extends HTMLElement {\n  static formAssociated = true;\n  internals: ElementInternals;\n\n  #dimensions: {\n    width: DimensionProps;\n    height: DimensionProps;\n  };\n\n  #inputsElement: HTMLElement;\n  #readonlyElement: HTMLElement;\n\n  #aspectRatio: number | null;\n  #isReadonly = false;\n  floatingPoints: number;\n  #connectorElement: HTMLSpanElement;\n\n  constructor() {\n    super();\n    const shadow = this.attachShadow({ mode: 'open', delegatesFocus: true });\n    shadow.adoptedStyleSheets = [sheet];\n\n    this.shadowRoot.innerHTML = `\n      <span id=\"inputs\">\n        <input\n          type=\"number\"\n          id=\"width\"\n          maxlength=\"3\"\n          min=\"1\"\n          class=\"dialog-input size-input\"\n          name=\"width\"\n        />\n        <span id=\"connector\">&times;</span>\n        <input\n          type=\"number\"\n          id=\"height\"\n          maxlength=\"3\"\n          min=\"1\"\n          class=\"dialog-input size-input\"\n          name=\"height\"\n        />\n      </span>\n      <span id=\"readonly\" hidden></span>\n    `;\n\n    this.#dimensions = {\n      width: {\n        element: shadow.querySelector('#width'),\n        value: 0,\n        max: null,\n        defaultValue: null,\n      },\n      height: {\n        element: shadow.querySelector('#height'),\n        value: 0,\n        max: null,\n        defaultValue: null,\n      },\n    };\n\n    this.#connectorElement = shadow.querySelector('#connector');\n    this.#inputsElement = shadow.querySelector('#inputs');\n    this.#readonlyElement = shadow.querySelector('#readonly');\n\n    this.internals = this.attachInternals();\n  }\n\n  static get observedAttributes() {\n    return [\n      'width',\n      'height',\n      'aspect-ratio',\n      'max-width',\n      'max-height',\n      'readonly',\n      'default-width',\n      'default-height',\n      'floating-points',\n    ];\n  }\n\n  get inputs(): HTMLInputElement[] {\n    return [this.#dimensions.width.element, this.#dimensions.height.element];\n  }\n\n  get width(): number {\n    return this.#dimensions.width.value;\n  }\n\n  set width(value: number) {\n    this.setDimensionValue('width', value, { updateOtherDimensionOnce: true });\n  }\n\n  get height(): number {\n    return this.#dimensions.height.value;\n  }\n\n  set height(value: number) {\n    this.setDimensionValue('height', value, { updateOtherDimensionOnce: true });\n  }\n\n  get value(): Dimensions {\n    return [this.width, this.height];\n  }\n\n  set value(value: string | Dimensions) {\n    if (typeof value === 'string') {\n      const match = value.match(/^(\\d+(?:\\.\\d+)?),\\s?(\\d+(?:\\.\\d+)?)$/);\n      if (match) {\n        this.width = Number(match[1]);\n        this.height = Number(match[2]);\n      }\n    } else {\n      this.width = value[0];\n      this.height = value[1];\n    }\n  }\n\n  get maxWidth(): number | null {\n    return this.#dimensions.width.max;\n  }\n\n  get maxHeight(): number | null {\n    return this.#dimensions.height.max;\n  }\n\n  set maxWidth(value: number | string) {\n    this.setMaxDimensionValue('width', value);\n  }\n\n  set maxHeight(value: number | string) {\n    this.setMaxDimensionValue('height', value);\n  }\n\n  get isReadonly(): boolean {\n    return this.#isReadonly;\n  }\n\n  set isReadonly(value: boolean | string) {\n    if ((this.#isReadonly = value && value !== 'false')) {\n      hide(this.#inputsElement);\n      unHide(this.#readonlyElement);\n    } else {\n      unHide(this.#inputsElement);\n      hide(this.#readonlyElement);\n    }\n  }\n\n  #setReadonlyText() {\n    this.#readonlyElement.innerHTML = `${this.width} &times; ${this.height}`;\n  }\n\n  applyAspectRatio(targetDimension: Dimension, value: number): number {\n    if (!this.#aspectRatio) {\n      return value;\n    }\n    return targetDimension === 'width'\n      ? value * this.#aspectRatio\n      : value / this.#aspectRatio;\n  }\n\n  getOtherDimension(dimension: Dimension): Dimension {\n    return dimension === 'width' ? 'height' : 'width';\n  }\n\n  get aspectRatio(): number | null {\n    return this.#aspectRatio;\n  }\n\n  set aspectRatio(value: number | string) {\n    this.#aspectRatio = value ? Number(value) : null;\n    if (isNaN(this.#aspectRatio)) {\n      this.#aspectRatio = null;\n    }\n\n    if (this.#aspectRatio) {\n      if (!this.#connectorElement.classList.contains('linked')) {\n        this.#connectorElement.classList.add('linked');\n      }\n      this.#connectorElement.innerHTML = '';\n    } else {\n      this.#connectorElement.classList.remove('linked');\n      this.#connectorElement.innerHTML = '&times;';\n    }\n  }\n\n  setMaxDimensionValue(\n    dimension: Dimension,\n    value: number | string,\n    updateOtherDimension = true\n  ) {\n    const props = this.#dimensions[dimension];\n\n    value = Number(value);\n    let normalizedValue = value;\n    if (this.floatingPoints != null) {\n      normalizedValue = value.toFixedPrecision(this.floatingPoints);\n    }\n\n    if (normalizedValue === props.max) {\n      return;\n    }\n\n    props.max = isNaN(normalizedValue) ? null : normalizedValue;\n    if (props.max) {\n      if (props.value && props.value > normalizedValue) {\n        this[dimension] = normalizedValue;\n      }\n      props.element.setAttribute('max', String(props.max));\n    } else {\n      props.element.removeAttribute('max');\n    }\n\n    if (updateOtherDimension && this.#aspectRatio) {\n      const otherDimension = this.getOtherDimension(dimension);\n      const otherDimensionMaxValue = this.applyAspectRatio(\n        otherDimension,\n        value\n      );\n      if (\n        !this.#dimensions[otherDimension].max ||\n        otherDimensionMaxValue < this.#dimensions[otherDimension].max\n      ) {\n        this.setMaxDimensionValue(\n          otherDimension,\n          otherDimensionMaxValue,\n          false\n        );\n      }\n    }\n  }\n\n  setMaxDimensions(dimensions: Dimensions) {\n    this.setMaxDimensionValue('width', dimensions[0], false);\n    this.setMaxDimensionValue('height', dimensions[1], false);\n  }\n\n  setDimensionValue(\n    dimension: Dimension,\n    value: number,\n    { updateOtherDimension = true, updateOtherDimensionOnce = false } = {}\n  ) {\n    const props = this.#dimensions[dimension];\n\n    let normalizedValue = value;\n    if (this.floatingPoints != null) {\n      normalizedValue = value.toFixedPrecision(this.floatingPoints);\n    }\n\n    if (normalizedValue === this[dimension]) {\n      return;\n    }\n    if (isNaN(normalizedValue)) {\n      console.warn('Attempting to set a NaN value to DimensionsInput width.');\n    } else {\n      if (props.max) {\n        normalizedValue = Math.min(normalizedValue, props.max);\n      }\n      props.value = normalizedValue;\n      props.element.value = String(\n        this.floatingPoints != null\n          ? normalizedValue.toFixedPrecision(this.floatingPoints)\n          : normalizedValue\n      );\n\n      if (updateOtherDimension && this.#aspectRatio) {\n        const otherDimension = this.getOtherDimension(dimension);\n        this.setDimensionValue(\n          otherDimension,\n          this.applyAspectRatio(otherDimension, normalizedValue),\n          {\n            updateOtherDimension: updateOtherDimensionOnce,\n          }\n        );\n      }\n\n      this.#setReadonlyText();\n    }\n\n    this.#updateFormValue();\n  }\n\n  attributeChangedCallback(name: string, oldVal: string, newVal: string) {\n    if (name === 'aspect-ratio') {\n      this.aspectRatio = newVal;\n    } else if (name === 'max-width') {\n      this.maxWidth = newVal;\n    } else if (name === 'max-height') {\n      this.maxHeight = newVal;\n    } else if (name === 'floating-points') {\n      this.setFloatingPoints(Number(newVal));\n    } else if (name === 'readonly') {\n      this.isReadonly = newVal;\n    }\n  }\n\n  connectedCallback() {\n    this.shadowRoot.addEventListener('input', e =>\n      this.#handleInput(e as InputEvent)\n    );\n\n    this.shadowRoot.addEventListener('focusin', e => {\n      if (e.target instanceof HTMLInputElement) {\n        e.target.select();\n      }\n    });\n\n    this.#syncAttributes();\n  }\n\n  #handleInput(e: InputEvent) {\n    if (e.target instanceof HTMLInputElement) {\n      const value = Number(e.target.value);\n\n      for (const dimension of DIMENSIONS) {\n        if (e.target === this.#dimensions[dimension].element) {\n          this[dimension] = value;\n          this.dispatchEvent(\n            new CustomEvent('dimensionchange', {\n              detail: {\n                value: this.value,\n                dimension,\n                width: this.width,\n                height: this.height,\n              },\n            })\n          );\n          break;\n        }\n      }\n\n      this.#updateFormValue();\n    }\n  }\n\n  #updateFormValue() {\n    this.internals.setFormValue(String(this.value.join(',')));\n  }\n\n  #syncAttributes() {\n    for (const dimension of DIMENSIONS) {\n      const props = this.#dimensions[dimension];\n\n      if (this.hasAttribute('default-' + dimension)) {\n        const value = Number(this.getAttribute('default-' + dimension));\n        props.defaultValue = isNaN(value) ? 0 : value;\n        props.element.placeholder = String(value);\n      }\n\n      this.setMaxDimensionValue(\n        dimension,\n        this.getAttribute('max-' + dimension)\n      );\n\n      if (this.hasAttribute(dimension)) {\n        const value = Number(this.getAttribute(dimension));\n        this[dimension] = isNaN(value) ? props.defaultValue : value;\n      }\n    }\n\n    this.aspectRatio = this.getAttribute('aspect-ratio');\n    this.isReadonly = this.getAttribute('readonly');\n\n    if (this.hasAttribute('floating-points')) {\n      const value = Number(this.getAttribute('floating-points'));\n      this.setFloatingPoints(isNaN(value) ? null : value);\n    }\n  }\n\n  setFloatingPoints(value: number) {\n    if (value != null && !isNaN(value)) {\n      this.floatingPoints = value;\n      this.inputs.forEach(input =>\n        input.setAttribute('step', String(1 / 10 ** this.floatingPoints))\n      );\n\n      DIMENSIONS.forEach(dimension => {\n        if (this[dimension]) {\n          this[dimension] = this[dimension].toFixedPrecision(value);\n        }\n      });\n    } else {\n      this.floatingPoints = null;\n      this.inputs.forEach(input => input.removeAttribute('step'));\n    }\n  }\n}\n\ncustomElements.define('dimensions-input', DimensionsInput);\n","module.exports = \"15ba0a04ab06b16c\";","export class DropdownMenu extends HTMLElement {\n  private button!: HTMLButtonElement;\n  #buttonStyle: string;\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open' });\n    this.shadowRoot!.innerHTML = `\n      <style>\n        :host {\n          display: inline-block;\n          position: relative;\n        }\n\n        button {\n          display: block;\n          padding: 10px 15px;\n          background: transparent;\n          color: white;\n          border: none;\n          cursor: pointer;\n          font: inherit;\n        }\n\n        button:hover {\n          background: #444;\n        }\n\n        button:focus {\n          background: rgba(255,255,255,.2)\n        }\n        ul {\n          display: none;\n          position: absolute;\n          top: 100%;\n          right: 0;\n          min-width: 120px;\n          background: var(--color-dialog-background);\n          border: var(--border-dialog);\n          margin: 0;\n          padding: 0;\n          list-style: none;\n          z-index: 1000;\n          box-shadow: 1px 1px 10px rgba(0,0,0,.7)\n        }\n\n        :host(.open) ul {\n          display: block;\n        }\n      </style>\n\n      <button aria-haspopup=\"true\" aria-expanded=\"false\">\n        <slot name=\"label\">Menu</slot>\n      </button>\n      <ul role=\"menu\">\n        <slot></slot>\n      </ul>\n    `;\n  }\n\n  connectedCallback(): void {\n    this.button = this.shadowRoot!.querySelector('button') as HTMLButtonElement;\n    this.button.addEventListener('click', () => this.toggle());\n\n    if (this.#buttonStyle) {\n      this.button.style = this.#buttonStyle;\n    }\n    document.addEventListener('click', e => {\n      if (\n        !this.contains(e.target as Node) &&\n        !this.shadowRoot!.contains(e.target as Node)\n      ) {\n        this.close();\n      }\n    });\n\n    this.button.addEventListener('keydown', (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        this.close();\n        this.button.focus();\n      }\n    });\n\n    // Listen for selection from child items\n    this.addEventListener('item-selected', (e: Event) => {\n      const customEvent = e as CustomEvent<{ value: string }>;\n      this.dispatchEvent(\n        new CustomEvent('select', {\n          detail: { value: customEvent.detail.value },\n          bubbles: true,\n          composed: true,\n        })\n      );\n      this.close();\n    });\n  }\n\n  static get observedAttributes() {\n    return ['button-style'];\n  }\n\n  attributeChangedCallback(name: string, oldVal: string, newVal: string) {\n    if (name === 'button-style') {\n      if (this.button) {\n        this.button.style = newVal;\n      } else {\n        this.#buttonStyle = newVal;\n      }\n    }\n  }\n\n  private toggle(): void {\n    const isOpen = this.classList.toggle('open');\n    this.button.setAttribute('aria-expanded', String(isOpen));\n  }\n\n  private close(): void {\n    this.classList.remove('open');\n    this.button.setAttribute('aria-expanded', 'false');\n  }\n}\n\ncustomElements.define('dropdown-menu', DropdownMenu);\n","class DropdownMenuItem extends HTMLElement {\n  static get observedAttributes() {\n    return ['value'];\n  }\n\n  value: string = '';\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open' });\n    this.shadowRoot!.innerHTML = `\n      <style>\n        li {\n          list-style: none;\n          padding: 12px 40px 12px 20px;\n          color: White;\n          text-decoration: none;\n          white-space: nowrap;\n          background: transparent;\n          cursor: pointer;\n        }\n        li:hover {\n          background: rgba(255,255,255,.1);\n        }\n        span:not(:empty) {\n          float: left; \n          margin-right: .5em;\n          position: relative;\n          left: -4px;\n          top: 1px;\n        }\n      </style>\n      <li role=\"menuitem\">\n        <span id=\"icon\"><slot name=\"icon\"></span>\n        <slot></slot>\n      </li>\n    `;\n  }\n\n  connectedCallback(): void {\n    const item = this.shadowRoot!.querySelector('li')!;\n    item.addEventListener('click', e => {\n      e.preventDefault();\n      this.dispatchEvent(\n        new CustomEvent('item-selected', {\n          detail: { value: this.value },\n          bubbles: true,\n          composed: true,\n        })\n      );\n    });\n  }\n\n  attributeChangedCallback(name: string, _oldValue: string, newValue: string) {\n    if (name === 'value') {\n      this.value = newValue;\n    }\n  }\n}\n\ncustomElements.define('dropdown-menu-item', DropdownMenuItem);\n","import * as styles from 'bundle-text:./dialog.css';\nimport type ConfirmDialog from './ConfirmDialog';\n\nconst sheet = new CSSStyleSheet();\nsheet.replaceSync(String(styles));\n\nexport default class InputDialog extends HTMLElement {\n  private dialog: ConfirmDialog;\n  private input: HTMLInputElement;\n\n  static get observedAttributes() {\n    return [\n      'dialog-title',\n      'description',\n      'value',\n      'submit',\n      'cancel',\n      'type',\n      'submit-icon',\n    ];\n  }\n\n  constructor() {\n    super();\n\n    const shadow = this.attachShadow({ mode: 'open' });\n\n    shadow.adoptedStyleSheets = [sheet];\n    this.shadowRoot!.innerHTML = `\n      <confirm-dialog>\n        <input\n            type=\"text\"\n            class=\"dialog-input dialog-input-tall\"\n            name=\"patternName\"\n            required\n          />\n      </confirm-dialog>\n    `;\n\n    this.dialog = shadow.querySelector('confirm-dialog')!;\n    this.input = shadow.querySelector('input')!;\n    this.input.addEventListener('keypress', e => {\n      if (e.code === 'Enter') {\n        this.dialog.submit();\n      }\n    });\n  }\n\n  connectedCallback() {\n    this.syncAttributes();\n  }\n\n  attributeChangedCallback() {\n    this.syncAttributes();\n  }\n\n  private syncAttributes() {\n    InputDialog.observedAttributes\n      .filter(attr => attr !== 'value')\n      .forEach(attr => {\n        if (this.hasAttribute(attr)) {\n          this.dialog.setAttribute(attr, this.getAttribute(attr));\n        } else {\n          this.dialog.removeAttribute(attr);\n        }\n      });\n\n    if (this.hasAttribute('value')) {\n      this.input.value = this.getAttribute('value') || '';\n    }\n  }\n\n  /**\n   * Opens the dialog, optionally with an initial value.\n   */\n  show(initialValue?: string): Promise<string | null> {\n    if (initialValue !== undefined) {\n      this.input.value = initialValue;\n    } else if (this.hasAttribute('value')) {\n      this.input.value = this.getAttribute('value') || '';\n    }\n    this.input.select();\n    return this.dialog.show().then(() => this.input.value);\n  }\n\n  /**\n   * Gets the value entered by the user if submitted,\n   * or null if canceled.\n   */\n  getValue(): string | null {\n    return this.input.value;\n  }\n}\n\ncustomElements.define('input-dialog', InputDialog);\n","module.exports = \"72349662a41355c1\";","import * as styles from 'bundle-text:./dialog.css';\nimport * as html from 'bundle-text:./ConfirmDialog.html';\nimport { hide, unHide } from '../../helpers/dom_utils';\n\nconst sheet = new CSSStyleSheet();\nsheet.replaceSync(String(styles));\n\nexport type ConfirmDialogType = 'default' | 'error';\n\nexport default class ConfirmDialog extends HTMLElement {\n  private dialog: HTMLDialogElement;\n  private cancelBtn: HTMLButtonElement;\n  private submitBtn: HTMLButtonElement;\n  private titleEl: HTMLElement;\n  private descEl: HTMLElement;\n  private submitText: HTMLSpanElement;\n  private submitIcon: HTMLElement;\n\n  static get observedAttributes() {\n    return [\n      'dialog-title',\n      'description',\n      'submit',\n      'cancel',\n      'type',\n      'centered',\n      'submit-icon',\n      'width',\n    ];\n  }\n\n  constructor() {\n    super();\n\n    const shadow = this.attachShadow({ mode: 'open' });\n\n    shadow.adoptedStyleSheets = [sheet];\n    this.shadowRoot!.innerHTML = String(html);\n\n    this.dialog = shadow.querySelector('dialog')!;\n    this.cancelBtn = shadow.querySelector('.btn-cancel')!;\n    this.submitBtn = shadow.querySelector('.btn-submit')!;\n    this.titleEl = shadow.querySelector('.dialog-title')!;\n    this.descEl = shadow.querySelector('.dialog-desc')!;\n    this.submitText = shadow.querySelector('#submit_text')!;\n    this.submitIcon = shadow.querySelector('#submit_icon')!;\n  }\n\n  connectedCallback() {\n    this.cancelBtn.addEventListener('click', () => {\n      this.dialog.returnValue = '';\n      this.dialog.close();\n    });\n\n    // Initialize attributes on first connect\n    this.syncAttributes();\n  }\n\n  attributeChangedCallback() {\n    this.syncAttributes();\n  }\n\n  private syncAttributes() {\n    if (this.hasAttribute('dialog-title')) {\n      this.titleEl.textContent = this.getAttribute('dialog-title');\n    }\n    if (this.hasAttribute('description')) {\n      this.descEl.textContent = this.getAttribute('description');\n    }\n    this.submitText.textContent = this.getAttribute('submit') || 'Submit';\n    this.cancelBtn.textContent = this.getAttribute('cancel') || 'Cancel';\n\n    if (this.hasAttribute('type') && this.getAttribute('type') === 'error') {\n      this.dialog.classList.add('error');\n    } else {\n      this.dialog.classList.remove('error');\n    }\n\n    if (\n      this.hasAttribute('centered') &&\n      this.getAttribute('centered') !== 'false'\n    ) {\n      this.dialog.classList.add('centered');\n    } else {\n      this.dialog.classList.remove('centered');\n    }\n\n    if (this.hasAttribute('submit-icon')) {\n      this.submitIcon.className = 'icon-' + this.getAttribute('submit-icon');\n      unHide(this.submitIcon);\n    } else {\n      hide(this.submitIcon);\n    }\n\n    if (this.hasAttribute('width')) {\n      const value = this.getAttribute('width');\n      const isPx = /^\\d+$/.test(value);\n      this.dialog.style.setProperty('width', isPx ? `${value}px` : value);\n    } else {\n      this.dialog.style.removeProperty('width');\n    }\n  }\n\n  /**\n   * Opens the dialog, optionally with an initial value.\n   */\n  show(onShow?: () => void): Promise<void> {\n    this.dialog.showModal();\n    onShow?.();\n    return new Promise((resolve, reject) => {\n      const handleClose = () => {\n        this.dialog.removeEventListener('close', handleClose);\n        if (this.dialog.returnValue === 'confirm') {\n          resolve();\n        } else {\n          reject();\n        }\n      };\n      this.dialog.addEventListener('close', handleClose);\n    });\n  }\n\n  submit() {\n    this.submitBtn.click();\n  }\n}\n\ncustomElements.define('confirm-dialog', ConfirmDialog);\n","module.exports = \"6724f4af4f91cfc4\";","module.exports = \"9bb941e16da7a677\";","import * as styles from 'bundle-text:./DownloadDialog.css';\nimport * as html from 'bundle-text:./DownloadDialog.html';\nimport type ConfirmDialog from '../ConfirmDialog';\nimport type StringArt from '../../../infra/StringArt';\nimport {\n  fitInside,\n  lengthConvert,\n  mapDimensions,\n  sizeConvert,\n} from '../../../helpers/size_utils';\nimport { Dimension, Dimensions, SizeUnit } from '../../../types/general.types';\nimport preferences from '../../../helpers/preferences';\nimport {\n  downloadPattern,\n  DownloadPatternOptions,\n  ImageType,\n} from '../../../download/Download';\nimport type DimensionsInput from '../../inputs/DimensionsInput';\nimport CanvasRenderer from '../../../infra/renderers/CanvasRenderer';\nimport StringArtCheckbox from '../../inputs/StringArtCheckbox';\nimport {\n  DOWNLOAD_IMAGE_SIZES,\n  DownloadSizeType,\n  getDownloadImageSizeById,\n} from './download_image_sizes';\nimport Persistance from '../../../Persistance';\nimport { hide, toggleHide, unHide } from '../../../helpers/dom_utils';\n\nconst sheet = new CSSStyleSheet();\nsheet.replaceSync(String(styles));\n\nconst DEFAULT_DPI = 300;\nconst IMAGE_TYPES_WITH_TRANSPARENT_BACKGROUND = ['png', 'svg', 'webp'];\n\ntype Units = SizeUnit;\n\nexport default class DownloadDialog extends HTMLElement {\n  private dialog: ConfirmDialog;\n  private elements: {\n    size: HTMLSelectElement;\n    form: HTMLFormElement;\n    unitSelect: NodeListOf<HTMLSelectElement>;\n    dpi: HTMLSelectElement;\n    dpiBlock: HTMLElement;\n    imageDimensions: DimensionsInput;\n    renderNumbersBlock: HTMLElement;\n    patternDimensions: DimensionsInput;\n    margin: HTMLInputElement;\n    canvas: HTMLCanvasElement;\n    transparentBackground: StringArtCheckbox;\n    rotateBtn: HTMLButtonElement;\n  };\n  private units: Units;\n  private customDimensions: Dimensions;\n  private dimensions: Dimensions;\n  private margin: number;\n  private patternAspectRatio = 1;\n  private currentSize: DownloadSizeType;\n  currentPattern: StringArt;\n  private unitFloatingPointsPrecision = 0;\n\n  constructor() {\n    super();\n\n    const shadow = this.attachShadow({ mode: 'open' });\n\n    shadow.adoptedStyleSheets = [sheet];\n    this.shadowRoot!.innerHTML = String(html);\n\n    this.dialog = shadow.querySelector('confirm-dialog')!;\n    this.elements = {\n      size: shadow.querySelector('#size'),\n      form: shadow.querySelector('form'),\n      unitSelect: shadow.querySelectorAll('.unit-select'),\n      dpi: shadow.querySelector('#dpi'),\n      dpiBlock: shadow.querySelector('#dpi_block'),\n      renderNumbersBlock: shadow.querySelector('#render_numbers_block'),\n      patternDimensions: shadow.querySelector('#pattern_size'),\n      imageDimensions: shadow.querySelector('#image_dimensions'),\n      margin: shadow.querySelector('#margin'),\n      canvas: shadow.querySelector('#canvas'),\n      transparentBackground: shadow.querySelector('#transparent_background'),\n      rotateBtn: shadow.querySelector('#rotate_btn'),\n    };\n\n    this.#setSizes();\n    this.setSize(DOWNLOAD_IMAGE_SIZES[0].id);\n\n    preferences.addEventListener('unitsChange', units => {\n      if (this.units !== 'px') {\n        this.setUnits(units);\n      }\n    });\n\n    shadow.addEventListener('focusin', e => {\n      if (\n        e.target instanceof HTMLInputElement &&\n        (e.target.type === 'text' || e.target.type === 'number')\n      ) {\n        e.target.select();\n      }\n    });\n\n    shadow.addEventListener('change', e => {\n      if (\n        e.target instanceof HTMLSelectElement &&\n        e.target.classList.contains('unit-select')\n      ) {\n        this.setUnits(e.target.value as Units);\n      }\n\n      if (e.target === this.elements.size) {\n        this.setSize(this.elements.size.value);\n      }\n\n      if (\n        e.target instanceof HTMLInputElement &&\n        e.target.type === 'radio' &&\n        e.target.name === 'type'\n      ) {\n        const selectedType = (\n          this.elements.form.querySelector(\n            'input[name=\"type\"]:checked'\n          ) as HTMLInputElement\n        )?.value as 'all' | 'nails_map';\n        this.setType(selectedType);\n      }\n\n      if (\n        e.target instanceof HTMLElement &&\n        e.target.dataset.updatesPreview != null\n      ) {\n        this.updatePreview();\n      }\n\n      if (e.target instanceof HTMLSelectElement && e.target.id === 'format') {\n        this.setImageType(e.target.value as ImageType | 'svg');\n      }\n    });\n\n    this.elements.margin.addEventListener('input', (e: InputEvent) => {\n      const value = Number((e.target as HTMLInputElement).value);\n      this.setMargin(isNaN(value) ? 0 : value);\n    });\n\n    this.elements.imageDimensions.addEventListener(\n      'dimensionchange',\n      ({\n        detail: { dimension, value: dimensions, ...size },\n      }: CustomEvent<{\n        value: Dimensions;\n        dimension: Dimension;\n        width: number;\n        height: number;\n      }>) => {\n        const value = size[dimension];\n\n        if (this.customDimensions) {\n          this.customDimensions = dimensions;\n          this.setDimensions(dimensions);\n          this.elements.patternDimensions.setMaxDimensions(dimensions);\n          this.elements.patternDimensions[dimension] = value - this.margin * 2;\n        }\n\n        this.updatePreview();\n      }\n    );\n\n    this.elements.patternDimensions.addEventListener(\n      'dimensionchange',\n      ({\n        detail: { dimension, value: dimensions, ...size },\n      }: CustomEvent<{\n        value: Dimensions;\n        dimension: Dimension;\n        width: number;\n        height: number;\n      }>) => {\n        const value = size[dimension];\n\n        if (this.dimensions) {\n          this.setMargin(\n            this.dimensions[dimension === 'width' ? 0 : 1] - value,\n            { updatePatternDimensions: false }\n          );\n        }\n      }\n    );\n\n    this.elements.rotateBtn.addEventListener('click', () => this.rotateImage());\n  }\n\n  setType(type: 'nails_map' | 'all', updatePreview = true) {\n    (\n      this.shadowRoot.querySelector(`#type_${type}`)! as HTMLInputElement\n    ).checked = true;\n\n    this.#toggleNailNumbers(type === 'nails_map');\n\n    const transparentBackgroundBlock = this.shadowRoot.querySelector(\n      '#transparent_background_block'\n    ) as HTMLDivElement;\n    if (type === 'nails_map') {\n      hide(transparentBackgroundBlock);\n    } else {\n      unHide(transparentBackgroundBlock);\n    }\n\n    if (updatePreview) {\n      this.updatePreview();\n    }\n  }\n\n  setImageType(imageType: ImageType | 'svg') {\n    (this.shadowRoot.querySelector('#format') as HTMLSelectElement)!.value =\n      imageType;\n\n    toggleHide(\n      this.elements.transparentBackground,\n      !IMAGE_TYPES_WITH_TRANSPARENT_BACKGROUND.includes(imageType)\n    );\n  }\n\n  getFormValues(): Record<string, FormDataEntryValue> {\n    const data = new FormData(this.elements.form);\n    return Object.fromEntries(data.entries());\n  }\n\n  get isTransparentBackground(): boolean {\n    const formValues = this.getFormValues();\n\n    return (\n      formValues.type !== 'nails_map' &&\n      IMAGE_TYPES_WITH_TRANSPARENT_BACKGROUND.includes(\n        String(formValues.format)\n      ) &&\n      formValues.transparent_background === 'on'\n    );\n  }\n\n  #setSizes() {\n    this.elements.size.innerHTML = DOWNLOAD_IMAGE_SIZES.map(\n      ({ id, name }) => `<option value=\"${id}\">${name ?? id}</option>`\n    ).join('\\n');\n  }\n\n  #toggleNailNumbers(show: boolean) {\n    toggleHide(this.elements.renderNumbersBlock, !show);\n  }\n\n  get dpi(): number {\n    return Number(this.elements.dpi.value ?? DEFAULT_DPI);\n  }\n\n  rotateImage() {\n    this.setDimensions(this.#swapDimensions(this.dimensions));\n  }\n\n  setUnits(units: Units, updatePreview = true) {\n    if (units === this.units) {\n      return;\n    }\n\n    const prevUnits = this.units;\n    this.units = units;\n\n    this.elements.unitSelect.forEach(unitSelect => {\n      unitSelect.value = units;\n    });\n\n    this.unitFloatingPointsPrecision = units === 'px' ? 0 : 1;\n\n    if (units === 'cm' || units === 'inch') {\n      preferences.setUserPreferredUnits(units);\n      unHide(this.elements.dpiBlock);\n    } else {\n      hide(this.elements.dpiBlock);\n    }\n\n    this.elements.patternDimensions.setFloatingPoints(\n      this.unitFloatingPointsPrecision\n    );\n    this.elements.imageDimensions.setFloatingPoints(\n      this.unitFloatingPointsPrecision\n    );\n\n    // If changing from length unit to px or vice-versa, need to convert dimensions\n    if (prevUnits) {\n      if (this.dimensions) {\n        this.dimensions = sizeConvert(\n          this.dimensions,\n          prevUnits,\n          units,\n          this.dpi\n        );\n      }\n\n      if (this.margin) {\n        this.setMargin(lengthConvert(this.margin, prevUnits, units, this.dpi));\n      }\n    }\n\n    if (this.dimensions) {\n      this.setDimensions(this.dimensions, updatePreview);\n    }\n  }\n\n  getMarginMax(): number | null {\n    if (this.dimensions) {\n      return Math.min(this.dimensions[0] / 2.1, this.dimensions[1] / 2.1);\n    }\n\n    return null;\n  }\n\n  setMargin(\n    margin: number | null,\n    { updatePatternDimensions = true, updatePreview = true } = {}\n  ) {\n    margin = Math.max(margin, 0);\n    if (this.dimensions) {\n      margin = Math.min(margin, this.getMarginMax());\n    }\n    if (margin === this.margin) {\n      return;\n    }\n\n    this.margin = margin ?? 0;\n    this.elements.margin.value = String(\n      margin.toFixedPrecision(this.unitFloatingPointsPrecision) ?? 0\n    );\n\n    if (updatePatternDimensions && this.dimensions) {\n      this.updatePatternDimensions();\n    }\n\n    if (updatePreview) {\n      this.updatePreview();\n    }\n  }\n\n  setSize(id: string, updatePreview = true) {\n    const size = getDownloadImageSizeById(id);\n    this.currentSize = size;\n\n    const {\n      units,\n      dimensions: sizeDimensions,\n      aspectRatio,\n      allowSizeEdit,\n      defaultUnits,\n      inUnits,\n      defaultMargin = 0,\n      allowRotate,\n    } = size;\n\n    this.elements.imageDimensions.aspectRatio =\n      aspectRatio instanceof Function\n        ? aspectRatio({\n            patternAspectRatio: this.patternAspectRatio,\n          })\n        : aspectRatio;\n\n    let dimensions: Dimensions =\n      sizeDimensions instanceof Function\n        ? sizeDimensions({\n            customDimensions: this.customDimensions,\n            currentDimensions: this.dimensions,\n            patternAspectRatio: this.patternAspectRatio,\n          })\n        : sizeDimensions;\n\n    if (allowSizeEdit) {\n      this.elements.imageDimensions.isReadonly = false;\n      this.customDimensions = dimensions;\n    } else {\n      this.elements.imageDimensions.isReadonly = true;\n    }\n\n    toggleHide(this.elements.rotateBtn, !allowRotate);\n\n    const isPixelsOnly = units && units.length === 1 && units[0] === 'px';\n    this.togglePixels(!units || units.includes('px'));\n    this.setPixelsOnly(isPixelsOnly);\n    const newUnits =\n      defaultUnits ??\n      (isPixelsOnly\n        ? 'px'\n        : units && !units.includes(this.units)\n        ? preferences.getUserPreferredUnits()\n        : this.units);\n\n    this.setUnits(newUnits);\n    if (inUnits && inUnits !== newUnits) {\n      dimensions = mapDimensions(\n        sizeConvert(dimensions, inUnits, newUnits, this.dpi),\n        v => v.toFixedPrecision(1)\n      );\n    }\n\n    if (defaultMargin) {\n      this.setMargin(defaultMargin);\n    }\n\n    this.setDimensions(dimensions, updatePreview);\n\n    if (updatePreview) {\n      this.updatePreview();\n    }\n\n    this.elements.size.value = id;\n  }\n\n  togglePixels(showPixels: boolean) {\n    this.elements.unitSelect.forEach(el => {\n      const pixelsOption = el.querySelector('[value=\"px\"]');\n      toggleHide(pixelsOption, !showPixels);\n    });\n  }\n\n  #getDimensionsBySizeId(id: string): Dimensions {\n    const { dimensions } = getDownloadImageSizeById(id);\n\n    return dimensions instanceof Function\n      ? dimensions({\n          customDimensions: this.customDimensions,\n          currentDimensions: this.dimensions,\n          patternAspectRatio: this.patternAspectRatio,\n        })\n      : dimensions;\n  }\n\n  setPixelsOnly(isPixelsOnly: boolean) {\n    if (isPixelsOnly) {\n      this.togglePixels(true);\n    }\n    this.elements.unitSelect.forEach(el => {\n      if (isPixelsOnly) {\n        el.setAttribute('disabled', 'disabled');\n      } else {\n        el.removeAttribute('disabled');\n      }\n\n      const nonPixelOptions = el.querySelectorAll(':not([value=\"px\"])');\n      nonPixelOptions.forEach(option => toggleHide(option, isPixelsOnly));\n    });\n  }\n\n  setDimensions(dimensions: Dimensions, updatePreview = true) {\n    this.dimensions = dimensions;\n    this.elements.imageDimensions.width = dimensions[0];\n    this.elements.imageDimensions.height = dimensions[1];\n\n    this.elements.canvas.style.removeProperty('width');\n    this.elements.canvas.style.removeProperty('height');\n\n    this.elements.margin.setAttribute('max', String(this.getMarginMax()));\n\n    this.updatePatternDimensions();\n\n    if (updatePreview) {\n      this.updatePreview();\n    }\n  }\n\n  updatePatternDimensions() {\n    const patternDimensions = this.#getPatternDimensions();\n    this.elements.patternDimensions.maxWidth = this.dimensions[0];\n    this.elements.patternDimensions.maxHeight = this.dimensions[1];\n    this.elements.patternDimensions.width = patternDimensions[0];\n    this.elements.patternDimensions.height = patternDimensions[1];\n  }\n\n  #getPatternDimensions(): Dimensions {\n    const width = this.dimensions[0] - this.margin * 2;\n    const patternAvailableDimensions = mapDimensions(\n      this.dimensions,\n      v => v - this.margin * 2\n    );\n\n    if (!this.patternAspectRatio || isNaN(this.patternAspectRatio)) {\n      return patternAvailableDimensions;\n    }\n\n    const patternDimensions = [\n      width,\n      width / this.patternAspectRatio,\n    ] as Dimensions;\n    return fitInside(\n      patternDimensions,\n      mapDimensions(this.dimensions, v => v - this.margin * 2)\n    );\n  }\n\n  #swapDimensions(dimensions: Dimensions): Dimensions {\n    return [dimensions[1], dimensions[0]];\n  }\n\n  /**\n   * Opens the dialog, optionally with an initial value.\n   */\n  async show(pattern: StringArt): Promise<void> {\n    this.currentPattern = pattern;\n    this.patternAspectRatio = pattern.getAspectRatio({ size: this.dimensions });\n    this.elements.patternDimensions.setAttribute(\n      'aspect-ratio',\n      String(this.patternAspectRatio)\n    );\n\n    this.setSize(this.currentSize.id);\n    return this.dialog\n      .show(() => {\n        const savedDownloadOptions = Persistance.getPatternDownloadData(\n          pattern.id\n        );\n        this.setDownloadOptionsToForm(savedDownloadOptions);\n      })\n      .then(async () => {\n        const values = this.getFormValues();\n        const downloadOptions = this.#formValuesToDownloadOptions(\n          values,\n          pattern\n        );\n        Persistance.savePatternDownloadData(pattern.id, downloadOptions);\n\n        await downloadPattern(pattern, downloadOptions);\n      });\n  }\n\n  #formValuesToDownloadOptions(\n    values: Record<string, FormDataEntryValue>,\n    pattern: StringArt\n  ): DownloadPatternOptions {\n    const isNailsMap = values.type === 'nails_map';\n\n    let dimensions = this.#getDimensionsBySizeId(values.size as string);\n    if (values.rotate_image) {\n      dimensions = this.#swapDimensions(dimensions);\n    }\n    const options: DownloadPatternOptions = {\n      size: dimensions,\n      type: values.format === 'svg' ? 'svg' : 'canvas',\n      imageType: values.format === 'svg' ? null : (values.format as ImageType),\n      isNailsMap: isNailsMap,\n      units: (values.unit ?? 'px') as SizeUnit,\n      dpi: Number(values.dpi),\n      margin: Number(values.margin),\n      includeNailNumbers: isNailsMap && values.render_numbers === 'on',\n      filename: isNailsMap ? `${pattern.name} - nail map` : pattern.name,\n      enableBackground: !this.isTransparentBackground,\n      sizeId: String(values.size),\n      isRotated: !!values.rotate_image,\n    };\n\n    return options;\n  }\n\n  /**\n   * Used when loading saved download options, to populate the form and internals\n   * @param downloadOptions\n   */\n  setDownloadOptionsToForm(downloadOptions: DownloadPatternOptions | null) {\n    if (!downloadOptions) {\n      const size = DOWNLOAD_IMAGE_SIZES[0];\n      downloadOptions = {\n        size:\n          size.dimensions instanceof Function\n            ? size.dimensions({\n                patternAspectRatio: this.patternAspectRatio,\n              })\n            : size.dimensions,\n        sizeId: size.id,\n        margin: size.defaultMargin,\n        units: size.defaultUnits,\n        enableBackground: true,\n      };\n    }\n    this.setType(downloadOptions.isNailsMap ? 'nails_map' : 'all', false);\n\n    this.#toggleNailNumbers(downloadOptions.isNailsMap);\n    (this.shadowRoot.querySelector(\n      '#render_numbers'\n    ) as StringArtCheckbox)!.value =\n      downloadOptions.includeNailNumbers === true;\n\n    const sizeId = downloadOptions.sizeId ?? 'custom';\n    this.setSize(sizeId, false);\n\n    const isRotated = downloadOptions.isRotated === true;\n    (\n      this.shadowRoot.querySelector('#rotate_image') as HTMLInputElement\n    ).checked = isRotated;\n    if (isRotated) {\n      this.rotateImage();\n    }\n\n    if (downloadOptions.units != null) {\n      this.setUnits(downloadOptions.units, false);\n    }\n\n    this.setMargin(downloadOptions.margin ?? 0, { updatePreview: false });\n    // const { size } = downloadOptions;\n    // if (getDownloadImageSizeById(sizeId).allowSizeEdit) {\n    //   this.customDimensions = size;\n    //   this.setDimensions(size, false);\n    // }\n\n    this.elements.dpi.value = String(downloadOptions.dpi ?? DEFAULT_DPI);\n\n    this.setImageType(downloadOptions.imageType ?? 'png');\n\n    (this.shadowRoot.querySelector(\n      '#transparent_background'\n    ) as StringArtCheckbox)!.value = !downloadOptions.enableBackground;\n\n    this.updatePreview();\n  }\n\n  updatePreview() {\n    if (!this.currentPattern || !this.elements.canvas.clientWidth) {\n      return;\n    }\n\n    this.elements.canvas.innerHTML = '';\n\n    if (this.elements.canvas.clientWidth) {\n      const pxDimensions = fitInside(\n        sizeConvert(this.dimensions, this.units, 'px', this.dpi),\n        [\n          this.elements.canvas.clientWidth || 200,\n          this.elements.canvas.clientHeight || 300,\n        ]\n      );\n      this.elements.canvas.style.width = pxDimensions[0] + 'px';\n      this.elements.canvas.style.height = pxDimensions[1] + 'px';\n    }\n\n    const renderer = new CanvasRenderer(this.elements.canvas, {\n      updateOnResize: false,\n    });\n\n    const previewSize = [\n      this.elements.canvas.clientWidth || 200,\n      this.elements.canvas.clientHeight || 300,\n    ] as Dimensions;\n\n    renderer.setFixedSize(previewSize);\n\n    const previewPattern = this.currentPattern.copy();\n    const values = this.getFormValues();\n\n    previewPattern.assignConfig(\n      values.type === 'nails_map'\n        ? {\n            darkMode: false,\n            showNails: true,\n            showNailNumbers: values.render_numbers === 'on',\n            showStrings: false,\n            nailsColor: '#000000',\n            backgroundColor: '#ffffff',\n            enableBackground: true,\n          }\n        : {\n            enableBackground: !this.isTransparentBackground,\n            showNailNumbers: false,\n            showStrings: true,\n          }\n    );\n\n    const previewSizeRatio = previewSize[0] / this.dimensions[0];\n    previewPattern.assignConfig({\n      margin: Math.floor(this.margin * previewSizeRatio),\n      nailRadius: Math.max(\n        0.5,\n        this.currentPattern.config.nailRadius * previewSizeRatio\n      ),\n    });\n\n    previewPattern.draw(renderer, { precision: 1 });\n  }\n}\n\ncustomElements.define('download-dialog', DownloadDialog);\n","module.exports = \"aa768dce0ef9debb\";","module.exports = \"50a0cac648abba18\";","import { LengthUnit } from '../types/general.types';\nimport EventBus from './EventBus';\n\nconst UNITS_LOCALSTORAGE_KEY = 'units';\n\nclass Preferences extends EventBus<{\n  unitsChange: LengthUnit;\n}> {\n  #userPreferredUnits: LengthUnit;\n\n  getUserPreferredUnits(): LengthUnit {\n    if (!this.#userPreferredUnits) {\n      this.#userPreferredUnits =\n        localStorage.getItem(UNITS_LOCALSTORAGE_KEY) === 'inch' ? 'inch' : 'cm';\n    }\n\n    return this.#userPreferredUnits;\n  }\n\n  setUserPreferredUnits(units: LengthUnit) {\n    if (this.#userPreferredUnits !== units) {\n      this.#userPreferredUnits = units;\n      localStorage.setItem(UNITS_LOCALSTORAGE_KEY, units);\n      this.emit('unitsChange', units);\n    }\n  }\n}\n\nconst preferences = new Preferences();\nexport default preferences;\n","import { lengthConvert, sizeConvert } from '../helpers/size_utils';\nimport CanvasRenderer from '../infra/renderers/CanvasRenderer';\nimport SVGRenderer from '../infra/renderers/SVGRenderer';\nimport StringArt from '../infra/StringArt';\nimport { CommonConfig } from '../types/config.types';\nimport { Dimensions, LengthUnit, SizeUnit } from '../types/general.types';\nimport { RendererType } from '../types/stringart.types';\n\ninterface DownloadData {\n  data: Blob;\n  filename: string;\n}\n\nexport type ImageType = 'png' | 'jpeg' | 'webp';\nexport interface DownloadPatternOptions {\n  size: Dimensions;\n  units?: SizeUnit;\n  dpi?: number;\n  filename?: string;\n  isNailsMap?: boolean;\n  includeNailNumbers?: boolean;\n  type?: RendererType;\n  imageType?: ImageType;\n  margin?: number;\n  enableBackground?: boolean;\n  sizeId?: string;\n  isRotated?: boolean;\n}\n\nexport function downloadFile({ data, filename }: DownloadData) {\n  const dataUrl = URL.createObjectURL(data);\n\n  const downloadLink = document.createElement('a');\n  downloadLink.href = dataUrl;\n  downloadLink.download = filename;\n  document.body.appendChild(downloadLink);\n  downloadLink.click();\n  document.body.removeChild(downloadLink);\n\n  URL.revokeObjectURL(dataUrl);\n}\n\nexport async function downloadPattern(\n  pattern: StringArt,\n  { type, ...options }: DownloadPatternOptions\n): Promise<void> {\n  const overridingConfig = getConfigForDownloadOptions(options);\n  if (overridingConfig) {\n    pattern = pattern.copy();\n    pattern.assignConfig(overridingConfig);\n  }\n\n  if (options.units) {\n    options = {\n      ...options,\n      size: sizeConvert(options.size, options.units, 'px', options.dpi),\n    };\n  }\n\n  const downloadData =\n    type === 'svg'\n      ? patternToSVGDownloadData(pattern, options)\n      : await patternToImageDownloadData(pattern, options);\n  downloadFile(downloadData);\n}\n\nexport function getConfigForDownloadOptions(\n  options: DownloadPatternOptions\n): Partial<CommonConfig> | null {\n  const config: Partial<CommonConfig> = {};\n\n  if (options.margin) {\n    config.margin = lengthConvert(\n      options.margin,\n      options.units ?? 'px',\n      'px',\n      options.dpi\n    );\n  }\n\n  if (options.isNailsMap) {\n    Object.assign(config, {\n      darkMode: false,\n      showNails: true,\n      showNailNumbers: options.includeNailNumbers,\n      showStrings: false,\n      nailsColor: '#000000',\n      backgroundColor: '#ffffff',\n    });\n  }\n\n  if (options.enableBackground != null) {\n    Object.assign(config, {\n      enableBackground: options.enableBackground,\n    });\n  }\n\n  return Object.keys(config).length === 0 ? null : config;\n}\n\nasync function patternToImageDownloadData(\n  pattern: StringArt,\n  {\n    size,\n    filename,\n    imageType,\n  }: { size: Dimensions; filename?: string; imageType?: ImageType }\n): Promise<DownloadData> {\n  const parentElement = document.createElement('article');\n  const renderer = new CanvasRenderer(parentElement, { updateOnResize: false });\n\n  renderer.disablePixelRatio();\n  renderer.setFixedSize(size);\n\n  pattern.draw(renderer);\n\n  return {\n    data: await renderer.toBlob(imageType),\n    filename: `${filename ?? pattern.name}.${imageType ?? 'png'}`,\n  };\n}\n\nfunction patternToSVGDownloadData(\n  pattern: StringArt,\n  { size, filename }: { size: Dimensions; filename?: string }\n): DownloadData {\n  const parentEl = document.createElement('article');\n  parentEl.style.width = size[0] + 'px';\n  parentEl.style.height = size[1] + 'px';\n  document.body.appendChild(parentEl);\n  const renderer = new SVGRenderer(parentEl);\n  renderer.setFixedSize(size);\n  pattern.draw(renderer);\n\n  const svgData = renderer.svg.outerHTML;\n  const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });\n  return {\n    data: svgBlob,\n    filename: filename ?? pattern.name + '.svg',\n  };\n}\n","import {\n  fitInside,\n  mapDimensions,\n  STANDARD_SIZES_CM,\n} from '../../../helpers/size_utils';\nimport { Dimensions, SizeUnit } from '../../../types/general.types';\n\nexport interface DownloadSizeType {\n  id: string;\n  name?: string;\n  dimensions?:\n    | Dimensions\n    | ((options: {\n        customDimensions?: Dimensions | null;\n        currentDimensions?: Dimensions | null;\n        patternAspectRatio: number;\n      }) => Dimensions | null);\n  units?: SizeUnit[];\n  aspectRatio?:\n    | number\n    | ((options: { patternAspectRatio: number }) => number | null);\n  allowSizeEdit?: boolean;\n  defaultUnits?: SizeUnit;\n  inUnits?: SizeUnit;\n  defaultMargin?: number;\n  allowRotate?: boolean;\n}\n\nconst DEFAULT_DIMENSIONS: Dimensions = [10, 10];\n\nexport const DOWNLOAD_IMAGE_SIZES: ReadonlyArray<DownloadSizeType> = [\n  {\n    id: 'fit',\n    name: 'Fit pattern',\n    dimensions: ({ customDimensions, patternAspectRatio }) => {\n      let dimensions = customDimensions;\n      if (!dimensions) {\n        const SMALL_SCREEN_DIMENSION = Math.min(screen.width, screen.height);\n        const dpr = window.devicePixelRatio ?? 1;\n        dimensions = mapDimensions(\n          [SMALL_SCREEN_DIMENSION, SMALL_SCREEN_DIMENSION],\n          v => v * dpr\n        );\n      }\n      const customDimensionsFitPattern = [\n        dimensions[0],\n        dimensions[0] / patternAspectRatio,\n      ] as Dimensions;\n\n      return fitInside(customDimensionsFitPattern, dimensions);\n    },\n    units: ['px', 'cm', 'inch'],\n    defaultUnits: 'px',\n    defaultMargin: 20,\n    allowSizeEdit: true,\n    aspectRatio: ({ patternAspectRatio }) => patternAspectRatio,\n  },\n  {\n    id: 'screen',\n    name: 'Screen size',\n    dimensions: () => {\n      const dpr = window.devicePixelRatio ?? 1;\n      return [window.screen.width, window.screen.height].map(v =>\n        Math.floor(v * dpr)\n      ) as Dimensions;\n    },\n    units: ['px'],\n    defaultMargin: 10,\n    allowRotate: true,\n  },\n  ...STANDARD_SIZES_CM.map(size => ({\n    ...size,\n    units: ['cm', 'inch'] as SizeUnit[],\n    inUnits: 'cm' as SizeUnit,\n    defaultMargin: 1,\n    allowRotate: true,\n  })),\n  {\n    id: 'custom',\n    name: 'Custom size',\n    dimensions: ({ customDimensions, currentDimensions }) =>\n      currentDimensions ?? customDimensions ?? DEFAULT_DIMENSIONS,\n    allowSizeEdit: true,\n    allowRotate: true,\n  },\n];\n\nexport function getDownloadImageSizeById(id: string): DownloadSizeType | null {\n  return DOWNLOAD_IMAGE_SIZES.find(({ id: sizeId }) => sizeId === id);\n}\n","import EventBus from '../helpers/EventBus';\nimport CanvasRenderer from '../infra/renderers/CanvasRenderer';\nimport Renderer from '../infra/renderers/Renderer';\nimport SVGRenderer from '../infra/renderers/SVGRenderer';\nimport routing from '../routing';\nimport StringArt, { DrawOptions } from '../infra/StringArt';\nimport { Dimensions } from '../types/general.types';\nimport { RendererType } from '../types/stringart.types';\nimport viewOptions from './ViewOptions';\n\nexport default class Viewer extends EventBus<{\n  positionChange: { changeBy: number };\n  click: void;\n  touchStart: void;\n  touchEnd: void;\n}> {\n  element: HTMLElement;\n  renderer: Renderer | null;\n  pattern: StringArt;\n  rendererType: RendererType;\n  cancelDraw: (() => void) | null;\n\n  constructor(rendererType: RendererType = 'canvas') {\n    super();\n\n    this.rendererType = rendererType;\n    this.element = document.querySelector('#canvas_panel');\n\n    this.element.addEventListener(\n      'wheel',\n      ({ deltaY }) => {\n        const direction = -deltaY / Math.abs(deltaY); // Up is 1, down is -1\n        this.emit('positionChange', { changeBy: direction });\n      },\n      { passive: true }\n    );\n\n    viewOptions.addEventListener(\n      'showInstructionsChange',\n      ({ showInstructions }) => {\n        this.#withRenderer();\n        if (showInstructions) {\n          this.renderer.showInstructions();\n        } else {\n          this.renderer.hideInstructions();\n        }\n      }\n    );\n\n    routing.addEventListener('renderer', rendererType => {\n      this.rendererType = rendererType;\n      this.renderer = null;\n    });\n\n    // Cancelling this for the moment, as it creates problems on mobile, when doing back with gestures:\n    // this.#setTapEvents();\n  }\n\n  get position(): number {\n    return this.pattern?.position ?? -1;\n  }\n\n  get size(): Dimensions {\n    return [this.element.clientWidth, this.element.clientHeight];\n  }\n\n  setSize(size: Dimensions | null) {\n    this.#withRenderer();\n\n    if (size) {\n      if (!this.element.classList.contains('overflow')) {\n        this.element.classList.add('overflow');\n      }\n      this.renderer.setFixedSize(size);\n    } else {\n      this.element.classList.remove('overflow');\n      this.renderer.resetSize();\n    }\n  }\n\n  setRenderer(renderer: Renderer) {\n    this.renderer = renderer;\n\n    renderer.addEventListener('sizeChange', ({ size }) =>\n      this.#updateOnSizeChange(size)\n    );\n  }\n\n  setPattern(pattern: StringArt) {\n    this.pattern = pattern;\n    if (!pattern && this.renderer) {\n      this.renderer.clear();\n    }\n  }\n\n  #updateOnSizeChange(size: Dimensions) {\n    if (size[0] && size[1]) {\n      this.pattern?.draw(this.renderer, { sizeChanged: true, precision: 1 });\n    }\n  }\n\n  /**\n   * Sets up click and touch events for the viewer\n   */\n  #setTapEvents() {\n    let timeout: ReturnType<typeof setTimeout>;\n\n    this.element.addEventListener('pointerdown', () => {\n      this.emit('click', null);\n\n      const cancelTouch = () => {\n        clearTimeout(timeout);\n        this.element.removeEventListener('pointerup', cancelTouch);\n      };\n\n      timeout = setTimeout(() => {\n        this.element.removeEventListener('pointerup', cancelTouch);\n        this.emit('touchStart', null);\n        const end = () => {\n          this.emit('touchEnd', null);\n          this.element.removeEventListener('pointerup', end);\n        };\n        this.element.addEventListener('pointerup', end);\n      }, 200);\n\n      this.element.addEventListener('pointerup', cancelTouch);\n    });\n  }\n\n  update(options?: DrawOptions) {\n    viewOptions.showInstructions = false;\n    this.#withRenderer();\n    this.pattern?.draw(this.renderer, { ...options, precision: 1 });\n  }\n\n  goto(position: number) {\n    this.#withRenderer();\n    this.pattern.goto(this.renderer, position, {\n      showInstructions: viewOptions.showInstructions,\n    });\n  }\n\n  next(): { done: boolean } {\n    return { done: this.pattern.drawNext().done };\n  }\n\n  getStepCount(): number {\n    this.#withRenderer();\n    return this.pattern.getStepCount({ size: this.renderer.getSize() });\n  }\n\n  #withRenderer(): asserts this is { renderer: Renderer } {\n    if (!this.renderer) {\n      const RendererType =\n        this.rendererType === 'svg' ? SVGRenderer : CanvasRenderer;\n      this.setRenderer(new RendererType(this.element));\n    }\n  }\n}\n","import EventBus from './helpers/EventBus';\nimport { findPatternById } from './helpers/pattern_utils';\nimport {\n  getPatternURL,\n  getQueryParams,\n  StringArtQueryParams,\n} from './helpers/url_utils';\nimport StringArt from './infra/StringArt';\nimport { deserializeConfig, serializeConfig } from './Serialize';\nimport { PrimitiveValue } from './types/config.types';\nimport { RendererType } from './types/stringart.types';\n\nexport interface PatternRoute<TConfig = Record<string, PrimitiveValue>> {\n  pattern: StringArt<TConfig>;\n  config?: TConfig;\n  renderer?: RendererType;\n}\n\nclass Routing extends EventBus<{\n  pattern: PatternRoute;\n  main: void;\n  renderer: RendererType;\n}> {\n  #popStateListener: (this: Window, ev: PopStateEvent) => any;\n  #currentRenderer: RendererType = 'canvas';\n\n  constructor() {\n    super();\n\n    const onPopState = (this.#popStateListener = ({\n      state,\n    }: {\n      state: StringArtQueryParams;\n    }) => {\n      this.#updateFromState(state ?? {});\n    });\n\n    window.addEventListener('popstate', onPopState);\n  }\n\n  #updateFromState(state: StringArtQueryParams) {\n    const {\n      pattern: patternId,\n      name: patternName,\n      config,\n      renderer = 'canvas',\n    } = state;\n\n    const actualRenderer = renderer === 'svg' ? 'svg' : 'canvas';\n    if (actualRenderer !== this.#currentRenderer) {\n      this.#currentRenderer = actualRenderer;\n      this.emit('renderer', actualRenderer);\n    }\n\n    if (patternId) {\n      const pattern = findPatternById(patternId);\n\n      if (pattern) {\n        if (patternName) {\n          pattern.name = patternName;\n        }\n\n        if (config) {\n          // @ts-ignore\n          pattern.setConfig(deserializeConfig(pattern, config));\n        }\n        this.emit('pattern', {\n          pattern,\n          renderer: actualRenderer,\n        });\n      } else {\n        throw new Error(`Unknown pattern with ID \"${patternId}\".`);\n      }\n    } else {\n      this.emit('main', null);\n    }\n  }\n\n  init() {\n    if (history.state?.patternId) {\n      this.#updateFromState(history.state);\n    } else {\n      const queryParams = getQueryParams();\n      this.#updateFromState(queryParams);\n    }\n  }\n\n  destroy() {\n    window.removeEventListener('popstate', this.#popStateListener);\n  }\n\n  navigateToMain() {\n    history.pushState({ patternId: null }, 'String Art Studio', './');\n    this.emit('main', null);\n  }\n\n  navigateToPattern(\n    pattern: StringArt,\n    {\n      renderer = 'canvas',\n      replaceState = false,\n    }: { renderer?: RendererType; replaceState?: boolean } = {}\n  ) {\n    const configQuery = pattern.isDefaultConfig\n      ? undefined\n      : serializeConfig(pattern);\n    const setHistoryState = (\n      replaceState ? history.replaceState : history.pushState\n    ).bind(history);\n\n    setHistoryState(\n      {\n        pattern: pattern.id,\n        config: configQuery,\n        renderer,\n        name: pattern.name,\n      },\n      pattern.name,\n      getPatternURL(pattern, {\n        renderer,\n        patternAsTemplate: false,\n      })\n    );\n\n    if (!replaceState) {\n      this.emit('pattern', { pattern, renderer });\n    }\n  }\n}\n\nconst routing = new Routing();\nexport default routing;\n","import DimensionsInput from './components/inputs/DimensionsInput';\nimport { fitInside, prettifyLength } from './helpers/size_utils';\nimport { MeasureRenderer } from './infra/renderers/MeasureRenderer';\nimport StringArt from './infra/StringArt';\nimport { Dimensions } from './types/general.types';\nimport { PatternInfo } from './types/info.types';\n\nconst DEFAULT_TARGET_SIZE_CM: Dimensions = [30, 30];\nconst DEFAULT_SIZES_CM = [20, 30, 40, 50, 60, 70, 80, 90, 100];\n\nlet controller: TaskController;\n\nclass Info {\n  elements: {\n    infoPanel: HTMLDivElement;\n    nailsCount: HTMLSpanElement;\n    threadsTotalLength: HTMLSpanElement;\n    threadsPerColor: HTMLDivElement;\n    closestDistanceBetweenNails: HTMLDataElement;\n    dimensions: DimensionsInput;\n    dimensionsSelect: HTMLSelectElement;\n  };\n\n  targetSizeCm: Dimensions = DEFAULT_TARGET_SIZE_CM;\n  pattern: StringArt;\n  lastSize: Dimensions;\n  patternMargin: number;\n  patternNailRadius: number;\n\n  constructor() {\n    this.elements = {\n      infoPanel: document.querySelector('#info_panel'),\n      nailsCount: document.querySelector('#nails_count'),\n      threadsTotalLength: document.querySelector('#threads_total_length'),\n      threadsPerColor: document.querySelector('#threads_per_color'),\n      closestDistanceBetweenNails: document.querySelector(\n        '#closest_distance_between_nails'\n      ),\n      dimensions: document.querySelector('#info_dimensions'),\n      dimensionsSelect: document.querySelector('#info_dimensions_select'),\n    };\n\n    this.elements.dimensions.addEventListener(\n      'dimensionchange',\n      ({\n        detail: { value: dimensions },\n      }: CustomEvent<{\n        value: Dimensions;\n      }>) => {\n        this.targetSizeCm = dimensions;\n        if (this.pattern) {\n          this.update();\n        }\n      }\n    );\n\n    this.elements.dimensionsSelect.addEventListener('change', e => {\n      const value = Number(this.elements.dimensionsSelect.value);\n      this.targetSizeCm = [value, value];\n      this.update();\n    });\n  }\n\n  #setAvailableDimensions() {\n    const aspectRatio = this.pattern.getAspectRatio({ size: [100, 100] });\n    const sizes = DEFAULT_SIZES_CM.map(v =>\n      aspectRatio >= 1\n        ? [v, Math.round(v / aspectRatio)]\n        : [Math.round(v * aspectRatio), v]\n    );\n    this.elements.dimensionsSelect.innerHTML = sizes\n      .map(\n        (size, i) =>\n          `<option value=\"${DEFAULT_SIZES_CM[i]}\">${size.join('x')} cm`\n      )\n      .join('\\n');\n\n    this.elements.dimensionsSelect.value = this.targetSizeCm[0].toString();\n  }\n\n  setPattern(pattern: StringArt, size: Dimensions) {\n    this.pattern = pattern.copy();\n    this.lastSize = size;\n    this.patternMargin = pattern.config.margin;\n    this.patternNailRadius = pattern.config.nailRadius;\n    this.update();\n    this.#setAvailableDimensions();\n  }\n\n  async update() {\n    if (!this.pattern) {\n      throw new Error(\"Can't update info - no pattern.\");\n    }\n\n    controller?.abort();\n\n    const fittedSize = fitInside(this.lastSize, this.targetSizeCm);\n    const sizeRatio = Math.min(\n      fittedSize[0] / this.lastSize[0],\n      fittedSize[1] / this.lastSize[1]\n    );\n\n    this.pattern.assignConfig({\n      margin: this.patternMargin * sizeRatio,\n      nailRadius: this.patternNailRadius * sizeRatio,\n    });\n\n    this.elements.dimensions.value = this.targetSizeCm;\n\n    controller = new TaskController({ priority: 'background' });\n\n    const { nailsCount, threadsLength, closestDistanceBetweenNails } =\n      await scheduler.postTask(() => this.getInfo(this.targetSizeCm), {\n        signal: controller.signal,\n      });\n\n    this.elements.nailsCount.textContent = nailsCount.toLocaleString();\n    this.elements.threadsTotalLength.textContent = String(\n      this.#threadLengthToDistance(threadsLength.total)\n    );\n    this.elements.closestDistanceBetweenNails.textContent = String(\n      this.#threadLengthToDistance(closestDistanceBetweenNails)\n    );\n    this.elements.threadsPerColor.innerHTML = '';\n\n    const maxColorLength = Math.max(\n      ...threadsLength.perColor.map(({ length }) => length)\n    );\n\n    [...threadsLength.perColor]\n      .sort((a, b) => b.length - a.length)\n      .forEach(({ color, length }) => {\n        const colorEl = document.createElement('li');\n        const colorValueEl = document.createElement('div');\n        colorEl.appendChild(colorValueEl);\n        colorValueEl.style.background = color;\n        colorValueEl.className = 'info__thread_color_value';\n        colorValueEl.style.width = `max(calc(${\n          (100 * length) / maxColorLength\n        }% - 70px), 6px)`;\n\n        const colorValueDisplay = document.createElement('span');\n        colorValueDisplay.innerText = this.#threadLengthToDistance(length);\n        colorValueDisplay.className = 'info__thread_color_value_text';\n        colorEl.appendChild(colorValueDisplay);\n        this.elements.threadsPerColor.appendChild(colorEl);\n      });\n  }\n\n  /**\n   *\n   * @param length Converts a pixel length unit to physical distance units\n   */\n  #threadLengthToDistance(length: number, ratio = 1): string {\n    return prettifyLength(length * ratio, 'cm');\n  }\n\n  getInfo(size: Dimensions): PatternInfo {\n    const renderer = new MeasureRenderer(size);\n    this.pattern.draw(renderer, {\n      sizeChanged: true,\n      redrawStrings: true,\n      redrawNails: true,\n    });\n    return renderer.getInfo();\n  }\n}\n\nconst info = new Info();\nexport default info;\n","!function(){var t=[\"user-blocking\",\"user-visible\",\"background\"];class i{constructor(){this.t=new MessageChannel,this.i=this.t.port2,this.l={},this.o=1,this.t.port1.onmessage=t=>this.h(t)}u(t){var i=this.o++;return this.l[i]=t,this.i.postMessage(i),i}p(t){delete this.l[t]}h(t){var i=t.data;if(i in this.l){var r=this.l[i];delete this.l[i],r()}}}function r(){return r.v||(r.v=new i),r.v}class s{constructor(t,i,r){void 0===r&&(r=0),this.k=t,this.T=null,this.C=null,this.m=!1,this._(i,r)}isIdleCallback(){return 0===this.T}I(){return 2===this.T}cancel(){if(!this.m)switch(this.m=!0,this.T){case 0:cancelIdleCallback(this.C);break;case 1:clearTimeout(this.C);break;case 2:r().p(this.C);break;default:throw new TypeError(\"Unknown CallbackType\")}}_(i,s){if(s&&s>0)return this.T=1,void(this.C=setTimeout(()=>{this.P()},s));if(!t.includes(i))throw new TypeError(\"Invalid task priority : \"+i);return\"background\"===i&&\"function\"==typeof requestIdleCallback?(this.T=0,void(this.C=requestIdleCallback(()=>{this.P()}))):\"function\"==typeof MessageChannel?(this.T=2,void(this.C=r().u(()=>{this.P()}))):(this.T=1,void(this.C=setTimeout(()=>{this.P()})))}P(){this.m||this.k()}}var e=0;class n{constructor(){this.j=null,this.M=null}isEmpty(){return null==this.j}push(t){if(\"object\"!=typeof t)throw new TypeError(\"Task must be an Object\");t.A=e++,this.isEmpty()?(t.N=null,this.j=t):(t.N=this.M,this.M.O=t),t.O=null,this.M=t}takeNextTask(){if(this.isEmpty())return null;var t=this.j;return this.q(t),t}merge(t,i){if(\"function\"!=typeof i)throw new TypeError(\"Must provide a selector function.\");if(null==t)throw new Error(\"sourceQueue cannot be null\");for(var r=this.j,s=null,e=t.j;e;){var n=e;if(e=e.O,i(n)){for(t.q(n);r&&r.A<n.A;)s=r,r=r.O;this.D(n,s),s=n}}}D(t,i){if(i!=this.M){var r=i?i.O:this.j;t.O=r,r.N=t,t.N=i,null!=i?i.O=t:this.j=t}else this.push(t)}q(t){if(null==t)throw new Error(\"Expected task to be non-null\");t===this.j&&(this.j=t.O),t===this.M&&(this.M=this.M.N),t.O&&(t.O.N=t.N),t.N&&(t.N.O=t.O)}}class l extends Event{constructor(i,r){if(!r||!t.includes(r.previousPriority))throw new TypeError(\"Invalid task priority: '\"+r.previousPriority+\"'\");super(i),this.previousPriority=r.previousPriority}}class o extends AbortController{constructor(i){if(void 0===i&&(i={}),super(),null==i&&(i={}),\"object\"!=typeof i)throw new TypeError(\"'init' is not an object\");var r,s,e=void 0===i.priority?\"user-visible\":i.priority;if(!t.includes(e))throw new TypeError(\"Invalid task priority: '\"+e+\"'\");this.H=e,this.R=!1,s=(r=this).signal,Object.defineProperties(s,{priority:{get:function(){return r.H},enumerable:!0},onprioritychange:{value:null,writable:!0,enumerable:!0}}),s.addEventListener(\"prioritychange\",t=>{s.onprioritychange&&s.onprioritychange(t)})}setPriority(i){if(!t.includes(i))throw new TypeError(\"Invalid task priority: \"+i);if(this.R)throw new DOMException(\"\",\"NotAllowedError\");if(this.signal.priority!==i){this.R=!0;var r=this.H;this.H=i;var s=new l(\"prioritychange\",{previousPriority:r});this.signal.dispatchEvent(s),this.R=!1}}}void 0===self.scheduler?(self.scheduler=new class{constructor(){this.S={},t.forEach(t=>{this.S[t]=[new n,new n]}),this.U=null,this.W=new WeakMap}yield(){return this.B(()=>{},{priority:\"user-visible\"},!0)}postTask(t,i){return this.B(t,i,!1)}B(i,r,s){if(void 0!==(r=Object.assign({},r)).signal){if(null===r.signal||!(\"aborted\"in r.signal)||\"function\"!=typeof r.signal.addEventListener)return Promise.reject(new TypeError(\"'signal' is not a valid 'AbortSignal'\"));if(r.signal&&r.signal.priority&&!t.includes(r.signal.priority))return Promise.reject(new TypeError(\"Invalid task priority: '\"+r.signal.priority+\"'\"))}if(void 0!==r.priority&&(null===r.priority||!t.includes(r.priority)))return Promise.reject(new TypeError(\"Invalid task priority: '\"+r.priority+\"'\"));if(void 0===r.delay&&(r.delay=0),r.delay=Number(r.delay),r.delay<0)return Promise.reject(new TypeError(\"'delay' must be a positive number.\"));var e={callback:i,options:r,resolve:null,reject:null,hostCallback:null,abortCallback:null,onTaskCompleted:function(){this.options.signal&&this.abortCallback&&(this.options.signal.removeEventListener(\"abort\",this.abortCallback),this.abortCallback=null)},onTaskAborted:function(){this.hostCallback&&(this.hostCallback.cancel(),this.hostCallback=null),this.options.signal.removeEventListener(\"abort\",this.abortCallback),this.abortCallback=null,this.reject(this.options.signal.reason)},isAborted:function(){return this.options.signal&&this.options.signal.aborted},isContinuation:s},n=new Promise((t,i)=>{e.resolve=t,e.reject=i});return this._(e),n}_(t){var i=t.options.signal;if(i){if(i.aborted)return void t.reject(i.reason);t.abortCallback=()=>{t.onTaskAborted()},i.addEventListener(\"abort\",t.abortCallback)}t.options.delay>0?t.hostCallback=new s(()=>{t.hostCallback=null,this.F(t)},null,t.options.delay):(this.G(t),this.J())}F(t){this.G(t),this.U&&(this.U.cancel(),this.U=null),this.K()}L(t){var i=this.W.get(t);if(void 0===i)throw new Error(\"Attempting to change priority on an unregistered signal\");if(i!==t.priority){for(var r=0;r<2;r++)this.S[t.priority][r].merge(this.S[i][r],i=>i.options.signal===t);this.W.set(t,t.priority)}}K(){this.U=null,this.V(),this.J()}J(){var{priority:t}=this.X();null!=t&&(\"background\"!==t&&this.U&&this.U.isIdleCallback()&&(this.U.cancel(),this.U=null),this.U||(this.U=new s(()=>{this.K()},t,0)))}G(i){var r;if(!t.includes(r=i.options.priority?i.options.priority:i.options.signal&&i.options.signal.priority?i.options.signal.priority:\"user-visible\"))throw new TypeError(\"Invalid task priority: \"+r);if(i.options.signal&&i.options.signal.priority){var s=i.options.signal;this.W.has(s)||(s.addEventListener(\"prioritychange\",()=>{this.L(s)}),this.W.set(s,s.priority))}this.S[r][i.isContinuation?0:1].push(i)}V(){var t=null;do{var{priority:i,type:r}=this.X();if(null==i)return;t=this.S[i][r].takeNextTask()}while(t.isAborted());try{var s=t.callback();t.resolve(s)}catch(i){t.reject(i)}finally{t.onTaskCompleted()}}X(){for(var i=0;i<t.length;i++)for(var r=t[i],s=0;s<2;s++)if(!this.S[r][s].isEmpty())return{priority:r,type:s};return{priority:null,type:0}}},self.TaskController=o,self.TaskPriorityChangeEvent=l):self.scheduler.yield||(self.scheduler.yield=function(){return self.scheduler.postTask(()=>{},{priority:\"user-blocking\"})})}();\n//# sourceMappingURL=scheduler-polyfill.js.map\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * The list of scheduler priorities in order from highest to lowest.\n * @const {!Array<string>}\n */\nconst SCHEDULER_PRIORITIES = ['user-blocking', 'user-visible', 'background'];\n\nexport {SCHEDULER_PRIORITIES};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {SCHEDULER_PRIORITIES} from './scheduler-priorities.js';\n\n/**\n * This class manages scheduling and running callbacks using postMessage.\n * @private\n */\nclass PostMessageCallbackMananger {\n  /**\n   * Construct a PostMessageCallbackMananger, which handles scheduling\n   * and running callbacks via a MessageChannel.\n   */\n  constructor() {\n    /**\n     * @private\n     * @const {!MessageChannel}\n     */\n    this.channel_ = new MessageChannel();\n\n    /**\n     * @private\n     * @const {MessagePort}\n     */\n    this.sendPort_ = this.channel_.port2;\n\n    /**\n     * @private\n     * @const {!Object<number, function(): undefined>}\n     */\n    this.messages_ = {};\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.nextMessageHandle_ = 1;\n\n    this.channel_.port1.onmessage = (e) => this.onMessageReceived_(e);\n  }\n\n  /**\n   * @param {function(): undefined} callback\n   * @return {number} A handle that can used for cancellation.\n   */\n  queueCallback_(callback) {\n    // We support multiple pending postMessage callbacks by associating a handle\n    // with each message, which is used to look up the callback when the message\n    // is received.\n    const handle = this.nextMessageHandle_++;\n    this.messages_[handle] = callback;\n    this.sendPort_.postMessage(handle);\n    return handle;\n  }\n\n  /**\n   * @param {number} handle The handle returned when the callback was queued.\n   */\n  cancelCallback_(handle) {\n    delete this.messages_[handle];\n  }\n\n  /**\n   * The onmessage handler, invoked when the postMessage runs.\n   * @private\n   * @param {!Event} e\n   */\n  onMessageReceived_(e) {\n    const handle = e.data;\n    // The handle will have been removed if the callback was canceled.\n    if (!(handle in this.messages_)) return;\n    const callback = this.messages_[handle];\n    delete this.messages_[handle];\n    callback();\n  }\n}\n\n/**\n * Get the lazily initialized instance of PostMessageCallbackMananger, which\n * is initialized that way to avoid errors if MessageChannel is not available.\n *\n * @return {!PostMessageCallbackMananger}\n */\nfunction getPostMessageCallbackManager() {\n  if (!getPostMessageCallbackManager.instance_) {\n    getPostMessageCallbackManager.instance_ = new PostMessageCallbackMananger();\n  }\n  return getPostMessageCallbackManager.instance_;\n}\n\n/** @enum {number} */\nconst CallbackType = {\n  REQUEST_IDLE_CALLBACK: 0,\n  SET_TIMEOUT: 1,\n  POST_MESSAGE: 2,\n};\n\n/**\n * HostCallback is used for tracking host callbacks, both for the schedueler\n * entrypoint --- which can be a postMessage, setTimeout, or\n * requestIdleCallback --- and for delayed tasks.\n */\nclass HostCallback {\n  /**\n   * @param {function(): undefined} callback\n   * @param {?string} priority The scheduler priority of the associated host\n   *     callback. This is used to determine which type of underlying API to\n   *     use. This can be null if delay is set.\n   * @param {number} delay An optional delay. Tasks with a delay will\n   *     ignore the `priority` parameter and use setTimeout.\n   */\n  constructor(callback, priority, delay = 0) {\n    /** @const {function(): undefined} */\n    this.callback_ = callback;\n\n    /**\n     * @private\n     * @type {CallbackType}\n     */\n    this.callbackType_ = null;\n\n    /**\n     * Handle for cancellation, which is set when the callback is scheduled.\n     * @private\n     * @type {?number}\n     */\n    this.handle_ = null;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.canceled_ = false;\n\n    this.schedule_(priority, delay);\n  }\n\n  /**\n   * Returns true iff this task was scheduled with requestIdleCallback.\n   * @return {boolean}\n   */\n  isIdleCallback() {\n    return this.callbackType_ === CallbackType.REQUEST_IDLE_CALLBACK;\n  }\n\n  /**\n   * Returns true iff this task was scheduled with MessageChannel.\n   * @return {boolean}\n   */\n  isMessageChannelCallback_() {\n    return this.callbackType_ === CallbackType.POST_MESSAGE;\n  }\n\n  /**\n   * Cancel the host callback, and if possible, cancel the underlying API call.\n   */\n  cancel() {\n    if (this.canceled_) return;\n    this.canceled_ = true;\n\n    switch (this.callbackType_) {\n      case CallbackType.REQUEST_IDLE_CALLBACK:\n        cancelIdleCallback(this.handle_);\n        break;\n      case CallbackType.SET_TIMEOUT:\n        clearTimeout(this.handle_);\n        break;\n      case CallbackType.POST_MESSAGE:\n        getPostMessageCallbackManager().cancelCallback_(this.handle_);\n        break;\n      default:\n        throw new TypeError('Unknown CallbackType');\n    }\n  }\n\n  /**\n   * @private\n   * @param {?string} priority The scheduler priority of the associated host\n   *     callback. This is used to determine which type of underlying API to\n   *     use. This can be null if delay is set.\n   * @param {number} delay An optional delay. Tasks with a delay will\n   *     ignore the `priority` parameter and use setTimeout.\n   */\n  schedule_(priority, delay) {\n    // For the delay case, our only option is setTimeout. This gets queued at\n    // the appropriate priority when the callback runs. If the delay <= 0 and\n    // MessageChannel is available, we use postMessage below.\n    if (delay && delay > 0) {\n      this.callbackType_ = CallbackType.SET_TIMEOUT;\n      this.handle_ = setTimeout(() => {\n        this.runCallback_();\n      }, delay);\n      return;\n    }\n\n    // This shouldn't happen since Scheduler checks the priority before creating\n    // a HostCallback, but fail loudly in case it does.\n    if (!SCHEDULER_PRIORITIES.includes(priority)) {\n      throw new TypeError(`Invalid task priority : ${priority}`);\n    }\n\n    if (priority === 'background' &&\n        typeof requestIdleCallback === 'function') {\n      this.callbackType_ = CallbackType.REQUEST_IDLE_CALLBACK;\n      this.handle_ = requestIdleCallback(() => {\n        this.runCallback_();\n      });\n      return;\n    }\n\n    // Use MessageChannel if avaliable.\n    if (typeof MessageChannel === 'function') {\n      this.callbackType_ = CallbackType.POST_MESSAGE;\n      // TODO: Consider using setTimeout in the background so tasks are\n      // throttled. One caveat here is that requestIdleCallback may not be\n      // throttled.\n      this.handle_ = getPostMessageCallbackManager().queueCallback_(() => {\n        this.runCallback_();\n      });\n      return;\n    }\n\n    // Some JS environments may not support MessageChannel.\n    // This makes setTimeout the only option.\n    this.callbackType_ = CallbackType.SET_TIMEOUT;\n    this.handle_ = setTimeout(() => {\n      this.runCallback_();\n    });\n  }\n\n  /** Run the associated callback. */\n  runCallback_() {\n    if (this.canceled_) return;\n    this.callback_();\n  }\n}\n\nexport {HostCallback};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * This represents the overall task queuing order and is used for moving tasks\n * between task queues for priority changes.\n * @private\n * @type {number}\n */\nlet nextSequence = 0;\n\n/**\n * An implementation of a task queue that augments the data being stored with\n * pointers to the previous and next entries. Storing the pointers on the data\n * reduces the number of objects created, cutting down on object churn.\n *\n * This task queue is implemented as a doubly-linked list, optimizing for\n * queueing and dequeing, as well as performant merges for priority change.\n *\n * This adds the following properties to tasks it owns:\n *  - tq_sequence_: The overall queueing order.\n *  - tq_prev_: A pointer to the previous task.\n *  - tq_next_: A pointer to the next task.\n */\nclass IntrusiveTaskQueue {\n  /**\n   * Constructs an empty IntrusiveTaskQueue.\n   */\n  constructor() {\n    /**\n     * @private\n     * @const {!Object}\n     */\n    this.head_ = null;\n\n    /**\n     * @private\n     * @const {!Object}\n     */\n    this.tail_ = null;\n  }\n\n  /** @return {boolean} */\n  isEmpty() {\n    return this.head_ == null;\n  }\n\n  /** @param {!Object} task */\n  push(task) {\n    if (typeof task !== 'object') throw new TypeError('Task must be an Object');\n\n    task.tq_sequence_ = nextSequence++;\n\n    if (this.isEmpty()) {\n      task.tq_prev_ = null;\n      this.head_ = task;\n    } else {\n      task.tq_prev_ = this.tail_;\n      this.tail_.tq_next_ = task;\n    }\n\n    task.tq_next_ = null;\n    this.tail_ = task;\n  }\n\n  /** @return {?Object} The oldest task or null of the queue is empty. */\n  takeNextTask() {\n    if (this.isEmpty()) return null;\n    const task = this.head_;\n    this.remove_(task);\n    return task;\n  }\n\n  /**\n   * Merges all tasks from `sourceQueue` into this task queue for which\n   * `selector` returns true . Tasks are insterted into this queue based on\n   * their sequence number.\n   *\n   * @param {!IntrusiveTaskQueue} sourceQueue\n   * @param {function(!Object): boolean} selector\n   */\n  merge(sourceQueue, selector) {\n    if (typeof selector !== 'function') {\n      throw new TypeError('Must provide a selector function.');\n    }\n    if (sourceQueue == null) throw new Error('sourceQueue cannot be null');\n\n    let currentTask = this.head_;\n    let previousTask = null;\n    let iterator = sourceQueue.head_;\n\n    while (iterator) {\n      // Advance the iterator now before we mutate it and ivalidate the\n      // pointers.\n      const taskToMove = iterator;\n      iterator = iterator.tq_next_;\n\n      if (selector(taskToMove)) {\n        sourceQueue.remove_(taskToMove);\n        // Fast-forward until we're just past the insertion point. The new task\n        // is inserted between previousTask and currentTask.\n        while (currentTask &&\n               (currentTask.tq_sequence_ < taskToMove.tq_sequence_)) {\n          previousTask = currentTask;\n          currentTask = currentTask.tq_next_;\n        }\n        this.insert_(taskToMove, previousTask);\n        previousTask = taskToMove;\n      }\n    }\n  }\n\n  /**\n   * Insert `task` into this queue directly after `parentTask`.\n   * @private\n   * @param {!Object} task The task to insert.\n   * @param {?Object} parentTask The task preceding `task` in this queue, or\n   *    null if `task` should be inserted at the beginning.\n   */\n  insert_(task, parentTask) {\n    // We can simply push the new task if it belongs at the end.\n    if (parentTask == this.tail_) {\n      this.push(task);\n      return;\n    }\n\n    // `nextTask` is the next task in the list, which should not be null since\n    // `parentTask` is not the tail (which is the only task with a null next\n    // pointer).\n    const nextTask = parentTask ? parentTask.tq_next_ : this.head_;\n\n    task.tq_next_ = nextTask;\n    nextTask.tq_prev_ = task;\n\n    task.tq_prev_ = parentTask;\n\n    if (parentTask != null) {\n      parentTask.tq_next_ = task;\n    } else {\n      this.head_ = task;\n    }\n  }\n\n  /**\n   * @private\n   * @param {!Object} task\n   */\n  remove_(task) {\n    if (task == null) throw new Error('Expected task to be non-null');\n    if (task === this.head_) this.head_ = task.tq_next_;\n    if (task === this.tail_) this.tail_ = this.tail_.tq_prev_;\n    if (task.tq_next_) task.tq_next_.tq_prev_ = task.tq_prev_;\n    if (task.tq_prev_) task.tq_prev_.tq_next_ = task.tq_next_;\n  }\n}\n\n/**\n * Returns an array containing the elements of this task queue in order. This\n * is meant to be used for debugging and might be removed.\n *\n * @param {IntrusiveTaskQueue} queue\n * @return {!Array<!Object>}\n */\nfunction toArray(queue) {\n  let node = queue.head_;\n  const a = [];\n  while (node !== null) {\n    a.push(node);\n    node = node.tq_next_;\n  }\n  return a;\n}\n\nexport {IntrusiveTaskQueue, toArray};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {SCHEDULER_PRIORITIES} from './scheduler-priorities.js';\n\n/**\n * Makes the controller's signal a TaskSignal by adding a read-only priority\n * property.\n * @private\n * @param {TaskController} controller\n */\nfunction makeTaskSignal(controller) {\n  const signal = controller.signal;\n  Object.defineProperties(signal, {\n    priority: {\n      get: function() {\n        return controller.priority_;\n      },\n      enumerable: true,\n    },\n    onprioritychange: {\n      value: null,\n      writable: true,\n      enumerable: true,\n    },\n  });\n  signal.addEventListener('prioritychange', (e) => {\n    if (signal.onprioritychange) {\n      signal.onprioritychange(e);\n    }\n  });\n}\n\n/**\n * Event type used for priority change events:\n * https://wicg.github.io/scheduling-apis/#sec-task-priority-change-event.\n */\nclass TaskPriorityChangeEvent extends Event {\n  /**\n   * Constructs a TaskPriorityChangeEvent. Events of this type are typically\n   * named 'prioritychange', which is the name used for events triggered by\n   * TaskController.setPriority().\n   *\n   * @param {?string} typeArg\n   * @param {{previousPriority: string}} init\n   */\n  constructor(typeArg, init) {\n    if (!init || !SCHEDULER_PRIORITIES.includes(init.previousPriority)) {\n      throw new TypeError(`Invalid task priority: '${init.previousPriority}'`);\n    }\n    super(typeArg);\n    this.previousPriority = init.previousPriority;\n  }\n}\n\n/**\n * TaskController enables changing the priority of tasks associated with its\n * TaskSignal.\n *\n * Unfortunately, we can't implement TaskSignal by extending AbortSignal because\n * we can't call its constructor. We can't implement a separate TaskSignal class\n * because we need the inheritance so that TaskSignals can be passed to other\n * APIs. We therefore modify the TaskController's underlying AbortSignal, adding\n * the priority property.\n */\nclass TaskController extends AbortController {\n  /**\n   * @param {{priority: string}} init\n   */\n  constructor(init = {}) {\n    super();\n\n    if (init == null) init = {};\n    if (typeof init !== 'object') {\n      throw new TypeError(`'init' is not an object`);\n    }\n\n    const priority =\n        init.priority === undefined ? 'user-visible' : init.priority;\n    if (!SCHEDULER_PRIORITIES.includes(priority)) {\n      throw new TypeError(`Invalid task priority: '${priority}'`);\n    }\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.priority_ = priority;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.isPriorityChanging_ = false;\n\n    makeTaskSignal(this);\n  }\n\n  /**\n   * Change the priority of all tasks associated with this controller's signal.\n   * @param {string} priority\n   */\n  setPriority(priority) {\n    if (!SCHEDULER_PRIORITIES.includes(priority)) {\n      throw new TypeError('Invalid task priority: ' + priority);\n    }\n    if (this.isPriorityChanging_) throw new DOMException('', 'NotAllowedError');\n    if (this.signal.priority === priority) return;\n\n    this.isPriorityChanging_ = true;\n\n    const previousPriority = this.priority_;\n    this.priority_ = priority;\n\n    const e = new TaskPriorityChangeEvent('prioritychange', {previousPriority});\n    this.signal.dispatchEvent(e);\n\n    this.isPriorityChanging_ = false;\n  }\n}\n\nexport {TaskController, TaskPriorityChangeEvent};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Scheduler} from './scheduler.js';\nimport {TaskController, TaskPriorityChangeEvent} from './task-controller.js';\nimport {schedulerYield} from './yield.js';\n\nif (typeof self.scheduler === 'undefined') {\n  self.scheduler = new Scheduler();\n  self.TaskController = TaskController;\n  self.TaskPriorityChangeEvent = TaskPriorityChangeEvent;\n} else if (!self.scheduler.yield) {\n  self.scheduler.yield = schedulerYield;\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {HostCallback} from './host-callback.js';\nimport {IntrusiveTaskQueue as TaskQueue} from './intrusive-task-queue.js';\nimport {SCHEDULER_PRIORITIES} from './scheduler-priorities.js';\n\n/**\n * Polyfill of the scheduler API: https://wicg.github.io/scheduling-apis/.\n */\nclass Scheduler {\n  /**\n   * Constructs a Scheduler object. There should only be one Scheduler per page\n   * since tasks are only run in priority order within a particular scheduler.\n   */\n  constructor() {\n    /**\n     * @const {Object<string, !TaskQueue[]>}\n     *\n     * Continuation and task queue for each priority, in that order.\n     */\n    this.queues_ = {};\n    SCHEDULER_PRIORITIES.forEach((priority) => {\n      this.queues_[priority] = [new TaskQueue(), new TaskQueue()];\n    });\n\n    /*\n     * We only schedule a single host callback, which can be a setTimeout,\n     * requestIdleCallback, or postMessage, which will run the oldest, highest\n     * priority task.\n     *\n     * TODO(shaseley): consider an option for supporting multiple outstanding\n     * callbacks, which more closely matches the current Chromium\n     * implementation.\n     *\n     * @private\n     * @type {?HostCallback}\n     */\n    this.pendingHostCallback_ = null;\n\n    /**\n     * This keeps track of signals we know about for priority changes. The\n     * entries are (key = signal, value = current priority). When we encounter\n     * a new TaskSignal (an AbortSignal with a priority property), we listen for\n     * priority changes so we can move tasks between queues accordingly.\n     * @const {!WeakMap<!AbortSignal, string>}\n     */\n    this.signals_ = new WeakMap();\n  }\n\n  /**\n   * Returns a promise that is resolved in a new task.\n   *\n   * @return {!Promise<*>}\n   */\n  yield() {\n    // Inheritance is not supported. Use default options instead.\n    return this.postTaskOrContinuation_(\n        () => {}, {priority: 'user-visible'}, true);\n  }\n\n  /**\n   * Schedules `callback` to be run asynchronously, returning a promise that is\n   * resolved with the callback's result when it finishes running. The resulting\n   * promise is rejected if the callback throws an exception, or if the\n   * associated signal is aborted.\n   *\n   * @param {function(): *} callback\n   * @param {{signal: AbortSignal, priorty: string, delay: number}} options\n   * @return {!Promise<*>}\n   */\n  postTask(callback, options) {\n    return this.postTaskOrContinuation_(callback, options, false);\n  }\n\n  /**\n   * Common scheduling logic for postTask and yield.\n   *\n   * @param {function(): *} callback\n   * @param {{signal: AbortSignal, priorty: string, delay: number}} options\n   * @param {boolean} isContinuation\n   * @return {!Promise<*>}\n   */\n  postTaskOrContinuation_(callback, options, isContinuation) {\n    // Make a copy since we modify some of the options.\n    options = Object.assign({}, options);\n\n    if (options.signal !== undefined) {\n      // Non-numeric options cannot be null for this API. Also make sure we can\n      // use this object as an AbortSignal.\n      if (options.signal === null || !('aborted' in options.signal) ||\n          typeof options.signal.addEventListener !== 'function') {\n        return Promise.reject(new TypeError(\n            `'signal' is not a valid 'AbortSignal'`));\n      }\n      // If this is a TaskSignal, make sure the priority is valid.\n      if (options.signal && options.signal.priority &&\n          !SCHEDULER_PRIORITIES.includes(options.signal.priority)) {\n        return Promise.reject(new TypeError(\n            `Invalid task priority: '${options.signal.priority}'`));\n      }\n    }\n\n    if (options.priority !== undefined) {\n      // Non-numeric options cannot be null for this API.\n      if (options.priority === null ||\n          !SCHEDULER_PRIORITIES.includes(options.priority)) {\n        return Promise.reject(new TypeError(\n            `Invalid task priority: '${options.priority}'`));\n      }\n    }\n\n    if (options.delay === undefined) options.delay = 0;\n    // Unlike setTimeout, postTask uses [EnforceRange] and rejects negative\n    // delay values. But it also converts non-numeric values to numbers. Since\n    // IDL and Number() both use the same underlying ECMAScript algorithm\n    // (ToNumber()), convert the value using Number(delay) and then check the\n    // range.\n    options.delay = Number(options.delay);\n    if (options.delay < 0) {\n      return Promise.reject(new TypeError(\n          `'delay' must be a positive number.`));\n    }\n\n    const task = {\n      callback,\n      options,\n\n      /** The resolve function from the associated Promise.  */\n      resolve: null,\n\n      /** The reject function from the associated Promise.  */\n      reject: null,\n\n      /** The pending HostCallback, which is set iff this is a delayed task. */\n      hostCallback: null,\n\n      /**\n       * The callback passed to the abort event listener, which calls\n       * `onAbort` and is bound to this task via an => function.\n       */\n      abortCallback: null,\n\n      onTaskCompleted: function() {\n        if (!this.options.signal || !this.abortCallback) return;\n        this.options.signal.removeEventListener('abort', this.abortCallback);\n        this.abortCallback = null;\n      },\n\n      onTaskAborted: function() {\n        // If this is a delayed task that hasn't expired yet, cancel the host\n        // callback.\n        if (this.hostCallback) {\n          this.hostCallback.cancel();\n          this.hostCallback = null;\n        }\n        this.options.signal.removeEventListener('abort', this.abortCallback);\n        this.abortCallback = null;\n        this.reject(this.options.signal.reason);\n      },\n\n      isAborted: function() {\n        return this.options.signal && this.options.signal.aborted;\n      },\n\n      isContinuation,\n    };\n\n    const resultPromise = new Promise((resolve, reject) => {\n      task.resolve = resolve;\n      task.reject = reject;\n    });\n\n    this.schedule_(task);\n\n    return resultPromise;\n  }\n\n  /**\n   * @private\n   * @param {!Object} task\n   */\n  schedule_(task) {\n    // Handle tasks that have already been aborted or might be aborted in the\n    // future.\n    const signal = task.options.signal;\n    if (signal) {\n      if (signal.aborted) {\n        task.reject(signal.reason);\n        return;\n      }\n\n      task.abortCallback = () => {\n        task.onTaskAborted();\n      };\n      signal.addEventListener('abort', task.abortCallback);\n    }\n\n    // Handle delayed tasks.\n    if (task.options.delay > 0) {\n      task.hostCallback = new HostCallback(() => {\n        task.hostCallback = null;\n        this.onTaskDelayExpired_(task);\n      }, null /* priority */, task.options.delay);\n      return;\n    }\n\n    this.pushTask_(task);\n    this.scheduleHostCallbackIfNeeded_();\n  }\n\n  /**\n   * Callback invoked when a delayed task's timeout expires.\n   * @private\n   * @param {!Object} task\n   */\n  onTaskDelayExpired_(task) {\n    // We need to queue the task in the appropriate queue, most importantly\n    // to ensure ordering guarantees.\n    this.pushTask_(task);\n\n    // We also use this as an entrypoint into the scheduler and run the\n    // next task, rather than waiting for the pending callback or scheduling\n    // another one.\n    if (this.pendingHostCallback_) {\n      this.pendingHostCallback_.cancel();\n      this.pendingHostCallback_ = null;\n    }\n    this.schedulerEntryCallback_();\n  }\n\n  /**\n   * Callback invoked when a priortychange event is raised for `signal`.\n   * @private\n   * @param {!AbortSignal} signal\n   */\n  onPriorityChange_(signal) {\n    const oldPriority = this.signals_.get(signal);\n    if (oldPriority === undefined) {\n      throw new Error(\n          'Attempting to change priority on an unregistered signal');\n    }\n    if (oldPriority === signal.priority) return;\n\n    // Change priority for both continuations and tasks.\n    for (let i = 0; i < 2; i++) {\n      const sourceQueue = this.queues_[oldPriority][i];\n      const destinationQueue = this.queues_[signal.priority][i];\n\n      destinationQueue.merge(sourceQueue, (task) => {\n        return task.options.signal === signal;\n      });\n    }\n\n    this.signals_.set(signal, signal.priority);\n  }\n\n  /**\n   * Callback invoked when the host callback fires.\n   * @private\n   */\n  schedulerEntryCallback_() {\n    this.pendingHostCallback_ = null;\n    this.runNextTask_();\n    this.scheduleHostCallbackIfNeeded_();\n  }\n\n  /**\n   * Schedule the next scheduler callback if there are any pending tasks.\n   */\n  scheduleHostCallbackIfNeeded_() {\n    const {priority} = this.nextTaskPriority_();\n    if (priority == null) return;\n\n    // We might need to upgrade to a non-idle callback if a higher priority task\n    // is scheduled, in which case we cancel the pending host callback and\n    // reschedule.\n    if (priority !== 'background' && this.pendingHostCallback_ &&\n        this.pendingHostCallback_.isIdleCallback()) {\n      this.pendingHostCallback_.cancel();\n      this.pendingHostCallback_ = null;\n    }\n\n    // Either the priority of the new task is compatible with the pending host\n    // callback, or it's a lower priorty (we handled the other case above). In\n    // either case, the pending callback is still valid.\n    if (this.pendingHostCallback_) return;\n\n    this.pendingHostCallback_ = new HostCallback(() => {\n      this.schedulerEntryCallback_();\n    }, priority, 0 /* delay */);\n  }\n\n  /**\n   * Compute the `task` priority and push it onto the appropriate task queue.\n   * If the priority comes from the associated signal, this will set up an event\n   * listener to listen for priority changes.\n   * @private\n   * @param {!Object} task\n   */\n  pushTask_(task) {\n    // If an explicit priority was provided, we use that. Otherwise if a\n    // TaskSignal was provided, we get the priority from that. If neither a\n    // priority or TaskSignal was provided, we default to 'user-visible'.\n    let priority;\n    if (task.options.priority) {\n      priority = task.options.priority;\n    } else if (task.options.signal && task.options.signal.priority) {\n      priority = task.options.signal.priority;\n    } else {\n      priority = 'user-visible';\n    }\n\n    // The priority should have already been validated before calling this\n    // method, but check the assumption and fail loudly if it doesn't hold.\n    if (!SCHEDULER_PRIORITIES.includes(priority)) {\n      throw new TypeError(`Invalid task priority: ${priority}`);\n    }\n\n    // Subscribe to priority change events if this is the first time we're\n    // learning about this signal.\n    if (task.options.signal && task.options.signal.priority) {\n      const signal = task.options.signal;\n      if (!this.signals_.has(signal)) {\n        signal.addEventListener('prioritychange', () => {\n          this.onPriorityChange_(signal);\n        });\n        this.signals_.set(signal, signal.priority);\n      }\n    }\n    this.queues_[priority][task.isContinuation ? 0 : 1].push(task);\n  }\n\n  /**\n   * Run the oldest highest priority non-aborted task, if there is one.\n   * @private\n   */\n  runNextTask_() {\n    let task = null;\n\n    // Aborted tasks aren't removed from the task queue, so we need to keep\n    // looping until we find a non-aborted task. Alternatively, we should\n    // consider just removing them from their queue.\n    do {\n      // TODO(shaseley): This can potentially run a background task in a\n      // non-background task host callback.\n      const {priority, type} = this.nextTaskPriority_();\n      // No tasks to run.\n      if (priority == null) return;\n\n      // Note: `task` will only be null if the queue is empty, which should not\n      // be the case if we found the priority of the next task to run.\n      task = this.queues_[priority][type].takeNextTask();\n    } while (task.isAborted());\n\n    try {\n      const result = task.callback();\n      task.resolve(result);\n    } catch (e) {\n      task.reject(e);\n    } finally {\n      task.onTaskCompleted();\n    }\n  }\n\n  /**\n   * Get the priority and type of the next task or continuation to run.\n   * @private\n   * @return {{priority: ?string, type: number}} Returns the priority and type\n   *    of the next continuation or task to run, or null if all queues are\n   *    empty.\n   */\n  nextTaskPriority_() {\n    for (let i = 0; i < SCHEDULER_PRIORITIES.length; i++) {\n      const priority = SCHEDULER_PRIORITIES[i];\n      for (let type = 0; type < 2; type++) {\n        if (!this.queues_[priority][type].isEmpty()) return {priority, type};\n      }\n    }\n    return {priority: null, type: 0};\n  }\n}\n\nexport {Scheduler};\n","/**\n * Copyright 2023 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview This version of scheduler.yield() is only used if\n * self.scheduler is defined. It assumes that this is the native implementation\n * (i.e. running in an older browser), and it uses scheduler.postTask() to\n * schedule continuations at 'user-blocking' priority.\n */\n\n/**\n * Returns a promise that is resolved in a new task. This schedules\n * continuations as 'user-blocking' scheduler.postTask() tasks.\n *\n * @return {!Promise<*>}\n */\nfunction schedulerYield() {\n  // Use 'user-blocking' priority to get similar scheduling behavior as\n  // scheduler.yield(). Note: we can't reliably inherit priority and abort since\n  // we lose context if async functions are spread across multiple tasks.\n  return self.scheduler.postTask(() => {}, {priority: 'user-blocking'});\n}\n\nexport {schedulerYield};\n"],"names":["$da037f8140467741$var$inputTimeout","$fc3e3d346052d3b6$var$controller","$00df09d341073864$export$2e2bcd8739ae039","addEventListener","event","handler","handlers","includes","push","handlerIndex","indexOf","splice","removeEventListener","index","emit","payload","forEach","$5082caf0e2beae35$var$viewOptions","instructionsMode","mode","showInstructions","$f003126099aabc1e$export$2e2bcd8739ae039","viewer","elements","stepCount","parentEl","player","step","querySelector","playerPosition","playBtn","pauseBtn","text","target","goto","value","play","restartIfAtEnd","pause","changeBy","advance","speed","updateStatus","isPlaying","classList","toggle","update","draw","setAttribute","String","innerText","style","removeProperty","width","clientWidth","updateStringArt","updatePosition","position","hideIntructionsTimeout","setTimeout","clearTimeout","Math","max","min","Number","setInstructions","instructions","isAtEnd","next","done","stepTimeout","stepRafId","requestAnimationFrame","cancelAnimationFrame","$2d2165ae7b4acbcd$exports","$4a7965eeea97d4bb$var$sheet","CSSStyleSheet","replaceSync","$4a7965eeea97d4bb$export$dbf21a0adc6a9ee0","HTMLElement","shadow","attachShadow","adoptedStyleSheets","shadowRoot","innerHTML","observedAttributes","connectedCallback","syncAttributes","attributeChangedCallback","hasAttribute","textContent","getAttribute","remove","add","open","close","customElements","define","$c743accf33ce06b6$exports","$3ce3bee09e11519c$var$sheet","$3ce3bee09e11519c$export$2e2bcd8739ae039","formAssociated","internals","disabled","delegatesFocus","attachInternals","checked","v","setFormValue","dispatchEvent","CustomEvent","detail","bubbles","tabIndex","focus","blur","$c6b5ffbe96e4aeb4$export$2e2bcd8739ae039","start","colorThumb","reverse","type","name","oldVal","newVal","parseInt","e","disconnectedCallback","background","thumbColor","$01dabe55fddff864$var$TICK_COLOR","$01dabe55fddff864$export$2e2bcd8739ae039","getTickValues","snappedValue","getClosestTick","attr","ResizeObserver","entries","entry","contentRect","observe","handleInput","handleKeydown","unobserve","ticks","ticksMatch","match","map","filter","n","isNaN","sort","newValue","closestTick","distanceFromTick","abs","value1","value2","distance","preventDefault","key","find","t","undefined","prev","reversed","composed","length","tickValue","navigator","vibrate","inputWidth","valueInRange","range","availableWidth","valueWidth","$01dabe55fddff864$var$THUMB_RADIUS","tickPositions","$01dabe55fddff864$var$TICK_WIDTH","tickPositionsInGradient","p","join","ticksBackground","styles","$8d5cef8e7fea78a8$export$f823a0c1cf7adf68","element","removeAttribute","$8d5cef8e7fea78a8$export$fe8985bb6374093c","$8d5cef8e7fea78a8$export$1a3b688c8bc0de17","isHidden","$da037f8140467741$var$elements","controls","document","controlsPanel","sidebarForm","$da037f8140467741$var$STATE_LOCAL_STORAGE_KEY","$da037f8140467741$export$2e2bcd8739ae039","config","controlsConfig","state","controlElements","_getState","groups","bind","passive","renderControls","menu","href","closest","scrollTo","top","behavior","menuTarget","scrollIntoView","destroy","nodeName","parentElement","groupId","dataset","group","contains","_updateState","selection","window","getSelection","removeAllRanges","$da037f8140467741$var$isRangeInput","body","HTMLInputElement","HTMLSelectElement","updateInput","inputElement","originalEvent","deferChange","updateControlDisplayValue","controlKey","displayValueElement","input","displayValue","id","replace","inputValue","$da037f8140467741$var$getInputValue","parseFloat","eventData","control","triggerChange","updateControlsVisibility","updateControlsLabels","updateControlsAttributes","localStorage","getItem","JSON","parse","newState","setItem","stringify","removeItem","children","functionAttrs","Object","_","Function","inputEl","attributeValueFn","newAttrValue","getConfigValue","updateTimeout","label","labelEl","labelText","show","shouldShowControl","controlEl","isDisabled","shouldDisableControl","containerEl","_controlsConfig","indexStart","controlsFragment","createDocumentFragment","controlConfig","controlIndex","controlId","createElement","className","defaultValue","$da037f8140467741$var$getElementTagNameForControlType","controlType","selectOptions","options","_option","optionEl","appendChild","realValue","updateGroupsState","querySelectorAll","groupEl","HTMLFieldSetElement","groupState","valueOrFn","$66d8ae1974721b90$var$DEFAULT_OPTIONS","updateOnResize","$66d8ae1974721b90$export$2e2bcd8739ae039","color","size","fixedSize","pixelRatio","currentSize","lastLine","lastStringCoordinates","hasInstructions","currentLayerOptions","resizeObserver","setSize","height","disconnect","Error","setColor","resetSize","getSize","getBoundingClientRect","getLogicalSize","setStartingPoint","coordinates","startLayer","endLayer","setFixedSize","enablePixelRatio","dpr","devicePixelRatio","updatePixelRatio","media","matchMedia","disablePixelRatio","renderInstructionsForLastLine","renderInstructions","$e2b746416d2bf62b$export$f4644083ce95e7e3","PI","$e2b746416d2bf62b$export$643b64bfca4574ff","distortion","$e2b746416d2bf62b$export$27796bb1a51212b7","from","to","hypot","$e2b746416d2bf62b$export$a3992db8dd0fd9e6","decimalPoints","pow10","pow","round","$b683a3137b30eaa9$export$b81d802eaada750f","d1","d2","defineProperty","prototype","fractionDigits","factor","writable","configurable","enumerable","$b683a3137b30eaa9$var$LENGTH_UNITS","Set","$b683a3137b30eaa9$export$c566af9defc62c6","dimensions","mapper","$b683a3137b30eaa9$export$6625f4a88a935670","dpi","has","cm","inch","pixels","$b683a3137b30eaa9$export$2e7f3602dd2acd76","$b683a3137b30eaa9$export$1d3cc206d049790e","boundingRects","reduce","box","boundingRect","newBox","left","right","bottom","assign","$b683a3137b30eaa9$export$d2646d47608819e2","$b683a3137b30eaa9$export$18c295d7a6a8189d","size1","size2","ratio","$b683a3137b30eaa9$export$c91255cadecfe081","$2f2e0bbe9a3a6970$var$lastId","$2f2e0bbe9a3a6970$export$2e2bcd8739ae039","stringsCanvas","nailsCanvas","instructionsCanvas","strings","canvas","ctx","getContext","nails","instructionsCtx","lineWidth","strokeStyle","canvases","ctxs","globalCompositeOperation","clientHeight","stringsCtx","nailsCtx","notifyOnChange","newSize","console","warn","realSize","setProperty","resetStrings","clearRect","resetNails","setLineWidth","setBackground","context","fillStyle","fillRect","renderLine","lineTo","beginPath","moveTo","stroke","renderNails","fontSize","radius","renderNumbers","margin","numbersStart","centerX","textBaseline","font","nailNumberOffset","number","x","y","arc","isRightAlign","numberPosition","textAlign","fillText","fill","instructionsOverlay","hideInstructions","opacity","fadeOut","raf","clearInstructions","strokeColor","fillColor","prevPosition","angle","atan2","save","arrowPos","arrowHeadSize","cos","sin","closePath","restore","clear","toDataURL","getComposite","toBlob","quality","Promise","resolve","reject","blob","compositeCanvas","c","drawImage","$174f2c93f6348ee5$var$promptDialogId","$174f2c93f6348ee5$export$195ba6d62321b933","dialog","getAttributeForProp","prop","$174f2c93f6348ee5$var$CONFIRM_DIALOG_ID","$174f2c93f6348ee5$export$715f9d76bb8c1fea","$d8f8628a77747326$export$fa8157df3262779b","pattern","defaultConfig","nonDefaultConfigValues","toFixed","pop","$d8f8628a77747326$var$numberRegExp","$d8f8628a77747326$var$booleanRegExp","$2509ceef6c629a64$export$87dcc7060093bbda","renderer","patternAsTemplate","configQuery","isDefaultConfig","encodeURIComponent","$2509ceef6c629a64$export$e2de15bbd9edf9c6","queryParams","URLSearchParams","location","search","get","$b103c63dc979d40c$export$596571ef134d4065","parent","$b103c63dc979d40c$export$2d97e2da46663803","attributeName","attrCopy","$b103c63dc979d40c$export$68091c7c829a57b8","copy","$b103c63dc979d40c$export$c4f94c8b3850a5a9","insertAfterKey","controlsConfigToInsert","configCopy","nodeToAddAfter","$b103c63dc979d40c$var$getControlConfigNodeByKey","findFn","node","list","$9e482fa80a49eb9a$export$2e2bcd8739ae039","affectsNails","affectsStepCount","isMultiColor","colorthumb","multicolorStart","snap","thumbcolor","minLightness","multicolorByLightness","maxLightness","repeatColors","$44d9dab6555abf73$export$2e2bcd8739ae039","multiColorStep","multiColorLightnessStep","colors","multicolorRange","colorCount","darkMode","saturation","reverseColors","mirrorColors","Array","colorIndex","lightness","_firstColor","restColors","getColor","getOppositeColor","hslColor","hslMatch","oppositeHue","getColorMap","stepsPerColor","floor","colorMap","Map","i","set","getConfig","include","exclude","defaults","customControls","propMapper","groupLabel","maxColorCount","$b103c63dc979d40c$export$d9fe7d5b8b296e7c","controlPropMapper","getControls","finalControl","freeze","$c29d66861308df7e$export$f05027632b38f3a4","obj1","obj2","props","keys","some","$d8b2fd23c47cc34c$export$2e2bcd8739ae039","values","addNail","addGroup","nailsGroup","getNailCoordinates","getUniqueCoordinates","precision","addedCoordinates","point","hash","callback","$a2a2cf72b22d53bf$export$2e2bcd8739ae039","$9ee6280c93a20bac$export$5d318302d9efabc7","nail","$fa5e071b86283164$export$f14c78f74247c3d","threadsLength","total","perColor","nailCount","lineLength","getInfo","nailsCount","closestDistanceBetweenNails","points","Infinity","ptsByX","a","b","ptsByY","recurse","px","py","j","pointsDist","mid","midX","leftX","slice","rightX","leftY","rightY","d","strip","stripDist","nailRadius","$ed62eab3f3d51c1d$var$COMMON_CONFIG_CONTROLS","showNails","showStrings","affectsStrings","nailNumbersFontSize","showNailNumbers","isStructural","customBackgroundColor","$ed62eab3f3d51c1d$export$2e2bcd8739ae039","defaultValues","stringsIterator","link","linkText","calc","getNailCount","getThreadLengths","thumbnailConfig","testStepCountConfig","getCommonControls","configControls","concat","controlsIndex","configIndex","isTemplate","markConfigAsDefault","resetDefaultConfig","assignConfig","setConfig","currentConfig","onConfigChange","changedControlKeys","resetStructure","getCalc","onResize","setConfigValue","setUpDraw","afterDraw","initDraw","redrawNails","redrawStrings","sizeChanged","stringWidth","enableScheduler","signal","aborted","abort","TaskController","priority","scheduler","postTask","catch","reason","drawOptions","backgroundColor","enableBackground","nailsColor","drawNails","drawStrings","drawNext","result","overrideConfig","patternCopy","$6e85582323150d4b$var$easing","linear","inOutCirc","sqrt","easeOutQuint","easeOutCubic","fastSlowFast","fastInOutSquare","fastInOutCubic","fastInOutQuint","fastInOut","fastInOutFixed","fastArea","y1","y2","easeOutFixed","fixedAreaSize","fixedAreaStart","fixedAreaResultStart","$96d8651f67c6b219$export$f481ea230fad194b","$96d8651f67c6b219$export$b5632b5e53e50dc","$96d8651f67c6b219$export$9a00dee1beb8f576","toLocaleUpperCase","$c190f550efa69733$export$7f1ebd623f131021","requirePower","requireFastArea","$cf574edfbef72605$export$2e2bcd8739ae039","fitSize","sizeAndCenter","configSize","getBoundingRect","scale","center","rotation","sides","sideCount","configCenter","nailsPerSide","radiusNailsCountSameAsSides","radiusConfig","sideAngle","radiusAngle","sideSize","nailsDistance","radiusNailsCount","radiusNailsDistance","getPoint","side","getSidePoint","pointsMapIndex","startX","getCenterPoint","firstPoint","getAspectRatio","drawCenter","drawSides","drawCenterNail","getUniqueKey","nailIndex","getNailsCount","rotationConfig","$06de6887437e6fa7$export$2e2bcd8739ae039","easingFunction","xyRadius","rotationAngle","indexAngle","isReverse","isPartialArc","excludedNailIndexes","realIndex","angleStart","aspectRatio","polygon","angleEnd","clampedRadius","displacementFunc","easingParams","displacementMag","displacementFastArea","easingFunctionWithParams","excludedNailRanges","end","drawRing","ringSize","prevPoint","ringDistance","prevPointIndex","isPrevSide","startPoint","positions","nextPoint","getRingStepCount","nailsConfig","displacementConfig","distortionConfig","$44064e6908c034c2$var$COLOR_CONFIG","$44064e6908c034c2$export$2e2bcd8739ae039","innerLength","repetition","circle","realRepetition","getStepCount","drawSpiral","shift","currentInnerLength","repetitionCount","isPrevPoint","stepColor","$63660c6a2fc9a003$var$Spirals","nSpirals","maxRadius","spiralRotations","generatePoints","nailsPerSpiral","s","spiralIndex","totalAngle","radiusEasing","angleEasing","$ad2ceb60c48a58dd$export$2e2bcd8739ae039","nConfig","layers","layerFill","stringsPerLayer","layerShift","drawLayer","layerIndex","base","toIndex","layer","$33e9badd1f194d7c$export$2e2bcd8739ae039","layerSpread","$aa2c32cdcace5ae2$var$SIDES","$aa2c32cdcace5ae2$var$SIDES_ORDER","$aa2c32cdcace5ae2$var$SIDES_ROTATION","$aa2c32cdcace5ae2$var$Eye","maxSize","nailSpacing","layerAngle","getLayerProps","layerSize","layerStart","layerSideNailCount","theta","pivot","cosAngle","sinAngle","drawSide","sideIndex","nextSide","nextSideRotation","sideProps","colorPerLayer","count","$a643183efb8a0ce0$export$2e2bcd8739ae039","sideNails","centerRadius","centerRadiusFraction","maxCurveSize","sidesCenterRadiusShift","sidesAngle","linesPerRound","sidesConnectionCount","sinSideAngle","cosSideAngle","sidesCenterRadius","reverseOrder","renderCenterNail","sideNailsConfig","minNailIndex","alternate","rounds","ceil","isLastRound","isOdd","sidesConfig","description","centerRadiusConfig","StarConfig","$ca4a2eb6736370e4$export$2e2bcd8739ae039","isSingleColor","renderStar","starConfig","star","circleRect","starRect","getArcPoint","drawStar","innerColor","drawCircle","outerColor","isStar","linesThisRound","pointPosition","ringColor","singleColor","k","ringCount","circleCount","circleLinesPerRound","$8db9d587e082a0d9$var$LAYER_DEFAULTS","$8db9d587e082a0d9$export$2e2bcd8739ae039","circleDistanceBetweenPoints","lineSize","lineNailCount","firstCirclePoint","totalNailCount","lineSpacing","getLayer","call","enable","totalIndexCount","endIndex","indexLength","linePosition","circleIndex","self","getPointIndex","$1530a0f3e43122ac$var$rotationConfig","$1530a0f3e43122ac$export$2e2bcd8739ae039","$1530a0f3e43122ac$var$getCircleConfig","rotation1","n1","n2","n3","radius1","radius2","radius3","x1","x2","x3","y3","reverse1","reverse2","reverse3","roundsCount","l","prevCirclePoint","nextLayerIndex","$3f55ac726d5ebe61$var$COLOR_CONFIG","$3f55ac726d5ebe61$export$2e2bcd8739ae039","bezier","limitedBezier","$7e0f39c01d255ee0$var$COLOR_CONFIG","$7e0f39c01d255ee0$export$2e2bcd8739ae039","layerAngleShift","polygons","leftSide","centerIndexes","layerNailCount","$5498d6506310c764$var$COLOR_CONFIG","$5498d6506310c764$export$2e2bcd8739ae039","maxSteps","angleRadians","r","angleGcd","$e2b746416d2bf62b$export$f81847884871263e","int1","int2","steps","$7a74ed27f7260395$var$COLOR_CONFIG","$7a74ed27f7260395$var$ANGLE","$7a74ed27f7260395$var$SIDE_ANGLES","$cfcb4d6877bfaba2$var$spreadModes","evenly","f","layerDistance","firstLayerDistance","$cfcb4d6877bfaba2$var$COLOR_CONFIG","$cfcb4d6877bfaba2$export$2e2bcd8739ae039","realColorCount","calcOptions","getLayerRingDistance","spread","getLayerRingStepCount","layerRingDistance","pointIndex","totalStepCount","$47fd6f35b394300f$export$2e2bcd8739ae039","starRadius","backdropSize","backdropRadius","backdropShift","toUpperCase","backdropIsMultiColor","backdropMulticolorStart","backdropColorCount","backdropNailsColor","backdropNailsRadius","backdropRadiusConfig","starRadiusConfig","backdropNails","obj","mappedObj","toLowerCase","generateLayers","drawBackdrop","backdropSkip","shouldSkip","currentSide","currentSideIndex","backdropPoint","direction","backdropNailsGroup","$54d330e2d674b207$export$2e2bcd8739ae039","renderCenter","$54d330e2d674b207$var$getSectionCountToRemove","removeSections","density","centerRadiusPercent","densityNailCount","baseCircleConfig","petalSectionsToRemove","maxPetalSectionsToRemove","topSectionHeight","fitAspectRatio","fullCircleNailCount","helperCircle","circles","circleNailsCount","sections","$54d330e2d674b207$var$getSectionsCount","removedSections","nailsPerSection","nailsPerCircle","lastSection","maxCenterRadiusPoint","centerCircleRadius","centerCircle","radialColor","section","prevCircle","connectPoint","isLastSection","firstCircle","firstCircleStart","startIndex","renderCenterNails","circleIndexStart","innerSectionNailsStart","$e483398e368102d0$var$COLOR_CONFIG","$e483398e368102d0$var$getShapeControlsGroup","shapeIndex","identicalNailCount","Boolean","$e483398e368102d0$export$2e2bcd8739ae039","shape1Type","shape1NailCount","shape1Rotation","shape2Type","shape2Size","shape2NailCount","shape2Distortion","shape2Rotation","getShape","diameter","shape1Sides","shape2Sides","shape1","shape1Distortion","shape2","shapeType","rect1","rect2","greaterNailCount","toShape2","getShape2Index","MAX_NAIL_COUNT","$281c51d967a471db$export$17d680238e50603e","spaces","rotationCenter","xDist","yDist","pointDistanceToCenter","startingAngle","asin","$5671f58b0d6a3653$var$getOtherOrientationLabel","orientation","$5671f58b0d6a3653$var$getOrientationLabel","$5671f58b0d6a3653$export$2e2bcd8739ae039","sidesRotation","fineControl","lockGap","lengthGap","widthGap","centerLengthSpread","centerLengthGap","centerSpread","symmetricCenter","centerWidthGap","centerStartSpread","centerStartGap","centerEndSpread","centerEndGap","edgesSpread","edgesGap","edgesWidthSpread","edgesWidthGap","setCenterColor","verticalGapPercent","centerLengthGapPercent","centerLengthSpreadPercent","isVertical","maxVerticalGap","sideLengthGap","widthShift","sideLineLength","orientationDimensionIndex","getSides","sideLength","overrides","gap1","length1","gap2","length2","edges","centerStart","centerEnd","edgesWidthStart","edgesWidthEnd","rotatedEdgesWidthStart","rotatedEdgesWidthEnd","lengthStart","distanceToFirstEdge","rotatedEdgesLegthStart","rotatedEdgesLengthEnd","widthStart","widthEnd","heightStart","heightEnd","sizeWithoutMargins","sizeWidth","sizeHeight","sizeRatio","centeredWidthStart","shouldRefreshBoundingRect","newWidthShift","trunc","verticalPositions","lineStart","vertical","horizontal","verticalCenter","verticalLines","getRowLineRotationConfig","row","getHorizontalLineLength","horizontalLines","horizontalStart","horizontalEnd","rowTop","startLength","endLength","shapes","firstShapeRect","rect","shape","shapeBoundingRect","flat","connectLines","verticalLine","currentLine","centerColor","verticalIndex","horizontalRow","line","startLine","endLine","$3eff4f8917d513a6$var$patternTypes","globalRotation","renderRing","ringPadding","renderTriangles","levels","renderCaps","ringNailCount","globalRotationRadians","edgeSize","nailsLength","ringCircle","countPerLevelSide","level","triangleHeight","triangleCenterDistance","nailDistance","triangleCount","colorPerLevel","isCapLevel","triangleIndexInSide","withPoint","missingSide","trianglePoints","triangleSidePoints","nNailDistance","largeDistance","smallDistance","levelsCount","levelSideTriangleCount","levelPositions","isFlipped","trianglePosition","atan","distanceFromCenter","triangleIndexInLevel","sideRotation","triangleCenterAngle","rotatedTrianglePosition","generateTriangleStrings","indexInSide","triangleIndex","initialSide","lastSide","lastIndex","isNextSide","nextSidePoint","targetSide","targetPoint","generateStringsBetweenTriangles","triangle1Index","triangle2Index","triangle1Level","triangle2Level","isNextLevel","levelSideCount","angleShift","isLastTriangleInSide","triangle1Side","triangle2Side","generateOrderInSide","getNextTriangleSide","last","levelIndex","levelTriangleCount","lastIndexInLevel","nextLevelTriangleIndex","capCount","fillCount","getTriangleCountForLevel","levelTrianglecount","fillStepCount","capsCount","triangle","$92270d8b7d92e411$export$ebb1a6b9e8c15cc2","patternId","$00643d12b3a54506$export$2e2bcd8739ae039","getPatternByID","$00643d12b3a54506$var$APP_DATA_STORAGE_KEY","currentPattern","saveDialog","deletePattern","saveCurrentPattern","renameCurrentPattern","nextId","defaultName","title","submit","then","patternName","saveNewPattern","setPattern","patternDataToStringArt","patternData","Pattern","_type","getSavedPatterns","patterns","loadAppData","loadPatternDataById","appData","lastId","newPatternData","saveAppData","savePattern","patternIndex","findIndex","newPatternName","savePatternDownloadData","data","downloadData","getPatternDownloadData","rawData","error","message","$8a4d6517fbd25a59$var$MINIMIZED_CLASS","$8a4d6517fbd25a59$export$45b50bca1da1e9b3","root","thumbnails","toggleBtn","dropdown","thumbnailsRendered","_onClickOutside","persistance","isOpen","createThumbnails","setCurrentPattern","thumbnail","stopPropagation","sectionTitle","thumbnailsList","thumbnailsFragment","patternThumbnails","patternLink","li","savedPatterns","PatternType","$0649237e9259f2a7$var$SVG_NS","$0649237e9259f2a7$export$2e2bcd8739ae039","svg","backgroundGroup","linesGroup","nailsCirclesGroup","nailsTextGroup","currentColor","currentLineGroup","createElementNS","newDimensions","setAttributeNS","childNodes","SVGGElement","removeAttributeNS","circlesFragment","textFragment","textEl","$38bb4a85553a6bfc$export$ed80d9de1d9df928","share","$38bb4a85553a6bfc$var$getShareData","alert","$38bb4a85553a6bfc$export$4fa6f570da04f7cc","dataURL","shareData","$38bb4a85553a6bfc$var$dataURLToShareData","canShare","filename","url","fetch","files","File","lastModified","Date","getTime","$718de5d870731526$export$d594efb518b3cec4","serviceWorker","hostname","registration","register","onupdatefound","installingWorker","installing","onstatechange","controller","log","$2deec1a9c1aeca88$exports","$f0492547ffa27fa1$var$sheet","$f0492547ffa27fa1$var$DIMENSIONS","$f0492547ffa27fa1$export$2e2bcd8739ae039","floatingPoints","inputs","setDimensionValue","updateOtherDimensionOnce","maxWidth","maxHeight","setMaxDimensionValue","isReadonly","applyAspectRatio","targetDimension","getOtherDimension","dimension","updateOtherDimension","normalizedValue","toFixedPrecision","otherDimension","otherDimensionMaxValue","setMaxDimensions","setFloatingPoints","select","placeholder","$f4729f31dd8a035c$export$e44a253a59704894","button","customEvent","$0096ec60fce19dcf$var$DropdownMenuItem","item","_oldValue","$eb971f7ae22dc5e1$exports","$34a1caf943752901$var$sheet","$34a1caf943752901$export$2e2bcd8739ae039","code","initialValue","getValue","$7a37a3caedf4d681$exports","$08ec3d656de31381$exports","$1b7158181746ebe4$var$sheet","$1b7158181746ebe4$export$2e2bcd8739ae039","cancelBtn","submitBtn","titleEl","descEl","submitText","submitIcon","returnValue","isPx","test","onShow","showModal","handleClose","click","$0346d3bbf80d0cab$exports","$7daf604df182e360$exports","$37ffe584ad149ed5$var$UNITS_LOCALSTORAGE_KEY","$37ffe584ad149ed5$var$preferences","getUserPreferredUnits","setUserPreferredUnits","units","$b7266296a7c0118e$export$ef63c67b3e1358f7","overridingConfig","$b7266296a7c0118e$export$a4f48c82401c4","isNailsMap","includeNailNumbers","$b7266296a7c0118e$export$bb3b75778e3e272","dataUrl","URL","createObjectURL","downloadLink","download","removeChild","revokeObjectURL","$b7266296a7c0118e$var$patternToSVGDownloadData","Blob","outerHTML","$b7266296a7c0118e$var$patternToImageDownloadData","imageType","$9ecbf20527c60613$var$DEFAULT_DIMENSIONS","$9ecbf20527c60613$export$1ddaf6ceff5ce8d6","customDimensions","patternAspectRatio","SMALL_SCREEN_DIMENSION","screen","defaultUnits","defaultMargin","allowSizeEdit","allowRotate","inUnits","currentDimensions","$9ecbf20527c60613$export$1c29b97c038fa375","sizeId","$00eb9133a5a9a95d$var$sheet","$00eb9133a5a9a95d$var$IMAGE_TYPES_WITH_TRANSPARENT_BACKGROUND","$00eb9133a5a9a95d$export$2e2bcd8739ae039","unitFloatingPointsPrecision","form","unitSelect","dpiBlock","renderNumbersBlock","patternDimensions","imageDimensions","transparentBackground","rotateBtn","setUnits","selectedType","setType","updatesPreview","updatePreview","setImageType","setMargin","setDimensions","updatePatternDimensions","rotateImage","transparentBackgroundBlock","getFormValues","fromEntries","FormData","isTransparentBackground","formValues","format","transparent_background","prevUnits","getMarginMax","sizeDimensions","isPixelsOnly","togglePixels","setPixelsOnly","newUnits","showPixels","el","nonPixelOptions","option","patternAvailableDimensions","savedDownloadOptions","setDownloadOptionsToForm","downloadOptions","rotate_image","unit","render_numbers","isRotated","pxDimensions","previewSize","previewPattern","previewSizeRatio","$a244379bf8b3b658$var$routing","onPopState","actualRenderer","serializedCofig","serializedConfigValues","commaCount","split","booleanMatch","configKeys","serializedValue","init","history","navigateToMain","pushState","navigateToPattern","replaceState","setHistoryState","$1e47030bd2e0e155$export$2e2bcd8739ae039","rendererType","cancelDraw","deltaY","setRenderer","timeout","cancelTouch","RendererType","$fc3e3d346052d3b6$var$DEFAULT_TARGET_SIZE_CM","$fc3e3d346052d3b6$var$DEFAULT_SIZES_CM","$fc3e3d346052d3b6$var$info","targetSizeCm","lastSize","patternMargin","patternNailRadius","infoPanel","threadsTotalLength","threadsPerColor","dimensionsSelect","sizes","toString","fittedSize","toLocaleString","maxColorLength","colorEl","colorValueEl","colorValueDisplay","sourceUnits","meters","$1ccc8d3c866b7484$var$main","main","downloadBtn","resetBtn","shareBtn","playerBtn","infoBtn","buttons","instructionsLink","showInfo","onInputsChange","setIsDefaultConfig","showShare","downloadDialog","dialogId","toggleFor","btn","toggledElement","templatePattern","MessageChannel","port2","o","port1","onmessage","h","u","postMessage","T","C","m","isIdleCallback","I","cancel","cancelIdleCallback","TypeError","P","requestIdleCallback","M","isEmpty","A","N","O","takeNextTask","q","merge","D","Event","previousPriority","AbortController","H","R","defineProperties","onprioritychange","setPriority","DOMException","S","U","W","WeakMap","yield","B","delay","hostCallback","abortCallback","onTaskCompleted","onTaskAborted","isAborted","isContinuation","F","G","J","K","L","V","X","TaskPriorityChangeEvent","stack","SCHEDULER_PRIORITIES","PostMessageCallbackMananger","constructor","this","channel_","sendPort_","messages_","nextMessageHandle_","onMessageReceived_","queueCallback_","handle","cancelCallback_","getPostMessageCallbackManager","instance_","HostCallback","callback_","callbackType_","handle_","canceled_","schedule_","isMessageChannelCallback_","runCallback_","nextSequence","IntrusiveTaskQueue","head_","tail_","task","tq_sequence_","tq_prev_","tq_next_","remove_","sourceQueue","selector","currentTask","previousTask","iterator","taskToMove","insert_","parentTask","nextTask","typeArg","super","priority_","isPriorityChanging_","queues_","TaskQueue","pendingHostCallback_","signals_","postTaskOrContinuation_","resultPromise","onTaskDelayExpired_","pushTask_","scheduleHostCallbackIfNeeded_","schedulerEntryCallback_","onPriorityChange_","oldPriority","runNextTask_","nextTaskPriority_"],"version":3,"file":"string_art.875037c1.js.map"}