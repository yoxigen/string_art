let e,t,i,n,r;function s(e,t,i){let n=function e(t,i){let n=t.findIndex(({key:e})=>e===i);if(-1!==n)return[n];for(let n=0;n<t.length;n++){let r=t[n];if(r.children){let t=e(r.children,i);if(t)return[n,...t]}}return null}(e,t);if(n){let t=n.pop(),r=function e(t){return t.map(t=>{let i={...t};return t.children&&(i.children=e(t.children)),t.attr&&(i.attr={...t.attr}),i})}(e),s=r;if(n.length)for(;n.length;)s=s[n.shift()].children;return s.splice(t+1,0,...i),r}return e}const a=[{key:"isMultiColor",label:"Use multiple colors",defaultValue:!1,type:"checkbox"},{key:"colorCount",label:"Colors count",defaultValue:7,type:"range",attr:{min:1,max:20,step:1},show:({isMultiColor:e})=>e},{key:"color",label:"String color",defaultValue:"#ff4d00",type:"color",show:({isMultiColor:e})=>!e},{key:"multicolorStart",label:"Multicolor start",defaultValue:0,type:"range",attr:{min:0,max:360,step:1,background:"linear-gradient(90deg in hsl longer hue, hsl(0 100 50), hsl(360deg 100 50))",thumbcolor:({config:{multicolorStart:e}})=>`hsl(${e}deg 100 50)`},show:({isMultiColor:e})=>e},{key:"multicolorRange",label:"Multicolor range",defaultValue:360,type:"range",attr:{min:1,max:360,step:1,background:({config:{multicolorStart:e,multicolorRange:t,reverseColors:i}})=>`linear-gradient(to ${i?"left":"right"} in hsl ${t>180?"longer":"shorter"} hue, hsl(${e} 100 50), hsl(${e+t} 100 50))`,thumbcolor:"white"},show:({isMultiColor:e})=>e},{key:"saturation",label:"Saturation",defaultValue:100,type:"range",attr:{min:0,max:100,step:1},show:({isMultiColor:e})=>e},{key:"lightness",label:"Lightness",type:"group",defaultValue:"minimized",show:({isMultiColor:e})=>e,children:[{key:"multicolorByLightness",label:"Multi lightness",defaultValue:!1,type:"checkbox",show:({isMultiColor:e})=>e},{key:"minLightness",label:"Minimum lightness",defaultValue:0,type:"range",attr:{min:0,max:100,step:1,snap:"50",thumbcolor:({config:{minLightness:e}})=>`hsl(0 0 ${e})`,background:"linear-gradient(to right, black, white)"},show:({multicolorByLightness:e,isMultiColor:t})=>e&&t},{key:"maxLightness",label:"Maximum lightness",defaultValue:100,type:"range",attr:{min:0,max:100,step:1,snap:"50",thumbcolor:({config:{maxLightness:e}})=>`hsl(0 0 ${e})`,background:"linear-gradient(to right, black, white)"},show:({multicolorByLightness:e,isMultiColor:t})=>e&&t}]},{key:"colorOrderGroup",type:"group",label:"Order",defaultValue:"minimized",show:({isMultiColor:e})=>e,children:[{key:"reverseColors",label:"Reverse colors order",defaultValue:!1,type:"checkbox",show:({isMultiColor:e})=>e},{key:"repeatColors",label:"Repeat colors",defaultValue:!1,type:"checkbox",show:({isMultiColor:e})=>e},{key:"mirrorColors",label:"Mirror Colors",defaultValue:!1,type:"checkbox",show:({isMultiColor:e,repeatColors:t})=>e&&t}]}];class l{constructor(e){this.config=e;let{multicolorRange:t,colorCount:i,multicolorByLightness:n,minLightness:r=0,maxLightness:s=100,multicolorStart:a,darkMode:l,saturation:o,reverseColors:h,repeatColors:u,mirrorColors:c,isMultiColor:d}=e;if(d){if(this.multiColorStep=t/i,this.multiColorLightnessStep=n?(s-r)/(Math.max(i,2)-1):1,this.colors=Array(i).fill(null).map((e,t)=>{let i=n?r+this.multiColorLightnessStep*t:l?50:40;return`hsl(${a+t*this.multiColorStep}, ${o}%, ${i}%)`}),u&&c){let[e,...t]=this.colors;t.pop(),this.colors=[...this.colors,...t.reverse()]}h&&this.colors.reverse()}}getColor(e){let{isMultiColor:t,colorCount:i,color:n,repeatColors:r}=this.config;return t?(e>=i&&(e=r?e%this.colors.length:this.colors.length-1),this.colors[e]):n}static getOppositeColor(e){let t=e.match(/^hsl\((\d+)(?:deg)?(?:,?\s?)(\d+%?)(?:,?\s?)(\d+%?)\)$/);if(t){let e=(Number(t[1])+180)%360;return`hsl(${e}, ${t[2]}, ${t[3]})`}return null}getColorMap({stepCount:e,colorCount:t}){if(!t)throw Error("Can't get color map, no colorCount provided!");let i=Math.floor(e/t),n=new Map;for(let e=0;e<t;e++)n.set(e*i,this.getColor(e));return n}static getConfig({include:e,exclude:t,defaults:i={},customControls:n,propMapper:r,groupLabel:s,maxColorCount:l}){return{key:"colorGroup",label:s??"Color",type:"group",children:[...n??[],...function e(t,i){return i?t.map(t=>(t.children&&(t={...t,children:e(t.children,i)}),{...t,...i(t)})):t}(function n(r=a){return r.filter(({key:i})=>(!t||!t.includes(i))&&(!e||e.includes(i))).map(e=>{let t={...e,defaultValue:i[e.key]??e.defaultValue};return"group"===e.type&&(t.children=n(e.children)),"colorCount"===e.key&&l&&(t.attr.max=l),Object.freeze(t)})}(),r)]}}}const o={color:"#ffffff",fontSize:10,radius:1.5,renderNumbers:!1,margin:4};class h{#e=[];constructor(e,t){this.setConfig(t),this.nails=[],this.addedPoints=new Set,this.renderer=e}setConfig({nailRadius:e,nailsColor:t,nailNumbersFontSize:i}){this.nailRadius=e,this.nailsColor=t,this.nailNumbersFontSize=i,this.nails=[],this.addedPoints&&this.addedPoints.clear()}addNail(e){let t=e.point.map(Math.round).join("_");this.addedPoints.has(t)||(this.nails.push(e),this.addedPoints.add(t))}addGroup(e,t){this.#e.push({nails:e,config:t})}#t(e,t){let i={...o,...t};this.renderer.renderNails(e,i)}fill({drawNumbers:e=!0}={}){let t={color:this.nailsColor,fontSize:this.nailNumbersFontSize,radius:this.nailRadius,renderNumbers:e};this.#t(this.nails,t),this.nails=[],this.addedPoints.clear(),this.#e.forEach(({nails:e,config:i})=>{this.#t(e,{...t,...i})}),this.#e=[]}}class u{constructor(e){this.parentElement=e}destroy(){this.parentElement.removeElement(this.element)}get element(){throw Error("element getter not implemented!")}reset(){}setColor(e){this.color=e}setLineWidth(e){}setBackground(e){}renderLines(e){throw Error('Renderer "renderLines" method not implemented!')}renderNails(e,{color:t,fontSize:i,radius:n,renderNumbers:r,margin:s}){throw Error('Renderer "renderNails" method not implemented!')}getSize(){let{width:e,height:t}=this.parentElement.getBoundingClientRect();return[e,t]}setSize(e){this.size=e,this.element.removeAttribute("width"),this.element.removeAttribute("height"),e?(this.element.style.width=`${e.width}px`,this.element.style.height=`${e.height}px`):this.element.removeAttribute("style")}clear(){throw Error('Renderer "clear" method not implemented!')}toDataURL(){throw Error('Renderer "toDataURL" method not implemented!')}}const c="#0e0e0e",d=[{key:"strings",label:"Strings",type:"group",defaultValue:"minimized",children:[{key:"showStrings",label:"Show strings",defaultValue:!0,type:"checkbox",isDisabled:({showNails:e})=>!e},{key:"stringWidth",label:"String width",defaultValue:1,type:"range",attr:{min:.2,max:4,step:.1},show:({showStrings:e})=>e}]},{key:"nails",label:"Nails",type:"group",defaultValue:"minimized",children:[{key:"showNails",label:"Show nails",defaultValue:!0,type:"checkbox",isDisabled:({showStrings:e})=>!e},{key:"showNailNumbers",label:"Show nail numbers",defaultValue:!1,type:"checkbox",show:({showNails:e})=>e},{key:"nailNumbersFontSize",label:"Nail numbers font size",defaultValue:10,type:"range",attr:{min:6,max:24,step:.5},displayValue:({nailNumbersFontSize:e})=>`${e}px`,show:({showNails:e,showNailNumbers:t})=>e&&t},{key:"margin",label:"Margin",defaultValue:20,type:"number",attr:{min:0,max:500,step:1},displayValue:({margin:e})=>`${e}px`},{key:"nailRadius",label:"Nail size",defaultValue:1.5,type:"range",attr:{min:.5,max:5,step:.25},show:({showNails:e})=>e},{key:"nailsColor",label:"Nails color",defaultValue:"#ffffff",type:"color",show:({showNails:e})=>e}]},{key:"background",label:"Background",type:"group",defaultValue:"minimized",children:[{key:"darkMode",label:"Dark mode",defaultValue:!0,type:"checkbox",isDisabled:({enableBackground:e})=>!e},{key:"customBackgroundColor",label:"Custom background color",defaultValue:!1,type:"checkbox",isDisabled:({enableBackground:e})=>!e},{key:"backgroundColor",label:"Background color",defaultValue:c,type:"color",show:({customBackgroundColor:e})=>e,isDisabled:({enableBackground:e})=>!e},{key:"enableBackground",label:"Enable background",defaultValue:!0,type:"checkbox"}]}];var g=class{constructor(e){if(!e)throw Error("Renderer not specified!");if(!(e instanceof u))throw Error("Renderer is not an instance of Renderer!");this.renderer=e}get configControls(){return(this.controls??[]).concat(this.mapCommonControls?.(d)??d)}get controlsIndex(){return this._controlsIndex||(this._controlsIndex=function e(t){return t.reduce((t,i)=>i.children?{...t,...e(i.children)}:{...t,[i.key]:i},{})}(this.controls)),this._controlsIndex}get defaultConfig(){return this._defaultConfig||(this._defaultConfig=Object.freeze(Object.assign(function e(t){return t.reduce((t,{key:i,defaultValue:n,children:r})=>r?{...t,...e(r)}:{...t,[i]:n},{})}(this.configControls),this.defaultValues))),this._defaultConfig}get config(){return this._config??this.defaultConfig}set config(e){this._config=Object.assign({},this.defaultConfig,e)}setConfig(e){let t=this.config;if(this.config=e,this.onConfigChange){let i=Object.keys(t).filter(i=>e[i]!==t[i]);this.onConfigChange({controls:i.map(t=>({control:this.controlsIndex[t],value:e[t]}))})}}resetStructure(){}onConfigChange({controls:e}){e.some(({control:e})=>e.isStructural)&&(this.resetStructure(),null!=this.stepCount&&e.some(({control:e})=>!1!==e.affectsStepCount)&&(this.stepCount=null))}onResize(){this.resetStructure()}setConfigValue(e,t){(!this._config||this._config[e]!==t)&&(this._config=Object.freeze({...this._config??this.defaultConfig,[e]:t}),this.onConfigChange&&this.onConfigChange({controls:[{control:this.controlsIndex[e],value:t}].filter(({control:e})=>!!e)}))}getSize(){return this.renderer.getSize()}setUpDraw(){let e=this.size;this.renderer.reset();let[t,i]=this.size=this.getSize();Object.assign(this,this.size),this.center=this.size.map(e=>e/2),e&&(e[0]!==t||e[1]!==i)&&this.onResize&&this.onResize(),this.nails?this.nails.setConfig(this.config):this.nails=new h(this.renderer,this.config),this.renderer.setLineWidth(this.config.stringWidth)}afterDraw(){let{showNails:e,showNailNumbers:t}=this.config;e&&(this.drawNails(),this.nails.fill({drawNumbers:t}))}initDraw(){this.setUpDraw(this.config);let{showNails:e,showNailNumbers:t,darkMode:i,backgroundColor:n,customBackgroundColor:r,enableBackground:s}=this.config;s&&this.renderer.setBackground(r?n:i?c:"#ffffff"),e&&(this.drawNails(),this.nails.fill({drawNumbers:t}))}draw({position:e=1/0}={}){this.initDraw();let{showStrings:t}=this.config;if(t){for(this.stringsIterator=this.generateStrings(),this.position=0;!this.drawNext().done&&this.position<e;);this.afterDraw()}}goto(e){if(e!==this.position)if(this.stringsIterator&&e>this.position)for(;!this.drawNext().done&&this.position<e;);else this.draw({position:e})}drawNext(){let e=this.stringsIterator.next();return e.done?this.afterDraw():this.position++,e}generateStrings(){throw Error("generateStrings method not defined!")}getStepCount(){throw Error(`'getStepCount' method not implemented for string art type "${this.name}"`)}};const p={linear:e=>e,inOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeOutQuint:e=>1-Math.pow(1-e,5),fastSlowFast:e=>.5*(1-Math.cos(Math.PI*(e=Math.max(0,Math.min(1,e)))))**1.5,fastInOutSquare:e=>e<=.5?(1-Math.pow(1-2*e,2))/2:.5+Math.pow(2*e-1,2)/2,fastInOutCubic:e=>e<=.5?(1-Math.pow(1-2*e,3))/2:.5+Math.pow(2*e-1,3)/2,fastInOutQuint:e=>e<=.5?(1-Math.pow(1-2*e,5))/2:.5+Math.pow(2*e-1,5)/2,fastInOut:(e,t)=>t<=.5?(1-Math.pow(1-2*t,e))/2:.5+Math.pow(2*t-1,e)/2,fastInOutFixed(e,t,i){if(i>t&&i<1-t){let n=(1-Math.pow(1-2*t,e))/2,r=.5+Math.pow((1-t)*2-1,e)/2;return n+(i-t)*(r-n)/(1-2*t)}return i<=t?(1-Math.pow(1-2*i,e))/2:.5+Math.pow(2*i-1,e)/2}};p.fastInOut.requirePower=!0,p.fastInOutFixed.requirePower=!0,p.fastInOutFixed.requireFastArea=!0;const f=2*Math.PI;class m{constructor(e){this.setConfig(e)}getPoint(e=0){let t=this.getNailIndex(e);if(this.points.has(e))return this.points.get(e);let i=this.easingFunction(t/this.config.n)*f+this.rotationAngle,n=[this.center[0]+Math.sin(i)*this.xyRadius[0],this.center[1]+Math.cos(i)*this.xyRadius[1]];return this.points.set(e,n),n}getNailIndex(e=0){let t=this.isReverse?this.config.n-1-e:e;return t>this.config.n-1&&(t%=this.config.n),t}setConfig(e){let t=this._serializeConfig(e);if(t!==this.serializedConfig){let{n:i,size:n,margin:r=0,rotation:s=0,center:a,radius:l,reverse:o=!1}=e,h=a??n.map(e=>e/2),u=l??Math.min(...h)-r,c=[u,u];e.distortion&&(c=function(e,t){let i=Math.min(t[0]/e[0],t[1]/e[1]);return e.map(e=>e*i)}(e.distortion<0?[u*(1-Math.abs(e.distortion)),u]:[u/(1-e.distortion),u],h.map(e=>e-r)));let d={center:h,radius:u,xyRadius:c,indexAngle:f/i,rotationAngle:-f*s,isReverse:o},g=e.displacementFunc?p[e.displacementFunc]:p.linear,m=[];g.requirePower&&m.push(e.displacementMag),g.requireFastArea&&m.push(e.displacementFastArea);let y=m.length?g.bind(null,...m):g;this.easingFunction=y,this.config=e,this.serializedConfig=t,Object.assign(this,d),this.points?this.points.clear():this.points=new Map}}_serializeConfig({n:e,size:t,margin:i=0,rotation:n=0,center:r,radius:s,reverse:a=!1,distortion:l=0,displacementFunc:o,displacementMag:h,displacementFastArea:u}){return[t?.join(","),r?.join(","),s,i,e,n,a,l].concat("linear"===o?[]:[o,h,u]).join("_")}*generateNails({nailsNumberStart:e=0,getNumber:t}={}){for(let i=0;i<this.config.n;i++)yield{point:this.getPoint(i),number:t?t(i):i+e}}drawNails(e,t){for(let i of this.generateNails(t))e.addNail(i)}*drawRing(e,{ringSize:t,color:i}){let n,{n:r}=this.config,s=Math.floor(t*r),a=0,l=!1;e.setColor(i);for(let t=0;t<r;t++){n||(n=this.getPoint(0));let i=n,o=[];a=l?t:a+s,n=this.getPoint(a),o.push(n),t<r-1&&(a++,n=this.getPoint(a),o.push(n)),e.renderLines(i,...o),yield,l=!l}}static rotationConfig=Object.freeze({key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1+1/360,step:1/360,snap:"0.25, 0.5, 0.75"},displayValue:(e,{key:t})=>`${Math.round(360*e[t])}\xb0`,isStructural:!0,affectsStepCount:!1});static nailsConfig=Object.freeze({key:"n",label:"Number of nails",defaultValue:144,type:"range",attr:{min:3,max:300,step:1},isStructural:!0});static displacementConfig=Object.freeze({key:"displacement",label:"Displacement",type:"group",children:[{key:"displacementFunc",label:"Displacement function",defaultValue:"linear",type:"select",options:Object.keys(p),isStructural:!0,affectsStepCount:!1},{key:"displacementMag",label:"Displacement magnitude",defaultValue:3,type:"range",attr:{min:0,max:10,step:.1},show:({displacementFunc:e})=>p[e].requirePower,isStructural:!0,affectsStepCount:!1},{key:"displacementFastArea",label:"Displacement fast area",defaultValue:.4,type:"range",attr:{min:0,max:.5,step:.01},show:({displacementFunc:e})=>p[e].requireFastArea,isStructural:!0,affectsStepCount:!1}]});static distortionConfig=Object.freeze({key:"distortion",label:"Distortion",defaultValue:0,type:"range",attr:{min:-.99,max:.99,step:.01,snap:"0"},isStructural:!0,affectsStepCount:!1})}const y=l.getConfig({defaults:{isMultiColor:!0,colorCount:7,color:"#ffbb29",multicolorRange:"21",multicolorStart:32,multicolorByLightness:!0,minLightness:36,maxLightness:98},exclude:["repeatColors","mirrorColors"]});class b extends g{id="spiral";name="Spiral";link="https://www.etsy.com/il-en/listing/840974781/boho-wall-decor-artwork-spiral-round";controls=[{...m.nailsConfig,defaultValue:200},{key:"repetition",label:"Repetition",defaultValue:5,type:"range",attr:{min:1,max:20,step:1}},{key:"innerLength",label:"Spiral thickness",defaultValue:.5,type:"range",attr:{min:({config:{n:e}})=>1/e,max:1,step:({config:{n:e}})=>1/e},displayValue:({n:e,innerLength:t})=>Math.round(e*t)},{...m.rotationConfig,defaultValue:.75},m.distortionConfig,y];setUpDraw(){super.setUpDraw();let{n:e,rotation:t,layers:i,margin:n,colorCount:r,repetition:s,distortion:a}=this.config;this.layersCount=i??1,this.realRepetition=2*s-1;let o={size:this.size,n:e,margin:n,rotation:t,distortion:a};this.circle?this.circle.setConfig(o):this.circle=new m(o),this.color=new l({...this.config,colorCount:i??r}),r&&(this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:r}))}*drawSpiral({shift:e=0,color:t="#ffffff"}={}){let{innerLength:i,n:n}=this.config,r=Math.round(i*n),s=0;this.renderer.setColor(t);let a=e,l=this.circle.getPoint(a),o=!1;for(let e=0;r>0;e++){if(this.colorMap){let t=this.colorMap.get(e);t&&this.renderer.setColor(t)}a=o?a-r+1:a+r,s===this.realRepetition?(r--,s=0,a++):s++;let t=this.circle.getPoint(a);this.renderer.renderLines(l,t),l=t,yield e,o=!o}}*generateStrings(){yield*this.drawSpiral({color:this.color.getColor(0)})}getStepCount(){let{innerLength:e,repetition:t,n:i,layers:n=1}=this.config;return Math.round(n*i*(2*e)*t)}drawNails(){this.circle.drawNails(this.nails)}static thumbnailConfig={n:60}}class C extends g{name="Spirals";id="spirals";link="https://www.etsy.com/il-en/listing/974865185/3d-string-art-spiral-mandala-wall?ref=shop_home_active_10&frs=1";controls=[{key:"radiusIncrease",label:"Radius change",defaultValue:5.7,type:"range",attr:{min:1,max:20,step:.1}},{key:"angleStep",label:"Angle step",defaultValue:.45,type:"range",attr:{min:0,max:1,step:.01}},{key:"nSpirals",label:"Number of spirals",defaultValue:3,type:"range",attr:{min:1,max:20,step:1}},{...m.rotationConfig,defaultValue:330/360},l.getConfig({defaults:{isMultiColor:!0,colorCount:4,color:"#00d5ff",multicolorRange:1,multicolorStart:190,multicolorByLightness:!0,minLightness:50,maxLightness:88,reverseColors:!0}})];setUpDraw(){super.setUpDraw();let{nSpirals:e,rotation:t,margin:i,radiusIncrease:n,angleStep:r,colorCount:s}=this.config;this.spiralRotations=Array(e).fill(null).map((t,i)=>i*f/e),this.rotationAngle=-f*t;let a=Math.min(...this.size)/2-i;this.nailsPerSpiral=Math.floor(a/n),this.angleIncrease=r/(a/50),this.color=new l(this.config),this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:s})}*generatePoints(){let{nSpirals:e}=this.config;for(let t=0;t<this.nailsPerSpiral;t++)for(let i=0;i<e;i++){let e=this.getPoint(i,t);yield{point:e,nailNumber:`${i}_${t}`}}}getPoint(e,t){let[i,n]=this.center,{radiusIncrease:r}=this.config,s=this.rotationAngle+this.angleIncrease*t+this.spiralRotations[e],a=t*r;return[i+a*Math.sin(s),n+a*Math.cos(s)]}*generateStrings(){let e=this.generatePoints(),t=0;this.renderer.setColor(this.color.getColor(0));let i=this.center;for(let{point:n}of e){if(this.colorMap){let e=this.colorMap.get(t);e&&this.renderer.setColor(e)}i&&this.renderer.renderLines(i,n),i=n,yield t++}}getStepCount(){let{nSpirals:e,radiusIncrease:t,margin:i}=this.config;return Math.floor((Math.min(...this.getSize())/2-i)/t)*e}drawNails(){for(let{point:e,nailNumber:t}of this.generatePoints())this.nails.addNail({point:e,number:t})}static thumbnailConfig={radiusIncrease:1.4,angleStep:.11}}class S extends g{name="Mandala";id="mandala";link="https://www.youtube.com/watch?v=qhbuKbxJsk8";linkText="Learn";controls=[{key:"n",label:"Number of nails",defaultValue:180,type:"range",attr:{min:3,max:240,step:1}},{key:"base",label:"Multiplication",defaultValue:2,type:"range",attr:{min:2,max:99,step:1}},{key:"layers",label:"Layers",defaultValue:7,type:"range",attr:{min:1,max:20,step:1}},m.rotationConfig,m.distortionConfig,l.getConfig({defaults:{isMultiColor:!0,multicolorRange:180,multicolorStart:256,color:"#ff4d00"},exclude:["colorCount"]})];get n(){if(!this._n){let{n:e,layers:t}=this.config;this._n=e-e%t}return this._n}setUpDraw(){this._n=null,super.setUpDraw();let{layers:e,rotation:t,distortion:i,margin:n,layerFill:r,base:s,reverse:a}=this.config,o={size:this.size,n:this.n,margin:n,rotation:t,distortion:i,reverse:a};this.stringsPerLayer=r?Math.floor(this.n*r):this.n,this.circle?this.circle.setConfig(o):this.circle=new m(o),this.color=new l({...this.config,colorCount:e}),this.layerShift=Math.floor(this.n/e),this.base=s}*drawTimesTable({shift:e=0,color:t="#f00",time:i}){let n=this.n;this.renderer.setColor(t);let r=this.circle.getPoint(e);for(let t=1;t<=this.stringsPerLayer;t++){let s=r;r=this.circle.getPoint(t+e);let a=t*this.base%n;this.renderer.renderLines(s,r,this.circle.getPoint(a+e)),yield{instructions:`${t-1} \u{2192} ${t} \u{2192} ${a} \u{2192} ${t}`,index:i*n+t}}}*generateStrings(){let{layers:e}=this.config;for(let t=0;t<e;t++){let e=this.color.getColor(t);yield*this.drawTimesTable({time:t,color:e,shift:this.layerShift*t})}}drawNails(){this.circle.drawNails(this.nails)}getStepCount(){let{layers:e,layerFill:t}=this.config;return(e??1)*(t?Math.floor(this.n*t):this.n)}static thumbnailConfig={n:70}}class w extends S{id="wave";name="Wave";link="https://www.etsy.com/il-en/listing/943140543/personalized-gift-string-art-mandala?ref=sim_rv-5&pro=1";controls=[{...m.nailsConfig,defaultValue:200},{key:"layerFill",label:"Layer fill",defaultValue:.5,type:"range",attr:{min:({config:{n:e}})=>1/e,max:1,step:({config:{n:e}})=>1/e},displayValue:({layerFill:e})=>Math.floor(100*e)+"%"},{...m.rotationConfig,defaultValue:176/360},m.distortionConfig,{key:"layers",label:"Layers",defaultValue:11,type:"range",attr:{min:1,max:20,step:1}},{key:"layerSpread",label:"Layer spread",defaultValue:.075,type:"range",attr:{min:0,max:1,step:({config:{n:e}})=>1/e},displayValue:({layerSpread:e,n:t})=>Math.round(e*t)},{key:"reverse",label:"Reverse",defaultValue:!0,type:"checkbox"},l.getConfig({defaults:{isMultiColor:!0,multicolorRange:216,multicolorStart:263,color:"#ffffff",multicolorByLightness:!0,minLightness:10,maxLightness:90},exclude:["colorCount"]})];setUpDraw(){super.setUpDraw();let{n:e,layerSpread:t}=this.config;this.layerShift=Math.round(e*t),this.base=2}*generateStrings(){let{layers:e,reverse:t}=this.config;for(let i=0;i<e;i++)yield*this.drawTimesTable({color:this.color.getColor(i),shift:this.layerShift*(t?1:-1)*i,time:i})}static thumbnailConfig={n:70}}const k=["left","bottom","right","top"],x=["left","bottom","right","top"],v={left:0,bottom:Math.PI/2,right:Math.PI,top:1.5*Math.PI};var M=class extends g{name="Eye";id="eye";link="https://www.etsy.com/listing/489853161/rose-of-space-string-art-sacred-geometry?ga_order=most_relevant&ga_search_type=all&ga_view_type=gallery&ga_search_query=string+art&ref=sr_gallery_1&epik=dj0yJnU9WXNpM1BDTnNkLVBtcWdCa3AxN1J5QUZRY1FlbkJ5Z18mcD0wJm49ZXdJb2JXZmVpNVVwN1NKQ3lXMy10ZyZ0PUFBQUFBR0ZuUzZv";controls=[{key:"n",label:"Number of nails per side",defaultValue:82,type:"range",attr:{min:2,max:200,step:1}},{key:"layers",label:"Layers",defaultValue:13,type:"range",attr:{min:1,max:20,step:1}},{key:"angle",label:"Layer angle",defaultValue:30,displayValue:({angle:e})=>`${e}\xb0`,type:"range",attr:{min:0,max:45,step:1}},{key:"color",label:"Color",type:"group",children:[{key:"color1",label:"String #1 color",defaultValue:"#11e8bd",type:"color"},{key:"color2",label:"String #2 color",defaultValue:"#6fff52",type:"color"},{key:"colorPerLayer",label:"Color per layer",defaultValue:!1,type:"checkbox"}]}];setUpDraw(){super.setUpDraw();let{n:e,angle:t,layers:i,margin:n}=this.config;this.maxSize=Math.min(...this.size)-2*n,this.nailSpacing=this.maxSize/(e-1),this.layerAngle=t*Math.PI/180,this.layers=Array(i).fill(null).map((e,t)=>this._getLayerProps(t))}getPoint({index:e,angle:t,layerStart:i,rotation:n}){let r=t+n,s={x:i.x,y:i.y+this.nailSpacing*e},a={x:this.center[0],y:this.center[1]},l=Math.cos(r),o=Math.sin(r);return[l*(s.x-a.x)-o*(s.y-a.y)+a.x,o*(s.x-a.x)+l*(s.y-a.y)+a.y]}*drawSide({side:e,color:t="#ffffff",angle:i,size:n,layerStart:r,layerStringCount:s}){let a=k.indexOf(e),l=k[a===k.length-1?0:a+1],o=v[e],h=v[l],u={layerStringCount:s,size:n,layerStart:r,angle:i};this.renderer.setColor(t);for(let t=0;t<=s;t++)this.renderer.renderLines(this.getPoint({side:e,index:t,rotation:o,...u}),this.getPoint({side:l,index:t,rotation:h,...u})),yield t}_getLayerProps(e){let t=this._getLayerColors(e),i=this.layerAngle*e,n=this.maxSize/Math.pow(Math.cos(this.layerAngle)+Math.sin(this.layerAngle),e),r={x:this.center[0]-n/2,y:this.center[1]-n/2},s=Math.floor(n/this.nailSpacing);return{colors:t,layerAngle:i,layerSize:n,layerStart:r,layerStringCount:s}}_getLayerColors(e){let{color1:t,color2:i,colorPerLayer:n}=this.config;if(!n)return[i,t,i,t];{let n=e%2?t:i;return[n,n,n,n]}}*drawLayer(e){let{colors:t,layerAngle:i,layerSize:n,layerStart:r,layerStringCount:s}=this.layers[e];for(let e=0;e<k.length;e++)yield*this.drawSide({color:t[e],side:x[e],angle:i,size:n,layerStart:r,layerStringCount:s})}*generateStrings(){let{layers:e}=this.config;for(let t=e-1;t>=0;t--)yield*this.drawLayer(t)}getStepCount(){let e=0,{layers:t,angle:i,n:n,margin:r}=this.config,s=i*Math.PI/180,a=Math.min(...this.renderer.getSize())-2*r,l=a/(n-1);for(let i=0;i<t;i++)e+=4*(Math.floor(a/Math.pow(Math.cos(s)+Math.sin(s),i)/l)+1);return e}drawNails(){let{layers:e}=this.config;for(let t=e-1;t>=0;t--){let{layerAngle:e,layerSize:i,layerStart:n,layerStringCount:r}=this.layers[t];for(let s=0;s<k.length;s++){let a=x[s],l=v[a];for(let o=0;o<=r;o++){let h={layerStringCount:r,size:i,layerStart:n,angle:e};this.nails.addNail({point:this.getPoint({sideOrder:a,index:o,rotation:l,...h}),number:`${t}_${s}_${o}`})}}}}static thumbnailConfig={n:25,layers:7}};function L(e){return`${Math.round(100*e)}%`}class N{constructor(e){this.setConfig(e)}#i({radius:e,sides:t,sideNails:i,rotation:n,centerRadius:r=0,maxCurveSize:s=1}){let a=e*r,l=2*Math.PI/t,o=n?-(2*Math.PI)*n/t:0;return{sideAngle:l,nailSpacing:(e-a)/(i-1),centerRadius:a,linesPerRound:t%2?2*t:t,sidesConnectionCount:Math.floor(Math.min(1,s)*i),sideSize:e-a,sides:Array(t).fill(null).map((e,t)=>{let i=t*l+o;return{sinSideAngle:Math.sin(i),cosSideAngle:Math.cos(i)}})}}getPoint(e=0,t=0){let i=this.calc.centerRadius+t*this.calc.nailSpacing,{sinSideAngle:n,cosSideAngle:r}=this.calc.sides[e];return[this.center[0]+n*i,this.center[1]+r*i]}setConfig(e){if(function e(t,i,n){if(t===i)return!0;if("object"==typeof t&&"object"==typeof i){if(null===t!=(null===i))return!1;if(t instanceof Array&&i instanceof Array){if(t.length!==i.length)return!1;for(let n=0;n<t.length;n++)if(!e(t[n],i[n]))return!1;return!0}if(!n&&(n=Object.keys(t)).length!==Object.keys(i).length||n&&n.some(n=>!e(t[n],i[n])))return!1}return t===i}(e,this.config,["radius","sides","sideNails","rotation","center","size","centerRadius","maxCurveSize"]))return;let t=e.center??e.size.map(e=>e/2);this.config=e,this.center=t,this.calc=this.#i(e)}drawNails(e,{getNumber:t,reverseOrder:i,...n}={}){let{sides:r,sideNails:s}=this.config,a=[];for(let e=0;e<r;e++)for(let n=0;n<s;n++){let r=i?s-n:n;a.push({point:this.getPoint(e,r),number:t?t(e,r):r||this.config.centerRadius?`${e}_${r}`:0})}e.addGroup(a,n)}*generateStrings(e,{size:t}={}){let{sideNails:i,sides:n}=this.config,{sidesConnectionCount:r,linesPerRound:s}=this.calc,a=t?Math.max(1,Math.min(Math.floor(t),i)):i,l=Math.max(0,a-r),o=!1,h=n%2?Math.ceil(Math.min(a,r)/2):a-l,u=l,c=this.getPoint(0,u);for(let t=0;t<h;t++){let i=t===h-1,r=0;for(let h=0;h<s;h++){r=(r+1)%n,u=(o=!o)?a-t-1:t+l;let s=this.getPoint(r,u);if(e.renderLines(c,s),c=s,yield,i&&h===n-1&&n%2&&a%2)break}if(!i){u=o?u-1:u+1;let t=this.getPoint(0,u);e.renderLines(c,t),c=t}}}getStepCount(e){return N.getStepCount(this.config,{size:e})}static getStepCount({sides:e,sideNails:t,maxCurveSize:i=1},{size:n}={}){let r=Math.floor(Math.min(1,i)*t),s=n?Math.min(Math.floor(n),t):t,a=Math.max(0,s-r);return(e%2?Math.ceil(Math.min(s,r)/2):s-a)*(e%2?2*e:e)-(e%2&&s%2?e:0)}static nailsConfig=Object.freeze({key:"sideNails",label:"Nails per side",defaultValue:40,type:"range",attr:{min:1,max:200,step:1},isStructural:!0});static sidesConfig=Object.freeze({key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:40,step:1},isStructural:!0});static maxCurveSize=Object.freeze({key:"maxCurveSize",label:"Max curve size",description:"The maximum number of connections used to create a curve between two sides.",defaultValue:1,type:"range",displayValue:({maxCurveSize:e,sideNails:t})=>Math.floor(e*t),attr:{min:0,max:1,step:({config:{sideNails:e}})=>1/e},isStructural:!0});static centerRadiusConfig=Object.freeze({key:"centerRadius",label:"Center radius",defaultValue:0,type:"range",attr:{min:0,max:({config:{sideNails:e}})=>(e-1)/e,step:.01},displayValue:({centerRadius:e})=>L(e),isStructural:!0});static rotationConfig=Object.freeze({key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01,snap:"0.5"},displayValue:(e,{key:t})=>`${Math.round(360*e[t])}\xb0`,isStructural:!0,affectsStepCount:!1});static StarConfig=Object.freeze([N.nailsConfig,N.sidesConfig,N.centerRadiusConfig,N.maxCurveSize,N.rotationConfig])}class z extends g{name="Star";id="star";link="https://www.etsy.com/listing/557818258/string-art-meditation-geometric-yoga?epik=dj0yJnU9Mm1hYmZKdks1eTc3bVY2TkVhS2p2Qlg0N2dyVWJxaTEmcD0wJm49MGlWSXE1SVJ2Vm0xZ0xtaGhITDBWQSZ0PUFBQUFBR0Zwd2lj";controls=[{key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:20,step:1}},{key:"sideNails",label:"Nails per side",defaultValue:40,type:"range",attr:{min:1,max:200,step:1}},N.centerRadiusConfig,{key:"ringSize",label:"Outer ring size",defaultValue:.1,type:"range",attr:{min:0,max:.5,step:({config:{sideNails:e,sides:t}})=>1/(e*t)},displayValue:({sideNails:e,sides:t,ringSize:i})=>Math.floor(i*e*t)},function(e,t){let i=e.attr;if(!i)return e;let n={...i};return delete n[t],{...e,attr:n}}(m.rotationConfig,"snap"),m.distortionConfig,{key:"colorGroup",label:"Color",type:"group",children:[{key:"innerColor",label:"Star color",defaultValue:"#2ec0ff",type:"color"},{key:"outterColor",label:"Outter color",defaultValue:"#2a82c6",type:"color"},{key:"ringColor",label:"Ring color",defaultValue:"#2ec0ff",type:"color"}]}];#n=null;get n(){if(!this._n){let{n:e,sides:t}=this.config;this._n=e-e%t}return this._n}setUpDraw(){this._n=null,super.setUpDraw();let{sides:e,rotation:t,distortion:i,sideNails:n,margin:r=0}=this.config,s={size:this.size,n:n*e,margin:r,rotation:t?t/e:0,distortion:i};this.circle?this.circle.setConfig(s):this.circle=new m(s);let a={...this.config,radius:this.circle.radius,size:this.size};this.#n?this.#n.setConfig(a):this.#n=new N(a)}getArcPoint({side:e,sideIndex:t}){return this.circle.getPoint(e*this.config.sideNails+t)}*drawStar(){let{innerColor:e}=this.config;this.renderer.setColor(e),yield*this.#n.generateStrings(this.renderer)}*drawCircle(){let{outterColor:e,sides:t,sideNails:i}=this.config;this.renderer.setColor(e);let n=this.#n.getPoint(0,0),r=!1,s=!1,a=t%2?Math.ceil(i/2):i,l=0,o=t%2?4*t:2*t;for(let e=0;e<=a;e++){let h=o-(e===a?2*t:0);for(let a=0;a<h;a++){let a={side:l,sideIndex:r?i-e-1:e},o=s?this.#n.getPoint(a.side,a.sideIndex):this.getArcPoint(a);this.renderer.renderLines(n,o),n=o,yield,(s=!s)&&(l=l!==t-1?l+1:0,r=!r)}n=this.#n.getPoint(0,e+1)}}*generateStrings(){yield*this.drawCircle();let{ringSize:e,ringColor:t}=this.config;0!==e&&(yield*this.circle.drawRing(this.renderer,{ringSize:e,color:t})),yield*this.drawStar()}drawNails(){this.circle.drawNails(this.nails),this.#n.drawNails(this.nails),this.circle.drawNails(this.nails)}#r(){let{sides:e,sideNails:t}=this.config;return((e%2?Math.ceil(t/2):t)+1)*(e%2?4*e:2*e)-2*e}getStepCount(){let{sides:e,sideNails:t,ringSize:i}=this.config;return this.#r()+(i?t*e:0)+N.getStepCount(this.config)}static thumbnailConfig={sideNails:18}}const V=[{size:.25,end:1,color:"#a94fb0"},{size:.125,end:.888,color:"#ec6ad0"},{size:0,end:.826,color:"#f08ad5",reverse:!0}];class _ extends g{name="Assymetry";id="assymetry";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[m.nailsConfig,m.rotationConfig,m.distortionConfig,{key:"layers",label:"Layers",type:"group",children:V.map(({size:e,end:t,color:i,reverse:n},r)=>{let s=r+1;return{key:`layer${s}`,label:`Layer ${s}`,type:"group",children:[{key:`show${s}`,label:"Enable",defaultValue:!0,type:"checkbox"},{key:`size${s}`,label:"Size",defaultValue:e,type:"range",attr:{min:0,max:.5,step:({config:{n:e}})=>1/e},displayValue:(e,{key:t})=>Math.round(e.n*e[t]),show:e=>e[`show${s}`]},{key:`end${s}`,label:"End Position",defaultValue:t,type:"range",attr:{min:0,max:1,step:({config:{n:e}})=>1/e},displayValue:(e,{key:t})=>Math.round(e.n*e[t]),show:e=>e[`show${s}`]},{key:`color${s}`,label:"Color",defaultValue:i,type:"color",show:e=>e[`show${s}`]},{key:`reverse${s}`,label:"Reverse",defaultValue:!0===n,type:"checkbox",show:e=>e[`show${s}`]}]}})}];setUpDraw(){super.setUpDraw(),Object.assign(this,this.getSetUp())}getSetUp(){let e,{rotation:t,n:i,margin:n=0,distortion:r}=this.config,s={size:this.getSize(),n:i,margin:n,rotation:t-.25,distortion:r};this.circle?(e=this.circle,this.circle.setConfig(s)):e=new m(s);let a=e.indexAngle*e.radius,l=Math.floor(e.radius/a)-1;a+=(e.radius-a*l)/l;let o=e.getPoint(0),h=l+i;return{circle:e,lineSpacing:a,lineNailCount:l,firstCirclePoint:o,layers:[,,,].fill(null).map((e,t)=>u.call(this,t+1)).filter(({enable:e})=>e),totalNailCount:h,totalIndexCount:h+l};function u(e){let t=Math.round(i*this.config["size"+e])+l;return{size:t,endIndex:Math.round(this.config["end"+e]*(h+l))-t,color:this.config["color"+e],enable:this.config["show"+e],isReverse:this.config["reverse"+e]}}}getPoint(e){if(e<this.lineNailCount||e>this.totalNailCount){let t=(e<this.lineNailCount?this.lineNailCount-e:e-this.totalNailCount)*this.lineSpacing;return[this.firstCirclePoint[0]-t*Math.sin(this.circle.rotationAngle),this.firstCirclePoint[1]-t*Math.cos(this.circle.rotationAngle)]}{let t=e-this.lineNailCount;return this.circle.getPoint(t)}}*drawCircle({endIndex:e,color:t,isReverse:i,size:n}){let r,s,a=!1;this.renderer.setColor(t);let l=this,o=i?-1:1;for(let t=0;t<=e;t++){let e=r??this.getPoint(h(t)),i=[];r&&i.push(this.getPoint(s+o)),s=h(a?t:t+n),i.push(r=this.getPoint(s)),this.renderer.renderLines(e,...i),yield,a=!a}function h(e){return i?l.totalIndexCount-e:e}}*generateStrings(){for(let e of this.layers)yield*this.drawCircle(e)}drawNails(){this.circle.drawNails(this.nails,{nailsNumberStart:this.lineNailCount});for(let e=0;e<this.lineNailCount;e++)this.nails.addNail({point:this.getPoint(e),number:e})}getStepCount(){let{layers:e}=this.getSetUp();return e.reduce((e,t)=>e+t.endIndex+1,0)}static thumbnailConfig={n:50}}class R extends g{name="Freestyle";id="freestyle";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[{key:"n",label:"Circle nails",defaultValue:80,type:"range",attr:{min:1,max:300,step:1}},{key:"minNailDistance",label:"Min nail distance",defaultValue:20,type:"range",attr:{min:1,max:300,step:1}},{key:"color",label:"Color",defaultValue:"#ec6ad0",type:"color"},{key:"layers",label:"Layers",type:"group",children:[{key:"layer1",label:"Layer 1",type:"group",children:[{key:"show1",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius1",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show1:e})=>e},{key:"x1",label:"Position X",defaultValue:.5,type:"range",attr:{min:0,max:1,step:.01},show:({show1:e})=>e},{key:"y1",label:"Position Y",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01},show:({show1:e})=>e},{...m.rotationConfig,key:"rotation1",show:({show1:e})=>e},{key:"reverse1",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show1:e})=>e}]},{key:"layer2",label:"Layer 2",type:"group",children:[{key:"show2",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius2",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show2:e})=>e},{key:"x2",label:"Position X",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01},show:({show2:e})=>e},{key:"y2",label:"Position Y",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show2:e})=>e},{...m.rotationConfig,key:"rotation2",show:({show2:e})=>e},{key:"reverse2",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show2:e})=>e}]},{key:"layer3",label:"Layer 3",type:"group",children:[{key:"show3",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius3",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show3:e})=>e},{key:"x3",label:"Position X",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show3:e})=>e},{key:"y3",label:"Position Y",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show3:e})=>e},{...m.rotationConfig,key:"rotation3",show:({show3:e})=>e},{key:"reverse3",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show3:e})=>e}]}]}];setUpDraw(){super.setUpDraw(),Object.assign(this,this.getSetUp())}getSetUp(){let{n:e,margin:t=0,minNailDistance:i}=this.config,n=this.getSize(),r=Math.min(...n.map(e=>e-2*t))/2,s=[,,,].fill(null).map((e,t)=>l.call(this,t+1)).filter(({enable:e})=>e),a=Math.max(...s.map(({circle:e})=>e.config.n));return{layers:s,maxShapeNailsCount:a};function l(s){let a=e=>this.config[e+s],l={enable:a("show"),isReverse:a("reverse"),position:[a("x"),a("y")],radius:r*a("radius"),rotation:a("rotation")},o=Math.min(e,Math.floor(2*Math.PI*l.radius/i));return{circle:new m({radius:l.radius,center:l.position.map((e,i)=>l.radius+t+(n[i]-(l.radius+t)*2)*e),n:o,rotation:l.rotation,reverse:l.isReverse}),...l}}}getPoint(e,t){let{circle:i}=e,n=Math.round(t*i.config.n/this.maxShapeNailsCount);return i.getPoint(n)}*generateStrings(){let e,{n:t,color:i}=this.config;this.renderer.setColor(i);for(let t=0;t<this.maxShapeNailsCount;t++)for(let i=0;i<this.layers.length;i++){let n=this.layers[i],r=e??this.getPoint(n,t),s=[];0===i&&t&&s.push(this.getPoint(n,t));let a=i+1;a===this.layers.length&&(a=0),e=this.getPoint(this.layers[a],t),this.renderer.renderLines(r,e),yield}}drawNails(){this.config,this.layers.forEach(({circle:e},t)=>e.drawNails(this.nails,{getNumber:e=>`${t+1}_${e+1}`}))}getStepCount(){let{layers:e,maxShapeNailsCount:t}=this.getSetUp();return e.length*t-1}static thumbnailConfig={minNailDistance:3}}class P{constructor(e){this.setConfig(e)}setConfig(e){if(this._serializeConfig(e)!==this.serializedConfig){let{rotation:t=0,sides:i}=this.config=e,n=f/i;Object.assign(this,{sides:Array(i).fill(null).map((e,i)=>{let r=n*i+f*t,s=-n*(i-.5)-f*t;return{cos:Math.cos(r),sin:Math.sin(r),center:{cos:Math.cos(s),sin:Math.sin(s)}}}),sideCount:i,sideAngle:n}),this.points?this.points.clear():this.points=new Map,Object.assign(this,this._getProps()),e.fitSize&&(Object.assign(this,this._getProps(this.getSizeAndCenter())),this.points.clear())}}getSizeAndCenter(){let{size:e,margin:t}=this.config,i=this.getBoundingRect(),n=Math.min((e[0]-2*t)/i.width,(e[1]-2*t)/i.height),r=e.map(e=>e*n),s=[this.center[0]-n*(i.left-e[0]+i.right)/2,this.center[1]-n*(i.top-e[1]+i.bottom)/2];return this.points.clear(),{size:r,center:s}}_getProps(e){let{nailsSpacing:t,size:i,margin:n=0,center:r}=Object.assign({},this.config,e),s=r??this.config.size.map(e=>e/2),a=Math.min(...i)/2-n,l=2*a*Math.sin(this.sideAngle/2),o=[a*Math.sin(this.sideAngle/2),a*Math.cos(this.sideAngle/2)],h=l*t,u=Math.floor(a/h);return{nailsSpacing:t,nailsPerSide:1/t,center:s,radius:a,sideSize:l,start:o,nailsDistance:h,radiusNailsCount:u,radiusNailsDistance:a/u}}_serializeConfig({size:e,margin:t=0,rotation:i=0,center:n,sides:r}){return[e?.join(","),n?.join(","),r,t,i].join("_")}getSidePoint({side:e,index:t}){let i=[e,t].join("_");if(this.points.has(i))return this.points.get(i);let n=this.start[0]-t*this.nailsDistance,{cos:r,sin:s}=this.sides[e],a=[r*n-s*this.start[1]+this.center[0],s*n+r*this.start[1]+this.center[1]];return this.points.set(i,a),a}getCenterPoint({side:e,index:t}){let i=t*this.radiusNailsDistance,{sin:n,cos:r}=this.sides[e].center;return[this.center[0]+n*i,this.center[1]+r*i]}getBoundingRect(){let e=this.sides.map((e,t)=>this.getSidePoint({side:t,index:0})),t=e[0],i=e.slice(1).reduce((e,[t,i])=>({left:Math.min(e.left,t),right:Math.max(e.right,t),top:Math.min(e.top,i),bottom:Math.max(e.bottom,i)}),{left:t[0],right:t[0],top:t[1],bottom:t[1]});return i.height=i.bottom-i.top,i.width=i.right-i.left,Object.freeze(i),i}drawNails(e,{drawCenter:t=!1,drawSides:i=!0}={}){for(let n=0;n<this.sideCount;n++){let r=n*this.nailsPerSide;if(i)for(let t=0;t<this.nailsPerSide;t++)e.addNail({point:this.getSidePoint({side:n,index:t}),number:r+t});if(t)for(let t=0;t<this.radiusNailsCount;t++)e.addNail({point:this.getCenterPoint({side:n,index:t}),number:`${n}_${t}`})}}}const E=l.getConfig({defaults:{isMultiColor:!0,color:"#ff0000",multicolorRange:1,multicolorStart:0,multicolorByLightness:!0,minLightness:20,maxLightness:50},exclude:["colorCount"]});class A extends g{name="Polygon";id="polygon";controls=[{key:"sides",label:"Sides",defaultValue:5,type:"range",attr:{min:3,max:10,step:1}},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:1,max:100,step:1}},{key:"bezier",label:"Bezier",defaultValue:2,type:"range",attr:{min:1,max:4,step:1},show:({sides:e})=>e>4},m.rotationConfig,E];defaultValues={nailsColor:"#5c5c5c",nailRadius:1};setUpDraw(){super.setUpDraw();let{n:e,rotation:t,sides:i,margin:n,isMultiColor:r}=this.config,s={sides:i,rotation:t,margin:n,size:this.getSize(),nailsSpacing:1/e,fitSize:!0};this.polygon?this.polygon.setConfig(s):this.polygon=new P(s),this.color=new l({...this.config,isMultiColor:r,colorCount:i}),r?this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:i}):this.colorMap=null}*generateStrings(){let{sides:e,bezier:t}=this.config,i=Math.min(t,Math.ceil(e/2)-1),n=0;this.renderer.setColor(this.color.getColor(0));for(let t=0;t<e;t++){let r=(t+i)%e;this.colorMap&&this.renderer.setColor(this.colorMap.get(n));for(let e=0;e<this.polygon.nailsPerSide;e++)this.renderer.renderLines(this.polygon.getSidePoint({side:t,index:e}),this.polygon.getSidePoint({side:r,index:e})),yield,n++}}getStepCount(){let{sides:e,n:t}=this.config;return e*t}drawNails(){this.polygon.drawNails(this.nails)}static thumbnailConfig={n:20}}const I=l.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:264,multicolorStart:53,multicolorByLightness:!1,minLightness:30,maxLightness:70},exclude:["colorCount"]});class T extends g{name="Flower";id="flower";link="https://www.sqrt.ch/Buch/fadenmodell4_100.svg";controls=[{key:"sides",label:"Sides",defaultValue:4,type:"range",attr:{min:3,max:10,step:1}},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:1,max:100,step:1}},{key:"layers",label:"Layers",defaultValue:2,type:"range",attr:{min:1,max:10,step:1}},m.rotationConfig,I];defaultValues={nailsColor:"#29f1ff",nailRadius:1,stringWidth:.5};setUpDraw(){super.setUpDraw();let{n:e,rotation:t,sides:i,layers:n,margin:r,isMultiColor:s}=this.config,a=this.getSize(),o=1/(i*n);this.polygons=Array(n).fill(null).map((n,s)=>new P({sides:i,rotation:t+s*o,margin:r,size:a,nailsSpacing:1/e})),this.color=new l({...this.config,isMultiColor:s,colorCount:n}),s?this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:n}):this.colorMap=null}*generateStrings(){let{sides:e,layers:t}=this.config,i=0;this.renderer.setColor(this.color.getColor(0));for(let n=0;n<t;n++){let t=this.polygons[n];for(let n=0;n<e;n++){let r=n===e-1?0:n+1;for(let e=0;e<=t.nailsPerSide;e++){this.colorMap?.has(i)&&this.renderer.setColor(this.colorMap.get(i));let s=this.getCenterIndexes({polygon:t,sideIndex:e});this.renderer.renderLines(t.getCenterPoint({side:n,index:s[0]}),t.getSidePoint({side:n,index:e}),t.getCenterPoint({side:r,index:s[1]})),yield,i++}}}}getCenterIndexes({polygon:e,sideIndex:t}){let i=e.nailsPerSide-e.radiusNailsCount;return[t<i?-i+t:t-i,e.radiusNailsCount-t]}getStepCount(){let{sides:e,n:t,layers:i}=this.config;return e*(t+1)*i}drawNails(){this.polygons.forEach(e=>e.drawNails(this.nails,{drawCenter:!0}))}static thumbnailConfig={n:20}}const D=l.getConfig({defaults:{isMultiColor:!0,color:"#ffffff",multicolorRange:133,multicolorStart:239,multicolorByLightness:!1,minLightness:30,maxLightness:70,colorCount:4},exclude:["repeatColors","mirrorColors"]});class O extends g{name="Maurer Rose";id="maurer_rose";link="https://blog.glitch.land/en/posts/maurer-rose/";linkText="Learn";controls=[{key:"n",label:"N",defaultValue:4,type:"range",attr:{min:1,max:12,step:1},isStructural:!0},{key:"maxSteps",label:"Max steps",defaultValue:512,type:"range",attr:{min:3,max:720,step:1},isStructural:!0},{key:"angle",label:"Angle",defaultValue:341,type:"range",attr:{min:1,max:720,step:1},displayValue:({angle:e})=>`${e}\xb0`,isStructural:!0},m.rotationConfig,D];resetStructure(){super.resetStructure(),this.points&&this.points.clear(),this.calc=null}setUpDraw(){super.setUpDraw();let{isMultiColor:e,colorCount:t}=this.config;this.calc||(this.calc=this.getCalc()),this.points||(this.points=new Map),this.stepCount||(this.stepCount=this.getStepCount()),this.color=new l({...this.config,isMultiColor:e,colorCount:t}),e?this.colorMap=this.color.getColorMap({stepCount:this.stepCount,colorCount:t}):this.colorMap=null}getCalc(){let{n:e,angle:t,rotation:i,maxSteps:n}=this.config,r=this.getSize();return{n:e,angleRadians:f*t/n,radius:Math.min(...r)/2,currentSize:r,rotationAngle:-(2*Math.PI)*i}}getPoint(e){if(this.points.has(e))return this.points.get(e);let t=e*this.calc.angleRadians,i=this.calc.radius*Math.sin(this.calc.n*t),n=[this.center[0]-i*Math.cos(t-this.calc.rotationAngle),this.center[1]-i*Math.sin(t-this.calc.rotationAngle)];return this.points.set(e,n),n}*generatePoints(){let e=this.stepCount;for(let t=0;t<e+1;t++)yield{point:this.getPoint(t),index:t}}*generateStrings(){let e,t=this.generatePoints();for(let{point:i,index:n}of(this.renderer.setColor(this.color.getColor(0)),t)){if(!e){e=i;continue}if(this.colorMap){let e=this.colorMap.get(n);e&&this.renderer.setColor(e)}this.renderer.renderLines(e,i),e=i,yield}}getStepCount(){if(this.stepCount)return this.stepCount;let{maxSteps:e,angle:t,n:i}=this.config,n=function e(t,i){return i?e(i,t%i):t}(e,t),r=e/n;return!(r%2)&&i%2&&(r/=2),Math.round(r)}drawNails(){for(let{point:e,index:t}of this.generatePoints())this.nails.addNail({point:e,number:t})}static thumbnailConfig={maxSteps:160,angle:213}}const $=l.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:43,multicolorStart:25,multicolorByLightness:!0,minLightness:40,maxLightness:95,colorCount:3,repeatColors:!0,saturation:83,reverseColors:!0},customControls:[{key:"colorPerLevel",label:"Color per level",defaultValue:!0,type:"checkbox"}]}),B=-f/6,F=Array(6).fill(null).map((e,t)=>Math.PI/2+B*t),G=l.getConfig({defaults:{isMultiColor:!0,color:"#ff0000",multicolorRange:133,multicolorStart:239,multicolorByLightness:!1,minLightness:30,maxLightness:70,colorCount:4},customControls:[{key:"colorPerLayer",label:"Color per layer",defaultValue:!0,type:"checkbox"}]}),U={evenly:{f:(e,{ringSize:t,layers:i,n:n})=>Math.floor((i-e)*Math.floor(n*t)/i),name:"Evenly"},distance:{f:(e,{n:t,ringSize:i,layerDistance:n})=>{let r=Math.floor(t*i);return e>0?r-e*n:r},name:"Specific distance"}};class j extends g{name="Comet";id="comet";controls=[m.nailsConfig,{key:"layers",label:"Layers",defaultValue:5,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},{key:"ringSize",label:"First layer size",description:"Nail count from the top center nail to the first connected nail in the first layer",defaultValue:.3,type:"range",attr:{min:0,max:1,step:.01},displayValue:({ringSize:e,n:t})=>Math.floor(t*e),isStructural:!0},{key:"layerSpread",label:"Layer Spread",type:"select",defaultValue:"distance",options:Object.entries(U).map(([e,{name:t}])=>({value:e,label:t})),isStructural:!0},{key:"layerDistance",label:"Layer Distance",type:"range",attr:{min:1,max:({config:{n:e,layers:t}})=>Math.floor(e/2/t),step:1},defaultValue:1,isStructural:!0,show:({layerSpread:e})=>"evenly"!==e},m.rotationConfig,m.distortionConfig,m.displacementConfig,G];defaultValues={n:51,layers:11,colorPerLayer:!0,multicolorRange:203,multicolorStart:137,ringSize:.47,rotation:.25,distortion:.38,displacementFunc:"fastInOut",displacementMag:1.8,displacementFastArea:.43,layerSpread:"distance",layerDistance:1};resetStructure(){this.points&&this.points.clear(),this.layerRingDistances&&this.layerRingDistances.clear()}setUpDraw(){super.setUpDraw();let e={size:this.size,n:this.config.n,margin:this.config.margin,rotation:this.config.rotation,distortion:this.config.distortion,displacementFunc:this.config.displacementFunc,displacementMag:this.config.displacementMag,displacementFastArea:this.config.displacementFastArea};this.circle?this.circle.setConfig(e):this.circle=new m(e),this.stepCount||(this.stepCount=this.getStepCount());let{isMultiColor:t,colorCount:i,layers:n,colorPerLayer:r}=this.config,s=t?r?n:Math.min(i,n):1;this.color=new l({...this.config,isMultiColor:t,colorCount:s})}getCalc(){let{n:e}=this.config,t=this.getSize();return{n:e,angleRadians:f*angle/maxSteps,radius:Math.min(...t)/2,currentSize:t,rotationAngle:-(2*Math.PI)*rotation}}getLayerRingDistance(e){let t=U[this.config.layerSpread];if(!t)throw Error(`Invalid spread mode, "${this.config.layerSpread}"!`);return t.f(e,this.config)}getLayerRingStepCount(e){let t=this.getLayerRingDistance(e);return(this.config.n-t+1)*2-1}*drawLayer(e=0){let{n:t}=this.config,i=this.getLayerRingDistance(e),n=t-i+1,r=this.circle.getPoint(0),s=0;this.renderer.setColor(this.color.getColor(e));for(let e=0;e<t-i+1;e++){let t=e+i,a=this.circle.getPoint(t);this.renderer.renderLines(r,a),yield,e!==n-1&&(s=e+1,r=this.circle.getPoint(s),this.renderer.renderLines(a,r),yield)}}*generateStrings(){for(let e=0;e<this.config.layers;e++)yield*this.drawLayer(e)}getStepCount(){if(this.stepCount)return this.stepCount;let{layers:e}=this.config;return Array(e).fill(0).reduce((e,t,i)=>e+this.getLayerRingStepCount(i),0)}drawNails(){this.circle.drawNails(this.nails)}static thumbnailConfig={n:24,layers:8}}class q extends g{name="Sun";id="sun";controls=[{key:"starGroup",label:"Star",type:"group",children:[...s([...N.StarConfig,l.getConfig({defaults:{isMultiColor:!0,multicolorRange:1,multicolorStart:237,color:"#ffffff",saturation:40,multicolorByLightness:!0,minLightness:20,maxLightness:97},exclude:["colorCount"]})],"sides",[{key:"layers",label:"Layers",defaultValue:4,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},{key:"layerSpread",label:"Layer spread",defaultValue:.1625,type:"range",displayValue:({layerSpread:e,sideNails:t})=>Math.ceil(t*e),attr:{min:({config:{sideNails:e,layers:t}})=>1/(t*e),max:({config:{layers:e}})=>1/(e-1)-.02,step:({config:{sideNails:e,layers:t}})=>1/(t*e)},isStructural:!0},{key:"starRadius",label:"Star Radius",defaultValue:1,type:"range",displayValue:({starRadius:e})=>L(e),attr:{min:.2,max:1,step:.01},isStructural:!0,affectsStepCount:!1}])]},{key:"backdrop",label:"Backdrop",type:"group",children:[{key:"backdropSize",label:"Backdrop size",defaultValue:.5,type:"range",displayValue:({backdropSize:e})=>L(e),attr:{min:0,max:1,step:({config:{sideNails:e}})=>1/e},isStructural:!0},{key:"backdropRadius",label:"Backdrop radius",defaultValue:1,type:"range",displayValue:({backdropRadius:e})=>L(e),attr:{min:0,max:1,step:.01},isStructural:!0,affectsStepCount:!1},{key:"backdropShift",label:"Backdrop shift",defaultValue:0,type:"range",displayValue:({backdropShift:e})=>L(e),attr:{min:0,max:1,step:({config:{sideNails:e,backdropSize:t}})=>(1/(e*(1-t))).toFixed(3)},isStructural:!0,affectsStepCount:!1},{key:"backdropSkip",label:"Backdrop skip",description:"If yes, connections in the backdrop are from the backdrop's nail to the second-nearest side, not the ones near it",defaultValue:!1,type:"checkbox",isStructural:!0,affectsStepCount:!1,show:({sides:e})=>e>3},l.getConfig({defaults:{isMultiColor:!0,multicolorRange:39,multicolorStart:0,color:"#ffffff",backdropColorCount:2,saturation:57,multicolorByLightness:!0,minLightness:20,maxLightness:40},propMapper:({key:e,show:t})=>(e[0].toUpperCase(),e.slice(1),{key:"backdrop"+e[0].toUpperCase()+e.slice(1),show:t?({backdropIsMultiColor:t})=>"color"===e?!t:t:null}),groupLabel:"Backdrop color",maxColorCount:2})]}];mapCommonControls(e){return s(e,"nailsColor",[{key:"backdropNailsColor",label:"Backdrop nails color",type:"color",defaultValue:"#ffffff",show:({showNails:e})=>e},{key:"backdropNailsRadius",label:"Backdrop nails radius",type:"range",defaultValue:1.5,attr:{min:.5,max:5,step:.25},show:({showNails:e})=>e}])}#s=null;#n=null;defaultValues={sideNails:50,sides:16,layers:4,layerSpread:.18,backdropSize:.26,backdropRadius:.9,backdropShift:.59,backdropColorCount:2,centerRadius:.2,maxCurveSize:.64,rotation:.5,saturation:73,multicolorStart:206,multicolorRange:1,multicolorByLightness:!0,minLightness:35,maxLightness:100,nailsColor:"#000000",backdropNailsColor:"#ffffff",backdropNailsRadius:2.275};getCalc(){let{sideNails:e,backdropSize:t}=this.config;return{backdropNails:Math.floor(e*t)}}resetStructure(){super.resetStructure(),this.calc=null}setUpDraw(){super.setUpDraw();let{margin:e=0,layers:t,backdropRadius:i=1,backdropSize:n,rotation:r,sides:s,starRadius:a=1,backdropColorCount:o}=this.config,h=Math.min(...this.size.map(e=>e/2))-e;this.calc||(this.calc=this.getCalc());let u={...this.config,radius:n&&a<i?h*a/i:h,size:this.size};this.#n?this.#n.setConfig(u):this.#n=new N(u),this.color=new l({...this.config,colorCount:t}),this.backdropColor=new l({...function(e,t){let i={};return Object.entries(e).forEach(([e,n])=>i[t(e,n)]=n),i}(this.config,e=>{let t=e.match(/^backdrop(\w)(.+)/);return t?t[1].toLowerCase()+t[2]:e}),colorCount:o});let c={size:this.size,n:s,rotation:-1/s/2+(r?r/s:0),radius:i<a?h*i/a:h};this.#s?this.#s.setConfig(c):this.#s=new m(c)}*drawStar(e){yield*this.#n.generateStrings(this.renderer,{size:e})}*generateLayers(){let{sideNails:e,layerSpread:t,layers:i}=this.config;for(let n=0;n<i;n++){let i=this.color.getColor(n);this.renderer.setColor(i);let r=Math.floor(e*(1-t*n));yield*this.drawStar(r)}}*drawBackdrop(){let e,{backdropNails:t}=this.calc,{sides:i,backdropShift:n,sideNails:r,backdropSkip:s}=this.config,a=s&&i>3,l=0,o=Math.floor(n*(r-t))+t-1;for(let n=0;n<i;n++){this.renderer.setColor(this.backdropColor.getColor(n%2?0:1));let r=this.#s.getPoint(a?(n+1)%i:n),s=!1,h=n%2?1:-1;e=this.#n.getPoint(n,o);for(let u=0;u<t;u++)if(this.renderer.renderLines(e,r),yield,l=(s?n:n+(a?3:1))%i,e=this.#n.getPoint(l,o),this.renderer.renderLines(r,e),yield,u<t-1){s=!s,o+=h;let t=this.#n.getPoint(l,o);this.renderer.renderLines(e,t),e=t}}}*generateStrings(){yield*this.drawBackdrop(),yield*this.generateLayers()}drawNails(){let{backdropSize:e,backdropNailsColor:t,backdropNailsRadius:i}=this.config;if(this.#n.drawNails(this.nails),e){let e=[];for(let t of this.#s.generateNails())e.push(t);this.nails.addGroup(e,{color:t,radius:i})}}getStepCount(){let{layers:e,layerSpread:t,sideNails:i,sides:n}=this.config,{backdropNails:r}=this.getCalc(),s=n*r*2;for(let n=0;n<e;n++){let e=Math.floor(i*(1-t*n));s+=N.getStepCount(this.config,{size:e})}return s}static thumbnailConfig={sideNails:10}}const W=[z,_,S,b,C,w,M,R,A,T,O,class extends g{name="Flower of Life";id="flower_of_life";link="https://www.reddit.com/r/psychedelicartwork/comments/mk97gi/rainbow_flower_of_life_uv_reactive_string_art/";controls=[{key:"levels",label:"Levels",defaultValue:3,type:"range",attr:{min:1,max:10,step:1},isStructural:!0},{key:"density",label:"Density",defaultValue:10,type:"range",attr:{min:1,max:50,step:1},isStructural:!0},{key:"globalRotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:30,step:1},displayValue:(e,{key:t})=>`${e[t]}\xb0`,isStructural:!0,affectsStepCount:!1},{key:"fillGroup",label:"Fill",type:"group",children:[{key:"fill",label:"Show fill",defaultValue:!0,type:"checkbox",isStructural:!0},{key:"fillColor",label:"Fill color",defaultValue:"#292e29",type:"color",show:({fill:e})=>e}]},{key:"ringGroup",label:"Ring",type:"group",children:[{key:"renderRing",label:"Show outer ring",type:"checkbox",defaultValue:!0,isStructural:!0},{key:"ringNailCount",label:"Ring nail count",defaultValue:144,type:"range",attr:{min:3,max:360,step:1},show:({renderRing:e})=>e,isStructural:!0},{key:"ringSize",label:"Outer ring size",defaultValue:.23,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:e})=>e,displayValue:({ringSize:e})=>L(e),isStructural:!0},{key:"ringPadding",label:"Ring padding",defaultValue:.06,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:e})=>e,isStructural:!0,displayValue:({ringPadding:e})=>L(e)},{key:"ringColor",label:"Ring color",defaultValue:"#e8b564",type:"color",show:({renderRing:e})=>e}]},{key:"renderTriangles",label:"Show triangles",defaultValue:!0,type:"checkbox",isStructural:!0},{key:"renderCaps",label:"Show caps",defaultValue:!0,type:"checkbox",show:({renderTriangles:e})=>e,isStructural:!0},$];defaultValues={nailsColor:"#474747"};getCalc(){let{levels:e,density:t,margin:i,globalRotation:n,renderCaps:r,fill:s,renderTriangles:a,renderRing:l,ringNailCount:o,ringSize:h,ringPadding:u}=this.config,c=n*Math.PI/180+Math.PI/6,d=l?Math.min(...(this.size??this.getSize()).map(e=>e/2-i)):null,g=l?Math.floor(h*o/2):0,p=l?d*(1-Math.cos(g/o*f/2)):0,m=new P({sides:6,size:this.getSize(),margin:i+p+(l&&h?u*d:0),rotation:c,fitSize:!1}).sideSize/e,y=m/(2*Math.cos(Math.PI/6)),b=Array(e+ +!!r).fill(null).map((e,t)=>2*t+1);return{edgeSize:m,triangleHeight:m*Math.sqrt(3)/2,nailsLength:y,triangleCenterDistance:m/2,nailDistance:y/t,triangleCount:6*e**2,countPerLevelSide:b,globalRotationRadians:c,fill:s,renderTriangles:a,renderCaps:r,ringNailCount:o,radius:d}}resetStructure(){super.resetStructure(),this.points=null,this.calc=null}setUpDraw(){super.setUpDraw();let{isMultiColor:e,levels:t,colorPerLevel:i,colorCount:n,renderRing:r,ringSize:s,...a}=this.config;if(this.calc||(this.calc=this.getCalc()),r&&s){let e={size:this.size,n:this.calc.ringNailCount,margin:a.margin,rotation:a.globalRotation};this.circle?this.circle.setConfig(e):this.circle=new m(e)}else this.circle=null;this.points||(this.points=this.getPoints()),this.stepCount||(this.stepCount=this.getStepCount(this.calc));let o=e?i?t:Math.min(n,t):1;this.color=new l({...a,isMultiColor:e,colorCount:o}),e?this.colorMap=this.color.getColorMap({stepCount:o,colorCount:o}):this.colorMap=null}getTrianglePoints({center:e,rotation:t,isCapLevel:i,triangleIndexInSide:n}){let r;i&&(r=this._getNextIndexInTriangle((n+2)%3));let s=[,,,].fill(null).map((t,i)=>i===r?[]:[e]);for(let n=0;n<3;n++){if(i&&n===r)continue;let a=t+f/3*n,l=s[n],o=Math.cos(a),h=Math.sin(a);for(let t=1;t<=this.config.density;t++){let i=t*this.calc.nailDistance;l.push([e[0]+i*o,e[1]+i*h])}}return s}getPoints(){if(this.points)return this.points;let{levels:e,renderCaps:t}=this.config,i=this.calc.nailsLength,n=this.calc.triangleHeight-i,r=[],s=t?e+1:e;for(let a=0;a<s;a++){let s=t&&a===e,l=[];r.push(l);let o=this.calc.countPerLevelSide[a],h=Array(o).fill(null).map((e,t)=>{let r=t%2==0,s=[this.calc.triangleCenterDistance*(t-a),a*this.calc.triangleHeight+(r?i:n)];return{rotation:Math.atan(s[0]/s[1]),distanceFromCenter:Math.sqrt(s[0]**2+s[1]**2)}});for(let e=0;e<6;e++){let t=F[e];for(let i=0;i<o;i++){if(s&&i%2==0){l.push(null);continue}let{distanceFromCenter:n,rotation:r}=h[i],a=t-r-this.calc.globalRotationRadians,o=[this.center[0]+n*Math.cos(a),this.center[1]-n*Math.sin(a)],u=this.getTrianglePoints({center:o,rotation:t+e*f/3-i*B+this.calc.globalRotationRadians,isCapLevel:s,triangleIndexInSide:i});l.push(u)}}}return r}*generateTriangleStrings({points:e,level:t,indexInSide:i}){this.renderer.setColor(this.color.getColor(t));let{density:n,levels:r}=this.config,s=t===r,a=s?this._getNextIndexInTriangle(i%3):0,l=s?a:2,o=s?n:n-1;for(let t=a;t<=l;t++){let i=this._getNextIndexInTriangle(t),r=e[t][0];for(let s=0;s<=o;s++){let a=s%2==0,l=[],o=a?this.config.density-s:s,h=a?i:t;l.push(e[h][o]),s<n&&l.push(e[h][a?o-1:o+1]),this.renderer.renderLines(r,...l),r=l[l.length-1],yield}}}*generateStringsBetweenTriangles({triangle1:e,triangle2:t,level:i,triangleIndex:n,triangleIndexInSide:r,isNextLevel:s,nextLevelTriangleIndex:a}){let{density:l,fillColor:o}=this.config,h=this.calc.countPerLevelSide[i],u=n%h%3;this.renderer.setColor(o);let c=r===h-1,d=s?[this._getNextIndexInTriangle(u),this._getNextIndexInTriangle(u,-1)]:[u,this._getNextIndexInTriangle(u,r%2?1:-1)];for(let e=0;e<2;e++)for(let{pointIndex:t,triangle1Points:i,triangle2Points:n}of g.call(this,e))this.renderer.renderLines(i[t],n[t]),yield;function*g(i){let n=d[i],r=(function(){return s?this._getNextIndexInTriangle(n):0===i&&c?1:1===i&&c?0:this._getNextIndexInTriangle(n,1)}).call(this),a=e[n],o=t[r],h=i?l:l-1;if(0===i)for(let e=0;e<=h;e++)yield{pointIndex:l-e,triangle1Points:a,triangle2Points:o};else for(let e=h;e>=1;e--)yield{pointIndex:l-e,triangle1Points:a,triangle2Points:o}}}_getNextIndexInTriangle(e,t=1){let i=e+t;return i<0?2:i>2?0:i}*generateStrings(){let{fill:e,renderTriangles:t,renderCaps:i,levels:n,renderRing:r,ringSize:s,ringColor:a}=this.config,l=this.getPoints(),o=-1;for(let r of l){let s=++o===n,a=-1,h=r.length-1;for(let u of r){a++;let c=this.calc.countPerLevelSide[o],d=a%c;if(e&&!s&&(0===a&&(yield*this.generateStringsBetweenTriangles({triangle1:r[h],triangle2:u,level:o,triangleIndex:h,triangleIndexInSide:h%c})),a!==h&&(yield*this.generateStringsBetweenTriangles({triangle1:u,triangle2:r[a+1],level:o,triangleIndex:a,triangleIndexInSide:d})),d%2==0&&(i||o<n-1))){let e=Math.floor(a/c)*this.calc.countPerLevelSide[o+1]+d+1;yield*this.generateStringsBetweenTriangles({triangle1:u,triangle2:l[o+1][e],level:o,triangleIndex:a,triangleIndexInSide:d,isNextLevel:!0,nextLevelTriangleIndex:e})}let g=a%this.calc.countPerLevelSide[o];t&&(!s||g%2)&&(yield*this.generateTriangleStrings({points:u,level:o,indexInSide:g}))}}r&&s&&(yield*this.circle.drawRing(this.renderer,{ringSize:s/2,color:a}))}getStepCount(e){if(this.stepCount)return this.stepCount;e||(e=this.getCalc());let{levels:t,density:i,fill:n,renderTriangles:r,renderCaps:s}=this.config,{triangleCount:a,ringNailCount:l=0}=e,o=n?2*i:0,h=t+ +!!s;return a*((r?3*i:0)+o)+(r&&s?6*t*(i+1):0)+o*(h-1)*6*h/2+l}drawNails(){let e=this.getPoints(),t=0;for(let i of e)for(let e of i)if(null!=e)for(let i of e)for(let e of i)this.nails.addNail({point:e,number:t++});this.circle&&this.circle.drawNails(this.nails)}static thumbnailConfig={levels:3,density:3,fill:!1,renderRing:!0}},j,q],H={controls:document.querySelector("#controls"),controlsPanel:document.querySelector("#controls_panel"),sidebarForm:document.querySelector("#sidebar_form")},J=new Set(["input","change"]),Z="controls_state";class Q{constructor({pattern:e}){this.pattern=e,this.state=this._getState()??{groups:{}},this.eventHandlers={input:new Set,change:new Set},this._toggleFieldset=e=>{if("LEGEND"===e.target.nodeName){e.target.parentElement.classList.toggle("minimized");let t=e.target.parentElement.dataset.group;this.state={...this.state,groups:{...this.state.groups,[t]:!e.target.parentElement.classList.contains("minimized")}},this._updateState(this.state)}},this._toggleFieldSetOnEnter=e=>{"LEGEND"===e.target.nodeName&&"Enter"===e.key&&this._toggleFieldset(e)},this._wrappedOnInput=e=>this._onInput(e),H.controls.addEventListener("input",this._wrappedOnInput),this._wrappedOnTouchStart=e=>this._onTouchStart(e),this._wrappedOnMouseDown=e=>this._onMouseDown(e),H.controls.addEventListener("touchstart",this._wrappedOnTouchStart),H.controls.addEventListener("mousedown",this._wrappedOnMouseDown),H.sidebarForm.addEventListener("click",this._toggleFieldset),H.sidebarForm.addEventListener("keydown",this._toggleFieldSetOnEnter),this.controlElements={},this.renderControls()}destroy(){H.controls.removeEventListener("input",this._wrappedOnInput),H.sidebarForm.removeEventListener("click",this._toggleFieldset),H.sidebarForm.removeEventListener("keydown",this._toggleFieldSetOnEnter),H.controls.removeEventListener("touchstart",this._wrappedOnTouchStart),H.controls.removeEventListener("mousedown",this._wrappedOnMouseDown),H.controls.innerHTML=""}addEventListener(e,t){if(!J.has(e))throw Error(`Unsupported event for EditorControls, "${e}"!`);if(!(t instanceof Function))throw Error("Invalid event handler.");this.eventHandlers[e].add(t)}_triggerEvent(e,t){for(let i of this.eventHandlers[e])i(t)}_onMouseDown(e){let t=window.getSelection();t&&t.removeAllRanges()}_onTouchStart(e){"range"===e.target.getAttribute("type")&&(this._postponeRangeInput=!0,this.currentInputRange=e.target,this.currentInputRangeValue=e.target.value,this._rangeLockTimeout=setTimeout(()=>{this._postponeRangeInput=!1},120),this._wrappedOnTouchEnd=e=>this._onTouchEnd(e),document.body.addEventListener("touchend",this._wrappedOnTouchEnd),this._wrappedOnRangeScroll=e=>this._onRangeScroll(e),H.controlsPanel.addEventListener("scroll",this._wrappedOnRangeScroll))}_onTouchEnd(){document.body.removeEventListener("touchend",this._wrappedOnTouchEnd),H.controlsPanel.removeEventListener("scroll",this._wrappedOnRangeScroll),this._lockRange&&(this._lockRange=!1,this.currentInputRange&&(this.currentInputRange.value=this.currentInputRangeValue)),this.currentInputRange=this.currentInputRangeValue=null}_onRangeScroll(){this._lockRange=!0}_onInput(t){return(clearTimeout(e),clearTimeout(this._postponeRangeInputTimeout),this._postponeRangeInput&&("range"===t.target.getAttribute("type")||"STRING-ART-RANGE-INPUT"===t.target.nodeName))?(t.preventDefault(),this._postponeRangeInputTimeout=setTimeout(()=>{this._onInput(t)},120),!1):this._lockRange?(t.preventDefault(),!1):void this.updateInput({inputElement:t.target,originalEvent:t,deferChange:!0})}updateInput({inputElement:t,originalEvent:i,deferChange:n=!0}){let r=function(e,t){if("STRING-ART-RANGE-INPUT"===t.nodeName)return parseFloat(t.value);switch(e){case"range":case"number":return parseFloat(t.value);case"checkbox":return t.checked;default:return t.value}}(t.type,t),s=t.id.replace(/^config_/,"");if(this.pattern.config[s]===r)return;this.pattern.setConfigValue(s,r);let{config:a,displayValue:l}=this.controlElements[s];l&&(l.innerText=a.displayValue?a.displayValue(this.pattern.config,a):t.value);let o=Object.freeze({control:s,value:r,originalEvent:i,pattern:this.pattern});this._triggerEvent("input",o);let h=()=>{this._triggerEvent("change",o),this.updateControlsVisibility()};this.updateControlsAttributes(),n?e=setTimeout(h,100):h()}_getState(){let e=localStorage.getItem(Z);if(e)try{return JSON.parse(e)}catch(e){}return null}_updateState(e){e?localStorage.setItem(Z,JSON.stringify(e)):localStorage.removeItem(Z)}updateControlsAttributes(e=this.pattern.configControls){e.forEach(e=>{if("group"===e.type)this.updateControlsAttributes(e.children);else if(e.attr){let t=Object.entries(e.attr).filter(([e,t])=>t instanceof Function);if(t.length){let i=this.controlElements[e.key].input;i&&t.forEach(([e,t])=>{let n=t(this.pattern);n!=i.getAttribute(e)&&(("min"===e&&i.value<n||"max"===e&&i.value>n)&&(i.value=n,clearTimeout(i.updateTimeout),i.updateTimeout=setTimeout(()=>{this.updateInput({inputElement:i})},100)),i.setAttribute(e,n))})}}})}updateControlsVisibility(e=this.pattern.configControls){e.forEach(e=>{if(e.show){let t=e.show(this.pattern.config,e),i=this.controlElements[e.key].control;i&&(t?i.removeAttribute("hidden"):i.setAttribute("hidden","hidden"))}if(e.isDisabled){let t=e.isDisabled(this.pattern.config),i=this.controlElements[e.key].input;i&&(t?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled"))}e.children&&this.updateControlsVisibility(e.children)})}updateInputs(e){Object.entries(e).forEach(([e,t])=>{let{input:i,value:n}=this.controlElements[e];i&&("checkbox"===i.type?i.checked=t:i.value=t,n&&(n.innerText=t))})}renderControls(e=H.controls,t){let i=t??this.pattern.configControls;e.innerHTML="";let n=document.createDocumentFragment();i.forEach(e=>{let t,i=`config_${e.key}`,r=this.controlElements[e.key]={config:e};if("group"===e.type){(t=document.createElement("fieldset")).setAttribute("data-group",e.key);let i=document.createElement("legend");i.setAttribute("tabindex","0"),i.innerText=e.label,t.appendChild(i),t.className="control control_group","minimized"===e.defaultValue&&(t.classList.add("minimized"),this.state.groups[e.key]=!1);let n=document.createElement("div");t.appendChild(n),this.renderControls(n,e.children)}else{(t=document.createElement("div")).className="control";let n=document.createElement("label");n.innerHTML=e.label,n.setAttribute("for",i);let s=r.input=document.createElement("select"===e.type?"select":"range"===e.type?"string-art-range-input":"input"),a=this.pattern.config[e.key]??e.defaultValue;if("select"===e.type){let i=document.createDocumentFragment();e.options.forEach(e=>{let{value:t,label:n}="string"==typeof e?{value:e,label:e}:e,r=document.createElement("option");r.setAttribute("value",t),r.innerText=n,i.appendChild(r)}),s.appendChild(i),s.value=a,t.appendChild(n),t.appendChild(s)}else if(s.setAttribute("type",e.type),"checkbox"===e.type)s.checked=a,t.appendChild(s),t.appendChild(n);else{t.appendChild(n),t.appendChild(s),setTimeout(()=>{s.value=a});let i=r.displayValue=document.createElement("span");i.id=`config_${e.key}_value`,i.innerText=e.displayValue?e.displayValue(this.pattern.config,e):a,i.className="control_input_value",t.appendChild(i)}e.attr&&Object.entries(e.attr).forEach(([e,t])=>{let i=t instanceof Function?t(this.pattern):t;s.setAttribute(e,i)}),s.id=i}this.controlElements[e.key].control=t,t.id=`control_${e.key}`,n.appendChild(t)}),e.appendChild(n),this.updateGroupsState(),requestAnimationFrame(()=>this.updateControlsVisibility())}updateGroupsState(){H.sidebarForm.querySelectorAll("[data-group]").forEach(e=>{let t=e.dataset.group,i=this.state.groups[t];"boolean"==typeof i&&(i?e.classList.remove("minimized"):e.classList.add("minimized"))})}}const X=document.querySelector("#size_controls"),Y={sizeSelect:X.querySelector("#size_select"),sizeCustom:X.querySelector("#size_custom"),width:X.querySelector("#size_custom_width"),height:X.querySelector("#size_custom_height"),orientationSelect:X.querySelector("#size_orientation_select")};function K(e,t=300){return Math.floor(e/2.54*t)}const ee=[Math.floor(window.screen.width),Math.floor(window.screen.height)],et=[{id:"fit",name:"Fit to screen"},{id:"A4",value:[20,28].map(e=>K(e)),orientationSelect:!0},{id:"A3",value:[28,40].map(e=>K(e)),orientationSelect:!0},{id:"screen",name:`Screen size (${ee.join("x")})`,value:ee},{id:"custom",name:"Custom..."}];class ei{element=document.querySelector("#size_controls");constructor({getCurrentSize:e}){let t=document.createDocumentFragment();et.forEach(e=>{let i=document.createElement("option");i.setAttribute("value",e.id),i.innerText=e.name??e.id,t.appendChild(i)}),Y.sizeSelect.appendChild(t),this.selectedSize=et[0],Y.sizeSelect.addEventListener("change",t=>{let i=t.target.value,n=et.find(({id:e})=>e===i);if(this.selectedSize=n,"custom"===n.id){Y.sizeCustom.removeAttribute("hidden");let[t,i]=e();Y.width.value=t,Y.height.value=i}else Y.sizeCustom.setAttribute("hidden","hidden"),this._notifyOnChange(this.getValue());n.orientationSelect?Y.orientationSelect.removeAttribute("hidden"):Y.orientationSelect.setAttribute("hidden","hidden")}),Y.orientationSelect.addEventListener("change",e=>{this._notifyOnChange(this.getValue())}),Y.sizeCustom.addEventListener("focusin",e=>{e.target.select()}),Y.sizeCustom.addEventListener("input",()=>{this._notifyOnChange([Y.width.value?parseInt(Y.width.value):null,Y.height.value?parseInt(Y.height.value):null])})}_notifyOnChange([e,t]=[]){this.element.dispatchEvent(new CustomEvent("sizechange",{detail:{width:e,height:t}}))}getValue(){if("custom"===this.selectedSize.id)return[parseInt(Y.width.value,10),parseInt(Y.height.value,10)];{let e=this.selectedSize.value;return this.selectedSize.orientationSelect&&"horizontal"===Y.orientationSelect.value&&(e=Array.from(e).reverse()),e}}}class en extends u{constructor(e){super(e),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");let t=window.devicePixelRatio||1,i=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1;this.pixelRatio=t/i,this.ctx.globalCompositeOperation="source-over",e.appendChild(this.canvas)}get element(){return this.canvas}reset(){this.ctx.clearRect(0,0,...this.getSize()),this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height");let[e,t]=this.getSize();this.canvas.setAttribute("width",e),this.canvas.setAttribute("height",t)}setColor(e){this.ctx.strokeStyle=e}setLineWidth(e){this.ctx.lineWidth=e}setBackground(e){this.ctx.globalCompositeOperation="destination-over",this.ctx.fillStyle=e,this.ctx.fillRect(0,0,...this.getSize()),this.ctx.globalCompositeOperation="source-over"}getSize(){return[this.canvas.clientWidth*this.pixelRatio,this.canvas.clientHeight*this.pixelRatio]}renderLines(e,...t){for(let i of(this.ctx.beginPath(),this.ctx.moveTo(...e),t))this.ctx.lineTo(...i);this.ctx.stroke()}renderNails(e,{color:t,fontSize:i,radius:n,renderNumbers:r,margin:s=0}){let a=this.canvas.width/2;this.ctx.globalCompositeOperation="source-over",this.ctx.beginPath(),this.ctx.fillStyle=t,this.ctx.textBaseline="middle",this.ctx.font=`${i}px sans-serif`;let l=n+s;e.forEach(({point:[e,t],number:i})=>{if(this.ctx.moveTo(e+n,t),this.ctx.arc(e,t,n,0,f),r&&null!=i){let n=e<a,r=[n?e-l:e+l,t];this.ctx.textAlign=n?"right":"left",this.ctx.fillText(String(i),...r)}}),this.ctx.fill()}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}toDataURL(){return this.canvas.toDataURL()}}const er="minimized";class es{elements={root:document.querySelector("#pattern_select_panel"),thumbnails:document.querySelector("#pattern_select_thumbnails"),toggleBtn:document.querySelector("#pattern_select_btn"),dropdown:document.querySelector("#pattern_select_dropdown")};constructor(){this.elements.toggleBtn.addEventListener("click",()=>this.toggle())}toggle(){this.elements.root.classList.contains(er)?this.open():this.pattern&&this.close()}open(){this.elements.root.classList.contains(er)&&(this.elements.root.classList.remove(er),this.thumbnailsRendered||(this.createThumbnails(),this.thumbnailsRendered=!0),this._onClickOutside=e=>{e.target.closest("#pattern_select_panel")||this.toggle()},document.body.addEventListener("mousedown",this._onClickOutside))}close(){this.elements.root.classList.contains(er)||(this.elements.root.classList.add(er),document.body.removeEventListener("mousedown",this._onClickOutside),this._onClickOutside=null)}setCurrentPattern(e){this.pattern=e,this.elements.toggleBtn.innerText=e?.name??"Choose a pattern"}createThumbnails(){let e=document.createDocumentFragment(),t=[];W.forEach(i=>{let n=document.createElement("a"),r=new en(n);n.style.width=n.style.height="100px";let s=new i(r);s.config=Object.assign({margin:1,enableBackground:!1,nailRadius:.5},i.thumbnailConfig),t.push(s);let a=document.createElement("li");e.appendChild(a),n.href=`?pattern=${s.id}`,n.setAttribute("data-pattern",s.id),n.title=s.name,a.appendChild(n)}),this.elements.thumbnails.appendChild(e),t.forEach(e=>e.draw()),this.elements.thumbnails.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();let t=e.target.closest("[data-pattern]");if(!t)return!1;this.elements.root.dispatchEvent(new CustomEvent("change",{detail:{pattern:t.dataset.pattern}})),this.toggle()})}addOnChangeListener(e){this.elements.root.addEventListener("change",e)}removeOnChangeListener(e){this.elements.root.removeEventListener("change",e)}}const ea=/^\-?\d+(\.\d+)?$/,el=/^(?:!)([01])$/;async function eo(e){try{navigator.share(await eu(e))}catch(e){alert("Error: "+e.message)}}async function eh(e){if(!navigator.share)return!1;let t=await eu(e);return navigator.canShare(t)}async function eu({renderer:e,pattern:t}){let i=e.toDataURL(),n=await (await fetch(i)).blob(),r=[new File([n],t.name+".jpg",{type:n.type,lastModified:new Date().getTime()})];return{url:window.location.href,files:r,title:document.title,text:"String Art Studio - "+t.name}}async function ec(){if(navigator.serviceWorker&&"127.0.0.1"!==document.location.hostname)try{let e=await navigator.serviceWorker.register("service-worker.js");e.onupdatefound=()=>{let t=e.installing;null!=t&&(t.onstatechange=()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."):console.log("Content is cached for offline use."))})}}catch(e){console.error("Error during service worker registration:",e)}}const ed="http://www.w3.org/2000/svg";class eg extends u{constructor(e){super(e),this.svg=document.createElementNS(ed,"svg"),this.svg.style.setProperty("display","block"),this.backgroundGroup=document.createElementNS(ed,"g"),this.backgroundGroup.setAttribute("data-id","background"),this.linesGroup=document.createElementNS(ed,"g"),this.linesGroup.setAttribute("data-id","lines"),this.nailsGroup=document.createElementNS(ed,"g"),this.nailsGroup.setAttribute("data-id","nails"),this.nailsCirclesGroup=document.createElementNS(ed,"g"),this.nailsCirclesGroup.setAttribute("data-id","nailsCircles"),this.nailsTextGroup=document.createElementNS(ed,"g"),this.nailsTextGroup.setAttribute("data-id","nailsText"),this.nailsGroup.appendChild(this.nailsCirclesGroup),this.nailsGroup.appendChild(this.nailsTextGroup),this.svg.appendChild(this.backgroundGroup),this.svg.appendChild(this.linesGroup),this.svg.appendChild(this.nailsGroup),this.svg.setAttribute("xmlns",ed),e.appendChild(this.svg)}get element(){return this.svg}reset(){this.linesGroup.innerHTML="",this.nailsCirclesGroup.innerHTML="",this.nailsTextGroup.innerHTML="";let[e,t]=this.getSize().map(Math.trunc);this.svg.setAttributeNS(ed,"viewBox",`0 0 ${e} ${t}`),this.svg.setAttributeNS(ed,"width",e),this.svg.setAttributeNS(ed,"height",t),this.svg.style.width=e+"px",this.svg.style.height=t+"px",this.currentColor=null,this.lineWidth=null}setColor(e){e!==this.currentColor&&(this.currentLineGroup=document.createElementNS(ed,"g"),this.currentLineGroup.setAttribute("stroke",e),this.currentLineGroup.setAttribute("stroke-width",this.lineWidth),this.linesGroup.appendChild(this.currentLineGroup),this.currentColor=e)}setLineWidth(e){this.lineWidth=e??"1",this.linesGroup.setAttributeNS(ed,"stroke-width",e??"1"),this.linesGroup.childNodes.forEach(t=>t.setAttributeNS(ed,"stroke-width",e??"1"))}setBackground(e){e?(this.background||(this.background=document.createElementNS(ed,"rect"),this.background.setAttribute("width","100%"),this.background.setAttribute("height","100%"),this.backgroundGroup.appendChild(this.background)),this.background.setAttribute("fill",e)):(this.background=null,this.backgroundGroup.innerHTML="")}setSize(e){super.setSize(e);let[t,i]=e.map(Math.trunc);this.svg.setAttributeNS(ed,"viewBox",`0 0 ${t} ${i}`),this.svg.setAttributeNS(ed,"width",t),this.svg.setAttributeNS(ed,"height",i)}renderLines(e,...t){let i=e,n=document.createDocumentFragment();for(let e of t){let t=document.createElementNS(ed,"line");t.setAttribute("x1",Math.trunc(i[0])),t.setAttribute("y1",Math.trunc(i[1])),t.setAttribute("x2",Math.trunc(e[0])),t.setAttribute("y2",Math.trunc(e[1])),i=e,n.appendChild(t)}this.currentLineGroup.appendChild(n)}renderNails(e,{color:t,fontSize:i,radius:n,renderNumbers:r,margin:s=0}){let a=this.getSize()[0]/2;this.nailsCirclesGroup.innerHTML=this.nailsTextGroup.innerHTML="";let l=document.createDocumentFragment(),o=document.createDocumentFragment();this.nailsGroup.setAttribute("fill",t);let h=n+s;this.nailsTextGroup.style.fontSize=i,e.forEach(({point:[e,t],number:i})=>{let s=document.createElementNS(ed,"circle");if(s.setAttribute("cx",e),s.setAttribute("cy",t),s.setAttribute("r",n),l.appendChild(s),r&&null!=i){let n=e<a,r=[n?e-h:e+h,t],s=document.createElementNS(ed,"text");s.innerHTML=String(i),s.setAttribute("x",r[0]),s.setAttribute("y",r[1]),n&&s.setAttribute("text-anchor","end"),o.appendChild(s)}}),this.nailsCirclesGroup.appendChild(l),this.nailsTextGroup.appendChild(o)}clear(){this.linesGroup.innerHTML="",this.nailsGroup.innerHTML=""}toDataURL(){return""}}function ep(e,t){let i=document.createElement("a");i.href=e,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i)}const ef="rgba(0,0,0,.2)";class em extends HTMLElement{#a=null;#l=null;#o=.05;#h=null;#u=null;#c=null;#d=null;#g=null;#p=null;#f=null;constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
          <style>
            input[type="range"] {
              width: 100%;
              appearance: none;
              background: transparent;
              border: none;
              margin: 2px;
              cursor: pointer;
            }

            input[type="range"]::-webkit-slider-thumb {
              appearance: none;
              width: 16px;
              height: 16px;
              border-radius: 50%;
              background: var(--color-input);
              cursor: pointer;
              border: none;
              margin-top: -4px;
              z-index: 10;
              box-shadow: 0 0 5px rgba(0,0,0,.5)
            }

            input[type="range"]::-webkit-slider-thumb:hover {
              background: var(--color-input-hover);
            }
              
            input[type="range"]:active::-webkit-slider-thumb {
              background: var(--color-input-active);
            }

            input[type="range"]::-webkit-slider-runnable-track {
              height: 8px;
              border-radius: 4px;
              margin: 0;
            }
          </style>
          <style id="background"></style>
          <input type="range">
        `,this.#a=this.shadowRoot.querySelector('input[type="range"]'),this.#l=this.shadowRoot.querySelector("#background"),this.#o=.05,this.#u=null}static get observedAttributes(){return["min","max","value","step","snap","background","thumbcolor"]}attributeChangedCallback(e,t,i){let n;if("snap"===e?this.#c=this.getTickValues():this.#a&&(this.#a[e]=i),("min"===e||"max"===e)&&(this[e]=Number(i)),"value"===e&&(n=Number(i)),"background"===e&&(this.#g=i),"thumbcolor"===e&&(this.#p=i),null!=this.min&&null!=this.max&&(this.min>this.max&&(this.max=this.min,this.#a.max=this.min),this.#d=(this.max-this.min)*this.#o||.05,this.#c&&null!=this.value)){let e=this.getClosestTick(n);null!=e&&(this.#u=e)}this.#m()}get value(){return this.#a.value}set value(e){this.#a.value=e,this.#m()}connectedCallback(){["min","max","value","step"].forEach(e=>{this.hasAttribute(e)&&(this.#a[e]=this.getAttribute(e))}),this.#c=this.getTickValues(),this.resizeObserver=new ResizeObserver(e=>{for(let t of e)t.contentRect.width,this.#m()}),this.resizeObserver.observe(this.#a),this.#a.addEventListener("input",()=>this.handleInput()),this.#a.addEventListener("keydown",e=>this.handleKeydown(e)),this.#a.addEventListener("change",()=>this.#f=null)}disconnectedCallback(){this.resizeObserver.unobserve(this)}getTickValues(){let e=this.getAttribute("snap"),t=e?.match(/\d+(\.\d+)?/g);return t?t.map(Number).filter(e=>!isNaN(e)).sort():[]}#y(e,t){if(null==t&&(t=this.getClosestTick(e)),null==t)return!0;let i=Math.abs(e-t);return!!(i>=this.#d/2&&i>Math.abs(this.#h-t))}#b(e,t){return Math.abs(e-t)/(this.max-this.min)>=.2}handleInput(){let e=Number(this.#a.value),t=this.getClosestTick(e);null!=t&&this.#f!==t&&this.#y(e,t)&&(this.#f=t),t!==this.#f&&(null!==t?(this.#a.value=t,t!==this.#u&&(this.#C(),this.#u=t)):null!=this.#u&&(this.#u=null)),null!=this.#f&&null==t&&this.#b(e,this.#f)&&(this.#f=null),this.#m(),this.#h=e,this.dispatchEvent(new CustomEvent("input",{detail:{value:this.#a.value}}))}handleKeydown(e){let t,i=Number(this.#a.step||1),n=Number(this.#a.value);if("ArrowLeft"===e.key)t=Math.max(this.min,n-i);else if("ArrowRight"===e.key)t=Math.min(this.max,n+i);else if("ArrowUp"===e.key){let e=this.#c.find(e=>e>n);void 0!==e?t=e:n!==this.max&&(t=this.max)}else if("ArrowDown"===e.key){let e=[...this.#c].reverse().find(e=>e<n);void 0!==e?t=e:n!==this.min&&(t=this.min)}null!=t&&(this.#a.value=t,this.#m(),this.#h=t,this.dispatchEvent(new InputEvent("input",{detail:{value:t},bubbles:!0,composed:!0})))}getClosestTick(e){if(!this.#c||0===this.#c.length)return null;for(let t of this.#c)if(Math.abs(e-t)<=this.#d)return t;return null}#C(){"vibrate"in navigator&&navigator.vibrate(10)}#m(){let e=this.#a.clientWidth;if(!e)return;let t=this.value-this.min,i=this.max-this.min,n=e-16,r=8+n*t/i,s=this.#c?.filter(e=>e!==this.min&&e!==this.max).map(e=>8+n*(e-this.min)/i-1),a=s?.map(e=>`transparent ${e}px, ${ef} ${e}px, ${ef} ${e+2}px, transparent ${e+2}px`).join(", "),l=s?.length?`linear-gradient(to right, ${a}), `:null,o=[`input[type="range"]::-webkit-slider-runnable-track {
        background: ${l||""}${this.#g??`linear-gradient(to right, var(--color-input) ${r}px, #ddd ${r}px)`};
      }${this.#g?"":`
       input[type="range"]:hover::-webkit-slider-runnable-track {
        background: ${l||""}linear-gradient(to right, var(--color-input-hover) ${r}px, #ddd ${r}px);
      }
        input[type="range"]:active::-webkit-slider-runnable-track {
        background: ${l||""}linear-gradient(to right, var(--color-input-active) ${r}px, #ddd ${r}px);
      }`}`];null!=this.#p&&o.push(`input[type="range"]::-webkit-slider-thumb { background: ${this.#p} !important}`),this.#l.innerHTML=o.join("\n")}}customElements.define("string-art-range-input",em),window.addEventListener("error",function(e){alert("Error: "+e.message)});const ey={canvas:document.querySelector("#canvas_panel"),patternLink:document.querySelector("#pattern_link"),downloadBtn:document.querySelector("#download_btn"),downloadSVGBtn:document.querySelector("#download_svg_btn"),downloadNailsBtn:document.querySelector("#download_nails_btn"),resetBtn:document.querySelector("#reset_btn"),shareBtn:document.querySelector("#share_btn"),playerBtn:document.querySelector("#player_btn"),buttons:document.querySelector("#buttons"),instructionsLink:document.querySelector("#pattern_select_dropdown_instructions")},eb=new class{constructor(e){this.elements={player:e,step:e.querySelector("#step"),playerPosition:e.querySelector("#player_position"),playBtn:e.querySelector("#play_btn"),pauseBtn:e.querySelector("#pause_btn"),text:e.querySelector("#player_text")},this.stepCount=0,this._isPlaying=!1,this.elements.playerPosition.addEventListener("input",({target:e})=>{this.goto(+e.value)}),this.elements.playBtn.addEventListener("click",()=>{this.play()}),this.elements.pauseBtn.addEventListener("click",()=>{this.pause()})}updateStatus(e){this._isPlaying!==e&&(this.elements.player.classList.toggle("playing"),this._isPlaying=e)}update(e,{draw:t=!0}={}){this.stringArt=e,this.stepCount=e.getStepCount(),this.elements.playerPosition.setAttribute("max",this.stepCount),this.elements.step.innerText=`${this.stepCount}/${this.stepCount}`,this.elements.text.style.removeProperty("width"),this.elements.text.style.width=(this.elements.text.clientWidth||70)+"px",this.goto(this.stepCount,{updateStringArt:t})}updatePosition(e){this.elements.step.innerText=`${e}/${this.stepCount}`,this.elements.playerPosition.value=e}goto(e,{updateStringArt:t=!0}={}){this.pause(),this.updatePosition(e),t&&this.stringArt.goto(e)}advance(e=1){let t=Number(this.elements.playerPosition.value);this.goto(t===this.stepCount?1:Math.min(this.stepCount,Number(this.elements.playerPosition.value)+e))}setInstructions(e){}play(){this.updateStatus(!0),cancelAnimationFrame(this.renderRafId),this.stringArt.position===this.stepCount&&this.stringArt.goto(0);let e=this;!function t(){e.stringArt.drawNext().done?e.updateStatus(!1):e.renderRafId=requestAnimationFrame(t),e.updatePosition(e.stringArt.position)}()}pause(){cancelAnimationFrame(this.renderRafId),this.updateStatus(!1)}toggle(){this._isPlaying?this.pause():this.play()}}(document.querySelector("#player")),eC=new ei({getCurrentSize:()=>[ey.canvas.clientWidth,ey.canvas.clientHeight]}),eS=new es;async function ew(){window.addEventListener("popstate",({state:e})=>{eV(e)}),await ec(),document.body.querySelectorAll(".pattern_only").forEach(eE),eP(document.querySelector("main"));let e=new URLSearchParams(document.location.search);if(t="svg"===e.get("renderer")?new eg(ey.canvas):new en(ey.canvas),i=W.map(e=>new e(t)),history.state?.pattern)eV(history.state);else{let t=e.get("pattern");t?eV({pattern:t,config:e.get("config")}):eS.toggle()}ey.downloadBtn.addEventListener("click",ex),ey.downloadSVGBtn.addEventListener("click",ev),ey.downloadNailsBtn.addEventListener("click",eM),ey.resetBtn.addEventListener("click",eL),ey.shareBtn.addEventListener("click",async()=>await eo({renderer:t,pattern:n})),ey.playerBtn.addEventListener("click",()=>{document.querySelectorAll("#buttons [data-toggle-for]").forEach(e=>{e.classList.contains("active")&&e.click()})}),ey.instructionsLink.addEventListener("click",e=>{e.preventDefault(),history.pushState({pattern:null},"String Art Studio","./"),eA()}),eS.addOnChangeListener(({detail:e})=>{ez(e_(e.pattern))}),ey.canvas.addEventListener("mousedown",()=>{let e,t=()=>{clearTimeout(e),eb.advance(),ey.canvas.removeEventListener("mouseup",t)};e=setTimeout(()=>{eb.play();let e=()=>{eb.pause(),ey.canvas.removeEventListener("mouseup",e)};ey.canvas.addEventListener("mouseup",e)},200),ey.canvas.addEventListener("mouseup",t)}),document.body.addEventListener("click",e=>{let t=e.target.closest("[data-toggle-for]");if(t){let e=t.dataset.toggleFor;t.classList.toggle("active"),document.querySelector("#"+e).classList.toggle("open"),document.body.classList.toggle("dialog_"+e),n&&n.draw({position:n.position})}})}async function ek(){if(!n)throw Error("Can't init pattern - no current pattern available!");eC.element.addEventListener("sizechange",({detail:e})=>{var i;(i=e).width&&i.height?(t.setSize(i),ey.canvas.classList.contains("overflow")||ey.canvas.classList.add("overflow")):(ey.canvas.classList.remove("overflow"),t.setSize(null)),n.draw()}),window.addEventListener("resize",()=>n&&n.draw()),ey.downloadBtn.addEventListener("click",ex),ey.downloadNailsBtn.addEventListener("click",eM),ey.resetBtn.addEventListener("click",eL),await eh({renderer:t,pattern:n})&&eP(ey.shareBtn)}function ex(){ep(t.toDataURL(),n.name+".png")}function ev(){!function(e,t){let i=document.createElement("article");i.style.width=t[0]+"px",i.style.height=t[1]+"px",document.body.appendChild(i);let n=new eg(i),r=new e.constructor(n);r.setConfig(e.config),r.draw();var s=new Blob([r.renderer.svg.outerHTML],{type:"image/svg+xml;charset=utf-8"});ep(URL.createObjectURL(s),e.name+".svg"),document.body.removeChild(i)}(n,t.getSize())}function eM(){let e=n.config;n.config={darkMode:!1,showNails:!0,showNailNumbers:!0,showStrings:!1,nailsColor:"#000000"},n.draw(),ex(),n.config=e,n.draw()}function eL(){confirm("Are you sure you wish to reset options to defaults?")&&ez(n,{config:{}})}function eN({withConfig:e=!0}={}){eb.update(n);let t=e?function(e){let{defaultConfig:t,config:i}=e,n=Object.entries(i).map(([e,i])=>i===t[e]?null:"boolean"==typeof i?`!${+!!i}`:"number"==typeof i?parseFloat(i.toFixed(6)):i);for(;null===n[n.length-1];)n.pop();return n.length?n.join("_").replace(/\_{2,}/g,e=>"~"+e.length+"_"):""}(n):null;history.replaceState({pattern:n.id,config:t},n.name,`?pattern=${n.id}${e&&t?`&config=${encodeURIComponent(t)}`:""}`)}function ez(e,t){eR(e,t),history.pushState({pattern:e.id},e.name,"?pattern="+e.id)}function eV(e){if(e?.pattern){let t=e_(e.pattern);eR(t,{draw:!1,config:e.config?function(e,t){let i=t.replace(/(?:~)(\d+)(?:_)/g,(e,t)=>Array(+t).fill("_").join("")).split("_").map(e=>{if(""===e)return null;if(ea.test(e))return parseFloat(e);let t=e.match(el);return t?"1"===t[1]:e}),n=Object.keys(e.defaultConfig);return i.reduce((e,t,i)=>{if(null!==t){let r=n[i];return{...e,[r]:t}}return e},{})}(t,e.config):{}}),eS.close(),n.draw()}else eA(),eS.open()}function e_(e){let t=i.find(({id:t})=>t===e);if(!t)throw Error(`Pattern with id "${e}" not found!`);return t}function eR(e,{config:t,draw:i=!0}={}){let s=!n;n=e,t&&n.setConfig(t),r&&r.destroy(),(r=new Q({pattern:e,config:t})).addEventListener("input",()=>n.draw()),r.addEventListener("change",eN),e.link?(ey.patternLink.setAttribute("href",e.link),ey.patternLink.innerText=e.linkText??"Example",eP(ey.patternLink)):eE(ey.patternLink),i&&requestAnimationFrame(()=>{n.draw()}),eb.update(n,{draw:!1}),eS.setCurrentPattern(e),document.title=`${e.name} - String Art Studio`,document.body.setAttribute("data-pattern",e.id),s&&(ek(),document.body.querySelectorAll(".pattern_only").forEach(eP))}function eP(e){e.removeAttribute("hidden")}function eE(e){e.setAttribute("hidden","hidden")}function eA(){n=null,t.clear(),eE(ey.patternLink),eS.setCurrentPattern(null),r&&r.destroy(),document.body.querySelectorAll(".pattern_only").forEach(eE),document.body.removeAttribute("data-pattern")}window.addEventListener("load",ew);
//# sourceMappingURL=string_art.c19c26ec.js.map
