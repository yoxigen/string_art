const e=[{key:"isMultiColor",label:"Use multiple colors",defaultValue:!1,type:"checkbox"},{key:"colorCount",label:"Colors count",defaultValue:7,type:"range",attr:{min:1,max:20,step:1},show:({isMultiColor:e})=>e},{key:"color",label:"String color",defaultValue:"#ff4d00",type:"color",show:({isMultiColor:e})=>!e},{key:"repeatColors",label:"Repeat colors",defaultValue:!1,type:"checkbox",show:({isMultiColor:e})=>e},{key:"multicolorRange",label:"Multicolor range",defaultValue:360,type:"range",attr:{min:1,max:360,step:1},show:({isMultiColor:e})=>e},{key:"multicolorStart",label:"Multicolor start",defaultValue:0,type:"range",attr:{min:0,max:360,step:1},show:({isMultiColor:e})=>e},{key:"reverseColors",label:"Reverse colors order",defaultValue:!1,type:"checkbox",show:({isMultiColor:e})=>e},{key:"saturation",label:"Saturation",defaultValue:100,type:"range",attr:{min:0,max:100,step:1},show:({isMultiColor:e})=>e},{key:"lightness",label:"Lightness",type:"group",defaultValue:"minimized",show:({isMultiColor:e})=>e,children:[{key:"multicolorByLightness",label:"Multi lightness",defaultValue:!1,type:"checkbox",show:({isMultiColor:e})=>e},{key:"minLightness",label:"Minimum lightness",defaultValue:0,type:"range",attr:{min:0,max:100,step:1},show:({multicolorByLightness:e,isMultiColor:t})=>e&&t},{key:"maxLightness",label:"Maximum lightness",defaultValue:100,type:"range",attr:{min:0,max:100,step:1},show:({multicolorByLightness:e,isMultiColor:t})=>e&&t}]}];class t{constructor(e){this.config=e;const{multicolorRange:t,colorCount:i,multicolorByLightness:n,minLightness:s=0,maxLightness:r=100,multicolorStart:o,darkMode:a,saturation:l,reverseColors:c,isMultiColor:h}=e;h&&(this.multiColorStep=t/i,this.multiColorLightnessStep=n?(r-s)/(Math.max(i,2)-1):1,this.colors=new Array(i).fill(null).map(((e,t)=>{const i=n?s+this.multiColorLightnessStep*t:a?50:40;return`hsl(${o+t*this.multiColorStep}, ${l}%, ${i}%)`})),c&&this.colors.reverse())}getColor(e){const{isMultiColor:t,colorCount:i,color:n,repeatColors:s}=this.config;return t?(e>=i&&(e=s?e%i:i-1),this.colors[e]):n}getColorMap({stepCount:e,colorCount:t}){if(!t)throw new Error("Can't get color map, no colorCount provided!");const i=Math.floor(e/t),n=new Map;for(let e=0;e<t;e++)n.set(e*i,this.getColor(e));return n}static getConfig({include:t,exclude:i,defaults:n={},customControls:s}){const r=function s(r=e){return r.filter((({key:e})=>(!i||!i.includes(e))&&(!t||t.includes(e)))).map((e=>{const t={...e,defaultValue:n[e.key]??e.defaultValue};return"group"===e.type&&(t.children=s(e.children)),Object.freeze(t)}))}();return{key:"colorGroup",label:"Color",type:"group",children:[...s??[],...r]}}}class i{constructor(e,t){this.setConfig(t),this.nails=[],this.addedPoints=new Set,this.renderer=e}setConfig({nailRadius:e,nailsColor:t,nailNumbersFontSize:i}){this.nailRadius=e,this.nailsColor=t,this.nailNumbersFontSize=i,this.nails=[],this.addedPoints&&this.addedPoints.clear()}addNail(e){const t=e.point.map(Math.round).join("_");this.addedPoints.has(t)||(this.nails.push(e),this.addedPoints.add(t))}fill({drawNumbers:e=!0}={}){this.renderer.renderNails(this.nails,{color:this.nailsColor,fontSize:this.nailNumbersFontSize,radius:this.nailRadius,renderNumbers:e,margin:4}),this.nails=[],this.addedPoints.clear()}}class n{constructor(e){this.parentElement=e}destroy(){}reset(){}setColor(e){this.color=e}setLineWidth(e){}setBackground(e){}renderLines(e,...t){throw new Error('Renderer "renderLines" method not implemented!')}renderNails(e,{color:t,fontSize:i,radius:n,renderNumbers:s,margin:r}){throw new Error('Renderer "renderNails" method not implemented!')}getSize(){throw new Error('Renderer "getSize" method not implemented!')}setSize({width:e,height:t}){}clear(){throw new Error('Renderer "clear" method not implemented!')}toDataURL(){throw new Error('Renderer "toDataURL" method not implemented!')}}const s="#0e0e0e",r="#ffffff",o=[{key:"strings",label:"Strings",type:"group",defaultValue:"minimized",children:[{key:"showStrings",label:"Show strings",defaultValue:!0,type:"checkbox",isDisabled:({showNails:e})=>!e},{key:"stringWidth",label:"String width",defaultValue:1,type:"range",attr:{min:.2,max:4,step:.1},show:({showStrings:e})=>e}]},{key:"nails",label:"Nails",type:"group",defaultValue:"minimized",children:[{key:"showNails",label:"Show nails",defaultValue:!0,type:"checkbox",isDisabled:({showStrings:e})=>!e},{key:"showNailNumbers",label:"Show nail numbers",defaultValue:!1,type:"checkbox",show:({showNails:e})=>e},{key:"nailNumbersFontSize",label:"Nail numbers font size",defaultValue:10,type:"range",attr:{min:6,max:24,step:.5},displayValue:({nailNumbersFontSize:e})=>`${e}px`,show:({showNails:e,showNailNumbers:t})=>e&&t},{key:"margin",label:"Margin",defaultValue:20,type:"number",attr:{min:0,max:500,step:1},displayValue:({margin:e})=>`${e}px`},{key:"nailRadius",label:"Nail size",defaultValue:1.5,type:"range",attr:{min:.5,max:5,step:.25},show:({showNails:e})=>e},{key:"nailsColor",label:"Nails color",defaultValue:"#ffffff",type:"color",show:({showNails:e})=>e}]},{key:"background",label:"Background",type:"group",defaultValue:"minimized",children:[{key:"darkMode",label:"Dark mode",defaultValue:!0,type:"checkbox",isDisabled:({enableBackground:e})=>!e},{key:"customBackgroundColor",label:"Custom background color",defaultValue:!1,type:"checkbox",isDisabled:({enableBackground:e})=>!e},{key:"backgroundColor",label:"Background color",defaultValue:s,type:"color",show:({customBackgroundColor:e})=>e,isDisabled:({enableBackground:e})=>!e},{key:"enableBackground",label:"Enable background",defaultValue:!0,type:"checkbox"}]}];function a(e){return e.reduce(((e,{key:t,defaultValue:i,children:n})=>n?{...e,...a(n)}:{...e,[t]:i}),{})}function l(e){return e.reduce(((e,t)=>t.children?{...e,...l(t.children)}:{...e,[t.key]:t}),{})}var c=class{constructor(e){if(!e)throw new Error("Renderer not specified!");if(!(e instanceof n))throw new Error("Renderer is not an instance of Renderer!");this.renderer=e}get configControls(){return(this.controls??[]).concat(o)}get controlsIndex(){return this._controlsIndex||(this._controlsIndex=l(this.controls)),this._controlsIndex}get defaultConfig(){return this._defaultConfig||(this._defaultConfig=Object.freeze(Object.assign(a(this.configControls),this.defaultValues))),this._defaultConfig}get config(){return this._config??this.defaultConfig}set config(e){this._config=Object.assign({},this.defaultConfig,e)}setConfig(e){const t=this.config;if(this.config=e,this.onConfigChange){const i=Object.keys(t).filter((i=>e[i]!==t[i]));this.onConfigChange({controls:i.map((t=>({control:this.controlsIndex[t],value:e[t]})))})}}setConfigValue(e,t){this._config=Object.freeze({...this._config??this.defaultConfig,[e]:t}),this.onConfigChange&&this.onConfigChange({controls:[{control:this.controlsIndex[e],value:t}].filter((({control:e})=>!!e))})}getSize(){return this.renderer.getSize()}setUpDraw(){const e=this.size;this.renderer.reset();const[t,n]=this.size=this.getSize();Object.assign(this,this.size),this.center=this.size.map((e=>e/2)),!e||e[0]===t&&e[1]===n||this.onResize&&this.onResize(),this.nails?this.nails.setConfig(this.config):this.nails=new i(this.renderer,this.config),this.renderer.setLineWidth(this.config.stringWidth)}afterDraw(){const{showNails:e,showNailNumbers:t}=this.config;e&&(this.drawNails(),this.nails.fill({drawNumbers:t}))}initDraw(){this.setUpDraw(this.config);const{showNails:e,showNailNumbers:t,darkMode:i,backgroundColor:n,customBackgroundColor:o,enableBackground:a}=this.config;a&&this.renderer.setBackground(o?n:i?s:r),e&&(this.drawNails(),this.nails.fill({drawNumbers:t}))}draw({position:e=1/0}={}){this.initDraw();const{showStrings:t}=this.config;if(t){for(this.stringsIterator=this.generateStrings(),this.position=0;!this.drawNext().done&&this.position<e;);this.afterDraw()}}goto(e){if(e!==this.position)if(this.stringsIterator&&e>this.position)for(;!this.drawNext().done&&this.position<e;);else this.draw({position:e})}drawNext(){const e=this.stringsIterator.next();return e.done?this.afterDraw():this.position++,e}generateStrings(){throw new Error("generateStrings method not defined!")}getStepCount(){throw new Error(`'getStepCount' method not implemented for string art type "${this.name}"`)}};function h(e,t){return t?h(t,e%t):e}const d=2*Math.PI;class u{constructor(e){this.setConfig(e)}getPoint(e=0){const t=this.getNailIndex(e);if(this.points.has(e))return this.points.get(e);const i=[this.center[0]+Math.sin(t*this.indexAngle+this.rotationAngle)*this.radius,this.center[1]+Math.cos(t*this.indexAngle+this.rotationAngle)*this.radius];return this.points.set(e,i),i}getNailIndex(e=0){let t=this.isReverse?this.config.n-1-e:e;return t>this.config.n-1&&(t%=this.config.n),t}setConfig(e){const t=this._serializeConfig(e);if(t!==this.serializedConfig){const{n:i,size:n,margin:s=0,rotation:r=0,center:o,radius:a,reverse:l=!1}=e,c=o??n.map((e=>e/2)),h={center:c,radius:a??Math.min(...c)-s,indexAngle:d/i,rotationAngle:-d*r,isReverse:l};this.config=e,this.serializedConfig=t,Object.assign(this,h),this.points?this.points.clear():this.points=new Map}}_serializeConfig({n:e,size:t,margin:i=0,rotation:n=0,center:s,radius:r,reverse:o=!1}){return[t?.join(","),s?.join(","),r,i,e,n,o].join("_")}drawNails(e,{nailsNumberStart:t=0,getNumber:i}={}){for(let n=0;n<this.config.n;n++)e.addNail({point:this.getPoint(n),number:i?i(n):n+t})}*drawRing(e,{ringSize:t,color:i}){const{n:n}=this.config,s=Math.floor(t*n);let r,o=0,a=!1;e.setColor(i);for(let t=0;t<n;t++){r||(r=this.getPoint(0));const i=r,l=[];o=a?t:o+s,r=this.getPoint(o),l.push(r),t<n-1&&(o++,r=this.getPoint(o),l.push(r)),e.renderLines(i,...l),yield,a=!a}}static rotationConfig=Object.freeze({key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1+1/360,step:1/360},displayValue:(e,{key:t})=>`${Math.round(360*e[t])}°`,isStructural:!0,affectsStepCount:!1});static nailsConfig=Object.freeze({key:"n",label:"Number of nails",defaultValue:144,type:"range",attr:{min:3,max:300,step:1},isStructural:!0})}const g=t.getConfig({defaults:{isMultiColor:!0,colorCount:7,color:"#ffbb29",multicolorRange:"21",multicolorStart:32,multicolorByLightness:!0,minLightness:36,maxLightness:98}});var p=class extends c{name="Spirals";id="spirals";link="https://www.etsy.com/il-en/listing/974865185/3d-string-art-spiral-mandala-wall?ref=shop_home_active_10&frs=1";controls=[{key:"radiusIncrease",label:"Radius change",defaultValue:5.7,type:"range",attr:{min:1,max:20,step:.1}},{key:"angleStep",label:"Angle step",defaultValue:.45,type:"range",attr:{min:0,max:1,step:.01}},{key:"nSpirals",label:"Number of spirals",defaultValue:3,type:"range",attr:{min:1,max:20,step:1}},{...u.rotationConfig,defaultValue:330/360},t.getConfig({defaults:{isMultiColor:!0,colorCount:4,color:"#00d5ff",multicolorRange:1,multicolorStart:190,multicolorByLightness:!0,minLightness:50,maxLightness:88,reverseColors:!0}})];setUpDraw(){super.setUpDraw();const{nSpirals:e,rotation:i,margin:n,radiusIncrease:s,angleStep:r,colorCount:o}=this.config;this.spiralRotations=new Array(e).fill(null).map(((t,i)=>i*d/e)),this.rotationAngle=-d*i;const a=Math.min(...this.size)/2-n;this.nailsPerSpiral=Math.floor(a/s),this.angleIncrease=r/(a/50),this.color=new t(this.config),this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:o})}*generatePoints(){const{nSpirals:e}=this.config;for(let t=0;t<this.nailsPerSpiral;t++)for(let i=0;i<e;i++){const e=this.getPoint(i,t);yield{point:e,nailNumber:`${i}_${t}`}}}getPoint(e,t){const[i,n]=this.center,{radiusIncrease:s}=this.config,r=this.rotationAngle+this.angleIncrease*t+this.spiralRotations[e],o=t*s;return[i+o*Math.sin(r),n+o*Math.cos(r)]}*generateStrings(){const e=this.generatePoints();let t=0;this.renderer.setColor(this.color.getColor(0));let i=this.center;for(const{point:n}of e){if(this.colorMap){const e=this.colorMap.get(t);e&&this.renderer.setColor(e)}i&&this.renderer.renderLines(i,n),i=n,yield t++}}getStepCount(){const{nSpirals:e,radiusIncrease:t,margin:i}=this.config,n=Math.min(...this.getSize())/2-i;return Math.floor(n/t)*e}drawNails(){const e=this.generatePoints();for(const{point:t,nailNumber:i}of e)this.nails.addNail({point:t,number:i})}static thumbnailConfig={radiusIncrease:1.4,angleStep:.11}};class f extends c{name="Mandala";id="mandala";link="https://www.youtube.com/watch?v=qhbuKbxJsk8";linkText="Learn";controls=[{key:"n",label:"Number of nails",defaultValue:180,type:"range",attr:{min:3,max:240,step:1}},{key:"base",label:"Multiplication",defaultValue:2,type:"range",attr:{min:2,max:99,step:1}},{key:"layers",label:"Layers",defaultValue:7,type:"range",attr:{min:1,max:20,step:1}},u.rotationConfig,t.getConfig({defaults:{isMultiColor:!0,multicolorRange:180,multicolorStart:256,color:"#ff4d00"},exclude:["colorCount"]})];get n(){if(!this._n){const{n:e,layers:t}=this.config,i=e%t;this._n=e-i}return this._n}setUpDraw(){this._n=null,super.setUpDraw();const{layers:e,rotation:i,margin:n,layerFill:s,base:r,reverse:o}=this.config,a={size:this.size,n:this.n,margin:n,rotation:i,reverse:o};this.stringsPerLayer=s?Math.floor(this.n*s):this.n,this.circle?this.circle.setConfig(a):this.circle=new u(a),this.color=new t({...this.config,colorCount:e}),this.layerShift=Math.floor(this.n/e),this.base=r}*drawTimesTable({shift:e=0,color:t="#f00",time:i}){const n=this.n;this.renderer.setColor(t);let s=this.circle.getPoint(e);for(let t=1;t<=this.stringsPerLayer;t++){const r=s;s=this.circle.getPoint(t+e);const o=t*this.base%n;this.renderer.renderLines(r,s,this.circle.getPoint(o+e)),yield{instructions:`${t-1} → ${t} → ${o} → ${t}`,index:i*n+t}}}*generateStrings(){const{layers:e}=this.config;for(let t=0;t<e;t++){const e=this.color.getColor(t);yield*this.drawTimesTable({time:t,color:e,shift:this.layerShift*t})}}drawNails(){this.circle.drawNails(this.nails)}getStepCount(){const{layers:e,layerFill:t}=this.config;return(e??1)*(t?Math.floor(this.n*t):this.n)}static thumbnailConfig={n:70}}const m=["left","bottom","right","top"],y=["left","bottom","right","top"],C={left:0,bottom:Math.PI/2,right:Math.PI,top:1.5*Math.PI};var w=class extends c{name="Eye";id="eye";link="https://www.etsy.com/listing/489853161/rose-of-space-string-art-sacred-geometry?ga_order=most_relevant&ga_search_type=all&ga_view_type=gallery&ga_search_query=string+art&ref=sr_gallery_1&epik=dj0yJnU9WXNpM1BDTnNkLVBtcWdCa3AxN1J5QUZRY1FlbkJ5Z18mcD0wJm49ZXdJb2JXZmVpNVVwN1NKQ3lXMy10ZyZ0PUFBQUFBR0ZuUzZv";controls=[{key:"n",label:"Number of nails per side",defaultValue:82,type:"range",attr:{min:2,max:200,step:1}},{key:"layers",label:"Layers",defaultValue:13,type:"range",attr:{min:1,max:20,step:1}},{key:"angle",label:"Layer angle",defaultValue:30,displayValue:({angle:e})=>`${e}°`,type:"range",attr:{min:0,max:45,step:1}},{key:"color",label:"Color",type:"group",children:[{key:"color1",label:"String #1 color",defaultValue:"#11e8bd",type:"color"},{key:"color2",label:"String #2 color",defaultValue:"#6fff52",type:"color"},{key:"colorPerLayer",label:"Color per layer",defaultValue:!1,type:"checkbox"}]}];setUpDraw(){super.setUpDraw();const{n:e,angle:t,layers:i,margin:n}=this.config;this.maxSize=Math.min(...this.size)-2*n,this.nailSpacing=this.maxSize/(e-1),this.layerAngle=t*Math.PI/180,this.layers=new Array(i).fill(null).map(((e,t)=>this._getLayerProps(t)))}getPoint({index:e,angle:t,layerStart:i,rotation:n}){const s=t+n,r=i.x,o=i.y+this.nailSpacing*e,a=this.center[0],l=this.center[1],c=Math.cos(s),h=Math.sin(s);return[c*(r-a)-h*(o-l)+a,h*(r-a)+c*(o-l)+l]}*drawSide({side:e,color:t="#ffffff",angle:i,size:n,layerStart:s,layerStringCount:r}){const o=m.indexOf(e),a=m[o===m.length-1?0:o+1],l=C[e],c=C[a],h={layerStringCount:r,size:n,layerStart:s,angle:i};this.renderer.setColor(t);for(let t=0;t<=r;t++)this.renderer.renderLines(this.getPoint({side:e,index:t,rotation:l,...h}),this.getPoint({side:a,index:t,rotation:c,...h})),yield t}_getLayerProps(e){const t=this._getLayerColors(e),i=this.layerAngle*e,n=this.maxSize/Math.pow(Math.cos(this.layerAngle)+Math.sin(this.layerAngle),e);return{colors:t,layerAngle:i,layerSize:n,layerStart:{x:this.center[0]-n/2,y:this.center[1]-n/2},layerStringCount:Math.floor(n/this.nailSpacing)}}_getLayerColors(e){const{color1:t,color2:i,colorPerLayer:n}=this.config;if(n){const n=e%2?t:i;return[n,n,n,n]}return[i,t,i,t]}*drawLayer(e){const{colors:t,layerAngle:i,layerSize:n,layerStart:s,layerStringCount:r}=this.layers[e];for(let e=0;e<m.length;e++)yield*this.drawSide({color:t[e],side:y[e],angle:i,size:n,layerStart:s,layerStringCount:r})}*generateStrings(){const{layers:e}=this.config;for(let t=e-1;t>=0;t--)yield*this.drawLayer(t)}getStepCount(){let e=0;const{layers:t,angle:i,n:n,margin:s}=this.config,r=i*Math.PI/180,o=Math.min(...this.renderer.getSize())-2*s,a=o/(n-1);for(let i=0;i<t;i++){const t=o/Math.pow(Math.cos(r)+Math.sin(r),i);e+=4*(Math.floor(t/a)+1)}return e}drawNails(){const{layers:e}=this.config;for(let t=e-1;t>=0;t--){const{layerAngle:e,layerSize:i,layerStart:n,layerStringCount:s}=this.layers[t];for(let r=0;r<m.length;r++){const o=y[r],a=C[o];for(let l=0;l<=s;l++){const c={layerStringCount:s,size:i,layerStart:n,angle:e};this.nails.addNail({point:this.getPoint({sideOrder:o,index:l,rotation:a,...c}),number:`${t}_${r}_${l}`})}}}}static thumbnailConfig={n:25,layers:7}};const S=[{size:.25,end:1,color:"#a94fb0"},{size:.125,end:.888,color:"#ec6ad0"},{size:0,end:.826,color:"#f08ad5",reverse:!0}];class b{constructor(e){this.setConfig(e)}setConfig(e){if(this._serializeConfig(e)!==this.serializedConfig){const{rotation:t=0,sides:i}=this.config=e,n=d/i,s=new Array(i).fill(null).map(((e,i)=>{const s=n*i+d*t,r=-n*(i-.5)-d*t;return{cos:Math.cos(s),sin:Math.sin(s),center:{cos:Math.cos(r),sin:Math.sin(r)}}}));Object.assign(this,{sides:s,sideCount:i,sideAngle:n}),this.points?this.points.clear():this.points=new Map,Object.assign(this,this._getProps()),e.fitSize&&(Object.assign(this,this._getProps(this.getSizeAndCenter())),this.points.clear())}}getSizeAndCenter(){const{size:e,margin:t}=this.config,i=this.getBoundingRect(),n=Math.min((e[0]-2*t)/i.width,(e[1]-2*t)/i.height),s=e.map((e=>e*n)),r=[this.center[0]-n*(i.left-e[0]+i.right)/2,this.center[1]-n*(i.top-e[1]+i.bottom)/2];return this.points.clear(),{size:s,center:r}}_getProps(e){const{nailsSpacing:t,size:i,margin:n=0,center:s}=Object.assign({},this.config,e),r=s??this.config.size.map((e=>e/2)),o=Math.min(...i)/2-n,a=2*o*Math.sin(this.sideAngle/2),l=[o*Math.sin(this.sideAngle/2),o*Math.cos(this.sideAngle/2)],c=a*t,h=Math.floor(o/c);return{nailsSpacing:t,nailsPerSide:1/t,center:r,radius:o,sideSize:a,start:l,nailsDistance:c,radiusNailsCount:h,radiusNailsDistance:o/h}}_serializeConfig({size:e,margin:t=0,rotation:i=0,center:n,sides:s}){return[e?.join(","),n?.join(","),s,t,i].join("_")}getSidePoint({side:e,index:t}){const i=[e,t].join("_");if(this.points.has(i))return this.points.get(i);const n=this.start[0]-t*this.nailsDistance,{cos:s,sin:r}=this.sides[e],o=[s*n-r*this.start[1]+this.center[0],r*n+s*this.start[1]+this.center[1]];return this.points.set(i,o),o}getCenterPoint({side:e,index:t}){const i=t*this.radiusNailsDistance,{sin:n,cos:s}=this.sides[e].center;return[this.center[0]+n*i,this.center[1]+s*i]}getBoundingRect(){const e=this.sides.map(((e,t)=>this.getSidePoint({side:t,index:0}))),t=e[0],i=e.slice(1).reduce(((e,[t,i])=>({left:Math.min(e.left,t),right:Math.max(e.right,t),top:Math.min(e.top,i),bottom:Math.max(e.bottom,i)})),{left:t[0],right:t[0],top:t[1],bottom:t[1]});return i.height=i.bottom-i.top,i.width=i.right-i.left,Object.freeze(i),i}drawNails(e,{drawCenter:t=!1,drawSides:i=!0}={}){for(let n=0;n<this.sideCount;n++){const s=n*this.nailsPerSide;if(i)for(let t=0;t<this.nailsPerSide;t++)e.addNail({point:this.getSidePoint({side:n,index:t}),number:s+t});if(t)for(let t=0;t<this.radiusNailsCount;t++)e.addNail({point:this.getCenterPoint({side:n,index:t}),number:`${n}_${t}`})}}}const x=t.getConfig({defaults:{isMultiColor:!0,color:"#ff0000",multicolorRange:1,multicolorStart:0,multicolorByLightness:!0,minLightness:20,maxLightness:50},exclude:["colorCount"]});const k=t.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:264,multicolorStart:53,multicolorByLightness:!1,minLightness:30,maxLightness:70},exclude:["colorCount"]});const v=t.getConfig({defaults:{isMultiColor:!0,color:"#ffffff",multicolorRange:133,multicolorStart:239,multicolorByLightness:!1,minLightness:30,maxLightness:70,colorCount:4}});const _=t.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:43,multicolorStart:25,multicolorByLightness:!0,minLightness:40,maxLightness:95,colorCount:3,repeatColors:!0,saturation:83,reverseColors:!0},customControls:[{key:"colorPerLevel",label:"Color per level",defaultValue:!0,type:"checkbox"}]}),L=-d/6,M=new Array(6).fill(null).map(((e,t)=>Math.PI/2+L*t));var z=[class extends c{name="Star";id="star";link="https://www.etsy.com/listing/557818258/string-art-meditation-geometric-yoga?epik=dj0yJnU9Mm1hYmZKdks1eTc3bVY2TkVhS2p2Qlg0N2dyVWJxaTEmcD0wJm49MGlWSXE1SVJ2Vm0xZ0xtaGhITDBWQSZ0PUFBQUFBR0Zwd2lj";controls=[{key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:20,step:1}},{key:"sideNails",label:"Nails per side",defaultValue:40,type:"range",attr:{min:1,max:200,step:1}},{key:"ringSize",label:"Outer ring size",defaultValue:.1,type:"range",attr:{min:0,max:.5,step:({config:{sideNails:e,sides:t}})=>1/(e*t)},displayValue:({sideNails:e,sides:t,ringSize:i})=>Math.floor(i*e*t)},u.rotationConfig,{key:"colorGroup",label:"Color",type:"group",children:[{key:"innerColor",label:"Star color",defaultValue:"#2ec0ff",type:"color"},{key:"outterColor",label:"Outter color",defaultValue:"#2a82c6",type:"color"},{key:"ringColor",label:"Ring color",defaultValue:"#2ec0ff",type:"color"}]}];get n(){if(!this._n){const{n:e,sides:t}=this.config,i=e%t;this._n=e-i}return this._n}setUpDraw(){this._n=null,super.setUpDraw();const{sides:e,rotation:t,sideNails:i,margin:n=0}=this.config,s={size:this.size,n:i*e,margin:n,rotation:t};this.circle?this.circle.setConfig(s):this.circle=new u(s),this.sideAngle=2*Math.PI/e,this.nailSpacing=this.circle.radius/i,this.starCenterStart=i%1*this.nailSpacing,this.sides=new Array(e).fill(null).map(((e,t)=>{const n=t*this.sideAngle+this.circle.rotationAngle,s=t*i;return{sinSideAngle:Math.sin(n),cosSideAngle:Math.cos(n),circlePointsStart:s,circlePointsEnd:s+i}}))}getStarPoint({side:e,sideIndex:t}){const i=this.starCenterStart+t*this.nailSpacing,{sinSideAngle:n,cosSideAngle:s}=this.sides[e],[r,o]=this.circle.center;return[r+n*i,o+s*i]}getArcPoint({side:e,sideIndex:t}){return this.circle.getPoint(e*this.config.sideNails+t)}*generateStarPoints({reverseOrder:e=!1}={}){const{sides:t,sideNails:i}=this.config;for(let n=0;n<t;n++){const s=0===n?t-1:n-1;for(let t=0;t<i;t++){const r=e?i-t:t;yield{side:n,prevSide:s,sideIndex:r,point:this.getStarPoint({side:n,sideIndex:r})}}}}*drawStar(){const{innerColor:e,sideNails:t,sides:i}=this.config;this.renderer.setColor(e);let n=!1;const s=i%2?2*i:i,r=i%2?Math.floor(t/2):t;let o=0,a=this.getStarPoint({side:0,sideIndex:o});for(let e=0;e<=r;e++){let l=0;const c=s-(e===r?i:0);for(let s=0;s<c;s++){l=l!==i-1?l+1:0,n=!n,o=n?t-e:e;const s=this.getStarPoint({side:l,sideIndex:o});this.renderer.renderLines(a,s),a=s,yield}o=n?o-1:o+1;const h=this.getStarPoint({side:0,sideIndex:o});this.renderer.renderLines(a,h),a=h}}*drawCircle(){const{outterColor:e,sides:t,sideNails:i}=this.config;this.renderer.setColor(e);let n=this.getStarPoint({side:0,sideIndex:0}),s=!1,r=!1;const o=t%2?Math.ceil(i/2):i;let a=0;const l=t%2?4*t:2*t;for(let e=0;e<=o;e++){const c=l-(e===o?2*t:0);for(let o=0;o<c;o++){const o={side:a,sideIndex:s?i-e:e},l=r?this.getStarPoint(o):this.getArcPoint(o);this.renderer.renderLines(n,l),n=l,yield,r=!r,r&&(a=a!==t-1?a+1:0,s=!s)}n=this.getStarPoint({side:0,sideIndex:e+1})}}*generateStrings(){yield*this.drawCircle();const{ringSize:e,ringColor:t}=this.config;0!==e&&(yield*this.circle.drawRing(this.renderer,{ringSize:e,color:t})),yield*this.drawStar()}drawNails(){this.circle.drawNails(this.nails);for(const{point:e,side:t,sideIndex:i}of this.generateStarPoints())this.nails.addNail({point:e,number:i?`${t}_${i}`:0});this.circle.drawNails(this.nails)}getStepCount(){const{sides:e,sideNails:t,ringSize:i}=this.config;return 3*e*(t+(e%2?1:0))+(i?t*e:0)}static thumbnailConfig={sideNails:18}},class extends c{name="Assymetry";id="assymetry";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[u.nailsConfig,u.rotationConfig,{key:"layers",label:"Layers",type:"group",children:S.map((({size:e,end:t,color:i,reverse:n},s)=>{const r=s+1;return{key:`layer${r}`,label:`Layer ${r}`,type:"group",children:[{key:`show${r}`,label:"Enable",defaultValue:!0,type:"checkbox"},{key:`size${r}`,label:"Size",defaultValue:e,type:"range",attr:{min:0,max:.5,step:({config:{n:e}})=>1/e},displayValue:(e,{key:t})=>Math.round(e.n*e[t]),show:e=>e[`show${r}`]},{key:`end${r}`,label:"End Position",defaultValue:t,type:"range",attr:{min:0,max:1,step:({config:{n:e}})=>1/e},displayValue:(e,{key:t})=>Math.round(e.n*e[t]),show:e=>e[`show${r}`]},{key:`color${r}`,label:"Color",defaultValue:i,type:"color",show:e=>e[`show${r}`]},{key:`reverse${r}`,label:"Reverse",defaultValue:!0===n,type:"checkbox",show:e=>e[`show${r}`]}]}}))}];setUpDraw(){super.setUpDraw(),Object.assign(this,this.getSetUp())}getSetUp(){const{rotation:e,n:t,margin:i=0}=this.config,n={size:this.getSize(),n:t,margin:i,rotation:e-.25};let s;this.circle?(s=this.circle,this.circle.setConfig(n)):s=new u(n);let r=s.indexAngle*s.radius;const o=Math.floor(s.radius/r)-1;r+=(s.radius-r*o)/o;const a=s.getPoint(0),l=o+t,c=l+o,h=new Array(3).fill(null).map(((e,t)=>d.call(this,t+1))).filter((({enable:e})=>e));function d(e){const i=Math.round(t*this.config["size"+e])+o;return{size:i,endIndex:Math.round(this.config["end"+e]*(l+o))-i,color:this.config["color"+e],enable:this.config["show"+e],isReverse:this.config["reverse"+e]}}return{circle:s,lineSpacing:r,lineNailCount:o,firstCirclePoint:a,layers:h,totalNailCount:l,totalIndexCount:c}}getPoint(e){if(e<this.lineNailCount||e>this.totalNailCount){const t=(e<this.lineNailCount?this.lineNailCount-e:e-this.totalNailCount)*this.lineSpacing;return[this.firstCirclePoint[0]-t*Math.sin(this.circle.rotationAngle),this.firstCirclePoint[1]-t*Math.cos(this.circle.rotationAngle)]}{const t=e-this.lineNailCount;return this.circle.getPoint(t)}}*drawCircle({endIndex:e,color:t,isReverse:i,size:n}){let s,r,o=!1;this.renderer.setColor(t);const a=this,l=i?-1:1;for(let t=0;t<=e;t++){const e=s??this.getPoint(c(t)),i=[];s&&i.push(this.getPoint(r+l)),r=c(o?t:t+n),i.push(s=this.getPoint(r)),this.renderer.renderLines(e,...i),yield,o=!o}function c(e){return i?a.totalIndexCount-e:e}}*generateStrings(){for(const e of this.layers)yield*this.drawCircle(e)}drawNails(){this.circle.drawNails(this.nails,{nailsNumberStart:this.lineNailCount});for(let e=0;e<this.lineNailCount;e++)this.nails.addNail({point:this.getPoint(e),number:e})}getStepCount(){const{layers:e}=this.getSetUp();return e.reduce(((e,t)=>e+t.endIndex+1),0)}static thumbnailConfig={n:50}},f,class extends c{id="spiral";name="Spiral";link="https://www.etsy.com/il-en/listing/840974781/boho-wall-decor-artwork-spiral-round";controls=[{...u.nailsConfig,defaultValue:200},{key:"repetition",label:"Repetition",defaultValue:5,type:"range",attr:{min:1,max:20,step:1}},{key:"innerLength",label:"Spiral thickness",defaultValue:.5,type:"range",attr:{min:({config:{n:e}})=>1/e,max:1,step:({config:{n:e}})=>1/e},displayValue:({n:e,innerLength:t})=>Math.round(e*t)},{...u.rotationConfig,defaultValue:.75},g];setUpDraw(){super.setUpDraw();const{n:e,rotation:i,layers:n,margin:s,colorCount:r,repetition:o}=this.config;this.layersCount=n??1,this.realRepetition=2*o-1;const a={size:this.size,n:e,margin:s,rotation:i};this.circle?this.circle.setConfig(a):this.circle=new u(a),this.color=new t({...this.config,colorCount:n??r}),r&&(this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:r}))}*drawSpiral({shift:e=0,color:t="#ffffff"}={}){const{innerLength:i,n:n}=this.config;let s=Math.round(i*n),r=0;this.renderer.setColor(t);let o=e,a=this.circle.getPoint(o),l=!1;for(let e=0;s>0;e++){if(this.colorMap){const t=this.colorMap.get(e);t&&this.renderer.setColor(t)}o=l?o-s+1:o+s,r===this.realRepetition?(s--,r=0,o++):r++;const t=this.circle.getPoint(o);this.renderer.renderLines(a,t),a=t,yield e,l=!l}}*generateStrings(){yield*this.drawSpiral({color:this.color.getColor(0)})}getStepCount(){const{innerLength:e,repetition:t,n:i,layers:n=1}=this.config;return Math.round(n*i*(2*e)*t)}drawNails(){this.circle.drawNails(this.nails)}static thumbnailConfig={n:60}},p,class extends f{id="wave";name="Wave";link="https://www.etsy.com/il-en/listing/943140543/personalized-gift-string-art-mandala?ref=sim_rv-5&pro=1";controls=[{...u.nailsConfig,defaultValue:200},{key:"layerFill",label:"Layer fill",defaultValue:.5,type:"range",attr:{min:({config:{n:e}})=>1/e,max:1,step:({config:{n:e}})=>1/e},displayValue:({layerFill:e})=>Math.floor(100*e)+"%"},{...u.rotationConfig,defaultValue:176/360},{key:"layers",label:"Layers",defaultValue:11,type:"range",attr:{min:1,max:20,step:1}},{key:"layerSpread",label:"Layer spread",defaultValue:.075,type:"range",attr:{min:0,max:1,step:({config:{n:e}})=>1/e},displayValue:({layerSpread:e,n:t})=>Math.round(e*t)},{key:"reverse",label:"Reverse",defaultValue:!0,type:"checkbox"},t.getConfig({defaults:{isMultiColor:!0,multicolorRange:216,multicolorStart:263,color:"#ffffff",multicolorByLightness:!0,minLightness:10,maxLightness:90},exclude:["colorCount"]})];setUpDraw(){super.setUpDraw();const{n:e,layerSpread:t}=this.config;this.layerShift=Math.round(e*t),this.base=2}*generateStrings(){const{layers:e,reverse:t}=this.config;for(let i=0;i<e;i++)yield*this.drawTimesTable({color:this.color.getColor(i),shift:this.layerShift*(t?1:-1)*i,time:i})}static thumbnailConfig={n:70}},w,class extends c{name="Freestyle";id="freestyle";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[{key:"n",label:"Circle nails",defaultValue:80,type:"range",attr:{min:1,max:300,step:1}},{key:"minNailDistance",label:"Min nail distance",defaultValue:20,type:"range",attr:{min:1,max:300,step:1}},{key:"color",label:"Color",defaultValue:"#ec6ad0",type:"color"},{key:"layers",label:"Layers",type:"group",children:[{key:"layer1",label:"Layer 1",type:"group",children:[{key:"show1",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius1",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show1:e})=>e},{key:"x1",label:"Position X",defaultValue:.5,type:"range",attr:{min:0,max:1,step:.01},show:({show1:e})=>e},{key:"y1",label:"Position Y",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01},show:({show1:e})=>e},{...u.rotationConfig,key:"rotation1",show:({show1:e})=>e},{key:"reverse1",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show1:e})=>e}]},{key:"layer2",label:"Layer 2",type:"group",children:[{key:"show2",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius2",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show2:e})=>e},{key:"x2",label:"Position X",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01},show:({show2:e})=>e},{key:"y2",label:"Position Y",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show2:e})=>e},{...u.rotationConfig,key:"rotation2",show:({show2:e})=>e},{key:"reverse2",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show2:e})=>e}]},{key:"layer3",label:"Layer 3",type:"group",children:[{key:"show3",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius3",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show3:e})=>e},{key:"x3",label:"Position X",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show3:e})=>e},{key:"y3",label:"Position Y",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show3:e})=>e},{...u.rotationConfig,key:"rotation3",show:({show3:e})=>e},{key:"reverse3",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show3:e})=>e}]}]}];setUpDraw(){super.setUpDraw(),Object.assign(this,this.getSetUp())}getSetUp(){const{n:e,margin:t=0,minNailDistance:i}=this.config,n=this.getSize(),s=Math.min(...n.map((e=>e-2*t)))/2,r=new Array(3).fill(null).map(((e,t)=>a.call(this,t+1))).filter((({enable:e})=>e)),o=Math.max(...r.map((({circle:e})=>e.config.n)));function a(r){const o=e=>this.config[e+r],a={enable:o("show"),isReverse:o("reverse"),position:[o("x"),o("y")],radius:s*o("radius"),rotation:o("rotation")},l=2*Math.PI*a.radius,c=Math.min(e,Math.floor(l/i));return{circle:new u({radius:a.radius,center:a.position.map(((e,i)=>a.radius+t+(n[i]-2*(a.radius+t))*e)),n:c,rotation:a.rotation,reverse:a.isReverse}),...a}}return{layers:r,maxShapeNailsCount:o}}getPoint(e,t){const{circle:i}=e;let n=Math.round(t*i.config.n/this.maxShapeNailsCount);return i.getPoint(n)}*generateStrings(){const{n:e,color:t}=this.config;let i;this.renderer.setColor(t);for(let e=0;e<this.maxShapeNailsCount;e++)for(let t=0;t<this.layers.length;t++){const n=this.layers[t],s=i??this.getPoint(n,e),r=[];0===t&&e&&r.push(this.getPoint(n,e));let o=t+1;o===this.layers.length&&(o=0),i=this.getPoint(this.layers[o],e),this.renderer.renderLines(s,i),yield}}drawNails(){this.config;this.layers.forEach((({circle:e},t)=>e.drawNails(this.nails,{getNumber:e=>`${t+1}_${e+1}`})))}getStepCount(){const{layers:e,maxShapeNailsCount:t}=this.getSetUp();return e.length*t-1}static thumbnailConfig={minNailDistance:3}},class extends c{name="Polygon";id="polygon";controls=[{key:"sides",label:"Sides",defaultValue:5,type:"range",attr:{min:3,max:10,step:1}},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:1,max:100,step:1}},{key:"bezier",label:"Bezier",defaultValue:2,type:"range",attr:{min:1,max:4,step:1},show:({sides:e})=>e>4},u.rotationConfig,x];defaultValues={nailsColor:"#5c5c5c",nailRadius:1};setUpDraw(){super.setUpDraw();const{n:e,rotation:i,sides:n,margin:s,isMultiColor:r}=this.config,o={sides:n,rotation:i,margin:s,size:this.getSize(),nailsSpacing:1/e,fitSize:!0};this.polygon?this.polygon.setConfig(o):this.polygon=new b(o),this.color=new t({...this.config,isMultiColor:r,colorCount:n}),this.colorMap=r?this.color.getColorMap({stepCount:this.getStepCount(),colorCount:n}):null}*generateStrings(){const{sides:e,bezier:t}=this.config,i=Math.min(t,Math.ceil(e/2)-1);let n=0;this.renderer.setColor(this.color.getColor(0));for(let t=0;t<e;t++){const s=(t+i)%e;for(let e=0;e<this.polygon.nailsPerSide;e++)this.colorMap&&this.renderer.setColor(this.colorMap.get(n)),this.renderer.renderLines(this.polygon.getSidePoint({side:t,index:e}),this.polygon.getSidePoint({side:s,index:e})),yield,n++}}getStepCount(){const{sides:e,n:t}=this.config;return e*t}drawNails(){this.polygon.drawNails(this.nails)}static thumbnailConfig={n:20}},class extends c{name="Flower";id="flower";link="https://www.sqrt.ch/Buch/fadenmodell4_100.svg";controls=[{key:"sides",label:"Sides",defaultValue:4,type:"range",attr:{min:3,max:10,step:1}},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:1,max:100,step:1}},{key:"layers",label:"Layers",defaultValue:2,type:"range",attr:{min:1,max:10,step:1}},u.rotationConfig,k];defaultValues={nailsColor:"#29f1ff",nailRadius:1,stringWidth:.5};setUpDraw(){super.setUpDraw();const{n:e,rotation:i,sides:n,layers:s,margin:r,isMultiColor:o}=this.config,a=this.getSize(),l=1/(n*s);this.polygons=new Array(s).fill(null).map(((t,s)=>new b({sides:n,rotation:i+s*l,margin:r,size:a,nailsSpacing:1/e}))),this.color=new t({...this.config,isMultiColor:o,colorCount:s}),this.colorMap=o?this.color.getColorMap({stepCount:this.getStepCount(),colorCount:s}):null}*generateStrings(){const{sides:e,layers:t}=this.config;let i=0;this.renderer.setColor(this.color.getColor(0));for(let n=0;n<t;n++){const t=this.polygons[n];for(let n=0;n<e;n++){const s=n===e-1?0:n+1;for(let e=0;e<=t.nailsPerSide;e++){this.colorMap&&this.renderer.setColor(this.colorMap.get(i));const r=this.getCenterIndexes({polygon:t,sideIndex:e});this.renderer.renderLines(t.getCenterPoint({side:n,index:r[0]}),t.getSidePoint({side:n,index:e}),t.getCenterPoint({side:s,index:r[1]})),yield,i++}}}}getCenterIndexes({polygon:e,sideIndex:t}){const i=e.nailsPerSide-e.radiusNailsCount;return[t<i?-i+t:t-i,e.radiusNailsCount-t]}getStepCount(){const{sides:e,n:t,layers:i}=this.config;return e*(t+1)*i}drawNails(){this.polygons.forEach((e=>e.drawNails(this.nails,{drawCenter:!0})))}static thumbnailConfig={n:20}},class extends c{name="Maurer Rose";id="maurer_rose";link="https://blog.glitch.land/en/posts/maurer-rose/";linkText="Learn";controls=[{key:"n",label:"N",defaultValue:4,type:"range",attr:{min:1,max:12,step:1},isStructural:!0},{key:"maxSteps",label:"Max steps",defaultValue:512,type:"range",attr:{min:3,max:720,step:1},isStructural:!0},{key:"angle",label:"Angle",defaultValue:341,type:"range",attr:{min:1,max:720,step:1},displayValue:({angle:e})=>`${e}°`,isStructural:!0},u.rotationConfig,v];resetStructure(){this.points&&this.points.clear(),this.calc=null}onConfigChange({controls:e}){e.some((({control:e})=>e.isStructural))&&(this.resetStructure(),e.some((({control:e})=>!1!==e.affectsStepCount))&&(this.stepCount=null))}onResize(){this.resetStructure()}setUpDraw(){super.setUpDraw();const{isMultiColor:e,colorCount:i}=this.config;this.calc||(this.calc=this.getCalc()),this.points||(this.points=new Map),this.stepCount||(this.stepCount=this.getStepCount()),this.color=new t({...this.config,isMultiColor:e,colorCount:i}),this.colorMap=e?this.color.getColorMap({stepCount:this.stepCount,colorCount:i}):null}getCalc(){const{n:e,angle:t,rotation:i,maxSteps:n}=this.config,s=this.getSize();return{n:e,angleRadians:d*t/n,radius:Math.min(...s)/2,currentSize:s,rotationAngle:2*-Math.PI*i}}getPoint(e){if(this.points.has(e))return this.points.get(e);const t=e*this.calc.angleRadians,i=this.calc.radius*Math.sin(this.calc.n*t),n=[this.center[0]-i*Math.cos(t-this.calc.rotationAngle),this.center[1]-i*Math.sin(t-this.calc.rotationAngle)];return this.points.set(e,n),n}*generatePoints(){const e=this.stepCount;for(let t=0;t<e+1;t++)yield{point:this.getPoint(t),index:t}}*generateStrings(){const e=this.generatePoints();let t;this.renderer.setColor(this.color.getColor(0));for(const{point:i,index:n}of e)if(t){if(this.colorMap){const e=this.colorMap.get(n);e&&this.renderer.setColor(e)}this.renderer.renderLines(t,i),t=i,yield}else t=i}getStepCount(){if(this.stepCount)return this.stepCount;const{maxSteps:e,angle:t,n:i}=this.config;let n=e/h(e,t);return!(n%2)&&i%2&&(n/=2),Math.round(n)}drawNails(){const e=this.generatePoints();for(const{point:t,index:i}of e)this.nails.addNail({point:t,number:i})}static thumbnailConfig={maxSteps:160,angle:213}},class extends c{name="Flower of Life";id="flower_of_life";link="https://www.reddit.com/r/psychedelicartwork/comments/mk97gi/rainbow_flower_of_life_uv_reactive_string_art/";controls=[{key:"levels",label:"Levels",defaultValue:3,type:"range",attr:{min:1,max:10,step:1},isStructural:!0},{key:"density",label:"Density",defaultValue:10,type:"range",attr:{min:1,max:50,step:1},isStructural:!0},{key:"globalRotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:30,step:1},displayValue:(e,{key:t})=>`${e[t]}°`,isStructural:!0,affectsStepCount:!1},{key:"fillGroup",label:"Fill",type:"group",children:[{key:"fill",label:"Show fill",defaultValue:!0,type:"checkbox",isStructural:!0},{key:"fillColor",label:"Fill color",defaultValue:"#292e29",type:"color",show:({fill:e})=>e}]},{key:"ringGroup",label:"Ring",type:"group",children:[{key:"renderRing",label:"Show outer ring",type:"checkbox",defaultValue:!0,isStructural:!0},{key:"ringNailCount",label:"Ring nail count",defaultValue:144,type:"range",attr:{min:3,max:360,step:1},show:({renderRing:e})=>e,isStructural:!0},{key:"ringSize",label:"Outer ring size",defaultValue:.23,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:e})=>e,displayValue:({ringSize:e})=>`${Math.round(100*e)}%`,isStructural:!0},{key:"ringPadding",label:"Ring padding",defaultValue:.06,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:e})=>e,isStructural:!0,displayValue:({ringPadding:e})=>`${Math.round(100*e)}%`},{key:"ringColor",label:"Ring color",defaultValue:"#e8b564",type:"color",show:({renderRing:e})=>e}]},{key:"renderTriangles",label:"Show triangles",defaultValue:!0,type:"checkbox",isStructural:!0},{key:"renderCaps",label:"Show caps",defaultValue:!0,type:"checkbox",show:({renderTriangles:e})=>e,isStructural:!0},_];defaultValues={nailsColor:"#474747"};getCalc(){const{levels:e,density:t,margin:i,globalRotation:n,renderCaps:s,fill:r,renderTriangles:o,renderRing:a,ringNailCount:l,ringSize:c,ringPadding:h}=this.config,u=n*Math.PI/180+Math.PI/6,g=a?Math.min(...(this.size??this.getSize()).map((e=>e/2-i))):null,p=a?Math.floor(c*l/2):0,f=a?g*(1-Math.cos(d*(p/l)/2)):0,m=new b({sides:6,size:this.getSize(),margin:i+f+(a&&c?h*g:0),rotation:u,fitSize:!1}).sideSize/e,y=m/(2*Math.cos(Math.PI/6)),C=new Array(e+(s?1:0)).fill(null).map(((e,t)=>2*t+1));return{edgeSize:m,triangleHeight:m*Math.sqrt(3)/2,nailsLength:y,triangleCenterDistance:m/2,nailDistance:y/t,triangleCount:6*e**2,countPerLevelSide:C,globalRotationRadians:u,fill:r,renderTriangles:o,renderCaps:s,ringNailCount:l,radius:g}}resetStructure(){this.points=null,this.calc=null}onConfigChange({controls:e}){e.some((({control:e})=>e.isStructural))&&(this.resetStructure(),e.some((({control:e})=>!1!==e.affectsStepCount))&&(this.stepCount=null))}onResize(){this.resetStructure()}setUpDraw(){super.setUpDraw();const{isMultiColor:e,levels:i,colorPerLevel:n,colorCount:s,renderRing:r,ringSize:o,...a}=this.config;if(this.calc||(this.calc=this.getCalc()),r&&o){const e={size:this.size,n:this.calc.ringNailCount,margin:a.margin,rotation:a.globalRotation};this.circle?this.circle.setConfig(e):this.circle=new u(e)}else this.circle=null;this.points||(this.points=this.getPoints()),this.stepCount||(this.stepCount=this.getStepCount(this.calc));const l=e?n?i:Math.min(s,i):1;this.color=new t({...a,isMultiColor:e,colorCount:l}),this.colorMap=e?this.color.getColorMap({stepCount:l,colorCount:l}):null}getTrianglePoints({center:e,rotation:t,isCapLevel:i,triangleIndexInSide:n}){let s;if(i){const e=(n+2)%3;s=this._getNextIndexInTriangle(e)}const r=new Array(3).fill(null).map(((t,i)=>i===s?[]:[e]));for(let n=0;n<3;n++){if(i&&n===s)continue;const o=t+n*(d/3),a=r[n],l=Math.cos(o),c=Math.sin(o);for(let t=1;t<=this.config.density;t++){const i=t*this.calc.nailDistance;a.push([e[0]+i*l,e[1]+i*c])}}return r}getPoints(){if(this.points)return this.points;const{levels:e,renderCaps:t}=this.config,i=this.calc.nailsLength,n=this.calc.triangleHeight-i,s=[],r=t?e+1:e;for(let o=0;o<r;o++){const r=t&&o===e,a=[];s.push(a);const l=this.calc.countPerLevelSide[o],c=new Array(l).fill(null).map(((e,t)=>{const s=t%2==0,r=[this.calc.triangleCenterDistance*(t-o),o*this.calc.triangleHeight+(s?i:n)];return{rotation:Math.atan(r[0]/r[1]),distanceFromCenter:Math.sqrt(r[0]**2+r[1]**2)}}));for(let e=0;e<6;e++){const t=M[e];for(let i=0;i<l;i++){if(r&&i%2==0){a.push(null);continue}const{distanceFromCenter:n,rotation:s}=c[i],o=t-s-this.calc.globalRotationRadians,l=[this.center[0]+n*Math.cos(o),this.center[1]-n*Math.sin(o)],h=this.getTrianglePoints({center:l,rotation:t+e*d/3-i*L+this.calc.globalRotationRadians,isCapLevel:r,triangleIndexInSide:i});a.push(h)}}}return s}*generateTriangleStrings({points:e,level:t,indexInSide:i}){this.renderer.setColor(this.color.getColor(t));const{density:n,levels:s}=this.config,r=t===s,o=r?this._getNextIndexInTriangle(i%3):0,a=r?o:2,l=r?n:n-1;for(let t=o;t<=a;t++){const i=this._getNextIndexInTriangle(t);let s=e[t][0];for(let r=0;r<=l;r++){const o=r%2==0,a=[],l=o?this.config.density-r:r,c=o?i:t;a.push(e[c][l]),r<n&&a.push(e[c][o?l-1:l+1]),this.renderer.renderLines(s,...a),s=a[a.length-1],yield}}}*generateStringsBetweenTriangles({triangle1:e,triangle2:t,level:i,triangleIndex:n,triangleIndexInSide:s,isNextLevel:r,nextLevelTriangleIndex:o}){const{density:a,fillColor:l}=this.config,c=this.calc.countPerLevelSide[i],h=n%c%3;this.renderer.setColor(l);const d=s===c-1,u=h,g=r?[this._getNextIndexInTriangle(h),this._getNextIndexInTriangle(h,-1)]:[u,this._getNextIndexInTriangle(u,s%2?1:-1)];for(let e=0;e<2;e++){const t=p.call(this,e);for(const{pointIndex:e,triangle1Points:i,triangle2Points:n}of t)this.renderer.renderLines(i[e],n[e]),yield}function*p(i){const n=g[i],s=function(){return r?this._getNextIndexInTriangle(n):0===i&&d?1:1===i&&d?0:this._getNextIndexInTriangle(n,1)}.call(this),o=e[n],l=t[s],c=i?a:a-1;if(0===i)for(let e=0;e<=c;e++)yield{pointIndex:a-e,triangle1Points:o,triangle2Points:l};else for(let e=c;e>=1;e--)yield{pointIndex:a-e,triangle1Points:o,triangle2Points:l}}}_getNextIndexInTriangle(e,t=1){const i=e+t;return i<0?2:i>2?0:i}*generateStrings(){const{fill:e,renderTriangles:t,renderCaps:i,levels:n,renderRing:s,ringSize:r,ringColor:o}=this.config,a=this.getPoints();let l=-1;for(const s of a){l++;const r=l===n;let o=-1;const c=s.length-1;for(const h of s){o++;const d=this.calc.countPerLevelSide[l],u=o%d;if(e&&!r&&(0===o&&(yield*this.generateStringsBetweenTriangles({triangle1:s[c],triangle2:h,level:l,triangleIndex:c,triangleIndexInSide:c%d})),o!==c&&(yield*this.generateStringsBetweenTriangles({triangle1:h,triangle2:s[o+1],level:l,triangleIndex:o,triangleIndexInSide:u})),u%2==0&&(i||l<n-1))){const e=Math.floor(o/d)*this.calc.countPerLevelSide[l+1]+u+1;yield*this.generateStringsBetweenTriangles({triangle1:h,triangle2:a[l+1][e],level:l,triangleIndex:o,triangleIndexInSide:u,isNextLevel:!0,nextLevelTriangleIndex:e})}const g=o%this.calc.countPerLevelSide[l];t&&(!r||g%2)&&(yield*this.generateTriangleStrings({points:h,level:l,indexInSide:g}))}}s&&r&&(yield*this.circle.drawRing(this.renderer,{ringSize:r/2,color:o}))}getStepCount(e){if(this.stepCount)return this.stepCount;e||(e=this.getCalc());const{levels:t,density:i,fill:n,renderTriangles:s,renderCaps:r}=this.config,{triangleCount:o,ringNailCount:a=0}=e,l=n?2*i:0,c=t+(r?1:0);return o*((s?3*i:0)+l)+(s&&r?6*t*(i+1):0)+l*(c-1)*6*c/2+a}drawNails(){const e=this.getPoints();let t=0;for(const i of e)for(const e of i)if(null!=e)for(const i of e)for(const e of i)this.nails.addNail({point:e,number:t++});this.circle&&this.circle.drawNails(this.nails)}static thumbnailConfig={levels:3,density:3,fill:!1,renderRing:!0}}];const P={controls:document.querySelector("#controls"),controlsPanel:document.querySelector("#controls_panel"),sidebarForm:document.querySelector("#sidebar_form")},N=new Set(["input","change"]);let V;class E{constructor({pattern:e}){this.pattern=e,this.state=this._getState()??{groups:{}},this.eventHandlers={input:new Set,change:new Set},this._toggleFieldset=e=>{if("LEGEND"===e.target.nodeName){e.target.parentElement.classList.toggle("minimized");const t=e.target.parentElement.dataset.group;this.state={...this.state,groups:{...this.state.groups,[t]:!e.target.parentElement.classList.contains("minimized")}},this._updateState(this.state)}},this._toggleFieldSetOnEnter=e=>{"LEGEND"===e.target.nodeName&&"Enter"===e.key&&this._toggleFieldset(e)},this._wrappedOnInput=e=>this._onInput(e),P.controls.addEventListener("input",this._wrappedOnInput),this._wrappedOnTouchStart=e=>this._onTouchStart(e),P.controls.addEventListener("touchstart",this._wrappedOnTouchStart),P.sidebarForm.addEventListener("click",this._toggleFieldset),P.sidebarForm.addEventListener("keydown",this._toggleFieldSetOnEnter),this.controlElements={},this.renderControls()}destroy(){P.controls.removeEventListener("input",this._wrappedOnInput),P.sidebarForm.removeEventListener("click",this._toggleFieldset),P.sidebarForm.removeEventListener("keydown",this._toggleFieldSetOnEnter),P.controls.removeEventListener("touchstart",this._wrappedOnTouchStart),P.controls.innerHTML=""}addEventListener(e,t){if(!N.has(e))throw new Error(`Unsupported event for EditorControls, "${e}"!`);if(!(t instanceof Function))throw new Error("Invalid event handler.");this.eventHandlers[e].add(t)}_triggerEvent(e,t){for(const i of this.eventHandlers[e])i(t)}_onTouchStart(e){"range"===e.target.getAttribute("type")&&(this._postponeRangeInput=!0,this.currentInputRange=e.target,this.currentInputRangeValue=e.target.value,this._rangeLockTimeout=setTimeout((()=>{this._postponeRangeInput=!1}),120),this._wrappedOnTouchEnd=e=>this._onTouchEnd(e),document.body.addEventListener("touchend",this._wrappedOnTouchEnd),this._wrappedOnRangeScroll=e=>this._onRangeScroll(e),P.controlsPanel.addEventListener("scroll",this._wrappedOnRangeScroll))}_onTouchEnd(){document.body.removeEventListener("touchend",this._wrappedOnTouchEnd),P.controlsPanel.removeEventListener("scroll",this._wrappedOnRangeScroll),this._lockRange&&(this._lockRange=!1,this.currentInputRange&&(this.currentInputRange.value=this.currentInputRangeValue)),this.currentInputRange=this.currentInputRangeValue=null}_onRangeScroll(){this._lockRange=!0}_onInput(e){return clearTimeout(V),clearTimeout(this._postponeRangeInputTimeout),this._postponeRangeInput&&"range"===e.target.getAttribute("type")?(e.preventDefault(),this._postponeRangeInputTimeout=setTimeout((()=>{this._onInput(e)}),120),!1):this._lockRange?(e.preventDefault(),!1):void this.updateInput({inputElement:e.target,originalEvent:e,deferChange:!0})}updateInput({inputElement:e,originalEvent:t,deferChange:i=!0}){const n=function(e,t){switch(e){case"range":case"number":return parseFloat(t.value);case"checkbox":return t.checked;default:return t.value}}(e.type,e),s=e.id.replace(/^config_/,"");this.pattern.setConfigValue(s,n);const{config:r,displayValue:o}=this.controlElements[s];if(o){const t=r.displayValue?r.displayValue(this.pattern.config,r):e.value;o.innerText=t}const a=Object.freeze({control:s,value:n,originalEvent:t,pattern:this.pattern});this._triggerEvent("input",a);const l=()=>{this._triggerEvent("change",a),this.updateControlsVisibility()};i?V=setTimeout(l,100):l()}_getState(){const e=localStorage.getItem("controls_state");if(e)try{return JSON.parse(e)}catch(e){return null}return null}_updateState(e){e?localStorage.setItem("controls_state",JSON.stringify(e)):localStorage.removeItem("controls_state")}updateControlsVisibility(e=this.pattern.configControls){e.forEach((e=>{if(e.show){const t=e.show(this.pattern.config,e),i=this.controlElements[e.key].control;i&&(t?i.removeAttribute("hidden"):i.setAttribute("hidden","hidden"))}if(e.isDisabled){const t=e.isDisabled(this.pattern.config),i=this.controlElements[e.key].input;i&&(t?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled"))}e.children&&this.updateControlsVisibility(e.children)}))}updateInputs(e){Object.entries(e).forEach((([e,t])=>{const{input:i,value:n}=this.controlElements[e];i&&("checkbox"===i.type?i.checked=t:i.value=t,n&&(n.innerText=t))}))}renderControls(e=P.controls,t){const i=t??this.pattern.configControls;e.innerHTML="";const n=document.createDocumentFragment();i.forEach((e=>{const t=`config_${e.key}`,i=this.controlElements[e.key]={config:e};let s;if("group"===e.type){s=document.createElement("fieldset"),s.setAttribute("data-group",e.key);const t=document.createElement("legend");t.setAttribute("tabindex","0"),t.innerText=e.label,s.appendChild(t),s.className="control control_group","minimized"===e.defaultValue&&(s.classList.add("minimized"),this.state.groups[e.key]=!1);const i=document.createElement("div");s.appendChild(i),this.renderControls(i,e.children)}else{s=document.createElement("div"),s.className="control";const n=document.createElement("label");n.innerHTML=e.label,n.setAttribute("for",t);const r=i.input=document.createElement("input");r.setAttribute("type",e.type);const o=this.pattern.config[e.key]??e.defaultValue;if(e.attr&&Object.entries(e.attr).forEach((([e,t])=>{const i=t instanceof Function?t(this.pattern):t;r.setAttribute(e,i)})),"checkbox"===e.type)r.checked=o,s.appendChild(r),s.appendChild(n);else{s.appendChild(n),s.appendChild(r),r.value=o;const t=i.displayValue=document.createElement("span");t.id=`config_${e.key}_value`,t.innerText=e.displayValue?e.displayValue(this.pattern.config,e):o,t.className="control_input_value",s.appendChild(t)}r.id=t}this.controlElements[e.key].control=s,s.id=`control_${e.key}`,n.appendChild(s)})),e.appendChild(n),this.updateGroupsState(),requestAnimationFrame((()=>this.updateControlsVisibility()))}updateGroupsState(){P.sidebarForm.querySelectorAll("[data-group]").forEach((e=>{const t=e.dataset.group,i=this.state.groups[t];"boolean"==typeof i&&(i?e.classList.remove("minimized"):e.classList.add("minimized"))}))}}const R=document.querySelector("#size_controls"),I={sizeSelect:R.querySelector("#size_select"),sizeCustom:R.querySelector("#size_custom"),width:R.querySelector("#size_custom_width"),height:R.querySelector("#size_custom_height"),orientationSelect:R.querySelector("#size_orientation_select")};function A(e,t=300){return Math.floor(e/2.54*t)}const T=[Math.floor(window.screen.width),Math.floor(window.screen.height)],D=[{id:"fit",name:"Fit to screen"},{id:"A4",value:[20,28].map((e=>A(e))),orientationSelect:!0},{id:"A3",value:[28,40].map((e=>A(e))),orientationSelect:!0},{id:"screen",name:`Screen size (${T.join("x")})`,value:T},{id:"custom",name:"Custom..."}];class B extends n{constructor(e){super(e),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");const t=window.devicePixelRatio||1,i=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1;this.pixelRatio=t/i,this.ctx.globalCompositeOperation="source-over",e.appendChild(this.canvas)}destroy(){this.parentElement.removeElement(this.canvas)}reset(){this.ctx.clearRect(0,0,...this.getSize()),this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height");const[e,t]=this.getSize();this.canvas.setAttribute("width",e),this.canvas.setAttribute("height",t)}setColor(e){this.ctx.strokeStyle=e}setLineWidth(e){this.ctx.lineWidth=e}setBackground(e){this.ctx.globalCompositeOperation="destination-over",this.ctx.fillStyle=e,this.ctx.fillRect(0,0,...this.getSize()),this.ctx.globalCompositeOperation="source-over"}getSize(){return[this.canvas.clientWidth*this.pixelRatio,this.canvas.clientHeight*this.pixelRatio]}setSize(e){this.size=e,this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),e?(this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`):this.canvas.removeAttribute("style")}renderLines(e,...t){this.ctx.beginPath(),this.ctx.moveTo(...e);for(const e of t)this.ctx.lineTo(...e);this.ctx.stroke()}renderNails(e,{color:t,fontSize:i,radius:n,renderNumbers:s,margin:r=0}){const o=this.canvas.width/2;this.ctx.globalCompositeOperation="source-over",this.ctx.beginPath(),this.ctx.fillStyle=t,this.ctx.textBaseline="middle",this.ctx.font=`${i}px sans-serif`;const a=n+r;e.forEach((({point:[e,t],number:i})=>{if(this.ctx.moveTo(e+n,t),this.ctx.arc(e,t,n,0,d),s&&null!=i){const n=e<o,s=[n?e-a:e+a,t];this.ctx.textAlign=n?"right":"left",this.ctx.fillText(String(i),...s)}})),this.ctx.fill()}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}toDataURL(){return this.canvas.toDataURL()}}const O=/^\-?\d+(\.\d+)?$/,$=/^(?:!)([01])$/;function F(e,t){const i=t.replace(/(?:~)(\d+)(?:_)/g,((e,t)=>new Array(+t).fill("_").join(""))).split("_").map((e=>{if(""===e)return null;if(O.test(e))return parseFloat(e);const t=e.match($);return t?"1"===t[1]:e})),n=Object.keys(e.defaultConfig);return i.reduce(((e,t,i)=>{if(null!==t){const s=n[i];return{...e,[s]:t}}return e}),{})}async function U({renderer:e,pattern:t}){const i=e.toDataURL(),n=await(await fetch(i)).blob(),s=[new File([n],t.name+".jpg",{type:n.type,lastModified:(new Date).getTime()})];return{url:window.location.href,files:s,title:document.title,text:"String Art Studio - "+t.name}}window.addEventListener("error",(function(e){alert("Error: "+e.message)}));const q={canvas:document.querySelector("#canvas_panel"),patternLink:document.querySelector("#pattern_link"),downloadBtn:document.querySelector("#download_btn"),downloadNailsBtn:document.querySelector("#download_nails_btn"),resetBtn:document.querySelector("#reset_btn"),shareBtn:document.querySelector("#share_btn"),playerBtn:document.querySelector("#player_btn"),buttons:document.querySelector("#buttons"),instructionsLink:document.querySelector("#pattern_select_dropdown_instructions")},j=new B(q.canvas),W=z.map((e=>new e(j)));let J;const Z=new class{constructor(e){this.elements={player:e,step:e.querySelector("#step"),playerPosition:e.querySelector("#player_position"),playBtn:e.querySelector("#play_btn"),pauseBtn:e.querySelector("#pause_btn"),text:e.querySelector("#player_text")},this.stepCount=0,this._isPlaying=!1,this.elements.playerPosition.addEventListener("input",(({target:e})=>{this.goto(+e.value)})),this.elements.playBtn.addEventListener("click",(()=>{this.play()})),this.elements.pauseBtn.addEventListener("click",(()=>{this.pause()}))}updateStatus(e){this._isPlaying!==e&&(this.elements.player.classList.toggle("playing"),this._isPlaying=e)}update(e,{draw:t=!0}={}){this.stringArt=e,this.stepCount=e.getStepCount(),this.elements.playerPosition.setAttribute("max",this.stepCount),this.elements.step.innerText=`${this.stepCount}/${this.stepCount}`,this.elements.text.style.removeProperty("width"),this.elements.text.style.width=(this.elements.text.clientWidth||70)+"px",this.goto(this.stepCount,{updateStringArt:t})}updatePosition(e){this.elements.step.innerText=`${e}/${this.stepCount}`,this.elements.playerPosition.value=e}goto(e,{updateStringArt:t=!0}={}){this.pause(),this.updatePosition(e),t&&this.stringArt.goto(e)}setInstructions(e){}play(){this.updateStatus(!0),cancelAnimationFrame(this.renderRafId),this.stringArt.position===this.stepCount&&this.stringArt.goto(0);const e=this;!function t(){e.stringArt.drawNext().done?e.updateStatus(!1):e.renderRafId=requestAnimationFrame(t);e.updatePosition(e.stringArt.position)}()}pause(){cancelAnimationFrame(this.renderRafId),this.updateStatus(!1)}toggle(){this._isPlaying?this.pause():this.play()}}(document.querySelector("#player")),H=new class{element=document.querySelector("#size_controls");constructor({getCurrentSize:e}){const t=document.createDocumentFragment();D.forEach((e=>{const i=document.createElement("option");i.setAttribute("value",e.id),i.innerText=e.name??e.id,t.appendChild(i)})),I.sizeSelect.appendChild(t),this.selectedSize=D[0],I.sizeSelect.addEventListener("change",(t=>{const i=t.target.value,n=D.find((({id:e})=>e===i));if(this.selectedSize=n,"custom"===n.id){I.sizeCustom.removeAttribute("hidden");const[t,i]=e();I.width.value=t,I.height.value=i}else I.sizeCustom.setAttribute("hidden","hidden"),this._notifyOnChange(this.getValue());n.orientationSelect?I.orientationSelect.removeAttribute("hidden"):I.orientationSelect.setAttribute("hidden","hidden")})),I.orientationSelect.addEventListener("change",(e=>{this._notifyOnChange(this.getValue())})),I.sizeCustom.addEventListener("focusin",(e=>{e.target.select()})),I.sizeCustom.addEventListener("input",(()=>{this._notifyOnChange([I.width.value?parseInt(I.width.value):null,I.height.value?parseInt(I.height.value):null])}))}_notifyOnChange([e,t]=[]){this.element.dispatchEvent(new CustomEvent("sizechange",{detail:{width:e,height:t}}))}getValue(){if("custom"===this.selectedSize.id)return[parseInt(I.width.value,10),parseInt(I.height.value,10)];{let e=this.selectedSize.value;return this.selectedSize.orientationSelect&&"horizontal"===I.orientationSelect.value&&(e=Array.from(e).reverse()),e}}}({getCurrentSize:()=>[q.canvas.clientWidth,q.canvas.clientHeight]}),G=new class{elements={root:document.querySelector("#pattern_select_panel"),thumbnails:document.querySelector("#pattern_select_thumbnails"),toggleBtn:document.querySelector("#pattern_select_btn"),dropdown:document.querySelector("#pattern_select_dropdown")};constructor(){this.elements.toggleBtn.addEventListener("click",(()=>this.toggle()))}toggle(){this.elements.root.classList.contains("minimized")?this.open():this.pattern&&this.close()}open(){this.elements.root.classList.contains("minimized")&&(this.elements.root.classList.remove("minimized"),this.thumbnailsRendered||(this.createThumbnails(),this.thumbnailsRendered=!0),this._onClickOutside=e=>{e.target.closest("#pattern_select_panel")||this.toggle()},document.body.addEventListener("mousedown",this._onClickOutside))}close(){this.elements.root.classList.contains("minimized")||(this.elements.root.classList.add("minimized"),document.body.removeEventListener("mousedown",this._onClickOutside),this._onClickOutside=null)}setCurrentPattern(e){this.pattern=e,this.elements.toggleBtn.innerText=e?.name??"Choose a pattern"}createThumbnails(){const e=document.createDocumentFragment(),t=[];z.forEach((i=>{const n=document.createElement("a"),s=new B(n);n.style.width=n.style.height="100px";const r=new i(s);r.config=Object.assign({margin:1,enableBackground:!1,nailRadius:.5},i.thumbnailConfig),t.push(r);const o=document.createElement("li");e.appendChild(o),n.href=`?pattern=${r.id}`,n.setAttribute("data-pattern",r.id),n.title=r.name,o.appendChild(n)})),this.elements.thumbnails.appendChild(e),t.forEach((e=>e.draw())),this.elements.thumbnails.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();const t=e.target.closest("[data-pattern]");if(!t)return!1;this.elements.root.dispatchEvent(new CustomEvent("change",{detail:{pattern:t.dataset.pattern}})),this.toggle()}))}addOnChangeListener(e){this.elements.root.addEventListener("change",e)}removeOnChangeListener(e){this.elements.root.removeEventListener("change",e)}};let X;async function Q(){if(!J)throw new Error("Can't init pattern - no current pattern available!");H.element.addEventListener("sizechange",(({detail:e})=>{var t;(t=e).width&&t.height?(j.setSize(t),q.canvas.classList.contains("overflow")||q.canvas.classList.add("overflow")):(q.canvas.classList.remove("overflow"),j.setSize(null)),J.draw()})),window.addEventListener("resize",(()=>J&&J.draw())),q.downloadBtn.addEventListener("click",Y),q.downloadNailsBtn.addEventListener("click",K),q.resetBtn.addEventListener("click",ee);await async function(e){if(!navigator.share)return!1;const t=await U(e);return navigator.canShare(t)}({renderer:j,pattern:J})&&oe(q.shareBtn)}function Y(){const e=document.createElement("a");e.download=J.name+".png",e.href=j.toDataURL(),e.setAttribute("target","download"),e.click()}function K(){const e=J.config;J.config={darkMode:!1,showNails:!0,showNailNumbers:!0,showStrings:!1,nailsColor:"#000000"},J.draw(),Y(),J.config=e,J.draw()}function ee(){confirm("Are you sure you wish to reset options to defaults?")&&ie(J,{config:{}})}function te({withConfig:e=!0}={}){Z.update(J);const t=e?function(e){const{defaultConfig:t,config:i}=e,n=Object.entries(i).map((([e,i])=>i===t[e]?null:"boolean"==typeof i?"!"+(i?1:0):"number"==typeof i?parseFloat(i.toFixed(6)):i));for(;null===n[n.length-1];)n.pop();return n.length?n.join("_").replace(/\_{2,}/g,(e=>"~"+e.length+"_")):""}(J):null;history.replaceState({pattern:J.id,config:t},J.name,`?pattern=${J.id}${e&&t?`&config=${encodeURIComponent(t)}`:""}`)}function ie(e,t){re(e,t),history.pushState({pattern:e.id},e.name,"?pattern="+e.id)}function ne(e){if(e?.pattern){const t=se(e.pattern);re(t,{draw:!1,config:e.config?F(t,e.config):{}}),G.close(),J.draw()}else le(),G.open()}function se(e){const t=W.find((({id:t})=>t===e));if(!t)throw new Error(`Pattern with id "${e}" not found!`);return t}function re(e,{config:t,draw:i=!0}={}){const n=!J;J=e,t&&J.setConfig(t),X&&X.destroy(),X=new E({pattern:e,config:t}),X.addEventListener("input",(()=>J.draw())),X.addEventListener("change",te),e.link?(q.patternLink.setAttribute("href",e.link),q.patternLink.innerText=e.linkText??"Example",oe(q.patternLink)):ae(q.patternLink),i&&requestAnimationFrame((()=>{J.draw()})),Z.update(J,{draw:!1}),G.setCurrentPattern(e),document.title=`${e.name} - String Art Studio`,document.body.setAttribute("data-pattern",e.id),n&&(Q(),document.body.querySelectorAll(".pattern_only").forEach(oe))}function oe(e){e.removeAttribute("hidden")}function ae(e){e.setAttribute("hidden","hidden")}function le(){J=null,j.clear(),ae(q.patternLink),G.setCurrentPattern(null),X&&X.destroy(),document.body.querySelectorAll(".pattern_only").forEach(ae),document.body.removeAttribute("data-pattern")}window.addEventListener("load",(async function(){if(function(){window.addEventListener("popstate",(({state:e})=>{ne(e)}))}(),await async function(){if(navigator.serviceWorker&&"127.0.0.1"!==document.location.hostname)try{const e=await navigator.serviceWorker.register("service-worker.js");e.onupdatefound=()=>{const t=e.installing;null!=t&&(t.onstatechange=()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."):console.log("Content is cached for offline use."))})}}catch(e){console.error("Error during service worker registration:",e)}}(),document.body.querySelectorAll(".pattern_only").forEach(ae),oe(document.querySelector("main")),history.state?.pattern)ne(history.state);else{const e=new URLSearchParams(document.location.search),t=e.get("pattern");if(t){const i=e.get("config");ne({pattern:t,config:i})}else G.toggle()}q.downloadBtn.addEventListener("click",Y),q.downloadNailsBtn.addEventListener("click",K),q.resetBtn.addEventListener("click",ee),q.shareBtn.addEventListener("click",(async()=>await async function(e){try{navigator.share(await U(e))}catch(e){alert("Error: "+e.message)}}({renderer:j,pattern:J}))),q.playerBtn.addEventListener("click",(()=>{document.querySelectorAll("#buttons [data-toggle-for]").forEach((e=>{e.classList.contains("active")&&e.click()}))})),q.instructionsLink.addEventListener("click",(e=>{e.preventDefault(),history.pushState({pattern:null},"String Art Studio","./"),le()})),G.addOnChangeListener((({detail:e})=>{ie(se(e.pattern))})),document.body.addEventListener("click",(e=>{const t=e.target.closest("[data-toggle-for]");if(t){const e=t.dataset.toggleFor;t.classList.toggle("active");document.querySelector("#"+e).classList.toggle("open"),document.body.classList.toggle("dialog_"+e),J&&J.draw({position:J.position})}}))}));
//# sourceMappingURL=index.c27fbe04.js.map
