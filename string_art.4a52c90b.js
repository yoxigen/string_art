let t;class e{viewer;elements;stepCount;#t;#e;constructor(t,e){this.viewer=e,this.elements={player:t,step:t.querySelector("#step"),playerPosition:t.querySelector("#player_position"),playBtn:t.querySelector("#play_btn"),pauseBtn:t.querySelector("#pause_btn"),text:t.querySelector("#player_text")},this.stepCount=0,this.#t=!1,this.elements.playerPosition.addEventListener("input",({target:t})=>{"value"in t&&this.goto(+t.value)}),this.elements.playBtn.addEventListener("click",()=>{this.play({restartIfAtEnd:!0})}),this.elements.pauseBtn.addEventListener("click",()=>{this.pause()}),e.addEventListener("positionChange",({changeBy:t})=>this.advance(t)),e.addEventListener("click",()=>this.#t?this.pause():this.advance()),e.addEventListener("touchStart",()=>this.play({speed:200})),e.addEventListener("touchEnd",()=>this.pause())}updateStatus(t){this.#t!==t&&(this.elements.player.classList.toggle("playing"),this.#t=t)}update(t,{draw:e=!0}={}){this.stepCount=t,this.elements.playerPosition.setAttribute("max",String(this.stepCount)),this.elements.step.innerText=`${this.stepCount}/${this.stepCount}`,this.elements.text.style.removeProperty("width"),this.elements.text.style.width=(this.elements.text.clientWidth||70)+"px",this.goto(this.stepCount,{updateStringArt:e})}updatePosition(t){this.elements.step.innerText=`${t}/${this.stepCount}`,this.elements.playerPosition.value=String(t)}goto(t,{updateStringArt:e=!0}={}){t>this.stepCount||t<1||(this.pause(),this.updatePosition(t),e&&this.viewer.goto(t))}advance(t=1){this.goto(Math.max(1,Math.min(this.stepCount,Number(this.elements.playerPosition.value)+t)))}setInstructions(t){}play({restartIfAtEnd:t=!1,speed:e}={}){let i=this.viewer.position===this.stepCount;if(i&&!t)return;this.updateStatus(!0),this.#e?.(),i&&this.viewer.goto(0);let n=()=>{if(this.viewer.next().done)this.updateStatus(!1);else if(e){let t=setTimeout(n,e);this.#e=()=>clearTimeout(t)}else{let t=requestAnimationFrame(n);this.#e=()=>cancelAnimationFrame(t)}this.updatePosition(this.viewer.position)};n()}pause(){this.#e?.(),this.updateStatus(!1)}toggle(){this.#t?this.pause():this.play()}}function*i(t,e){let n=0;for(let s of t)yield{control:s,index:n,parent:e},s.children&&(yield*i(s.children,{control:s,parent:e,index:n})),n++}function n(t,e){let i=t.attr;if(!i)return t;let n={...i};return delete n[e],{...t,attr:n}}function s(t){return t.map(t=>{let e={...t};return t.children&&(e.children=s(t.children)),t.attr&&(e.attr={...t.attr}),e})}function r(t,e,n){let r=s(t),a=function(t,e){var n=({key:t})=>t===e;for(let e of i(t))if(n(e.control))return e;return null}(r,e);if(a){let{index:t,parent:e}=a;return(e?.control.children??r).splice(t+1,0,...n),r}return t}var a=[{key:"isMultiColor",label:"Use multiple colors",defaultValue:!1,type:"checkbox",affectsNails:!1,affectsStepCount:!1},{key:"colorCount",label:"Colors count",defaultValue:7,type:"range",attr:{min:1,max:20,step:1},show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"color",label:"String color",defaultValue:"#ff4d00",type:"color",show:({isMultiColor:t})=>!t,affectsNails:!1,affectsStepCount:!1},{key:"multicolorStart",label:"Multicolor start",defaultValue:1,type:"hue",attr:{colorthumb:!0},show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"multicolorRange",label:"Multicolor range",defaultValue:360,type:"hue",attr:{start:({multicolorStart:t})=>t,type:"range"},show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"saturation",label:"Saturation",defaultValue:100,type:"range",attr:{min:0,max:100,step:1},show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"lightness",label:"Lightness",type:"group",defaultValue:"minimized",show:({isMultiColor:t})=>t,children:[{key:"multicolorByLightness",label:"Multi lightness",defaultValue:!1,type:"checkbox",show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"minLightness",label:"Minimum lightness",defaultValue:0,type:"range",attr:{min:0,max:100,step:1,snap:"50",thumbcolor:({minLightness:t})=>`hsl(0 0 ${t})`,background:"linear-gradient(to right, black, white)"},show:({multicolorByLightness:t,isMultiColor:e})=>t&&e,affectsNails:!1,affectsStepCount:!1},{key:"maxLightness",label:"Maximum lightness",defaultValue:100,type:"range",attr:{min:0,max:100,step:1,snap:"50",thumbcolor:({maxLightness:t})=>`hsl(0 0 ${t})`,background:"linear-gradient(to right, black, white)"},show:({multicolorByLightness:t,isMultiColor:e})=>t&&e,affectsNails:!1,affectsStepCount:!1}]},{key:"colorOrderGroup",type:"group",label:"Order",defaultValue:"minimized",show:({isMultiColor:t})=>t,children:[{key:"reverseColors",label:"Reverse colors order",defaultValue:!1,type:"checkbox",show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"repeatColors",label:"Repeat colors",defaultValue:!0,type:"checkbox",show:({isMultiColor:t})=>t,affectsNails:!1,affectsStepCount:!1},{key:"mirrorColors",label:"Mirror Colors",defaultValue:!1,type:"checkbox",show:({isMultiColor:t,repeatColors:e})=>t&&e,affectsNails:!1,affectsStepCount:!1}]}];class l{config;multiColorStep;multiColorLightnessStep;colors;constructor(t){this.config=t;let{multicolorRange:e,colorCount:i,multicolorByLightness:n,minLightness:s=0,maxLightness:r=100,multicolorStart:a,darkMode:l,saturation:o,reverseColors:c,repeatColors:u,mirrorColors:h,isMultiColor:d}=t;if(d){if(this.multiColorStep=e/Math.max(1,i-1),this.multiColorLightnessStep=n?(r-s)/(Math.max(i,2)-1):1,this.colors=Array(i).fill(null).map((t,e)=>{let i=n?s+this.multiColorLightnessStep*e:l?50:40;return`hsl(${a+e*this.multiColorStep}, ${o}%, ${i}%)`}),u&&h){let[t,...e]=this.colors;e.pop(),this.colors=[...this.colors,...e.reverse()]}c&&this.colors.reverse()}}getColor(t){let{isMultiColor:e,colorCount:i,color:n,repeatColors:s}=this.config;return e?(t>=i&&(t=s?t%this.colors.length:this.colors.length-1),this.colors[t]):n}static getOppositeColor(t){let e=t.match(/^hsl\((\d+)(?:deg)?(?:,?\s?)(\d+%?)(?:,?\s?)(\d+%?)\)$/);if(e){let t=(Number(e[1])+180)%360;return`hsl(${t}, ${e[2]}, ${e[3]})`}return null}getColorMap({stepCount:t,colorCount:e}){if(!e)throw Error("Can't get color map, no colorCount provided!");let i=Math.floor(t/e),n=new Map;for(let t=0;t<e;t++)n.set(t*i,this.getColor(t));return n}static getConfig({include:t,exclude:e,defaults:i={},customControls:n,propMapper:r,groupLabel:l,maxColorCount:o}){return{key:"colorGroup",label:l??"Color",type:"group",children:[...n??[],...function t(e,i){return i?e.map(e=>(e.children&&(e={...e,children:t(e.children,i)}),{...e,...i(e)})):e}(function n(r){return(r??s(a)).filter(({key:i})=>(!e||!e.includes(i))&&(!t||t.includes(i))).map(t=>{let e={...t,defaultValue:i[t.key]??t.defaultValue};return"group"===t.type&&(e.children=n(t.children)),"colorCount"===t.key&&o&&(e.attr.max=o),Object.freeze(e)})}(),r)]}}}function o(t,e){return t[0]===e[0]&&t[1]===e[1]}const c={color:"#ffffff",fontSize:10,radius:1.5,renderNumbers:!1,margin:4};class u{nailRadius=c.radius;nailsColor=c.color;nailNumbersFontSize=c.fontSize;nails;addedPoints;#i=[];constructor(t){this.setConfig(t),this.nails=[],this.addedPoints=new Set}setConfig({nailRadius:t,nailsColor:e,nailNumbersFontSize:i}){this.nailRadius=t,this.nailsColor=e,this.nailNumbersFontSize=i,this.nails=[],this.addedPoints&&this.addedPoints.clear()}addNail(t){let e=t.point.map(Math.round).join("_");this.addedPoints.has(e)||(this.nails.push(t),this.addedPoints.add(e))}addGroup(t,e){this.#i.push({nails:t,options:e})}#n(t,e,i){t.renderNails(e,{...c,...i})}draw(t,{drawNumbers:e=!0}={}){let i={color:this.nailsColor,fontSize:this.nailNumbersFontSize,radius:this.nailRadius,renderNumbers:e};this.#n(t,this.nails,i),this.nails=[],this.addedPoints.clear(),this.#i.forEach(({nails:e,options:n})=>{this.#n(t,e,{...i,...n})}),this.#i=[]}}const h="#0e0e0e",d=[{key:"strings",label:"Strings",type:"group",defaultValue:"minimized",children:[{key:"showStrings",label:"Show strings",defaultValue:!0,type:"checkbox",isDisabled:({showNails:t})=>!t,affectsNails:!1},{key:"stringWidth",label:"String width",defaultValue:1,type:"range",attr:{min:.2,max:4,step:.1,snap:"1"},show:({showStrings:t})=>t,affectsNails:!1}]},{key:"nails",label:"Nails",type:"group",defaultValue:"minimized",children:[{key:"showNails",label:"Show nails",defaultValue:!0,type:"checkbox",isDisabled:({showStrings:t})=>!t,affectsStrings:!1},{key:"showNailNumbers",label:"Show nail numbers",defaultValue:!1,type:"checkbox",show:({showNails:t})=>t,affectsStrings:!1},{key:"nailNumbersFontSize",label:"Nail numbers font size",defaultValue:10,type:"range",attr:{min:6,max:24,step:.5},displayValue:({nailNumbersFontSize:t})=>`${t}px`,show:({showNails:t,showNailNumbers:e})=>t&&e,affectsStrings:!1},{key:"margin",label:"Margin",defaultValue:20,type:"number",attr:{min:0,max:500,step:1},displayValue:({margin:t})=>`${t}px`},{key:"nailRadius",label:"Nail size",defaultValue:1.5,type:"range",attr:{min:.5,max:5,step:.25,snap:"1.5"},show:({showNails:t})=>t,affectsStrings:!1},{key:"nailsColor",label:"Nails color",defaultValue:"#ffffff",type:"color",show:({showNails:t})=>t,affectsStrings:!1}]},{key:"background",label:"Background",type:"group",defaultValue:"minimized",children:[{key:"darkMode",label:"Dark mode",defaultValue:!0,type:"checkbox",isDisabled:({enableBackground:t})=>!t,affectsNails:!1},{key:"customBackgroundColor",label:"Custom background color",defaultValue:!1,type:"checkbox",isDisabled:({enableBackground:t})=>!t,affectsNails:!1},{key:"backgroundColor",label:"Background color",defaultValue:h,type:"color",show:({customBackgroundColor:t})=>t,isDisabled:({enableBackground:t})=>!t,affectsNails:!1},{key:"enableBackground",label:"Enable background",defaultValue:!0,type:"checkbox",affectsNails:!1}]}];var g=class{controls=[];defaultValues={};stepCount=null;size=null;center=null;nails=null;position=0;stringsIterator;id;name;link;linkText;#s;#r;#a;constructor(){}static thumbnailConfig;static type;getCommonControls(){return d}get configControls(){return(this.controls??[]).concat(this.getCommonControls())}get controlsIndex(){return this.#r||(this.#r=function(t){let e={};for(let{control:n}of i(t))e[n.key]=n;return e}(this.configControls)),this.#r}get type(){return this.constructor.type}get isTemplate(){return this.type===this.id}get defaultConfig(){return this.#a||(this.#a=Object.freeze(Object.assign(function(t){let e={};for(let{control:{key:n,defaultValue:s}}of i(t))s instanceof Function||(e[n]=s);return e}(this.configControls),this.defaultValues))),this.#a}get config(){return this.#s??this.defaultConfig}set config(t){this.#s=Object.assign({},this.defaultConfig,t)}assignConfig(t){this.#s=Object.assign({},this.config,t)}setConfig(t){let e=this.config;if(this.config=t,this.onConfigChange){let i=Object.keys(e).filter(i=>t[i]!==e[i]);this.onConfigChange(i.map(e=>({control:this.controlsIndex[e],value:t[e]})))}}resetStructure(){}onConfigChange(t){t.some(({control:t})=>t.isStructural)&&(this.resetStructure(),null!=this.stepCount&&t.some(({control:t})=>!1!==t.affectsStepCount)&&(this.stepCount=null))}onResize(){this.resetStructure()}setConfigValue(t,e){(!this.#s||this.#s[t]!==e)&&(this.#s=Object.freeze({...this.#s??this.defaultConfig,[t]:e}),this.onConfigChange&&this.onConfigChange([{control:this.controlsIndex[t],value:e}].filter(({control:t})=>!!t)))}getSize(){return this.size}setUpDraw(t){}afterDraw(){}setSize(t){let e=this.size&&!o(t,this.size);this.size=t,this.center=t.map(t=>t/2),e&&this.onResize()}initDraw(t,{redrawNails:e=!0,redrawStrings:i=!0}={}){this.setSize(t.getSize()),i&&t.resetStrings(),e&&t.resetNails(),this.nails?this.nails.setConfig(this.config):this.nails=new u(this.config),t.setLineWidth(this.config.stringWidth),this.setUpDraw({size:this.size})}draw(t,{position:e=1/0,...i}={}){this.initDraw(t,i);let{showNails:n,showNailNumbers:s,darkMode:r,backgroundColor:a,customBackgroundColor:l,enableBackground:o}=this.config;if(o&&t.setBackground(l?a:r?h:"#ffffff"),n&&!1!==i.redrawNails&&(this.drawNails(),this.nails.draw(t,{drawNumbers:s})),!1!==i.redrawStrings){let{showStrings:i}=this.config;if(i){for(this.stringsIterator=this.drawStrings(t),this.position=0;!this.drawNext().done&&this.position<e;);this.afterDraw()}}}goto(t,e){if(e!==this.position)if(this.stringsIterator&&e>this.position)for(;!this.drawNext().done&&this.position<e;);else this.draw(t,{position:e,redrawNails:!1})}drawNext(){let t=this.stringsIterator.next();return t.done?this.afterDraw():this.position++,t}};const p={linear:t=>t,inOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeOutQuint:t=>1-Math.pow(1-t,5),fastSlowFast:t=>.5*(1-Math.cos(Math.PI*(t=Math.max(0,Math.min(1,t)))))**1.5,fastInOutSquare:t=>t<=.5?(1-Math.pow(1-2*t,2))/2:.5+Math.pow(2*t-1,2)/2,fastInOutCubic:t=>t<=.5?(1-Math.pow(1-2*t,3))/2:.5+Math.pow(2*t-1,3)/2,fastInOutQuint:t=>t<=.5?(1-Math.pow(1-2*t,5))/2:.5+Math.pow(2*t-1,5)/2,fastInOut:(t,e)=>e<=.5?(1-Math.pow(1-2*e,t))/2:.5+Math.pow(2*e-1,t)/2,fastInOutFixed(t,e,i){if(i>e&&i<1-e){let n=(1-Math.pow(1-2*e,t))/2,s=.5+Math.pow((1-e)*2-1,t)/2;return n+(i-e)*(s-n)/(1-2*e)}return i<=e?(1-Math.pow(1-2*i,t))/2:.5+Math.pow(2*i-1,t)/2}};p.fastInOut.requirePower=!0,p.fastInOutFixed.requirePower=!0,p.fastInOutFixed.requireFastArea=!0;const f=2*Math.PI;function m(t,e,i){if(t===e)return!0;if("object"==typeof t&&"object"==typeof e){if(null===t!=(null===e))return!1;if(t instanceof Array&&e instanceof Array){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!m(t[i],e[i]))return!1;return!0}return(!!i||(i=Object.keys(t)).length===Object.keys(e).length)&&!(i&&i.some(i=>!m(t[i],e[i])))}return t===e}class y{points;easingFunction;config;center;xyRadius;rotationAngle=0;indexAngle;isReverse=!1;radius;arc=f;isPartialArc=!1;excludedNailIndexes;constructor(t){this.setConfig(t)}getPoint(t=0){let e=this.getNailIndex(t);if(this.points.has(t))return this.points.get(t);let i=this.easingFunction(e/(this.config.n-!!this.isPartialArc))*this.arc+this.rotationAngle+(this.config.angleStart??0),n=[this.center[0]+Math.sin(i)*this.xyRadius[0],this.center[1]+Math.cos(i)*this.xyRadius[1]];return this.points.set(t,n),n}getNailIndex(t=0){let e=this.isReverse?this.config.n-1-t:t;return e>this.config.n-1&&(e%=this.config.n),e}setConfig(t){if(!m(t,this.config)){let{n:e,size:i,margin:n=0,rotation:s=0,center:r,radius:a,reverse:l=!1,angleStart:o,angleEnd:c}=t,u=r??i.map(t=>t/2),h=a??Math.min(...u)-n,d=[h,h];t.distortion&&(d=function(t,e){let i=Math.min(e[0]/t[0],e[1]/t[1]);return t.map(t=>t*i)}(t.distortion<0?[h*(1-Math.abs(t.distortion)),h]:[h/(1-t.distortion),h],u.map(t=>t-n))),this.isPartialArc=o&&c&&c>o;let g=this.isPartialArc?c-o:f,m={center:u,radius:h,xyRadius:d,indexAngle:g/(this.isPartialArc?e-1:e),rotationAngle:-f*s,isReverse:l,arc:g},y=t.displacementFunc?p[t.displacementFunc]:p.linear,b=[];y.requirePower&&b.push(t.displacementMag),y.requireFastArea&&b.push(t.displacementFastArea);let C=b.length?y.bind(null,...b):y;this.easingFunction=C,this.config=t,Object.assign(this,m),this.points?this.points.clear():this.points=new Map}}*generateNails({nailsNumberStart:t=0,getNumber:e,excludedNailRanges:i}={}){let n,{n:s}=this.config;i&&(n=new Set,i.forEach(([t,e])=>{let i=Math.min(e,s);for(let e=Math.max(0,t);e<=i;e++)n.add(e)}));let r=0;for(let i=0;i<this.config.n;i++)!n?.has(i)&&(yield{point:this.getPoint(i),number:e?e(r):r+t},r++)}drawNails(t,e={}){let i=[],{color:n,...s}=e;for(let t of this.generateNails(s))i.push(t);t.addGroup(i,{color:n})}*drawRing(t,{ringSize:e,color:i}){let n,{n:s}=this.config,r=Math.floor(e*s),a=0,l=!1;t.setColor(i);for(let e=0;e<s;e++){n||(n=this.getPoint(0));let i=n,o=[];a=l?e:a+r,n=this.getPoint(a),o.push(n),e<s-1&&(a++,n=this.getPoint(a),o.push(n)),t.renderLines(i,...o),yield,l=!l}}static rotationConfig={key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1+1/360,step:1/360,snap:"0.25, 0.5, 0.75"},displayValue:({rotation:t})=>`${Math.round(360*t)}\xb0`,isStructural:!0,affectsStepCount:!1};static nailsConfig=Object.freeze({key:"n",label:"Number of nails",defaultValue:144,type:"range",attr:{min:3,max:300,step:1},isStructural:!0});static displacementConfig={key:"displacement",label:"Displacement",type:"group",children:[{key:"displacementFunc",label:"Displacement function",defaultValue:"linear",type:"select",options:Object.keys(p),isStructural:!0,affectsStepCount:!1},{key:"displacementMag",label:"Displacement magnitude",defaultValue:3,type:"range",attr:{min:0,max:10,step:.1},show:({displacementFunc:t})=>p[t].requirePower,isStructural:!0,affectsStepCount:!1},{key:"displacementFastArea",label:"Displacement fast area",defaultValue:.4,type:"range",attr:{min:0,max:.5,step:.01},show:({displacementFunc:t})=>p[t].requireFastArea,isStructural:!0,affectsStepCount:!1}]};static distortionConfig={key:"distortion",label:"Distortion",defaultValue:0,type:"range",attr:{min:-.99,max:.99,step:.01,snap:"0"},isStructural:!0,affectsStepCount:!1}}const b=l.getConfig({defaults:{isMultiColor:!0,colorCount:7,color:"#ffbb29",multicolorRange:21,multicolorStart:32,multicolorByLightness:!0,minLightness:36,maxLightness:98}});class C extends g{static type="spiral";id="spiral";name="Spiral";link="https://www.etsy.com/il-en/listing/840974781/boho-wall-decor-artwork-spiral-round";controls=[{...y.nailsConfig,defaultValue:200},{key:"repetition",label:"Repetition",defaultValue:5,type:"range",attr:{min:1,max:20,step:1},affectsNails:!1},{key:"innerLength",label:"Spiral thickness",defaultValue:.5,type:"range",attr:{min:({n:t})=>1/t,max:1,step:({n:t})=>1/t},displayValue:({n:t,innerLength:e})=>Math.round(t*e),affectsNails:!1},{...y.rotationConfig,defaultValue:.75},y.distortionConfig,b];#l;#o;#c;#u;setUpDraw(){super.setUpDraw();let{n:t,rotation:e,margin:i,colorCount:n,repetition:s,distortion:r}=this.config;this.#l=2*s-1;let a={size:this.size,n:t,margin:i,rotation:e,distortion:r};this.#o?this.#o.setConfig(a):this.#o=new y(a),this.#c=new l({...this.config,colorCount:n}),n&&(this.#u=this.#c.getColorMap({stepCount:this.getStepCount(),colorCount:n}))}*drawSpiral(t,{shift:e=0,color:i="#ffffff"}={}){let{innerLength:n,n:s}=this.config,r=Math.round(n*s),a=0;t.setColor(i);let l=e,o=this.#o.getPoint(l),c=!1;for(let e=0;r>0;e++){if(this.#u){let i=this.#u.get(e);i&&t.setColor(i)}l=c?l-r+1:l+r,a===this.#l?(r--,a=0,l++):a++;let i=this.#o.getPoint(l);t.renderLines(o,i),o=i,yield,c=!c}}*drawStrings(t){yield*this.drawSpiral(t,{color:this.#c.getColor(0)})}getStepCount(){let{innerLength:t,repetition:e,n:i}=this.config;return Math.round(2*t*i*e)}drawNails(){this.#o.drawNails(this.nails)}static thumbnailConfig={n:60}}class S extends g{static type="spirals";name="Spirals";id="spirals";link="https://www.etsy.com/il-en/listing/974865185/3d-string-art-spiral-mandala-wall?ref=shop_home_active_10&frs=1";controls=[{key:"radiusIncrease",label:"Radius change",defaultValue:5.7,type:"range",attr:{min:1,max:20,step:.1}},{key:"angleStep",label:"Angle step",defaultValue:.45,type:"range",attr:{min:0,max:1,step:.01}},{key:"nSpirals",label:"Number of spirals",defaultValue:3,type:"range",attr:{min:1,max:20,step:1}},{...y.rotationConfig,defaultValue:330/360},l.getConfig({defaults:{isMultiColor:!0,colorCount:4,color:"#00d5ff",multicolorRange:1,multicolorStart:190,multicolorByLightness:!0,minLightness:50,maxLightness:88,reverseColors:!0}})];calc;color;colorMap;getCalc(){let{nSpirals:t,rotation:e,margin:i,radiusIncrease:n,angleStep:s}=this.config,r=Math.min(...this.size)/2-i;return{spiralRotations:Array(t).fill(null).map((e,i)=>i*f/t),rotationAngle:-f*e,nailsPerSpiral:Math.floor(r/n),angleIncrease:s/(r/50)}}setUpDraw(t){super.setUpDraw(t);let{colorCount:e}=this.config;this.calc=this.getCalc(),this.color=new l(this.config),this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(t),colorCount:e})}*generatePoints(){let{nSpirals:t}=this.config;for(let e=0;e<this.calc.nailsPerSpiral;e++)for(let i=0;i<t;i++){let t=this.getPoint(i,e);yield{point:t,nailNumber:`${i}_${e}`}}}getPoint(t,e){let[i,n]=this.center,{radiusIncrease:s}=this.config,r=this.calc.rotationAngle+this.calc.angleIncrease*e+this.calc.spiralRotations[t],a=e*s;return[i+a*Math.sin(r),n+a*Math.cos(r)]}*drawStrings(t){let e=this.generatePoints(),i=0;t.setColor(this.color.getColor(0));let n=this.center;for(let{point:s}of e){if(this.colorMap){let e=this.colorMap.get(i);e&&t.setColor(e)}n&&t.renderLines(n,s),n=s,i++,yield}}getStepCount({size:t}){let{nSpirals:e,radiusIncrease:i,margin:n}=this.config;return Math.floor((Math.min(...t)/2-n)/i)*e}drawNails(){for(let{point:t,nailNumber:e}of this.generatePoints())this.nails.addNail({point:t,number:e})}static thumbnailConfig={radiusIncrease:1.4,angleStep:.11}}class w extends g{static type="mandala";name="Mandala";id="mandala";link="https://www.youtube.com/watch?v=qhbuKbxJsk8";linkText="Learn";controls=[{key:"n",label:"Number of nails",defaultValue:180,type:"range",attr:{min:3,max:240,step:1}},{key:"base",label:"Multiplication",defaultValue:2,type:"range",attr:{min:2,max:99,step:1},affectsNails:!1},{key:"layers",label:"Layers",defaultValue:7,type:"range",attr:{min:1,max:20,step:1}},y.rotationConfig,y.distortionConfig,l.getConfig({defaults:{isMultiColor:!0,multicolorRange:165,multicolorStart:256,color:"#ff4d00"},exclude:["colorCount"]})];circle;color;calc;get n(){return this.calc.n}getCalc(){let{n:t,layers:e,layerFill:i}=this.config,n=t-t%e;return{n:n,stringsPerLayer:i?Math.floor(n*i):n,layerShift:Math.floor(n/e)}}setUpDraw(){super.setUpDraw();let{layers:t,rotation:e,distortion:i,margin:n,layerFill:s,base:r,reverse:a}=this.config;this.calc=this.getCalc();let o={size:this.size,n:this.n,margin:n,rotation:e,distortion:i,reverse:a};this.circle?this.circle.setConfig(o):this.circle=new y(o),this.color=new l({...this.config,colorCount:t})}*drawTimesTable(t,e){let{reverse:i,base:n}=this.config,{n:s,layerShift:r,stringsPerLayer:a}=this.calc,l=r*e*(i?1:-1),o=this.color.getColor(e);t.setColor(o);let c=this.circle.getPoint(l);for(let e=1;e<=a;e++){let i=c;c=this.circle.getPoint(e+l);let r=e*n%s;t.renderLines(i,c,this.circle.getPoint(r+l)),yield}}*drawStrings(t){let{layers:e}=this.config;for(let i=0;i<e;i++)yield*this.drawTimesTable(t,i)}drawNails(){this.circle.drawNails(this.nails)}getStepCount(){let{layers:t,layerFill:e}=this.config,{n:i}=this.getCalc();return(t??1)*(e?Math.floor(i*e):i)}static thumbnailConfig={n:70}}function v(t){return`${Math.round(100*t)}%`}class x extends w{static type="wave";id="wave";name="Wave";link="https://www.etsy.com/il-en/listing/943140543/personalized-gift-string-art-mandala?ref=sim_rv-5&pro=1";controls=[{...y.nailsConfig,defaultValue:200},{key:"layerFill",label:"Layer fill",defaultValue:.5,type:"range",attr:{min:({n:t})=>1/t,max:1,step:({n:t})=>1/t},displayValue:({layerFill:t})=>v(t),affectsNails:!1},n(y.rotationConfig,"snap"),y.distortionConfig,{key:"layers",label:"Layers",defaultValue:11,type:"range",attr:{min:1,max:20,step:1}},{key:"layerSpread",label:"Layer spread",defaultValue:.075,type:"range",attr:{min:0,max:1,step:({n:t})=>1/t},displayValue:({layerSpread:t,n:e})=>Math.round(t*e),affectsNails:!1},{key:"reverse",label:"Reverse",defaultValue:!0,type:"checkbox"},l.getConfig({defaults:{isMultiColor:!0,multicolorRange:196,multicolorStart:273,color:"#ffffff",multicolorByLightness:!0,minLightness:10,maxLightness:90},exclude:["colorCount"]})];defaultValues={base:2,rotation:176/360};setUpDraw(){super.setUpDraw();let{n:t,layerSpread:e}=this.config;this.calc.layerShift=Math.round(t*e)}*drawStrings(t){let{layers:e}=this.config;for(let i=0;i<e;i++)yield*this.drawTimesTable(t,i)}static thumbnailConfig={n:70}}const k=["left","bottom","right","top"],M=["left","bottom","right","top"],N={left:0,bottom:Math.PI/2,right:Math.PI,top:1.5*Math.PI};class L extends g{static type="eye";name="Eye";id="eye";link="https://www.etsy.com/listing/489853161/rose-of-space-string-art-sacred-geometry?ga_order=most_relevant&ga_search_type=all&ga_view_type=gallery&ga_search_query=string+art&ref=sr_gallery_1&epik=dj0yJnU9WXNpM1BDTnNkLVBtcWdCa3AxN1J5QUZRY1FlbkJ5Z18mcD0wJm49ZXdJb2JXZmVpNVVwN1NKQ3lXMy10ZyZ0PUFBQUFBR0ZuUzZv";controls=[{key:"n",label:"Number of nails per side",defaultValue:82,type:"range",attr:{min:2,max:200,step:1}},{key:"layers",label:"Layers",defaultValue:13,type:"range",attr:{min:1,max:20,step:1}},{key:"angle",label:"Layer angle",defaultValue:30,displayValue:({angle:t})=>`${t}\xb0`,type:"range",attr:{min:0,max:45,step:1}},l.getConfig({defaults:{isMultiColor:!0,color:"#ffffff",multicolorRange:107,multicolorStart:226,multicolorByLightness:!1,minLightness:40,maxLightness:50,colorCount:2},customControls:[{key:"colorPerLayer",label:"Color per layer",defaultValue:!1,type:"checkbox",show:({isMultiColor:t})=>t,affectsNails:!1}],exclude:["colorCount","repeatColors"]})];defaultValues={nailsColor:"#000000"};#h;color;getCalc({size:t}){let{n:e,angle:i,layers:n,margin:s}=this.config,r=Math.min(...t)-2*s,a=r/(e-1),l=i*Math.PI/180,o=t=>{let e=r/Math.pow(Math.cos(l)+Math.sin(l),t),i=[this.center[0]-e/2,this.center[1]-e/2],n=Math.floor(e/a);return{layerAngle:l*t,layerSize:e,layerStart:i,layerStringCount:n}};return{maxSize:r,nailSpacing:a,layerAngle:l,layers:Array(n).fill(null).map((t,e)=>o(e))}}setUpDraw(t){super.setUpDraw(t),this.color=new l({...this.config,repeatColors:!0,colorCount:2}),this.#h=this.getCalc(t)}getPoint({index:t,angle:e,layerStart:i,rotation:n}){let s=e+n,r=[i[0],i[1]+this.#h.nailSpacing*t],a=this.center,l=Math.cos(s),o=Math.sin(s);return[l*(r[0]-a[0])-o*(r[1]-a[1])+a[0],o*(r[0]-a[0])+l*(r[1]-a[1])+a[1]]}*drawSide(t,{side:e,color:i="#ffffff",angle:n,size:s,layerStart:r,layerStringCount:a}){let l=k.indexOf(e),o=k[l===k.length-1?0:l+1],c=N[e],u=N[o],h={layerStringCount:a,size:s,layerStart:r,angle:n};t.setColor(i);for(let e=0;e<=a;e++)t.renderLines(this.getPoint({index:e,rotation:c,...h}),this.getPoint({index:e,rotation:u,...h})),yield}*drawLayer(t,e){let{colorPerLayer:i}=this.config,{layerAngle:n,layerSize:s,layerStart:r,layerStringCount:a}=this.#h.layers[e];for(let l=0;l<k.length;l++)yield*this.drawSide(t,{color:this.color.getColor(i?e:l),side:M[l],angle:n,size:s,layerStart:r,layerStringCount:a})}*drawStrings(t){let{layers:e}=this.config;for(let i=e-1;i>=0;i--)yield*this.drawLayer(t,i)}getStepCount({size:t}){let e=0,{layers:i,angle:n,n:s,margin:r}=this.config,a=n*Math.PI/180,l=Math.min(...t)-2*r,o=l/(s-1);for(let t=0;t<i;t++)e+=4*(Math.floor(l/Math.pow(Math.cos(a)+Math.sin(a),t)/o)+1);return e}drawNails(){let{layers:t}=this.config;for(let e=t-1;e>=0;e--){let{layerAngle:t,layerSize:i,layerStart:n,layerStringCount:s}=this.#h.layers[e];for(let r=0;r<k.length;r++){let a=N[M[r]];for(let l=0;l<=s;l++){let o={layerStringCount:s,size:i,layerStart:n,angle:t};this.nails.addNail({point:this.getPoint({index:l,rotation:a,...o}),number:`${e}_${r}_${l}`})}}}}static thumbnailConfig={n:25,layers:7}}class z{config;center;calc;constructor(t){this.setConfig(t)}static getCalc({radius:t,sides:e,sideNails:i,rotation:n,centerRadius:s=0,maxCurveSize:r=1}){let a=t*s,l=2*Math.PI/e,o=n?-(2*Math.PI)*n/e:0;return{sideAngle:l,nailSpacing:(t-a)/(i-1),centerRadius:a,linesPerRound:e%2?2*e:e,sidesConnectionCount:Math.floor(Math.min(1,r)*i),sideSize:t-a,sides:Array(e).fill(null).map((t,e)=>{let i=e*l+o;return{sinSideAngle:Math.sin(i),cosSideAngle:Math.cos(i)}})}}getPoint(t=0,e=0){let i=this.calc.centerRadius+e*this.calc.nailSpacing,{sinSideAngle:n,cosSideAngle:s}=this.calc.sides[t];return[this.center[0]+n*i,this.center[1]+s*i]}setConfig(t){if(m(t,this.config,["radius","sides","sideNails","rotation","center","size","centerRadius","maxCurveSize"]))return;let e=t.center??t.size.map(t=>t/2);this.config=t,this.center=e,this.calc=z.getCalc(t)}drawNails(t,{getNumber:e,reverseOrder:i,...n}={}){let{sides:s,sideNails:r}=this.config,a=[];for(let t=0;t<s;t++)for(let n=0;n<r;n++){let s=i?r-n:n;a.push({point:this.getPoint(t,s),number:e?e(t,s):s||this.config.centerRadius?`${t}_${s}`:0})}t.addGroup(a,n)}*drawStrings(t,{size:e}={}){let{sideNails:i,sides:n}=this.config,{sidesConnectionCount:s,linesPerRound:r}=this.calc,a=e?Math.max(1,Math.min(Math.floor(e),i)):i,l=Math.max(0,a-s),o=!1,c=n%2?Math.ceil(Math.min(a,s)/2):a-l,u=l,h=this.getPoint(0,u);for(let e=0;e<c;e++){let i=e===c-1,s=0;for(let c=0;c<r;c++){s=(s+1)%n,u=(o=!o)?a-e-1:e+l;let r=this.getPoint(s,u);if(t.renderLines(h,r),h=r,yield,i&&c===n-1&&n%2&&a%2)break}if(!i){u=o?u-1:u+1;let e=this.getPoint(0,u);t.renderLines(h,e),h=e}}}getStepCount(t){return z.getStepCount(this.config,{size:t})}static getStepCount({sides:t,sideNails:e,maxCurveSize:i=1},{size:n}={}){let s=Math.floor(Math.min(1,i)*e),r=n?Math.min(Math.floor(n),e):e,a=Math.max(0,r-s);return(t%2?Math.ceil(Math.min(r,s)/2):r-a)*(t%2?2*t:t)-(t%2&&r%2?t:0)}static nailsConfig=Object.freeze({key:"sideNails",label:"Nails per side",defaultValue:40,type:"range",attr:{min:1,max:200,step:1},isStructural:!0});static sidesConfig=Object.freeze({key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:40,step:1},isStructural:!0});static maxCurveSize={key:"maxCurveSize",label:"Max curve size",description:"The maximum number of connections used to create a curve between two sides.",defaultValue:1,type:"range",displayValue:({maxCurveSize:t,sideNails:e})=>Math.floor(t*e),attr:{min:0,max:1,step:({sideNails:t})=>1/t},isStructural:!0};static centerRadiusConfig={key:"centerRadius",label:"Center radius",defaultValue:0,type:"range",attr:{min:0,max:({sideNails:t})=>(t-1)/t,step:.01},displayValue:({centerRadius:t})=>v(t),isStructural:!0};static rotationConfig={key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01,snap:"0.5"},displayValue:({rotation:t,sides:e})=>`${Math.round(360*t/e)}\xb0`,isStructural:!0,affectsStepCount:!1};static StarConfig=[z.nailsConfig,z.sidesConfig,z.centerRadiusConfig,z.maxCurveSize,z.rotationConfig]}class P extends g{static type="star";name="Star";id="star";link="https://www.etsy.com/listing/557818258/string-art-meditation-geometric-yoga?epik=dj0yJnU9Mm1hYmZKdks1eTc3bVY2TkVhS2p2Qlg0N2dyVWJxaTEmcD0wJm49MGlWSXE1SVJ2Vm0xZ0xtaGhITDBWQSZ0PUFBQUFBR0Zwd2lj";controls=[{key:"sides",label:"Sides",defaultValue:3,type:"range",attr:{min:3,max:20,step:1}},{key:"sideNails",label:"Nails per side",defaultValue:40,type:"range",attr:{min:1,max:200,step:1}},z.centerRadiusConfig,{key:"ringSize",label:"Outer ring size",defaultValue:.1,type:"range",attr:{min:0,max:.5,step:({sideNails:t,sides:e})=>1/(t*e)},displayValue:({sideNails:t,sides:e,ringSize:i})=>Math.floor(i*t*e),affectsNails:!1},n(y.rotationConfig,"snap"),y.distortionConfig,{key:"colorGroup",label:"Color",type:"group",children:[{key:"innerColor",label:"Star color",defaultValue:"#2ec0ff",type:"color",affectsNails:!1,affectsStepCount:!1},{key:"outerColor",label:"Outter color",defaultValue:"#2a82c6",type:"color",affectsNails:!1,affectsStepCount:!1},{key:"ringColor",label:"Ring color",defaultValue:"#2ec0ff",type:"color",affectsNails:!1,affectsStepCount:!1}]}];#d=null;#o;setUpDraw(){super.setUpDraw();let{sides:t,rotation:e,distortion:i,sideNails:n,margin:s=0}=this.config,r={size:this.size,n:n*t,margin:s,rotation:e?e/t:0,distortion:i};this.#o?this.#o.setConfig(r):this.#o=new y(r);let a={...this.config,radius:this.#o.radius,size:this.size};this.#d?this.#d.setConfig(a):this.#d=new z(a)}getArcPoint({side:t,sideIndex:e}){return this.#o.getPoint(t*this.config.sideNails+e)}*drawStar(t){let{innerColor:e}=this.config;t.setColor(e),yield*this.#d.drawStrings(t)}*drawCircle(t){let{outerColor:e,sides:i,sideNails:n}=this.config;t.setColor(e);let s=this.#d.getPoint(0,0),r=!1,a=!1,l=i%2?Math.ceil(n/2):n,o=0,c=i%2?4*i:2*i;for(let e=0;e<=l;e++){let u=c-(e===l?2*i:0);for(let l=0;l<u;l++){let l={side:o,sideIndex:r?n-e-1:e},c=a?this.#d.getPoint(l.side,l.sideIndex):this.getArcPoint(l);t.renderLines(s,c),s=c,yield,(a=!a)&&(o=o!==i-1?o+1:0,r=!r)}s=this.#d.getPoint(0,e+1)}}*drawStrings(t){yield*this.drawCircle(t);let{ringSize:e,ringColor:i}=this.config;0!==e&&(yield*this.#o.drawRing(t,{ringSize:e,color:i})),yield*this.drawStar(t)}drawNails(){this.#o.drawNails(this.nails),this.#d.drawNails(this.nails),this.#o.drawNails(this.nails)}#g(){let{sides:t,sideNails:e}=this.config;return((t%2?Math.ceil(e/2):e)+1)*(t%2?4*t:2*t)-2*t}getStepCount(){let{sides:t,sideNails:e,ringSize:i}=this.config;return this.#g()+(i?e*t:0)+z.getStepCount(this.config)}static thumbnailConfig={sideNails:18}}const E=[{size:.25,end:1,color:"#a94fb0"},{size:.125,end:.888,color:"#ec6ad0"},{size:0,end:.826,color:"#f08ad5",reverse:!0}];class R extends g{static type="assymetry";name="Assymetry";id="assymetry";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[y.nailsConfig,y.rotationConfig,y.distortionConfig,{key:"layers",label:"Layers",type:"group",children:E.map(({size:t,end:e,color:i,reverse:n},s)=>{let r=s+1;return{key:`layer${r}`,label:`Layer ${r}`,type:"group",children:[{key:`show${r}`,label:"Enable",defaultValue:!0,type:"checkbox"},{key:`size${r}`,label:"Size",defaultValue:t,type:"range",attr:{min:0,max:.5,step:({n:t})=>1/t},displayValue:t=>Math.round(t.n*t[`size${r}`]),show:t=>t[`show${r}`]},{key:`end${r}`,label:"End Position",defaultValue:e,type:"range",attr:{min:0,max:1,step:({n:t})=>1/t},displayValue:t=>Math.round(t.n*t[`end${r}`]),show:t=>t[`show${r}`],affectsNails:!1},{key:`color${r}`,label:"Color",defaultValue:i,type:"color",show:t=>t[`show${r}`],affectsNails:!1},{key:`reverse${r}`,label:"Reverse",defaultValue:!0===n,type:"checkbox",show:t=>t[`show${r}`],affectsNails:!1}]}})}];#h;setUpDraw(t){super.setUpDraw(),this.#h=this.#p(t)}#p({size:t}){let e,{rotation:i,n:n,margin:s=0,distortion:r}=this.config,a={size:t,n:n,margin:s,rotation:i-.25,distortion:r};this.#h?.circle?(e=this.#h.circle,this.#h.circle.setConfig(a)):e=new y(a);let l=e.indexAngle*e.radius,o=Math.floor(e.radius/l)-1;l+=(e.radius-l*o)/o;let c=e.getPoint(0),u=o+n;return{circle:e,lineSpacing:l,lineNailCount:o,firstCirclePoint:c,layers:[,,,].fill(null).map((t,e)=>h.call(this,e+1)).filter(({enable:t})=>t),totalNailCount:u,totalIndexCount:u+o};function h(t){let e=Math.round(n*this.config["size"+t])+o;return{size:e,endIndex:Math.round(this.config["end"+t]*(u+o))-e,color:this.config["color"+t],enable:this.config["show"+t],isReverse:this.config["reverse"+t]}}}getPoint(t){if(t<this.#h.lineNailCount||t>this.#h.totalNailCount){let e=(t<this.#h.lineNailCount?this.#h.lineNailCount-t:t-this.#h.totalNailCount)*this.#h.lineSpacing;return[this.#h.firstCirclePoint[0]-e*Math.sin(this.#h.circle.rotationAngle),this.#h.firstCirclePoint[1]-e*Math.cos(this.#h.circle.rotationAngle)]}{let e=t-this.#h.lineNailCount;return this.#h.circle.getPoint(e)}}*drawCircle(t,{endIndex:e,color:i,isReverse:n,size:s}){let r,a,l=!1;t.setColor(i);let o=this,c=n?-1:1;for(let i=0;i<=e;i++){let e=r??this.getPoint(u(i)),n=[];r&&n.push(this.getPoint(a+c)),a=u(l?i:i+s),n.push(r=this.getPoint(a)),t.renderLines(e,...n),yield,l=!l}function u(t){return n?o.#h.totalIndexCount-t:t}}*drawStrings(t){for(let e of this.#h.layers)yield*this.drawCircle(t,e)}drawNails(){this.#h.circle.drawNails(this.nails,{nailsNumberStart:this.#h.lineNailCount});for(let t=0;t<this.#h.lineNailCount;t++)this.nails.addNail({point:this.getPoint(t),number:t})}getStepCount(t){let{layers:e}=this.#p(t);return e.reduce((t,e)=>t+e.endIndex+1,0)}static thumbnailConfig={n:50}}const V={label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1+1/360,step:1/360},isStructural:!0,affectsStepCount:!1};class A extends g{static type="freestyle";name="Freestyle";id="freestyle";link="https://www.etsy.com/il-en/listing/1018950430/calming-wall-art-in-light-blue-for";controls=[{key:"n",label:"Circle nails",defaultValue:80,type:"range",attr:{min:1,max:300,step:1}},{key:"minNailDistance",label:"Min nail distance",defaultValue:20,type:"range",attr:{min:1,max:300,step:1}},{key:"color",label:"Color",defaultValue:"#ec6ad0",type:"color",affectsNails:!1,affectsStepCount:!1},{key:"layers",label:"Layers",type:"group",children:[{key:"layer1",label:"Layer 1",type:"group",children:[{key:"show1",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius1",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show1:t})=>t},{key:"x1",label:"Position X",defaultValue:.5,type:"range",attr:{min:0,max:1,step:.01},show:({show1:t})=>t},{key:"y1",label:"Position Y",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01},show:({show1:t})=>t},{...V,key:"rotation1",show:({show1:t})=>t,displayValue:({rotation1:t})=>`${Math.round(360*t)}\xb0`},{key:"reverse1",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show1:t})=>t}]},{key:"layer2",label:"Layer 2",type:"group",children:[{key:"show2",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius2",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show2:t})=>t},{key:"x2",label:"Position X",defaultValue:0,type:"range",attr:{min:0,max:1,step:.01},show:({show2:t})=>t},{key:"y2",label:"Position Y",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show2:t})=>t},{...V,key:"rotation2",show:({show2:t})=>t,displayValue:({rotation2:t})=>`${Math.round(360*t)}\xb0`},{key:"reverse2",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show2:t})=>t}]},{key:"layer3",label:"Layer 3",type:"group",children:[{key:"show3",label:"Enable",defaultValue:!0,type:"checkbox"},{key:"radius3",label:"Radius",defaultValue:.5,type:"range",attr:{min:.01,max:1,step:.01},show:({show3:t})=>t},{key:"x3",label:"Position X",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show3:t})=>t,affectsStepCount:!1},{key:"y3",label:"Position Y",defaultValue:1,type:"range",attr:{min:0,max:1,step:.01},show:({show3:t})=>t,affectsStepCount:!1},{...V,key:"rotation3",show:({show3:t})=>t,displayValue:({rotation3:t})=>`${Math.round(360*t)}\xb0`,affectsStepCount:!1},{key:"reverse3",label:"Reverse",defaultValue:!1,type:"checkbox",show:({show3:t})=>t,affectsNails:!1,affectsStepCount:!1}]}]}];#h;setUpDraw(t){super.setUpDraw(),this.#h=this.getCalc(t)}getCalc({size:t}){let{n:e,margin:i=0,minNailDistance:n}=this.config,s=Math.min(...t.map(t=>t-2*i))/2,r=[,,,].fill(null).map((t,e)=>l.call(this,e+1)).filter(({enable:t})=>t),a=Math.max(...r.map(({circle:t})=>t.config.n));return{layers:r,maxShapeNailsCount:a};function l(r){let a=t=>this.config[t+r],l={enable:a("show"),isReverse:a("reverse"),position:[a("x"),a("y")],radius:s*a("radius"),rotation:a("rotation")},o=Math.min(e,Math.floor(2*Math.PI*l.radius/n));return{circle:new y({radius:l.radius,size:this.size,center:l.position.map((e,n)=>l.radius+i+(t[n]-(l.radius+i)*2)*e),n:o,rotation:l.rotation,reverse:l.isReverse}),...l}}}getPoint(t,e){let{circle:i}=t,n=Math.round(e*i.config.n/this.#h.maxShapeNailsCount);return i.getPoint(n)}*drawStrings(t){let e,{color:i}=this.config;t.setColor(i);for(let i=0;i<this.#h.maxShapeNailsCount;i++)for(let n=0;n<this.#h.layers.length;n++){let s=this.#h.layers[n],r=e??this.getPoint(s,i),a=[];0===n&&i&&a.push(this.getPoint(s,i));let l=n+1;l===this.#h.layers.length&&(l=0),e=this.getPoint(this.#h.layers[l],i),t.renderLines(r,e),yield}}drawNails(){this.#h.layers.forEach(({circle:t},e)=>t.drawNails(this.nails,{getNumber:t=>`${e+1}_${t+1}`}))}getStepCount(t){let{layers:e,maxShapeNailsCount:i}=this.getCalc(t);return e.length*i-1}static thumbnailConfig={minNailDistance:3,n:40}}class T{config;#f;#h;constructor(t){this.setConfig(t)}setConfig(t){if(!m(t,this.config)&&(this.config=t,this.#f?this.#f.clear():this.#f=new Map,this.#h=this.#p(),t.fitSize)){let t=this.#m();this.#f.clear(),this.#h={...this.#p(),...t}}}#m(){let{size:t,margin:e}=this.config,i=this.getBoundingRect(),n=Math.min((t[0]-2*e)/i.width,(t[1]-2*e)/i.height);return{size:t.map(t=>t*n),center:[this.#h.center[0]-n*(i.left-t[0]+i.right)/2,this.#h.center[1]-n*(i.top-t[1]+i.bottom)/2]}}#p(){let{size:t,rotation:e=0,sides:i,center:n,margin:s,nailsSpacing:r}=this.config,a=f/i,l=Array(i).fill(null).map((t,i)=>{let n=a*i+f*e,s=-a*(i-.5)-f*e;return{cos:Math.cos(n),sin:Math.sin(n),center:{cos:Math.cos(s),sin:Math.sin(s)}}}),o=n??this.config.size.map(t=>t/2),c=Math.min(...t)/2-s,u=2*c*Math.sin(a/2),h=[c*Math.sin(a/2),c*Math.cos(a/2)],d=u*r,g=Math.floor(c/d);return{nailsPerSide:1/r,center:o,radius:c,sideSize:u,start:h,nailsDistance:d,radiusNailsCount:g,radiusNailsDistance:c/g,sides:l,sideAngle:a}}get nailsPerSide(){return this.#h.nailsPerSide}get radiusNailsCount(){return this.#h.radiusNailsCount}get sideSize(){return this.#h.sideSize}getSidePoint({side:t,index:e}){let i=[t,e].join("_");if(this.#f.has(i))return this.#f.get(i);let n=this.#h.start[0]-e*this.#h.nailsDistance,{cos:s,sin:r}=this.#h.sides[t],a=[s*n-r*this.#h.start[1]+this.#h.center[0],r*n+s*this.#h.start[1]+this.#h.center[1]];return this.#f.set(i,a),a}getCenterPoint({side:t,index:e}){let i=e*this.#h.radiusNailsDistance,{sin:n,cos:s}=this.#h.sides[t].center;return[this.#h.center[0]+n*i,this.#h.center[1]+s*i]}getBoundingRect(){let t=this.#h.sides.map((t,e)=>this.getSidePoint({side:e,index:0})),e=t[0],i=t.slice(1).reduce((t,[e,i])=>({left:Math.min(t.left,e),right:Math.max(t.right,e),top:Math.min(t.top,i),bottom:Math.max(t.bottom,i)}),{left:e[0],right:e[0],top:e[1],bottom:e[1]});return{...i,height:i.bottom-i.top,width:i.right-i.left}}drawNails(t,{drawCenter:e=!1,drawSides:i=!0,filterCenterNails:n}={}){for(let s=0;s<this.config.sides;s++){let r=s*this.#h.nailsPerSide;if(i)for(let e=0;e<this.#h.nailsPerSide;e++)t.addNail({point:this.getSidePoint({side:s,index:e}),number:r+e});if(e)for(let e=0;e<this.#h.radiusNailsCount;e++)(!n||n(s,e))&&t.addNail({point:this.getCenterPoint({side:s,index:e}),number:`${s}_${e}`})}}static rotationConfig={key:"rotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:1,step:.02},displayValue:({rotation:t,sides:e})=>`${Math.round(180*t/e)}\xb0`,isStructural:!0,affectsStepCount:!1}}const I=l.getConfig({defaults:{isMultiColor:!0,color:"#ff0000",multicolorRange:1,multicolorStart:0,multicolorByLightness:!0,minLightness:20,maxLightness:50},exclude:["colorCount"]});class D extends g{static type="polygon";name="Polygon";id="polygon";controls=[{key:"sides",label:"Sides",defaultValue:5,type:"range",attr:{min:3,max:10,step:1}},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:1,max:100,step:1}},{key:"bezier",label:"Bezier",defaultValue:2,type:"range",attr:{min:1,max:4,step:1},show:({sides:t})=>t>4,affectsNails:!1,affectsStepCount:!1},T.rotationConfig,I];defaultValues={nailsColor:"#5c5c5c",nailRadius:1};#y;color;colorMap;setUpDraw(){super.setUpDraw();let{n:t,rotation:e,sides:i,margin:n,isMultiColor:s}=this.config,r={sides:i,rotation:e/(2*i),margin:n,size:this.getSize(),nailsSpacing:1/t,fitSize:!0};this.#y?this.#y.setConfig(r):this.#y=new T(r),this.color=new l({...this.config,isMultiColor:s,colorCount:i}),s?this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:i}):this.colorMap=null}*drawStrings(t){let{sides:e,bezier:i}=this.config,n=Math.min(i,Math.ceil(e/2)-1),s=0;t.setColor(this.color.getColor(0));for(let i=0;i<e;i++){let r=(i+n)%e;this.colorMap&&t.setColor(this.colorMap.get(s));for(let e=0;e<this.#y.nailsPerSide;e++)t.renderLines(this.#y.getSidePoint({side:i,index:e}),this.#y.getSidePoint({side:r,index:e})),yield,s++}}getStepCount(){let{sides:t,n:e}=this.config;return t*e}drawNails(){this.#y.drawNails(this.nails)}static thumbnailConfig={n:20}}const _=l.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:132,multicolorStart:53,multicolorByLightness:!1,minLightness:30,maxLightness:70},exclude:["colorCount"]});class $ extends g{static type="flower";name="Flower";id="flower";link="https://www.sqrt.ch/Buch/fadenmodell4_100.svg";controls=[{key:"sides",label:"Sides",defaultValue:4,type:"range",attr:{min:3,max:10,step:1}},{key:"n",label:"Nails per side",defaultValue:60,type:"range",attr:{min:1,max:100,step:1}},{key:"layers",label:"Layers",defaultValue:2,type:"range",attr:{min:1,max:10,step:1}},T.rotationConfig,_];defaultValues={nailsColor:"#29f1ff",nailRadius:1,stringWidth:.5};#b;color;colorMap;setUpDraw(){super.setUpDraw();let{n:t,rotation:e,sides:i,layers:n,margin:s,isMultiColor:r}=this.config,a=this.getSize(),o=1/(i*n);this.#b=Array(n).fill(null).map((n,r)=>new T({sides:i,rotation:e/i+r*o,margin:s,size:a,nailsSpacing:1/t})),this.color=new l({...this.config,isMultiColor:r,colorCount:n}),r?this.colorMap=this.color.getColorMap({stepCount:this.getStepCount(),colorCount:n}):this.colorMap=null}*drawStrings(t){let{sides:e,layers:i}=this.config,n=0;t.setColor(this.color.getColor(0));for(let s=0;s<i;s++){let i=this.#b[s];for(let s=0;s<e;s++){let r=s===e-1?0:s+1;for(let e=0;e<=i.nailsPerSide;e++){this.colorMap?.has(n)&&t.setColor(this.colorMap.get(n));let a=this.getCenterIndexes({polygon:i,sideIndex:e});t.renderLines(i.getCenterPoint({side:s,index:a[0]}),i.getSidePoint({side:s,index:e}),i.getCenterPoint({side:r,index:a[1]})),yield,n++}}}}getCenterIndexes({polygon:t,sideIndex:e}){let i=t.nailsPerSide-t.radiusNailsCount;return[e<i?-i+e:e-i,t.radiusNailsCount-e]}getStepCount(){let{sides:t,n:e,layers:i}=this.config;return t*(e+1)*i}drawNails(){let t=this.#b[0].radiusNailsCount-this.#b[0].nailsPerSide,e=t>0?(e,i)=>i>=t:null;this.#b.forEach(t=>t.drawNails(this.nails,{drawCenter:!0,filterCenterNails:e}))}static thumbnailConfig={n:20}}const O=l.getConfig({defaults:{isMultiColor:!0,color:"#ffffff",multicolorRange:102,multicolorStart:239,multicolorByLightness:!1,minLightness:30,maxLightness:70,colorCount:4},exclude:["repeatColors","mirrorColors"]});class B extends g{static type="maurer_rose";name="Maurer Rose";id="maurer_rose";link="https://blog.glitch.land/en/posts/maurer-rose/";linkText="Learn";controls=[{key:"n",label:"N",defaultValue:4,type:"range",attr:{min:1,max:12,step:1},isStructural:!0},{key:"maxSteps",label:"Max steps",defaultValue:512,type:"range",attr:{min:3,max:720,step:1},isStructural:!0},{key:"angle",label:"Angle",defaultValue:341,type:"range",attr:{min:1,max:720,step:1},displayValue:({angle:t})=>`${t}\xb0`,isStructural:!0},y.rotationConfig,O];calc;points;color;colorMap;resetStructure(){super.resetStructure(),this.points&&this.points.clear(),this.calc=null}setUpDraw(){super.setUpDraw();let{isMultiColor:t,colorCount:e}=this.config;this.calc||(this.calc=this.getCalc()),this.points||(this.points=new Map),this.stepCount||(this.stepCount=this.getStepCount()),this.color=new l({...this.config,isMultiColor:t,colorCount:e}),t?this.colorMap=this.color.getColorMap({stepCount:this.stepCount,colorCount:e}):this.colorMap=null}getCalc(){let{angle:t,rotation:e,maxSteps:i}=this.config,n=this.getSize();return{angleRadians:f*t/i,radius:Math.min(...n)/2,currentSize:n,rotationAngle:-(2*Math.PI)*e}}getPoint(t){let{rotationAngle:e,angleRadians:i,radius:n}=this.calc;if(this.points.has(t))return this.points.get(t);let s=t*i,r=n*Math.sin(this.config.n*s),a=[this.center[0]-r*Math.cos(s-e),this.center[1]-r*Math.sin(s-e)];return this.points.set(t,a),a}*generatePoints(){let t=this.stepCount;for(let e=0;e<t+1;e++)yield{point:this.getPoint(e),index:e}}*drawStrings(t){let e,i=this.generatePoints();for(let{point:n,index:s}of(t.setColor(this.color.getColor(0)),i)){if(!e){e=n;continue}if(this.colorMap){let e=this.colorMap.get(s);e&&t.setColor(e)}t.renderLines(e,n),e=n,yield}}getStepCount(){if(this.stepCount)return this.stepCount;let{maxSteps:t,angle:e,n:i}=this.config,n=function t(e,i){return i?t(i,e%i):e}(t,e),s=t/n;return!(s%2)&&i%2&&(s/=2),Math.round(s)}drawNails(){for(let{point:t,index:e}of this.generatePoints())this.nails.addNail({point:t,number:e})}static thumbnailConfig={}}const F=l.getConfig({defaults:{isMultiColor:!0,color:"#29f1ff",multicolorRange:30,multicolorStart:25,multicolorByLightness:!0,minLightness:40,maxLightness:95,colorCount:3,repeatColors:!0,saturation:83,reverseColors:!0},customControls:[{key:"colorPerLevel",label:"Color per level",defaultValue:!0,type:"checkbox",affectsNails:!1}]}),q=-f/6,G=Array(6).fill(null).map((t,e)=>Math.PI/2+q*e),U={evenly:{f:(t,{ringSize:e,layers:i,n:n})=>Math.floor((i-t)*Math.floor(n*e)/i),name:"Evenly"},distance:{f:(t,{n:e,ringSize:i,layerDistance:n})=>{let s=Math.floor(e*i);return t>0?s-t*n:s},name:"Specific distance"}},H=l.getConfig({defaults:{isMultiColor:!0,color:"#ff0000",multicolorRange:133,multicolorStart:239,multicolorByLightness:!1,minLightness:30,maxLightness:70,colorCount:4},customControls:[{key:"colorPerLayer",label:"Color per layer",defaultValue:!0,type:"checkbox",affectsNails:!1}]});class j extends g{static type="comet";name="Comet";id="comet";controls=[y.nailsConfig,{key:"layers",label:"Layers",defaultValue:5,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},{key:"ringSize",label:"First layer size",description:"Nail count from the top center nail to the first connected nail in the first layer",defaultValue:.3,type:"range",attr:{min:0,max:1,step:.01},displayValue:({ringSize:t,n:e})=>Math.floor(e*t),isStructural:!0,affectsNails:!1},{key:"layerSpread",label:"Layer Spread",type:"select",defaultValue:"distance",options:Object.entries(U).map(([t,{name:e}])=>({value:t,label:e})),isStructural:!0,affectsNails:!1},{key:"layerDistance",label:"Layer Distance",type:"range",attr:{min:1,max:({n:t,layers:e})=>Math.floor(t/2/e),step:1},defaultValue:1,isStructural:!0,show:({layerSpread:t})=>"evenly"!==t,affectsNails:!1},y.rotationConfig,y.distortionConfig,y.displacementConfig,H];defaultValues={n:51,layers:11,colorPerLayer:!0,multicolorRange:203,multicolorStart:137,ringSize:.47,rotation:.25,distortion:.38,displacementFunc:"fastInOut",displacementMag:1.8,displacementFastArea:.43,layerSpread:"distance",layerDistance:1};#o;color;setUpDraw(t){super.setUpDraw(t);let e={size:t.size,n:this.config.n,margin:this.config.margin,rotation:this.config.rotation,distortion:this.config.distortion,displacementFunc:this.config.displacementFunc,displacementMag:this.config.displacementMag,displacementFastArea:this.config.displacementFastArea};this.#o?this.#o.setConfig(e):this.#o=new y(e),this.stepCount||(this.stepCount=this.getStepCount());let{isMultiColor:i,colorCount:n,layers:s,colorPerLayer:r}=this.config,a=i?r?s:Math.min(n,s):1;this.color=new l({...this.config,isMultiColor:i,colorCount:a})}getLayerRingDistance(t){let e=U[this.config.layerSpread];if(!e)throw Error(`Invalid spread mode, "${this.config.layerSpread}"!`);return e.f(t,this.config)}getLayerRingStepCount(t){let e=this.getLayerRingDistance(t);return(this.config.n-e+1)*2-1}*drawLayer(t,e=0){let{n:i}=this.config,n=this.getLayerRingDistance(e),s=i-n+1,r=this.#o.getPoint(0),a=0;t.setColor(this.color.getColor(e));for(let e=0;e<i-n+1;e++){let i=e+n,l=this.#o.getPoint(i);t.renderLines(r,l),yield,e!==s-1&&(a=e+1,r=this.#o.getPoint(a),t.renderLines(l,r),yield)}}*drawStrings(t){for(let e=0;e<this.config.layers;e++)yield*this.drawLayer(t,e)}getStepCount(){if(this.stepCount)return this.stepCount;let{layers:t}=this.config;return Array(t).fill(0).reduce((t,e,i)=>t+this.getLayerRingStepCount(i),0)}drawNails(){this.#o.drawNails(this.nails)}static thumbnailConfig={n:24,layers:8}}class W extends g{static type="sun";name="Sun";id="sun";controls=[{key:"starGroup",label:"Star",type:"group",children:[...r([...z.StarConfig,l.getConfig({defaults:{isMultiColor:!0,multicolorRange:1,multicolorStart:237,color:"#ffffff",saturation:40,multicolorByLightness:!0,minLightness:20,maxLightness:97},exclude:["colorCount"]})],"sides",[{key:"layers",label:"Layers",defaultValue:4,type:"range",attr:{min:1,max:20,step:1},isStructural:!0},{key:"layerSpread",label:"Layer spread",defaultValue:.1625,type:"range",displayValue:({layerSpread:t})=>v(t),attr:{min:.01,max:1,step:.02},show:({layers:t})=>1!==t,isStructural:!0},{key:"starRadius",label:"Star Radius",defaultValue:1,type:"range",displayValue:({starRadius:t})=>v(t),attr:{min:.2,max:1,step:.01},isStructural:!0,affectsStepCount:!1}])]},{key:"backdrop",label:"Backdrop",type:"group",children:[{key:"backdropSize",label:"Backdrop size",defaultValue:.5,type:"range",displayValue:({backdropSize:t})=>v(t),attr:{min:0,max:1,step:({sideNails:t})=>1/t},isStructural:!0},{key:"backdropRadius",label:"Backdrop radius",defaultValue:1,type:"range",displayValue:({backdropRadius:t})=>v(t),attr:{min:0,max:1,step:.01},isStructural:!0,affectsStepCount:!1},{key:"backdropShift",label:"Backdrop shift",defaultValue:0,type:"range",displayValue:({backdropShift:t})=>v(t),attr:{min:0,max:1,step:({sideNails:t,backdropSize:e})=>(1/(t*(1-e))).toFixed(3)},isStructural:!0,affectsStepCount:!1,affectsNails:!1},{key:"backdropSkip",label:"Backdrop skip",description:"If yes, connections in the backdrop are from the backdrop's nail to the second-nearest side, not the ones near it",defaultValue:!1,type:"checkbox",isStructural:!0,affectsStepCount:!1,show:({sides:t})=>t>3},l.getConfig({defaults:{isMultiColor:!0,multicolorRange:20,multicolorStart:0,color:"#ffffff",saturation:57,multicolorByLightness:!0,minLightness:20,maxLightness:40},propMapper:({key:t,show:e})=>{t[0].toUpperCase(),t.slice(1);let i={key:"backdrop"+t[0].toUpperCase()+t.slice(1),show:e?({backdropIsMultiColor:e})=>"color"===t?!e:e:null};return"multicolorRange"===t&&(i.attr={start:({backdropMulticolorStart:t})=>t,type:"range"}),i},groupLabel:"Backdrop color",maxColorCount:2})]}];getCommonControls(){return r(super.getCommonControls(),"nailsColor",[{key:"backdropNailsColor",label:"Backdrop nails color",type:"color",defaultValue:"#ffffff",show:({showNails:t})=>t,affectsStrings:!1},{key:"backdropNailsRadius",label:"Backdrop nails radius",type:"range",defaultValue:1.5,attr:{min:.5,max:5,step:.25},show:({showNails:t})=>t,affectsStrings:!1}])}#o=null;#d=null;#h;#c;#C;defaultValues={sideNails:50,sides:16,layers:4,layerSpread:.77,backdropSize:.26,backdropRadius:.9,backdropShift:.59,backdropColorCount:2,centerRadius:.2,maxCurveSize:.64,rotation:.5,saturation:73,multicolorStart:206,multicolorRange:1,multicolorByLightness:!0,minLightness:35,maxLightness:100,nailsColor:"#000000",backdropNailsColor:"#ffffff",backdropNailsRadius:2.275};getCalc(){let{sideNails:t,backdropSize:e,layers:i}=this.config;return{backdropNails:Math.floor(t*e)}}resetStructure(){super.resetStructure(),this.#h=null}setUpDraw(){super.setUpDraw();let{margin:t=0,layers:e,backdropRadius:i=1,backdropSize:n,rotation:s,sides:r,starRadius:a=1,backdropColorCount:o}=this.config,c=Math.min(...this.size.map(t=>t/2))-t;this.#h||(this.#h=this.getCalc());let u={...this.config,radius:n&&a<i?c*a/i:c,size:this.size};this.#d?this.#d.setConfig(u):this.#d=new z(u),this.#c=new l({...this.config,colorCount:e}),this.#C=new l({...function(t,e){let i={};return Object.entries(t).forEach(([t,n])=>i[e(t,n)]=n),i}(this.config,t=>{let e=t.match(/^backdrop(\w)(.+)/);return e?e[1].toLowerCase()+e[2]:t}),colorCount:o});let h={size:this.size,n:r,rotation:-1/r/2+(s?s/r:0),radius:i<a?c*i/a:c};this.#o?this.#o.setConfig(h):this.#o=new y(h)}*drawStar(t,e){yield*this.#d.drawStrings(t,{size:e})}*generateLayers(t){let{sideNails:e,layerSpread:i,layers:n}=this.config;for(let e=0;e<n;e++){let i=this.#c.getColor(e);t.setColor(i);let n=this.#S(e);yield*this.drawStar(t,n)}}*drawBackdrop(t){let e,{backdropNails:i}=this.#h,{sides:n,backdropShift:s,sideNails:r,backdropSkip:a}=this.config,l=a&&n>3,o=0,c=Math.floor(s*(r-i))+i-1;for(let s=0;s<n;s++){t.setColor(this.#C.getColor(s%2?0:1));let r=this.#o.getPoint(l?(s+1)%n:s),a=!1,u=s%2?1:-1;e=this.#d.getPoint(s,c);for(let h=0;h<i;h++)if(t.renderLines(e,r),yield,o=(a?s:s+(l?3:1))%n,e=this.#d.getPoint(o,c),t.renderLines(r,e),yield,h<i-1){a=!a,c+=u;let i=this.#d.getPoint(o,c);t.renderLines(e,i),e=i}}}*drawStrings(t){yield*this.drawBackdrop(t),yield*this.generateLayers(t)}drawNails(){let{backdropSize:t,backdropNailsColor:e,backdropNailsRadius:i}=this.config;if(this.#d.drawNails(this.nails),t){let t=[];for(let e of this.#o.generateNails())t.push(e);this.nails.addGroup(t,{color:e,radius:i})}}#S(t){let{layers:e,layerSpread:i,sideNails:n}=this.config;return Math.max(1,n-t*Math.max(1,Math.floor(n/e*i)))}getStepCount(){let{layers:t,sides:e}=this.config,{backdropNails:i}=this.getCalc(),n=e*i*2;for(let e=0;e<t;e++){let t=this.#S(e);n+=z.getStepCount(this.config,{size:t})}return n}static thumbnailConfig={sideNails:10,backdropNailsRadius:.5}}class J extends g{static type="lotus";name="Lotus";id="lotus";controls=[{key:"sides",label:"Sides",description:"How many petals there are in the Lotus",type:"range",defaultValue:16,attr:{min:5,max:64,step:1},isStructural:!0},{key:"density",label:"Density",type:"range",defaultValue:144,attr:{min:1,max:500,step:({sides:t})=>t},isStructural:!0},n(y.rotationConfig,"snap"),{key:"removeSections",label:"Remove sections",type:"range",attr:{min:0,max:1,step:({sides:t,renderCenter:e})=>1/Q(t,e)},defaultValue:0,displayValue:({removeSections:t,sides:e,renderCenter:i})=>Math.round(t*Q(e,i)),isStructural:!0},{key:"renderCenter",label:"Render center",type:"checkbox",defaultValue:!0,isStructural:!0},{key:"centerRadius",label:"Center radius",type:"range",defaultValue:0,attr:{min:0,max:1,step:.01},displayValue:({centerRadius:t})=>v(t),show:({renderCenter:t})=>t,isStructural:!0,affectsStepCount:!1},{key:"renderCenterNails",label:"Render center nails",type:"checkbox",defaultValue:!1,isStructural:!0,show:({renderCenter:t})=>t},l.getConfig({defaults:{isMultiColor:!0,multicolorStart:20,multicolorRange:26,multicolorByLightness:!0,minLightness:32,maxLightness:85,saturation:100,colorCount:8},customControls:[{key:"radialColor",label:"Radial color",defaultValue:!1,type:"checkbox",affectsNails:!1,affectsStepCount:!1}],maxColorCount:32})];defaultValues={nailsColor:"#a08346"};#h;#c;getCalc({size:t}){let{sides:e,density:i,margin:n,rotation:s,removeSections:r,centerRadius:a,renderCenter:l}=this.config,o=.5*Math.min(...t)/2,c=f/e,u={n:m(i),center:[0,0],size:[0,0],radius:0,rotation:0},h=0;if(r){let t=Q(e,l),s=c*(h=Math.min(t,Math.round(r*t))),a=2*o*Math.sin((Math.PI-s)/2),d=(2*o-n)/a;u.n=Math.round(m(i*d)*(1-2*h/e)+1),o*=d,Object.assign(u,{angleStart:s,angleEnd:f-s})}Object.assign(u,{size:[o-n/2,o-n/2],radius:o-n/2});let d=new y({n:e,size:t.map(t=>.5*t-n),center:this.center,radius:o-n/2,rotation:s}),g=Array(e).fill(null).map((t,i)=>new y({...u,center:d.getPoint(i),rotation:s-i/e})),p={circles:g,circleNailsCount:u.n,sideAngle:c,sections:Z(e),removedSections:h,nailsPerSection:Math.floor(u.n/(e-2*h)),nailsPerCircle:u.n};if(l&&a){let t=p.sections-1-p.removedSections,i=g[0].getPoint(t*p.nailsPerSection),n=a*Math.floor(Math.sqrt(Math.abs(d.center[0]-i[0])**2+Math.abs(d.center[1]-i[1])**2));p.centerCircle=new y({n:e,center:d.center,size:[n,n],radius:n,rotation:s+-Math.ceil((e-4)/2)/2/e})}return p;function m(t){return Math.max(e,t-t%e)}}resetStructure(){super.resetStructure(),this.#h=null}setUpDraw(t){super.setUpDraw(t),this.#h||(this.#h=this.getCalc(t));let e=this.config.radialColor?this.#h.sections-this.#h.removedSections-1:this.config.colorCount;!this.config.renderCenter&&this.config.radialColor&&e--,this.#c=new l({...this.config,colorCount:e})}#w(t,e){let{radialColor:i}=this.config,{removedSections:n}=this.#h;return this.#c.getColor(i?e-n:t)}*#v(t,e,i){let{sides:n}=this.config,{circles:s,sections:r,nailsPerSection:a,nailsPerCircle:l,removedSections:o}=this.#h,c=this.#w(e,i),u=s[e];t.setColor(c);let h=this.#h.circles[0===e?n-1:e-1];if(0===i){let e=h.getPoint(2*a);for(let i=l-a;i<l;i++)t.renderLines(u.getPoint(i),e),yield;for(let i=0;i<=a;i++)t.renderLines(u.getPoint(i),e),yield}else{let c=i===r-2&&this.#h.centerCircle?this.#h.centerCircle.getPoint(e):h.getPoint(a*(i+2-o)-(n%2&&i===r-2?a/2:0)),d=s[(e+i)%n],g=l-(i+1-o)*a-!!o;for(let e=0;e<=a;e++)t.renderLines(d.getPoint(g+e),c),yield;let p=(i-o)*a+1;for(let e=p;e<p+a;e++)t.renderLines(u.getPoint(e),c),yield}}*drawStrings(t){for(let{side:e,section:i}of this.#x())yield*this.#v(t,e,i)}*#x(){let{radialColor:t,sides:e,renderCenter:i}=this.config,{sections:n,removedSections:s}=this.#h,r=n-(i?1:2);if(t)for(let t=s;t<r;t++)for(let i=0;i<e;i++)yield{side:i,section:t};else for(let t=0;t<e;t++)for(let e=s;e<r;e++)yield{side:t,section:e}}drawNails(){let{renderCenter:t,renderCenterNails:e}=this.config,{circles:i,centerCircle:n}=this.#h;i.forEach((t,i)=>{t.drawNails(this.nails,{getNumber:t=>`${i+1}_${t}`,excludedNailRanges:e?null:this.#k()})}),t&&(n?n.drawNails(this.nails,{getNumber:t=>`C_${t+1}`}):this.nails.addNail({point:this.center,number:"C"}))}#k(){let{renderCenter:t}=this.config,{sections:e,nailsPerSection:i,nailsPerCircle:n,removedSections:s}=this.#h,r=(e-1-s-!t)*i+1;return[[r,n-r]]}getStepCount(t){let{nailsPerSection:e,sections:i,removedSections:n}=this.getCalc(t),{sides:s}=this.config;return(2*e+1)*(i-n-1)*s}static thumbnailConfig={}}function Z(t){return t%2?Math.ceil(t/2):t/2}function Q(t,e){return Z(t)-(e?2:3)}const X=[P,R,w,C,S,x,L,A,D,$,B,class extends g{static type="flower_of_life";name="Flower of Life";id="flower_of_life";link="https://www.reddit.com/r/psychedelicartwork/comments/mk97gi/rainbow_flower_of_life_uv_reactive_string_art/";controls=[{key:"levels",label:"Levels",defaultValue:3,type:"range",attr:{min:1,max:10,step:1},isStructural:!0},{key:"density",label:"Density",defaultValue:10,type:"range",attr:{min:1,max:50,step:1},isStructural:!0},{key:"globalRotation",label:"Rotation",defaultValue:0,type:"range",attr:{min:0,max:30,step:1},displayValue:({globalRotation:t})=>`${t}\xb0`,isStructural:!0,affectsStepCount:!1},{key:"fillGroup",label:"Fill",type:"group",children:[{key:"fill",label:"Show fill",defaultValue:!0,type:"checkbox",isStructural:!0,affectsNails:!1},{key:"fillColor",label:"Fill color",defaultValue:"#292e29",type:"color",show:({fill:t})=>t,affectsNails:!1}]},{key:"ringGroup",label:"Ring",type:"group",children:[{key:"renderRing",label:"Show outer ring",type:"checkbox",defaultValue:!0,isStructural:!0},{key:"ringNailCount",label:"Ring nail count",defaultValue:144,type:"range",attr:{min:3,max:360,step:1},show:({renderRing:t})=>t,isStructural:!0},{key:"ringSize",label:"Outer ring size",defaultValue:.23,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:t})=>t,displayValue:({ringSize:t})=>v(t),isStructural:!0},{key:"ringPadding",label:"Ring padding",defaultValue:.06,type:"range",attr:{min:0,max:.5,step:.01},show:({renderRing:t})=>t,isStructural:!0,displayValue:({ringPadding:t})=>v(t)},{key:"ringColor",label:"Ring color",defaultValue:"#e8b564",type:"color",show:({renderRing:t})=>t,affectsNails:!1}]},{key:"renderTriangles",label:"Show triangles",defaultValue:!0,type:"checkbox",isStructural:!0,affectsNails:!1},{key:"renderCaps",label:"Show caps",defaultValue:!0,type:"checkbox",show:({renderTriangles:t})=>t,isStructural:!0},F];defaultValues={nailsColor:"#474747"};#h;points;color;colorMap;#o;getCalc({size:t}){let{levels:e,density:i,margin:n,globalRotation:s,renderCaps:r,renderRing:a,ringNailCount:l,ringSize:o,ringPadding:c}=this.config,u=s*Math.PI/180+Math.PI/6,h=a?Math.min(...t.map(t=>t/2-n)):null,d=a?Math.floor(o*l/2):0,g=new T({sides:6,size:t,margin:n+(a?h*(1-Math.cos(d/l*f/2)):0)+(a&&o?c*h:0),rotation:u,fitSize:!1,nailsSpacing:2}).sideSize/e,p=g/(2*Math.cos(Math.PI/6)),m=Array(e+ +!!r).fill(null).map((t,e)=>2*e+1);return{edgeSize:g,triangleHeight:g*Math.sqrt(3)/2,nailsLength:p,triangleCenterDistance:g/2,nailDistance:p/i,triangleCount:6*e**2,countPerLevelSide:m,globalRotationRadians:u,radius:h}}resetStructure(){super.resetStructure(),this.points=null,this.#h=null}setUpDraw(t){super.setUpDraw(t);let{isMultiColor:e,levels:i,colorPerLevel:n,colorCount:s,renderRing:r,ringSize:a,ringNailCount:o,...c}=this.config;if(this.#h||(this.#h=this.getCalc(t)),r&&a){let e={size:t.size,n:o,margin:c.margin,rotation:c.globalRotation};this.#o?this.#o.setConfig(e):this.#o=new y(e)}else this.#o=null;this.points||(this.points=this.getPoints()),this.stepCount||(this.stepCount=this.getStepCount(t));let u=e?n?i:Math.min(s,i):1;this.color=new l({...c,isMultiColor:e,colorCount:u}),e?this.colorMap=this.color.getColorMap({stepCount:u,colorCount:u}):this.colorMap=null}getTrianglePoints({center:t,rotation:e,isCapLevel:i,triangleIndexInSide:n}){let s;i&&(s=this.#M((n+2)%3));let r=[,,,].fill(null).map((e,i)=>i===s?[]:[t]);for(let n=0;n<3;n++){if(i&&n===s)continue;let a=e+f/3*n,l=r[n],o=Math.cos(a),c=Math.sin(a);for(let e=1;e<=this.config.density;e++){let i=e*this.#h.nailDistance;l.push([t[0]+i*o,t[1]+i*c])}}return r}getPoints(){if(this.points)return this.points;let{levels:t,renderCaps:e}=this.config,i=this.#h.nailsLength,n=this.#h.triangleHeight-i,s=[],r=e?t+1:t;for(let a=0;a<r;a++){let r=e&&a===t,l=[];s.push(l);let o=this.#h.countPerLevelSide[a],c=Array(o).fill(null).map((t,e)=>{let s=e%2==0,r=[this.#h.triangleCenterDistance*(e-a),a*this.#h.triangleHeight+(s?i:n)];return{rotation:Math.atan(r[0]/r[1]),distanceFromCenter:Math.sqrt(r[0]**2+r[1]**2)}});for(let t=0;t<6;t++){let e=G[t];for(let i=0;i<o;i++){if(r&&i%2==0){l.push(null);continue}let{distanceFromCenter:n,rotation:s}=c[i],a=e-s-this.#h.globalRotationRadians,o=[this.center[0]+n*Math.cos(a),this.center[1]-n*Math.sin(a)],u=this.getTrianglePoints({center:o,rotation:e+t*f/3-i*q+this.#h.globalRotationRadians,isCapLevel:r,triangleIndexInSide:i});l.push(u)}}}return s}*generateTriangleStrings(t,{points:e,level:i,indexInSide:n}){t.setColor(this.color.getColor(i));let{density:s,levels:r}=this.config,a=i===r,l=a?this.#M(n%3):0,o=a?l:2,c=a?s:s-1;for(let i=l;i<=o;i++){let n=this.#M(i),r=e[i][0];for(let a=0;a<=c;a++){let l=a%2==0,o=[],c=l?this.config.density-a:a,u=l?n:i;o.push(e[u][c]),a<s&&o.push(e[u][l?c-1:c+1]),t.renderLines(r,...o),r=o[o.length-1],yield}}}*generateStringsBetweenTriangles(t,{triangle1:e,triangle2:i,level:n,triangleIndex:s,triangleIndexInSide:r,isNextLevel:a}){let{density:l,fillColor:o}=this.config,c=this.#h.countPerLevelSide[n],u=s%c%3;t.setColor(o);let h=r===c-1,d=a?[this.#M(u),this.#M(u,-1)]:[u,this.#M(u,r%2?1:-1)];for(let e=0;e<2;e++)for(let{pointIndex:i,triangle1Points:n,triangle2Points:s}of g.call(this,e))t.renderLines(n[i],s[i]),yield;function*g(t){let n=d[t],s=(function(){return a?this.#M(n):0===t&&h?1:1===t&&h?0:this.#M(n,1)}).call(this),r=e[n],o=i[s],c=t?l:l-1;if(0===t)for(let t=0;t<=c;t++)yield{pointIndex:l-t,triangle1Points:r,triangle2Points:o};else for(let t=c;t>=1;t--)yield{pointIndex:l-t,triangle1Points:r,triangle2Points:o}}}#M(t,e=1){let i=t+e;return i<0?2:i>2?0:i}*drawStrings(t){let{fill:e,renderTriangles:i,renderCaps:n,levels:s,renderRing:r,ringSize:a,ringColor:l}=this.config,o=this.getPoints(),c=-1;for(let r of o){let a=++c===s,l=-1,u=r.length-1;for(let h of r){l++;let d=this.#h.countPerLevelSide[c],g=l%d;if(e&&!a&&(0===l&&(yield*this.generateStringsBetweenTriangles(t,{triangle1:r[u],triangle2:h,level:c,triangleIndex:u,triangleIndexInSide:u%d})),l!==u&&(yield*this.generateStringsBetweenTriangles(t,{triangle1:h,triangle2:r[l+1],level:c,triangleIndex:l,triangleIndexInSide:g})),g%2==0&&(n||c<s-1))){let e=Math.floor(l/d)*this.#h.countPerLevelSide[c+1]+g+1;yield*this.generateStringsBetweenTriangles(t,{triangle1:h,triangle2:o[c+1][e],level:c,triangleIndex:l,triangleIndexInSide:g,isNextLevel:!0})}let p=l%this.#h.countPerLevelSide[c];i&&(!a||p%2)&&(yield*this.generateTriangleStrings(t,{points:h,level:c,indexInSide:p}))}}r&&a&&(yield*this.#o.drawRing(t,{ringSize:a/2,color:l}))}getStepCount(t){if(this.stepCount)return this.stepCount;let e=this.#h??this.getCalc(t),{levels:i,density:n,fill:s,renderTriangles:r,renderCaps:a,ringNailCount:l=0}=this.config,{triangleCount:o}=e,c=s?2*n:0,u=i+ +!!a;return o*((r?3*n:0)+c)+(r&&a?6*i*(n+1):0)+c*(u-1)*6*u/2+l}drawNails(){let t=this.getPoints(),e=0;for(let i of t)for(let t of i)if(null!=t)for(let i of t)for(let t of i)this.nails.addNail({point:t,number:e++});this.#o&&this.#o.drawNails(this.nails)}static thumbnailConfig={levels:3,density:3,fill:!1,renderRing:!0}},j,W,J];class Y extends HTMLElement{static formAssociated=!0;internals;start=1;colorThumb=!1;reverse=!1;type="hue";#N=null;constructor(){super(),this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.innerHTML=`
        <string-art-range-input min="1" max="360" step="1" />
    `,this.#N=this.shadowRoot.querySelector("string-art-range-input"),this.internals=this.attachInternals()}static get observedAttributes(){return["start","colorthumb","value","reverse","type"]}attributeChangedCallback(t,e,i){"value"===t&&(this.value=i),"start"===t&&(this.start=parseInt(i,10),this.#L()),"reverse"===t&&(this.reverse=!!i,this.#L()),"colorthumb"===t&&(this.colorThumb=!!i,this.#z()),"type"===t&&(this.type="range"===i?"range":"hue",this.#L())}get value(){return this.#N.value}set value(t){this.#N.value=t,this.#L(),this.colorThumb&&this.#z()}connectedCallback(){this.hasAttribute("value")&&(this.value=parseInt(this.getAttribute("value"))),this.hasAttribute("colorthumb")&&(this.colorThumb=!0),this.#z(),this.#N.addEventListener("input",t=>this.#P(t))}#P(t){let e=this.value;this.internals.setFormValue(String(e)),this.dispatchEvent(new CustomEvent("input",{detail:{value:e}})),this.#L(),this.#z()}disconnectedCallback(){}focus(){}blur(){}#L(){let t="range"===this.type?`linear-gradient(to ${this.reverse?"left":"right"} in hsl ${this.value>=180?"longer":"shorter"} hue, hsl(${this.start} 100 50), hsl(${this.start+(180===this.value?181:this.value)} 100 50))`:"linear-gradient(to right in hsl longer hue, hsl(1 100 50), hsl(360 100 50))";this.#N.setAttribute("background",t)}#z(){let t=this.colorThumb?`hsl(${this.value}deg 100 50)`:"white";this.#N.setAttribute("thumbcolor",t)}}customElements.define("string-art-hue-input",Y);const K="rgba(0,0,0,.2)";class tt extends HTMLElement{static formAssociated=!0;internals;min;max;#N=null;#E=null;#R=.05;#V=null;#A=null;#T=null;#I=null;#D=null;#_=null;#$=null;#O;constructor(){super(),this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.innerHTML=`
          <style>
            input[type="range"] {
              width: 100%;
              appearance: none;
              -webkit-appearance: none; /* remove iOS default */
              background: transparent;
              border: none;
              margin: 2px;
              cursor: pointer;
            }

            input[type="range"]::-webkit-slider-thumb {
              appearance: none;
              -webkit-appearance: none;
              width: 16px;
              height: 16px;
              border-radius: 50%;
              background: var(--color-input);
              cursor: pointer;
              border: none;
              margin-top: -4px;
              z-index: 10;
              box-shadow: 0 0 5px rgba(0,0,0,.5)
            }

            input[type="range"]::-webkit-slider-thumb:hover {
              background: var(--color-input-hover);
            }
              
            input[type="range"]:active::-webkit-slider-thumb {
              background: var(--color-input-active);
            }

            input[type="range"]::-webkit-slider-runnable-track {
              height: 8px;
              border-radius: 4px;
              margin: 0;
            }
          </style>
          <style id="background"></style>
          <input type="range">
        `,this.#N=this.shadowRoot.querySelector('input[type="range"]'),this.#E=this.shadowRoot.querySelector("#background"),this.#R=.05,this.#A=null,this.internals=this.attachInternals()}static get observedAttributes(){return["min","max","value","step","snap","background","thumbcolor"]}attributeChangedCallback(t,e,i){let n;if("snap"===t?this.#T=this.getTickValues():this.#N&&(this.#N[t]=i),("min"===t||"max"===t)&&(this[t]=Number(i)),"value"===t&&(n=Number(i)),"background"===t&&(this.#D=i),"thumbcolor"===t&&(this.#_=i),null!=this.min&&null!=this.max&&(this.min>this.max&&(this.max=this.min,this.#N.max=String(this.min)),this.#I=(this.max-this.min)*this.#R||.05,this.#T&&null!=this.value)){let t=this.getClosestTick(n);null!=t&&(this.#A=t)}this.#B()}get value(){return Number(this.#N.value)}set value(t){this.#N.value=String(t),this.#B()}connectedCallback(){["min","max","value","step"].forEach(t=>{this.hasAttribute(t)&&(this.#N[t]=this.getAttribute(t))}),this.#T=this.getTickValues(),this.#O=new ResizeObserver(t=>{for(let e of t)e.contentRect.width,this.#B()}),this.#O.observe(this.#N),this.#N.addEventListener("input",()=>this.handleInput()),this.#N.addEventListener("keydown",t=>this.handleKeydown(t)),this.#N.addEventListener("change",()=>this.#$=null),this.tabIndex=0}disconnectedCallback(){this.#O.unobserve(this)}getTickValues(){let t=this.getAttribute("snap"),e=t?.match(/\d+(\.\d+)?/g);return e?e.map(Number).filter(t=>!isNaN(t)).sort():[]}#F(t,e){if(null==e&&(e=this.getClosestTick(t)),null==e)return!0;let i=Math.abs(t-e);return!!(i>=this.#I/2&&i>Math.abs(this.#V-e))}#q(t,e){return Math.abs(t-e)/(this.max-this.min)>=.2}focus(){this.#N.focus()}blur(){this.#N.blur()}handleInput(){let t=Number(this.#N.value),e=this.getClosestTick(t);this.internals.setFormValue(this.#N.value),null!=e&&this.#$!==e&&this.#F(t,e)&&(this.#$=e),e!==this.#$&&(null!==e?(this.#N.value=String(e),e!==this.#A&&(this.#G(),this.#A=e)):null!=this.#A&&(this.#A=null)),null!=this.#$&&null==e&&this.#q(t,this.#$)&&(this.#$=null),this.#B(),this.#V=t,this.dispatchEvent(new CustomEvent("input",{detail:{value:this.#N.value}}))}handleKeydown(t){let e;t.preventDefault();let i=Number(this.#N.step||1),n=Number(this.#N.value);if("ArrowLeft"===t.key)e=Math.max(this.min,n-i);else if("ArrowRight"===t.key)e=Math.min(this.max,n+i);else if("ArrowUp"===t.key){let t=this.#T.find(t=>t>n);void 0!==t?e=t:n!==this.max&&(e=this.max)}else if("ArrowDown"===t.key){let t=[...this.#T].reverse().find(t=>t<n);void 0!==t?e=t:n!==this.min&&(e=this.min)}return null!=e&&(this.value=e,this.#V=e,this.dispatchEvent(new CustomEvent("input",{detail:{value:e},bubbles:!0,composed:!0}))),!1}getClosestTick(t){if(!this.#T||0===this.#T.length)return null;for(let e of this.#T)if(Math.abs(t-e)<=this.#I)return e;return null}#G(){"vibrate"in navigator&&navigator.vibrate(10)}#B(){let t=this.#N.clientWidth;if(!t)return;let e=this.value-this.min,i=this.max-this.min,n=t-16,s=8+n*e/i,r=this.#T?.filter(t=>t!==this.min&&t!==this.max).map(t=>8+n*(t-this.min)/i-1),a=r?.map(t=>`transparent ${t}px, ${K} ${t}px, ${K} ${t+2}px, transparent ${t+2}px`).join(", "),l=r?.length?`linear-gradient(to right, ${a}), `:null,o=[`input[type="range"]::-webkit-slider-runnable-track {
        background: ${l||""}${this.#D??`linear-gradient(to right, var(--color-input) ${s}px, #ddd ${s}px)`};
      }${this.#D?"":`
       input[type="range"]:hover::-webkit-slider-runnable-track {
        background: ${l||""}linear-gradient(to right, var(--color-input-hover) ${s}px, #ddd ${s}px);
      }
        input[type="range"]:active::-webkit-slider-runnable-track {
        background: ${l||""}linear-gradient(to right, var(--color-input-active) ${s}px, #ddd ${s}px);
      }`}`];null!=this.#_&&o.push(`input[type="range"]::-webkit-slider-thumb { background: ${this.#_} !important}`),this.#E.innerHTML=o.join("\n")}}customElements.define("string-art-range-input",tt);class te{#U={};addEventListener(t,e){let i=this.#U[t]??=[];return i.includes(e)||i.push(e),()=>{let t=i.indexOf(e);-1!==t&&i.splice(t,1)}}removeEventListener(t,e){let i=this.#U[t];if(!i)return;let n=i.indexOf(e);-1!==n&&i.splice(n,1)}emit(t,e){this.#U[t]?.forEach(t=>t(e))}}const ti={controls:document.querySelector("#controls"),controlsPanel:document.querySelector("#controls_panel"),sidebarForm:document.querySelector("#sidebar_form")},tn="controls_state";class ts extends te{config;controlsConfig;state;controlElements={};#H=!1;#j;#W;#J;#Z;#Q;#X;#Y;#K;#tt=!1;#te;constructor(t,e){super(),this.config=e,this.controlsConfig=t,this.state=this._getState()??{groups:{}},this.#W=this.#ti.bind(this),ti.controls.addEventListener("input",this.#W),this.#J=this.#tn.bind(this),ti.controls.addEventListener("touchstart",this.#J),ti.controls.addEventListener("mousedown",this.#ts),this.#te=this.#tr.bind(this),ti.sidebarForm.addEventListener("click",this.#te),ti.sidebarForm.addEventListener("keydown",this.#ta),this.controlElements={},this.renderControls()}destroy(){ti.controls.removeEventListener("input",this.#W),ti.sidebarForm.removeEventListener("click",this.#te),ti.sidebarForm.removeEventListener("keydown",this.#ta),ti.controls.removeEventListener("touchstart",this.#J),ti.controls.removeEventListener("mousedown",this.#ts),ti.controls.innerHTML=""}#tr(t){if("LEGEND"===t.target.nodeName){t.target.parentElement.classList.toggle("minimized");let e=t.target.parentElement.dataset.group;this.state={...this.state,groups:{...this.state.groups,[e]:!t.target.parentElement.classList.contains("minimized")}},this._updateState(this.state)}}#ta(t){"LEGEND"===t.target.nodeName&&"Enter"===t.key&&this.#tr(t)}#ts(){let t=window.getSelection();t&&t.removeAllRanges()}#tn(t){tr(t.target)&&(this.#H=!0,this.#X=t.target,this.#Y=t.target.value,this.#K=window.setTimeout(()=>{this.#H=!1},120),this.#Z=this.#tl.bind(this),document.body.addEventListener("touchend",this.#Z),this.#Q=this.#to.bind(this),ti.controlsPanel.addEventListener("scroll",this.#Q))}#tl(){document.body.removeEventListener("touchend",this.#Z),ti.controlsPanel.removeEventListener("scroll",this.#Q),this.#tt&&(this.#tt=!1,this.#X&&(this.#X.value=this.#Y)),this.#X=this.#Y=null}#to(){this.#tt=!0}#ti(e){return(clearTimeout(t),clearTimeout(this.#j),this.#H&&tr(e.target))?(e.preventDefault(),this.#j=window.setTimeout(()=>{this.#ti(e)},120),!1):this.#tt?(e.preventDefault(),!1):void((e.target instanceof HTMLInputElement||tr(e.target)||e.target instanceof HTMLSelectElement)&&this.updateInput({inputElement:e.target,originalEvent:e,deferChange:!0}))}updateControlDisplayValue(t){let{config:e,displayValueElement:i,input:n}=this.controlElements[t];i&&(i.innerText=String(e.displayValue?e.displayValue(this.config):n.value))}updateInput({inputElement:e,originalEvent:i,deferChange:n=!0}){let s=e.id.replace(/^config_/,""),r=function(t){if(tr(t))return Number(t.value);if(t instanceof HTMLInputElement)switch(t.type){case"range":case"number":return parseFloat(t.value);case"hue":default:return t.value;case"checkbox":return t.checked}if(t instanceof HTMLSelectElement)return t.value}(e);if(this.config[s]===r)return;let a={control:this.controlElements[s].config,value:r,originalEvent:i};this.emit("input",a);let l=()=>{this.emit("change",a),this.updateControlsVisibility()};this.updateControlsAttributes(),this.updateControlDisplayValue(s),n?t=window.setTimeout(l,100):l()}_getState(){let t=localStorage.getItem(tn);if(t)try{return JSON.parse(t)}catch(t){}return null}_updateState(t){t?localStorage.setItem(tn,JSON.stringify(t)):localStorage.removeItem(tn)}updateControlsAttributes(t){t||(t=this.controlsConfig),t.forEach(t=>{if("group"===t.type)this.updateControlsAttributes(t.children);else if(t.attr){let e=Object.entries(t.attr).filter(([t,e])=>e instanceof Function);if(e.length){let i=this.controlElements[t.key].input;i&&e.forEach(([e,n])=>{let s=this.getConfigValue(n,this.config);s!=i.getAttribute(e)&&(i.setAttribute(e,String(s)),"min"===e&&i.value<s||"max"===e&&i.value>s?(i.value=String(s),clearTimeout(i.updateTimeout),i.updateTimeout=window.setTimeout(()=>{this.updateInput({inputElement:i})},100)):this.updateControlDisplayValue(t.key))})}}})}updateControlsVisibility(t){(t??this.controlsConfig).forEach(t=>{if(t.show){let e=t.show(this.config),i=this.controlElements[t.key].element;i&&(e?i.removeAttribute("hidden"):i.setAttribute("hidden","hidden"))}if(t.isDisabled){let e=t.isDisabled(this.config),i=this.controlElements[t.key].input;i&&(e?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled"))}t.children&&this.updateControlsVisibility(t.children)})}renderControls(t=ti.controls,e,i){let n=e??this.controlsConfig;t.innerHTML="";let s=document.createDocumentFragment();i=i??1,n.forEach((t,e)=>{let i,n,r,a=`config_${String(t.key)}`;if("group"===t.type){(i=document.createElement("fieldset")).setAttribute("data-group",String(t.key));let e=document.createElement("legend");e.setAttribute("tabindex","0"),e.innerText=t.label,i.appendChild(e),i.className="control control_group","minimized"===t.defaultValue&&(i.classList.add("minimized"),this.state.groups[String(t.key)]=!1);let n=document.createElement("div");i.appendChild(n),this.renderControls(n,t.children)}else{(i=document.createElement("div")).className="control";let s=document.createElement("label");s.innerHTML=t.label,s.setAttribute("for",a),tr(n=document.createElement(function(t){switch(t){case"select":return"select";case"range":return"string-art-range-input";case"hue":return"string-art-hue-input";default:return"input"}}(t.type)))&&n.classList.add("range-input"),n.setAttribute("tabindex",String(e));let l=this.config[t.key]??this.getConfigValue(t.defaultValue,this.config);if("select"===t.type){let e=document.createDocumentFragment();t.options.forEach(t=>{let{value:i,label:n}="string"==typeof t?{value:t,label:t}:t,s=document.createElement("option");s.setAttribute("value",i),s.innerText=n,e.appendChild(s)}),n.appendChild(e),n.value=String(l),i.appendChild(s),i.appendChild(n)}else"range"!==t.type&&n.setAttribute("type",t.type),"checkbox"===t.type?(n.checked=!!l,i.appendChild(n),i.appendChild(s)):(i.appendChild(s),i.appendChild(n),setTimeout(()=>{n.value=String(l)}),(r=document.createElement("span")).id=`config_${String(t.key)}_value`,r.innerText=String(t.displayValue?t.displayValue(this.config):l),r.className="control_input_value",i.appendChild(r));t.attr&&Object.entries(t.attr).forEach(([t,e])=>{let i=this.getConfigValue(e,this.config);n.setAttribute(t,String(i))}),n.id=a}this.controlElements[t.key]={config:t,displayValueElement:r,input:n,element:i},i.id=`control_${String(t.key)}`,s.appendChild(i)}),t.appendChild(s),this.updateGroupsState(),requestAnimationFrame(()=>this.updateControlsVisibility())}updateGroupsState(){ti.sidebarForm.querySelectorAll("[data-group]").forEach(t=>{if(t instanceof HTMLFieldSetElement){let e=t.dataset.group,i=this.state.groups[e];"boolean"==typeof i&&(i?t.classList.remove("minimized"):t.classList.add("minimized"))}})}getConfigValue(t,e){return t instanceof Function?t(e):t}}function tr(t){return t instanceof tt||t instanceof Y}const ta=document.querySelector("#size_controls"),tl={sizeSelect:ta.querySelector("#size_select"),sizeCustom:ta.querySelector("#size_custom"),width:ta.querySelector("#size_custom_width"),height:ta.querySelector("#size_custom_height"),orientationSelect:ta.querySelector("#size_orientation_select")};function to(t,e=300){return Math.floor(t/2.54*e)}const tc=[Math.floor(window.screen.width),Math.floor(window.screen.height)],tu=[{id:"fit",name:"Fit to screen"},{id:"A4",value:[20,28].map(t=>to(t)),orientationSelect:!0},{id:"A3",value:[28,40].map(t=>to(t)),orientationSelect:!0},{id:"screen",name:`Screen size (${tc.join("x")})`,value:tc},{id:"custom",name:"Custom..."}];class th{element=document.querySelector("#size_controls");constructor({getCurrentSize:t}){let e=document.createDocumentFragment();tu.forEach(t=>{let i=document.createElement("option");i.setAttribute("value",t.id),i.innerText=t.name??t.id,e.appendChild(i)}),tl.sizeSelect.appendChild(e),this.selectedSize=tu[0],tl.sizeSelect.addEventListener("change",e=>{let i=e.target.value,n=tu.find(({id:t})=>t===i);if(this.selectedSize=n,"custom"===n.id){tl.sizeCustom.removeAttribute("hidden");let[e,i]=t();tl.width.value=e,tl.height.value=i}else tl.sizeCustom.setAttribute("hidden","hidden"),this._notifyOnChange(this.getValue());n.orientationSelect?tl.orientationSelect.removeAttribute("hidden"):tl.orientationSelect.setAttribute("hidden","hidden")}),tl.orientationSelect.addEventListener("change",t=>{this._notifyOnChange(this.getValue())}),tl.sizeCustom.addEventListener("focusin",t=>{t.target.select()}),tl.sizeCustom.addEventListener("input",()=>{this._notifyOnChange([tl.width.value?parseInt(tl.width.value):null,tl.height.value?parseInt(tl.height.value):null])})}_notifyOnChange([t,e]=[]){this.element.dispatchEvent(new CustomEvent("sizechange",{detail:t&&e?[t,e]:null}))}getValue(){if("custom"===this.selectedSize.id)return[parseInt(tl.width.value,10),parseInt(tl.height.value,10)];{let t=this.selectedSize.value;return this.selectedSize.orientationSelect&&"horizontal"===tl.orientationSelect.value&&(t=Array.from(t).reverse()),t}}}const td={updateOnResize:!0};class tg extends te{parentElement;color;size;fixedSize;pixelRatio=1;options;#tc=!0;currentSize;#tu;#th;constructor(t,e){super(),this.options=e??td;let{updateOnResize:i=!0}=this.options;this.parentElement=t,i&&this.#td()}#td(){let t=new ResizeObserver(t=>{for(let e of t)this.#tc||this.fixedSize||this.setSize([e.contentRect.width,e.contentRect.height]),this.#tc=!1});this.#th=()=>t.disconnect(),t.observe(this.parentElement)}destroy(){this.parentElement.innerHTML="",this.#tu?.(),this.#th?.()}get element(){throw Error("element getter not implemented!")}setColor(t){this.color=t}resetSize(){this.fixedSize=null}getSize(){let{width:t,height:e}=this.parentElement.getBoundingClientRect();return[t,e]}getLogicalSize(){return this.getSize()}setFixedSize(t){this.fixedSize=null,this.setSize(t),this.fixedSize=t}enablePixelRatio(){let t=window.devicePixelRatio||1;if(this.pixelRatio=t,!1!==this.options.updateOnResize){let e=()=>{this.#tu?.();let i=matchMedia(`(resolution: ${t}dppx)`);i.addEventListener("change",e),this.#tu=()=>{i.removeEventListener("change",e)},this.pixelRatio=window.devicePixelRatio,this.emit("devicePixelRatioChange",{devicePixelRatio:this.pixelRatio})};e()}}disablePixelRatio(){this.pixelRatio=1,this.#tu?.()}}let tp=0;class tf extends tg{#tg;constructor(t,e){super(t,e);let i=document.createElement("canvas"),n=document.createElement("canvas");i.setAttribute("data-id",String(tp++)),this.#tg={strings:{canvas:i,ctx:i.getContext("2d")},nails:{canvas:n,ctx:n.getContext("2d")}},i.id="CanvasRenderer__strings",n.id="CanvasRenderer__nails",this.canvases.forEach(e=>{e.classList.add("CanvasRenderer__canvas"),t.appendChild(e)}),this.enablePixelRatio(),this.ctxs.forEach(t=>t.globalCompositeOperation="source-over"),this.addEventListener("devicePixelRatioChange",()=>{this.setSize([this.stringsCanvas.clientWidth,this.stringsCanvas.clientHeight])}),this.resetSize(!1)}get element(){return this.#tg.strings.canvas}get canvases(){return[this.#tg.strings.canvas,this.#tg.nails.canvas]}get ctxs(){return[this.#tg.strings.ctx,this.#tg.nails.ctx]}get stringsCtx(){return this.#tg.strings.ctx}get nailsCtx(){return this.#tg.nails.ctx}get stringsCanvas(){return this.#tg.strings.canvas}resetSize(t=!0){super.resetSize(),this.canvases.forEach(t=>{t.removeAttribute("width"),t.removeAttribute("height"),t.style.removeProperty("width"),t.style.removeProperty("height")});let e=this.getSize();return this.canvases.forEach(t=>{t.setAttribute("width",String(e[0])),t.setAttribute("height",String(e[1]))}),this.currentSize&&o(e,this.currentSize)||(this.currentSize=e,t&&this.emit("sizeChange",{size:e})),e}setSize(t,e=!0){if(!t)return this.resetSize();if(this.fixedSize)return console.warn(`Trying to set size for Renderer to [${t.join(", ")}], but size is fixed to [${this.fixedSize.join(", ")}].`),this.fixedSize;let i=t.map(t=>t*this.pixelRatio);return this.canvases.forEach(e=>{e.setAttribute("width",String(i[0])),e.setAttribute("height",String(i[1])),e.style.setProperty("width",`${t[0]}px`),e.style.setProperty("height",`${t[1]}px`)}),this.currentSize&&o(i,this.currentSize)||(this.currentSize=i,e&&this.emit("sizeChange",{size:i})),i}resetStrings(){this.stringsCtx.clearRect(0,0,...this.getSize())}resetNails(){this.#tg.nails.ctx.clearRect(0,0,...this.getSize())}setColor(t){this.stringsCtx.strokeStyle=t}setLineWidth(t){this.stringsCtx.lineWidth=t}setBackground(t){this.stringsCtx.globalCompositeOperation="destination-over",this.stringsCtx.fillStyle=t,this.stringsCtx.fillRect(0,0,...this.getSize()),this.stringsCtx.globalCompositeOperation="source-over"}getLogicalSize(){return this.fixedSize??[this.stringsCanvas.clientWidth,this.stringsCanvas.clientHeight]}getSize(){return this.getLogicalSize().map(t=>t*this.pixelRatio)}renderLines(t,...e){for(let i of(this.stringsCtx.beginPath(),this.stringsCtx.moveTo(...t),e))this.stringsCtx.lineTo(...i);this.stringsCtx.stroke()}renderNails(t,{color:e,fontSize:i,radius:n,renderNumbers:s,margin:r=0}){let a=this.stringsCanvas.width/2;this.nailsCtx.globalCompositeOperation="source-over",this.nailsCtx.beginPath(),this.nailsCtx.fillStyle=e,this.nailsCtx.textBaseline="middle",this.nailsCtx.font=`${i}px sans-serif`;let l=n+r;t.forEach(({point:[t,e],number:i})=>{if(this.nailsCtx.moveTo(t+n,e),this.nailsCtx.arc(t,e,n,0,f),s&&null!=i){let n=t<a,s=[n?t-l:t+l,e];this.nailsCtx.textAlign=n?"right":"left",this.nailsCtx.fillText(String(i),...s)}}),this.nailsCtx.fill()}clear(){this.ctxs.forEach(t=>t.clearRect(0,0,...this.getSize()))}toDataURL(){return this.getComposite().toDataURL()}getComposite(){let t=document.createElement("canvas");t.width=this.stringsCanvas.width,t.height=this.stringsCanvas.height;let e=t.getContext("2d");return this.canvases.forEach(t=>e.drawImage(t,0,0)),t}}const tm="prompt_dialog";function ty({value:t,...e}){let i=document.querySelector(`#${tm}`);return i||((i=document.createElement("input-dialog")).id=tm,document.body.appendChild(i)),["title","description","submit","cancel","type"].forEach(t=>{null!=e[t]&&""!==e[t]?i.setAttribute(t,e[t]):i.removeAttribute(t)}),i.show(t)}const tb="confirm_dialog";function tC(t){let e=document.querySelector(`#${tb}`);return e||((e=document.createElement("confirm-dialog")).id=tb,document.body.appendChild(e)),["title","description","submit","cancel","type"].forEach(i=>{null!=t[i]&&""!==t[i]?e.setAttribute(i,t[i]):e.removeAttribute(i)}),e.show()}const tS="string_art_app_data";class tw extends te{elements;currentPattern;constructor(){super(),this.elements={saveDialog:document.querySelector("#save_dialog")},document.querySelector("#pattern_menu").addEventListener("select",t=>{switch(t.detail.value){case"save_as":this.#tp();break;case"delete":this.deletePattern();break;case"save":this.saveCurrentPattern();break;case"rename":this.renameCurrentPattern()}}),document.querySelector("#save_btn").addEventListener("click",()=>{this.currentPattern.isTemplate?this.#tp():this.saveCurrentPattern()})}#tp(){let t=this.#tf(),e=`Pattern #${t}`;ty({title:"Save pattern",description:"Name this pattern:",submit:"Save",value:e}).then(t=>{this.saveNewPattern({type:this.currentPattern.type,config:this.currentPattern.config,name:null==t||""===t?e:t})},()=>{})}setPattern(t){this.currentPattern=t}static patternDataToStringArt({type:t,...e}){let i=X.find(({type:e})=>e===t);if(null==i)throw Error(`No pattern of type "${t}" found!`);let n=new i;return Object.assign(n,e),n}static getSavedPatterns(){let{patterns:t}=this.loadAppData();return t.map(this.patternDataToStringArt)}static getPatternByID(t){let e=this.loadPatternDataById(t);return e?this.patternDataToStringArt(e):null}static loadPatternDataById(t){let{patterns:e}=this.loadAppData();return e.find(({id:e})=>e===t)}#tf(){let t=tw.loadAppData(),e=t?.patterns?.length?Number(t.patterns[t.patterns.length-1].id):0;return String(isNaN(e)?1:e+1)}saveNewPattern(t){let e=tw.loadAppData(),i=this.#tf(),n={...t,id:i};return e.patterns.push(n),this.saveAppData(e),this.emit("newPattern",{pattern:tw.patternDataToStringArt(n)}),n}savePattern(t){let e=tw.loadAppData(),i=e.patterns.findIndex(({id:t})=>t===this.currentPattern.id);-1!==i&&(e.patterns[i]=t,this.saveAppData(e),this.emit("save",{pattern:tw.patternDataToStringArt(t)}))}saveCurrentPattern(){let t={id:this.currentPattern.id,name:this.currentPattern.name,type:this.currentPattern.type,config:this.currentPattern.config};return this.savePattern(t),t}renameCurrentPattern(){ty({title:"Rename",description:"Name this pattern:",submit:"Save",value:this.currentPattern.name}).then(t=>{if(t!==this.currentPattern.name){let e=tw.loadPatternDataById(this.currentPattern.id);e.name=t,this.savePattern(e)}this.currentPattern.name=t})}deletePattern(){tC({title:"Delete pattern",description:"Are you sure you wish to delete this pattern?",submit:"Delete",type:"error"}).then(()=>{let t=tw.loadAppData(),e=t.patterns.findIndex(({id:t})=>t===this.currentPattern.id);if(-1===e)throw Error(`Can't delete pattern with ID "${this.currentPattern.id}", it's not found!`);let i=t.patterns.splice(e,1)[0];this.saveAppData(t),this.emit("deletePattern",{pattern:tw.patternDataToStringArt(i)})},()=>{})}static loadAppData(){let t=localStorage.getItem(tS);try{return t?JSON.parse(t):{patterns:[]}}catch(t){throw Error("App data is corrupted, failed to load it. "+t.message)}}saveAppData(t){localStorage.setItem(tS,JSON.stringify(t))}}const tv="minimized";class tx extends te{elements={root:document.querySelector("#pattern_select_panel"),thumbnails:document.querySelector("#thumbnails"),toggleBtn:document.querySelector("#pattern_select_btn"),dropdown:document.querySelector("#pattern_select_dropdown"),patternName:document.querySelector("#pattern_name")};pattern;thumbnailsRendered=!1;_onClickOutside;constructor(t){super(),this.elements.toggleBtn.addEventListener("click",()=>this.toggle()),t.addEventListener("newPattern",({pattern:t})=>{this.isOpen?this.createThumbnails():this.thumbnailsRendered=!1,this.setCurrentPattern(t),this.emit("select",{patternId:t.id})}),t.addEventListener("save",({pattern:t})=>{this.isOpen?this.createThumbnails():this.thumbnailsRendered=!1,this.setCurrentPattern(t)}),t.addEventListener("deletePattern",({pattern:t})=>{this.isOpen?this.elements.thumbnails.querySelector(`[data-pattern="${t.id}"]`).remove():this.thumbnailsRendered=!1}),this.elements.thumbnails.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();let e=t.target instanceof HTMLElement&&t.target.closest("[data-pattern]");if(!e)return!1;this.emit("select",{patternId:e.dataset.pattern}),this.toggle()})}get isOpen(){return!this.elements.root.classList.contains(tv)}toggle(){this.isOpen?this.pattern&&this.close():this.open()}open(){this.isOpen||(this.elements.root.classList.remove(tv),this.thumbnailsRendered||(this.createThumbnails(),this.thumbnailsRendered=!0),this._onClickOutside=t=>{t.target instanceof HTMLElement&&!t.target.closest("#pattern_select_panel")&&this.toggle()},document.body.addEventListener("mousedown",this._onClickOutside))}close(){this.isOpen&&(this.elements.root.classList.add(tv),document.body.removeEventListener("mousedown",this._onClickOutside),this._onClickOutside=null)}setCurrentPattern(t){this.pattern=t,this.elements.patternName.innerText=t?.name??"Choose a pattern"}#tm(t,e){let i=document.createElement("section"),n=document.createElement("h3");n.className="pattern_select_thumbnails_title",n.innerText=t,i.appendChild(n);let s=document.createElement("ul");s.className="pattern_select_thumbnails",i.appendChild(s);let r=document.createDocumentFragment(),a={};e.forEach(t=>{let e=document.createElement("a");e.style.width=e.style.height="100px",a[t.id]=e,t.assignConfig({margin:1,enableBackground:!1,nailRadius:.5,...t.constructor.thumbnailConfig});let i=document.createElement("li");r.appendChild(i),e.href=`?pattern=${t.id}`,e.setAttribute("data-pattern",t.id),e.title=t.name,i.appendChild(e)}),s.appendChild(r),this.elements.thumbnails.appendChild(i),e.forEach(t=>{let e=new tf(a[t.id],{updateOnResize:!1});e.setSize([100,100]),t.draw(e)})}createThumbnails(){this.elements.thumbnails.innerHTML="",tw.getSavedPatterns().length&&this.#tm("My Patterns",tw.getSavedPatterns());let t=X.map(t=>new t);this.#tm("Built-in patterns",t)}}function tk(t){let{defaultConfig:e,config:i}=t,n=Object.entries(i).map(([t,i])=>i===e[t]?null:"boolean"==typeof i?`!${+!!i}`:"number"==typeof i?parseFloat(i.toFixed(6)):i);for(;null===n[n.length-1];)n.pop();return n.length?n.join("_").replace(/\_{2,}/g,t=>"~"+t.length+"_"):""}const tM=/^\-?\d+(\.\d+)?$/,tN=/^(?:!)([01])$/;async function tL(t){try{navigator.share(await tE(t))}catch(t){alert("Error: "+t.message)}}async function tz(){if(!navigator.share)return!1;let t=document.createElement("canvas");t.width=1,t.height=1;let e=t.getContext("2d");e.fillStyle="black",e.fillRect(0,0,1,1);let i=t.toDataURL(),n=await tP(i,"test","test.jpg");return navigator.canShare(n)}async function tP(t,e,i){let n=await (await fetch(t)).blob(),s=[new File([n],i,{type:n.type,lastModified:new Date().getTime()})];return{url:window.location.href,files:s,title:document.title,text:e}}async function tE({renderer:t,pattern:e}){return tP(t.toDataURL(),"String Art Studio - "+e.name,e.name+".jpg")}async function tR(){if(navigator.serviceWorker&&"127.0.0.1"!==document.location.hostname)try{let t=await navigator.serviceWorker.register("service-worker.js");t.onupdatefound=()=>{let e=t.installing;null!=e&&(e.onstatechange=()=>{"installed"===e.state&&(navigator.serviceWorker.controller?console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."):console.log("Content is cached for offline use."))})}}catch(t){console.error("Error during service worker registration:",t)}}const tV="http://www.w3.org/2000/svg";class tA extends tg{svg;backgroundGroup;background=null;linesGroup;nailsGroup;nailsCirclesGroup;nailsTextGroup;currentColor=null;lineWidth=1;currentLineGroup=null;constructor(t){super(t),this.svg=document.createElementNS(tV,"svg"),this.svg.style.setProperty("display","block"),this.backgroundGroup=document.createElementNS(tV,"g"),this.backgroundGroup.setAttribute("data-id","background"),this.linesGroup=document.createElementNS(tV,"g"),this.linesGroup.setAttribute("data-id","lines"),this.nailsGroup=document.createElementNS(tV,"g"),this.nailsGroup.setAttribute("data-id","nails"),this.nailsCirclesGroup=document.createElementNS(tV,"g"),this.nailsCirclesGroup.setAttribute("data-id","nailsCircles"),this.nailsTextGroup=document.createElementNS(tV,"g"),this.nailsTextGroup.setAttribute("data-id","nailsText"),this.nailsGroup.appendChild(this.nailsCirclesGroup),this.nailsGroup.appendChild(this.nailsTextGroup),this.svg.appendChild(this.backgroundGroup),this.svg.appendChild(this.linesGroup),this.svg.appendChild(this.nailsGroup),this.svg.setAttribute("xmlns",tV),t.appendChild(this.svg)}get element(){return this.svg}resetSize(){super.resetSize(),this.svg.style.removeProperty("width"),this.svg.style.removeProperty("height");let t=this.getSize().map(Math.trunc),[e,i]=t;return this.svg.setAttributeNS(tV,"viewBox",`0 0 ${e} ${i}`),this.svg.setAttributeNS(tV,"width",String(e)),this.svg.setAttributeNS(tV,"height",String(i)),this.svg.style.width=e+"px",this.svg.style.height=i+"px",this.currentSize&&o(t,this.currentSize)||(this.currentSize=t,this.emit("sizeChange",{size:t})),t}resetNails(){this.nailsCirclesGroup.innerHTML="",this.nailsTextGroup.innerHTML=""}resetStrings(){this.linesGroup.innerHTML="",this.currentColor=null,this.lineWidth=null}setColor(t){t!==this.currentColor&&(this.currentLineGroup=document.createElementNS(tV,"g"),this.currentLineGroup.setAttribute("stroke",t),this.currentLineGroup.setAttribute("stroke-width",String(this.lineWidth)),this.linesGroup.appendChild(this.currentLineGroup),this.currentColor=t)}setLineWidth(t){this.lineWidth=t??"1",this.linesGroup.setAttributeNS(tV,"stroke-width",String(t??1)),this.linesGroup.childNodes.forEach(e=>{e instanceof SVGGElement&&e.setAttributeNS(tV,"stroke-width",String(t??1))})}setBackground(t){t?(this.background||(this.background=document.createElementNS(tV,"rect"),this.background.setAttribute("width","100%"),this.background.setAttribute("height","100%"),this.backgroundGroup.appendChild(this.background)),this.background.setAttribute("fill",t)):(this.background=null,this.backgroundGroup.innerHTML="")}getSize(){return[this.svg.clientWidth,this.svg.clientHeight]}setSize(t){if(!t)return this.resetSize();if(this.fixedSize)return console.warn(`Trying to set size for Renderer to [${t.join(", ")}], but size is fixed to [${this.fixedSize.join(", ")}].`),this.fixedSize;this.svg.removeAttributeNS(tV,"width"),this.svg.removeAttributeNS(tV,"height"),this.svg.style.width=`${t[0]}px`,this.svg.style.height=`${t[1]}px`;let e=t.map(Math.trunc),[i,n]=e;return this.svg.setAttributeNS(tV,"viewBox",`0 0 ${i} ${n}`),this.svg.setAttributeNS(tV,"width",String(i)),this.svg.setAttributeNS(tV,"height",String(n)),this.currentSize&&o(e,this.currentSize)||(this.currentSize=e,this.emit("sizeChange",{size:e})),e}renderLines(t,...e){let i=t,n=document.createDocumentFragment();for(let t of e){let e=document.createElementNS(tV,"line");e.setAttribute("x1",String(Math.trunc(i[0]))),e.setAttribute("y1",String(Math.trunc(i[1]))),e.setAttribute("x2",String(Math.trunc(t[0]))),e.setAttribute("y2",String(Math.trunc(t[1]))),i=t,n.appendChild(e)}this.currentLineGroup.appendChild(n)}renderNails(t,{color:e,fontSize:i,radius:n,renderNumbers:s,margin:r=0}){let a=this.getSize()[0]/2;this.nailsCirclesGroup.innerHTML=this.nailsTextGroup.innerHTML="";let l=document.createDocumentFragment(),o=document.createDocumentFragment(),c=n+r;this.nailsTextGroup.style.fontSize=String(i),t.forEach(({point:[t,e],number:i})=>{let r=document.createElementNS(tV,"circle");if(r.setAttribute("cx",String(t)),r.setAttribute("cy",String(e)),r.setAttribute("r",String(n)),l.appendChild(r),s&&null!=i){let n=t<a,s=[n?t-c:t+c,e],r=document.createElementNS(tV,"text");r.innerHTML=String(i),r.setAttribute("x",String(s[0])),r.setAttribute("y",String(s[1])),n&&r.setAttribute("text-anchor","end"),o.appendChild(r)}}),this.nailsCirclesGroup.appendChild(l),this.nailsTextGroup.appendChild(o),null!=e&&(this.nailsCirclesGroup.setAttribute("fill",e),this.nailsTextGroup.setAttribute("fill",e))}clear(){this.linesGroup.innerHTML="",this.nailsGroup.innerHTML=""}toDataURL(){return""}}function tT(t,{type:e,includeNails:i,...n}){!function({data:t,filename:e}){let i=document.createElement("a");i.href=t,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)}("svg"===e?function(t,{size:e,filename:i}){let n=document.createElement("article");n.style.width=e[0]+"px",n.style.height=e[1]+"px",document.body.appendChild(n);let s=new tA(n);s.setFixedSize(e),t.draw(s);let r=new Blob([s.svg.outerHTML],{type:"image/svg+xml;charset=utf-8"});return{data:URL.createObjectURL(r),filename:i??t.name+".svg"}}(t,n):function(t,{size:e,filename:i}){let n=new tf(document.createElement("article"),{updateOnResize:!1});return n.disablePixelRatio(),n.setFixedSize(e),t.draw(n),{data:n.toDataURL(),filename:i??t.name+".png"}}(t,n))}class tI extends HTMLElement{button;#ty;constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
      <style>
        :host {
          display: inline-block;
          position: relative;
        }

        button {
          display: block;
          padding: 10px 15px;
          background: transparent;
          color: white;
          border: none;
          cursor: pointer;
          font: inherit;
        }

        button:hover {
          background: #444;
        }

        button:focus {
          background: rgba(255,255,255,.2)
        }
        ul {
          display: none;
          position: absolute;
          top: 100%;
          right: 0;
          min-width: 120px;
          background: var(--color-dialog-background);
          border: var(--border-dialog);
          margin: 0;
          padding: 0;
          list-style: none;
          z-index: 1000;
          box-shadow: 1px 1px 10px rgba(0,0,0,.7)
        }

        :host(.open) ul {
          display: block;
        }
      </style>

      <button aria-haspopup="true" aria-expanded="false">
        <slot name="label">Menu</slot>
      </button>
      <ul role="menu">
        <slot></slot>
      </ul>
    `}connectedCallback(){this.button=this.shadowRoot.querySelector("button"),this.button.addEventListener("click",()=>this.toggle()),this.#ty&&(this.button.style=this.#ty),document.addEventListener("click",t=>{this.contains(t.target)||this.shadowRoot.contains(t.target)||this.close()}),this.button.addEventListener("keydown",t=>{"Escape"===t.key&&(this.close(),this.button.focus())}),this.addEventListener("item-selected",t=>{this.dispatchEvent(new CustomEvent("select",{detail:{value:t.detail.value},bubbles:!0,composed:!0})),this.close()})}static get observedAttributes(){return["button-style"]}attributeChangedCallback(t,e,i){"button-style"===t&&(this.button?this.button.style=i:this.#ty=i)}toggle(){let t=this.classList.toggle("open");this.button.setAttribute("aria-expanded",String(t))}close(){this.classList.remove("open"),this.button.setAttribute("aria-expanded","false")}}customElements.define("dropdown-menu",tI);class tD extends HTMLElement{static get observedAttributes(){return["value"]}value="";constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
      <style>
        li {
          list-style: none;
          padding: 12px 40px 12px 20px;
          color: White;
          text-decoration: none;
          white-space: nowrap;
          background: transparent;
          cursor: pointer;
        }
        li:hover {
          background: rgba(255,255,255,.1);
        }
        span:not(:empty) {
          float: left; 
          margin-right: .5em;
          position: relative;
          left: -4px;
          top: 1px;
        }
      </style>
      <li role="menuitem">
        <span id="icon"><slot name="icon"></span>
        <slot></slot>
      </li>
    `}connectedCallback(){this.shadowRoot.querySelector("li").addEventListener("click",t=>{t.preventDefault(),this.dispatchEvent(new CustomEvent("item-selected",{detail:{value:this.value},bubbles:!0,composed:!0}))})}attributeChangedCallback(t,e,i){"value"===t&&(this.value=i)}}customElements.define("dropdown-menu-item",tD);var t_={};t_="dialog{background:var(--color-dialog-background);color:#fff;border:var(--border-dialog);width:400px;margin:0;position:fixed;top:100px;left:50%;overflow:hidden;transform:translate(-50%);box-shadow:0 0 10px #000c}dialog::backdrop{background:#000000b3}.dialog-title{color:var(--color-accent);text-shadow:1px 1px 1px #000;margin-top:0;font-size:1.4em;font-weight:400}dialog.error .dialog-title{color:var(--color-error)}.dialog-input{border:solid 1px var(--color-input);color:#fff;background:0 0;border-radius:4px;outline:none;width:100%;font-size:1.1em;height:40px!important;padding:4px 8px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-menu{text-align:end;flex-direction:row;justify-content:end;align-items:center;margin-bottom:0;display:flex}.dialog-menu button{color:#fff;cursor:pointer;background:0 0;border:none;border-radius:4px;margin-inline-start:.5em;padding:8px 16px;font-size:1em}.dialog-menu button[type=submit]{background:var(--color-input)}dialog.error .dialog-menu button[type=submit]{background:var(--color-error)}.dialog-menu button[type=submit]:hover{background:var(--color-input-active)}.dialog-menu .btn-cancel{opacity:.5}.dialog-menu .btn-cancel:hover,.dialog-menu .btn-cancel:focus{opacity:1}#dialog_contents{display:flex}";const t$=new CSSStyleSheet;t$.replaceSync(String(t_));class tO extends HTMLElement{dialog;input;static get observedAttributes(){return["title","description","value","submit","cancel","type"]}constructor(){super();let t=this.attachShadow({mode:"open"});t.adoptedStyleSheets=[t$],this.shadowRoot.innerHTML=`
      <confirm-dialog>
        <input
            type="text"
            class="dialog-input"
            name="patternName"
            required
          />
      </confirm-dialog>
    `,this.dialog=t.querySelector("confirm-dialog"),this.input=t.querySelector("input"),this.input.addEventListener("keypress",t=>{"Enter"===t.code&&this.dialog.submit()})}connectedCallback(){this.syncAttributes()}attributeChangedCallback(){this.syncAttributes()}syncAttributes(){tO.observedAttributes.filter(t=>"value"!==t).forEach(t=>{this.hasAttribute(t)?this.dialog.setAttribute(t,this.getAttribute(t)):this.dialog.removeAttribute(t)}),this.hasAttribute("value")&&(this.input.value=this.getAttribute("value")||"")}show(t){return void 0!==t?this.input.value=t:this.hasAttribute("value")&&(this.input.value=this.getAttribute("value")||""),this.input.select(),this.dialog.show().then(()=>this.input.value)}getValue(){return this.input.value}}customElements.define("input-dialog",tO);var tB={};tB="dialog{background:var(--color-dialog-background);color:#fff;border:var(--border-dialog);width:400px;margin:0;position:fixed;top:100px;left:50%;overflow:hidden;transform:translate(-50%);box-shadow:0 0 10px #000c}dialog::backdrop{background:#000000b3}.dialog-title{color:var(--color-accent);text-shadow:1px 1px 1px #000;margin-top:0;font-size:1.4em;font-weight:400}dialog.error .dialog-title{color:var(--color-error)}.dialog-input{border:solid 1px var(--color-input);color:#fff;background:0 0;border-radius:4px;outline:none;width:100%;font-size:1.1em;height:40px!important;padding:4px 8px!important}.dialog-input::selection{color:#000;background:#fff}.dialog-input:hover,.dialog-input:active,.dialog-input:focus-visible{border-color:var(--color-input-active)}.dialog-input:active,.dialog-input:focus-visible{background:#ffffff1a}.dialog-menu{text-align:end;flex-direction:row;justify-content:end;align-items:center;margin-bottom:0;display:flex}.dialog-menu button{color:#fff;cursor:pointer;background:0 0;border:none;border-radius:4px;margin-inline-start:.5em;padding:8px 16px;font-size:1em}.dialog-menu button[type=submit]{background:var(--color-input)}dialog.error .dialog-menu button[type=submit]{background:var(--color-error)}.dialog-menu button[type=submit]:hover{background:var(--color-input-active)}.dialog-menu .btn-cancel{opacity:.5}.dialog-menu .btn-cancel:hover,.dialog-menu .btn-cancel:focus{opacity:1}#dialog_contents{display:flex}";const tF=new CSSStyleSheet;tF.replaceSync(String(tB));class tq extends HTMLElement{dialog;cancelBtn;submitBtn;titleEl;descEl;static get observedAttributes(){return["title","description","submit","cance","type"]}constructor(){super();let t=this.attachShadow({mode:"open"});t.adoptedStyleSheets=[tF],this.shadowRoot.innerHTML=`
      <dialog>
        <form method="dialog">
          <h2 class="dialog-title"></h2>
          <p class="dialog-desc"></p>
          <div id="dialog_contents">
            <slot></slot>
          </div>
          <menu class="dialog-menu">
            <button type="button" class="btn-cancel">Cancel</button>
            <button type="submit" value="confirm" class="btn-submit"></button>
          </menu>
        </form>
      </dialog>
    `,this.dialog=t.querySelector("dialog"),this.cancelBtn=t.querySelector(".btn-cancel"),this.submitBtn=t.querySelector(".btn-submit"),this.titleEl=t.querySelector(".dialog-title"),this.descEl=t.querySelector(".dialog-desc")}connectedCallback(){this.cancelBtn.addEventListener("click",()=>{this.dialog.returnValue="",this.dialog.close()}),this.syncAttributes()}attributeChangedCallback(){this.syncAttributes()}syncAttributes(){this.hasAttribute("title")&&(this.titleEl.textContent=this.getAttribute("title")),this.hasAttribute("description")&&(this.descEl.textContent=this.getAttribute("description")),this.submitBtn.textContent=this.getAttribute("submit")||"Submit",this.cancelBtn.textContent=this.getAttribute("cancel")||"Cancel",this.hasAttribute("type")&&"error"===this.getAttribute("type")?this.dialog.classList.add("error"):this.dialog.classList.remove("error")}show(){return this.dialog.showModal(),new Promise((t,e)=>{let i=()=>{this.dialog.removeEventListener("close",i),"confirm"===this.dialog.returnValue?t():e()};this.dialog.addEventListener("close",i)})}submit(){this.submitBtn.click()}}customElements.define("confirm-dialog",tq);class tG extends te{element;renderer;pattern;rendererType;constructor(t="canvas"){super(),this.rendererType=t,this.element=document.querySelector("#canvas_panel"),this.element.addEventListener("wheel",({deltaY:t})=>{let e=-t/Math.abs(t);this.emit("positionChange",{changeBy:e})})}get position(){return this.pattern?.position??-1}get size(){return[this.element.clientWidth,this.element.clientHeight]}setSize(t){this.#tb(),t?(this.element.classList.contains("overflow")||this.element.classList.add("overflow"),this.renderer.setFixedSize(t)):(this.element.classList.remove("overflow"),this.renderer.resetSize())}setRenderer(t){this.renderer=t,t.addEventListener("sizeChange",({size:t})=>this.#tC(t))}setPattern(t){this.pattern=t,!t&&this.renderer&&this.renderer.clear()}#tC(t){t[0]&&t[1]&&this.pattern?.draw(this.renderer)}#tS(){let t;this.element.addEventListener("pointerdown",()=>{this.emit("click",null);let e=()=>{clearTimeout(t),this.element.removeEventListener("pointerup",e)};t=setTimeout(()=>{this.element.removeEventListener("pointerup",e),this.emit("touchStart",null);let t=()=>{this.emit("touchEnd",null),this.element.removeEventListener("pointerup",t)};this.element.addEventListener("pointerup",t)},200),this.element.addEventListener("pointerup",e)})}update(t){this.#tb(),this.pattern?.draw(this.renderer,t)}goto(t){this.#tb(),this.pattern.goto(this.renderer,t)}next(){return{done:this.pattern.drawNext().done}}getStepCount(){return this.#tb(),this.pattern.getStepCount({size:this.renderer.getSize()})}#tb(){if(!this.renderer){let t="svg"===this.rendererType?tA:tf;this.setRenderer(new t(this.element))}}}window.addEventListener("error",function(t){alert("Error:\n"+t.message+"\n\nStack:\n"+t.error.stack)});const tU={main:document.querySelector("main"),downloadBtn:document.querySelector("#download_btn"),downloadSVGBtn:document.querySelector("#download_svg_btn"),downloadNailsBtn:document.querySelector("#download_nails_btn"),downloadNailsNoNumbersBtn:document.querySelector("#download_nails_no_numbers_btn"),resetBtn:document.querySelector("#reset_btn"),shareBtn:document.querySelector("#share_btn"),playerBtn:document.querySelector("#player_btn"),buttons:document.querySelector("#buttons"),instructionsLink:document.querySelector("#pattern_select_dropdown_instructions")},tH=new tw,tj=new tx(tH);async function tW(){let t,i,n;window.addEventListener("popstate",({state:t})=>{c(t)}),await tR(),document.body.querySelectorAll(".pattern_only").forEach(tZ),tJ(document.querySelector("main"));let s=new URLSearchParams(document.location.search),r=new tG("svg"===s.get("renderer")?"svg":"canvas"),a=new e(document.querySelector("#player"),r),l=new th({getCurrentSize:()=>r.size}),o=X.map(t=>new t);if(history.state?.pattern)c(history.state);else{let t=s.get("pattern");t?c({pattern:t,config:s.get("config")}):tj.toggle()}function c(t){if(t?.pattern){let e=u(t.pattern);e?(r.setPattern(e),y(e,{draw:!1,config:t.config?function(t,e){let i=e.replace(/(?:~)(\d+)(?:_)/g,(t,e)=>Array(+e).fill("_").join("")).split("_").map(t=>{if(""===t)return null;if(tM.test(t))return parseFloat(t);let e=t.match(tN);return e?"1"===e[1]:t}),n=Object.keys(t.defaultConfig);return i.reduce((t,e,i)=>{if(null!==e){let s=n[i];return{...t,[s]:e}}return t},{})}(e,t.config):null}),tj.close(),r.update()):tj.open()}else b(),tj.open()}function u(t){let e=o.find(({id:e})=>e===t);return e||(e=tw.getPatternByID(t)),e}async function h(){if(!n)throw Error("Can't init pattern - no current pattern available!");l.element.addEventListener("sizechange",({detail:t})=>{r.setSize(t)}),tU.resetBtn.addEventListener("click",g),await tz()&&tJ(tU.shareBtn)}function d(t=!0){let e=new n.constructor;e.config={...e.config,darkMode:!1,showNails:!0,showNailNumbers:t,showStrings:!1,nailsColor:"#000000",backgroundColor:"#ffffff"},tT(e,{size:r.renderer.getLogicalSize(),filename:`${n.name} - nails map`})}function g(){tC({title:"Reset options",description:n.isTemplate?"Are you sure you wish to reset options to defaults?":"Are you sure you wish to reset to the latest saved options?",submit:"Reset"}).then(()=>{f(u(n.id),n.isTemplate?{config:{}}:{})},()=>{})}function p({control:t}){!1!==t.affectsStepCount&&a.update(r.getStepCount());let e=tk(n);history.replaceState({pattern:n.id,config:e,renderer:i instanceof tA?"svg":void 0},n.name,function(t,{renderer:e}={}){let i=tk(t);return`?pattern=${t.isTemplate?t.id:t.type}${i?`&config=${encodeURIComponent(i)}`:""}${"svg"===e?"&renderer=svg":""}`}(n,{renderer:i instanceof tA?"svg":"canvas"})),function(t){let e=(void 0)??n.isTemplate?m(n.config,n.defaultConfig):m(n.config,u(n.id).config);tU.main.dataset.isDefaultConfig=String(e)}()}function f(t,e){y(t,e),history.pushState({pattern:t.id},t.name,"?pattern="+t.id),tU.main.dataset.isDefaultConfig=String(e?.isDefaultConfig!==!1)}function y(e,{config:i,draw:s=!0}={}){let l=!n;n=e,r.setPattern(e),i&&n.setConfig(i),t&&t.destroy(),tH.setPattern(n),(t=new ts(e.configControls,e.config)).addEventListener("input",({control:e,value:i})=>{n.setConfigValue(e.key,i),t.config=n.config,r.update({redrawNails:!1!==e.affectsNails,redrawStrings:!1!==e.affectsStrings})}),t.addEventListener("change",p),tj.setCurrentPattern(e),document.title=`${e.name} - String Art Studio`,document.body.setAttribute("data-pattern",e.id),l&&h(),document.body.querySelectorAll(".pattern_only").forEach(tJ),s&&r.update(),a.update(r.getStepCount(),{draw:!1}),tU.main.dataset.isTemplate=String(n.isTemplate)}function b(){r.setPattern(null),tj.setCurrentPattern(null),t&&t.destroy(),document.body.querySelectorAll(".pattern_only").forEach(tZ),document.body.removeAttribute("data-pattern")}tU.downloadBtn.addEventListener("click",()=>tT(n,{size:r.renderer.getLogicalSize()})),tU.downloadSVGBtn.addEventListener("click",()=>tT(n,{type:"svg",size:r.renderer.getLogicalSize()})),tU.downloadNailsBtn.addEventListener("click",()=>d()),tU.downloadNailsNoNumbersBtn.addEventListener("click",()=>d(!1)),tU.resetBtn.addEventListener("click",g),tU.shareBtn.addEventListener("click",async()=>await tL({renderer:i,pattern:n})),tU.instructionsLink.addEventListener("click",t=>{t.preventDefault(),history.pushState({pattern:null},"String Art Studio","./"),b()}),tj.addEventListener("select",({patternId:t})=>{f(u(t))}),document.body.addEventListener("click",t=>{let e=t.target instanceof HTMLElement&&t.target.closest("[data-toggle-for]");if(e instanceof HTMLElement&&e){var i;let t=e.dataset.toggleFor;i=[t],document.querySelectorAll("#buttons [data-toggle-for].active").forEach(t=>{t instanceof HTMLElement&&!i?.includes(t.getAttribute("data-toggle-for"))&&t.click()}),e.classList.toggle("active");let s=document.querySelector("#"+t);s&&(s.classList.toggle("open"),document.body.classList.toggle("dialog_"+t),n&&r.update())}}),tH.addEventListener("deletePattern",({pattern:t})=>{let e=u(t.type);e&&(e.config=t.config,f(e,{isDefaultConfig:!1}))}),tH.addEventListener("save",({pattern:t})=>{f(t)})}function tJ(t){t.removeAttribute("hidden")}function tZ(t){t.setAttribute("hidden","hidden")}window.addEventListener("load",tW);
//# sourceMappingURL=string_art.4a52c90b.js.map
